(self.webpackChunkmapbox=self.webpackChunkmapbox||[]).push([[179],{4357:function(nn){nn.exports=function(){"use strict";var we=function(N,$){var at={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},qt={on:function(me,jt,qe){if(void 0===at[me])throw new Error("Invalid event type: "+me);at[me].push({selector:jt,fn:qe})},render:function(me){$.store.featureChanged(me)}},he=function(me,jt){for(var qe=at[me],_n=qe.length;_n--;){var Dn=qe[_n];if(Dn.selector(jt)){Dn.fn.call(qt,jt)||$.store.render(),$.ui.updateMapClasses();break}}};return N.start.call(qt),{render:N.render,stop:function(){N.stop&&N.stop()},trash:function(){N.trash&&(N.trash(),$.store.render())},combineFeatures:function(){N.combineFeatures&&N.combineFeatures()},uncombineFeatures:function(){N.uncombineFeatures&&N.uncombineFeatures()},drag:function(me){he("drag",me)},click:function(me){he("click",me)},mousemove:function(me){he("mousemove",me)},mousedown:function(me){he("mousedown",me)},mouseup:function(me){he("mouseup",me)},mouseout:function(me){he("mouseout",me)},keydown:function(me){he("keydown",me)},keyup:function(me){he("keyup",me)},touchstart:function(me){he("touchstart",me)},touchmove:function(me){he("touchmove",me)},touchend:function(me){he("touchend",me)},tap:function(me){he("tap",me)}}};function Tt(N){return N&&N.__esModule&&Object.prototype.hasOwnProperty.call(N,"default")?N.default:N}var Rt={},Pt={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function rt(N){var $=0;if(N&&N.length>0){$+=Math.abs(zt(N[0]));for(var at=1;at<N.length;at++)$-=Math.abs(zt(N[at]))}return $}function zt(N){var $,at,qt,he,me,jt,qe=0,_n=N.length;if(_n>2){for(jt=0;jt<_n;jt++)jt===_n-2?(qt=_n-2,he=_n-1,me=0):jt===_n-1?(qt=_n-1,he=0,me=1):(qt=jt,he=jt+1,me=jt+2),$=N[qt],at=N[he],qe+=(ie(N[me][0])-ie($[0]))*Math.sin(ie(at[1]));qe=qe*Pt.RADIUS*Pt.RADIUS/2}return qe}function ie(N){return N*Math.PI/180}Rt.geometry=function N($){var at,qt=0;switch($.type){case"Polygon":return rt($.coordinates);case"MultiPolygon":for(at=0;at<$.coordinates.length;at++)qt+=rt($.coordinates[at]);return qt;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(at=0;at<$.geometries.length;at++)qt+=N($.geometries[at]);return qt}},Rt.ring=zt;var Yt={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},Me={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},Be={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},Ce={POLYGON:"polygon",LINE:"line_string",POINT:"point"},ee={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},_e={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},an={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},pt={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},mt={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},ot={ACTIVE:"true",INACTIVE:"false"},gt=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],ct=-85,kt=Object.freeze({__proto__:null,classes:Yt,sources:Me,cursors:Be,types:Ce,geojsonTypes:ee,modes:_e,events:an,updateActions:pt,meta:mt,activeStates:ot,interactions:gt,LAT_MIN:-90,LAT_RENDERED_MIN:ct,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),ut={Point:0,LineString:1,MultiLineString:1,Polygon:2};function H(N,$){var at=ut[N.geometry.type]-ut[$.geometry.type];return 0===at&&N.geometry.type===ee.POLYGON?N.area-$.area:at}function ht(N){return N.map(function($){return $.geometry.type===ee.POLYGON&&($.area=Rt.geometry({type:ee.FEATURE,property:{},geometry:$.geometry})),$}).sort(H).map(function($){return delete $.area,$})}function J(N,$){return void 0===$&&($=0),[[N.point.x-$,N.point.y-$],[N.point.x+$,N.point.y+$]]}function ue(N){if(this._items={},this._nums={},this._length=N?N.length:0,N)for(var $=0,at=N.length;$<at;$++)this.add(N[$]),void 0!==N[$]&&("string"==typeof N[$]?this._items[N[$]]=$:this._nums[N[$]]=$)}ue.prototype.add=function(N){return this.has(N)||(this._length++,"string"==typeof N?this._items[N]=this._length:this._nums[N]=this._length),this},ue.prototype.delete=function(N){return!1===this.has(N)||(this._length--,delete this._items[N],delete this._nums[N]),this},ue.prototype.has=function(N){return!("string"!=typeof N&&"number"!=typeof N||void 0===this._items[N]&&void 0===this._nums[N])},ue.prototype.values=function(){var N=this,$=[];return Object.keys(this._items).forEach(function(at){$.push({k:at,v:N._items[at]})}),Object.keys(this._nums).forEach(function(at){$.push({k:JSON.parse(at),v:N._nums[at]})}),$.sort(function(at,qt){return at.v-qt.v}).map(function(at){return at.k})},ue.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var St=[mt.FEATURE,mt.MIDPOINT,mt.VERTEX],Ht={click:function(N,$,at){return Et(N,$,at,at.options.clickBuffer)},touch:function(N,$,at){return Et(N,$,at,at.options.touchBuffer)}};function Et(N,$,at,qt){if(null===at.map)return[];var he=N?J(N,qt):$,me={};at.options.styles&&(me.layers=at.options.styles.map(function(Dn){return Dn.id}).filter(function(Dn){return null!=at.map.getLayer(Dn)}));var jt=at.map.queryRenderedFeatures(he,me).filter(function(Dn){return-1!==St.indexOf(Dn.properties.meta)}),qe=new ue,_n=[];return jt.forEach(function(Dn){var Vn=Dn.properties.id;qe.has(Vn)||(qe.add(Vn),_n.push(Dn))}),ht(_n)}function cn(N,$){var at=Ht.click(N,null,$),qt={mouse:Be.NONE};return at[0]&&(qt.mouse=at[0].properties.active===ot.ACTIVE?Be.MOVE:Be.POINTER,qt.feature=at[0].properties.meta),-1!==$.events.currentModeName().indexOf("draw")&&(qt.mouse=Be.ADD),$.ui.queueMapClasses(qt),$.ui.updateMapClasses(),at[0]}function en(N,$){var at=N.x-$.x,qt=N.y-$.y;return Math.sqrt(at*at+qt*qt)}function Ft(N,$,at){void 0===at&&(at={});var qt=null!=at.fineTolerance?at.fineTolerance:4,he=null!=at.grossTolerance?at.grossTolerance:12,me=null!=at.interval?at.interval:500;N.point=N.point||$.point,N.time=N.time||$.time;var jt=en(N.point,$.point);return jt<qt||jt<he&&$.time-N.time<me}function de(N,$,at){void 0===at&&(at={});var qt=null!=at.tolerance?at.tolerance:25,he=null!=at.interval?at.interval:250;return N.point=N.point||$.point,N.time=N.time||$.time,en(N.point,$.point)<qt&&$.time-N.time<he}var Vt={exports:{}},At=Vt.exports=function(N,$){if($||($=16),void 0===N&&(N=128),N<=0)return"0";for(var at=Math.log(Math.pow(2,N))/Math.log($),qt=2;at===1/0;qt*=2)at=Math.log(Math.pow(2,N/qt))/Math.log($)*qt;var he=at-Math.floor(at),me="";for(qt=0;qt<Math.floor(at);qt++)me=Math.floor(Math.random()*$).toString($)+me;if(he){var jt=Math.pow($,he);me=Math.floor(Math.random()*jt).toString($)+me}var qe=parseInt(me,$);return qe!==1/0&&qe>=Math.pow(2,N)?At(N,$):me};At.rack=function(N,$,at){var qt=function(me){var jt=0;do{if(jt++>10){if(!at)throw new Error("too many ID collisions, use more bits");N+=at}var qe=At(N,$)}while(Object.hasOwnProperty.call(he,qe));return he[qe]=me,qe},he=qt.hats={};return qt.get=function(me){return qt.hats[me]},qt.set=function(me,jt){return qt.hats[me]=jt,qt},qt.bits=N||128,qt.base=$||16,qt};var ne=Tt(Vt.exports),wt=function(N,$){this.ctx=N,this.properties=$.properties||{},this.coordinates=$.geometry.coordinates,this.id=$.id||ne(),this.type=$.geometry.type};wt.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},wt.prototype.incomingCoords=function(N){this.setCoordinates(N)},wt.prototype.setCoordinates=function(N){this.coordinates=N,this.changed()},wt.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},wt.prototype.setProperty=function(N,$){this.properties[N]=$},wt.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:ee.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},wt.prototype.internal=function(N){var $={id:this.id,meta:mt.FEATURE,"meta:type":this.type,active:ot.INACTIVE,mode:N};if(this.ctx.options.userProperties)for(var at in this.properties)$["user_"+at]=this.properties[at];return{type:ee.FEATURE,properties:$,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Le=function(N,$){wt.call(this,N,$)};(Le.prototype=Object.create(wt.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},Le.prototype.updateCoordinate=function(N,$,at){this.coordinates=3===arguments.length?[$,at]:[N,$],this.changed()},Le.prototype.getCoordinate=function(){return this.getCoordinates()};var Pe=function(N,$){wt.call(this,N,$)};(Pe.prototype=Object.create(wt.prototype)).isValid=function(){return this.coordinates.length>1},Pe.prototype.addCoordinate=function(N,$,at){this.changed();var qt=parseInt(N,10);this.coordinates.splice(qt,0,[$,at])},Pe.prototype.getCoordinate=function(N){var $=parseInt(N,10);return JSON.parse(JSON.stringify(this.coordinates[$]))},Pe.prototype.removeCoordinate=function(N){this.changed(),this.coordinates.splice(parseInt(N,10),1)},Pe.prototype.updateCoordinate=function(N,$,at){var qt=parseInt(N,10);this.coordinates[qt]=[$,at],this.changed()};var pe=function(N,$){wt.call(this,N,$),this.coordinates=this.coordinates.map(function(at){return at.slice(0,-1)})};(pe.prototype=Object.create(wt.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every(function(N){return N.length>2})},pe.prototype.incomingCoords=function(N){this.coordinates=N.map(function($){return $.slice(0,-1)}),this.changed()},pe.prototype.setCoordinates=function(N){this.coordinates=N,this.changed()},pe.prototype.addCoordinate=function(N,$,at){this.changed();var qt=N.split(".").map(function(he){return parseInt(he,10)});this.coordinates[qt[0]].splice(qt[1],0,[$,at])},pe.prototype.removeCoordinate=function(N){this.changed();var $=N.split(".").map(function(qt){return parseInt(qt,10)}),at=this.coordinates[$[0]];at&&(at.splice($[1],1),at.length<3&&this.coordinates.splice($[0],1))},pe.prototype.getCoordinate=function(N){var $=N.split(".").map(function(qt){return parseInt(qt,10)});return JSON.parse(JSON.stringify(this.coordinates[$[0]][$[1]]))},pe.prototype.getCoordinates=function(){return this.coordinates.map(function(N){return N.concat([N[0]])})},pe.prototype.updateCoordinate=function(N,$,at){this.changed();var qt=N.split("."),he=parseInt(qt[0],10),me=parseInt(qt[1],10);void 0===this.coordinates[he]&&(this.coordinates[he]=[]),this.coordinates[he][me]=[$,at]};var Fe={MultiPoint:Le,MultiLineString:Pe,MultiPolygon:pe},Ln=function(N,$,at,qt,he){var me=at.split("."),jt=parseInt(me[0],10),qe=me[1]?me.slice(1).join("."):null;return N[jt][$](qe,qt,he)},On=function(N,$){if(wt.call(this,N,$),delete this.coordinates,this.model=Fe[$.geometry.type],void 0===this.model)throw new TypeError($.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures($.geometry.coordinates)};function yn(N){this.map=N.map,this.drawConfig=JSON.parse(JSON.stringify(N.options||{})),this._ctx=N}(On.prototype=Object.create(wt.prototype))._coordinatesToFeatures=function(N){var $=this,at=this.model.bind(this);return N.map(function(qt){return new at($.ctx,{id:ne(),type:ee.FEATURE,properties:{},geometry:{coordinates:qt,type:$.type.replace("Multi","")}})})},On.prototype.isValid=function(){return this.features.every(function(N){return N.isValid()})},On.prototype.setCoordinates=function(N){this.features=this._coordinatesToFeatures(N),this.changed()},On.prototype.getCoordinate=function(N){return Ln(this.features,"getCoordinate",N)},On.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(N){return N.type===ee.POLYGON?N.getCoordinates():N.coordinates})))},On.prototype.updateCoordinate=function(N,$,at){Ln(this.features,"updateCoordinate",N,$,at),this.changed()},On.prototype.addCoordinate=function(N,$,at){Ln(this.features,"addCoordinate",N,$,at),this.changed()},On.prototype.removeCoordinate=function(N){Ln(this.features,"removeCoordinate",N),this.changed()},On.prototype.getFeatures=function(){return this.features},yn.prototype.setSelected=function(N){return this._ctx.store.setSelected(N)},yn.prototype.setSelectedCoordinates=function(N){var $=this;this._ctx.store.setSelectedCoordinates(N),N.reduce(function(at,qt){return void 0===at[qt.feature_id]&&(at[qt.feature_id]=!0,$._ctx.store.get(qt.feature_id).changed()),at},{})},yn.prototype.getSelected=function(){return this._ctx.store.getSelected()},yn.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},yn.prototype.isSelected=function(N){return this._ctx.store.isSelected(N)},yn.prototype.getFeature=function(N){return this._ctx.store.get(N)},yn.prototype.select=function(N){return this._ctx.store.select(N)},yn.prototype.deselect=function(N){return this._ctx.store.deselect(N)},yn.prototype.deleteFeature=function(N,$){return void 0===$&&($={}),this._ctx.store.delete(N,$)},yn.prototype.addFeature=function(N){return this._ctx.store.add(N)},yn.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},yn.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},yn.prototype.setActionableState=function(N){return void 0===N&&(N={}),this._ctx.events.actionable({trash:N.trash||!1,combineFeatures:N.combineFeatures||!1,uncombineFeatures:N.uncombineFeatures||!1})},yn.prototype.changeMode=function(N,$,at){return void 0===$&&($={}),void 0===at&&(at={}),this._ctx.events.changeMode(N,$,at)},yn.prototype.updateUIClasses=function(N){return this._ctx.ui.queueMapClasses(N)},yn.prototype.activateUIButton=function(N){return this._ctx.ui.setActiveButton(N)},yn.prototype.featuresAt=function(N,$,at){if(void 0===at&&(at="click"),"click"!==at&&"touch"!==at)throw new Error("invalid buffer type");return Ht[at](N,$,this._ctx)},yn.prototype.newFeature=function(N){var $=N.geometry.type;return $===ee.POINT?new Le(this._ctx,N):$===ee.LINE_STRING?new Pe(this._ctx,N):$===ee.POLYGON?new pe(this._ctx,N):new On(this._ctx,N)},yn.prototype.isInstanceOf=function(N,$){if(N===ee.POINT)return $ instanceof Le;if(N===ee.LINE_STRING)return $ instanceof Pe;if(N===ee.POLYGON)return $ instanceof pe;if("MultiFeature"===N)return $ instanceof On;throw new Error("Unknown feature class: "+N)},yn.prototype.doRender=function(N){return this._ctx.store.featureChanged(N)},yn.prototype.onSetup=function(){},yn.prototype.onDrag=function(){},yn.prototype.onClick=function(){},yn.prototype.onMouseMove=function(){},yn.prototype.onMouseDown=function(){},yn.prototype.onMouseUp=function(){},yn.prototype.onMouseOut=function(){},yn.prototype.onKeyUp=function(){},yn.prototype.onKeyDown=function(){},yn.prototype.onTouchStart=function(){},yn.prototype.onTouchMove=function(){},yn.prototype.onTouchEnd=function(){},yn.prototype.onTap=function(){},yn.prototype.onStop=function(){},yn.prototype.onTrash=function(){},yn.prototype.onCombineFeature=function(){},yn.prototype.onUncombineFeature=function(){},yn.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Yn={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Gn=Object.keys(Yn);function Er(N){return[].concat(N).filter(function($){return void 0!==$})}function di(){var N=this;if(!N.ctx.map||void 0===N.ctx.map.getSource(Me.HOT))return _n();var $=N.ctx.events.currentModeName();N.ctx.ui.queueMapClasses({mode:$});var at=[],qt=[];N.isDirty?qt=N.getAllIds():(at=N.getChangedIds().filter(function(Dn){return void 0!==N.get(Dn)}),qt=N.sources.hot.filter(function(Dn){return Dn.properties.id&&-1===at.indexOf(Dn.properties.id)&&void 0!==N.get(Dn.properties.id)}).map(function(Dn){return Dn.properties.id})),N.sources.hot=[];var he=N.sources.cold.length;N.sources.cold=N.isDirty?[]:N.sources.cold.filter(function(Dn){return-1===at.indexOf(Dn.properties.id||Dn.properties.parent)});var me=he!==N.sources.cold.length||qt.length>0;function jt(Dn,Vn){var bn=N.get(Dn).internal($);N.ctx.events.currentModeRender(bn,function(Ke){N.sources[Vn].push(Ke)})}if(at.forEach(function(Dn){return jt(Dn,"hot")}),qt.forEach(function(Dn){return jt(Dn,"cold")}),me&&N.ctx.map.getSource(Me.COLD).setData({type:ee.FEATURE_COLLECTION,features:N.sources.cold}),N.ctx.map.getSource(Me.HOT).setData({type:ee.FEATURE_COLLECTION,features:N.sources.hot}),N._emitSelectionChange&&(N.ctx.map.fire(an.SELECTION_CHANGE,{features:N.getSelected().map(function(Dn){return Dn.toGeoJSON()}),points:N.getSelectedCoordinates().map(function(Dn){return{type:ee.FEATURE,properties:{},geometry:{type:ee.POINT,coordinates:Dn.coordinates}}})}),N._emitSelectionChange=!1),N._deletedFeaturesToEmit.length){var qe=N._deletedFeaturesToEmit.map(function(Dn){return Dn.toGeoJSON()});N._deletedFeaturesToEmit=[],N.ctx.map.fire(an.DELETE,{features:qe})}function _n(){N.isDirty=!1,N.clearChangedIds()}_n(),N.ctx.map.fire(an.RENDER,{})}function Te(N){var $,at=this;this._features={},this._featureIds=new ue,this._selectedFeatureIds=new ue,this._selectedCoordinates=[],this._changedFeatureIds=new ue,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=N,this.sources={hot:[],cold:[]},this.render=function(){$||($=requestAnimationFrame(function(){$=null,di.call(at)}))},this.isDirty=!1}function st(N,$){var at=N._selectedCoordinates.filter(function(qt){return N._selectedFeatureIds.has(qt.feature_id)});N._selectedCoordinates.length===at.length||$.silent||(N._emitSelectionChange=!0),N._selectedCoordinates=at}Te.prototype.createRenderBatch=function(){var N=this,$=this.render,at=0;return this.render=function(){at++},function(){N.render=$,at>0&&N.render()}},Te.prototype.setDirty=function(){return this.isDirty=!0,this},Te.prototype.featureChanged=function(N){return this._changedFeatureIds.add(N),this},Te.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Te.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Te.prototype.getAllIds=function(){return this._featureIds.values()},Te.prototype.add=function(N){return this.featureChanged(N.id),this._features[N.id]=N,this._featureIds.add(N.id),this},Te.prototype.delete=function(N,$){var at=this;return void 0===$&&($={}),Er(N).forEach(function(qt){at._featureIds.has(qt)&&(at._featureIds.delete(qt),at._selectedFeatureIds.delete(qt),$.silent||-1===at._deletedFeaturesToEmit.indexOf(at._features[qt])&&at._deletedFeaturesToEmit.push(at._features[qt]),delete at._features[qt],at.isDirty=!0)}),st(this,$),this},Te.prototype.get=function(N){return this._features[N]},Te.prototype.getAll=function(){var N=this;return Object.keys(this._features).map(function($){return N._features[$]})},Te.prototype.select=function(N,$){var at=this;return void 0===$&&($={}),Er(N).forEach(function(qt){at._selectedFeatureIds.has(qt)||(at._selectedFeatureIds.add(qt),at._changedFeatureIds.add(qt),$.silent||(at._emitSelectionChange=!0))}),this},Te.prototype.deselect=function(N,$){var at=this;return void 0===$&&($={}),Er(N).forEach(function(qt){at._selectedFeatureIds.has(qt)&&(at._selectedFeatureIds.delete(qt),at._changedFeatureIds.add(qt),$.silent||(at._emitSelectionChange=!0))}),st(this,$),this},Te.prototype.clearSelected=function(N){return void 0===N&&(N={}),this.deselect(this._selectedFeatureIds.values(),{silent:N.silent}),this},Te.prototype.setSelected=function(N,$){var at=this;return void 0===$&&($={}),N=Er(N),this.deselect(this._selectedFeatureIds.values().filter(function(qt){return-1===N.indexOf(qt)}),{silent:$.silent}),this.select(N.filter(function(qt){return!at._selectedFeatureIds.has(qt)}),{silent:$.silent}),this},Te.prototype.setSelectedCoordinates=function(N){return this._selectedCoordinates=N,this._emitSelectionChange=!0,this},Te.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Te.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Te.prototype.getSelected=function(){var N=this;return this._selectedFeatureIds.values().map(function($){return N.get($)})},Te.prototype.getSelectedCoordinates=function(){var N=this;return this._selectedCoordinates.map(function($){return{coordinates:N.get($.feature_id).getCoordinate($.coord_path)}})},Te.prototype.isSelected=function(N){return this._selectedFeatureIds.has(N)},Te.prototype.setFeatureProperty=function(N,$,at){this.get(N).setProperty($,at),this.featureChanged(N)},Te.prototype.storeMapConfig=function(){var N=this;gt.forEach(function($){N.ctx.map[$]&&(N._mapInitialConfig[$]=N.ctx.map[$].isEnabled())})},Te.prototype.restoreMapConfig=function(){var N=this;Object.keys(this._mapInitialConfig).forEach(function($){N._mapInitialConfig[$]?N.ctx.map[$].enable():N.ctx.map[$].disable()})},Te.prototype.getInitialConfigValue=function(N){return void 0===this._mapInitialConfig[N]||this._mapInitialConfig[N]};var Gt=Object.prototype.hasOwnProperty,Ve=Tt(function(){for(var N=arguments,$={},at=0;at<arguments.length;at++){var qt=N[at];for(var he in qt)Gt.call(qt,he)&&($[he]=qt[he])}return $}),sn=["mode","feature","mouse"];function We(N){var $=null,at=null,qt={onRemove:function(){return N.map.off("load",qt.connect),clearInterval(at),qt.removeLayers(),N.store.restoreMapConfig(),N.ui.removeButtons(),N.events.removeEventListeners(),N.ui.clearMapClasses(),N.boxZoomInitial&&N.map.boxZoom.enable(),N.map=null,N.container=null,N.store=null,$&&$.parentNode&&$.parentNode.removeChild($),$=null,this},connect:function(){N.map.off("load",qt.connect),clearInterval(at),qt.addLayers(),N.store.storeMapConfig(),N.events.addEventListeners()},onAdd:function(he){var me=he.fire;return he.fire=function(jt,qe){var _n=arguments;return 1===me.length&&1!==arguments.length&&(_n=[Ve({},{type:jt},qe)]),me.apply(he,_n)},N.map=he,N.events=function(jt){var qe=Object.keys(jt.options.modes).reduce(function(It,Ne){return It[Ne]=function hn(N){var $=Object.keys(N);return function(at,qt){void 0===qt&&(qt={});var he={},me=$.reduce(function(jt,qe){return jt[qe]=N[qe],jt},new yn(at));return{start:function(){var jt=this;he=me.onSetup(qt),Gn.forEach(function(qe){var _n,Dn=Yn[qe],Vn=function(){return!1};N[Dn]&&(Vn=function(){return!0}),jt.on(qe,Vn,(_n=Dn,function(bn){return me[_n](he,bn)}))})},stop:function(){me.onStop(he)},trash:function(){me.onTrash(he)},combineFeatures:function(){me.onCombineFeatures(he)},uncombineFeatures:function(){me.onUncombineFeatures(he)},render:function(jt,qe){me.toDisplayFeatures(he,jt,qe)}}}}(jt.options.modes[Ne]),It},{}),_n={},Dn={},Vn={},bn=null,Ke=null;Vn.drag=function(It,Ne){Ne({point:It.point,time:(new Date).getTime()})?(jt.ui.queueMapClasses({mouse:Be.DRAG}),Ke.drag(It)):It.originalEvent.stopPropagation()},Vn.mousedrag=function(It){Vn.drag(It,function(Ne){return!Ft(_n,Ne)})},Vn.touchdrag=function(It){Vn.drag(It,function(Ne){return!de(Dn,Ne)})},Vn.mousemove=function(It){if(1===(void 0!==It.originalEvent.buttons?It.originalEvent.buttons:It.originalEvent.which))return Vn.mousedrag(It);var Ne=cn(It,jt);It.featureTarget=Ne,Ke.mousemove(It)},Vn.mousedown=function(It){_n={time:(new Date).getTime(),point:It.point};var Ne=cn(It,jt);It.featureTarget=Ne,Ke.mousedown(It)},Vn.mouseup=function(It){var Ne=cn(It,jt);It.featureTarget=Ne,Ft(_n,{point:It.point,time:(new Date).getTime()})?Ke.click(It):Ke.mouseup(It)},Vn.mouseout=function(It){Ke.mouseout(It)},Vn.touchstart=function(It){if(jt.options.touchEnabled){Dn={time:(new Date).getTime(),point:It.point};var Ne=Ht.touch(It,null,jt)[0];It.featureTarget=Ne,Ke.touchstart(It)}},Vn.touchmove=function(It){if(jt.options.touchEnabled)return Ke.touchmove(It),Vn.touchdrag(It)},Vn.touchend=function(It){if(It.originalEvent.preventDefault(),jt.options.touchEnabled){var Ne=Ht.touch(It,null,jt)[0];It.featureTarget=Ne,de(Dn,{time:(new Date).getTime(),point:It.point})?Ke.tap(It):Ke.touchend(It)}};var Se=function(It){return!(8===It||46===It||It>=48&&It<=57)};function Oe(It,Ne,Pi){void 0===Pi&&(Pi={}),Ke.stop();var Mi=qe[It];if(void 0===Mi)throw new Error(It+" is not valid");bn=It;var zn=Mi(jt,Ne);Ke=we(zn,jt),Pi.silent||jt.map.fire(an.MODE_CHANGE,{mode:It}),jt.store.setDirty(),jt.store.render()}Vn.keydown=function(It){(It.srcElement||It.target).classList.contains("mapboxgl-canvas")&&(8!==It.keyCode&&46!==It.keyCode||!jt.options.controls.trash?Se(It.keyCode)?Ke.keydown(It):49===It.keyCode&&jt.options.controls.point?Oe(_e.DRAW_POINT):50===It.keyCode&&jt.options.controls.line_string?Oe(_e.DRAW_LINE_STRING):51===It.keyCode&&jt.options.controls.polygon&&Oe(_e.DRAW_POLYGON):(It.preventDefault(),Ke.trash()))},Vn.keyup=function(It){Se(It.keyCode)&&Ke.keyup(It)},Vn.zoomend=function(){jt.store.changeZoom()},Vn.data=function(It){if("style"===It.dataType){var Ne=jt.setup,Pi=jt.map,zn=jt.store;jt.options.styles.some(function(Qa){return Pi.getLayer(Qa.id)})||(Ne.addLayers(),zn.setDirty(),zn.render())}};var Qn={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){Ke=we(qe[bn=jt.options.defaultMode](jt),jt)},changeMode:Oe,actionable:function(It){var Ne=!1;Object.keys(It).forEach(function(Pi){if(void 0===Qn[Pi])throw new Error("Invalid action type");Qn[Pi]!==It[Pi]&&(Ne=!0),Qn[Pi]=It[Pi]}),Ne&&jt.map.fire(an.ACTIONABLE,{actions:Qn})},currentModeName:function(){return bn},currentModeRender:function(It,Ne){return Ke.render(It,Ne)},fire:function(It,Ne){Vn[It]&&Vn[It](Ne)},addEventListeners:function(){jt.map.on("mousemove",Vn.mousemove),jt.map.on("mousedown",Vn.mousedown),jt.map.on("mouseup",Vn.mouseup),jt.map.on("data",Vn.data),jt.map.on("touchmove",Vn.touchmove),jt.map.on("touchstart",Vn.touchstart),jt.map.on("touchend",Vn.touchend),jt.container.addEventListener("mouseout",Vn.mouseout),jt.options.keybindings&&(jt.container.addEventListener("keydown",Vn.keydown),jt.container.addEventListener("keyup",Vn.keyup))},removeEventListeners:function(){jt.map.off("mousemove",Vn.mousemove),jt.map.off("mousedown",Vn.mousedown),jt.map.off("mouseup",Vn.mouseup),jt.map.off("data",Vn.data),jt.map.off("touchmove",Vn.touchmove),jt.map.off("touchstart",Vn.touchstart),jt.map.off("touchend",Vn.touchend),jt.container.removeEventListener("mouseout",Vn.mouseout),jt.options.keybindings&&(jt.container.removeEventListener("keydown",Vn.keydown),jt.container.removeEventListener("keyup",Vn.keyup))},trash:function(It){Ke.trash(It)},combineFeatures:function(){Ke.combineFeatures()},uncombineFeatures:function(){Ke.uncombineFeatures()},getMode:function(){return bn}}}(N),N.ui=function(jt){var qe={},_n=null,Dn={mode:null,feature:null,mouse:null},Vn={mode:null,feature:null,mouse:null};function bn(It){Vn=Ve(Vn,It)}function Ke(){var It,Ne;if(jt.container){var Pi=[],Mi=[];sn.forEach(function(zn){Vn[zn]!==Dn[zn]&&(Pi.push(zn+"-"+Dn[zn]),null!==Vn[zn]&&Mi.push(zn+"-"+Vn[zn]))}),Pi.length>0&&(It=jt.container.classList).remove.apply(It,Pi),Mi.length>0&&(Ne=jt.container.classList).add.apply(Ne,Mi),Dn=Ve(Dn,Vn)}}function Se(It,Ne){void 0===Ne&&(Ne={});var Pi=document.createElement("button");return Pi.className=Yt.CONTROL_BUTTON+" "+Ne.className,Pi.setAttribute("title",Ne.title),Ne.container.appendChild(Pi),Pi.addEventListener("click",function(Mi){if(Mi.preventDefault(),Mi.stopPropagation(),Mi.target===_n)return Oe(),void Ne.onDeactivate();Qn(It),Ne.onActivate()},!0),Pi}function Oe(){_n&&(_n.classList.remove(Yt.ACTIVE_BUTTON),_n=null)}function Qn(It){Oe();var Ne=qe[It];Ne&&Ne&&"trash"!==It&&(Ne.classList.add(Yt.ACTIVE_BUTTON),_n=Ne)}return{setActiveButton:Qn,queueMapClasses:bn,updateMapClasses:Ke,clearMapClasses:function(){bn({mode:null,feature:null,mouse:null}),Ke()},addButtons:function(){var It=jt.options.controls,Ne=document.createElement("div");return Ne.className=Yt.CONTROL_GROUP+" "+Yt.CONTROL_BASE,It&&(It[Ce.LINE]&&(qe[Ce.LINE]=Se(Ce.LINE,{container:Ne,className:Yt.CONTROL_BUTTON_LINE,title:"LineString tool "+(jt.options.keybindings?"(l)":""),onActivate:function(){return jt.events.changeMode(_e.DRAW_LINE_STRING)},onDeactivate:function(){return jt.events.trash()}})),It[Ce.POLYGON]&&(qe[Ce.POLYGON]=Se(Ce.POLYGON,{container:Ne,className:Yt.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(jt.options.keybindings?"(p)":""),onActivate:function(){return jt.events.changeMode(_e.DRAW_POLYGON)},onDeactivate:function(){return jt.events.trash()}})),It[Ce.POINT]&&(qe[Ce.POINT]=Se(Ce.POINT,{container:Ne,className:Yt.CONTROL_BUTTON_POINT,title:"Marker tool "+(jt.options.keybindings?"(m)":""),onActivate:function(){return jt.events.changeMode(_e.DRAW_POINT)},onDeactivate:function(){return jt.events.trash()}})),It.trash&&(qe.trash=Se("trash",{container:Ne,className:Yt.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){jt.events.trash()}})),It.combine_features&&(qe.combine_features=Se("combineFeatures",{container:Ne,className:Yt.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){jt.events.combineFeatures()}})),It.uncombine_features&&(qe.uncombine_features=Se("uncombineFeatures",{container:Ne,className:Yt.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){jt.events.uncombineFeatures()}}))),Ne},removeButtons:function(){Object.keys(qe).forEach(function(It){var Ne=qe[It];Ne.parentNode&&Ne.parentNode.removeChild(Ne),delete qe[It]})}}}(N),N.container=he.getContainer(),N.store=new Te(N),$=N.ui.addButtons(),N.options.boxSelect&&(N.boxZoomInitial=he.boxZoom.isEnabled(),he.boxZoom.disable(),he.dragPan.disable(),he.dragPan.enable()),he.loaded()?qt.connect():(he.on("load",qt.connect),at=setInterval(function(){he.loaded()&&qt.connect()},16)),N.events.start(),$},addLayers:function(){N.map.addSource(Me.COLD,{data:{type:ee.FEATURE_COLLECTION,features:[]},type:"geojson"}),N.map.addSource(Me.HOT,{data:{type:ee.FEATURE_COLLECTION,features:[]},type:"geojson"}),N.options.styles.forEach(function(he){N.map.addLayer(he)}),N.store.setDirty(!0),N.store.render()},removeLayers:function(){N.options.styles.forEach(function(he){N.map.getLayer(he.id)&&N.map.removeLayer(he.id)}),N.map.getSource(Me.COLD)&&N.map.removeSource(Me.COLD),N.map.getSource(Me.HOT)&&N.map.removeSource(Me.HOT)}};return N.setup=qt,qt}var gn=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function rn(N){return function($){var at=$.featureTarget;return!!at&&!!at.properties&&at.properties.meta===N}}function Rn(N){return!!N.originalEvent&&!!N.originalEvent.shiftKey&&0===N.originalEvent.button}function jn(N){return!!N.featureTarget&&!!N.featureTarget.properties&&N.featureTarget.properties.active===ot.ACTIVE&&N.featureTarget.properties.meta===mt.FEATURE}function Sn(N){return!!N.featureTarget&&!!N.featureTarget.properties&&N.featureTarget.properties.active===ot.INACTIVE&&N.featureTarget.properties.meta===mt.FEATURE}function mn(N){return void 0===N.featureTarget}function Ni(N){return!!N.featureTarget&&!!N.featureTarget.properties&&N.featureTarget.properties.meta===mt.FEATURE}function Zi(N){var $=N.featureTarget;return!!$&&!!$.properties&&$.properties.meta===mt.VERTEX}function Nn(N){return!!N.originalEvent&&!0===N.originalEvent.shiftKey}function Hr(N){return 27===N.keyCode}function fe(N){return 13===N.keyCode}var W=Object.freeze({__proto__:null,isOfMetaType:rn,isShiftMousedown:Rn,isActiveFeature:jn,isInactiveFeature:Sn,noTarget:mn,isFeature:Ni,isVertex:Zi,isShiftDown:Nn,isEscapeKey:Hr,isEnterKey:fe,isTrue:function(){return!0}}),nt=Dt;function Dt(N,$){this.x=N,this.y=$}Dt.prototype={clone:function(){return new Dt(this.x,this.y)},add:function(N){return this.clone()._add(N)},sub:function(N){return this.clone()._sub(N)},multByPoint:function(N){return this.clone()._multByPoint(N)},divByPoint:function(N){return this.clone()._divByPoint(N)},mult:function(N){return this.clone()._mult(N)},div:function(N){return this.clone()._div(N)},rotate:function(N){return this.clone()._rotate(N)},rotateAround:function(N,$){return this.clone()._rotateAround(N,$)},matMult:function(N){return this.clone()._matMult(N)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(N){return this.x===N.x&&this.y===N.y},dist:function(N){return Math.sqrt(this.distSqr(N))},distSqr:function(N){var $=N.x-this.x,at=N.y-this.y;return $*$+at*at},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(N){return Math.atan2(this.y-N.y,this.x-N.x)},angleWith:function(N){return this.angleWithSep(N.x,N.y)},angleWithSep:function(N,$){return Math.atan2(this.x*$-this.y*N,this.x*N+this.y*$)},_matMult:function(N){var at=N[2]*this.x+N[3]*this.y;return this.x=N[0]*this.x+N[1]*this.y,this.y=at,this},_add:function(N){return this.x+=N.x,this.y+=N.y,this},_sub:function(N){return this.x-=N.x,this.y-=N.y,this},_mult:function(N){return this.x*=N,this.y*=N,this},_div:function(N){return this.x/=N,this.y/=N,this},_multByPoint:function(N){return this.x*=N.x,this.y*=N.y,this},_divByPoint:function(N){return this.x/=N.x,this.y/=N.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var N=this.y;return this.y=this.x,this.x=-N,this},_rotate:function(N){var $=Math.cos(N),at=Math.sin(N),he=at*this.x+$*this.y;return this.x=$*this.x-at*this.y,this.y=he,this},_rotateAround:function(N,$){var at=Math.cos(N),qt=Math.sin(N),me=$.y+qt*(this.x-$.x)+at*(this.y-$.y);return this.x=$.x+at*(this.x-$.x)-qt*(this.y-$.y),this.y=me,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Dt.convert=function(N){return N instanceof Dt?N:Array.isArray(N)?new Dt(N[0],N[1]):N};var Jt=Tt(nt);function Xt(N,$){var at=$.getBoundingClientRect();return new Jt(N.clientX-at.left-($.clientLeft||0),N.clientY-at.top-($.clientTop||0))}function Ue(N,$,at,qt){return{type:ee.FEATURE,properties:{meta:mt.VERTEX,parent:N,coord_path:at,active:qt?ot.ACTIVE:ot.INACTIVE},geometry:{type:ee.POINT,coordinates:$}}}function ke(N,$,at){var qt=$.geometry.coordinates,he=at.geometry.coordinates;if(qt[1]>85||qt[1]<ct||he[1]>85||he[1]<ct)return null;var me={lng:(qt[0]+he[0])/2,lat:(qt[1]+he[1])/2};return{type:ee.FEATURE,properties:{meta:mt.MIDPOINT,parent:N,lng:me.lng,lat:me.lat,coord_path:at.properties.coord_path},geometry:{type:ee.POINT,coordinates:[me.lng,me.lat]}}}function Ye(N,$,at){void 0===$&&($={}),void 0===at&&(at=null);var qt,he=N.geometry,me=he.type,jt=he.coordinates,qe=N.properties&&N.properties.id,_n=[];function Dn(bn,Ke){var Se="",Oe=null;bn.forEach(function(Qn,It){var Ne=null!=Ke?Ke+"."+It:String(It),Pi=Ue(qe,Qn,Ne,Vn(Ne));if($.midpoints&&Oe){var Mi=ke(qe,Oe,Pi);Mi&&_n.push(Mi)}Oe=Pi;var zn=JSON.stringify(Qn);Se!==zn&&_n.push(Pi),0===It&&(Se=zn)})}function Vn(bn){return!!$.selectedPaths&&-1!==$.selectedPaths.indexOf(bn)}return me===ee.POINT?_n.push(Ue(qe,jt,at,Vn(at))):me===ee.POLYGON?jt.forEach(function(bn,Ke){Dn(bn,null!==at?at+"."+Ke:String(Ke))}):me===ee.LINE_STRING?Dn(jt,at):0===me.indexOf(ee.MULTI_PREFIX)&&(qt=me.replace(ee.MULTI_PREFIX,""),jt.forEach(function(bn,Ke){_n=_n.concat(Ye({type:ee.FEATURE,properties:N.properties,geometry:{type:qt,coordinates:bn}},$,Ke))})),_n}var Je={enable:function(N){setTimeout(function(){N.map&&N.map.doubleClickZoom&&N._ctx&&N._ctx.store&&N._ctx.store.getInitialConfigValue&&N._ctx.store.getInitialConfigValue("doubleClickZoom")&&N.map.doubleClickZoom.enable()},0)},disable:function(N){setTimeout(function(){N.map&&N.map.doubleClickZoom&&N.map.doubleClickZoom.disable()},0)}},Kt={exports:{}},lt=function(N){if(!N||!N.type)return null;var $=se[N.type];return $?"geometry"===$?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:N}]}:"feature"===$?{type:"FeatureCollection",features:[N]}:"featurecollection"===$?N:void 0:null},se={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},ve=Tt(lt),ye=Object.freeze({__proto__:null,default:function N($){switch($&&$.type||null){case"FeatureCollection":return $.features=$.features.reduce(function(at,qt){return at.concat(N(qt))},[]),$;case"Feature":return $.geometry?N($.geometry).map(function(at){var qt={type:"Feature",properties:JSON.parse(JSON.stringify($.properties)),geometry:at};return void 0!==$.id&&(qt.id=$.id),qt}):[$];case"MultiPoint":return $.coordinates.map(function(at){return{type:"Point",coordinates:at}});case"MultiPolygon":return $.coordinates.map(function(at){return{type:"Polygon",coordinates:at}});case"MultiLineString":return $.coordinates.map(function(at){return{type:"LineString",coordinates:at}});case"GeometryCollection":return $.geometries.map(N).reduce(function(at,qt){return at.concat(qt)},[]);case"Point":case"Polygon":case"LineString":return[$]}}}),je=lt,tn=function Ct(N){if(N.__esModule)return N;var $=N.default;if("function"==typeof $){var at=function qt(){if(this instanceof qt){var he=[null];return he.push.apply(he,arguments),new(Function.bind.apply($,he))}return $.apply(this,arguments)};at.prototype=$.prototype}else at={};return Object.defineProperty(at,"__esModule",{value:!0}),Object.keys(N).forEach(function(qt){var he=Object.getOwnPropertyDescriptor(N,qt);Object.defineProperty(at,qt,he.get?he:{enumerable:!0,get:function(){return N[qt]}})}),at}(ye);tn instanceof Function||(tn=tn.default);var dn={exports:{}},fn=dn.exports=function(N){return new Tn(N)};function Tn(N){this.value=N}function Ir(N,$,at){var qt=[],he=[],me=!0;return function jt(qe){var _n=at?En(qe):qe,Dn={},Vn=!0,bn={node:_n,node_:qe,path:[].concat(qt),parent:he[he.length-1],parents:he,key:qt.slice(-1)[0],isRoot:0===qt.length,level:qt.length,circular:null,update:function(Oe,Qn){bn.isRoot||(bn.parent.node[bn.key]=Oe),bn.node=Oe,Qn&&(Vn=!1)},delete:function(Oe){delete bn.parent.node[bn.key],Oe&&(Vn=!1)},remove:function(Oe){ei(bn.parent.node)?bn.parent.node.splice(bn.key,1):delete bn.parent.node[bn.key],Oe&&(Vn=!1)},keys:null,before:function(Oe){Dn.before=Oe},after:function(Oe){Dn.after=Oe},pre:function(Oe){Dn.pre=Oe},post:function(Oe){Dn.post=Oe},stop:function(){me=!1},block:function(){Vn=!1}};if(!me)return bn;function Ke(){if("object"==typeof bn.node&&null!==bn.node){bn.keys&&bn.node_===bn.node||(bn.keys=gr(bn.node)),bn.isLeaf=0==bn.keys.length;for(var Oe=0;Oe<he.length;Oe++)if(he[Oe].node_===qe){bn.circular=he[Oe];break}}else bn.isLeaf=!0,bn.keys=null;bn.notLeaf=!bn.isLeaf,bn.notRoot=!bn.isRoot}Ke();var Se=$.call(bn,bn.node);return void 0!==Se&&bn.update&&bn.update(Se),Dn.before&&Dn.before.call(bn,bn.node),Vn&&("object"!=typeof bn.node||null===bn.node||bn.circular||(he.push(bn),Ke(),Kn(bn.keys,function(Oe,Qn){qt.push(Oe),Dn.pre&&Dn.pre.call(bn,bn.node[Oe],Oe);var It=jt(bn.node[Oe]);at&&li.call(bn.node,Oe)&&(bn.node[Oe]=It.node),It.isLast=Qn==bn.keys.length-1,It.isFirst=0==Qn,Dn.post&&Dn.post.call(bn,It),qt.pop()}),he.pop()),Dn.after&&Dn.after.call(bn,bn.node)),bn}(N).node}function En(N){if("object"==typeof N&&null!==N){var $;if(ei(N))$=[];else if("[object Date]"===mr(N))$=new Date(N.getTime?N.getTime():N);else if("[object RegExp]"===mr(N))$=new RegExp(N);else if("[object Error]"===mr(N))$={message:N.message};else if(function(he){return"[object Boolean]"===mr(he)}(N))$=new Boolean(N);else if(function(he){return"[object Number]"===mr(he)}(N))$=new Number(N);else if(function(he){return"[object String]"===mr(he)}(N))$=new String(N);else if(Object.create&&Object.getPrototypeOf)$=Object.create(Object.getPrototypeOf(N));else if(N.constructor===Object)$={};else{var qt=function(){};qt.prototype=N.constructor&&N.constructor.prototype||N.__proto__||{},$=new qt}return Kn(gr(N),function(he){$[he]=N[he]}),$}return N}Tn.prototype.get=function(N){for(var $=this.value,at=0;at<N.length;at++){var qt=N[at];if(!$||!li.call($,qt)){$=void 0;break}$=$[qt]}return $},Tn.prototype.has=function(N){for(var $=this.value,at=0;at<N.length;at++){var qt=N[at];if(!$||!li.call($,qt))return!1;$=$[qt]}return!0},Tn.prototype.set=function(N,$){for(var at=this.value,qt=0;qt<N.length-1;qt++){var he=N[qt];li.call(at,he)||(at[he]={}),at=at[he]}return at[N[qt]]=$,$},Tn.prototype.map=function(N){return Ir(this.value,N,!0)},Tn.prototype.forEach=function(N){return this.value=Ir(this.value,N,!1),this.value},Tn.prototype.reduce=function(N,$){var at=1===arguments.length,qt=at?this.value:$;return this.forEach(function(he){this.isRoot&&at||(qt=N.call(this,qt,he))}),qt},Tn.prototype.paths=function(){var N=[];return this.forEach(function($){N.push(this.path)}),N},Tn.prototype.nodes=function(){var N=[];return this.forEach(function($){N.push(this.node)}),N},Tn.prototype.clone=function(){var N=[],$=[];return function at(qt){for(var he=0;he<N.length;he++)if(N[he]===qt)return $[he];if("object"==typeof qt&&null!==qt){var me=En(qt);return N.push(qt),$.push(me),Kn(gr(qt),function(jt){me[jt]=at(qt[jt])}),N.pop(),$.pop(),me}return qt}(this.value)};var gr=Object.keys||function(N){var $=[];for(var at in N)$.push(at);return $};function mr(N){return Object.prototype.toString.call(N)}var ei=Array.isArray||function(N){return"[object Array]"===Object.prototype.toString.call(N)},Kn=function(N,$){if(N.forEach)return N.forEach($);for(var at=0;at<N.length;at++)$(N[at],at,N)};Kn(gr(Tn.prototype),function(N){fn[N]=function($){var at=[].slice.call(arguments,1),qt=new Tn($);return qt[N].apply(qt,at)}});var li=Object.hasOwnProperty||function(N,$){return $ in N},Vi=dn.exports,ui=Rr;function Rr(N){if(!(this instanceof Rr))return new Rr(N);this._bbox=N||[1/0,1/0,-1/0,-1/0],this._valid=!!N}Rr.prototype.include=function(N){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],N[0]),this._bbox[1]=Math.min(this._bbox[1],N[1]),this._bbox[2]=Math.max(this._bbox[2],N[0]),this._bbox[3]=Math.max(this._bbox[3],N[1]),this},Rr.prototype.equals=function(N){var $;return $=N instanceof Rr?N.bbox():N,this._bbox[0]==$[0]&&this._bbox[1]==$[1]&&this._bbox[2]==$[2]&&this._bbox[3]==$[3]},Rr.prototype.center=function(N){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Rr.prototype.union=function(N){var $;return this._valid=!0,$=N instanceof Rr?N.bbox():N,this._bbox[0]=Math.min(this._bbox[0],$[0]),this._bbox[1]=Math.min(this._bbox[1],$[1]),this._bbox[2]=Math.max(this._bbox[2],$[2]),this._bbox[3]=Math.max(this._bbox[3],$[3]),this},Rr.prototype.bbox=function(){return this._valid?this._bbox:null},Rr.prototype.contains=function(N){if(!N)return this._fastContains();if(!this._valid)return null;var $=N[0],at=N[1];return this._bbox[0]<=$&&this._bbox[1]<=at&&this._bbox[2]>=$&&this._bbox[3]>=at},Rr.prototype.intersect=function(N){return this._valid?($=N instanceof Rr?N.bbox():N,!(this._bbox[0]>$[2]||this._bbox[2]<$[0]||this._bbox[3]<$[1]||this._bbox[1]>$[3])):null;var $},Rr.prototype._fastContains=function(){return this._valid?new Function("ll","return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]"):new Function("return null;")},Rr.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var ls=function(N){if(!N)return[];var $=tn(je(N)),at=[];return $.features.forEach(function(qt){qt.geometry&&(at=at.concat(function(N){return function $(at){return Array.isArray(at)&&at.length&&"number"==typeof at[0]?[at]:at.reduce(function(qt,he){return Array.isArray(he)&&Array.isArray(he[0])?qt.concat($(he)):(qt.push(he),qt)},[])}(N)}(qt.geometry.coordinates)))}),at},Xo=Vi,dl=ui,js={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},wh=Object.keys(js);function Vo(N){for(var $=dl(),at=ls(N),qt=0;qt<at.length;qt++)$.include(at[qt]);return $}Kt.exports=function(N){return Vo(N).bbox()},Kt.exports.polygon=function(N){return Vo(N).polygon()},Kt.exports.bboxify=function(N){return Xo(N).map(function($){$&&wh.some(function(at){return!!$[at]&&-1!==js[at].indexOf($.type)})&&($.bbox=Vo($).bbox(),this.update($))})};var ps=Tt(Kt.exports),Iu=-90;function ga(N,$){var at=Iu,qt=90,he=Iu,me=90,jt=270,qe=-270;N.forEach(function(Dn){var Vn=ps(Dn),bn=Vn[1],Ke=Vn[3],Se=Vn[0],Oe=Vn[2];bn>at&&(at=bn),Ke<qt&&(qt=Ke),Ke>he&&(he=Ke),bn<me&&(me=bn),Se<jt&&(jt=Se),Oe>qe&&(qe=Oe)});var _n=$;return at+_n.lat>85&&(_n.lat=85-at),he+_n.lat>90&&(_n.lat=90-he),qt+_n.lat<-85&&(_n.lat=-85-qt),me+_n.lat<Iu&&(_n.lat=Iu-me),jt+_n.lng<=-270&&(_n.lng+=360*Math.ceil(Math.abs(_n.lng)/360)),qe+_n.lng>=270&&(_n.lng-=360*Math.ceil(Math.abs(_n.lng)/360)),_n}function Ja(N,$){var at=ga(N.map(function(qt){return qt.toGeoJSON()}),$);N.forEach(function(qt){var he,me=qt.getCoordinates(),jt=function(_n){var Dn={lng:_n[0]+at.lng,lat:_n[1]+at.lat};return[Dn.lng,Dn.lat]},qe=function(_n){return _n.map(function(Dn){return jt(Dn)})};qt.type===ee.POINT?he=jt(me):qt.type===ee.LINE_STRING||qt.type===ee.MULTI_POINT?he=me.map(jt):qt.type===ee.POLYGON||qt.type===ee.MULTI_LINE_STRING?he=me.map(qe):qt.type===ee.MULTI_POLYGON&&(he=me.map(function(_n){return _n.map(function(Dn){return qe(Dn)})})),qt.incomingCoords(he)})}var wi={onSetup:function(N){var $=this,at={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:N.featureIds||[]};return this.setSelected(at.initiallySelectedFeatureIds.filter(function(qt){return void 0!==$.getFeature(qt)})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),at},fireUpdate:function(){this.map.fire(an.UPDATE,{action:pt.MOVE,features:this.getSelected().map(function(N){return N.toGeoJSON()})})},fireActionable:function(){var N=this,$=this.getSelected(),at=$.filter(function(qe){return N.isInstanceOf("MultiFeature",qe)}),qt=!1;if($.length>1){qt=!0;var he=$[0].type.replace("Multi","");$.forEach(function(qe){qe.type.replace("Multi","")!==he&&(qt=!1)})}this.setActionableState({combineFeatures:qt,uncombineFeatures:at.length>0,trash:$.length>0})},getUniqueIds:function(N){return N.length?N.map(function($){return $.properties.id}).filter(function($){return void 0!==$}).reduce(function($,at){return $.add(at),$},new ue).values():[]},stopExtendedInteractions:function(N){N.boxSelectElement&&(N.boxSelectElement.parentNode&&N.boxSelectElement.parentNode.removeChild(N.boxSelectElement),N.boxSelectElement=null),this.map.dragPan.enable(),N.boxSelecting=!1,N.canBoxSelect=!1,N.dragMoving=!1,N.canDragMove=!1},onStop:function(){Je.enable(this)},onMouseMove:function(N,$){return Ni($)&&N.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(N),!0},onMouseOut:function(N){return!N.dragMoving||this.fireUpdate()}};wi.onTap=wi.onClick=function(N,$){return mn($)?this.clickAnywhere(N,$):rn(mt.VERTEX)($)?this.clickOnVertex(N,$):Ni($)?this.clickOnFeature(N,$):void 0},wi.clickAnywhere=function(N){var $=this,at=this.getSelectedIds();at.length&&(this.clearSelectedFeatures(),at.forEach(function(qt){return $.doRender(qt)})),Je.enable(this),this.stopExtendedInteractions(N)},wi.clickOnVertex=function(N,$){this.changeMode(_e.DIRECT_SELECT,{featureId:$.featureTarget.properties.parent,coordPath:$.featureTarget.properties.coord_path,startPos:$.lngLat}),this.updateUIClasses({mouse:Be.MOVE})},wi.startOnActiveFeature=function(N,$){this.stopExtendedInteractions(N),this.map.dragPan.disable(),this.doRender($.featureTarget.properties.id),N.canDragMove=!0,N.dragMoveLocation=$.lngLat},wi.clickOnFeature=function(N,$){var at=this;Je.disable(this),this.stopExtendedInteractions(N);var qt=Nn($),he=this.getSelectedIds(),me=$.featureTarget.properties.id,jt=this.isSelected(me);if(!qt&&jt&&this.getFeature(me).type!==ee.POINT)return this.changeMode(_e.DIRECT_SELECT,{featureId:me});jt&&qt?(this.deselect(me),this.updateUIClasses({mouse:Be.POINTER}),1===he.length&&Je.enable(this)):!jt&&qt?(this.select(me),this.updateUIClasses({mouse:Be.MOVE})):jt||qt||(he.forEach(function(qe){return at.doRender(qe)}),this.setSelected(me),this.updateUIClasses({mouse:Be.MOVE})),this.doRender(me)},wi.onMouseDown=function(N,$){return jn($)?this.startOnActiveFeature(N,$):this.drawConfig.boxSelect&&Rn($)?this.startBoxSelect(N,$):void 0},wi.startBoxSelect=function(N,$){this.stopExtendedInteractions(N),this.map.dragPan.disable(),N.boxSelectStartLocation=Xt($.originalEvent,this.map.getContainer()),N.canBoxSelect=!0},wi.onTouchStart=function(N,$){if(jn($))return this.startOnActiveFeature(N,$)},wi.onDrag=function(N,$){return N.canDragMove?this.dragMove(N,$):this.drawConfig.boxSelect&&N.canBoxSelect?this.whileBoxSelect(N,$):void 0},wi.whileBoxSelect=function(N,$){N.boxSelecting=!0,this.updateUIClasses({mouse:Be.ADD}),N.boxSelectElement||(N.boxSelectElement=document.createElement("div"),N.boxSelectElement.classList.add(Yt.BOX_SELECT),this.map.getContainer().appendChild(N.boxSelectElement));var at=Xt($.originalEvent,this.map.getContainer()),qt=Math.min(N.boxSelectStartLocation.x,at.x),he=Math.max(N.boxSelectStartLocation.x,at.x),me=Math.min(N.boxSelectStartLocation.y,at.y),jt=Math.max(N.boxSelectStartLocation.y,at.y),qe="translate("+qt+"px, "+me+"px)";N.boxSelectElement.style.transform=qe,N.boxSelectElement.style.WebkitTransform=qe,N.boxSelectElement.style.width=he-qt+"px",N.boxSelectElement.style.height=jt-me+"px"},wi.dragMove=function(N,$){N.dragMoving=!0,$.originalEvent.stopPropagation();var at={lng:$.lngLat.lng-N.dragMoveLocation.lng,lat:$.lngLat.lat-N.dragMoveLocation.lat};Ja(this.getSelected(),at),N.dragMoveLocation=$.lngLat},wi.onTouchEnd=wi.onMouseUp=function(N,$){var at=this;if(N.dragMoving)this.fireUpdate();else if(N.boxSelecting){var qt=[N.boxSelectStartLocation,Xt($.originalEvent,this.map.getContainer())],he=this.featuresAt(null,qt,"click"),me=this.getUniqueIds(he).filter(function(jt){return!at.isSelected(jt)});me.length&&(this.select(me),me.forEach(function(jt){return at.doRender(jt)}),this.updateUIClasses({mouse:Be.MOVE}))}this.stopExtendedInteractions(N)},wi.toDisplayFeatures=function(N,$,at){$.properties.active=this.isSelected($.properties.id)?ot.ACTIVE:ot.INACTIVE,at($),this.fireActionable(),$.properties.active===ot.ACTIVE&&$.geometry.type!==ee.POINT&&Ye($).forEach(at)},wi.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},wi.onCombineFeatures=function(){var N=this.getSelected();if(!(0===N.length||N.length<2)){for(var $=[],at=[],qt=N[0].type.replace("Multi",""),he=0;he<N.length;he++){var me=N[he];if(me.type.replace("Multi","")!==qt)return;me.type.includes("Multi")?me.getCoordinates().forEach(function(qe){$.push(qe)}):$.push(me.getCoordinates()),at.push(me.toGeoJSON())}if(at.length>1){var jt=this.newFeature({type:ee.FEATURE,properties:at[0].properties,geometry:{type:"Multi"+qt,coordinates:$}});this.addFeature(jt),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([jt.id]),this.map.fire(an.COMBINE_FEATURES,{createdFeatures:[jt.toGeoJSON()],deletedFeatures:at})}this.fireActionable()}},wi.onUncombineFeatures=function(){var N=this,$=this.getSelected();if(0!==$.length){for(var at=[],qt=[],he=function(jt){var qe=$[jt];N.isInstanceOf("MultiFeature",qe)&&(qe.getFeatures().forEach(function(_n){N.addFeature(_n),_n.properties=qe.properties,at.push(_n.toGeoJSON()),N.select([_n.id])}),N.deleteFeature(qe.id,{silent:!0}),qt.push(qe.toGeoJSON()))},me=0;me<$.length;me++)he(me);at.length>1&&this.map.fire(an.UNCOMBINE_FEATURES,{createdFeatures:at,deletedFeatures:qt}),this.fireActionable()}};var jl=rn(mt.VERTEX),pl=rn(mt.MIDPOINT),Os={fireUpdate:function(){this.map.fire(an.UPDATE,{action:pt.CHANGE_COORDINATES,features:this.getSelected().map(function(N){return N.toGeoJSON()})})},fireActionable:function(N){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:N.selectedCoordPaths.length>0})},startDragging:function(N,$){this.map.dragPan.disable(),N.canDragMove=!0,N.dragMoveLocation=$.lngLat},stopDragging:function(N){this.map.dragPan.enable(),N.dragMoving=!1,N.canDragMove=!1,N.dragMoveLocation=null},onVertex:function(N,$){this.startDragging(N,$);var at=$.featureTarget.properties,qt=N.selectedCoordPaths.indexOf(at.coord_path);Nn($)||-1!==qt?Nn($)&&-1===qt&&N.selectedCoordPaths.push(at.coord_path):N.selectedCoordPaths=[at.coord_path];var he=this.pathsToCoordinates(N.featureId,N.selectedCoordPaths);this.setSelectedCoordinates(he)},onMidpoint:function(N,$){this.startDragging(N,$);var at=$.featureTarget.properties;N.feature.addCoordinate(at.coord_path,at.lng,at.lat),this.fireUpdate(),N.selectedCoordPaths=[at.coord_path]},pathsToCoordinates:function(N,$){return $.map(function(at){return{feature_id:N,coord_path:at}})},onFeature:function(N,$){0===N.selectedCoordPaths.length?this.startDragging(N,$):this.stopDragging(N)},dragFeature:function(N,$,at){Ja(this.getSelected(),at),N.dragMoveLocation=$.lngLat},dragVertex:function(N,$,at){for(var qt=N.selectedCoordPaths.map(function(qe){return N.feature.getCoordinate(qe)}),he=ga(qt.map(function(qe){return{type:ee.FEATURE,properties:{},geometry:{type:ee.POINT,coordinates:qe}}}),at),me=0;me<qt.length;me++){var jt=qt[me];N.feature.updateCoordinate(N.selectedCoordPaths[me],jt[0]+he.lng,jt[1]+he.lat)}},clickNoTarget:function(){this.changeMode(_e.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(_e.SIMPLE_SELECT)},clickActiveFeature:function(N){N.selectedCoordPaths=[],this.clearSelectedCoordinates(),N.feature.changed()},onSetup:function(N){var $=N.featureId,at=this.getFeature($);if(!at)throw new Error("You must provide a featureId to enter direct_select mode");if(at.type===ee.POINT)throw new TypeError("direct_select mode doesn't handle point features");var qt={featureId:$,feature:at,dragMoveLocation:N.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:N.coordPath?[N.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates($,qt.selectedCoordPaths)),this.setSelected($),Je.disable(this),this.setActionableState({trash:!0}),qt},onStop:function(){Je.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(N,$,at){N.featureId===$.properties.id?($.properties.active=ot.ACTIVE,at($),Ye($,{map:this.map,midpoints:!0,selectedPaths:N.selectedCoordPaths}).forEach(at)):($.properties.active=ot.INACTIVE,at($)),this.fireActionable(N)},onTrash:function(N){N.selectedCoordPaths.sort(function($,at){return at.localeCompare($,"en",{numeric:!0})}).forEach(function($){return N.feature.removeCoordinate($)}),this.fireUpdate(),N.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(N),!1===N.feature.isValid()&&(this.deleteFeature([N.featureId]),this.changeMode(_e.SIMPLE_SELECT,{}))},onMouseMove:function(N,$){var at=jn($),qt=jl($),he=pl($),me=0===N.selectedCoordPaths.length;return this.updateUIClasses(at&&me||qt&&!me?{mouse:Be.MOVE}:{mouse:Be.NONE}),(qt||at||he)&&N.dragMoving&&this.fireUpdate(),this.stopDragging(N),!0},onMouseOut:function(N){return N.dragMoving&&this.fireUpdate(),!0}};Os.onTouchStart=Os.onMouseDown=function(N,$){return jl($)?this.onVertex(N,$):jn($)?this.onFeature(N,$):pl($)?this.onMidpoint(N,$):void 0},Os.onDrag=function(N,$){if(!0===N.canDragMove){N.dragMoving=!0,$.originalEvent.stopPropagation();var at={lng:$.lngLat.lng-N.dragMoveLocation.lng,lat:$.lngLat.lat-N.dragMoveLocation.lat};N.selectedCoordPaths.length>0?this.dragVertex(N,$,at):this.dragFeature(N,$,at),N.dragMoveLocation=$.lngLat}},Os.onClick=function(N,$){return mn($)?this.clickNoTarget(N,$):jn($)?this.clickActiveFeature(N,$):Sn($)?this.clickInactive(N,$):void this.stopDragging(N)},Os.onTap=function(N,$){return mn($)?this.clickNoTarget(N,$):jn($)?this.clickActiveFeature(N,$):Sn($)?this.clickInactive(N,$):void 0},Os.onTouchEnd=Os.onMouseUp=function(N){N.dragMoving&&this.fireUpdate(),this.stopDragging(N)};var ms={};function gc(N,$){return!!N.lngLat&&N.lngLat.lng===$[0]&&N.lngLat.lat===$[1]}ms.onSetup=function(){var N=this.newFeature({type:ee.FEATURE,properties:{},geometry:{type:ee.POINT,coordinates:[]}});return this.addFeature(N),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Be.ADD}),this.activateUIButton(Ce.POINT),this.setActionableState({trash:!0}),{point:N}},ms.stopDrawingAndRemove=function(N){this.deleteFeature([N.point.id],{silent:!0}),this.changeMode(_e.SIMPLE_SELECT)},ms.onTap=ms.onClick=function(N,$){this.updateUIClasses({mouse:Be.MOVE}),N.point.updateCoordinate("",$.lngLat.lng,$.lngLat.lat),this.map.fire(an.CREATE,{features:[N.point.toGeoJSON()]}),this.changeMode(_e.SIMPLE_SELECT,{featureIds:[N.point.id]})},ms.onStop=function(N){this.activateUIButton(),N.point.getCoordinate().length||this.deleteFeature([N.point.id],{silent:!0})},ms.toDisplayFeatures=function(N,$,at){var qt=$.properties.id===N.point.id;if($.properties.active=qt?ot.ACTIVE:ot.INACTIVE,!qt)return at($)},ms.onTrash=ms.stopDrawingAndRemove,ms.onKeyUp=function(N,$){if(Hr($)||fe($))return this.stopDrawingAndRemove(N,$)};var Vl={onSetup:function(){var N=this.newFeature({type:ee.FEATURE,properties:{},geometry:{type:ee.POLYGON,coordinates:[[]]}});return this.addFeature(N),this.clearSelectedFeatures(),Je.disable(this),this.updateUIClasses({mouse:Be.ADD}),this.activateUIButton(Ce.POLYGON),this.setActionableState({trash:!0}),{polygon:N,currentVertexPosition:0}},clickAnywhere:function(N,$){if(N.currentVertexPosition>0&&gc($,N.polygon.coordinates[0][N.currentVertexPosition-1]))return this.changeMode(_e.SIMPLE_SELECT,{featureIds:[N.polygon.id]});this.updateUIClasses({mouse:Be.ADD}),N.polygon.updateCoordinate("0."+N.currentVertexPosition,$.lngLat.lng,$.lngLat.lat),N.currentVertexPosition++,N.polygon.updateCoordinate("0."+N.currentVertexPosition,$.lngLat.lng,$.lngLat.lat)},clickOnVertex:function(N){return this.changeMode(_e.SIMPLE_SELECT,{featureIds:[N.polygon.id]})},onMouseMove:function(N,$){N.polygon.updateCoordinate("0."+N.currentVertexPosition,$.lngLat.lng,$.lngLat.lat),Zi($)&&this.updateUIClasses({mouse:Be.POINTER})}};Vl.onTap=Vl.onClick=function(N,$){return Zi($)?this.clickOnVertex(N,$):this.clickAnywhere(N,$)},Vl.onKeyUp=function(N,$){Hr($)?(this.deleteFeature([N.polygon.id],{silent:!0}),this.changeMode(_e.SIMPLE_SELECT)):fe($)&&this.changeMode(_e.SIMPLE_SELECT,{featureIds:[N.polygon.id]})},Vl.onStop=function(N){this.updateUIClasses({mouse:Be.NONE}),Je.enable(this),this.activateUIButton(),void 0!==this.getFeature(N.polygon.id)&&(N.polygon.removeCoordinate("0."+N.currentVertexPosition),N.polygon.isValid()?this.map.fire(an.CREATE,{features:[N.polygon.toGeoJSON()]}):(this.deleteFeature([N.polygon.id],{silent:!0}),this.changeMode(_e.SIMPLE_SELECT,{},{silent:!0})))},Vl.toDisplayFeatures=function(N,$,at){var qt=$.properties.id===N.polygon.id;if($.properties.active=qt?ot.ACTIVE:ot.INACTIVE,!qt)return at($);if(0!==$.geometry.coordinates.length){var he=$.geometry.coordinates[0].length;if(!(he<3)){if($.properties.meta=mt.FEATURE,at(Ue(N.polygon.id,$.geometry.coordinates[0][0],"0.0",!1)),he>3){var me=$.geometry.coordinates[0].length-3;at(Ue(N.polygon.id,$.geometry.coordinates[0][me],"0."+me,!1))}if(he<=4&&(at({type:ee.FEATURE,properties:$.properties,geometry:{coordinates:[[$.geometry.coordinates[0][0][0],$.geometry.coordinates[0][0][1]],[$.geometry.coordinates[0][1][0],$.geometry.coordinates[0][1][1]]],type:ee.LINE_STRING}}),3===he))return;return at($)}}},Vl.onTrash=function(N){this.deleteFeature([N.polygon.id],{silent:!0}),this.changeMode(_e.SIMPLE_SELECT)};var Ml={onSetup:function(N){var $,at,qt=(N=N||{}).featureId,he="forward";if(qt){if(!($=this.getFeature(qt)))throw new Error("Could not find a feature with the provided featureId");var me=N.from;if(me&&"Feature"===me.type&&me.geometry&&"Point"===me.geometry.type&&(me=me.geometry),me&&"Point"===me.type&&me.coordinates&&2===me.coordinates.length&&(me=me.coordinates),!me||!Array.isArray(me))throw new Error("Please use the `from` property to indicate which point to continue the line from");var jt=$.coordinates.length-1;if($.coordinates[jt][0]===me[0]&&$.coordinates[jt][1]===me[1])$.addCoordinate.apply($,[at=jt+1].concat($.coordinates[jt]));else{if($.coordinates[0][0]!==me[0]||$.coordinates[0][1]!==me[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");he="backwards",$.addCoordinate.apply($,[at=0].concat($.coordinates[0]))}}else $=this.newFeature({type:ee.FEATURE,properties:{},geometry:{type:ee.LINE_STRING,coordinates:[]}}),at=0,this.addFeature($);return this.clearSelectedFeatures(),Je.disable(this),this.updateUIClasses({mouse:Be.ADD}),this.activateUIButton(Ce.LINE),this.setActionableState({trash:!0}),{line:$,currentVertexPosition:at,direction:he}},clickAnywhere:function(N,$){if(N.currentVertexPosition>0&&gc($,N.line.coordinates[N.currentVertexPosition-1])||"backwards"===N.direction&&gc($,N.line.coordinates[N.currentVertexPosition+1]))return this.changeMode(_e.SIMPLE_SELECT,{featureIds:[N.line.id]});this.updateUIClasses({mouse:Be.ADD}),N.line.updateCoordinate(N.currentVertexPosition,$.lngLat.lng,$.lngLat.lat),"forward"===N.direction?(N.currentVertexPosition++,N.line.updateCoordinate(N.currentVertexPosition,$.lngLat.lng,$.lngLat.lat)):N.line.addCoordinate(0,$.lngLat.lng,$.lngLat.lat)},clickOnVertex:function(N){return this.changeMode(_e.SIMPLE_SELECT,{featureIds:[N.line.id]})},onMouseMove:function(N,$){N.line.updateCoordinate(N.currentVertexPosition,$.lngLat.lng,$.lngLat.lat),Zi($)&&this.updateUIClasses({mouse:Be.POINTER})}};Ml.onTap=Ml.onClick=function(N,$){if(Zi($))return this.clickOnVertex(N,$);this.clickAnywhere(N,$)},Ml.onKeyUp=function(N,$){fe($)?this.changeMode(_e.SIMPLE_SELECT,{featureIds:[N.line.id]}):Hr($)&&(this.deleteFeature([N.line.id],{silent:!0}),this.changeMode(_e.SIMPLE_SELECT))},Ml.onStop=function(N){Je.enable(this),this.activateUIButton(),void 0!==this.getFeature(N.line.id)&&(N.line.removeCoordinate(""+N.currentVertexPosition),N.line.isValid()?this.map.fire(an.CREATE,{features:[N.line.toGeoJSON()]}):(this.deleteFeature([N.line.id],{silent:!0}),this.changeMode(_e.SIMPLE_SELECT,{},{silent:!0})))},Ml.onTrash=function(N){this.deleteFeature([N.line.id],{silent:!0}),this.changeMode(_e.SIMPLE_SELECT)},Ml.toDisplayFeatures=function(N,$,at){var qt=$.properties.id===N.line.id;if($.properties.active=qt?ot.ACTIVE:ot.INACTIVE,!qt)return at($);$.geometry.coordinates.length<2||($.properties.meta=mt.FEATURE,at(Ue(N.line.id,$.geometry.coordinates["forward"===N.direction?$.geometry.coordinates.length-2:1],""+("forward"===N.direction?$.geometry.coordinates.length-2:1),!1)),at($))};var _c={simple_select:wi,direct_select:Os,draw_point:ms,draw_polygon:Vl,draw_line_string:Ml},Yo={defaultMode:_e.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:gn,modes:_c,controls:{},userProperties:!1},ef={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},ml={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Qu(N,$){return N.map(function(at){return at.source?at:Ve(at,{id:at.id+"."+$,source:"hot"===$?Me.HOT:Me.COLD})})}var Hc={exports:{}};!function(N,$){var at="__lodash_hash_undefined__",qt=9007199254740991,he="[object Arguments]",me="[object Array]",jt="[object Boolean]",qe="[object Date]",_n="[object Error]",Dn="[object Function]",Vn="[object Map]",bn="[object Number]",Ke="[object Object]",Se="[object Promise]",Oe="[object RegExp]",Qn="[object Set]",It="[object String]",Pi="[object WeakMap]",Mi="[object ArrayBuffer]",zn="[object DataView]",Qa=/^\[object .+?Constructor\]$/,ia=/^(?:0|[1-9]\d*)$/,Gi={};Gi["[object Float32Array]"]=Gi["[object Float64Array]"]=Gi["[object Int8Array]"]=Gi["[object Int16Array]"]=Gi["[object Int32Array]"]=Gi["[object Uint8Array]"]=Gi["[object Uint8ClampedArray]"]=Gi["[object Uint16Array]"]=Gi["[object Uint32Array]"]=!0,Gi[he]=Gi[me]=Gi[Mi]=Gi[jt]=Gi[zn]=Gi[qe]=Gi[_n]=Gi[Dn]=Gi[Vn]=Gi[bn]=Gi[Ke]=Gi[Oe]=Gi[Qn]=Gi[It]=Gi[Pi]=!1;var za="object"==typeof global&&global&&global.Object===Object&&global,us="object"==typeof self&&self&&self.Object===Object&&self,Jo=za||us||Function("return this")(),In=$&&!$.nodeType&&$,Cr=In&&N&&!N.nodeType&&N,Nr=Cr&&Cr.exports===In,Vs=Nr&&za.process,_l=function(){try{return Vs&&Vs.binding&&Vs.binding("util")}catch{}}(),sr=_l&&_l.isTypedArray;function Ma(Ee,Xe){for(var $t=-1,Zn=null==Ee?0:Ee.length;++$t<Zn;)if(Xe(Ee[$t],$t,Ee))return!0;return!1}function ur(Ee){var Xe=-1,$t=Array(Ee.size);return Ee.forEach(function(Zn,Xi){$t[++Xe]=[Xi,Zn]}),$t}function ns(Ee){var Xe=-1,$t=Array(Ee.size);return Ee.forEach(function(Zn){$t[++Xe]=Zn}),$t}var Wi,rs,Ko,Cu=Array.prototype,Tl=Object.prototype,Ys=Jo["__core-js_shared__"],Dl=Function.prototype.toString,No=Tl.hasOwnProperty,yl=(Wi=/[^.]+$/.exec(Ys&&Ys.keys&&Ys.keys.IE_PROTO||""))?"Symbol(src)_1."+Wi:"",_a=Tl.toString,Su=RegExp("^"+Dl.call(No).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ei=Nr?Jo.Buffer:void 0,pn=Jo.Symbol,Ti=Jo.Uint8Array,ou=Tl.propertyIsEnumerable,Fo=Cu.splice,gi=pn?pn.toStringTag:void 0,Gl=Object.getOwnPropertySymbols,Mu=Ei?Ei.isBuffer:void 0,Zr=(rs=Object.keys,Ko=Object,function(Ee){return rs(Ko(Ee))}),yc=cs(Jo,"DataView"),_i=cs(Jo,"Map"),dr=cs(Jo,"Promise"),qr=cs(Jo,"Set"),ql=cs(Jo,"WeakMap"),Rs=cs(Object,"create"),Al=Tu(yc),ii=Tu(_i),vl=Tu(dr),ar=Tu(qr),nf=Tu(ql),oa=pn?pn.prototype:void 0,tl=oa?oa.valueOf:void 0;function vc(Ee){var Xe=-1,$t=null==Ee?0:Ee.length;for(this.clear();++Xe<$t;){var Zn=Ee[Xe];this.set(Zn[0],Zn[1])}}function Gs(Ee){var Xe=-1,$t=null==Ee?0:Ee.length;for(this.clear();++Xe<$t;){var Zn=Ee[Xe];this.set(Zn[0],Zn[1])}}function Ur(Ee){var Xe=-1,$t=null==Ee?0:Ee.length;for(this.clear();++Xe<$t;){var Zn=Ee[Xe];this.set(Zn[0],Zn[1])}}function Js(Ee){var Xe=-1,$t=null==Ee?0:Ee.length;for(this.__data__=new Ur;++Xe<$t;)this.add(Ee[Xe])}function Ns(Ee){var Xe=this.__data__=new Gs(Ee);this.size=Xe.size}function sa(Ee,Xe){for(var $t=Ee.length;$t--;)if(Eh(Ee[$t][0],Xe))return $t;return-1}function Ms(Ee){return null==Ee?void 0===Ee?"[object Undefined]":"[object Null]":gi&&gi in Object(Ee)?function(Xe){var $t=No.call(Xe,gi),Zn=Xe[gi];try{Xe[gi]=void 0;var Xi=!0}catch{}var Mr=_a.call(Xe);return Xi&&($t?Xe[gi]=Zn:delete Xe[gi]),Mr}(Ee):_a.call(Ee)}function xc(Ee){return wl(Ee)&&Ms(Ee)==he}function bc(Ee,Xe,$t,Zn,Xi){return Ee===Xe||(null==Ee||null==Xe||!wl(Ee)&&!wl(Xe)?Ee!=Ee&&Xe!=Xe:function(Mr,Yi,Ji,Fs,ts,to){var As=Ta(Mr),eo=Ta(Yi),Go=As?me:qs(Mr),Bi=eo?me:qs(Yi),tc=(Go=Go==he?Ke:Go)==Ke,nl=(Bi=Bi==he?Ke:Bi)==Ke,rl=Go==Bi;if(rl&&gs(Mr)){if(!gs(Yi))return!1;As=!0,tc=!1}if(rl&&!tc)return to||(to=new Ns),As||lu(Mr)?Kr(Mr,Yi,Ji,Fs,ts,to):function(ko,qi,Ua,_s,Zc,no,il){switch(Ua){case zn:if(ko.byteLength!=qi.byteLength||ko.byteOffset!=qi.byteOffset)return!1;ko=ko.buffer,qi=qi.buffer;case Mi:return!(ko.byteLength!=qi.byteLength||!no(new Ti(ko),new Ti(qi)));case jt:case qe:case bn:return Eh(+ko,+qi);case _n:return ko.name==qi.name&&ko.message==qi.message;case Oe:case It:return ko==qi+"";case Vn:var hs=ur;case Qn:if(hs||(hs=ns),ko.size!=qi.size&&!(1&_s))return!1;var aa=il.get(ko);if(aa)return aa==qi;_s|=2,il.set(ko,qi);var $o=Kr(hs(ko),hs(qi),_s,Zc,no,il);return il.delete(ko),$o;case"[object Symbol]":if(tl)return tl.call(ko)==tl.call(qi)}return!1}(Mr,Yi,Go,Ji,Fs,ts,to);if(!(1&Ji)){var Ts=tc&&No.call(Mr,"__wrapped__"),ta=nl&&No.call(Yi,"__wrapped__");if(Ts||ta){var Pl=Ts?Mr.value():Mr,Ba=ta?Yi.value():Yi;return to||(to=new Ns),ts(Pl,Ba,Ji,Fs,to)}}return!!rl&&(to||(to=new Ns),function(ko,qi,Ua,_s,Zc,no){var il=1&Ua,hs=ya(ko),qo=hs.length;if(qo!=ya(qi).length&&!il)return!1;for(var $o=qo;$o--;){var zo=hs[$o];if(!(il?zo in qi:No.call(qi,zo)))return!1}var Wr=no.get(ko);if(Wr&&no.get(qi))return Wr==qi;var Oo=!0;no.set(ko,qi),no.set(qi,ko);for(var $i=il;++$o<qo;){var la=ko[zo=hs[$o]],yi=qi[zo];if(_s)var Ch=il?_s(yi,la,zo,qi,ko,no):_s(la,yi,zo,ko,qi,no);if(!(void 0===Ch?la===yi||Zc(la,yi,Ua,_s,no):Ch)){Oo=!1;break}$i||($i="constructor"==zo)}if(Oo&&!$i){var ec=ko.constructor,is=qi.constructor;ec==is||!("constructor"in ko)||!("constructor"in qi)||"function"==typeof ec&&ec instanceof ec&&"function"==typeof is&&is instanceof is||(Oo=!1)}return no.delete(ko),no.delete(qi),Oo}(Mr,Yi,Ji,Fs,ts,to))}(Ee,Xe,$t,Zn,bc,Xi))}function Kr(Ee,Xe,$t,Zn,Xi,Mr){var Yi=1&$t,Ji=Ee.length,Fs=Xe.length;if(Ji!=Fs&&!(Yi&&Fs>Ji))return!1;var ts=Mr.get(Ee);if(ts&&Mr.get(Xe))return ts==Xe;var to=-1,As=!0,eo=2&$t?new Js:void 0;for(Mr.set(Ee,Xe),Mr.set(Xe,Ee);++to<Ji;){var Go=Ee[to],Bi=Xe[to];if(Zn)var tc=Yi?Zn(Bi,Go,to,Xe,Ee,Mr):Zn(Go,Bi,to,Ee,Xe,Mr);if(void 0!==tc){if(tc)continue;As=!1;break}if(eo){if(!Ma(Xe,function(nl,rl){if(!eo.has(rl)&&(Go===nl||Xi(Go,nl,$t,Zn,Mr)))return eo.push(rl)})){As=!1;break}}else if(Go!==Bi&&!Xi(Go,Bi,$t,Zn,Mr)){As=!1;break}}return Mr.delete(Ee),Mr.delete(Xe),As}function ya(Ee){return Zn=su,Xi=function Ih(Ee){return null!=(Xe=Ee)&&Vr(Xe.length)&&!bl(Xe)?function el(Ee,Xe){var $t=Ta(Ee),Zn=!$t&&Qo(Ee),Xi=!$t&&!Zn&&gs(Ee),Mr=!$t&&!Zn&&!Xi&&lu(Ee),Yi=$t||Zn||Xi||Mr,Ji=Yi?function(to,As){for(var eo=-1,Go=Array(to);++eo<to;)Go[eo]=As(eo);return Go}(Ee.length,String):[],Fs=Ji.length;for(var ts in Ee)!Xe&&!No.call(Ee,ts)||Yi&&("length"==ts||Xi&&("offset"==ts||"parent"==ts)||Mr&&("buffer"==ts||"byteLength"==ts||"byteOffset"==ts)||Qs(ts,Fs))||Ji.push(ts);return Ji}(Ee):function xl(Ee){if($t=(Xe=Ee)&&Xe.constructor,Xe!==("function"==typeof $t&&$t.prototype||Tl))return Zr(Ee);var Xe,$t,Xi=[];for(var Mr in Object(Ee))No.call(Ee,Mr)&&"constructor"!=Mr&&Xi.push(Mr);return Xi}(Ee);var Xe}(Xe=Ee),Ta(Xe)?Xi:function(Mr,Yi){for(var Ji=-1,Fs=Yi.length,ts=Mr.length;++Ji<Fs;)Mr[ts+Ji]=Yi[Ji];return Mr}(Xi,Zn(Xe));var Xe,Zn,Xi}function mi(Ee,Xe){var $t,Zn,Xi=Ee.__data__;return("string"==(Zn=typeof($t=Xe))||"number"==Zn||"symbol"==Zn||"boolean"==Zn?"__proto__"!==$t:null===$t)?Xi["string"==typeof Xe?"string":"hash"]:Xi.map}function cs(Ee,Xe){var Zn,Xi,$t=(Zn=Ee,Xi=Xe,Zn?.[Xi]);return function Ks(Ee){return!(!au(Ee)||(Xe=Ee,yl&&yl in Xe))&&(bl(Ee)?Su:Qa).test(Tu(Ee));var Xe}($t)?$t:void 0}vc.prototype.clear=function(){this.__data__=Rs?Rs(null):{},this.size=0},vc.prototype.delete=function(Ee){var Xe=this.has(Ee)&&delete this.__data__[Ee];return this.size-=Xe?1:0,Xe},vc.prototype.get=function(Ee){var Xe=this.__data__;if(Rs){var $t=Xe[Ee];return $t===at?void 0:$t}return No.call(Xe,Ee)?Xe[Ee]:void 0},vc.prototype.has=function(Ee){var Xe=this.__data__;return Rs?void 0!==Xe[Ee]:No.call(Xe,Ee)},vc.prototype.set=function(Ee,Xe){var $t=this.__data__;return this.size+=this.has(Ee)?0:1,$t[Ee]=Rs&&void 0===Xe?at:Xe,this},Gs.prototype.clear=function(){this.__data__=[],this.size=0},Gs.prototype.delete=function(Ee){var Xe=this.__data__,$t=sa(Xe,Ee);return!($t<0||($t==Xe.length-1?Xe.pop():Fo.call(Xe,$t,1),--this.size,0))},Gs.prototype.get=function(Ee){var Xe=this.__data__,$t=sa(Xe,Ee);return $t<0?void 0:Xe[$t][1]},Gs.prototype.has=function(Ee){return sa(this.__data__,Ee)>-1},Gs.prototype.set=function(Ee,Xe){var $t=this.__data__,Zn=sa($t,Ee);return Zn<0?(++this.size,$t.push([Ee,Xe])):$t[Zn][1]=Xe,this},Ur.prototype.clear=function(){this.size=0,this.__data__={hash:new vc,map:new(_i||Gs),string:new vc}},Ur.prototype.delete=function(Ee){var Xe=mi(this,Ee).delete(Ee);return this.size-=Xe?1:0,Xe},Ur.prototype.get=function(Ee){return mi(this,Ee).get(Ee)},Ur.prototype.has=function(Ee){return mi(this,Ee).has(Ee)},Ur.prototype.set=function(Ee,Xe){var $t=mi(this,Ee),Zn=$t.size;return $t.set(Ee,Xe),this.size+=$t.size==Zn?0:1,this},Js.prototype.add=Js.prototype.push=function(Ee){return this.__data__.set(Ee,at),this},Js.prototype.has=function(Ee){return this.__data__.has(Ee)},Ns.prototype.clear=function(){this.__data__=new Gs,this.size=0},Ns.prototype.delete=function(Ee){var Xe=this.__data__,$t=Xe.delete(Ee);return this.size=Xe.size,$t},Ns.prototype.get=function(Ee){return this.__data__.get(Ee)},Ns.prototype.has=function(Ee){return this.__data__.has(Ee)},Ns.prototype.set=function(Ee,Xe){var $t=this.__data__;if($t instanceof Gs){var Zn=$t.__data__;if(!_i||Zn.length<199)return Zn.push([Ee,Xe]),this.size=++$t.size,this;$t=this.__data__=new Ur(Zn)}return $t.set(Ee,Xe),this.size=$t.size,this};var su=Gl?function(Ee){return null==Ee?[]:(Ee=Object(Ee),function(Xe,$t){for(var Zn=-1,Xi=null==Xe?0:Xe.length,Mr=0,Yi=[];++Zn<Xi;){var Ji=Xe[Zn];$t(Ji)&&(Yi[Mr++]=Ji)}return Yi}(Gl(Ee),function(Xe){return ou.call(Ee,Xe)}))}:function(){return[]},qs=Ms;function Qs(Ee,Xe){return!!(Xe=Xe??qt)&&("number"==typeof Ee||ia.test(Ee))&&Ee>-1&&Ee%1==0&&Ee<Xe}function Tu(Ee){if(null!=Ee){try{return Dl.call(Ee)}catch{}try{return Ee+""}catch{}}return""}function Eh(Ee,Xe){return Ee===Xe||Ee!=Ee&&Xe!=Xe}(yc&&qs(new yc(new ArrayBuffer(1)))!=zn||_i&&qs(new _i)!=Vn||dr&&qs(dr.resolve())!=Se||qr&&qs(new qr)!=Qn||ql&&qs(new ql)!=Pi)&&(qs=function(Ee){var Xe=Ms(Ee),$t=Xe==Ke?Ee.constructor:void 0,Zn=$t?Tu($t):"";if(Zn)switch(Zn){case Al:return zn;case ii:return Vn;case vl:return Se;case ar:return Qn;case nf:return Pi}return Xe});var Qo=xc(function(){return arguments}())?xc:function(Ee){return wl(Ee)&&No.call(Ee,"callee")&&!ou.call(Ee,"callee")},Ta=Array.isArray,gs=Mu||function(){return!1};function bl(Ee){if(!au(Ee))return!1;var Xe=Ms(Ee);return Xe==Dn||"[object GeneratorFunction]"==Xe||"[object AsyncFunction]"==Xe||"[object Proxy]"==Xe}function Vr(Ee){return"number"==typeof Ee&&Ee>-1&&Ee%1==0&&Ee<=qt}function au(Ee){var Xe=typeof Ee;return null!=Ee&&("object"==Xe||"function"==Xe)}function wl(Ee){return null!=Ee&&"object"==typeof Ee}var Ee,lu=sr?(Ee=sr,function(Xe){return Ee(Xe)}):function(Ee){return wl(Ee)&&Vr(Ee.length)&&!!Gi[Ms(Ee)]};N.exports=function(Ee,Xe){return bc(Ee,Xe)}}(Hc,Hc.exports);var bi=Tt(Hc.exports);function ru(N,$){return N.length===$.length&&JSON.stringify(N.map(function(at){return at}).sort())===JSON.stringify($.map(function(at){return at}).sort())}var Ka={Polygon:pe,LineString:Pe,Point:Le,MultiPolygon:On,MultiLineString:On,MultiPoint:On},or=Object.freeze({__proto__:null,CommonSelectors:W,constrainFeatureMovement:ga,createMidPoint:ke,createSupplementaryPoints:Ye,createVertex:Ue,doubleClickZoom:Je,euclideanDistance:en,featuresAt:Ht,getFeatureAtAndSetCursors:cn,isClick:Ft,isEventAtCoordinates:gc,isTap:de,mapEventToBoundingBox:J,ModeHandler:we,moveFeatures:Ja,sortFeatures:ht,stringSetsAreEqual:ru,StringSet:ue,theme:gn,toDenseArray:Er});function gl(N){!function(N,$){var he,me,at={options:N=function(he){void 0===he&&(he={});var me=Ve(he);return he.controls||(me.controls={}),me.controls=Ve(!1===he.displayControlsDefault?ml:ef,he.controls),(me=Ve(Yo,me)).styles=Qu(me.styles,"cold").concat(Qu(me.styles,"hot")),me}(N)};he=at,(me=$).modes=_e,me.getFeatureIdsAt=function(jt){return Ht.click({point:jt},null,he).map(function(qe){return qe.properties.id})},me.getSelectedIds=function(){return he.store.getSelectedIds()},me.getSelected=function(){return{type:ee.FEATURE_COLLECTION,features:he.store.getSelectedIds().map(function(jt){return he.store.get(jt)}).map(function(jt){return jt.toGeoJSON()})}},me.getSelectedPoints=function(){return{type:ee.FEATURE_COLLECTION,features:he.store.getSelectedCoordinates().map(function(jt){return{type:ee.FEATURE,properties:{},geometry:{type:ee.POINT,coordinates:jt.coordinates}}})}},me.set=function(jt){if(void 0===jt.type||jt.type!==ee.FEATURE_COLLECTION||!Array.isArray(jt.features))throw new Error("Invalid FeatureCollection");var qe=he.store.createRenderBatch(),_n=he.store.getAllIds().slice(),Dn=me.add(jt),Vn=new ue(Dn);return(_n=_n.filter(function(bn){return!Vn.has(bn)})).length&&me.delete(_n),qe(),Dn},me.add=function(jt){var qe=JSON.parse(JSON.stringify(ve(jt))).features.map(function(_n){if(_n.id=_n.id||ne(),null===_n.geometry)throw new Error("Invalid geometry: null");if(void 0===he.store.get(_n.id)||he.store.get(_n.id).type!==_n.geometry.type){var Dn=Ka[_n.geometry.type];if(void 0===Dn)throw new Error("Invalid geometry type: "+_n.geometry.type+".");var Vn=new Dn(he,_n);he.store.add(Vn)}else{var bn=he.store.get(_n.id);bn.properties=_n.properties,bi(bn.properties,_n.properties)||he.store.featureChanged(bn.id),bi(bn.getCoordinates(),_n.geometry.coordinates)||bn.incomingCoords(_n.geometry.coordinates)}return _n.id});return he.store.render(),qe},me.get=function(jt){var qe=he.store.get(jt);if(qe)return qe.toGeoJSON()},me.getAll=function(){return{type:ee.FEATURE_COLLECTION,features:he.store.getAll().map(function(jt){return jt.toGeoJSON()})}},me.delete=function(jt){return he.store.delete(jt,{silent:!0}),me.getMode()!==_e.DIRECT_SELECT||he.store.getSelectedIds().length?he.store.render():he.events.changeMode(_e.SIMPLE_SELECT,void 0,{silent:!0}),me},me.deleteAll=function(){return he.store.delete(he.store.getAllIds(),{silent:!0}),me.getMode()===_e.DIRECT_SELECT?he.events.changeMode(_e.SIMPLE_SELECT,void 0,{silent:!0}):he.store.render(),me},me.changeMode=function(jt,qe){return void 0===qe&&(qe={}),jt===_e.SIMPLE_SELECT&&me.getMode()===_e.SIMPLE_SELECT?(ru(qe.featureIds||[],he.store.getSelectedIds())||(he.store.setSelected(qe.featureIds,{silent:!0}),he.store.render()),me):(jt===_e.DIRECT_SELECT&&me.getMode()===_e.DIRECT_SELECT&&qe.featureId===he.store.getSelectedIds()[0]||he.events.changeMode(jt,qe,{silent:!0}),me)},me.getMode=function(){return he.events.getMode()},me.trash=function(){return he.events.trash({silent:!0}),me},me.combineFeatures=function(){return he.events.combineFeatures({silent:!0}),me},me.uncombineFeatures=function(){return he.events.uncombineFeatures({silent:!0}),me},me.setFeatureProperty=function(jt,qe,_n){return he.store.setFeatureProperty(jt,qe,_n),me},at.api=$=me;var qt=We(at);$.onAdd=qt.onAdd,$.onRemove=qt.onRemove,$.types=Ce,$.options=N}(N,this)}return gl.modes=_c,gl.constants=kt,gl.lib=or,gl}()},7391:(nn,we,Tt)=>{"use strict";function Ct(n){return"function"==typeof n}function Rt(n){const o=n(l=>{Error.call(l),l.stack=(new Error).stack});return o.prototype=Object.create(Error.prototype),o.prototype.constructor=o,o}const oe=Rt(n=>function(o){n(this),this.message=o?`${o.length} errors occurred during unsubscription:\n${o.map((l,h)=>`${h+1}) ${l.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=o});function Pt(n,i){if(n){const o=n.indexOf(i);0<=o&&n.splice(o,1)}}class rt{constructor(i){this.initialTeardown=i,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let i;if(!this.closed){this.closed=!0;const{_parentage:o}=this;if(o)if(this._parentage=null,Array.isArray(o))for(const m of o)m.remove(this);else o.remove(this);const{initialTeardown:l}=this;if(Ct(l))try{l()}catch(m){i=m instanceof oe?m.errors:[m]}const{_finalizers:h}=this;if(h){this._finalizers=null;for(const m of h)try{Yt(m)}catch(_){i=i??[],_ instanceof oe?i=[...i,..._.errors]:i.push(_)}}if(i)throw new oe(i)}}add(i){var o;if(i&&i!==this)if(this.closed)Yt(i);else{if(i instanceof rt){if(i.closed||i._hasParent(this))return;i._addParent(this)}(this._finalizers=null!==(o=this._finalizers)&&void 0!==o?o:[]).push(i)}}_hasParent(i){const{_parentage:o}=this;return o===i||Array.isArray(o)&&o.includes(i)}_addParent(i){const{_parentage:o}=this;this._parentage=Array.isArray(o)?(o.push(i),o):o?[o,i]:i}_removeParent(i){const{_parentage:o}=this;o===i?this._parentage=null:Array.isArray(o)&&Pt(o,i)}remove(i){const{_finalizers:o}=this;o&&Pt(o,i),i instanceof rt&&i._removeParent(this)}}rt.EMPTY=(()=>{const n=new rt;return n.closed=!0,n})();const zt=rt.EMPTY;function ie(n){return n instanceof rt||n&&"closed"in n&&Ct(n.remove)&&Ct(n.add)&&Ct(n.unsubscribe)}function Yt(n){Ct(n)?n():n.unsubscribe()}const Me={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Be={setTimeout(n,i,...o){const{delegate:l}=Be;return l?.setTimeout?l.setTimeout(n,i,...o):setTimeout(n,i,...o)},clearTimeout(n){const{delegate:i}=Be;return(i?.clearTimeout||clearTimeout)(n)},delegate:void 0};function Ce(n){Be.setTimeout(()=>{const{onUnhandledError:i}=Me;if(!i)throw n;i(n)})}function ee(){}const _e=mt("C",void 0,void 0);function mt(n,i,o){return{kind:n,value:i,error:o}}let ot=null;function gt(n){if(Me.useDeprecatedSynchronousErrorHandling){const i=!ot;if(i&&(ot={errorThrown:!1,error:null}),n(),i){const{errorThrown:o,error:l}=ot;if(ot=null,o)throw l}}else n()}class kt extends rt{constructor(i){super(),this.isStopped=!1,i?(this.destination=i,ie(i)&&i.add(this)):this.destination=Et}static create(i,o,l){return new J(i,o,l)}next(i){this.isStopped?Ht(function pt(n){return mt("N",n,void 0)}(i),this):this._next(i)}error(i){this.isStopped?Ht(function an(n){return mt("E",void 0,n)}(i),this):(this.isStopped=!0,this._error(i))}complete(){this.isStopped?Ht(_e,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(i){this.destination.next(i)}_error(i){try{this.destination.error(i)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const ut=Function.prototype.bind;function H(n,i){return ut.call(n,i)}class ht{constructor(i){this.partialObserver=i}next(i){const{partialObserver:o}=this;if(o.next)try{o.next(i)}catch(l){ue(l)}}error(i){const{partialObserver:o}=this;if(o.error)try{o.error(i)}catch(l){ue(l)}else ue(i)}complete(){const{partialObserver:i}=this;if(i.complete)try{i.complete()}catch(o){ue(o)}}}class J extends kt{constructor(i,o,l){let h;if(super(),Ct(i)||!i)h={next:i??void 0,error:o??void 0,complete:l??void 0};else{let m;this&&Me.useDeprecatedNextContext?(m=Object.create(i),m.unsubscribe=()=>this.unsubscribe(),h={next:i.next&&H(i.next,m),error:i.error&&H(i.error,m),complete:i.complete&&H(i.complete,m)}):h=i}this.destination=new ht(h)}}function ue(n){Me.useDeprecatedSynchronousErrorHandling?function ct(n){Me.useDeprecatedSynchronousErrorHandling&&ot&&(ot.errorThrown=!0,ot.error=n)}(n):Ce(n)}function Ht(n,i){const{onStoppedNotification:o}=Me;o&&Be.setTimeout(()=>o(n,i))}const Et={closed:!0,next:ee,error:function St(n){throw n},complete:ee},cn="function"==typeof Symbol&&Symbol.observable||"@@observable";function en(n){return n}let Vt=(()=>{class n{constructor(o){o&&(this._subscribe=o)}lift(o){const l=new n;return l.source=this,l.operator=o,l}subscribe(o,l,h){const m=function wt(n){return n&&n instanceof kt||function ne(n){return n&&Ct(n.next)&&Ct(n.error)&&Ct(n.complete)}(n)&&ie(n)}(o)?o:new J(o,l,h);return gt(()=>{const{operator:_,source:b}=this;m.add(_?_.call(m,b):b?this._subscribe(m):this._trySubscribe(m))}),m}_trySubscribe(o){try{return this._subscribe(o)}catch(l){o.error(l)}}forEach(o,l){return new(l=At(l))((h,m)=>{const _=new J({next:b=>{try{o(b)}catch(I){m(I),_.unsubscribe()}},error:m,complete:h});this.subscribe(_)})}_subscribe(o){var l;return null===(l=this.source)||void 0===l?void 0:l.subscribe(o)}[cn](){return this}pipe(...o){return function de(n){return 0===n.length?en:1===n.length?n[0]:function(o){return n.reduce((l,h)=>h(l),o)}}(o)(this)}toPromise(o){return new(o=At(o))((l,h)=>{let m;this.subscribe(_=>m=_,_=>h(_),()=>l(m))})}}return n.create=i=>new n(i),n})();function At(n){var i;return null!==(i=n??Me.Promise)&&void 0!==i?i:Promise}const Le=Rt(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Pe=(()=>{class n extends Vt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(o){const l=new pe(this,this);return l.operator=o,l}_throwIfClosed(){if(this.closed)throw new Le}next(o){gt(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const l of this.currentObservers)l.next(o)}})}error(o){gt(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=o;const{observers:l}=this;for(;l.length;)l.shift().error(o)}})}complete(){gt(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:o}=this;for(;o.length;)o.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var o;return(null===(o=this.observers)||void 0===o?void 0:o.length)>0}_trySubscribe(o){return this._throwIfClosed(),super._trySubscribe(o)}_subscribe(o){return this._throwIfClosed(),this._checkFinalizedStatuses(o),this._innerSubscribe(o)}_innerSubscribe(o){const{hasError:l,isStopped:h,observers:m}=this;return l||h?zt:(this.currentObservers=null,m.push(o),new rt(()=>{this.currentObservers=null,Pt(m,o)}))}_checkFinalizedStatuses(o){const{hasError:l,thrownError:h,isStopped:m}=this;l?o.error(h):m&&o.complete()}asObservable(){const o=new Vt;return o.source=this,o}}return n.create=(i,o)=>new pe(i,o),n})();class pe extends Pe{constructor(i,o){super(),this.destination=i,this.source=o}next(i){var o,l;null===(l=null===(o=this.destination)||void 0===o?void 0:o.next)||void 0===l||l.call(o,i)}error(i){var o,l;null===(l=null===(o=this.destination)||void 0===o?void 0:o.error)||void 0===l||l.call(o,i)}complete(){var i,o;null===(o=null===(i=this.destination)||void 0===i?void 0:i.complete)||void 0===o||o.call(i)}_subscribe(i){var o,l;return null!==(l=null===(o=this.source)||void 0===o?void 0:o.subscribe(i))&&void 0!==l?l:zt}}function Ln(n){return i=>{if(function Fe(n){return Ct(n?.lift)}(i))return i.lift(function(o){try{return n(o,this)}catch(l){this.error(l)}});throw new TypeError("Unable to lift unknown Observable type")}}function On(n,i,o,l,h){return new yn(n,i,o,l,h)}class yn extends kt{constructor(i,o,l,h,m,_){super(i),this.onFinalize=m,this.shouldUnsubscribe=_,this._next=o?function(b){try{o(b)}catch(I){i.error(I)}}:super._next,this._error=h?function(b){try{h(b)}catch(I){i.error(I)}finally{this.unsubscribe()}}:super._error,this._complete=l?function(){try{l()}catch(b){i.error(b)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var i;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:o}=this;super.unsubscribe(),!o&&(null===(i=this.onFinalize)||void 0===i||i.call(this))}}}function Hr(n){return this instanceof Hr?(this.v=n,this):new Hr(n)}function nt(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,i=n[Symbol.asyncIterator];return i?i.call(n):(n=function Sn(n){var i="function"==typeof Symbol&&Symbol.iterator,o=i&&n[i],l=0;if(o)return o.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&l>=n.length&&(n=void 0),{value:n&&n[l++],done:!n}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),o={},l("next"),l("throw"),l("return"),o[Symbol.asyncIterator]=function(){return this},o);function l(m){o[m]=n[m]&&function(_){return new Promise(function(b,I){!function h(m,_,b,I){Promise.resolve(I).then(function(C){m({value:C,done:b})},_)}(b,I,(_=n[m](_)).done,_.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const ye=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function je(n){return Ct(n?.then)}function tn(n){return Ct(n[cn])}function Ge(n){return Symbol.asyncIterator&&Ct(n?.[Symbol.asyncIterator])}function dn(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Tn=function fn(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Ir(n){return Ct(n?.[Tn])}function En(n){return function fe(n,i,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var h,l=o.apply(n,i||[]),m=[];return h={},_("next"),_("throw"),_("return"),h[Symbol.asyncIterator]=function(){return this},h;function _(F){l[F]&&(h[F]=function(z){return new Promise(function(tt,Y){m.push([F,z,tt,Y])>1||b(F,z)})})}function b(F,z){try{!function I(F){F.value instanceof Hr?Promise.resolve(F.value.v).then(C,A):L(m[0][2],F)}(l[F](z))}catch(tt){L(m[0][3],tt)}}function C(F){b("next",F)}function A(F){b("throw",F)}function L(F,z){F(z),m.shift(),m.length&&b(m[0][0],m[0][1])}}(this,arguments,function*(){const o=n.getReader();try{for(;;){const{value:l,done:h}=yield Hr(o.read());if(h)return yield Hr(void 0);yield yield Hr(l)}}finally{o.releaseLock()}})}function gr(n){return Ct(n?.getReader)}function mr(n){if(n instanceof Vt)return n;if(null!=n){if(tn(n))return function ei(n){return new Vt(i=>{const o=n[cn]();if(Ct(o.subscribe))return o.subscribe(i);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(ye(n))return function Kn(n){return new Vt(i=>{for(let o=0;o<n.length&&!i.closed;o++)i.next(n[o]);i.complete()})}(n);if(je(n))return function li(n){return new Vt(i=>{n.then(o=>{i.closed||(i.next(o),i.complete())},o=>i.error(o)).then(null,Ce)})}(n);if(Ge(n))return ui(n);if(Ir(n))return function Vi(n){return new Vt(i=>{for(const o of n)if(i.next(o),i.closed)return;i.complete()})}(n);if(gr(n))return function Rr(n){return ui(En(n))}(n)}throw dn(n)}function ui(n){return new Vt(i=>{(function ls(n,i){var o,l,h,m;return function gn(n,i,o,l){return new(o||(o=Promise))(function(m,_){function b(A){try{C(l.next(A))}catch(L){_(L)}}function I(A){try{C(l.throw(A))}catch(L){_(L)}}function C(A){A.done?m(A.value):function h(m){return m instanceof o?m:new o(function(_){_(m)})}(A.value).then(b,I)}C((l=l.apply(n,i||[])).next())})}(this,void 0,void 0,function*(){try{for(o=nt(n);!(l=yield o.next()).done;)if(i.next(l.value),i.closed)return}catch(_){h={error:_}}finally{try{l&&!l.done&&(m=o.return)&&(yield m.call(o))}finally{if(h)throw h.error}}i.complete()})})(n,i).catch(o=>i.error(o))})}function Xo(n,i,o,l=0,h=!1){const m=i.schedule(function(){o(),h?n.add(this.schedule(null,l)):this.unsubscribe()},l);if(n.add(m),!h)return m}function js(n,i,o=1/0){return Ct(i)?js((l,h)=>function Yn(n,i){return Ln((o,l)=>{let h=0;o.subscribe(On(l,m=>{l.next(n.call(i,m,h++))}))})}((m,_)=>i(l,m,h,_))(mr(n(l,h))),o):("number"==typeof i&&(o=i),Ln((l,h)=>function dl(n,i,o,l,h,m,_,b){const I=[];let C=0,A=0,L=!1;const F=()=>{L&&!I.length&&!C&&i.complete()},z=Y=>C<l?tt(Y):I.push(Y),tt=Y=>{m&&i.next(Y),C++;let Lt=!1;mr(o(Y,A++)).subscribe(On(i,_t=>{h?.(_t),m?z(_t):i.next(_t)},()=>{Lt=!0},void 0,()=>{if(Lt)try{for(C--;I.length&&C<l;){const _t=I.shift();_?Xo(i,_,()=>tt(_t)):tt(_t)}F()}catch(_t){i.error(_t)}}))};return n.subscribe(On(i,z,()=>{L=!0,F()})),()=>{b?.()}}(l,h,n,o)))}const Vo=new Vt(n=>n.complete());function Ja(n){return n[n.length-1]}function jl(n){return function ga(n){return n&&Ct(n.schedule)}(Ja(n))?n.pop():void 0}function Os(n,i=0){return Ln((o,l)=>{o.subscribe(On(l,h=>Xo(l,n,()=>l.next(h),i),()=>Xo(l,n,()=>l.complete(),i),h=>Xo(l,n,()=>l.error(h),i)))})}function ms(n,i=0){return Ln((o,l)=>{l.add(n.schedule(()=>o.subscribe(l),i))})}function Yo(n,i){if(!n)throw new Error("Iterable cannot be null");return new Vt(o=>{Xo(o,i,()=>{const l=n[Symbol.asyncIterator]();Xo(o,i,()=>{l.next().then(h=>{h.done?o.complete():o.next(h.value)})},0,!0)})})}function Qu(n,i){return i?function ml(n,i){if(null!=n){if(tn(n))return function gc(n,i){return mr(n).pipe(ms(i),Os(i))}(n,i);if(ye(n))return function Ml(n,i){return new Vt(o=>{let l=0;return i.schedule(function(){l===n.length?o.complete():(o.next(n[l++]),o.closed||this.schedule())})})}(n,i);if(je(n))return function Vl(n,i){return mr(n).pipe(ms(i),Os(i))}(n,i);if(Ge(n))return Yo(n,i);if(Ir(n))return function _c(n,i){return new Vt(o=>{let l;return Xo(o,i,()=>{l=n[Tn](),Xo(o,i,()=>{let h,m;try{({value:h,done:m}=l.next())}catch(_){return void o.error(_)}m?o.complete():o.next(h)},0,!0)}),()=>Ct(l?.return)&&l.return()})}(n,i);if(gr(n))return function ef(n,i){return Yo(En(n),i)}(n,i)}throw dn(n)}(n,i):mr(n)}function Hc(...n){const i=jl(n),o=function pl(n,i){return"number"==typeof Ja(n)?n.pop():i}(n,1/0),l=n;return l.length?1===l.length?mr(l[0]):function wh(n=1/0){return js(en,n)}(o)(Qu(l,i)):Vo}class bi extends Pe{constructor(i){super(),this._value=i}get value(){return this.getValue()}_subscribe(i){const o=super._subscribe(i);return!o.closed&&i.next(this._value),o}getValue(){const{hasError:i,thrownError:o,_value:l}=this;if(i)throw o;return this._throwIfClosed(),l}next(i){super.next(this._value=i)}}function Ka(n={}){const{connector:i=(()=>new Pe),resetOnError:o=!0,resetOnComplete:l=!0,resetOnRefCountZero:h=!0}=n;return m=>{let _,b,I,C=0,A=!1,L=!1;const F=()=>{b?.unsubscribe(),b=void 0},z=()=>{F(),_=I=void 0,A=L=!1},tt=()=>{const Y=_;z(),Y?.unsubscribe()};return Ln((Y,Lt)=>{C++,!L&&!A&&F();const _t=I=I??i();Lt.add(()=>{C--,0===C&&!L&&!A&&(b=or(tt,h))}),_t.subscribe(Lt),!_&&C>0&&(_=new J({next:X=>_t.next(X),error:X=>{L=!0,F(),b=or(z,o,X),_t.error(X)},complete:()=>{A=!0,F(),b=or(z,l),_t.complete()}}),mr(Y).subscribe(_))})(m)}}function or(n,i,...o){if(!0===i)return void n();if(!1===i)return;const l=new J({next:()=>{l.unsubscribe(),n()}});return mr(i(...o)).subscribe(l)}function N(n,i){return n===i}function $(n){for(let i in n)if(n[i]===$)return i;throw Error("Could not find renamed property on target object.")}function qt(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(qt).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const i=n.toString();if(null==i)return""+i;const o=i.indexOf("\n");return-1===o?i:i.substring(0,o)}function he(n,i){return null==n||""===n?null===i?"":i:null==i||""===i?n:n+" "+i}const me=$({__forward_ref__:$});function jt(n){return n.__forward_ref__=jt,n.toString=function(){return qt(this())},n}function qe(n){return function _n(n){return"function"==typeof n&&n.hasOwnProperty(me)&&n.__forward_ref__===jt}(n)?n():n}function Dn(n){return n&&!!n.\u0275providers}class Ke extends Error{constructor(i,o){super(function Se(n,i){return`NG0${Math.abs(n)}${i?": "+i:""}`}(i,o)),this.code=i}}function Qn(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():function Oe(n){return"string"==typeof n?n:null==n?"":String(n)}(n)}function Mi(n,i){throw new Ke(-201,!1)}function Ma(n,i){null==n&&function ur(n,i,o,l){throw new Error(`ASSERTION ERROR: ${n}`+(null==l?"":` [Expected=> ${o} ${l} ${i} <=Actual]`))}(i,n,null,"!=")}function Ko(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function iu(n){return{providers:n.providers||[],imports:n.imports||[]}}function Tl(n){return Dl(n,_a)||Dl(n,Ei)}function Dl(n,i){return n.hasOwnProperty(i)?n[i]:null}function yl(n){return n&&(n.hasOwnProperty(Su)||n.hasOwnProperty(pn))?n[Su]:null}const _a=$({\u0275prov:$}),Su=$({\u0275inj:$}),Ei=$({ngInjectableDef:$}),pn=$({ngInjectorDef:$});var Ti=function(n){return n[n.Default=0]="Default",n[n.Host=1]="Host",n[n.Self=2]="Self",n[n.SkipSelf=4]="SkipSelf",n[n.Optional=8]="Optional",n}(Ti||{});let ou;function gi(n){const i=ou;return ou=n,i}function Gl(n,i,o){const l=Tl(n);return l&&"root"==l.providedIn?void 0===l.value?l.value=l.factory():l.value:o&Ti.Optional?null:void 0!==i?i:void Mi(qt(n))}const Zr=globalThis;class dr{constructor(i,o){this._desc=i,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof o?this.__NG_ELEMENT_ID__=o:void 0!==o&&(this.\u0275prov=Ko({token:this,providedIn:o.providedIn||"root",factory:o.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Gs={},Ur="__NG_DI_FLAG__",Js="ngTempTokenPath",el=/\n/gm,Ms="__source";let xc;function Ks(n){const i=xc;return xc=n,i}function xl(n,i=Ti.Default){if(void 0===xc)throw new Ke(-203,!1);return null===xc?Gl(n,void 0,i):xc.get(n,i&Ti.Optional?null:void 0,i)}function Kr(n,i=Ti.Default){return(function Fo(){return ou}()||xl)(qe(n),i)}function mi(n,i=Ti.Default){return Kr(n,cs(i))}function cs(n){return typeof n>"u"||"number"==typeof n?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function su(n){const i=[];for(let o=0;o<n.length;o++){const l=qe(n[o]);if(Array.isArray(l)){if(0===l.length)throw new Ke(900,!1);let h,m=Ti.Default;for(let _=0;_<l.length;_++){const b=l[_],I=Qs(b);"number"==typeof I?-1===I?h=b.token:m|=I:h=b}i.push(Kr(h,m))}else i.push(Kr(l))}return i}function Qs(n){return n[Ur]}function Qo(n){return{toString:n}.toString()}var Ta=function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n}(Ta||{}),gs=function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n}(gs||{});const bl={},Vr=[],au=$({\u0275cmp:$}),wl=$({\u0275dir:$}),lu=$({\u0275pipe:$}),Ih=$({\u0275mod:$}),Ee=$({\u0275fac:$}),Xe=$({__NG_ELEMENT_ID__:$}),$t=$({__NG_ENV_ID__:$});function Zn(n,i,o){let l=n.length;for(;;){const h=n.indexOf(i,o);if(-1===h)return h;if(0===h||n.charCodeAt(h-1)<=32){const m=i.length;if(h+m===l||n.charCodeAt(h+m)<=32)return h}o=h+1}}function Xi(n,i,o){let l=0;for(;l<o.length;){const h=o[l];if("number"==typeof h){if(0!==h)break;l++;const m=o[l++],_=o[l++],b=o[l++];n.setAttribute(i,_,b,m)}else{const m=h,_=o[++l];Yi(m)?n.setProperty(i,m,_):n.setAttribute(i,m,_),l++}}return l}function Mr(n){return 3===n||4===n||6===n}function Yi(n){return 64===n.charCodeAt(0)}function Ji(n,i){if(null!==i&&0!==i.length)if(null===n||0===n.length)n=i.slice();else{let o=-1;for(let l=0;l<i.length;l++){const h=i[l];"number"==typeof h?o=h:0===o||Fs(n,o,h,null,-1===o||2===o?i[++l]:null)}}return n}function Fs(n,i,o,l,h){let m=0,_=n.length;if(-1===i)_=-1;else for(;m<n.length;){const b=n[m++];if("number"==typeof b){if(b===i){_=-1;break}if(b>i){_=m-1;break}}}for(;m<n.length;){const b=n[m];if("number"==typeof b)break;if(b===o){if(null===l)return void(null!==h&&(n[m+1]=h));if(l===n[m+1])return void(n[m+2]=h)}m++,null!==l&&m++,null!==h&&m++}-1!==_&&(n.splice(_,0,i),m=_+1),n.splice(m++,0,o),null!==l&&n.splice(m++,0,l),null!==h&&n.splice(m++,0,h)}const ts="ng-template";function to(n,i,o){let l=0,h=!0;for(;l<n.length;){let m=n[l++];if("string"==typeof m&&h){const _=n[l++];if(o&&"class"===m&&-1!==Zn(_.toLowerCase(),i,0))return!0}else{if(1===m){for(;l<n.length&&"string"==typeof(m=n[l++]);)if(m.toLowerCase()===i)return!0;return!1}"number"==typeof m&&(h=!1)}}return!1}function As(n){return 4===n.type&&n.value!==ts}function eo(n,i,o){return i===(4!==n.type||o?n.value:ts)}function Go(n,i,o){let l=4;const h=n.attrs||[],m=function Ts(n){for(let i=0;i<n.length;i++)if(Mr(n[i]))return i;return n.length}(h);let _=!1;for(let b=0;b<i.length;b++){const I=i[b];if("number"!=typeof I){if(!_)if(4&l){if(l=2|1&l,""!==I&&!eo(n,I,o)||""===I&&1===i.length){if(Bi(l))return!1;_=!0}}else{const C=8&l?I:i[++b];if(8&l&&null!==n.attrs){if(!to(n.attrs,C,o)){if(Bi(l))return!1;_=!0}continue}const L=tc(8&l?"class":I,h,As(n),o);if(-1===L){if(Bi(l))return!1;_=!0;continue}if(""!==C){let F;F=L>m?"":h[L+1].toLowerCase();const z=8&l?F:null;if(z&&-1!==Zn(z,C,0)||2&l&&C!==F){if(Bi(l))return!1;_=!0}}}}else{if(!_&&!Bi(l)&&!Bi(I))return!1;if(_&&Bi(I))continue;_=!1,l=I|1&l}}return Bi(l)||_}function Bi(n){return 0==(1&n)}function tc(n,i,o,l){if(null===i)return-1;let h=0;if(l||!o){let m=!1;for(;h<i.length;){const _=i[h];if(_===n)return h;if(3===_||6===_)m=!0;else{if(1===_||2===_){let b=i[++h];for(;"string"==typeof b;)b=i[++h];continue}if(4===_)break;if(0===_){h+=4;continue}}h+=m?1:2}return-1}return function ta(n,i){let o=n.indexOf(4);if(o>-1)for(o++;o<n.length;){const l=n[o];if("number"==typeof l)return-1;if(l===i)return o;o++}return-1}(i,n)}function nl(n,i,o=!1){for(let l=0;l<i.length;l++)if(Go(n,i[l],o))return!0;return!1}function Ba(n,i){return n?":not("+i.trim()+")":i}function ko(n){let i=n[0],o=1,l=2,h="",m=!1;for(;o<n.length;){let _=n[o];if("string"==typeof _)if(2&l){const b=n[++o];h+="["+_+(b.length>0?'="'+b+'"':"")+"]"}else 8&l?h+="."+_:4&l&&(h+=" "+_);else""!==h&&!Bi(_)&&(i+=Ba(m,h),h=""),l=_,m=m||!Bi(l);o++}return""!==h&&(i+=Ba(m,h)),i}function _s(n){return Qo(()=>{const i=function Ch(n){const i={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:i,inputTransforms:null,inputConfig:n.inputs||bl,exportAs:n.exportAs||null,standalone:!0===n.standalone,signals:!0===n.signals,selectors:n.selectors||Vr,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:aa(n.inputs,i),outputs:aa(n.outputs)}}(n),o={...i,decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===Ta.OnPush,directiveDefs:null,pipeDefs:null,dependencies:i.standalone&&n.dependencies||null,getStandaloneInjector:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||gs.Emulated,styles:n.styles||Vr,_:null,schemas:n.schemas||null,tView:null,id:""};!function ec(n){n.features?.forEach(i=>i(n))}(o);const l=n.dependencies;return o.directiveDefs=is(l,!1),o.pipeDefs=is(l,!0),o.id=function zf(n){let i=0;const o=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,n.consts,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery].join("|");for(const h of o)i=Math.imul(31,i)+h.charCodeAt(0)<<0;return i+=2147483648,"c"+i}(o),o})}function no(n){return Wr(n)||Oo(n)}function il(n){return null!==n}function hs(n){return Qo(()=>({type:n.type,bootstrap:n.bootstrap||Vr,declarations:n.declarations||Vr,imports:n.imports||Vr,exports:n.exports||Vr,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function aa(n,i){if(null==n)return bl;const o={};for(const l in n)if(n.hasOwnProperty(l)){let h=n[l],m=h;Array.isArray(h)&&(m=h[1],h=h[0]),o[h]=l,i&&(i[h]=m)}return o}function Wr(n){return n[au]||null}function Oo(n){return n[wl]||null}function $i(n){return n[lu]||null}function is(n,i){if(!n)return null;const o=i?$i:no;return()=>("function"==typeof n?n():n).map(l=>o(l)).filter(il)}const An=0,$n=1,cr=2,Ii=3,ol=4,ua=5,$s=6,nc=7,Li=8,Wc=9,sl=10,ni=11,Au=12,Yd=13,Xc=14,Bo=15,Pu=16,Lu=17,al=18,Ll=19,rc=20,El=21,ll=22,ca=23,Tr=24,ci=25,Ou=1,Da=2,Ru=7,os=9,ha=11;function d(n){return Array.isArray(n)&&"object"==typeof n[Ou]}function v(n){return Array.isArray(n)&&!0===n[Ou]}function w(n){return 0!=(4&n.flags)}function T(n){return n.componentOffset>-1}function q(n){return!!n.template}function K(n){return 0!=(512&n[cr])}function of(n,i){return n.hasOwnProperty(Ee)?n[Ee]:null}let ja=null,Bf=!1;function ic(n){const i=ja;return ja=n,i}const L0={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function jb(n){if(!sf(n)||n.dirty){if(!n.producerMustRecompute(n)&&!Mh(n))return void(n.dirty=!1);n.producerRecomputeValue(n),n.dirty=!1}}function Gb(n){n.dirty=!0,function Vb(n){if(void 0===n.liveConsumerNode)return;const i=Bf;Bf=!0;try{for(const o of n.liveConsumerNode)o.dirty||Gb(o)}finally{Bf=i}}(n),n.consumerMarkedDirty?.(n)}function Em(n){return n&&(n.nextProducerIndex=0),ic(n)}function Qd(n,i){if(ic(i),n&&void 0!==n.producerNode&&void 0!==n.producerIndexOfThis&&void 0!==n.producerLastReadVersion){if(sf(n))for(let o=n.nextProducerIndex;o<n.producerNode.length;o++)tp(n.producerNode[o],n.producerIndexOfThis[o]);for(;n.producerNode.length>n.nextProducerIndex;)n.producerNode.pop(),n.producerLastReadVersion.pop(),n.producerIndexOfThis.pop()}}function Mh(n){Dh(n);for(let i=0;i<n.producerNode.length;i++){const o=n.producerNode[i],l=n.producerLastReadVersion[i];if(l!==o.version||(jb(o),l!==o.version))return!0}return!1}function u_(n){if(Dh(n),sf(n))for(let i=0;i<n.producerNode.length;i++)tp(n.producerNode[i],n.producerIndexOfThis[i]);n.producerNode.length=n.producerLastReadVersion.length=n.producerIndexOfThis.length=0,n.liveConsumerNode&&(n.liveConsumerNode.length=n.liveConsumerIndexOfThis.length=0)}function tp(n,i){if(function Fu(n){n.liveConsumerNode??=[],n.liveConsumerIndexOfThis??=[]}(n),Dh(n),1===n.liveConsumerNode.length)for(let l=0;l<n.producerNode.length;l++)tp(n.producerNode[l],n.producerIndexOfThis[l]);const o=n.liveConsumerNode.length-1;if(n.liveConsumerNode[i]=n.liveConsumerNode[o],n.liveConsumerIndexOfThis[i]=n.liveConsumerIndexOfThis[o],n.liveConsumerNode.length--,n.liveConsumerIndexOfThis.length--,i<n.liveConsumerNode.length){const l=n.liveConsumerIndexOfThis[i],h=n.liveConsumerNode[i];Dh(h),h.producerIndexOfThis[l]=i}}function sf(n){return n.consumerIsAlwaysLive||(n?.liveConsumerNode?.length??0)>0}function Dh(n){n.producerNode??=[],n.producerIndexOfThis??=[],n.producerLastReadVersion??=[]}let c_=null;const k0=()=>{},Wb=(()=>({...L0,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:n=>{n.schedule(n.ref)},hasRun:!1,cleanupFn:k0}))();class Xb{constructor(i,o,l){this.previousValue=i,this.currentValue=o,this.firstChange=l}isFirstChange(){return this.firstChange}}function jf(n){return n.type.prototype.ngOnChanges&&(n.setInput=Jb),Yb}function Yb(){const n=z0(this),i=n?.current;if(i){const o=n.previous;if(o===bl)n.previous=i;else for(let l in i)o[l]=i[l];n.current=null,this.ngOnChanges(i)}}function Jb(n,i,o,l){const h=this.declaredInputs[o],m=z0(n)||function Qb(n,i){return n[Kb]=i}(n,{previous:bl,current:null}),_=m.current||(m.current={}),b=m.previous,I=b[h];_[h]=new Xb(I&&I.currentValue,i,b===bl),n[l]=i}const Kb="__ngSimpleChanges__";function z0(n){return n[Kb]||null}const Ic=function(n,i,o){};function ks(n){for(;Array.isArray(n);)n=n[An];return n}function cu(n,i){return ks(i[n.index])}function ku(n,i){const o=i[n];return d(o)?o:o[An]}function af(n,i){return null==i?null:n[i]}function nw(n){n[Lu]=0}function Cc(n){1024&n[cr]||(n[cr]|=1024,rw(n,1))}function Tm(n){1024&n[cr]&&(n[cr]&=-1025,rw(n,-1))}function rw(n,i){let o=n[Ii];if(null===o)return;o[ua]+=i;let l=o;for(o=o[Ii];null!==o&&(1===i&&1===l[ua]||-1===i&&0===l[ua]);)o[ua]+=i,l=o,o=o[Ii]}const $r={lFrame:ul(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Vf(){return $r.bindingsEnabled}function wn(){return $r.lFrame.lView}function Uo(){return $r.lFrame.tView}function Va(){let n=p_();for(;null!==n&&64===n.type;)n=n.parent;return n}function p_(){return $r.lFrame.currentTNode}function fa(n,i){const o=$r.lFrame;o.currentTNode=n,o.isParent=i}function Jc(){return $r.lFrame.isParent}function lw(n,i){const o=$r.lFrame;o.bindingIndex=o.bindingRootIndex=n,lf(i)}function lf(n){$r.lFrame.currentDirectiveIndex=n}function Xn(n){$r.lFrame.currentQueryIndex=n}function Pm(n){const i=n[$n];return 2===i.type?i.declTNode:1===i.type?n[$s]:null}function ys(n,i,o){if(o&Ti.SkipSelf){let h=i,m=n;for(;!(h=h.parent,null!==h||o&Ti.Host||(h=Pm(m),null===h||(m=m[Xc],10&h.type))););if(null===h)return!1;i=h,n=m}const l=$r.lFrame=H0();return l.currentTNode=i,l.lView=n,!0}function ip(n){const i=H0(),o=n[$n];$r.lFrame=i,i.currentTNode=o.firstChild,i.lView=n,i.tView=o,i.contextLView=n,i.bindingIndex=o.bindingStartIndex,i.inI18n=!1}function H0(){const n=$r.lFrame,i=null===n?null:n.child;return null===i?ul(n):i}function ul(n){const i={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=i),i}function Lm(){const n=$r.lFrame;return $r.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const Z0=Lm;function $l(){const n=Lm();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function Ao(n){$r.lFrame.selectedIndex=n}let v_=!0;function oc(){return v_}function Hl(n){v_=n}function Hf(n,i){for(let o=i.directiveStart,l=i.directiveEnd;o<l;o++){const m=n.data[o].type.prototype,{ngAfterContentInit:_,ngAfterContentChecked:b,ngAfterViewInit:I,ngAfterViewChecked:C,ngOnDestroy:A}=m;_&&(n.contentHooks??=[]).push(-o,_),b&&((n.contentHooks??=[]).push(o,b),(n.contentCheckHooks??=[]).push(o,b)),I&&(n.viewHooks??=[]).push(-o,I),C&&((n.viewHooks??=[]).push(o,C),(n.viewCheckHooks??=[]).push(o,C)),null!=A&&(n.destroyHooks??=[]).push(o,A)}}function op(n,i,o){Oh(n,i,3,o)}function sp(n,i,o,l){(3&n[cr])===o&&Oh(n,i,o,l)}function Om(n,i){let o=n[cr];(3&o)===i&&(o&=8191,o+=1,n[cr]=o)}function Oh(n,i,o,l){const m=l??-1,_=i.length-1;let b=0;for(let I=void 0!==l?65535&n[Lu]:0;I<_;I++)if("number"==typeof i[I+1]){if(b=i[I],null!=l&&b>=l)break}else i[I]<0&&(n[Lu]+=65536),(b<m||-1==m)&&(w_(n,o,i,I),n[Lu]=(4294901760&n[Lu])+I+2),I++}function b_(n,i){Ic(4,n,i);const o=ic(null);try{i.call(n)}finally{ic(o),Ic(5,n,i)}}function w_(n,i,o,l){const h=o[l]<0,m=o[l+1],b=n[h?-o[l]:o[l]];h?n[cr]>>13<n[Lu]>>16&&(3&n[cr])===i&&(n[cr]+=8192,b_(b,m)):b_(b,m)}const uf=-1;class Zf{constructor(i,o,l){this.factory=i,this.resolving=!1,this.canSeeViewProviders=o,this.injectImpl=l}}function Nh(n){return 32767&n}function cf(n,i){let o=function X0(n){return n>>16}(n),l=i;for(;o>0;)l=l[Xc],o--;return l}let Nm=!0;function Fm(n){const i=Nm;return Nm=n,i}const Y0=255,J0=5;let dw=0;const Mc={};function km(n,i){const o=K0(n,i);if(-1!==o)return o;const l=i[$n];l.firstCreatePass&&(n.injectorIndex=i.length,C_(l.data,n),C_(i,null),C_(l.blueprint,null));const h=zm(n,i),m=n.injectorIndex;if(function Rh(n){return n!==uf}(h)){const _=Nh(h),b=cf(h,i),I=b[$n].data;for(let C=0;C<8;C++)i[m+C]=b[_+C]|I[_+C]}return i[m+8]=h,m}function C_(n,i){n.push(0,0,0,0,0,0,0,0,i)}function K0(n,i){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===i[n.injectorIndex+8]?-1:n.injectorIndex}function zm(n,i){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let o=0,l=null,h=i;for(;null!==h;){if(l=ln(h),null===l)return uf;if(o++,h=h[Xc],-1!==l.injectorIndex)return l.injectorIndex|o<<16}return uf}function Q0(n,i,o){!function pw(n,i,o){let l;"string"==typeof o?l=o.charCodeAt(0)||0:o.hasOwnProperty(Xe)&&(l=o[Xe]),null==l&&(l=o[Xe]=dw++);const h=l&Y0;i.data[n+(h>>J0)]|=1<<h}(n,i,o)}function Ui(n,i,o){if(o&Ti.Optional||void 0!==n)return n;Mi()}function tv(n,i,o,l){if(o&Ti.Optional&&void 0===l&&(l=null),!(o&(Ti.Self|Ti.Host))){const h=n[Wc],m=gi(void 0);try{return h?h.get(i,l,o&Ti.Optional):Gl(i,l,o&Ti.Optional)}finally{gi(m)}}return Ui(l,0,o)}function mw(n,i,o,l=Ti.Default,h){if(null!==n){if(2048&i[cr]&&!(l&Ti.Self)){const _=function Gr(n,i,o,l,h){let m=n,_=i;for(;null!==m&&null!==_&&2048&_[cr]&&!(512&_[cr]);){const b=gw(m,_,o,l|Ti.Self,Mc);if(b!==Mc)return b;let I=m.parent;if(!I){const C=_[rc];if(C){const A=C.get(o,Mc,l);if(A!==Mc)return A}I=ln(_),_=_[Xc]}m=I}return h}(n,i,o,l,Mc);if(_!==Mc)return _}const m=gw(n,i,o,l,Mc);if(m!==Mc)return m}return tv(i,o,l,h)}function gw(n,i,o,l,h){const m=function _w(n){if("string"==typeof n)return n.charCodeAt(0)||0;const i=n.hasOwnProperty(Xe)?n[Xe]:void 0;return"number"==typeof i?i>=0?i&Y0:nv:i}(o);if("function"==typeof m){if(!ys(i,n,l))return l&Ti.Host?Ui(h,0,l):tv(i,o,l,h);try{let _;if(_=m(l),null!=_||l&Ti.Optional)return _;Mi()}finally{Z0()}}else if("number"==typeof m){let _=null,b=K0(n,i),I=uf,C=l&Ti.Host?i[Bo][$s]:null;for((-1===b||l&Ti.SkipSelf)&&(I=-1===b?zm(n,i):i[b+8],I!==uf&&yw(l,!1)?(_=i[$n],b=Nh(I),i=cf(I,i)):b=-1);-1!==b;){const A=i[$n];if(ev(m,b,A.data)){const L=S_(b,i,o,_,l,C);if(L!==Mc)return L}I=i[b+8],I!==uf&&yw(l,i[$n].data[b+8]===C)&&ev(m,b,i)?(_=A,b=Nh(I),i=cf(I,i)):b=-1}}return h}function S_(n,i,o,l,h,m){const _=i[$n],b=_.data[n+8],A=function Bm(n,i,o,l,h){const m=n.providerIndexes,_=i.data,b=1048575&m,I=n.directiveStart,A=m>>20,F=h?b+A:n.directiveEnd;for(let z=l?b:b+A;z<F;z++){const tt=_[z];if(z<I&&o===tt||z>=I&&tt.type===o)return z}if(h){const z=_[I];if(z&&q(z)&&z.type===o)return I}return null}(b,_,o,null==l?T(b)&&Nm:l!=_&&0!=(3&b.type),h&Ti.Host&&m===b);return null!==A?Xf(i,_,A,b):Mc}function Xf(n,i,o,l){let h=n[o];const m=i.data;if(function ea(n){return n instanceof Zf}(h)){const _=h;_.resolving&&function It(n,i){const o=i?`. Dependency path: ${i.join(" > ")} > ${n}`:"";throw new Ke(-200,`Circular dependency in DI detected for ${n}${o}`)}(Qn(m[o]));const b=Fm(_.canSeeViewProviders);_.resolving=!0;const C=_.injectImpl?gi(_.injectImpl):null;ys(n,l,Ti.Default);try{h=n[o]=_.factory(void 0,m,n,l),i.firstCreatePass&&o>=l.directiveStart&&function x_(n,i,o){const{ngOnChanges:l,ngOnInit:h,ngDoCheck:m}=i.type.prototype;if(l){const _=jf(i);(o.preOrderHooks??=[]).push(n,_),(o.preOrderCheckHooks??=[]).push(n,_)}h&&(o.preOrderHooks??=[]).push(0-n,h),m&&((o.preOrderHooks??=[]).push(n,m),(o.preOrderCheckHooks??=[]).push(n,m))}(o,m[o],i)}finally{null!==C&&gi(C),Fm(b),_.resolving=!1,Z0()}}return h}function ev(n,i,o){return!!(o[i+(n>>J0)]&1<<n)}function yw(n,i){return!(n&Ti.Self||n&Ti.Host&&i)}class Rl{constructor(i,o){this._tNode=i,this._lView=o}get(i,o,l){return mw(this._tNode,this._lView,i,cs(l),o)}}function nv(){return new Rl(Va(),wn())}function ln(n){const i=n[$n],o=i.type;return 2===o?i.declTNode:1===o?n[$s]:null}function $a(n,i){n.forEach(o=>Array.isArray(o)?$a(o,i):i(o))}function na(n,i){return i>=n.length-1?n.pop():n.splice(i,1)[0]}var Ac=function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n}(Ac||{});const O_=new Map;let R_=0;const N_="__ngContext__";function kl(n,i){d(i)?(n[N_]=i[Ll],function Gw(n){O_.set(n[Ll],n)}(i)):n[N_]=i}let Wm;function z_(n,i){return Wm(n,i)}function hp(n){const i=n[Ii];return v(i)?i[Ii]:i}function Xm(n){return B_(n[Au])}function kr(n){return B_(n[ol])}function B_(n){for(;null!==n&&!v(n);)n=n[ol];return n}function ac(n,i,o,l,h){if(null!=l){let m,_=!1;v(l)?m=l:d(l)&&(_=!0,l=l[An]);const b=ks(l);0===n&&null!==o?null==h?ce(i,o,b):ed(i,o,b,h||null,!0):1===n&&null!==o?ed(i,o,b,h||null,!0):2===n?function q_(n,i,o){const l=function V_(n,i){return n.parentNode(i)}(n,i);l&&function Ha(n,i,o,l){n.removeChild(i,o,l)}(n,l,i,o)}(i,b,_):3===n&&i.destroyNode(b),null!=m&&function $_(n,i,o,l,h){const m=o[Ru];m!==ks(o)&&ac(i,n,l,m,h);for(let b=ha;b<o.length;b++){const I=o[b];si(I[$n],I,n,i,l,m)}}(i,n,m,o,h)}}function Jm(n,i,o){return n.createElement(i,o)}function j_(n,i){const o=n[os],l=o.indexOf(i);Tm(i),o.splice(l,1)}function _v(n,i){if(!(256&i[cr])){i[cr]&=-129,i[cr]|=256,function OT(n,i){let o;if(null!=n&&null!=(o=n.destroyHooks))for(let l=0;l<o.length;l+=2){const h=i[o[l]];if(!(h instanceof Zf)){const m=o[l+1];if(Array.isArray(m))for(let _=0;_<m.length;_+=2){const b=h[m[_]],I=m[_+1];Ic(4,b,I);try{I.call(b)}finally{Ic(5,b,I)}}else{Ic(4,h,m);try{m.call(h)}finally{Ic(5,h,m)}}}}}(n,i),function fp(n,i){const o=n.cleanup,l=i[nc];if(null!==o)for(let m=0;m<o.length-1;m+=2)if("string"==typeof o[m]){const _=o[m+3];_>=0?l[_]():l[-_].unsubscribe(),m+=2}else o[m].call(l[o[m+1]]);null!==l&&(i[nc]=null);const h=i[El];if(null!==h){i[El]=null;for(let m=0;m<h.length;m++)(0,h[m])()}}(n,i),1===i[$n].type&&i[ni].destroy();const o=i[Pu];if(null!==o&&v(i[Ii])){o!==i[Ii]&&j_(o,i);const l=i[al];null!==l&&l.detachView(n)}!function qw(n){O_.delete(n[Ll])}(i)}}function yv(n,i,o){return function zl(n,i,o){let l=i;for(;null!==l&&40&l.type;)l=(i=l).parent;if(null===l)return o[An];{const{componentOffset:h}=l;if(h>-1){const{encapsulation:m}=n.data[l.directiveStart+h];if(m===gs.None||m===gs.Emulated)return null}return cu(l,o)}}(n,i.parent,o)}function ed(n,i,o,l,h){n.insertBefore(i,o,l,h)}function ce(n,i,o){n.appendChild(i,o)}function iE(n,i,o,l,h){null!==l?ed(n,i,o,l,h):ce(n,i,o)}let lc,pf,vv=function oE(n,i,o){return 40&n.type?cu(n,o):null};function nd(n,i,o,l){const h=yv(n,l,i),m=i[ni],b=function Ot(n,i,o){return vv(n,i,o)}(l.parent||i[$s],l,i);if(null!=h)if(Array.isArray(o))for(let I=0;I<o.length;I++)iE(m,h,o[I],b,!1);else iE(m,h,o,b,!1);void 0!==lc&&lc(m,l,i,o,h)}function zh(n,i){return null!==i?n[Bo][$s].projection[i.projection]:null}function Km(n,i,o,l,h,m,_){for(;null!=o;){const b=l[o.index],I=o.type;if(_&&0===i&&(b&&kl(ks(b),l),o.flags|=2),32!=(32&o.flags))if(8&I)Km(n,i,o.child,l,h,m,!1),ac(i,n,h,b,m);else if(32&I){const C=z_(o,l);let A;for(;A=C();)ac(i,n,h,A,m);ac(i,n,h,b,m)}else 16&I?xv(n,i,l,o,h,m):ac(i,n,h,b,m);o=_?o.projectionNext:o.next}}function si(n,i,o,l,h,m){Km(o,l,n.firstChild,i,h,m,!1)}function xv(n,i,o,l,h,m){const _=o[Bo],I=_[$s].projection[l.projection];if(Array.isArray(I))for(let C=0;C<I.length;C++)ac(i,n,h,I[C],m);else{let C=I;const A=_[Ii];(function Nl(n){return 128==(128&n.flags)})(l)&&(C.flags|=128),Km(n,i,C,A,h,m,!0)}}function wv(n,i,o){""===o?n.removeAttribute(i,"class"):n.setAttribute(i,"class",o)}function Ev(n,i,o){const{mergedAttrs:l,classes:h,styles:m}=o;null!==l&&Xi(n,i,l),null!==h&&wv(n,i,h),null!==m&&function tg(n,i,o){n.setAttribute(i,"style",o)}(n,i,m)}const ag=new dr("ENVIRONMENT_INITIALIZER"),_E=new dr("INJECTOR",-1),Rc=new dr("INJECTOR_DEF_TYPES");class ih{get(i,o=Gs){if(o===Gs){const l=new Error(`NullInjectorError: No provider for ${qt(i)}!`);throw l.name="NullInjectorError",l}return o}}function Y_(...n){return{\u0275providers:J_(0,n),\u0275fromNgModule:!0}}function J_(n,...i){const o=[],l=new Set;let h;const m=_=>{o.push(_)};return $a(i,_=>{const b=_;K_(b,m,[],l)&&(h||=[],h.push(b))}),void 0!==h&&zv(h,m),o}function zv(n,i){for(let o=0;o<n.length;o++){const{ngModule:l,providers:h}=n[o];Bv(h,m=>{i(m,l)})}}function K_(n,i,o,l){if(!(n=qe(n)))return!1;let h=null,m=yl(n);const _=!m&&Wr(n);if(m||_){if(_&&!_.standalone)return!1;h=n}else{const I=n.ngModule;if(m=yl(I),!m)return!1;h=I}const b=l.has(h);if(_){if(b)return!1;if(l.add(h),_.dependencies){const I="function"==typeof _.dependencies?_.dependencies():_.dependencies;for(const C of I)K_(C,i,o,l)}}else{if(!m)return!1;{if(null!=m.imports&&!b){let C;l.add(h);try{$a(m.imports,A=>{K_(A,i,o,l)&&(C||=[],C.push(A))})}finally{}void 0!==C&&zv(C,i)}if(!b){const C=of(h)||(()=>new h);i({provide:h,useFactory:C,deps:Vr},h),i({provide:Rc,useValue:h,multi:!0},h),i({provide:ag,useValue:()=>Kr(h),multi:!0},h)}const I=m.providers;if(null!=I&&!b){const C=n;Bv(I,A=>{i(A,C)})}}}return h!==n&&void 0!==n.providers}function Bv(n,i){for(let o of n)Dn(o)&&(o=o.\u0275providers),Array.isArray(o)?Bv(o,i):i(o)}const Uv=$({provide:String,useValue:$});function jv(n){return null!==n&&"object"==typeof n&&Uv in n}function gf(n){return"function"==typeof n}const ty=new dr("Set Injector scope."),ey={},gp={};let ug;function jh(){return void 0===ug&&(ug=new ih),ug}class uc{}class sd extends uc{get destroyed(){return this._destroyed}constructor(i,o,l,h){super(),this.parent=o,this.source=l,this.scopes=h,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,ry(i,_=>this.processProvider(_)),this.records.set(_E,_p(void 0,this)),h.has("environment")&&this.records.set(uc,_p(void 0,this));const m=this.records.get(ty);null!=m&&"string"==typeof m.value&&this.scopes.add(m.value),this.injectorDefTypes=new Set(this.get(Rc.multi,Vr,Ti.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const o of this._ngOnDestroyHooks)o.ngOnDestroy();const i=this._onDestroyHooks;this._onDestroyHooks=[];for(const o of i)o()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(i){return this.assertNotDestroyed(),this._onDestroyHooks.push(i),()=>this.removeOnDestroy(i)}runInContext(i){this.assertNotDestroyed();const o=Ks(this),l=gi(void 0);try{return i()}finally{Ks(o),gi(l)}}get(i,o=Gs,l=Ti.Default){if(this.assertNotDestroyed(),i.hasOwnProperty($t))return i[$t](this);l=cs(l);const m=Ks(this),_=gi(void 0);try{if(!(l&Ti.SkipSelf)){let I=this.records.get(i);if(void 0===I){const C=function qT(n){return"function"==typeof n||"object"==typeof n&&n instanceof dr}(i)&&Tl(i);I=C&&this.injectableDefInScope(C)?_p(ny(i),ey):null,this.records.set(i,I)}if(null!=I)return this.hydrate(i,I)}return(l&Ti.Self?jh():this.parent).get(i,o=l&Ti.Optional&&o===Gs?null:o)}catch(b){if("NullInjectorError"===b.name){if((b[Js]=b[Js]||[]).unshift(qt(i)),m)throw b;return function Tu(n,i,o,l){const h=n[Js];throw i[Ms]&&h.unshift(i[Ms]),n.message=function Eh(n,i,o,l=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let h=qt(i);if(Array.isArray(i))h=i.map(qt).join(" -> ");else if("object"==typeof i){let m=[];for(let _ in i)if(i.hasOwnProperty(_)){let b=i[_];m.push(_+":"+("string"==typeof b?JSON.stringify(b):qt(b)))}h=`{${m.join(", ")}}`}return`${o}${l?"("+l+")":""}[${h}]: ${n.replace(el,"\n  ")}`}("\n"+n.message,h,o,l),n.ngTokenPath=h,n[Js]=null,n}(b,i,"R3InjectorError",this.source)}throw b}finally{gi(_),Ks(m)}}resolveInjectorInitializers(){const i=Ks(this),o=gi(void 0);try{const h=this.get(ag.multi,Vr,Ti.Self);for(const m of h)m()}finally{Ks(i),gi(o)}}toString(){const i=[],o=this.records;for(const l of o.keys())i.push(qt(l));return`R3Injector[${i.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Ke(205,!1)}processProvider(i){let o=gf(i=qe(i))?i:qe(i&&i.provide);const l=function GT(n){return jv(n)?_p(void 0,n.useValue):_p(function yE(n,i,o){let l;if(gf(n)){const h=qe(n);return of(h)||ny(h)}if(jv(n))l=()=>qe(n.useValue);else if(function Vv(n){return!(!n||!n.useFactory)}(n))l=()=>n.useFactory(...su(n.deps||[]));else if(function Q_(n){return!(!n||!n.useExisting)}(n))l=()=>Kr(qe(n.useExisting));else{const h=qe(n&&(n.useClass||n.provide));if(!function vE(n){return!!n.deps}(n))return of(h)||ny(h);l=()=>new h(...su(n.deps))}return l}(n),ey)}(i);if(gf(i)||!0!==i.multi)this.records.get(o);else{let h=this.records.get(o);h||(h=_p(void 0,ey,!0),h.factory=()=>su(h.multi),this.records.set(o,h)),o=i,h.multi.push(i)}this.records.set(o,l)}hydrate(i,o){return o.value===ey&&(o.value=gp,o.value=o.factory()),"object"==typeof o.value&&o.value&&function xE(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(o.value)&&this._ngOnDestroyHooks.add(o.value),o.value}injectableDefInScope(i){if(!i.providedIn)return!1;const o=qe(i.providedIn);return"string"==typeof o?"any"===o||this.scopes.has(o):this.injectorDefTypes.has(o)}removeOnDestroy(i){const o=this._onDestroyHooks.indexOf(i);-1!==o&&this._onDestroyHooks.splice(o,1)}}function ny(n){const i=Tl(n),o=null!==i?i.factory:of(n);if(null!==o)return o;if(n instanceof dr)throw new Ke(204,!1);if(n instanceof Function)return function VT(n){const i=n.length;if(i>0)throw function lp(n,i){const o=[];for(let l=0;l<n;l++)o.push(i);return o}(i,"?"),new Ke(204,!1);const o=function No(n){return n&&(n[_a]||n[Ei])||null}(n);return null!==o?()=>o.factory(n):()=>new n}(n);throw new Ke(204,!1)}function _p(n,i,o=!1){return{factory:n,value:i,multi:o?[]:void 0}}function ry(n,i){for(const o of n)Array.isArray(o)?ry(o,i):o&&Dn(o)?ry(o.\u0275providers,i):i(o)}const iy=new dr("AppId",{providedIn:"root",factory:()=>$T}),$T="ng",Gv=new dr("Platform Initializer"),ad=new dr("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),oh=new dr("CSP nonce",{providedIn:"root",factory:()=>function Il(){if(void 0!==pf)return pf;if(typeof document<"u")return document;throw new Ke(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let wE=(n,i,o)=>null;function vf(n,i,o=!1){return wE(n,i,o)}class Jv{}class dg{}class Qv{resolveComponentFactory(i){throw function Kv(n){const i=Error(`No component factory found for ${qt(n)}.`);return i.ngComponent=n,i}(i)}}let fd=(()=>{class n{static#t=this.NULL=new Qv}return n})();function JT(){return xp(Va(),wn())}function xp(n,i){return new bp(cu(n,i))}let bp=(()=>{class n{constructor(o){this.nativeElement=o}static#t=this.__NG_ELEMENT_ID__=JT}return n})();class ME{}let tD=(()=>{class n{static#t=this.\u0275prov=Ko({token:n,providedIn:"root",factory:()=>null})}return n})();class wp{constructor(i){this.full=i,this.major=i.split(".")[0],this.minor=i.split(".")[1],this.patch=i.split(".").slice(2).join(".")}}const eD=new wp("16.2.12"),cy={};function mg(n,i=null,o=null,l){const h=i1(n,i,o,l);return h.resolveInjectorInitializers(),h}function i1(n,i=null,o=null,l,h=new Set){const m=[o||Vr,Y_(n)];return l=l||("object"==typeof n?void 0:qt(n)),new sd(m,i||jh(),l||null,h)}let sh=(()=>{class n{static#t=this.THROW_IF_NOT_FOUND=Gs;static#e=this.NULL=new ih;static create(o,l){if(Array.isArray(o))return mg({name:""},l,o,"");{const h=o.name??"";return mg({name:h},o.parent,o.providers,h)}}static#n=this.\u0275prov=Ko({token:n,providedIn:"any",factory:()=>Kr(_E)});static#r=this.__NG_ELEMENT_ID__=-1}return n})();function Ho(n){return n.ngOriginalError}class Nc{constructor(){this._console=console}handleError(i){const o=this._findOriginalError(i);this._console.error("ERROR",i),o&&this._console.error("ORIGINAL ERROR",o)}_findOriginalError(i){let o=i&&Ho(i);for(;o&&Ho(o);)o=Ho(o);return o||null}}function fy(n){return i=>{setTimeout(n,void 0,i)}}const Vh=class Ep extends Pe{constructor(i=!1){super(),this.__isAsync=i}emit(i){super.next(i)}subscribe(i,o,l){let h=i,m=o||(()=>null),_=l;if(i&&"object"==typeof i){const I=i;h=I.next?.bind(I),m=I.error?.bind(I),_=I.complete?.bind(I)}this.__isAsync&&(m=fy(m),h&&(h=fy(h)),_&&(_=fy(_)));const b=super.subscribe({next:h,error:m,complete:_});return i instanceof rt&&i.add(b),b}};function OE(...n){}class wa{constructor({enableLongStackTrace:i=!1,shouldCoalesceEventChangeDetection:o=!1,shouldCoalesceRunChangeDetection:l=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Vh(!1),this.onMicrotaskEmpty=new Vh(!1),this.onStable=new Vh(!1),this.onError=new Vh(!1),typeof Zone>"u")throw new Ke(908,!1);Zone.assertZonePatched();const h=this;h._nesting=0,h._outer=h._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(h._inner=h._inner.fork(new Zone.TaskTrackingZoneSpec)),i&&Zone.longStackTraceZoneSpec&&(h._inner=h._inner.fork(Zone.longStackTraceZoneSpec)),h.shouldCoalesceEventChangeDetection=!l&&o,h.shouldCoalesceRunChangeDetection=l,h.lastRequestAnimationFrameId=-1,h.nativeRequestAnimationFrame=function oD(){const n="function"==typeof Zr.requestAnimationFrame;let i=Zr[n?"requestAnimationFrame":"setTimeout"],o=Zr[n?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&i&&o){const l=i[Zone.__symbol__("OriginalDelegate")];l&&(i=l);const h=o[Zone.__symbol__("OriginalDelegate")];h&&(o=h)}return{nativeRequestAnimationFrame:i,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function lD(n){const i=()=>{!function aD(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Zr,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,Ip(n),n.isCheckStableRunning=!0,a1(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),Ip(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(o,l,h,m,_,b)=>{if(function uD(n){return!(!Array.isArray(n)||1!==n.length)&&!0===n[0].data?.__ignore_ng_zone__}(b))return o.invokeTask(h,m,_,b);try{return dd(n),o.invokeTask(h,m,_,b)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===m.type||n.shouldCoalesceRunChangeDetection)&&i(),l1(n)}},onInvoke:(o,l,h,m,_,b,I)=>{try{return dd(n),o.invoke(h,m,_,b,I)}finally{n.shouldCoalesceRunChangeDetection&&i(),l1(n)}},onHasTask:(o,l,h,m)=>{o.hasTask(h,m),l===h&&("microTask"==m.change?(n._hasPendingMicrotasks=m.microTask,Ip(n),a1(n)):"macroTask"==m.change&&(n.hasPendingMacrotasks=m.macroTask))},onHandleError:(o,l,h,m)=>(o.handleError(h,m),n.runOutsideAngular(()=>n.onError.emit(m)),!1)})}(h)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!wa.isInAngularZone())throw new Ke(909,!1)}static assertNotInAngularZone(){if(wa.isInAngularZone())throw new Ke(909,!1)}run(i,o,l){return this._inner.run(i,o,l)}runTask(i,o,l,h){const m=this._inner,_=m.scheduleEventTask("NgZoneEvent: "+h,i,sD,OE,OE);try{return m.runTask(_,o,l)}finally{m.cancelTask(_)}}runGuarded(i,o,l){return this._inner.runGuarded(i,o,l)}runOutsideAngular(i){return this._outer.run(i)}}const sD={};function a1(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function Ip(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function dd(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function l1(n){n._nesting--,a1(n)}class dy{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Vh,this.onMicrotaskEmpty=new Vh,this.onStable=new Vh,this.onError=new Vh}run(i,o,l){return i.apply(o,l)}runGuarded(i,o,l){return i.apply(o,l)}runOutsideAngular(i){return i()}runTask(i,o,l,h){return i.apply(o,l)}}const RE=new dr("",{providedIn:"root",factory:u1});function u1(){const n=mi(wa);let i=!0;return Hc(new Vt(h=>{i=n.isStable&&!n.hasPendingMacrotasks&&!n.hasPendingMicrotasks,n.runOutsideAngular(()=>{h.next(i),h.complete()})}),new Vt(h=>{let m;n.runOutsideAngular(()=>{m=n.onStable.subscribe(()=>{wa.assertNotInAngularZone(),queueMicrotask(()=>{!i&&!n.hasPendingMacrotasks&&!n.hasPendingMicrotasks&&(i=!0,h.next(!0))})})});const _=n.onUnstable.subscribe(()=>{wa.assertInAngularZone(),i&&(i=!1,n.runOutsideAngular(()=>{h.next(!1)}))});return()=>{m.unsubscribe(),_.unsubscribe()}}).pipe(Ka()))}let h1=(()=>{class n{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#t=this.\u0275prov=Ko({token:n,providedIn:"root",factory:()=>new n})}return n})();function wf(n){for(;n;){n[cr]|=64;const i=hp(n);if(K(n)&&!i)return n;n=i}return null}const my=new dr("",{providedIn:"root",factory:()=>!1});let mu=null;function gy(n,i){return n[i]??qE()}function Cp(n,i){const o=qE();o.producerNode?.length&&(n[i]=mu,o.lView=n,mu=GE())}const lh={...L0,consumerIsAlwaysLive:!0,consumerMarkedDirty:n=>{wf(n.lView)},lView:null};function GE(){return Object.create(lh)}function qE(){return mu??=GE(),mu}const hi={};function Fi(n,i=Ti.Default){const o=wn();return null===o?Kr(n,i):mw(Va(),o,qe(n),i)}function _y(n,i,o,l,h,m,_,b,I,C,A){const L=i.blueprint.slice();return L[An]=h,L[cr]=140|l,(null!==C||n&&2048&n[cr])&&(L[cr]|=2048),nw(L),L[Ii]=L[Xc]=n,L[Li]=o,L[sl]=_||n&&n[sl],L[ni]=b||n&&n[ni],L[Wc]=I||n&&n[Wc]||null,L[$s]=m,L[Ll]=function Vw(){return R_++}(),L[ll]=A,L[rc]=C,L[Bo]=2==i.type?n[Bo]:L,L}function _d(n,i,o,l,h){let m=n.data[i];if(null===m)m=function Zo(n,i,o,l,h){const m=p_(),_=Jc(),I=n.data[i]=function YE(n,i,o,l,h,m){let _=i?i.injectorIndex:-1,b=0;return function kn(){return null!==$r.skipHydrationRootTNode}()&&(b|=128),{type:o,index:l,insertBeforeIndex:null,injectorIndex:_,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:b,providerIndexes:0,value:h,attrs:m,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:i,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,_?m:m&&m.parent,o,i,l,h);return null===n.firstChild&&(n.firstChild=I),null!==m&&(_?null==m.child&&null!==I.parent&&(m.child=I):null===m.next&&(m.next=I,I.prev=m)),I}(n,i,o,l,h),function Am(){return $r.lFrame.inI18n}()&&(m.flags|=32);else if(64&m.type){m.type=o,m.value=l,m.attrs=h;const _=function Gf(){const n=$r.lFrame,i=n.currentTNode;return n.isParent?i:i.parent}();m.injectorIndex=null===_?-1:_.injectorIndex}return fa(m,!0),m}function Sp(n,i,o,l){if(0===o)return-1;const h=i.length;for(let m=0;m<o;m++)i.push(l),n.blueprint.push(l),n.data.push(null);return h}function Mp(n,i,o,l,h){const m=gy(i,ca),_=function cl(){return $r.lFrame.selectedIndex}(),b=2&l;try{Ao(-1),b&&i.length>ci&&function $E(n,i,o,l){if(!l)if(3==(3&i[cr])){const m=n.preOrderCheckHooks;null!==m&&op(i,m,o)}else{const m=n.preOrderHooks;null!==m&&sp(i,m,0,o)}Ao(o)}(n,i,ci,!1),Ic(b?2:0,h);const C=b?m:null,A=Em(C);try{null!==C&&(C.dirty=!1),o(l,h)}finally{Qd(C,A)}}finally{b&&null===i[ca]&&Cp(i,ca),Ao(_),Ic(b?3:1,h)}}function Ef(n,i,o){if(w(i)){const l=ic(null);try{const m=i.directiveEnd;for(let _=i.directiveStart;_<m;_++){const b=n.data[_];b.contentQueries&&b.contentQueries(1,o[_],_)}}finally{ic(l)}}}function HE(n){const i=n.tView;return null===i||i.incompleteFirstPass?n.tView=yy(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):i}function yy(n,i,o,l,h,m,_,b,I,C,A){const L=ci+l,F=L+h,z=function ZE(n,i){const o=[];for(let l=0;l<i;l++)o.push(l<n?null:hi);return o}(L,F),tt="function"==typeof C?C():C;return z[$n]={type:n,blueprint:z,template:o,queries:null,viewQuery:b,declTNode:i,data:z.slice().fill(null,L),bindingStartIndex:L,expandoStartIndex:F,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof m?m():m,pipeRegistry:"function"==typeof _?_():_,firstChild:null,schemas:I,consts:tt,incompleteFirstPass:!1,ssrId:A}}let d1=n=>null;function uh(n,i,o,l){for(let h in n)if(n.hasOwnProperty(h)){o=null===o?{}:o;const m=n[h];null===l?p1(o,i,h,m):l.hasOwnProperty(h)&&p1(o,i,l[h],m)}return o}function p1(n,i,o,l){n.hasOwnProperty(o)?n[o].push(i,l):n[o]=[i,l]}function by(n,i,o,l,h,m){for(let C=0;C<l.length;C++)Q0(km(o,i),n,l[C].type);!function nI(n,i,o){n.flags|=1,n.directiveStart=i,n.directiveEnd=i+o,n.providerIndexes=i}(o,n.data.length,l.length);for(let C=0;C<l.length;C++){const A=l[C];A.providersResolver&&A.providersResolver(A)}let _=!1,b=!1,I=Sp(n,i,l.length,null);for(let C=0;C<l.length;C++){const A=l[C];o.mergedAttrs=Ji(o.mergedAttrs,A.hostAttrs),wy(n,o,i,I,A),If(I,A,h),null!==A.contentQueries&&(o.flags|=4),(null!==A.hostBindings||null!==A.hostAttrs||0!==A.hostVars)&&(o.flags|=64);const L=A.type.prototype;!_&&(L.ngOnChanges||L.ngOnInit||L.ngDoCheck)&&((n.preOrderHooks??=[]).push(o.index),_=!0),!b&&(L.ngOnChanges||L.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(o.index),b=!0),I++}!function JE(n,i,o){const h=i.directiveEnd,m=n.data,_=i.attrs,b=[];let I=null,C=null;for(let A=i.directiveStart;A<h;A++){const L=m[A],F=o?o.get(L):null,tt=F?F.outputs:null;I=uh(L.inputs,A,I,F?F.inputs:null),C=uh(L.outputs,A,C,tt);const Y=null===I||null===_||As(i)?null:ED(I,A,_);b.push(Y)}null!==I&&(I.hasOwnProperty("class")&&(i.flags|=8),I.hasOwnProperty("style")&&(i.flags|=16)),i.initialInputs=b,i.inputs=I,i.outputs=C}(n,o,m)}function Dp(n,i,o){const l=o.directiveStart,h=o.directiveEnd,m=o.index,_=function mT(){return $r.lFrame.currentDirectiveIndex}();try{Ao(m);for(let b=l;b<h;b++){const I=n.data[b],C=i[b];lf(b),(null!==I.hostBindings||0!==I.hostVars||null!==I.hostAttrs)&&tI(I,C)}}finally{Ao(-1),lf(_)}}function tI(n,i){null!==n.hostBindings&&n.hostBindings(1,i)}function qu(n,i,o){i.componentOffset=o,(n.components??=[]).push(i.index)}function If(n,i,o){if(o){if(i.exportAs)for(let l=0;l<i.exportAs.length;l++)o[i.exportAs[l]]=n;q(i)&&(o[""]=n)}}function wy(n,i,o,l,h){n.data[l]=h;const m=h.factory||(h.factory=of(h.type)),_=new Zf(m,q(h),Fi);n.blueprint[l]=_,o[l]=_,function _u(n,i,o,l,h){const m=h.hostBindings;if(m){let _=n.hostBindingOpCodes;null===_&&(_=n.hostBindingOpCodes=[]);const b=~i.index;(function m1(n){let i=n.length;for(;i>0;){const o=n[--i];if("number"==typeof o&&o<0)return o}return 0})(_)!=b&&_.push(b),_.push(o,l,m)}}(n,i,l,Sp(n,o,h.hostVars,hi),h)}function wD(n,i,o,l,h,m){const _=m[i];if(null!==_)for(let b=0;b<_.length;)iI(l,o,_[b++],_[b++],_[b++])}function iI(n,i,o,l,h){const m=ic(null);try{const _=n.inputTransforms;null!==_&&_.hasOwnProperty(l)&&(h=_[l].call(i,h)),null!==n.setInput?n.setInput(i,h,o,l):i[l]=h}finally{ic(m)}}function ED(n,i,o){let l=null,h=0;for(;h<o.length;){const m=o[h];if(0!==m)if(5!==m){if("number"==typeof m)break;if(n.hasOwnProperty(m)){null===l&&(l=[]);const _=n[m];for(let b=0;b<_.length;b+=2)if(_[b]===i){l.push(m,_[b+1],o[h+1]);break}}h+=2}else h+=2;else h+=4}return l}function vd(n,i){const o=n.contentQueries;if(null!==o)for(let l=0;l<o.length;l+=2){const m=o[l+1];if(-1!==m){const _=n.data[m];Xn(o[l]),_.contentQueries(2,i[m],m)}}}function Lp(n,i){return n[Au]?n[Yd][ol]=i:n[Au]=i,n[Yd]=i,i}function g1(n,i,o){Xn(0);const l=ic(null);try{i(n,o)}finally{ic(l)}}function ch(n,i,o,l,h){for(let m=0;m<o.length;){const _=o[m++],b=o[m++];iI(n.data[_],i[_],l,b,h)}}function lI(n,i){const o=ku(i,n),l=o[$n];!function Iy(n,i){for(let o=i.length;o<n.blueprint.length;o++)i.push(n.blueprint[o])}(l,o);const h=o[An];null!==h&&null===o[ll]&&(o[ll]=vf(h,o[Wc])),_g(l,o,o[Li])}function _g(n,i,o){ip(i);try{const l=n.viewQuery;null!==l&&g1(1,l,o);const h=n.template;null!==h&&Mp(n,i,h,1,o),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&vd(n,i),n.staticViewQueries&&g1(2,n.viewQuery,o);const m=n.components;null!==m&&function ID(n,i){for(let o=0;o<i.length;o++)lI(n,i[o])}(i,m)}catch(l){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),l}finally{i[cr]&=-5,$l()}}let _1=(()=>{class n{constructor(){this.all=new Set,this.queue=new Map}create(o,l,h){const m=typeof Zone>"u"?null:Zone.current,_=function F0(n,i,o){const l=Object.create(Wb);o&&(l.consumerAllowSignalWrites=!0),l.fn=n,l.schedule=i;const h=_=>{l.cleanupFn=_};return l.ref={notify:()=>Gb(l),run:()=>{if(l.dirty=!1,l.hasRun&&!Mh(l))return;l.hasRun=!0;const _=Em(l);try{l.cleanupFn(),l.cleanupFn=k0,l.fn(h)}finally{Qd(l,_)}},cleanup:()=>l.cleanupFn()},l.ref}(o,C=>{this.all.has(C)&&this.queue.set(C,m)},h);let b;this.all.add(_),_.notify();const I=()=>{_.cleanup(),b?.(),this.all.delete(_),this.queue.delete(_)};return b=l?.onDestroy(I),{destroy:I}}flush(){if(0!==this.queue.size)for(const[o,l]of this.queue)this.queue.delete(o),l?l.run(()=>o.run()):o.run()}get isQueueEmpty(){return 0===this.queue.size}static#t=this.\u0275prov=Ko({token:n,providedIn:"root",factory:()=>new n})}return n})();function yg(n,i,o){let l=o?n.styles:null,h=o?n.classes:null,m=0;if(null!==i)for(let _=0;_<i.length;_++){const b=i[_];"number"==typeof b?m=b:1==m?h=he(h,b):2==m&&(l=he(l,b+": "+i[++_]+";"))}o?n.styles=l:n.stylesWithoutHost=l,o?n.classes=h:n.classesWithoutHost=h}function Rp(n,i,o,l,h=!1){for(;null!==o;){const m=i[o.index];null!==m&&l.push(ks(m)),v(m)&&y1(m,l);const _=o.type;if(8&_)Rp(n,i,o.child,l);else if(32&_){const b=z_(o,i);let I;for(;I=b();)l.push(I)}else if(16&_){const b=zh(i,o);if(Array.isArray(b))l.push(...b);else{const I=hp(i[Bo]);Rp(I[$n],I,b,l,!0)}}o=h?o.projectionNext:o.next}return l}function y1(n,i){for(let o=ha;o<n.length;o++){const l=n[o],h=l[$n].firstChild;null!==h&&Rp(l[$n],l,h,i)}n[Ru]!==n[An]&&i.push(n[Ru])}function Cy(n,i,o,l=!0){const h=i[sl],m=h.rendererFactory,_=h.afterRenderEventManager;m.begin?.(),_?.begin();try{Np(n,i,n.template,o)}catch(I){throw l&&function Op(n,i){const o=n[Wc],l=o?o.get(Nc,null):null;l&&l.handleError(i)}(i,I),I}finally{m.end?.(),h.effectManager?.flush(),_?.end()}}function Np(n,i,o,l){const h=i[cr];if(256!=(256&h)){i[sl].effectManager?.flush(),ip(i);try{nw(i),function ss(n){return $r.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==o&&Mp(n,i,o,2,l);const _=3==(3&h);if(_){const C=n.preOrderCheckHooks;null!==C&&op(i,C,null)}else{const C=n.preOrderHooks;null!==C&&sp(i,C,0,null),Om(i,0)}if(function vg(n){for(let i=Xm(n);null!==i;i=kr(i)){if(!i[Da])continue;const o=i[os];for(let l=0;l<o.length;l++){Cc(o[l])}}}(i),Fp(i,2),null!==n.contentQueries&&vd(n,i),_){const C=n.contentCheckHooks;null!==C&&op(i,C)}else{const C=n.contentHooks;null!==C&&sp(i,C,1),Om(i,1)}!function gD(n,i){const o=n.hostBindingOpCodes;if(null===o)return;const l=gy(i,Tr);try{for(let h=0;h<o.length;h++){const m=o[h];if(m<0)Ao(~m);else{const _=m,b=o[++h],I=o[++h];lw(b,_),l.dirty=!1;const C=Em(l);try{I(2,i[_])}finally{Qd(l,C)}}}}finally{null===i[Tr]&&Cp(i,Tr),Ao(-1)}}(n,i);const b=n.components;null!==b&&uI(i,b,0);const I=n.viewQuery;if(null!==I&&g1(2,I,l),_){const C=n.viewCheckHooks;null!==C&&op(i,C)}else{const C=n.viewHooks;null!==C&&sp(i,C,2),Om(i,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),i[cr]&=-73,Tm(i)}finally{$l()}}}function Fp(n,i){for(let o=Xm(n);null!==o;o=kr(o))for(let l=ha;l<o.length;l++)bg(o[l],i)}function xg(n,i,o){bg(ku(i,n),o)}function bg(n,i){if(!function U0(n){return 128==(128&n[cr])}(n))return;const o=n[$n],l=n[cr];if(80&l&&0===i||1024&l||2===i)Np(o,n,o.template,n[Li]);else if(n[ua]>0){Fp(n,1);const h=o.components;null!==h&&uI(n,h,1)}}function uI(n,i,o){for(let l=0;l<i.length;l++)xg(n,i[l],o)}class wg{get rootNodes(){const i=this._lView,o=i[$n];return Rp(o,i,o.firstChild,[])}constructor(i,o){this._lView=i,this._cdRefInjectingView=o,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Li]}set context(i){this._lView[Li]=i}get destroyed(){return 256==(256&this._lView[cr])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const i=this._lView[Ii];if(v(i)){const o=i[8],l=o?o.indexOf(this):-1;l>-1&&(function Oi(n,i){if(n.length<=ha)return;const o=ha+i,l=n[o];if(l){const h=l[Pu];null!==h&&h!==n&&j_(h,l),i>0&&(n[o-1][ol]=l[ol]);const m=na(n,ha+i);!function Qw(n,i){si(n,i,i[ni],2,null,null),i[An]=null,i[$s]=null}(l[$n],l);const _=m[al];null!==_&&_.detachView(m[$n]),l[Ii]=null,l[ol]=null,l[cr]&=-129}return l}(i,l),na(o,l))}this._attachedToViewContainer=!1}!function gv(n,i){if(!(256&i[cr])){const o=i[ni];i[ca]&&u_(i[ca]),i[Tr]&&u_(i[Tr]),o.destroyNode&&si(n,i,o,3,null,null),function nE(n){let i=n[Au];if(!i)return _v(n[$n],n);for(;i;){let o=null;if(d(i))o=i[Au];else{const l=i[ha];l&&(o=l)}if(!o){for(;i&&!i[ol]&&i!==n;)d(i)&&_v(i[$n],i),i=i[Ii];null===i&&(i=n),d(i)&&_v(i[$n],i),o=i&&i[ol]}i=o}}(i)}}(this._lView[$n],this._lView)}onDestroy(i){!function Ph(n,i){if(256==(256&n[cr]))throw new Ke(911,!1);null===n[El]&&(n[El]=[]),n[El].push(i)}(this._lView,i)}markForCheck(){wf(this._cdRefInjectingView||this._lView)}detach(){this._lView[cr]&=-129}reattach(){this._lView[cr]|=128}detectChanges(){Cy(this._lView[$n],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Ke(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function eE(n,i){si(n,i,i[ni],2,null,null)}(this._lView[$n],this._lView)}attachToAppRef(i){if(this._attachedToViewContainer)throw new Ke(902,!1);this._appRef=i}}class kp extends wg{constructor(i){super(i),this._view=i}detectChanges(){const i=this._view;Cy(i[$n],i,i[Li],!1)}checkNoChanges(){}get context(){return null}}class Eg extends fd{constructor(i){super(),this.ngModule=i}resolveComponentFactory(i){const o=Wr(i);return new Ig(o,this.ngModule)}}function cI(n){const i=[];for(let o in n)n.hasOwnProperty(o)&&i.push({propName:n[o],templateName:o});return i}class fI{constructor(i,o){this.injector=i,this.parentInjector=o}get(i,o,l){l=cs(l);const h=this.injector.get(i,cy,l);return h!==cy||o===cy?h:this.parentInjector.get(i,o,l)}}class Ig extends dg{get inputs(){const i=this.componentDef,o=i.inputTransforms,l=cI(i.inputs);if(null!==o)for(const h of l)o.hasOwnProperty(h.propName)&&(h.transform=o[h.propName]);return l}get outputs(){return cI(this.componentDef.outputs)}constructor(i,o){super(),this.componentDef=i,this.ngModule=o,this.componentType=i.type,this.selector=function qi(n){return n.map(ko).join(",")}(i.selectors),this.ngContentSelectors=i.ngContentSelectors?i.ngContentSelectors:[],this.isBoundToModule=!!o}create(i,o,l,h){let m=(h=h||this.ngModule)instanceof uc?h:h?.injector;m&&null!==this.componentDef.getStandaloneInjector&&(m=this.componentDef.getStandaloneInjector(m)||m);const _=m?new fI(i,m):i,b=_.get(ME,null);if(null===b)throw new Ke(407,!1);const L={rendererFactory:b,sanitizer:_.get(tD,null),effectManager:_.get(_1,null),afterRenderEventManager:_.get(h1,null)},F=b.createRenderer(null,this.componentDef),z=this.componentDef.selectors[0][0]||"div",tt=l?function _D(n,i,o,l){const m=l.get(my,!1)||o===gs.ShadowDom,_=n.selectRootElement(i,m);return function WE(n){d1(n)}(_),_}(F,l,this.componentDef.encapsulation,_):Jm(F,z,function hI(n){const i=n.toLowerCase();return"svg"===i?"svg":"math"===i?"math":null}(z)),_t=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let X=null;null!==tt&&(X=vf(tt,_,!0));const bt=yy(0,null,null,1,0,null,null,null,null,null,null),te=_y(null,bt,null,_t,null,null,L,F,_,null,X);let re,Ae;ip(te);try{const De=this.componentDef;let He,Qt=null;De.findHostDirectiveDefs?(He=[],Qt=new Map,De.findHostDirectiveDefs(De,He,Qt),He.push(De)):He=[De];const Or=function SD(n,i){const o=n[$n],l=ci;return n[l]=i,_d(o,l,2,"#host",null)}(te,tt),er=function pI(n,i,o,l,h,m,_){const b=h[$n];!function MD(n,i,o,l){for(const h of n)i.mergedAttrs=Ji(i.mergedAttrs,h.hostAttrs);null!==i.mergedAttrs&&(yg(i,i.mergedAttrs,!0),null!==o&&Ev(l,o,i))}(l,n,i,_);let I=null;null!==i&&(I=vf(i,h[Wc]));const C=m.rendererFactory.createRenderer(i,o);let A=16;o.signals?A=4096:o.onPush&&(A=64);const L=_y(h,HE(o),null,A,h[n.index],n,m,C,null,null,I);return b.firstCreatePass&&qu(b,n,l.length-1),Lp(h,L),h[n.index]=L}(Or,tt,De,He,te,L,F);Ae=function ew(n,i){return n.data[i]}(bt,ci),tt&&function TD(n,i,o,l){if(l)Xi(n,o,["ng-version",eD.full]);else{const{attrs:h,classes:m}=function Ua(n){const i=[],o=[];let l=1,h=2;for(;l<n.length;){let m=n[l];if("string"==typeof m)2===h?""!==m&&i.push(m,n[++l]):8===h&&o.push(m);else{if(!Bi(h))break;h=m}l++}return{attrs:i,classes:o}}(i.selectors[0]);h&&Xi(n,o,h),m&&m.length>0&&wv(n,o,m.join(" "))}}(F,De,tt,l),void 0!==o&&function v1(n,i,o){const l=n.projection=[];for(let h=0;h<i.length;h++){const m=o[h];l.push(null!=m?Array.from(m):null)}}(Ae,this.ngContentSelectors,o),re=function Sy(n,i,o,l,h,m){const _=Va(),b=h[$n],I=cu(_,h);by(b,h,_,o,null,l);for(let A=0;A<o.length;A++)kl(Xf(h,b,_.directiveStart+A,_),h);Dp(b,h,_),I&&kl(I,h);const C=Xf(h,b,_.directiveStart+_.componentOffset,_);if(n[Li]=h[Li]=C,null!==m)for(const A of m)A(C,i);return Ef(b,_,n),C}(er,De,He,Qt,te,[mI]),_g(bt,te,null)}finally{$l()}return new dI(this.componentType,re,xp(Ae,te),te,Ae)}}class dI extends Jv{constructor(i,o,l,h,m){super(),this.location=l,this._rootLView=h,this._tNode=m,this.previousInputValues=null,this.instance=o,this.hostView=this.changeDetectorRef=new kp(h),this.componentType=i}setInput(i,o){const l=this._tNode.inputs;let h;if(null!==l&&(h=l[i])){if(this.previousInputValues??=new Map,this.previousInputValues.has(i)&&Object.is(this.previousInputValues.get(i),o))return;const m=this._rootLView;ch(m[$n],m,h,i,o),this.previousInputValues.set(i,o),wf(ku(this._tNode.index,m))}}get injector(){return new Rl(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(i){this.hostView.onDestroy(i)}}function mI(){const n=Va();Hf(wn()[$n],n)}function M1(n,i,o,l,h){const _=h?"class":"style";ch(n,o,i.inputs[_],_,l)}function Md(n,i,o,l){const h=wn(),m=Uo(),_=ci+n,b=h[ni],I=m.firstCreatePass?function XD(n,i,o,l,h,m){const _=i.consts,I=_d(i,n,2,l,af(_,h));return function xy(n,i,o,l){if(Vf()){const h=null===l?null:{"":-1},m=function eI(n,i){const o=n.directiveRegistry;let l=null,h=null;if(o)for(let m=0;m<o.length;m++){const _=o[m];if(nl(i,_.selectors,!1))if(l||(l=[]),q(_))if(null!==_.findHostDirectiveDefs){const b=[];h=h||new Map,_.findHostDirectiveDefs(_,b,h),l.unshift(...b,_),qu(n,i,b.length)}else l.unshift(_),qu(n,i,0);else h=h||new Map,_.findHostDirectiveDefs?.(_,l,h),l.push(_)}return null===l?null:[l,h]}(n,o);let _,b;null===m?_=b=null:[_,b]=m,null!==_&&by(n,i,o,_,h,b),h&&function Ap(n,i,o){if(i){const l=n.localNames=[];for(let h=0;h<i.length;h+=2){const m=o[i[h+1]];if(null==m)throw new Ke(-301,!1);l.push(i[h],m)}}}(o,l,h)}o.mergedAttrs=Ji(o.mergedAttrs,o.attrs)}(i,o,I,af(_,m)),null!==I.attrs&&yg(I,I.attrs,!1),null!==I.mergedAttrs&&yg(I,I.mergedAttrs,!0),null!==i.queries&&i.queries.elementStart(i,I),I}(_,m,h,i,o,l):m.data[_],C=T1(m,h,I,b,i,n);h[_]=C;const A=function k(n){return 1==(1&n.flags)}(I);return fa(I,!0),Ev(b,C,I),32!=(32&I.flags)&&oc()&&nd(m,h,C,I),0===function iw(){return $r.lFrame.elementDepthCount}()&&kl(C,h),function ow(){$r.lFrame.elementDepthCount++}(),A&&(function gg(n,i,o){Vf()&&(function QE(n,i,o,l){const h=o.directiveStart,m=o.directiveEnd;T(o)&&function rI(n,i,o){const l=cu(i,n),h=HE(o);let _=16;o.signals?_=4096:o.onPush&&(_=64);const b=Lp(n,_y(n,h,null,_,l,i,null,n[sl].rendererFactory.createRenderer(l,o),null,null,null));n[i.index]=b}(i,o,n.data[h+o.componentOffset]),n.firstCreatePass||km(o,i),kl(l,i);const _=o.initialInputs;for(let b=h;b<m;b++){const I=n.data[b],C=Xf(i,n,b,o);kl(C,i),null!==_&&wD(0,b-h,C,I,0,_),q(I)&&(ku(o.index,i)[Li]=Xf(i,n,b,o))}}(n,i,o,cu(o,i)),64==(64&o.flags)&&Dp(n,i,o))}(m,h,I),Ef(m,I,h)),null!==l&&function Tp(n,i,o=cu){const l=i.localNames;if(null!==l){let h=i.index+1;for(let m=0;m<l.length;m+=2){const _=l[m+1],b=-1===_?o(i,n):n[_];n[h++]=b}}}(h,I),Md}function Td(){let n=Va();Jc()?function m_(){$r.lFrame.isParent=!1}():(n=n.parent,fa(n,!1));const i=n;(function j0(n){return $r.skipHydrationRootTNode===n})(i)&&function sw(){$r.skipHydrationRootTNode=null}(),function rp(){$r.lFrame.elementDepthCount--}();const o=Uo();return o.firstCreatePass&&(Hf(o,n),w(n)&&o.queries.elementEnd(n)),null!=i.classesWithoutHost&&function Wf(n){return 0!=(8&n.flags)}(i)&&M1(o,i,wn(),i.classesWithoutHost,!0),null!=i.stylesWithoutHost&&function W0(n){return 0!=(16&n.flags)}(i)&&M1(o,i,wn(),i.stylesWithoutHost,!1),Td}function Dd(n,i,o,l){return Md(n,i,o,l),Td(),Dd}let T1=(n,i,o,l,h,m)=>(Hl(!0),Jm(l,h,function y_(){return $r.lFrame.currentNamespace}()));function A1(n){return!!n&&"function"==typeof n.then}function Ag(n){return!!n&&"function"==typeof n.subscribe}function Gy(n,i=""){const o=wn(),l=Uo(),h=n+ci,m=l.firstCreatePass?_d(l,h,1,i,null):l.data[h],_=Z1(l,o,m,i,n);o[h]=_,oc()&&nd(l,o,_,m),fa(m,!1)}let Z1=(n,i,o,l,h)=>(Hl(!0),function Ym(n,i){return n.createText(i)}(i[ni],l));const Rd="en-US";let vC=Rd;class Zh{}class BC{}class Sx extends Zh{constructor(i,o,l){super(),this._parent=o,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Eg(this);const h=function yi(n,i){const o=n[Ih]||null;if(!o&&!0===i)throw new Error(`Type ${qt(n)} does not have '\u0275mod' property.`);return o}(i);this._bootstrapComponents=function ah(n){return n instanceof Function?n():n}(h.bootstrap),this._r3Injector=i1(i,o,[{provide:Zh,useValue:this},{provide:fd,useValue:this.componentFactoryResolver},...l],qt(i),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(i)}get injector(){return this._r3Injector}destroy(){const i=this._r3Injector;!i.destroyed&&i.destroy(),this.destroyCbs.forEach(o=>o()),this.destroyCbs=null}onDestroy(i){this.destroyCbs.push(i)}}class Mx extends BC{constructor(i){super(),this.moduleType=i}create(i){return new Sx(this.moduleType,i,[])}}Symbol;const RA=new dr("Application Initializer");let p0=(()=>{class n{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((o,l)=>{this.resolve=o,this.reject=l}),this.appInits=mi(RA,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const o=[];for(const h of this.appInits){const m=h();if(A1(m))o.push(m);else if(Ag(m)){const _=new Promise((b,I)=>{m.subscribe({complete:b,error:I})});o.push(_)}}const l=()=>{this.done=!0,this.resolve()};Promise.all(o).then(()=>{l()}).catch(h=>{this.reject(h)}),0===o.length&&l(),this.initialized=!0}static#t=this.\u0275fac=function(l){return new(l||n)};static#e=this.\u0275prov=Ko({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const Yh=new dr("LocaleId",{providedIn:"root",factory:()=>mi(Yh,Ti.Optional|Ti.SkipSelf)||function rb(){return typeof $localize<"u"&&$localize.locale||Rd}()});let kA=(()=>{class n{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new bi(!1)}add(){this.hasPendingTasks.next(!0);const o=this.taskId++;return this.pendingTasks.add(o),o}remove(o){this.pendingTasks.delete(o),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#t=this.\u0275fac=function(l){return new(l||n)};static#e=this.\u0275prov=Ko({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const r=new dr(""),s=new dr("");let p,a=(()=>{class n{constructor(o,l,h){this._ngZone=o,this.registry=l,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,p||(function c(n){p=n}(h),h.addToWindow(l)),this._watchAngularEvents(),o.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{wa.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let o=this._callbacks.pop();clearTimeout(o.timeoutId),o.doneCb(this._didWork)}this._didWork=!1});else{let o=this.getPendingTasks();this._callbacks=this._callbacks.filter(l=>!l.updateCb||!l.updateCb(o)||(clearTimeout(l.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(o=>({source:o.source,creationLocation:o.creationLocation,data:o.data})):[]}addCallback(o,l,h){let m=-1;l&&l>0&&(m=setTimeout(()=>{this._callbacks=this._callbacks.filter(_=>_.timeoutId!==m),o(this._didWork,this.getPendingTasks())},l)),this._callbacks.push({doneCb:o,timeoutId:m,updateCb:h})}whenStable(o,l,h){if(h&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(o,l,h),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(o){this.registry.registerApplication(o,this)}unregisterApplication(o){this.registry.unregisterApplication(o)}findProviders(o,l,h){return[]}static#t=this.\u0275fac=function(l){return new(l||n)(Kr(wa),Kr(u),Kr(s))};static#e=this.\u0275prov=Ko({token:n,factory:n.\u0275fac})}return n})(),u=(()=>{class n{constructor(){this._applications=new Map}registerApplication(o,l){this._applications.set(o,l)}unregisterApplication(o){this._applications.delete(o)}unregisterAllApplications(){this._applications.clear()}getTestability(o){return this._applications.get(o)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(o,l=!0){return p?.findTestabilityInTree(this,o,l)??null}static#t=this.\u0275fac=function(l){return new(l||n)};static#e=this.\u0275prov=Ko({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})(),g=null;const y=new dr("AllowMultipleToken"),x=new dr("PlatformDestroyListeners"),E=new dr("appBootstrapListener");function U(n,i,o=[]){const l=`Platform: ${i}`,h=new dr(l);return(m=[])=>{let _=et();if(!_||_.injector.get(y,!1)){const b=[...o,...m,{provide:h,useValue:!0}];n?n(b):function R(n){if(g&&!g.get(y,!1))throw new Ke(400,!1);(function D(){!function $b(n){c_=n}(()=>{throw new Ke(600,!1)})})(),g=n;const i=n.get(it);(function j(n){n.get(Gv,null)?.forEach(o=>o())})(n)}(function Z(n=[],i){return sh.create({name:i,providers:[{provide:ty,useValue:"platform"},{provide:x,useValue:new Set([()=>g=null])},...n]})}(b,l))}return function G(n){const i=et();if(!i)throw new Ke(401,!1);return i}()}}function et(){return g?.get(it)??null}let it=(()=>{class n{constructor(o){this._injector=o,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(o,l){const h=function xt(n="zone.js",i){return"noop"===n?new dy:"zone.js"===n?new wa(i):n}(l?.ngZone,function yt(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}({eventCoalescing:l?.ngZoneEventCoalescing,runCoalescing:l?.ngZoneRunCoalescing}));return h.run(()=>{const m=function $2(n,i,o){return new Sx(n,i,o)}(o.moduleType,this.injector,function xe(n){return[{provide:wa,useFactory:n},{provide:ag,multi:!0,useFactory:()=>{const i=mi(ge,{optional:!0});return()=>i.initialize()}},{provide:Bt,useFactory:Zt},{provide:RE,useFactory:u1}]}(()=>h)),_=m.injector.get(Nc,null);return h.runOutsideAngular(()=>{const b=h.onError.subscribe({next:I=>{_.handleError(I)}});m.onDestroy(()=>{Wt(this._modules,m),b.unsubscribe()})}),function Nt(n,i,o){try{const l=o();return A1(l)?l.catch(h=>{throw i.runOutsideAngular(()=>n.handleError(h)),h}):l}catch(l){throw i.runOutsideAngular(()=>n.handleError(l)),l}}(_,h,()=>{const b=m.injector.get(p0);return b.runInitializers(),b.donePromise.then(()=>(function $y(n){Ma(n,"Expected localeId to be defined"),"string"==typeof n&&(vC=n.toLowerCase().replace(/_/g,"-"))}(m.injector.get(Yh,Rd)||Rd),this._moduleDoBootstrap(m),m))})})}bootstrapModule(o,l=[]){const h=ft({},l);return function S(n,i,o){const l=new Mx(o);return Promise.resolve(l)}(0,0,o).then(m=>this.bootstrapModuleFactory(m,h))}_moduleDoBootstrap(o){const l=o.injector.get(Ut);if(o._bootstrapComponents.length>0)o._bootstrapComponents.forEach(h=>l.bootstrap(h));else{if(!o.instance.ngDoBootstrap)throw new Ke(-403,!1);o.instance.ngDoBootstrap(l)}this._modules.push(o)}onDestroy(o){this._destroyListeners.push(o)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Ke(404,!1);this._modules.slice().forEach(l=>l.destroy()),this._destroyListeners.forEach(l=>l());const o=this._injector.get(x,null);o&&(o.forEach(l=>l()),o.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#t=this.\u0275fac=function(l){return new(l||n)(Kr(sh))};static#e=this.\u0275prov=Ko({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();function ft(n,i){return Array.isArray(i)?i.reduce(ft,n):{...n,...i}}let Ut=(()=>{class n{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=mi(Bt),this.zoneIsStable=mi(RE),this.componentTypes=[],this.components=[],this.isStable=mi(kA).hasPendingTasks.pipe(function Hn(n,i){return Ln((o,l)=>{let h=null,m=0,_=!1;const b=()=>_&&!h&&l.complete();o.subscribe(On(l,I=>{h?.unsubscribe();let C=0;const A=m++;mr(n(I,A)).subscribe(h=On(l,L=>l.next(i?i(I,L,A,C++):L),()=>{h=null,b()}))},()=>{_=!0,b()}))})}(o=>o?function ru(...n){return Qu(n,jl(n))}(!1):this.zoneIsStable),function gl(n,i=en){return n=n??N,Ln((o,l)=>{let h,m=!0;o.subscribe(On(l,_=>{const b=i(_);(m||!n(h,b))&&(m=!1,h=b,l.next(_))}))})}(),Ka()),this._injector=mi(uc)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(o,l){const h=o instanceof dg;if(!this._injector.get(p0).done)throw!h&&function la(n){const i=Wr(n)||Oo(n)||$i(n);return null!==i&&i.standalone}(o),new Ke(405,!1);let _;_=h?o:this._injector.get(fd).resolveComponentFactory(o),this.componentTypes.push(_.componentType);const b=function P(n){return n.isBoundToModule}(_)?void 0:this._injector.get(Zh),C=_.create(sh.NULL,[],l||_.selector,b),A=C.location.nativeElement,L=C.injector.get(r,null);return L?.registerApplication(A),C.onDestroy(()=>{this.detachView(C.hostView),Wt(this.components,C),L?.unregisterApplication(A)}),this._loadComponent(C),C}tick(){if(this._runningTick)throw new Ke(101,!1);try{this._runningTick=!0;for(let o of this._views)o.detectChanges()}catch(o){this.internalErrorHandler(o)}finally{this._runningTick=!1}}attachView(o){const l=o;this._views.push(l),l.attachToAppRef(this)}detachView(o){const l=o;Wt(this._views,l),l.detachFromAppRef()}_loadComponent(o){this.attachView(o.hostView),this.tick(),this.components.push(o);const l=this._injector.get(E,[]);l.push(...this._bootstrapListeners),l.forEach(h=>h(o))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(o=>o()),this._views.slice().forEach(o=>o.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(o){return this._destroyListeners.push(o),()=>Wt(this._destroyListeners,o)}destroy(){if(this._destroyed)throw new Ke(406,!1);const o=this._injector;o.destroy&&!o.destroyed&&o.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#t=this.\u0275fac=function(l){return new(l||n)};static#e=this.\u0275prov=Ko({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Wt(n,i){const o=n.indexOf(i);o>-1&&n.splice(o,1)}const Bt=new dr("",{providedIn:"root",factory:()=>mi(Nc).handleError.bind(void 0)});function Zt(){const n=mi(wa),i=mi(Nc);return o=>n.runOutsideAngular(()=>i.handleError(o))}let ge=(()=>{class n{constructor(){this.zone=mi(wa),this.applicationRef=mi(Ut)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#t=this.\u0275fac=function(l){return new(l||n)};static#e=this.\u0275prov=Ko({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const Af=U(null,"core",[]);let fb=(()=>{class n{constructor(o){}static#t=this.\u0275fac=function(l){return new(l||n)(Kr(Ut))};static#e=this.\u0275mod=hs({type:n});static#n=this.\u0275inj=iu({})}return n})(),tP=null;function eP(){return tP}class JF{}const n_=new dr("DocumentToken");let zO=(()=>{class n{static#t=this.\u0275fac=function(l){return new(l||n)};static#e=this.\u0275mod=hs({type:n});static#n=this.\u0275inj=iu({})}return n})();function UO(n){return"server"===n}class j3 extends JF{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class yP extends j3{static makeCurrent(){!function YF(n){tP||(tP=n)}(new yP)}onAndCancel(i,o,l){return i.addEventListener(o,l),()=>{i.removeEventListener(o,l)}}dispatchEvent(i,o){i.dispatchEvent(o)}remove(i){i.parentNode&&i.parentNode.removeChild(i)}createElement(i,o){return(o=o||this.getDefaultDocument()).createElement(i)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(i){return i.nodeType===Node.ELEMENT_NODE}isShadowRoot(i){return i instanceof DocumentFragment}getGlobalEventTarget(i,o){return"window"===o?window:"document"===o?i:"body"===o?i.body:null}getBaseHref(i){const o=function V3(){return gb=gb||document.querySelector("base"),gb?gb.getAttribute("href"):null}();return null==o?null:function G3(n){hM=hM||document.createElement("a"),hM.setAttribute("href",n);const i=hM.pathname;return"/"===i.charAt(0)?i:`/${i}`}(o)}resetBaseElement(){gb=null}getUserAgent(){return window.navigator.userAgent}getCookie(i){return function kk(n,i){i=encodeURIComponent(i);for(const o of n.split(";")){const l=o.indexOf("="),[h,m]=-1==l?[o,""]:[o.slice(0,l),o.slice(l+1)];if(h.trim()===i)return decodeURIComponent(m)}return null}(document.cookie,i)}}let hM,gb=null,$3=(()=>{class n{build(){return new XMLHttpRequest}static#t=this.\u0275fac=function(l){return new(l||n)};static#e=this.\u0275prov=Ko({token:n,factory:n.\u0275fac})}return n})();const vP=new dr("EventManagerPlugins");let $O=(()=>{class n{constructor(o,l){this._zone=l,this._eventNameToPlugin=new Map,o.forEach(h=>{h.manager=this}),this._plugins=o.slice().reverse()}addEventListener(o,l,h){return this._findPluginFor(l).addEventListener(o,l,h)}getZone(){return this._zone}_findPluginFor(o){let l=this._eventNameToPlugin.get(o);if(l)return l;if(l=this._plugins.find(m=>m.supports(o)),!l)throw new Ke(5101,!1);return this._eventNameToPlugin.set(o,l),l}static#t=this.\u0275fac=function(l){return new(l||n)(Kr(vP),Kr(wa))};static#e=this.\u0275prov=Ko({token:n,factory:n.\u0275fac})}return n})();class HO{constructor(i){this._doc=i}}const xP="ng-app-id";let ZO=(()=>{class n{constructor(o,l,h,m={}){this.doc=o,this.appId=l,this.nonce=h,this.platformId=m,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=UO(m),this.resetHostNodes()}addStyles(o){for(const l of o)1===this.changeUsageCount(l,1)&&this.onStyleAdded(l)}removeStyles(o){for(const l of o)this.changeUsageCount(l,-1)<=0&&this.onStyleRemoved(l)}ngOnDestroy(){const o=this.styleNodesInDOM;o&&(o.forEach(l=>l.remove()),o.clear());for(const l of this.getAllStyles())this.onStyleRemoved(l);this.resetHostNodes()}addHost(o){this.hostNodes.add(o);for(const l of this.getAllStyles())this.addStyleToHost(o,l)}removeHost(o){this.hostNodes.delete(o)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(o){for(const l of this.hostNodes)this.addStyleToHost(l,o)}onStyleRemoved(o){const l=this.styleRef;l.get(o)?.elements?.forEach(h=>h.remove()),l.delete(o)}collectServerRenderedStyles(){const o=this.doc.head?.querySelectorAll(`style[${xP}="${this.appId}"]`);if(o?.length){const l=new Map;return o.forEach(h=>{null!=h.textContent&&l.set(h.textContent,h)}),l}return null}changeUsageCount(o,l){const h=this.styleRef;if(h.has(o)){const m=h.get(o);return m.usage+=l,m.usage}return h.set(o,{usage:l,elements:[]}),l}getStyleElement(o,l){const h=this.styleNodesInDOM,m=h?.get(l);if(m?.parentNode===o)return h.delete(l),m.removeAttribute(xP),m;{const _=this.doc.createElement("style");return this.nonce&&_.setAttribute("nonce",this.nonce),_.textContent=l,this.platformIsServer&&_.setAttribute(xP,this.appId),_}}addStyleToHost(o,l){const h=this.getStyleElement(o,l);o.appendChild(h);const m=this.styleRef,_=m.get(l)?.elements;_?_.push(h):m.set(l,{elements:[h],usage:1})}resetHostNodes(){const o=this.hostNodes;o.clear(),o.add(this.doc.head)}static#t=this.\u0275fac=function(l){return new(l||n)(Kr(n_),Kr(iy),Kr(oh,8),Kr(ad))};static#e=this.\u0275prov=Ko({token:n,factory:n.\u0275fac})}return n})();const bP={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},wP=/%COMP%/g,X3=new dr("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function XO(n,i){return i.map(o=>o.replace(wP,n))}let YO=(()=>{class n{constructor(o,l,h,m,_,b,I,C=null){this.eventManager=o,this.sharedStylesHost=l,this.appId=h,this.removeStylesOnCompDestroy=m,this.doc=_,this.platformId=b,this.ngZone=I,this.nonce=C,this.rendererByCompId=new Map,this.platformIsServer=UO(b),this.defaultRenderer=new EP(o,_,I,this.platformIsServer)}createRenderer(o,l){if(!o||!l)return this.defaultRenderer;this.platformIsServer&&l.encapsulation===gs.ShadowDom&&(l={...l,encapsulation:gs.Emulated});const h=this.getOrCreateRenderer(o,l);return h instanceof KO?h.applyToHost(o):h instanceof IP&&h.applyStyles(),h}getOrCreateRenderer(o,l){const h=this.rendererByCompId;let m=h.get(l.id);if(!m){const _=this.doc,b=this.ngZone,I=this.eventManager,C=this.sharedStylesHost,A=this.removeStylesOnCompDestroy,L=this.platformIsServer;switch(l.encapsulation){case gs.Emulated:m=new KO(I,C,l,this.appId,A,_,b,L);break;case gs.ShadowDom:return new Q3(I,C,o,l,_,b,this.nonce,L);default:m=new IP(I,C,l,A,_,b,L)}h.set(l.id,m)}return m}ngOnDestroy(){this.rendererByCompId.clear()}static#t=this.\u0275fac=function(l){return new(l||n)(Kr($O),Kr(ZO),Kr(iy),Kr(X3),Kr(n_),Kr(ad),Kr(wa),Kr(oh))};static#e=this.\u0275prov=Ko({token:n,factory:n.\u0275fac})}return n})();class EP{constructor(i,o,l,h){this.eventManager=i,this.doc=o,this.ngZone=l,this.platformIsServer=h,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(i,o){return o?this.doc.createElementNS(bP[o]||o,i):this.doc.createElement(i)}createComment(i){return this.doc.createComment(i)}createText(i){return this.doc.createTextNode(i)}appendChild(i,o){(JO(i)?i.content:i).appendChild(o)}insertBefore(i,o,l){i&&(JO(i)?i.content:i).insertBefore(o,l)}removeChild(i,o){i&&i.removeChild(o)}selectRootElement(i,o){let l="string"==typeof i?this.doc.querySelector(i):i;if(!l)throw new Ke(-5104,!1);return o||(l.textContent=""),l}parentNode(i){return i.parentNode}nextSibling(i){return i.nextSibling}setAttribute(i,o,l,h){if(h){o=h+":"+o;const m=bP[h];m?i.setAttributeNS(m,o,l):i.setAttribute(o,l)}else i.setAttribute(o,l)}removeAttribute(i,o,l){if(l){const h=bP[l];h?i.removeAttributeNS(h,o):i.removeAttribute(`${l}:${o}`)}else i.removeAttribute(o)}addClass(i,o){i.classList.add(o)}removeClass(i,o){i.classList.remove(o)}setStyle(i,o,l,h){h&(Ac.DashCase|Ac.Important)?i.style.setProperty(o,l,h&Ac.Important?"important":""):i.style[o]=l}removeStyle(i,o,l){l&Ac.DashCase?i.style.removeProperty(o):i.style[o]=""}setProperty(i,o,l){i[o]=l}setValue(i,o){i.nodeValue=o}listen(i,o,l){if("string"==typeof i&&!(i=eP().getGlobalEventTarget(this.doc,i)))throw new Error(`Unsupported event target ${i} for event ${o}`);return this.eventManager.addEventListener(i,o,this.decoratePreventDefault(l))}decoratePreventDefault(i){return o=>{if("__ngUnwrap__"===o)return i;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>i(o)):i(o))&&o.preventDefault()}}}function JO(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class Q3 extends EP{constructor(i,o,l,h,m,_,b,I){super(i,m,_,I),this.sharedStylesHost=o,this.hostEl=l,this.shadowRoot=l.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const C=XO(h.id,h.styles);for(const A of C){const L=document.createElement("style");b&&L.setAttribute("nonce",b),L.textContent=A,this.shadowRoot.appendChild(L)}}nodeOrShadowRoot(i){return i===this.hostEl?this.shadowRoot:i}appendChild(i,o){return super.appendChild(this.nodeOrShadowRoot(i),o)}insertBefore(i,o,l){return super.insertBefore(this.nodeOrShadowRoot(i),o,l)}removeChild(i,o){return super.removeChild(this.nodeOrShadowRoot(i),o)}parentNode(i){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(i)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class IP extends EP{constructor(i,o,l,h,m,_,b,I){super(i,m,_,b),this.sharedStylesHost=o,this.removeStylesOnCompDestroy=h,this.styles=I?XO(I,l.styles):l.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class KO extends IP{constructor(i,o,l,h,m,_,b,I){const C=h+"-"+l.id;super(i,o,l,m,_,b,I,C),this.contentAttr=function Y3(n){return"_ngcontent-%COMP%".replace(wP,n)}(C),this.hostAttr=function J3(n){return"_nghost-%COMP%".replace(wP,n)}(C)}applyToHost(i){this.applyStyles(),this.setAttribute(i,this.hostAttr,"")}createElement(i,o){const l=super.createElement(i,o);return super.setAttribute(l,this.contentAttr,""),l}}let tz=(()=>{class n extends HO{constructor(o){super(o)}supports(o){return!0}addEventListener(o,l,h){return o.addEventListener(l,h,!1),()=>this.removeEventListener(o,l,h)}removeEventListener(o,l,h){return o.removeEventListener(l,h)}static#t=this.\u0275fac=function(l){return new(l||n)(Kr(n_))};static#e=this.\u0275prov=Ko({token:n,factory:n.\u0275fac})}return n})();const QO=["alt","control","meta","shift"],ez={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},nz={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let rz=(()=>{class n extends HO{constructor(o){super(o)}supports(o){return null!=n.parseEventName(o)}addEventListener(o,l,h){const m=n.parseEventName(l),_=n.eventCallback(m.fullKey,h,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>eP().onAndCancel(o,m.domEventName,_))}static parseEventName(o){const l=o.toLowerCase().split("."),h=l.shift();if(0===l.length||"keydown"!==h&&"keyup"!==h)return null;const m=n._normalizeKey(l.pop());let _="",b=l.indexOf("code");if(b>-1&&(l.splice(b,1),_="code."),QO.forEach(C=>{const A=l.indexOf(C);A>-1&&(l.splice(A,1),_+=C+".")}),_+=m,0!=l.length||0===m.length)return null;const I={};return I.domEventName=h,I.fullKey=_,I}static matchEventFullKeyCode(o,l){let h=ez[o.key]||o.key,m="";return l.indexOf("code.")>-1&&(h=o.code,m="code."),!(null==h||!h)&&(h=h.toLowerCase()," "===h?h="space":"."===h&&(h="dot"),QO.forEach(_=>{_!==h&&(0,nz[_])(o)&&(m+=_+".")}),m+=h,m===l)}static eventCallback(o,l,h){return m=>{n.matchEventFullKeyCode(m,o)&&h.runGuarded(()=>l(m))}}static _normalizeKey(o){return"esc"===o?"escape":o}static#t=this.\u0275fac=function(l){return new(l||n)(Kr(n_))};static#e=this.\u0275prov=Ko({token:n,factory:n.\u0275fac})}return n})();const az=U(Af,"browser",[{provide:ad,useValue:"browser"},{provide:Gv,useValue:function iz(){yP.makeCurrent()},multi:!0},{provide:n_,useFactory:function sz(){return function Iv(n){pf=n}(document),document},deps:[]}]),lz=new dr(""),nR=[{provide:s,useClass:class q3{addToWindow(i){Zr.getAngularTestability=(l,h=!0)=>{const m=i.findTestabilityInTree(l,h);if(null==m)throw new Ke(5103,!1);return m},Zr.getAllAngularTestabilities=()=>i.getAllTestabilities(),Zr.getAllAngularRootElements=()=>i.getAllRootElements(),Zr.frameworkStabilizers||(Zr.frameworkStabilizers=[]),Zr.frameworkStabilizers.push(l=>{const h=Zr.getAllAngularTestabilities();let m=h.length,_=!1;const b=function(I){_=_||I,m--,0==m&&l(_)};h.forEach(I=>{I.whenStable(b)})})}findTestabilityInTree(i,o,l){return null==o?null:i.getTestability(o)??(l?eP().isShadowRoot(o)?this.findTestabilityInTree(i,o.host,!0):this.findTestabilityInTree(i,o.parentElement,!0):null)}},deps:[]},{provide:r,useClass:a,deps:[wa,u,s]},{provide:a,useClass:a,deps:[wa,u,s]}],rR=[{provide:ty,useValue:"root"},{provide:Nc,useFactory:function oz(){return new Nc},deps:[]},{provide:vP,useClass:tz,multi:!0,deps:[n_,wa,ad]},{provide:vP,useClass:rz,multi:!0,deps:[n_]},YO,ZO,$O,{provide:ME,useExisting:YO},{provide:class y3{},useClass:$3,deps:[]},[]];let uz=(()=>{class n{constructor(o){}static withServerTransition(o){return{ngModule:n,providers:[{provide:iy,useValue:o.appId}]}}static#t=this.\u0275fac=function(l){return new(l||n)(Kr(lz,12))};static#e=this.\u0275mod=hs({type:n});static#n=this.\u0275inj=iu({providers:[...rR,...nR],imports:[zO,fb]})}return n})();typeof window<"u"&&window;var SP=Tt(2574),gz=Tt(4357),_z=Tt.n(gz);function Hd(n,i,o){void 0===o&&(o={});var l={type:"Feature"};return(0===o.id||o.id)&&(l.id=o.id),o.bbox&&(l.bbox=o.bbox),l.properties=i||{},l.geometry=n,l}function fM(n,i,o){if(void 0===o&&(o={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!DP(n[0])||!DP(n[1]))throw new Error("coordinates must contain numbers");return Hd({type:"Point",coordinates:n},i,o)}function dM(n,i,o){void 0===o&&(o={});for(var l=0,h=n;l<h.length;l++){var m=h[l];if(m.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var _=0;_<m[m.length-1].length;_++)if(m[m.length-1][_]!==m[0][_])throw new Error("First and last Position are not equivalent.")}return Hd({type:"Polygon",coordinates:n},i,o)}function DP(n){return!isNaN(n)&&null!==n&&!Array.isArray(n)}function _b(n,i,o){if(null!==n)for(var l,h,m,_,b,I,C,F,A=0,L=0,z=n.type,tt="FeatureCollection"===z,Y="Feature"===z,Lt=tt?n.features.length:1,_t=0;_t<Lt;_t++){b=(F=!!(C=tt?n.features[_t].geometry:Y?n.geometry:n)&&"GeometryCollection"===C.type)?C.geometries.length:1;for(var X=0;X<b;X++){var bt=0,te=0;if(null!==(_=F?C.geometries[X]:C)){I=_.coordinates;var re=_.type;switch(A=!o||"Polygon"!==re&&"MultiPolygon"!==re?0:1,re){case null:break;case"Point":if(!1===i(I,L,_t,bt,te))return!1;L++,bt++;break;case"LineString":case"MultiPoint":for(l=0;l<I.length;l++){if(!1===i(I[l],L,_t,bt,te))return!1;L++,"MultiPoint"===re&&bt++}"LineString"===re&&bt++;break;case"Polygon":case"MultiLineString":for(l=0;l<I.length;l++){for(h=0;h<I[l].length-A;h++){if(!1===i(I[l][h],L,_t,bt,te))return!1;L++}"MultiLineString"===re&&bt++,"Polygon"===re&&te++}"Polygon"===re&&bt++;break;case"MultiPolygon":for(l=0;l<I.length;l++){for(te=0,h=0;h<I[l].length;h++){for(m=0;m<I[l][h].length-A;m++){if(!1===i(I[l][h][m],L,_t,bt,te))return!1;L++}te++}bt++}break;case"GeometryCollection":for(l=0;l<_.geometries.length;l++)if(!1===_b(_.geometries[l],i,o))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function hR(n,i){var o,l,h,m,_,b,I,C,A,L,F=0,z="FeatureCollection"===n.type,tt="Feature"===n.type,Y=z?n.features.length:1;for(o=0;o<Y;o++){for(C=z?n.features[o].properties:tt?n.properties:{},A=z?n.features[o].bbox:tt?n.bbox:void 0,L=z?n.features[o].id:tt?n.id:void 0,_=(I=!!(b=z?n.features[o].geometry:tt?n.geometry:n)&&"GeometryCollection"===b.type)?b.geometries.length:1,h=0;h<_;h++)if(null!==(m=I?b.geometries[h]:b))switch(m.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===i(m,F,C,A,L))return!1;break;case"GeometryCollection":for(l=0;l<m.geometries.length;l++)if(!1===i(m.geometries[l],F,C,A,L))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===i(null,F,C,A,L))return!1;F++}}function AP(n){var i=[1/0,1/0,-1/0,-1/0];return _b(n,function(o){i[0]>o[0]&&(i[0]=o[0]),i[1]>o[1]&&(i[1]=o[1]),i[2]<o[0]&&(i[2]=o[0]),i[3]<o[1]&&(i[3]=o[1])}),i}AP.default=AP;const Tz=AP;function mR(n,i,o){if(void 0===o&&(o={}),!n)throw new Error("point is required");if(!i)throw new Error("polygon is required");var l=function Dz(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if("Feature"===n.type&&null!==n.geometry&&"Point"===n.geometry.type)return n.geometry.coordinates;if("Point"===n.type)return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}(n),h=function Lz(n){return"Feature"===n.type?n.geometry:n}(i),m=h.type,_=i.bbox,b=h.coordinates;if(_&&!1===function Vz(n,i){return i[0]<=n[0]&&i[1]<=n[1]&&i[2]>=n[0]&&i[3]>=n[1]}(l,_))return!1;"Polygon"===m&&(b=[b]);for(var I=!1,C=0;C<b.length&&!I;C++)if(gR(l,b[C][0],o.ignoreBoundary)){for(var A=!1,L=1;L<b[C].length&&!A;)gR(l,b[C][L],!o.ignoreBoundary)&&(A=!0),L++;A||(I=!0)}return I}function gR(n,i,o){var l=!1;i[0][0]===i[i.length-1][0]&&i[0][1]===i[i.length-1][1]&&(i=i.slice(0,i.length-1));for(var h=0,m=i.length-1;h<i.length;m=h++){var _=i[h][0],b=i[h][1],I=i[m][0],C=i[m][1];if(n[1]*(_-I)+b*(I-n[0])+C*(n[0]-_)==0&&(_-n[0])*(I-n[0])<=0&&(b-n[1])*(C-n[1])<=0)return!o;b>n[1]!=C>n[1]&&n[0]<(I-_)*(n[1]-b)/(C-b)+_&&(l=!l)}return l}Tt(4772),Tt(3664);var yR=new ArrayBuffer(16);new Float64Array(yR),new Uint32Array(yR),Tt(7861),function(){function n(i){this.points=i.points||[],this.duration=i.duration||1e4,this.sharpness=i.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=i.stepLength||60,this.length=this.points.length,this.delay=0;for(var o=0;o<this.length;o++)this.points[o].z=this.points[o].z||0;for(o=0;o<this.length-1;o++){var l=this.points[o],h=this.points[o+1];this.centers.push({x:(l.x+h.x)/2,y:(l.y+h.y)/2,z:(l.z+h.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),o=0;o<this.centers.length-1;o++){var m=this.points[o+1].x-(this.centers[o].x+this.centers[o+1].x)/2,_=this.points[o+1].y-(this.centers[o].y+this.centers[o+1].y)/2,b=this.points[o+1].z-(this.centers[o].y+this.centers[o+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[o+1].x+this.sharpness*(this.centers[o].x+m),y:(1-this.sharpness)*this.points[o+1].y+this.sharpness*(this.centers[o].y+_),z:(1-this.sharpness)*this.points[o+1].z+this.sharpness*(this.centers[o].z+b)},{x:(1-this.sharpness)*this.points[o+1].x+this.sharpness*(this.centers[o+1].x+m),y:(1-this.sharpness)*this.points[o+1].y+this.sharpness*(this.centers[o+1].y+_),z:(1-this.sharpness)*this.points[o+1].z+this.sharpness*(this.centers[o+1].z+b)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}n.prototype.cacheSteps=function(i){var o=[],l=this.pos(0);o.push(0);for(var h=0;h<this.duration;h+=10){var m=this.pos(h);Math.sqrt((m.x-l.x)*(m.x-l.x)+(m.y-l.y)*(m.y-l.y)+(m.z-l.z)*(m.z-l.z))>i&&(o.push(h),l=m)}return o},n.prototype.vector=function(i){var o=this.pos(i+10),l=this.pos(i-10);return{angle:180*Math.atan2(o.y-l.y,o.x-l.x)/3.14,speed:Math.sqrt((l.x-o.x)*(l.x-o.x)+(l.y-o.y)*(l.y-o.y)+(l.z-o.z)*(l.z-o.z))}},n.prototype.pos=function(i){var o=i-this.delay;o<0&&(o=0),o>this.duration&&(o=this.duration-1);var l=o/this.duration;if(l>=1)return this.points[this.length-1];var h=Math.floor((this.points.length-1)*l);return function iB(n,i,o,l,h){var m=function oB(n){var i=n*n;return[i*n,3*i*(1-n),3*n*(1-n)*(1-n),(1-n)*(1-n)*(1-n)]}(n);return{x:h.x*m[0]+l.x*m[1]+o.x*m[2]+i.x*m[3],y:h.y*m[0]+l.y*m[1]+o.y*m[2]+i.y*m[3],z:h.z*m[0]+l.z*m[1]+o.z*m[2]+i.z*m[3]}}((this.length-1)*l-h,this.points[h],this.controls[h][1],this.controls[h+1][0],this.points[h+1])}}();Tt(9145),Tt(5665);var TR=6378137;function DR(n){var i=0;if(n&&n.length>0){i+=Math.abs(AR(n[0]));for(var o=1;o<n.length;o++)i-=Math.abs(AR(n[o]))}return i}function AR(n){var i,o,h,m,_,b,I=0,C=n.length;if(C>2){for(b=0;b<C;b++)b===C-2?(h=C-2,m=C-1,_=0):b===C-1?(h=C-1,m=0,_=1):(h=b,m=b+1,_=b+2),i=n[h],o=n[m],I+=(kP(n[_][0])-kP(i[0]))*Math.sin(kP(o[1]));I=I*TR*TR/2}return I}function kP(n){return n*Math.PI/180}var NR=Math.PI/180,FR=180/Math.PI,xb=function(n,i){this.lon=n,this.lat=i,this.x=NR*n,this.y=NR*i};xb.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},xb.prototype.antipode=function(){return new xb(this.lon<0?180+this.lon:-1*(180-this.lon),-1*this.lat)};var kR=function(){this.coords=[],this.length=0};kR.prototype.move_to=function(n){this.length++,this.coords.push(n)};var zP=function(n){this.properties=n||{},this.geometries=[]};zP.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var n=[],i=0;i<this.geometries.length;i++)n.push(this.geometries[i].coords);return{geometry:{type:"MultiLineString",coordinates:n},type:"Feature",properties:this.properties}},zP.prototype.wkt=function(){for(var n="",i="LINESTRING(",o=function(m){i+=m[0]+" "+m[1]+","},l=0;l<this.geometries.length;l++){if(0===this.geometries[l].coords.length)return"LINESTRING(empty)";this.geometries[l].coords.forEach(o),n+=i.substring(0,i.length-1)+")"}return n};var BP=function(n,i,o){if(!n||void 0===n.x||void 0===n.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!i||void 0===i.x||void 0===i.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new xb(n.x,n.y),this.end=new xb(i.x,i.y),this.properties=o||{};var l=this.start.x-this.end.x,m=Math.pow(Math.sin((this.start.y-this.end.y)/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(l/2),2);if(this.g=2*Math.asin(Math.sqrt(m)),this.g===Math.PI)throw new Error("it appears "+n.view()+" and "+i.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+n+" and "+i)};BP.prototype.interpolate=function(n){var i=Math.sin((1-n)*this.g)/Math.sin(this.g),o=Math.sin(n*this.g)/Math.sin(this.g),l=i*Math.cos(this.start.y)*Math.cos(this.start.x)+o*Math.cos(this.end.y)*Math.cos(this.end.x),h=i*Math.cos(this.start.y)*Math.sin(this.start.x)+o*Math.cos(this.end.y)*Math.sin(this.end.x),m=i*Math.sin(this.start.y)+o*Math.sin(this.end.y),_=FR*Math.atan2(m,Math.sqrt(Math.pow(l,2)+Math.pow(h,2)));return[FR*Math.atan2(h,l),_]},BP.prototype.Arc=function(n,i){var o=[];if(!n||n<=2)o.push([this.start.lon,this.start.lat]),o.push([this.end.lon,this.end.lat]);else for(var l=1/(n-1),h=0;h<n;++h){var _=this.interpolate(l*h);o.push(_)}for(var b=!1,I=0,C=i&&i.offset?i.offset:10,A=180-C,L=-180+C,F=360-C,z=1;z<o.length;++z){var tt=o[z-1][0],Y=o[z][0],Lt=Math.abs(Y-tt);Lt>F&&(Y>A&&tt<L||tt>A&&Y<L)?b=!0:Lt>I&&(I=Lt)}var _t=[];if(b&&I<C){var X=[];_t.push(X);for(var bt=0;bt<o.length;++bt){var te=parseFloat(o[bt][0]);if(bt>0&&Math.abs(te-o[bt-1][0])>F){var re=parseFloat(o[bt-1][0]),Ae=parseFloat(o[bt-1][1]),De=parseFloat(o[bt][0]),He=parseFloat(o[bt][1]);if(re>-180&&re<L&&180===De&&bt+1<o.length&&o[bt-1][0]>-180&&o[bt-1][0]<L){X.push([-180,o[bt][1]]),bt++,X.push([o[bt][0],o[bt][1]]);continue}if(re>A&&re<180&&-180===De&&bt+1<o.length&&o[bt-1][0]>A&&o[bt-1][0]<180){X.push([180,o[bt][1]]),bt++,X.push([o[bt][0],o[bt][1]]);continue}if(re<L&&De>A){var Qt=re;re=De,De=Qt;var Or=Ae;Ae=He,He=Or}if(re>A&&De<L&&(De+=360),re<=180&&De>=180&&re<De){var er=(180-re)/(De-re),fi=er*He+(1-er)*Ae;X.push([o[bt-1][0]>A?180:-180,fi]),(X=[]).push([o[bt-1][0]>A?-180:180,fi]),_t.push(X)}else _t.push(X=[]);X.push([te,o[bt][1]])}else X.push([o[bt][0],o[bt][1]])}}else{var Si=[];_t.push(Si);for(var Un=0;Un<o.length;++Un)Si.push([o[Un][0],o[Un][1]])}for(var Br=new zP(this.properties),xr=0;xr<_t.length;++xr){var es=new kR;Br.geometries.push(es);for(var Wo=_t[xr],zi=0;zi<Wo.length;++zi)es.move_to(Wo[zi])}return Br},Tt(3970);var io=[],oo=[],so=[],ao=[],lo=[],uo=[],co=[],ho=[],fo=[],po=[],mo=[],go=[],_o=[],yo=[],vo=[],xo=[],bo=[],wo=[],Eo=[],Io=[],Co=[],So=[],Mo=[],To=[];co[85]=po[85]=-1,ho[85]=mo[85]=0,fo[85]=go[85]=1,Eo[85]=So[85]=1,Io[85]=Mo[85]=0,Co[85]=To[85]=1,io[85]=ao[85]=0,oo[85]=lo[85]=-1,so[85]=vo[85]=0,xo[85]=_o[85]=0,bo[85]=yo[85]=1,uo[85]=wo[85]=1,So[1]=So[169]=0,Mo[1]=Mo[169]=-1,To[1]=To[169]=0,_o[1]=_o[169]=-1,yo[1]=yo[169]=0,vo[1]=vo[169]=0,po[4]=po[166]=0,mo[4]=mo[166]=-1,go[4]=go[166]=1,xo[4]=xo[166]=1,bo[4]=bo[166]=0,wo[4]=wo[166]=0,co[16]=co[154]=0,ho[16]=ho[154]=1,fo[16]=fo[154]=1,ao[16]=ao[154]=1,lo[16]=lo[154]=0,uo[16]=uo[154]=1,Eo[64]=Eo[106]=0,Io[64]=Io[106]=1,Co[64]=Co[106]=0,io[64]=io[106]=-1,oo[64]=oo[106]=0,so[64]=so[106]=1,Eo[2]=Eo[168]=0,Io[2]=Io[168]=-1,Co[2]=Co[168]=1,So[2]=So[168]=0,Mo[2]=Mo[168]=-1,To[2]=To[168]=0,_o[2]=_o[168]=-1,yo[2]=yo[168]=0,vo[2]=vo[168]=0,xo[2]=xo[168]=-1,bo[2]=bo[168]=0,wo[2]=wo[168]=1,co[8]=co[162]=0,ho[8]=ho[162]=-1,fo[8]=fo[162]=0,po[8]=po[162]=0,mo[8]=mo[162]=-1,go[8]=go[162]=1,_o[8]=_o[162]=1,yo[8]=yo[162]=0,vo[8]=vo[162]=1,xo[8]=xo[162]=1,bo[8]=bo[162]=0,wo[8]=wo[162]=0,co[32]=co[138]=0,ho[32]=ho[138]=1,fo[32]=fo[138]=1,po[32]=po[138]=0,mo[32]=mo[138]=1,go[32]=go[138]=0,io[32]=io[138]=1,oo[32]=oo[138]=0,so[32]=so[138]=0,ao[32]=ao[138]=1,lo[32]=lo[138]=0,uo[32]=uo[138]=1,So[128]=So[42]=0,Mo[128]=Mo[42]=1,To[128]=To[42]=1,Eo[128]=Eo[42]=0,Io[128]=Io[42]=1,Co[128]=Co[42]=0,io[128]=io[42]=-1,oo[128]=oo[42]=0,so[128]=so[42]=1,ao[128]=ao[42]=-1,lo[128]=lo[42]=0,uo[128]=uo[42]=0,po[5]=po[165]=-1,mo[5]=mo[165]=0,go[5]=go[165]=0,So[5]=So[165]=1,Mo[5]=Mo[165]=0,To[5]=To[165]=0,xo[20]=xo[150]=0,bo[20]=bo[150]=1,wo[20]=wo[150]=1,ao[20]=ao[150]=0,lo[20]=lo[150]=-1,uo[20]=uo[150]=1,co[80]=co[90]=-1,ho[80]=ho[90]=0,fo[80]=fo[90]=1,Eo[80]=Eo[90]=1,Io[80]=Io[90]=0,Co[80]=Co[90]=1,_o[65]=_o[105]=0,yo[65]=yo[105]=1,vo[65]=vo[105]=0,io[65]=io[105]=0,oo[65]=oo[105]=-1,so[65]=so[105]=0,co[160]=co[10]=-1,ho[160]=ho[10]=0,fo[160]=fo[10]=1,po[160]=po[10]=-1,mo[160]=mo[10]=0,go[160]=go[10]=0,So[160]=So[10]=1,Mo[160]=Mo[10]=0,To[160]=To[10]=0,Eo[160]=Eo[10]=1,Io[160]=Io[10]=0,Co[160]=Co[10]=1,xo[130]=xo[40]=0,bo[130]=bo[40]=1,wo[130]=wo[40]=1,_o[130]=_o[40]=0,yo[130]=yo[40]=1,vo[130]=vo[40]=0,io[130]=io[40]=0,oo[130]=oo[40]=-1,so[130]=so[40]=0,ao[130]=ao[40]=0,lo[130]=lo[40]=-1,uo[130]=uo[40]=1,po[37]=po[133]=0,mo[37]=mo[133]=1,go[37]=go[133]=1,So[37]=So[133]=0,Mo[37]=Mo[133]=1,To[37]=To[133]=0,io[37]=io[133]=-1,oo[37]=oo[133]=0,so[37]=so[133]=0,ao[37]=ao[133]=1,lo[37]=lo[133]=0,uo[37]=uo[133]=0,xo[148]=xo[22]=-1,bo[148]=bo[22]=0,wo[148]=wo[22]=0,So[148]=So[22]=0,Mo[148]=Mo[22]=-1,To[148]=To[22]=1,Eo[148]=Eo[22]=0,Io[148]=Io[22]=1,Co[148]=Co[22]=1,ao[148]=ao[22]=-1,lo[148]=lo[22]=0,uo[148]=uo[22]=1,co[82]=co[88]=0,ho[82]=ho[88]=-1,fo[82]=fo[88]=1,xo[82]=xo[88]=1,bo[82]=bo[88]=0,wo[82]=wo[88]=1,_o[82]=_o[88]=-1,yo[82]=yo[88]=0,vo[82]=vo[88]=1,Eo[82]=Eo[88]=0,Io[82]=Io[88]=-1,Co[82]=Co[88]=0,co[73]=co[97]=0,ho[73]=ho[97]=1,fo[73]=fo[97]=0,po[73]=po[97]=0,mo[73]=mo[97]=-1,go[73]=go[97]=0,_o[73]=_o[97]=1,yo[73]=yo[97]=0,vo[73]=vo[97]=0,io[73]=io[97]=1,oo[73]=oo[97]=0,so[73]=so[97]=1,co[145]=co[25]=0,ho[145]=ho[25]=-1,fo[145]=fo[25]=0,_o[145]=_o[25]=1,yo[145]=yo[25]=0,vo[145]=vo[25]=1,So[145]=So[25]=0,Mo[145]=Mo[25]=1,To[145]=To[25]=1,ao[145]=ao[25]=-1,lo[145]=lo[25]=0,uo[145]=uo[25]=0,po[70]=po[100]=0,mo[70]=mo[100]=1,go[70]=go[100]=0,xo[70]=xo[100]=-1,bo[70]=bo[100]=0,wo[70]=wo[100]=1,Eo[70]=Eo[100]=0,Io[70]=Io[100]=-1,Co[70]=Co[100]=1,io[70]=io[100]=1,oo[70]=oo[100]=0,so[70]=so[100]=0,po[101]=po[69]=0,mo[101]=mo[69]=1,go[101]=go[69]=0,io[101]=io[69]=1,oo[101]=oo[69]=0,so[101]=so[69]=0,So[149]=So[21]=0,Mo[149]=Mo[21]=1,To[149]=To[21]=1,ao[149]=ao[21]=-1,lo[149]=lo[21]=0,uo[149]=uo[21]=0,xo[86]=xo[84]=-1,bo[86]=bo[84]=0,wo[86]=wo[84]=1,Eo[86]=Eo[84]=0,Io[86]=Io[84]=-1,Co[86]=Co[84]=1,co[89]=co[81]=0,ho[89]=ho[81]=-1,fo[89]=fo[81]=0,_o[89]=_o[81]=1,yo[89]=yo[81]=0,vo[89]=vo[81]=1,co[96]=co[74]=0,ho[96]=ho[74]=1,fo[96]=fo[74]=0,po[96]=po[74]=-1,mo[96]=mo[74]=0,go[96]=go[74]=1,Eo[96]=Eo[74]=1,Io[96]=Io[74]=0,Co[96]=Co[74]=0,io[96]=io[74]=1,oo[96]=oo[74]=0,so[96]=so[74]=1,co[24]=co[146]=0,ho[24]=ho[146]=-1,fo[24]=fo[146]=1,xo[24]=xo[146]=1,bo[24]=bo[146]=0,wo[24]=wo[146]=1,_o[24]=_o[146]=0,yo[24]=yo[146]=1,vo[24]=vo[146]=1,ao[24]=ao[146]=0,lo[24]=lo[146]=-1,uo[24]=uo[146]=0,po[6]=po[164]=-1,mo[6]=mo[164]=0,go[6]=go[164]=1,xo[6]=xo[164]=-1,bo[6]=bo[164]=0,wo[6]=wo[164]=0,So[6]=So[164]=0,Mo[6]=Mo[164]=-1,To[6]=To[164]=1,Eo[6]=Eo[164]=1,Io[6]=Io[164]=0,Co[6]=Co[164]=0,_o[129]=_o[41]=0,yo[129]=yo[41]=1,vo[129]=vo[41]=1,So[129]=So[41]=0,Mo[129]=Mo[41]=1,To[129]=To[41]=0,io[129]=io[41]=-1,oo[129]=oo[41]=0,so[129]=so[41]=0,ao[129]=ao[41]=0,lo[129]=lo[41]=-1,uo[129]=uo[41]=0,xo[66]=xo[104]=0,bo[66]=bo[104]=1,wo[66]=wo[104]=0,_o[66]=_o[104]=-1,yo[66]=yo[104]=0,vo[66]=vo[104]=1,Eo[66]=Eo[104]=0,Io[66]=Io[104]=-1,Co[66]=Co[104]=0,io[66]=io[104]=0,oo[66]=oo[104]=-1,so[66]=so[104]=1,co[144]=co[26]=-1,ho[144]=ho[26]=0,fo[144]=fo[26]=0,So[144]=So[26]=1,Mo[144]=Mo[26]=0,To[144]=To[26]=1,Eo[144]=Eo[26]=0,Io[144]=Io[26]=1,Co[144]=Co[26]=1,ao[144]=ao[26]=-1,lo[144]=lo[26]=0,uo[144]=uo[26]=1,po[36]=po[134]=0,mo[36]=mo[134]=1,go[36]=go[134]=1,xo[36]=xo[134]=0,bo[36]=bo[134]=1,wo[36]=wo[134]=0,io[36]=io[134]=0,oo[36]=oo[134]=-1,so[36]=so[134]=1,ao[36]=ao[134]=1,lo[36]=lo[134]=0,uo[36]=uo[134]=0,co[9]=co[161]=-1,ho[9]=ho[161]=0,fo[9]=fo[161]=0,po[9]=po[161]=0,mo[9]=mo[161]=-1,go[9]=go[161]=0,_o[9]=_o[161]=1,yo[9]=yo[161]=0,vo[9]=vo[161]=0,So[9]=So[161]=1,Mo[9]=Mo[161]=0,To[9]=To[161]=1,co[136]=0,ho[136]=1,fo[136]=1,po[136]=0,mo[136]=1,go[136]=0,xo[136]=-1,bo[136]=0,wo[136]=1,_o[136]=-1,yo[136]=0,vo[136]=0,So[136]=0,Mo[136]=-1,To[136]=0,Eo[136]=0,Io[136]=-1,Co[136]=1,io[136]=1,oo[136]=0,so[136]=0,ao[136]=1,lo[136]=0,uo[136]=1,co[34]=0,ho[34]=-1,fo[34]=0,po[34]=0,mo[34]=-1,go[34]=1,xo[34]=1,bo[34]=0,wo[34]=0,_o[34]=1,yo[34]=0,vo[34]=1,So[34]=0,Mo[34]=1,To[34]=1,Eo[34]=0,Io[34]=1,Co[34]=0,io[34]=-1,oo[34]=0,so[34]=1,ao[34]=-1,lo[34]=0,uo[34]=0,co[35]=0,ho[35]=1,fo[35]=1,po[35]=0,mo[35]=-1,go[35]=1,xo[35]=1,bo[35]=0,wo[35]=0,_o[35]=-1,yo[35]=0,vo[35]=0,So[35]=0,Mo[35]=-1,To[35]=0,Eo[35]=0,Io[35]=1,Co[35]=0,io[35]=-1,oo[35]=0,so[35]=1,ao[35]=1,lo[35]=0,uo[35]=1,co[153]=0,ho[153]=1,fo[153]=1,_o[153]=-1,yo[153]=0,vo[153]=0,So[153]=0,Mo[153]=-1,To[153]=0,ao[153]=1,lo[153]=0,uo[153]=1,po[102]=0,mo[102]=-1,go[102]=1,xo[102]=1,bo[102]=0,wo[102]=0,Eo[102]=0,Io[102]=1,Co[102]=0,io[102]=-1,oo[102]=0,so[102]=1,co[155]=0,ho[155]=-1,fo[155]=0,_o[155]=1,yo[155]=0,vo[155]=1,So[155]=0,Mo[155]=1,To[155]=1,ao[155]=-1,lo[155]=0,uo[155]=0,po[103]=0,mo[103]=1,go[103]=0,xo[103]=-1,bo[103]=0,wo[103]=1,Eo[103]=0,Io[103]=-1,Co[103]=1,io[103]=1,oo[103]=0,so[103]=0,co[152]=0,ho[152]=1,fo[152]=1,xo[152]=-1,bo[152]=0,wo[152]=1,_o[152]=-1,yo[152]=0,vo[152]=0,So[152]=0,Mo[152]=-1,To[152]=0,Eo[152]=0,Io[152]=-1,Co[152]=1,ao[152]=1,lo[152]=0,uo[152]=1,co[156]=0,ho[156]=-1,fo[156]=1,xo[156]=1,bo[156]=0,wo[156]=1,_o[156]=-1,yo[156]=0,vo[156]=0,So[156]=0,Mo[156]=-1,To[156]=0,Eo[156]=0,Io[156]=1,Co[156]=1,ao[156]=-1,lo[156]=0,uo[156]=1,co[137]=0,ho[137]=1,fo[137]=1,po[137]=0,mo[137]=1,go[137]=0,_o[137]=-1,yo[137]=0,vo[137]=0,So[137]=0,Mo[137]=-1,To[137]=0,io[137]=1,oo[137]=0,so[137]=0,ao[137]=1,lo[137]=0,uo[137]=1,co[139]=0,ho[139]=1,fo[139]=1,po[139]=0,mo[139]=-1,go[139]=0,_o[139]=1,yo[139]=0,vo[139]=0,So[139]=0,Mo[139]=1,To[139]=0,io[139]=-1,oo[139]=0,so[139]=0,ao[139]=1,lo[139]=0,uo[139]=1,co[98]=0,ho[98]=-1,fo[98]=0,po[98]=0,mo[98]=-1,go[98]=1,xo[98]=1,bo[98]=0,wo[98]=0,_o[98]=1,yo[98]=0,vo[98]=1,Eo[98]=0,Io[98]=1,Co[98]=0,io[98]=-1,oo[98]=0,so[98]=1,co[99]=0,ho[99]=1,fo[99]=0,po[99]=0,mo[99]=-1,go[99]=1,xo[99]=1,bo[99]=0,wo[99]=0,_o[99]=-1,yo[99]=0,vo[99]=1,Eo[99]=0,Io[99]=-1,Co[99]=0,io[99]=1,oo[99]=0,so[99]=1,po[38]=0,mo[38]=-1,go[38]=1,xo[38]=1,bo[38]=0,wo[38]=0,So[38]=0,Mo[38]=1,To[38]=1,Eo[38]=0,Io[38]=1,Co[38]=0,io[38]=-1,oo[38]=0,so[38]=1,ao[38]=-1,lo[38]=0,uo[38]=0,po[39]=0,mo[39]=1,go[39]=1,xo[39]=-1,bo[39]=0,wo[39]=0,So[39]=0,Mo[39]=-1,To[39]=1,Eo[39]=0,Io[39]=1,Co[39]=0,io[39]=-1,oo[39]=0,so[39]=1,ao[39]=1,lo[39]=0,uo[39]=0;var GP=function(n){return[[n.bottomleft,0],[0,0],[0,n.leftbottom]]},qP=function(n){return[[1,n.rightbottom],[1,0],[n.bottomright,0]]},$P=function(n){return[[n.topright,1],[1,1],[1,n.righttop]]},HP=function(n){return[[0,n.lefttop],[0,1],[n.topleft,1]]},ZP=function(n){return[[n.bottomright,0],[n.bottomleft,0],[0,n.leftbottom],[0,n.lefttop]]},WP=function(n){return[[n.bottomright,0],[n.bottomleft,0],[1,n.righttop],[1,n.rightbottom]]},XP=function(n){return[[1,n.righttop],[1,n.rightbottom],[n.topleft,1],[n.topright,1]]},YP=function(n){return[[0,n.leftbottom],[0,n.lefttop],[n.topleft,1],[n.topright,1]]},lr=[],nr=[],Lr=[],Sr=[],ti=[],Jr=[],Do=[],Po=[];Sr[1]=ti[1]=18,Sr[169]=ti[169]=18,Lr[4]=nr[4]=12,Lr[166]=nr[166]=12,lr[16]=Po[16]=4,lr[154]=Po[154]=4,Jr[64]=Do[64]=22,Jr[106]=Do[106]=22,Lr[2]=Jr[2]=17,Sr[2]=ti[2]=18,Lr[168]=Jr[168]=17,Sr[168]=ti[168]=18,lr[8]=Sr[8]=9,nr[8]=Lr[8]=12,lr[162]=Sr[162]=9,nr[162]=Lr[162]=12,lr[32]=Po[32]=4,nr[32]=Do[32]=1,lr[138]=Po[138]=4,nr[138]=Do[138]=1,ti[128]=Po[128]=21,Jr[128]=Do[128]=22,ti[42]=Po[42]=21,Jr[42]=Do[42]=22,nr[5]=ti[5]=14,nr[165]=ti[165]=14,Lr[20]=Po[20]=6,Lr[150]=Po[150]=6,lr[80]=Jr[80]=11,lr[90]=Jr[90]=11,Sr[65]=Do[65]=3,Sr[105]=Do[105]=3,lr[160]=Jr[160]=11,nr[160]=ti[160]=14,lr[10]=Jr[10]=11,nr[10]=ti[10]=14,Lr[130]=Po[130]=6,Sr[130]=Do[130]=3,Lr[40]=Po[40]=6,Sr[40]=Do[40]=3,nr[101]=Do[101]=1,nr[69]=Do[69]=1,ti[149]=Po[149]=21,ti[21]=Po[21]=21,Lr[86]=Jr[86]=17,Lr[84]=Jr[84]=17,lr[89]=Sr[89]=9,lr[81]=Sr[81]=9,lr[96]=Do[96]=0,nr[96]=Jr[96]=15,lr[74]=Do[74]=0,nr[74]=Jr[74]=15,lr[24]=Lr[24]=8,Sr[24]=Po[24]=7,lr[146]=Lr[146]=8,Sr[146]=Po[146]=7,nr[6]=Jr[6]=15,Lr[6]=ti[6]=16,nr[164]=Jr[164]=15,Lr[164]=ti[164]=16,Sr[129]=Po[129]=7,ti[129]=Do[129]=20,Sr[41]=Po[41]=7,ti[41]=Do[41]=20,Lr[66]=Do[66]=2,Sr[66]=Jr[66]=19,Lr[104]=Do[104]=2,Sr[104]=Jr[104]=19,lr[144]=ti[144]=10,Jr[144]=Po[144]=23,lr[26]=ti[26]=10,Jr[26]=Po[26]=23,nr[36]=Po[36]=5,Lr[36]=Do[36]=2,nr[134]=Po[134]=5,Lr[134]=Do[134]=2,lr[9]=ti[9]=10,nr[9]=Sr[9]=13,lr[161]=ti[161]=10,nr[161]=Sr[161]=13,nr[37]=Po[37]=5,ti[37]=Do[37]=20,nr[133]=Po[133]=5,ti[133]=Do[133]=20,Lr[148]=ti[148]=16,Jr[148]=Po[148]=23,Lr[22]=ti[22]=16,Jr[22]=Po[22]=23,lr[82]=Lr[82]=8,Sr[82]=Jr[82]=19,lr[88]=Lr[88]=8,Sr[88]=Jr[88]=19,lr[73]=Do[73]=0,nr[73]=Sr[73]=13,lr[97]=Do[97]=0,nr[97]=Sr[97]=13,lr[145]=Sr[145]=9,ti[145]=Po[145]=21,lr[25]=Sr[25]=9,ti[25]=Po[25]=21,nr[70]=Do[70]=1,Lr[70]=Jr[70]=17,nr[100]=Do[100]=1,Lr[100]=Jr[100]=17,lr[34]=Sr[34]=9,nr[34]=Lr[34]=12,ti[34]=Po[34]=21,Jr[34]=Do[34]=22,lr[136]=Po[136]=4,nr[136]=Do[136]=1,Lr[136]=Jr[136]=17,Sr[136]=ti[136]=18,lr[35]=Po[35]=4,nr[35]=Lr[35]=12,Sr[35]=ti[35]=18,Jr[35]=Do[35]=22,lr[153]=Po[153]=4,Sr[153]=ti[153]=18,nr[102]=Lr[102]=12,Jr[102]=Do[102]=22,lr[155]=Sr[155]=9,ti[155]=Po[155]=23,nr[103]=Do[103]=1,Lr[103]=Jr[103]=17,lr[152]=Po[152]=4,Lr[152]=Jr[152]=17,Sr[152]=ti[152]=18,lr[156]=Lr[156]=8,Sr[156]=ti[156]=18,Jr[156]=Po[156]=23,lr[137]=Po[137]=4,nr[137]=Do[137]=1,Sr[137]=ti[137]=18,lr[139]=Po[139]=4,nr[139]=Sr[139]=13,ti[139]=Do[139]=20,lr[98]=Sr[98]=9,nr[98]=Lr[98]=12,Jr[98]=Do[98]=22,lr[99]=Do[99]=0,nr[99]=Lr[99]=12,Sr[99]=Jr[99]=19,nr[38]=Lr[38]=12,ti[38]=Po[38]=21,Jr[38]=Do[38]=22,nr[39]=Po[39]=5,Lr[39]=ti[39]=16,Jr[39]=Do[39]=22;var Jn=[];function QP(n,i,o){return function W4(n){return(n>0)-(n<0)||+n}((i[0]-n[0])*(o[1]-i[1])-(o[0]-i[0])*(i[1]-n[1]))}function QR(n,i){return i.geometry.coordinates[0].every(function(o){return mR(fM(o),n)})}Jn[1]=Jn[169]=GP,Jn[4]=Jn[166]=qP,Jn[16]=Jn[154]=$P,Jn[64]=Jn[106]=HP,Jn[168]=Jn[2]=ZP,Jn[162]=Jn[8]=WP,Jn[138]=Jn[32]=XP,Jn[42]=Jn[128]=YP,Jn[5]=Jn[165]=function(n){return[[0,0],[0,n.leftbottom],[1,n.rightbottom],[1,0]]},Jn[20]=Jn[150]=function(n){return[[1,0],[n.bottomright,0],[n.topright,1],[1,1]]},Jn[80]=Jn[90]=function(n){return[[1,1],[1,n.righttop],[0,n.lefttop],[0,1]]},Jn[65]=Jn[105]=function(n){return[[n.bottomleft,0],[0,0],[0,1],[n.topleft,1]]},Jn[160]=Jn[10]=function(n){return[[1,n.righttop],[1,n.rightbottom],[0,n.leftbottom],[0,n.lefttop]]},Jn[130]=Jn[40]=function(n){return[[n.topleft,1],[n.topright,1],[n.bottomright,0],[n.bottomleft,0]]},Jn[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},Jn[101]=Jn[69]=function(n){return[[1,n.rightbottom],[1,0],[0,0],[0,1],[n.topleft,1]]},Jn[149]=Jn[21]=function(n){return[[n.topright,1],[1,1],[1,0],[0,0],[0,n.leftbottom]]},Jn[86]=Jn[84]=function(n){return[[1,0],[n.bottomright,0],[0,n.lefttop],[0,1],[1,1]]},Jn[89]=Jn[81]=function(n){return[[1,1],[1,n.righttop],[n.bottomleft,0],[0,0],[0,1]]},Jn[96]=Jn[74]=function(n){return[[1,n.righttop],[1,n.rightbottom],[0,n.lefttop],[0,1],[n.topleft,1]]},Jn[24]=Jn[146]=function(n){return[[1,1],[1,n.righttop],[n.bottomright,0],[n.bottomleft,0],[n.topright,1]]},Jn[6]=Jn[164]=function(n){return[[1,n.rightbottom],[1,0],[n.bottomright,0],[0,n.leftbottom],[0,n.lefttop]]},Jn[129]=Jn[41]=function(n){return[[n.topright,1],[n.bottomleft,0],[0,0],[0,n.leftbottom],[n.topleft,1]]},Jn[66]=Jn[104]=function(n){return[[n.bottomright,0],[n.bottomleft,0],[0,n.lefttop],[0,1],[n.topleft,1]]},Jn[144]=Jn[26]=function(n){return[[1,1],[1,n.righttop],[0,n.leftbottom],[0,n.lefttop],[n.topright,1]]},Jn[36]=Jn[134]=function(n){return[[1,n.rightbottom],[1,0],[n.bottomright,0],[n.topleft,1],[n.topright,1]]},Jn[9]=Jn[161]=function(n){return[[1,n.righttop],[1,n.rightbottom],[n.bottomleft,0],[0,0],[0,n.leftbottom]]},Jn[37]=Jn[133]=function(n){return[[1,n.rightbottom],[1,0],[0,0],[0,n.leftbottom],[n.topleft,1],[n.topright,1]]},Jn[148]=Jn[22]=function(n){return[[1,1],[1,0],[n.bottomright,0],[0,n.leftbottom],[0,n.lefttop],[n.topright,1]]},Jn[82]=Jn[88]=function(n){return[[1,1],[1,n.righttop],[n.bottomright,0],[n.bottomleft,0],[0,n.lefttop],[0,1]]},Jn[73]=Jn[97]=function(n){return[[1,n.righttop],[1,n.rightbottom],[n.bottomleft,0],[0,0],[0,1],[n.topleft,1]]},Jn[145]=Jn[25]=function(n){return[[1,1],[1,n.righttop],[n.bottomleft,0],[0,0],[0,n.leftbottom],[n.topright,1]]},Jn[70]=Jn[100]=function(n){return[[1,n.rightbottom],[1,0],[n.bottomright,0],[0,n.lefttop],[0,1],[n.topleft,1]]},Jn[34]=function(n){return[YP(n),WP(n)]},Jn[35]=function(n){return[[1,n.righttop],[1,n.rightbottom],[n.bottomright,0],[n.bottomleft,0],[0,n.leftbottom],[0,n.lefttop],[n.topleft,1],[n.topright,1]]},Jn[136]=function(n){return[XP(n),ZP(n)]},Jn[153]=function(n){return[$P(n),GP(n)]},Jn[102]=function(n){return[qP(n),HP(n)]},Jn[155]=function(n){return[[1,1],[1,n.righttop],[n.bottomleft,0],[0,0],[0,n.leftbottom],[n.topright,1]]},Jn[103]=function(n){return[[1,n.rightbottom],[1,0],[n.bottomright,0],[0,n.lefttop],[0,1],[n.topleft,1]]},Jn[152]=function(n){return[$P(n),ZP(n)]},Jn[156]=function(n){return[[1,1],[1,n.righttop],[n.bottomright,0],[n.bottomleft,0],[0,n.leftbottom],[0,n.lefttop],[n.topright,1]]},Jn[137]=function(n){return[XP(n),GP(n)]},Jn[139]=function(n){return[[1,n.righttop],[1,n.rightbottom],[n.bottomleft,0],[0,0],[0,n.leftbottom],[n.topleft,1],[n.topright,1]]},Jn[98]=function(n){return[WP(n),HP(n)]},Jn[99]=function(n){return[[1,n.righttop],[1,n.rightbottom],[n.bottomright,0],[n.bottomleft,0],[0,n.lefttop],[0,1],[n.topleft,1]]},Jn[38]=function(n){return[qP(n),YP(n)]},Jn[39]=function(n){return[[1,n.rightbottom],[1,0],[n.bottomright,0],[0,n.leftbottom],[0,n.lefttop],[n.topleft,1],[n.topright,1]]};const tN=function(){function n(i){this.id=n.buildId(i),this.coordinates=i,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return n.buildId=function(i){return i.join(",")},n.prototype.removeInnerEdge=function(i){this.innerEdges=this.innerEdges.filter(function(o){return o.from.id!==i.from.id})},n.prototype.removeOuterEdge=function(i){this.outerEdges=this.outerEdges.filter(function(o){return o.to.id!==i.to.id})},n.prototype.addOuterEdge=function(i){this.outerEdges.push(i),this.outerEdgesSorted=!1},n.prototype.sortOuterEdges=function(){var i=this;this.outerEdgesSorted||(this.outerEdges.sort(function(o,l){var h=o.to,m=l.to;if(h.coordinates[0]-i.coordinates[0]>=0&&m.coordinates[0]-i.coordinates[0]<0)return 1;if(h.coordinates[0]-i.coordinates[0]<0&&m.coordinates[0]-i.coordinates[0]>=0)return-1;if(h.coordinates[0]-i.coordinates[0]==0&&m.coordinates[0]-i.coordinates[0]==0)return h.coordinates[1]-i.coordinates[1]>=0||m.coordinates[1]-i.coordinates[1]>=0?h.coordinates[1]-m.coordinates[1]:m.coordinates[1]-h.coordinates[1];var _=QP(i.coordinates,h.coordinates,m.coordinates);return _<0?1:_>0?-1:Math.pow(h.coordinates[0]-i.coordinates[0],2)+Math.pow(h.coordinates[1]-i.coordinates[1],2)-(Math.pow(m.coordinates[0]-i.coordinates[0],2)+Math.pow(m.coordinates[1]-i.coordinates[1],2))}),this.outerEdgesSorted=!0)},n.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},n.prototype.getOuterEdge=function(i){return this.sortOuterEdges(),this.outerEdges[i]},n.prototype.addInnerEdge=function(i){this.innerEdges.push(i)},n}(),Q4=function(){function n(i,o){this.from=i,this.to=o,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return n.prototype.getSymetric=function(){return this.symetric||(this.symetric=new n(this.to,this.from),this.symetric.symetric=this),this.symetric},n.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},n.prototype.isEqual=function(i){return this.from.id===i.from.id&&this.to.id===i.to.id},n.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},n.prototype.toLineString=function(){return function MP(n,i,o){if(void 0===o&&(o={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");return Hd({type:"LineString",coordinates:n},i,o)}([this.from.coordinates,this.to.coordinates])},n.prototype.compareTo=function(i){return QP(i.from.coordinates,i.to.coordinates,this.to.coordinates)},n}(),e5=function(){function n(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return n.prototype.push=function(i){this.edges.push(i),this.polygon=this.envelope=void 0},n.prototype.get=function(i){return this.edges[i]},Object.defineProperty(n.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),n.prototype.forEach=function(i){this.edges.forEach(i)},n.prototype.map=function(i){return this.edges.map(i)},n.prototype.some=function(i){return this.edges.some(i)},n.prototype.isValid=function(){return!0},n.prototype.isHole=function(){var i=this,o=this.edges.reduce(function(_,b,I){return b.from.coordinates[1]>i.edges[_].from.coordinates[1]&&(_=I),_},0),l=(0===o?this.length:o)-1,h=(o+1)%this.length,m=QP(this.edges[l].from.coordinates,this.edges[o].from.coordinates,this.edges[h].from.coordinates);return 0===m?this.edges[l].from.coordinates[0]>this.edges[h].from.coordinates[0]:m>0},n.prototype.toMultiPoint=function(){return function uR(n,i,o){return void 0===o&&(o={}),Hd({type:"MultiPoint",coordinates:n},i,o)}(this.edges.map(function(i){return i.from.coordinates}))},n.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var i=this.edges.map(function(o){return o.from.coordinates});return i.push(this.edges[0].from.coordinates),this.polygon=dM([i])},n.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=function lB(n){return function aB(n,i){void 0===i&&(i={});var o=Number(n[0]),l=Number(n[1]),h=Number(n[2]),m=Number(n[3]);if(6===n.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var _=[o,l];return dM([[_,[h,l],[h,m],[o,m],_]],i.properties,{bbox:n,id:i.id})}(Tz(n))}(this.toPolygon())},n.findEdgeRingContaining=function(i,o){var h,m,l=i.getEnvelope();return o.forEach(function(_){var b=_.getEnvelope();if(m&&(h=m.getEnvelope()),!function X4(n,i){var o=n.geometry.coordinates[0].map(function(_){return _[0]}),l=n.geometry.coordinates[0].map(function(_){return _[1]}),h=i.geometry.coordinates[0].map(function(_){return _[0]}),m=i.geometry.coordinates[0].map(function(_){return _[1]});return Math.max.apply(null,o)===Math.max.apply(null,h)&&Math.max.apply(null,l)===Math.max.apply(null,m)&&Math.min.apply(null,o)===Math.min.apply(null,h)&&Math.min.apply(null,l)===Math.min.apply(null,m)}(b,l)&&QR(b,l)){for(var I=i.map(function(tt){return tt.from.coordinates}),C=void 0,A=function(tt){_.some(function(Y){return function Y4(n,i){return n[0]===i[0]&&n[1]===i[1]}(tt,Y.from.coordinates)})||(C=tt)},L=0,F=I;L<F.length;L++)A(F[L]);C&&_.inside(fM(C))&&(!m||QR(h,b))&&(m=_)}}),m},n.prototype.inside=function(i){return mR(i,this.toPolygon())},n}();function uN(n){for(var i=n,o=[];i.parent;)o.unshift(i),i=i.parent;return o}!function(){function n(){this.edges=[],this.nodes={}}n.fromGeoJson=function(i){!function n5(n){if(!n)throw new Error("No geojson passed");if("FeatureCollection"!==n.type&&"GeometryCollection"!==n.type&&"MultiLineString"!==n.type&&"LineString"!==n.type&&"Feature"!==n.type)throw new Error("Invalid input type '"+n.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(i);var o=new n;return function pM(n,i){hR(n,function(o,l,h,m,_){var I,b=null===o?null:o.type;switch(b){case null:case"Point":case"LineString":case"Polygon":return!1!==i(Hd(o,h,{bbox:m,id:_}),l,0)&&void 0}switch(b){case"MultiPoint":I="Point";break;case"MultiLineString":I="LineString";break;case"MultiPolygon":I="Polygon"}for(var C=0;C<o.coordinates.length;C++)if(!1===i(Hd({type:I,coordinates:o.coordinates[C]},h),l,C))return!1})}(i,function(l){(function Pz(n,i,o){if(!n)throw new Error("No feature passed");if(!o)throw new Error(".featureOf() requires a name");if(!n||"Feature"!==n.type||!n.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!n.geometry||n.geometry.type!==i)throw new Error("Invalid input to "+o+": must be a "+i+", given "+n.geometry.type)})(l,"LineString","Graph::fromGeoJson"),function wz(n,i,o,l){var h=o;_b(n,function(m,_,b,I,C){h=0===_&&void 0===o?m:i(h,m,_,b,I,C)},l)}(l,function(h,m){if(h){var _=o.getNode(h),b=o.getNode(m);o.addEdge(_,b)}return m})}),o},n.prototype.getNode=function(i){var o=tN.buildId(i),l=this.nodes[o];return l||(l=this.nodes[o]=new tN(i)),l},n.prototype.addEdge=function(i,o){var l=new Q4(i,o),h=l.getSymetric();this.edges.push(l),this.edges.push(h)},n.prototype.deleteDangles=function(){var i=this;Object.keys(this.nodes).map(function(o){return i.nodes[o]}).forEach(function(o){return i._removeIfDangle(o)})},n.prototype._removeIfDangle=function(i){var o=this;if(i.innerEdges.length<=1){var l=i.getOuterEdges().map(function(h){return h.to});this.removeNode(i),l.forEach(function(h){return o._removeIfDangle(h)})}},n.prototype.deleteCutEdges=function(){var i=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(o){o.label===o.symetric.label&&(i.removeEdge(o.symetric),i.removeEdge(o))})},n.prototype._computeNextCWEdges=function(i){var o=this;typeof i>"u"?Object.keys(this.nodes).forEach(function(l){return o._computeNextCWEdges(o.nodes[l])}):i.getOuterEdges().forEach(function(l,h){i.getOuterEdge((0===h?i.getOuterEdges().length:h)-1).symetric.next=l})},n.prototype._computeNextCCWEdges=function(i,o){for(var h,m,l=i.getOuterEdges(),_=l.length-1;_>=0;--_){var b=l[_],I=b.symetric,C=void 0,A=void 0;b.label===o&&(C=b),I.label===o&&(A=I),C&&A&&(A&&(m=A),C&&(m&&(m.next=C,m=void 0),h||(h=C)))}m&&(m.next=h)},n.prototype._findLabeledEdgeRings=function(){var i=[],o=0;return this.edges.forEach(function(l){if(!(l.label>=0)){i.push(l);var h=l;do{h.label=o,h=h.next}while(!l.isEqual(h));o++}}),i},n.prototype.getEdgeRings=function(){var i=this;this._computeNextCWEdges(),this.edges.forEach(function(l){l.label=void 0}),this._findLabeledEdgeRings().forEach(function(l){i._findIntersectionNodes(l).forEach(function(h){i._computeNextCCWEdges(h,l.label)})});var o=[];return this.edges.forEach(function(l){l.ring||o.push(i._findEdgeRing(l))}),o},n.prototype._findIntersectionNodes=function(i){var o=[],l=i,h=function(){var m=0;l.from.getOuterEdges().forEach(function(_){_.label===i.label&&++m}),m>1&&o.push(l.from),l=l.next};do{h()}while(!i.isEqual(l));return o},n.prototype._findEdgeRing=function(i){var o=i,l=new e5;do{l.push(o),o.ring=l,o=o.next}while(!i.isEqual(o));return l},n.prototype.removeNode=function(i){var o=this;i.getOuterEdges().forEach(function(l){return o.removeEdge(l)}),i.innerEdges.forEach(function(l){return o.removeEdge(l)}),delete this.nodes[i.id]},n.prototype.removeEdge=function(i){this.edges=this.edges.filter(function(o){return!o.isEqual(i)}),i.deleteEdge()}}(),Tt(3198),Tt(3367),Tt(3282);var bM={search:function(n,i,o,l){n.cleanDirty();var h=(l=l||{}).heuristic||bM.heuristics.manhattan,m=l.closest||!1,_=function y5(){return new cN(function(n){return n.f})}(),b=i;for(i.h=h(i,o),_.push(i);_.size()>0;){var I=_.pop();if(I===o)return uN(I);I.closed=!0;for(var C=n.neighbors(I),A=0,L=C.length;A<L;++A){var F=C[A];if(!F.closed&&!F.isWall()){var z=I.g+F.getCost(I),tt=F.visited;(!tt||z<F.g)&&(F.visited=!0,F.parent=I,F.h=F.h||h(F,o),F.g=z,F.f=F.g+F.h,n.markDirty(F),m&&(F.h<b.h||F.h===b.h&&F.g<b.g)&&(b=F),tt?_.rescoreElement(F):_.push(F))}}}return m?uN(b):[]},heuristics:{manhattan:function(n,i){return Math.abs(i.x-n.x)+Math.abs(i.y-n.y)},diagonal:function(n,i){var l=Math.sqrt(2),h=Math.abs(i.x-n.x),m=Math.abs(i.y-n.y);return 1*(h+m)+(l-2)*Math.min(h,m)}},cleanNode:function(n){n.f=0,n.g=0,n.h=0,n.visited=!1,n.closed=!1,n.parent=null}};function x0(n,i){i=i||{},this.nodes=[],this.diagonal=!!i.diagonal,this.grid=[];for(var o=0;o<n.length;o++){this.grid[o]=[];for(var l=0,h=n[o];l<h.length;l++){var m=new wM(o,l,h[l]);this.grid[o][l]=m,this.nodes.push(m)}}this.init()}function wM(n,i,o){this.x=n,this.y=i,this.weight=o}function cN(n){this.content=[],this.scoreFunction=n}function eL(){this._=null}function EM(n){n.U=n.C=n.L=n.R=n.P=n.N=null}function wb(n,i){var o=i,l=i.R,h=o.U;h?h.L===o?h.L=l:h.R=l:n._=l,l.U=h,o.U=l,o.R=l.L,o.R&&(o.R.U=o),l.L=o}function Eb(n,i){var o=i,l=i.L,h=o.U;h?h.L===o?h.L=l:h.R=l:n._=l,l.U=h,o.U=l,o.L=l.R,o.L&&(o.L.U=o),l.R=o}function hN(n){for(;n.L;)n=n.L;return n}x0.prototype.init=function(){this.dirtyNodes=[];for(var n=0;n<this.nodes.length;n++)bM.cleanNode(this.nodes[n])},x0.prototype.cleanDirty=function(){for(var n=0;n<this.dirtyNodes.length;n++)bM.cleanNode(this.dirtyNodes[n]);this.dirtyNodes=[]},x0.prototype.markDirty=function(n){this.dirtyNodes.push(n)},x0.prototype.neighbors=function(n){var i=[],o=n.x,l=n.y,h=this.grid;return h[o-1]&&h[o-1][l]&&i.push(h[o-1][l]),h[o+1]&&h[o+1][l]&&i.push(h[o+1][l]),h[o]&&h[o][l-1]&&i.push(h[o][l-1]),h[o]&&h[o][l+1]&&i.push(h[o][l+1]),this.diagonal&&(h[o-1]&&h[o-1][l-1]&&i.push(h[o-1][l-1]),h[o+1]&&h[o+1][l-1]&&i.push(h[o+1][l-1]),h[o-1]&&h[o-1][l+1]&&i.push(h[o-1][l+1]),h[o+1]&&h[o+1][l+1]&&i.push(h[o+1][l+1])),i},x0.prototype.toString=function(){for(var o,l,h,m,n=[],i=this.grid,_=0,b=i.length;_<b;_++){for(o=[],h=0,m=(l=i[_]).length;h<m;h++)o.push(l[h].weight);n.push(o.join(" "))}return n.join("\n")},wM.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},wM.prototype.getCost=function(n){return n&&n.x!==this.x&&n.y!==this.y?1.41421*this.weight:this.weight},wM.prototype.isWall=function(){return 0===this.weight},cN.prototype={push:function(n){this.content.push(n),this.sinkDown(this.content.length-1)},pop:function(){var n=this.content[0],i=this.content.pop();return this.content.length>0&&(this.content[0]=i,this.bubbleUp(0)),n},remove:function(n){var i=this.content.indexOf(n),o=this.content.pop();i!==this.content.length-1&&(this.content[i]=o,this.scoreFunction(o)<this.scoreFunction(n)?this.sinkDown(i):this.bubbleUp(i))},size:function(){return this.content.length},rescoreElement:function(n){this.sinkDown(this.content.indexOf(n))},sinkDown:function(n){for(var i=this.content[n];n>0;){var o=(n+1>>1)-1,l=this.content[o];if(!(this.scoreFunction(i)<this.scoreFunction(l)))break;this.content[o]=i,this.content[n]=l,n=o}},bubbleUp:function(n){for(var i=this.content.length,o=this.content[n],l=this.scoreFunction(o);;){var b,h=n+1<<1,m=h-1,_=null;if(m<i&&(b=this.scoreFunction(this.content[m]))<l&&(_=m),h<i&&this.scoreFunction(this.content[h])<(null===_?l:b)&&(_=h),null===_)break;this.content[n]=this.content[_],this.content[_]=o,n=_}}},eL.prototype={constructor:eL,insert:function(n,i){var o,l,h;if(n){if(i.P=n,i.N=n.N,n.N&&(n.N.P=i),n.N=i,n.R){for(n=n.R;n.L;)n=n.L;n.L=i}else n.R=i;o=n}else this._?(n=hN(this._),i.P=null,i.N=n,n.P=n.L=i,o=n):(i.P=i.N=null,this._=i,o=null);for(i.L=i.R=null,i.U=o,i.C=!0,n=i;o&&o.C;)o===(l=o.U).L?(h=l.R)&&h.C?(o.C=h.C=!1,l.C=!0,n=l):(n===o.R&&(wb(this,o),o=(n=o).U),o.C=!1,l.C=!0,Eb(this,l)):(h=l.L)&&h.C?(o.C=h.C=!1,l.C=!0,n=l):(n===o.L&&(Eb(this,o),o=(n=o).U),o.C=!1,l.C=!0,wb(this,l)),o=n.U;this._.C=!1},remove:function(n){n.N&&(n.N.P=n.P),n.P&&(n.P.N=n.N),n.N=n.P=null;var o,m,_,i=n.U,l=n.L,h=n.R;if(m=l?h?hN(h):l:h,i?i.L===n?i.L=m:i.R=m:this._=m,l&&h?(_=m.C,m.C=n.C,m.L=l,l.U=m,m!==h?(i=m.U,m.U=n.U,i.L=n=m.R,m.R=h,h.U=m):(m.U=i,i=m,n=m.R)):(_=n.C,n=m),n&&(n.U=i),!_){if(n&&n.C)return void(n.C=!1);do{if(n===this._)break;if(n===i.L){if((o=i.R).C&&(o.C=!1,i.C=!0,wb(this,i),o=i.R),o.L&&o.L.C||o.R&&o.R.C){(!o.R||!o.R.C)&&(o.L.C=!1,o.C=!0,Eb(this,o),o=i.R),o.C=i.C,i.C=o.R.C=!1,wb(this,i),n=this._;break}}else if((o=i.L).C&&(o.C=!1,i.C=!0,Eb(this,i),o=i.L),o.L&&o.L.C||o.R&&o.R.C){(!o.L||!o.L.C)&&(o.R.C=!1,o.C=!0,wb(this,o),o=i.L),o.C=i.C,i.C=o.L.C=!1,Eb(this,i),n=this._;break}o.C=!0,n=i,i=i.U}while(!n.C);n&&(n.C=!1)}}};const fN=eL;function Ib(n,i,o,l){var h=[null,null],m=wu.push(h)-1;return h.left=n,h.right=i,o&&IM(h,n,i,o),l&&IM(h,i,n,l),Gc[n.index].halfedges.push(m),Gc[i.index].halfedges.push(m),h}function Cb(n,i,o){var l=[i,o];return l.left=n,l}function IM(n,i,o,l){n[0]||n[1]?n.left===o?n[1]=l:n[0]=l:(n[0]=l,n.left=i,n.right=o)}function x5(n,i,o,l,h){var Y,m=n[0],_=n[1],b=m[0],I=m[1],L=0,F=1,z=_[0]-b,tt=_[1]-I;if(Y=i-b,z||!(Y>0)){if(Y/=z,z<0){if(Y<L)return;Y<F&&(F=Y)}else if(z>0){if(Y>F)return;Y>L&&(L=Y)}if(Y=l-b,z||!(Y<0)){if(Y/=z,z<0){if(Y>F)return;Y>L&&(L=Y)}else if(z>0){if(Y<L)return;Y<F&&(F=Y)}if(Y=o-I,tt||!(Y>0)){if(Y/=tt,tt<0){if(Y<L)return;Y<F&&(F=Y)}else if(tt>0){if(Y>F)return;Y>L&&(L=Y)}if(Y=h-I,tt||!(Y<0)){if(Y/=tt,tt<0){if(Y>F)return;Y>L&&(L=Y)}else if(tt>0){if(Y<L)return;Y<F&&(F=Y)}return!(L>0)&&!(F<1)||(L>0&&(n[0]=[b+L*z,I+L*tt]),F<1&&(n[1]=[b+F*z,I+F*tt])),!0}}}}}function b5(n,i,o,l,h){var m=n[1];if(m)return!0;var Y,Lt,_=n[0],b=n.left,I=n.right,C=b[0],A=b[1],L=I[0],F=I[1],z=(C+L)/2;if(F===A){if(z<i||z>=l)return;if(C>L){if(_){if(_[1]>=h)return}else _=[z,o];m=[z,h]}else{if(_){if(_[1]<o)return}else _=[z,h];m=[z,o]}}else if(Lt=(A+F)/2-(Y=(C-L)/(F-A))*z,Y<-1||Y>1)if(C>L){if(_){if(_[1]>=h)return}else _=[(o-Lt)/Y,o];m=[(h-Lt)/Y,h]}else{if(_){if(_[1]<o)return}else _=[(h-Lt)/Y,h];m=[(o-Lt)/Y,o]}else if(A<F){if(_){if(_[0]>=l)return}else _=[i,Y*i+Lt];m=[l,Y*l+Lt]}else{if(_){if(_[0]<i)return}else _=[l,Y*l+Lt];m=[i,Y*i+Lt]}return n[0]=_,n[1]=m,!0}function I5(n,i){var o=n.site,l=i.left,h=i.right;return o===h&&(h=l,l=o),h?Math.atan2(h[1]-l[1],h[0]-l[0]):(o===l?(l=i[1],h=i[0]):(l=i[0],h=i[1]),Math.atan2(l[0]-h[0],h[1]-l[1]))}function dN(n,i){return i[+(i.left!==n.site)]}function C5(n,i){return i[+(i.left===n.site)]}var nL,pN=[];function T5(){EM(this),this.x=this.y=this.arc=this.site=this.cy=null}function b0(n){var i=n.P,o=n.N;if(i&&o){var l=i.site,h=n.site,m=o.site;if(l!==m){var _=h[0],b=h[1],I=l[0]-_,C=l[1]-b,A=m[0]-_,L=m[1]-b,F=2*(I*L-C*A);if(!(F>=-O5)){var z=I*I+C*C,tt=A*A+L*L,Y=(L*z-C*tt)/F,Lt=(I*tt-A*z)/F,_t=pN.pop()||new T5;_t.arc=n,_t.site=h,_t.x=Y+_,_t.y=(_t.cy=Lt+b)+Math.sqrt(Y*Y+Lt*Lt),n.circle=_t;for(var X=null,bt=Sb._;bt;)if(_t.y<bt.y||_t.y===bt.y&&_t.x<=bt.x){if(!bt.L){X=bt.P;break}bt=bt.L}else{if(!bt.R){X=bt;break}bt=bt.R}Sb.insert(X,_t),X||(nL=_t)}}}}function w0(n){var i=n.circle;i&&(i.P||(nL=i.N),Sb.remove(i),pN.push(i),EM(i),n.circle=null)}var mN=[];function D5(){EM(this),this.edge=this.site=this.circle=null}function gN(n){var i=mN.pop()||new D5;return i.site=n,i}function rL(n){w0(n),E0.remove(n),mN.push(n),EM(n)}function A5(n){var i=n.circle,o=i.x,l=i.cy,h=[o,l],m=n.P,_=n.N,b=[n];rL(n);for(var I=m;I.circle&&Math.abs(o-I.circle.x)<Ea&&Math.abs(l-I.circle.cy)<Ea;)m=I.P,b.unshift(I),rL(I),I=m;b.unshift(I),w0(I);for(var C=_;C.circle&&Math.abs(o-C.circle.x)<Ea&&Math.abs(l-C.circle.cy)<Ea;)_=C.N,b.push(C),rL(C),C=_;b.push(C),w0(C);var L,A=b.length;for(L=1;L<A;++L)IM((C=b[L]).edge,(I=b[L-1]).site,C.site,h);(C=b[A-1]).edge=Ib((I=b[0]).site,C.site,null,h),b0(I),b0(C)}function P5(n){for(var l,h,m,_,i=n[0],o=n[1],b=E0._;b;)if((m=_N(b,o)-i)>Ea)b=b.L;else{if(!((_=i-L5(b,o))>Ea)){m>-Ea?(l=b.P,h=b):_>-Ea?(l=b,h=b.N):l=h=b;break}if(!b.R){l=b;break}b=b.R}!function E5(n){Gc[n.index]={site:n,halfedges:[]}}(n);var I=gN(n);if(E0.insert(l,I),l||h){if(l===h)return w0(l),h=gN(l.site),E0.insert(I,h),I.edge=h.edge=Ib(l.site,I.site),b0(l),void b0(h);if(!h)return void(I.edge=Ib(l.site,I.site));w0(l),w0(h);var C=l.site,A=C[0],L=C[1],F=n[0]-A,z=n[1]-L,tt=h.site,Y=tt[0]-A,Lt=tt[1]-L,_t=2*(F*Lt-z*Y),X=F*F+z*z,bt=Y*Y+Lt*Lt,te=[(Lt*X-z*bt)/_t+A,(F*bt-Y*X)/_t+L];IM(h.edge,C,tt,te),I.edge=Ib(C,n,null,te),h.edge=Ib(n,tt,null,te),b0(l),b0(h)}}function _N(n,i){var o=n.site,l=o[0],h=o[1],m=h-i;if(!m)return l;var _=n.P;if(!_)return-1/0;var b=(o=_.site)[0],I=o[1],C=I-i;if(!C)return b;var A=b-l,L=1/m-1/C,F=A/C;return L?(-F+Math.sqrt(F*F-2*L*(A*A/(-2*C)-I+C/2+h-m/2)))/L+l:(l+b)/2}function L5(n,i){var o=n.N;if(o)return _N(o,i);var l=n.site;return l[1]===i?l[0]:1/0}var E0,Gc,Sb,wu,Ea=1e-6,O5=1e-12;function R5(n,i,o){return(n[0]-o[0])*(i[1]-n[1])-(n[0]-i[0])*(o[1]-n[1])}function N5(n,i){return i[1]-n[1]||i[0]-n[0]}function yN(n,i){var l,h,m,o=n.sort(N5).pop();for(wu=[],Gc=new Array(n.length),E0=new fN,Sb=new fN;;)if(m=nL,o&&(!m||o[1]<m.y||o[1]===m.y&&o[0]<m.x))(o[0]!==l||o[1]!==h)&&(P5(o),l=o[0],h=o[1]),o=n.pop();else{if(!m)break;A5(m.arc)}if(function S5(){for(var o,l,h,m,n=0,i=Gc.length;n<i;++n)if((o=Gc[n])&&(m=(l=o.halfedges).length)){var _=new Array(m),b=new Array(m);for(h=0;h<m;++h)_[h]=h,b[h]=I5(o,wu[l[h]]);for(_.sort(function(I,C){return b[C]-b[I]}),h=0;h<m;++h)b[h]=l[_[h]];for(h=0;h<m;++h)l[h]=b[h]}}(),i){var _=+i[0][0],b=+i[0][1],I=+i[1][0],C=+i[1][1];(function w5(n,i,o,l){for(var m,h=wu.length;h--;)b5(m=wu[h],n,i,o,l)&&x5(m,n,i,o,l)&&(Math.abs(m[0][0]-m[1][0])>Ea||Math.abs(m[0][1]-m[1][1])>Ea)||delete wu[h]})(_,b,I,C),function M5(n,i,o,l){var m,_,b,I,C,A,L,F,z,tt,Y,Lt,h=Gc.length,_t=!0;for(m=0;m<h;++m)if(_=Gc[m]){for(b=_.site,I=(C=_.halfedges).length;I--;)wu[C[I]]||C.splice(I,1);for(I=0,A=C.length;I<A;)Y=(tt=C5(_,wu[C[I]]))[0],Lt=tt[1],F=(L=dN(_,wu[C[++I%A]]))[0],z=L[1],(Math.abs(Y-F)>Ea||Math.abs(Lt-z)>Ea)&&(C.splice(I,0,wu.push(Cb(b,tt,Math.abs(Y-n)<Ea&&l-Lt>Ea?[n,Math.abs(F-n)<Ea?z:l]:Math.abs(Lt-l)<Ea&&o-Y>Ea?[Math.abs(z-l)<Ea?F:o,l]:Math.abs(Y-o)<Ea&&Lt-i>Ea?[o,Math.abs(F-o)<Ea?z:i]:Math.abs(Lt-i)<Ea&&Y-n>Ea?[Math.abs(z-i)<Ea?F:n,i]:null))-1),++A);A&&(_t=!1)}if(_t){var X,bt,te,re=1/0;for(m=0,_t=null;m<h;++m)(_=Gc[m])&&(te=(X=(b=_.site)[0]-n)*X+(bt=b[1]-i)*bt)<re&&(re=te,_t=_);if(_t){var Ae=[n,i],De=[n,l],He=[o,l],Qt=[o,i];_t.halfedges.push(wu.push(Cb(b=_t.site,Ae,De))-1,wu.push(Cb(b,De,He))-1,wu.push(Cb(b,He,Qt))-1,wu.push(Cb(b,Qt,Ae))-1)}}for(m=0;m<h;++m)(_=Gc[m])&&(_.halfedges.length||delete Gc[m])}(_,b,I,C)}this.edges=wu,this.cells=Gc,E0=Sb=wu=Gc=null}function xm(){return new CM}function CM(){this.reset()}yN.prototype={constructor:yN,polygons:function(){var n=this.edges;return this.cells.map(function(i){var o=i.halfedges.map(function(l){return dN(i,n[l])});return o.data=i.site.data,o})},triangles:function(){var n=[],i=this.edges;return this.cells.forEach(function(o,l){if(b=(m=o.halfedges).length)for(var m,b,I,h=o.site,_=-1,C=i[m[b-1]],A=C.left===h?C.right:C.left;++_<b;)I=A,A=(C=i[m[_]]).left===h?C.right:C.left,I&&A&&l<I.index&&l<A.index&&R5(h,I,A)<0&&n.push([h.data,I.data,A.data])}),n},links:function(){return this.edges.filter(function(n){return n.right}).map(function(n){return{source:n.left.data,target:n.right.data}})},find:function(n,i,o){for(var h,b,l=this,m=l._found||0,_=l.cells.length;!(b=l.cells[m]);)if(++m>=_)return null;var I=n-b.site[0],C=i-b.site[1],A=I*I+C*C;do{b=l.cells[h=m],m=null,b.halfedges.forEach(function(L){var F=l.edges[L],z=F.left;if(z!==b.site&&z||(z=F.right)){var tt=n-z[0],Y=i-z[1],Lt=tt*tt+Y*Y;Lt<A&&(A=Lt,m=z.index)}})}while(null!==m);return l._found=h,null==o||A<=o*o?b.site:null}},Tt(8464),Tt(4855),CM.prototype={constructor:CM,reset:function(){this.s=this.t=0},add:function(n){DN(SM,n,this.t),DN(this,SM.s,this.s),this.s?this.t+=SM.t:this.s=SM.t},valueOf:function(){return this.s}};var SM=new CM;function DN(n,i,o){var l=n.s=i+o,h=l-i;n.t=i-(l-h)+(o-h)}var Ca=Math.PI,pc=Ca/2,I0=2*Ca,ma=Ca/180,Mb=(Math,Math.atan),C0=Math.atan2,as=Math.cos,Lo=(Math,Math,Math,Math,Math,Math.sin),Zd=(Math,Math.sqrt);Math;function S0(n){return n>1?pc:n<-1?-pc:Math.asin(n)}function _L(n,i){return[n>Ca?n-I0:n<-Ca?n+I0:n,i]}function nF(n,i){return n<i?-1:n>i?1:n>=i?0:NaN}xm(),xm(),xm(),_L.invert=_L,function d6(n){1===n.length&&(n=function p6(n){return function(i,o){return nF(n(i),o)}}(n))}(nF),Math.sqrt(50),Math.sqrt(10),Math.sqrt(2);xm();function FL(){}function TF(n){return function(i,o){var l=as(i),h=as(o),m=n(l*h);return[m*h*Lo(i),m*Lo(o)]}}function kb(n){return function(i,o){var l=Zd(i*i+o*o),h=n(l),m=Lo(h),_=as(h);return[C0(i*m,l*_),S0(l&&o*m/l)]}}function zL(n,i){return[n,i]}xm(),xm(),xm(),xm(),function CF(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}(4.5),FL.prototype={constructor:FL,point:function(n,i){this.stream.point(n,i)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},as(30*ma),function SF(n){return function(i){var o=new FL;for(var l in n)o[l]=n[l];return o.stream=i,o}}({point:function(n,i){this.stream.point(n*ma,i*ma)}}),TF(function(n){return Zd(2/(1+n))}).invert=kb(function(n){return 2*S0(n/2)}),TF(function(n){return(n=function X5(n){return n>1?0:n<-1?Ca:Math.acos(n)}(n))&&n/Lo(n)}).invert=kb(function(n){return n}),zL.invert=zL,kb(Mb),kb(S0),kb(function(n){return 2*Mb(n)});const BL="pk.eyJ1IjoibWFyb29uZWRpb25lIiwiYSI6ImNqdmp0MzB1azBpcDAzem1naHZwMjNndGIifQ.65nvvRg9Qe\nFUV2c6b9W4Vw";let aU=(()=>{class n{constructor(){this.style="mapbox://styles/mapbox/streets-v11",this.lat=55.751244,this.lng=37.618423}ngOnInit(){SP.accessToken=BL,this.map=new SP.Map({accessToken:BL,container:"map",style:this.style,zoom:17,center:[this.lng,this.lat],pitch:45,bearing:17}),this.map.addControl(new SP.NavigationControl,"top-left");const o=new(_z())({displayControlsDefault:!0,controls:{polygon:!0,trash:!0},defaultMode:"draw_polygon"});function l(h){const m=o.getAll(),_=document.getElementById("calculated-area");if(m.features.length>0){const b=function wB(n){return function Cz(n,i,o){var l=o;return hR(n,function(h,m,_,b,I){l=0===m&&void 0===o?h:i(l,h,m,_,b,I)}),l}(n,function(i,o){return i+function EB(n){var o,i=0;switch(n.type){case"Polygon":return DR(n.coordinates);case"MultiPolygon":for(o=0;o<n.coordinates.length;o++)i+=DR(n.coordinates[o]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(o)},0)}(m),I=Math.round(100*b)/100;_.innerHTML=`<p><strong>${I}</strong></p><p>square meters</p>`}else _.innerHTML="","draw.delete"!==h.type&&alert("Click the map to draw a polygon.")}this.map.addControl(o,"top-left"),this.map.on("draw.create",l),this.map.on("draw.delete",l),this.map.on("draw.update",l)}static#t=this.\u0275fac=function(l){return new(l||n)};static#e=this.\u0275cmp=_s({type:n,selectors:[["app-map"]],decls:5,vars:0,consts:[["id","map",1,"map"],[1,"calculation-box"],["id","calculated-area"]],template:function(l,h){1&l&&(Dd(0,"div",0),Md(1,"div",1)(2,"p"),Gy(3,"Click the map to draw a polygon"),Td(),Dd(4,"div",2),Td())},styles:[".map[_ngcontent-%COMP%]{width:100%;height:100vh}.calculation-box[_ngcontent-%COMP%]{height:75px;width:-moz-fit-content;width:fit-content;position:absolute;bottom:20px;left:20px;background-color:#ffffffe6;padding:15px;text-align:center}"]})}return n})(),lU=(()=>{class n{constructor(){this.title="mapbox"}static#t=this.\u0275fac=function(l){return new(l||n)};static#e=this.\u0275cmp=_s({type:n,selectors:[["app-root"]],decls:3,vars:0,template:function(l,h){1&l&&(Md(0,"h1"),Gy(1,"MAPBOX"),Td(),Dd(2,"app-map"))},dependencies:[aU]})}return n})();const dU=new dr("MapboxApiKey");let pU=(()=>{class n{static withConfig(o){return{ngModule:n,providers:[{provide:dU,useValue:o.accessToken}]}}static#t=this.\u0275fac=function(l){return new(l||n)};static#e=this.\u0275mod=hs({type:n});static#n=this.\u0275inj=iu({imports:[zO]})}return n})(),mU=(()=>{class n{static#t=this.\u0275fac=function(l){return new(l||n)};static#e=this.\u0275mod=hs({type:n,bootstrap:[lU]});static#n=this.\u0275inj=iu({imports:[uz,pU.withConfig({accessToken:BL})]})}return n})();az().bootstrapModule(mU).catch(n=>console.error(n))},1568:(nn,we,Tt)=>{"use strict";var Rt=Tt(8570);function oe(Pt){var rt=[1/0,1/0,-1/0,-1/0];return Rt.coordEach(Pt,function(zt){rt[0]>zt[0]&&(rt[0]=zt[0]),rt[1]>zt[1]&&(rt[1]=zt[1]),rt[2]<zt[0]&&(rt[2]=zt[0]),rt[3]<zt[1]&&(rt[3]=zt[1])}),rt}oe.default=oe,we.Z=oe},621:(nn,we)=>{"use strict";function Tt(St,Ht,Et){void 0===Et&&(Et={});var cn={type:"Feature"};return(0===Et.id||Et.id)&&(cn.id=Et.id),Et.bbox&&(cn.bbox=Et.bbox),cn.properties=Ht||{},cn.geometry=St,cn}function Rt(St,Ht,Et){if(void 0===Et&&(Et={}),!St)throw new Error("coordinates is required");if(!Array.isArray(St))throw new Error("coordinates must be an Array");if(St.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!H(St[0])||!H(St[1]))throw new Error("coordinates must contain numbers");return Tt({type:"Point",coordinates:St},Ht,Et)}function Pt(St,Ht,Et){void 0===Et&&(Et={});for(var cn=0,en=St;cn<en.length;cn++){var Ft=en[cn];if(Ft.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var de=0;de<Ft[Ft.length-1].length;de++)if(Ft[Ft.length-1][de]!==Ft[0][de])throw new Error("First and last Position are not equivalent.")}return Tt({type:"Polygon",coordinates:St},Ht,Et)}function zt(St,Ht,Et){if(void 0===Et&&(Et={}),St.length<2)throw new Error("coordinates must be an array of two or more positions");return Tt({type:"LineString",coordinates:St},Ht,Et)}function Yt(St,Ht){void 0===Ht&&(Ht={});var Et={type:"FeatureCollection"};return Ht.id&&(Et.id=Ht.id),Ht.bbox&&(Et.bbox=Ht.bbox),Et.features=St,Et}function Me(St,Ht,Et){return void 0===Et&&(Et={}),Tt({type:"MultiLineString",coordinates:St},Ht,Et)}function Be(St,Ht,Et){return void 0===Et&&(Et={}),Tt({type:"MultiPoint",coordinates:St},Ht,Et)}function Ce(St,Ht,Et){return void 0===Et&&(Et={}),Tt({type:"MultiPolygon",coordinates:St},Ht,Et)}function an(St,Ht){void 0===Ht&&(Ht="kilometers");var Et=we.factors[Ht];if(!Et)throw new Error(Ht+" units is invalid");return St*Et}function pt(St,Ht){void 0===Ht&&(Ht="kilometers");var Et=we.factors[Ht];if(!Et)throw new Error(Ht+" units is invalid");return St/Et}function gt(St){return St%(2*Math.PI)*180/Math.PI}function H(St){return!isNaN(St)&&null!==St&&!Array.isArray(St)}Object.defineProperty(we,"__esModule",{value:!0}),we.earthRadius=6371008.8,we.factors={centimeters:100*we.earthRadius,centimetres:100*we.earthRadius,degrees:we.earthRadius/111325,feet:3.28084*we.earthRadius,inches:39.37*we.earthRadius,kilometers:we.earthRadius/1e3,kilometres:we.earthRadius/1e3,meters:we.earthRadius,metres:we.earthRadius,miles:we.earthRadius/1609.344,millimeters:1e3*we.earthRadius,millimetres:1e3*we.earthRadius,nauticalmiles:we.earthRadius/1852,radians:1,yards:1.0936*we.earthRadius},we.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/we.earthRadius,yards:1.0936133},we.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},we.feature=Tt,we.geometry=function Ct(St,Ht,Et){switch(void 0===Et&&(Et={}),St){case"Point":return Rt(Ht).geometry;case"LineString":return zt(Ht).geometry;case"Polygon":return Pt(Ht).geometry;case"MultiPoint":return Be(Ht).geometry;case"MultiLineString":return Me(Ht).geometry;case"MultiPolygon":return Ce(Ht).geometry;default:throw new Error(St+" is invalid")}},we.point=Rt,we.points=function oe(St,Ht,Et){return void 0===Et&&(Et={}),Yt(St.map(function(cn){return Rt(cn,Ht)}),Et)},we.polygon=Pt,we.polygons=function rt(St,Ht,Et){return void 0===Et&&(Et={}),Yt(St.map(function(cn){return Pt(cn,Ht)}),Et)},we.lineString=zt,we.lineStrings=function ie(St,Ht,Et){return void 0===Et&&(Et={}),Yt(St.map(function(cn){return zt(cn,Ht)}),Et)},we.featureCollection=Yt,we.multiLineString=Me,we.multiPoint=Be,we.multiPolygon=Ce,we.geometryCollection=function ee(St,Ht,Et){return void 0===Et&&(Et={}),Tt({type:"GeometryCollection",geometries:St},Ht,Et)},we.round=function _e(St,Ht){if(void 0===Ht&&(Ht=0),Ht&&!(Ht>=0))throw new Error("precision must be a positive number");var Et=Math.pow(10,Ht||0);return Math.round(St*Et)/Et},we.radiansToLength=an,we.lengthToRadians=pt,we.lengthToDegrees=function mt(St,Ht){return gt(pt(St,Ht))},we.bearingToAzimuth=function ot(St){var Ht=St%360;return Ht<0&&(Ht+=360),Ht},we.radiansToDegrees=gt,we.degreesToRadians=function ct(St){return St%360*Math.PI/180},we.convertLength=function kt(St,Ht,Et){if(void 0===Ht&&(Ht="kilometers"),void 0===Et&&(Et="kilometers"),!(St>=0))throw new Error("length must be a positive number");return an(pt(St,Ht),Et)},we.convertArea=function ut(St,Ht,Et){if(void 0===Ht&&(Ht="meters"),void 0===Et&&(Et="kilometers"),!(St>=0))throw new Error("area must be a positive number");var cn=we.areaFactors[Ht];if(!cn)throw new Error("invalid original units");var en=we.areaFactors[Et];if(!en)throw new Error("invalid final units");return St/cn*en},we.isNumber=H,we.isObject=function ht(St){return!!St&&St.constructor===Object},we.validateBBox=function J(St){if(!St)throw new Error("bbox is required");if(!Array.isArray(St))throw new Error("bbox must be an Array");if(4!==St.length&&6!==St.length)throw new Error("bbox must be an Array of 4 or 6 numbers");St.forEach(function(Ht){if(!H(Ht))throw new Error("bbox must only contain numbers")})},we.validateId=function ue(St){if(!St)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof St))throw new Error("id must be a number or a string")}},8570:(nn,we,Tt)=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});var Ct=Tt(621);function Rt(ct,kt,ut){if(null!==ct)for(var H,ht,J,ue,St,Ht,Et,Ft,cn=0,en=0,de=ct.type,Vt="FeatureCollection"===de,At="Feature"===de,ne=Vt?ct.features.length:1,wt=0;wt<ne;wt++){St=(Ft=!!(Et=Vt?ct.features[wt].geometry:At?ct.geometry:ct)&&"GeometryCollection"===Et.type)?Et.geometries.length:1;for(var Le=0;Le<St;Le++){var Pe=0,pe=0;if(null!==(ue=Ft?Et.geometries[Le]:Et)){Ht=ue.coordinates;var Fe=ue.type;switch(cn=!ut||"Polygon"!==Fe&&"MultiPolygon"!==Fe?0:1,Fe){case null:break;case"Point":if(!1===kt(Ht,en,wt,Pe,pe))return!1;en++,Pe++;break;case"LineString":case"MultiPoint":for(H=0;H<Ht.length;H++){if(!1===kt(Ht[H],en,wt,Pe,pe))return!1;en++,"MultiPoint"===Fe&&Pe++}"LineString"===Fe&&Pe++;break;case"Polygon":case"MultiLineString":for(H=0;H<Ht.length;H++){for(ht=0;ht<Ht[H].length-cn;ht++){if(!1===kt(Ht[H][ht],en,wt,Pe,pe))return!1;en++}"MultiLineString"===Fe&&Pe++,"Polygon"===Fe&&pe++}"Polygon"===Fe&&Pe++;break;case"MultiPolygon":for(H=0;H<Ht.length;H++){for(pe=0,ht=0;ht<Ht[H].length;ht++){for(J=0;J<Ht[H][ht].length-cn;J++){if(!1===kt(Ht[H][ht][J],en,wt,Pe,pe))return!1;en++}pe++}Pe++}break;case"GeometryCollection":for(H=0;H<ue.geometries.length;H++)if(!1===Rt(ue.geometries[H],kt,ut))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Pt(ct,kt){var ut;switch(ct.type){case"FeatureCollection":for(ut=0;ut<ct.features.length&&!1!==kt(ct.features[ut].properties,ut);ut++);break;case"Feature":kt(ct.properties,0)}}function zt(ct,kt){if("Feature"===ct.type)kt(ct,0);else if("FeatureCollection"===ct.type)for(var ut=0;ut<ct.features.length&&!1!==kt(ct.features[ut],ut);ut++);}function Me(ct,kt){var ut,H,ht,J,ue,St,Ht,Et,cn,en,Ft=0,de="FeatureCollection"===ct.type,Vt="Feature"===ct.type,At=de?ct.features.length:1;for(ut=0;ut<At;ut++){for(Et=de?ct.features[ut].properties:Vt?ct.properties:{},cn=de?ct.features[ut].bbox:Vt?ct.bbox:void 0,en=de?ct.features[ut].id:Vt?ct.id:void 0,ue=(Ht=!!(St=de?ct.features[ut].geometry:Vt?ct.geometry:ct)&&"GeometryCollection"===St.type)?St.geometries.length:1,ht=0;ht<ue;ht++)if(null!==(J=Ht?St.geometries[ht]:St))switch(J.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===kt(J,Ft,Et,cn,en))return!1;break;case"GeometryCollection":for(H=0;H<J.geometries.length;H++)if(!1===kt(J.geometries[H],Ft,Et,cn,en))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===kt(null,Ft,Et,cn,en))return!1;Ft++}}function Ce(ct,kt){Me(ct,function(ut,H,ht,J,ue){var Ht,St=null===ut?null:ut.type;switch(St){case null:case"Point":case"LineString":case"Polygon":return!1!==kt(Ct.feature(ut,ht,{bbox:J,id:ue}),H,0)&&void 0}switch(St){case"MultiPoint":Ht="Point";break;case"MultiLineString":Ht="LineString";break;case"MultiPolygon":Ht="Polygon"}for(var Et=0;Et<ut.coordinates.length;Et++)if(!1===kt(Ct.feature({type:Ht,coordinates:ut.coordinates[Et]},ht),H,Et))return!1})}function _e(ct,kt){Ce(ct,function(ut,H,ht){var J=0;if(ut.geometry){var ue=ut.geometry.type;if("Point"!==ue&&"MultiPoint"!==ue){var St,Ht=0,Et=0,cn=0;if(!1===Rt(ut,function(en,Ft,de,Vt,At){if(void 0===St||H>Ht||Vt>Et||At>cn)return St=en,Ht=H,Et=Vt,cn=At,void(J=0);var ne=Ct.lineString([St,en],ut.properties);if(!1===kt(ne,H,ht,At,J))return!1;J++,St=en}))return!1}}})}function pt(ct,kt){if(!ct)throw new Error("geojson is required");Ce(ct,function(ut,H,ht){if(null!==ut.geometry){var ue=ut.geometry.coordinates;switch(ut.geometry.type){case"LineString":if(!1===kt(ut,H,ht,0,0))return!1;break;case"Polygon":for(var St=0;St<ue.length;St++)if(!1===kt(Ct.lineString(ue[St],ut.properties),H,ht,St))return!1}}})}we.coordAll=function Yt(ct){var kt=[];return Rt(ct,function(ut){kt.push(ut)}),kt},we.coordEach=Rt,we.coordReduce=function oe(ct,kt,ut,H){var ht=ut;return Rt(ct,function(J,ue,St,Ht,Et){ht=0===ue&&void 0===ut?J:kt(ht,J,ue,St,Ht,Et)},H),ht},we.featureEach=zt,we.featureReduce=function ie(ct,kt,ut){var H=ut;return zt(ct,function(ht,J){H=0===J&&void 0===ut?ht:kt(H,ht,J)}),H},we.findPoint=function gt(ct,kt){if(!Ct.isObject(kt=kt||{}))throw new Error("options is invalid");var St,ut=kt.featureIndex||0,H=kt.multiFeatureIndex||0,ht=kt.geometryIndex||0,J=kt.coordIndex||0,ue=kt.properties;switch(ct.type){case"FeatureCollection":ut<0&&(ut=ct.features.length+ut),ue=ue||ct.features[ut].properties,St=ct.features[ut].geometry;break;case"Feature":ue=ue||ct.properties,St=ct.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":St=ct;break;default:throw new Error("geojson is invalid")}if(null===St)return null;var Ht=St.coordinates;switch(St.type){case"Point":return Ct.point(Ht,ue,kt);case"MultiPoint":return H<0&&(H=Ht.length+H),Ct.point(Ht[H],ue,kt);case"LineString":return J<0&&(J=Ht.length+J),Ct.point(Ht[J],ue,kt);case"Polygon":return ht<0&&(ht=Ht.length+ht),J<0&&(J=Ht[ht].length+J),Ct.point(Ht[ht][J],ue,kt);case"MultiLineString":return H<0&&(H=Ht.length+H),J<0&&(J=Ht[H].length+J),Ct.point(Ht[H][J],ue,kt);case"MultiPolygon":return H<0&&(H=Ht.length+H),ht<0&&(ht=Ht[H].length+ht),J<0&&(J=Ht[H][ht].length-J),Ct.point(Ht[H][ht][J],ue,kt)}throw new Error("geojson is invalid")},we.findSegment=function ot(ct,kt){if(!Ct.isObject(kt=kt||{}))throw new Error("options is invalid");var St,ut=kt.featureIndex||0,H=kt.multiFeatureIndex||0,ht=kt.geometryIndex||0,J=kt.segmentIndex||0,ue=kt.properties;switch(ct.type){case"FeatureCollection":ut<0&&(ut=ct.features.length+ut),ue=ue||ct.features[ut].properties,St=ct.features[ut].geometry;break;case"Feature":ue=ue||ct.properties,St=ct.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":St=ct;break;default:throw new Error("geojson is invalid")}if(null===St)return null;var Ht=St.coordinates;switch(St.type){case"Point":case"MultiPoint":return null;case"LineString":return J<0&&(J=Ht.length+J-1),Ct.lineString([Ht[J],Ht[J+1]],ue,kt);case"Polygon":return ht<0&&(ht=Ht.length+ht),J<0&&(J=Ht[ht].length+J-1),Ct.lineString([Ht[ht][J],Ht[ht][J+1]],ue,kt);case"MultiLineString":return H<0&&(H=Ht.length+H),J<0&&(J=Ht[H].length+J-1),Ct.lineString([Ht[H][J],Ht[H][J+1]],ue,kt);case"MultiPolygon":return H<0&&(H=Ht.length+H),ht<0&&(ht=Ht[H].length+ht),J<0&&(J=Ht[H][ht].length-J-1),Ct.lineString([Ht[H][ht][J],Ht[H][ht][J+1]],ue,kt)}throw new Error("geojson is invalid")},we.flattenEach=Ce,we.flattenReduce=function ee(ct,kt,ut){var H=ut;return Ce(ct,function(ht,J,ue){H=0===J&&0===ue&&void 0===ut?ht:kt(H,ht,J,ue)}),H},we.geomEach=Me,we.geomReduce=function Be(ct,kt,ut){var H=ut;return Me(ct,function(ht,J,ue,St,Ht){H=0===J&&void 0===ut?ht:kt(H,ht,J,ue,St,Ht)}),H},we.lineEach=pt,we.lineReduce=function mt(ct,kt,ut){var H=ut;return pt(ct,function(ht,J,ue,St){H=0===J&&void 0===ut?ht:kt(H,ht,J,ue,St)}),H},we.propEach=Pt,we.propReduce=function rt(ct,kt,ut){var H=ut;return Pt(ct,function(ht,J){H=0===J&&void 0===ut?ht:kt(H,ht,J)}),H},we.segmentEach=_e,we.segmentReduce=function an(ct,kt,ut){var H=ut,ht=!1;return _e(ct,function(J,ue,St,Ht,Et){H=!1===ht&&void 0===ut?J:kt(H,J,ue,St,Ht,Et),ht=!0}),H}},1098:(nn,we,Tt)=>{"use strict";var Ct=Tt(491),Rt=Tt(5436),oe=Rt(Ct("String.prototype.indexOf"));nn.exports=function(rt,zt){var ie=Ct(rt,!!zt);return"function"==typeof ie&&oe(rt,".prototype.")>-1?Rt(ie):ie}},5436:(nn,we,Tt)=>{"use strict";var Ct=Tt(5333),Rt=Tt(491),oe=Tt(2245),Pt=Tt(5223),rt=Rt("%Function.prototype.apply%"),zt=Rt("%Function.prototype.call%"),ie=Rt("%Reflect.apply%",!0)||Ct.call(zt,rt),Yt=Tt(474),Me=Rt("%Math.max%");nn.exports=function(ee){if("function"!=typeof ee)throw new Pt("a function is required");var _e=ie(Ct,zt,arguments);return oe(_e,1+Me(0,ee.length-(arguments.length-1)),!0)};var Be=function(){return ie(Ct,rt,arguments)};Yt?Yt(nn.exports,"apply",{value:Be}):nn.exports.apply=Be},3664:(nn,we,Tt)=>{"use strict";var Ct=Tt(938),Rt=Tt(7935),oe=Tt(4179),Pt=Tt(6138).orient2d;function rt(ut,H,ht){H=Math.max(0,void 0===H?2:H),ht=ht||0;var J=function an(ut){for(var H=ut[0],ht=ut[0],J=ut[0],ue=ut[0],St=0;St<ut.length;St++){var Ht=ut[St];Ht[0]<H[0]&&(H=Ht),Ht[0]>J[0]&&(J=Ht),Ht[1]<ht[1]&&(ht=Ht),Ht[1]>ue[1]&&(ue=Ht)}var Et=[H,ht,J,ue],cn=Et.slice();for(St=0;St<ut.length;St++)oe(ut[St],Et)||cn.push(ut[St]);return function kt(ut){ut.sort(ct);for(var H=[],ht=0;ht<ut.length;ht++){for(;H.length>=2&&Ce(H[H.length-2],H[H.length-1],ut[ht])<=0;)H.pop();H.push(ut[ht])}for(var J=[],ue=ut.length-1;ue>=0;ue--){for(;J.length>=2&&Ce(J[J.length-2],J[J.length-1],ut[ue])<=0;)J.pop();J.push(ut[ue])}return J.pop(),H.pop(),H.concat(J)}(cn)}(ut),ue=new Ct(16);ue.toBBox=function(pe){return{minX:pe[0],minY:pe[1],maxX:pe[0],maxY:pe[1]}},ue.compareMinX=function(pe,Fe){return pe[0]-Fe[0]},ue.compareMinY=function(pe,Fe){return pe[1]-Fe[1]},ue.load(ut);for(var Et,St=[],Ht=0;Ht<J.length;Ht++){var cn=J[Ht];ue.remove(cn),Et=pt(cn,Et),St.push(Et)}var en=new Ct(16);for(Ht=0;Ht<St.length;Ht++)en.insert(_e(St[Ht]));for(var Ft=H*H,de=ht*ht;St.length;){var Vt=St.shift(),At=Vt.p,ne=Vt.next.p,wt=mt(At,ne);if(!(wt<de)){var Le=wt/Ft;(cn=zt(ue,Vt.prev.p,At,ne,Vt.next.next.p,Le,en))&&Math.min(mt(cn,At),mt(cn,ne))<=Le&&(St.push(Vt),St.push(pt(cn,Vt)),ue.remove(cn),en.remove(Vt),en.insert(_e(Vt)),en.insert(_e(Vt.next)))}}Vt=Et;var Pe=[];do{Pe.push(Vt.p),Vt=Vt.next}while(Vt!==Et);return Pe.push(Vt.p),Pe}function zt(ut,H,ht,J,ue,St,Ht){for(var Et=new Rt([],ie),cn=ut.data;cn;){for(var en=0;en<cn.children.length;en++){var Ft=cn.children[en],de=cn.leaf?ot(Ft,ht,J):Yt(ht,J,Ft);de>St||Et.push({node:Ft,dist:de})}for(;Et.length&&!Et.peek().node.children;){var Vt=Et.pop(),At=Vt.node,ne=ot(At,H,ht),wt=ot(At,J,ue);if(Vt.dist<ne&&Vt.dist<wt&&Be(ht,At,Ht)&&Be(J,At,Ht))return At}(cn=Et.pop())&&(cn=cn.node)}return null}function ie(ut,H){return ut.dist-H.dist}function Yt(ut,H,ht){if(Me(ut,ht)||Me(H,ht))return 0;var J=gt(ut[0],ut[1],H[0],H[1],ht.minX,ht.minY,ht.maxX,ht.minY);if(0===J)return 0;var ue=gt(ut[0],ut[1],H[0],H[1],ht.minX,ht.minY,ht.minX,ht.maxY);if(0===ue)return 0;var St=gt(ut[0],ut[1],H[0],H[1],ht.maxX,ht.minY,ht.maxX,ht.maxY);if(0===St)return 0;var Ht=gt(ut[0],ut[1],H[0],H[1],ht.minX,ht.maxY,ht.maxX,ht.maxY);return 0===Ht?0:Math.min(J,ue,St,Ht)}function Me(ut,H){return ut[0]>=H.minX&&ut[0]<=H.maxX&&ut[1]>=H.minY&&ut[1]<=H.maxY}function Be(ut,H,ht){for(var J=Math.min(ut[0],H[0]),ue=Math.min(ut[1],H[1]),St=Math.max(ut[0],H[0]),Ht=Math.max(ut[1],H[1]),Et=ht.search({minX:J,minY:ue,maxX:St,maxY:Ht}),cn=0;cn<Et.length;cn++)if(ee(Et[cn].p,Et[cn].next.p,ut,H))return!1;return!0}function Ce(ut,H,ht){return Pt(ut[0],ut[1],H[0],H[1],ht[0],ht[1])}function ee(ut,H,ht,J){return ut!==J&&H!==ht&&Ce(ut,H,ht)>0!=Ce(ut,H,J)>0&&Ce(ht,J,ut)>0!=Ce(ht,J,H)>0}function _e(ut){var H=ut.p,ht=ut.next.p;return ut.minX=Math.min(H[0],ht[0]),ut.minY=Math.min(H[1],ht[1]),ut.maxX=Math.max(H[0],ht[0]),ut.maxY=Math.max(H[1],ht[1]),ut}function pt(ut,H){var ht={p:ut,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return H?(ht.next=H.next,ht.prev=H,H.next.prev=ht,H.next=ht):(ht.prev=ht,ht.next=ht),ht}function mt(ut,H){var ht=ut[0]-H[0],J=ut[1]-H[1];return ht*ht+J*J}function ot(ut,H,ht){var J=H[0],ue=H[1],St=ht[0]-J,Ht=ht[1]-ue;if(0!==St||0!==Ht){var Et=((ut[0]-J)*St+(ut[1]-ue)*Ht)/(St*St+Ht*Ht);Et>1?(J=ht[0],ue=ht[1]):Et>0&&(J+=St*Et,ue+=Ht*Et)}return(St=ut[0]-J)*St+(Ht=ut[1]-ue)*Ht}function gt(ut,H,ht,J,ue,St,Ht,Et){var Ln,On,yn,Yn,cn=ht-ut,en=J-H,Ft=Ht-ue,de=Et-St,Vt=ut-ue,At=H-St,ne=cn*cn+en*en,wt=cn*Ft+en*de,Le=Ft*Ft+de*de,Pe=cn*Vt+en*At,pe=Ft*Vt+de*At,Fe=ne*Le-wt*wt,Gn=Fe,hn=Fe;0===Fe?(On=0,Gn=1,Yn=pe,hn=Le):(Yn=ne*pe-wt*Pe,(On=wt*pe-Le*Pe)<0?(On=0,Yn=pe,hn=Le):On>Gn&&(On=Gn,Yn=pe+wt,hn=Le)),Yn<0?(Yn=0,-Pe<0?On=0:-Pe>ne?On=Gn:(On=-Pe,Gn=ne)):Yn>hn&&(Yn=hn,-Pe+wt<0?On=0:-Pe+wt>ne?On=Gn:(On=-Pe+wt,Gn=ne));var vt=(1-(yn=0===Yn?0:Yn/hn))*ue+yn*Ht-((1-(Ln=0===On?0:On/Gn))*ut+Ln*ht),Gt=(1-yn)*St+yn*Et-((1-Ln)*H+Ln*J);return vt*vt+Gt*Gt}function ct(ut,H){return ut[0]===H[0]?ut[1]-H[1]:ut[0]-H[0]}Rt.default&&(Rt=Rt.default),nn.exports=rt,nn.exports.default=rt},938:function(nn){nn.exports=function(){"use strict";function we(pt,mt,ot,gt,ct){!function kt(ut,H,ht,J,ue){for(;J>ht;){if(J-ht>600){var St=J-ht+1,Ht=H-ht+1,Et=Math.log(St),cn=.5*Math.exp(2*Et/3),en=.5*Math.sqrt(Et*cn*(St-cn)/St)*(Ht-St/2<0?-1:1);kt(ut,H,Math.max(ht,Math.floor(H-Ht*cn/St+en)),Math.min(J,Math.floor(H+(St-Ht)*cn/St+en)),ue)}var Vt=ut[H],At=ht,ne=J;for(Tt(ut,ht,H),ue(ut[J],Vt)>0&&Tt(ut,ht,J);At<ne;){for(Tt(ut,At,ne),At++,ne--;ue(ut[At],Vt)<0;)At++;for(;ue(ut[ne],Vt)>0;)ne--}0===ue(ut[ht],Vt)?Tt(ut,ht,ne):Tt(ut,++ne,J),ne<=H&&(ht=ne+1),H<=ne&&(J=ne-1)}}(pt,mt,ot||0,gt||pt.length-1,ct||Ct)}function Tt(pt,mt,ot){var gt=pt[mt];pt[mt]=pt[ot],pt[ot]=gt}function Ct(pt,mt){return pt<mt?-1:pt>mt?1:0}var Rt=function(pt){void 0===pt&&(pt=9),this._maxEntries=Math.max(4,pt),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function oe(pt,mt,ot){if(!ot)return mt.indexOf(pt);for(var gt=0;gt<mt.length;gt++)if(ot(pt,mt[gt]))return gt;return-1}function Pt(pt,mt){rt(pt,0,pt.children.length,mt,pt)}function rt(pt,mt,ot,gt,ct){ct||(ct=_e(null)),ct.minX=1/0,ct.minY=1/0,ct.maxX=-1/0,ct.maxY=-1/0;for(var kt=mt;kt<ot;kt++){var ut=pt.children[kt];zt(ct,pt.leaf?gt(ut):ut)}return ct}function zt(pt,mt){return pt.minX=Math.min(pt.minX,mt.minX),pt.minY=Math.min(pt.minY,mt.minY),pt.maxX=Math.max(pt.maxX,mt.maxX),pt.maxY=Math.max(pt.maxY,mt.maxY),pt}function ie(pt,mt){return pt.minX-mt.minX}function Yt(pt,mt){return pt.minY-mt.minY}function Me(pt){return(pt.maxX-pt.minX)*(pt.maxY-pt.minY)}function Be(pt){return pt.maxX-pt.minX+(pt.maxY-pt.minY)}function Ce(pt,mt){return pt.minX<=mt.minX&&pt.minY<=mt.minY&&mt.maxX<=pt.maxX&&mt.maxY<=pt.maxY}function ee(pt,mt){return mt.minX<=pt.maxX&&mt.minY<=pt.maxY&&mt.maxX>=pt.minX&&mt.maxY>=pt.minY}function _e(pt){return{children:pt,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function an(pt,mt,ot,gt,ct){for(var kt=[mt,ot];kt.length;)if(!((ot=kt.pop())-(mt=kt.pop())<=gt)){var ut=mt+Math.ceil((ot-mt)/gt/2)*gt;we(pt,ut,mt,ot,ct),kt.push(mt,ut,ut,ot)}}return Rt.prototype.all=function(){return this._all(this.data,[])},Rt.prototype.search=function(pt){var mt=this.data,ot=[];if(!ee(pt,mt))return ot;for(var gt=this.toBBox,ct=[];mt;){for(var kt=0;kt<mt.children.length;kt++){var ut=mt.children[kt],H=mt.leaf?gt(ut):ut;ee(pt,H)&&(mt.leaf?ot.push(ut):Ce(pt,H)?this._all(ut,ot):ct.push(ut))}mt=ct.pop()}return ot},Rt.prototype.collides=function(pt){var mt=this.data;if(!ee(pt,mt))return!1;for(var ot=[];mt;){for(var gt=0;gt<mt.children.length;gt++){var ct=mt.children[gt],kt=mt.leaf?this.toBBox(ct):ct;if(ee(pt,kt)){if(mt.leaf||Ce(pt,kt))return!0;ot.push(ct)}}mt=ot.pop()}return!1},Rt.prototype.load=function(pt){if(!pt||!pt.length)return this;if(pt.length<this._minEntries){for(var mt=0;mt<pt.length;mt++)this.insert(pt[mt]);return this}var ot=this._build(pt.slice(),0,pt.length-1,0);if(this.data.children.length)if(this.data.height===ot.height)this._splitRoot(this.data,ot);else{if(this.data.height<ot.height){var gt=this.data;this.data=ot,ot=gt}this._insert(ot,this.data.height-ot.height-1,!0)}else this.data=ot;return this},Rt.prototype.insert=function(pt){return pt&&this._insert(pt,this.data.height-1),this},Rt.prototype.clear=function(){return this.data=_e([]),this},Rt.prototype.remove=function(pt,mt){if(!pt)return this;for(var ot,gt,ct,kt=this.data,ut=this.toBBox(pt),H=[],ht=[];kt||H.length;){if(kt||(kt=H.pop(),gt=H[H.length-1],ot=ht.pop(),ct=!0),kt.leaf){var J=oe(pt,kt.children,mt);if(-1!==J)return kt.children.splice(J,1),H.push(kt),this._condense(H),this}ct||kt.leaf||!Ce(kt,ut)?gt?(ot++,kt=gt.children[ot],ct=!1):kt=null:(H.push(kt),ht.push(ot),ot=0,gt=kt,kt=kt.children[0])}return this},Rt.prototype.toBBox=function(pt){return pt},Rt.prototype.compareMinX=function(pt,mt){return pt.minX-mt.minX},Rt.prototype.compareMinY=function(pt,mt){return pt.minY-mt.minY},Rt.prototype.toJSON=function(){return this.data},Rt.prototype.fromJSON=function(pt){return this.data=pt,this},Rt.prototype._all=function(pt,mt){for(var ot=[];pt;)pt.leaf?mt.push.apply(mt,pt.children):ot.push.apply(ot,pt.children),pt=ot.pop();return mt},Rt.prototype._build=function(pt,mt,ot,gt){var ct,kt=ot-mt+1,ut=this._maxEntries;if(kt<=ut)return Pt(ct=_e(pt.slice(mt,ot+1)),this.toBBox),ct;gt||(gt=Math.ceil(Math.log(kt)/Math.log(ut)),ut=Math.ceil(kt/Math.pow(ut,gt-1))),(ct=_e([])).leaf=!1,ct.height=gt;var H=Math.ceil(kt/ut),ht=H*Math.ceil(Math.sqrt(ut));an(pt,mt,ot,ht,this.compareMinX);for(var J=mt;J<=ot;J+=ht){var ue=Math.min(J+ht-1,ot);an(pt,J,ue,H,this.compareMinY);for(var St=J;St<=ue;St+=H){var Ht=Math.min(St+H-1,ue);ct.children.push(this._build(pt,St,Ht,gt-1))}}return Pt(ct,this.toBBox),ct},Rt.prototype._chooseSubtree=function(pt,mt,ot,gt){for(;gt.push(mt),!mt.leaf&&gt.length-1!==ot;){for(var ct=1/0,kt=1/0,ut=void 0,H=0;H<mt.children.length;H++){var ht=mt.children[H],J=Me(ht),ue=(St=pt,Ht=ht,(Math.max(Ht.maxX,St.maxX)-Math.min(Ht.minX,St.minX))*(Math.max(Ht.maxY,St.maxY)-Math.min(Ht.minY,St.minY))-J);ue<kt?(kt=ue,ct=J<ct?J:ct,ut=ht):ue===kt&&J<ct&&(ct=J,ut=ht)}mt=ut||mt.children[0]}var St,Ht;return mt},Rt.prototype._insert=function(pt,mt,ot){var gt=ot?pt:this.toBBox(pt),ct=[],kt=this._chooseSubtree(gt,this.data,mt,ct);for(kt.children.push(pt),zt(kt,gt);mt>=0&&ct[mt].children.length>this._maxEntries;)this._split(ct,mt),mt--;this._adjustParentBBoxes(gt,ct,mt)},Rt.prototype._split=function(pt,mt){var ot=pt[mt],gt=ot.children.length,ct=this._minEntries;this._chooseSplitAxis(ot,ct,gt);var kt=this._chooseSplitIndex(ot,ct,gt),ut=_e(ot.children.splice(kt,ot.children.length-kt));ut.height=ot.height,ut.leaf=ot.leaf,Pt(ot,this.toBBox),Pt(ut,this.toBBox),mt?pt[mt-1].children.push(ut):this._splitRoot(ot,ut)},Rt.prototype._splitRoot=function(pt,mt){this.data=_e([pt,mt]),this.data.height=pt.height+1,this.data.leaf=!1,Pt(this.data,this.toBBox)},Rt.prototype._chooseSplitIndex=function(pt,mt,ot){for(var gt,ct,kt,ut,H,ht,J,ue=1/0,St=1/0,Ht=mt;Ht<=ot-mt;Ht++){var Et=rt(pt,0,Ht,this.toBBox),cn=rt(pt,Ht,ot,this.toBBox),en=(ct=Et,kt=cn,void 0,void 0,void 0,void 0,ut=Math.max(ct.minX,kt.minX),H=Math.max(ct.minY,kt.minY),ht=Math.min(ct.maxX,kt.maxX),J=Math.min(ct.maxY,kt.maxY),Math.max(0,ht-ut)*Math.max(0,J-H)),Ft=Me(Et)+Me(cn);en<ue?(ue=en,gt=Ht,St=Ft<St?Ft:St):en===ue&&Ft<St&&(St=Ft,gt=Ht)}return gt||ot-mt},Rt.prototype._chooseSplitAxis=function(pt,mt,ot){var gt=pt.leaf?this.compareMinX:ie,ct=pt.leaf?this.compareMinY:Yt;this._allDistMargin(pt,mt,ot,gt)<this._allDistMargin(pt,mt,ot,ct)&&pt.children.sort(gt)},Rt.prototype._allDistMargin=function(pt,mt,ot,gt){pt.children.sort(gt);for(var ct=this.toBBox,kt=rt(pt,0,mt,ct),ut=rt(pt,ot-mt,ot,ct),H=Be(kt)+Be(ut),ht=mt;ht<ot-mt;ht++){var J=pt.children[ht];zt(kt,pt.leaf?ct(J):J),H+=Be(kt)}for(var ue=ot-mt-1;ue>=mt;ue--){var St=pt.children[ue];zt(ut,pt.leaf?ct(St):St),H+=Be(ut)}return H},Rt.prototype._adjustParentBBoxes=function(pt,mt,ot){for(var gt=ot;gt>=0;gt--)zt(mt[gt],pt)},Rt.prototype._condense=function(pt){for(var mt=pt.length-1,ot=void 0;mt>=0;mt--)0===pt[mt].children.length?mt>0?(ot=pt[mt-1].children).splice(ot.indexOf(pt[mt]),1):this.clear():Pt(pt[mt],this.toBBox)},Rt}()},3970:(nn,we,Tt)=>{var Ct=Tt(7809),Rt=Tt(8147),oe=Tt(314),Pt=Tt(4720),rt=Tt(1139),zt=Tt(2365),ie=Date.prototype.getTime;function Me(ee){return null==ee}function Be(ee){return!(!ee||"object"!=typeof ee||"number"!=typeof ee.length||"function"!=typeof ee.copy||"function"!=typeof ee.slice||ee.length>0&&"number"!=typeof ee[0])}nn.exports=function Yt(ee,_e,an){var pt=an||{};return!!(pt.strict?oe(ee,_e):ee===_e)||(!ee||!_e||"object"!=typeof ee&&"object"!=typeof _e?pt.strict?oe(ee,_e):ee==_e:function Ce(ee,_e,an){var pt,mt;if(typeof ee!=typeof _e||Me(ee)||Me(_e)||ee.prototype!==_e.prototype||Rt(ee)!==Rt(_e))return!1;var ot=Pt(ee),gt=Pt(_e);if(ot!==gt)return!1;if(ot||gt)return ee.source===_e.source&&rt(ee)===rt(_e);if(zt(ee)&&zt(_e))return ie.call(ee)===ie.call(_e);var ct=Be(ee),kt=Be(_e);if(ct!==kt)return!1;if(ct||kt){if(ee.length!==_e.length)return!1;for(pt=0;pt<ee.length;pt++)if(ee[pt]!==_e[pt])return!1;return!0}if(typeof ee!=typeof _e)return!1;try{var ut=Ct(ee),H=Ct(_e)}catch{return!1}if(ut.length!==H.length)return!1;for(ut.sort(),H.sort(),pt=ut.length-1;pt>=0;pt--)if(ut[pt]!=H[pt])return!1;for(pt=ut.length-1;pt>=0;pt--)if(!Yt(ee[mt=ut[pt]],_e[mt],an))return!1;return!0}(ee,_e,pt))}},9224:(nn,we,Tt)=>{"use strict";var Ct=Tt(474),Rt=Tt(4203),oe=Tt(5223),Pt=Tt(9262);nn.exports=function(zt,ie,Yt){if(!zt||"object"!=typeof zt&&"function"!=typeof zt)throw new oe("`obj` must be an object or a function`");if("string"!=typeof ie&&"symbol"!=typeof ie)throw new oe("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new oe("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new oe("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new oe("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new oe("`loose`, if provided, must be a boolean");var Me=arguments.length>3?arguments[3]:null,Be=arguments.length>4?arguments[4]:null,Ce=arguments.length>5?arguments[5]:null,ee=arguments.length>6&&arguments[6],_e=!!Pt&&Pt(zt,ie);if(Ct)Ct(zt,ie,{configurable:null===Ce&&_e?_e.configurable:!Ce,enumerable:null===Me&&_e?_e.enumerable:!Me,value:Yt,writable:null===Be&&_e?_e.writable:!Be});else{if(!ee&&(Me||Be||Ce))throw new Rt("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");zt[ie]=Yt}}},1648:(nn,we,Tt)=>{"use strict";var Ct=Tt(7809),Rt="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),oe=Object.prototype.toString,Pt=Array.prototype.concat,rt=Tt(9224),ie=Tt(2486)(),Yt=function(Be,Ce,ee,_e){if(Ce in Be)if(!0===_e){if(Be[Ce]===ee)return}else if(!function(Be){return"function"==typeof Be&&"[object Function]"===oe.call(Be)}(_e)||!_e())return;ie?rt(Be,Ce,ee,!0):rt(Be,Ce,ee)},Me=function(Be,Ce){var ee=arguments.length>2?arguments[2]:{},_e=Ct(Ce);Rt&&(_e=Pt.call(_e,Object.getOwnPropertySymbols(Ce)));for(var an=0;an<_e.length;an+=1)Yt(Be,_e[an],Ce[_e[an]],ee[_e[an]])};Me.supportsDescriptors=!!ie,nn.exports=Me},7649:nn=>{function we(Tt,Ct,Rt,oe){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(Tt,Ct,Rt,oe)}we.prototype.run=function(Tt,Ct,Rt,oe){this._init(Tt,Ct,Rt,oe);for(var Pt=0;Pt<this._datasetLength;Pt++)if(1!==this._visited[Pt]){this._visited[Pt]=1;var rt=this._regionQuery(Pt);if(rt.length<this.minPts)this.noise.push(Pt);else{var zt=this.clusters.length;this.clusters.push([]),this._addToCluster(Pt,zt),this._expandCluster(zt,rt)}}return this.clusters},we.prototype._init=function(Tt,Ct,Rt,oe){if(Tt){if(!(Tt instanceof Array))throw Error("Dataset must be of type array, "+typeof Tt+" given");this.dataset=Tt,this.clusters=[],this.noise=[],this._datasetLength=Tt.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}Ct&&(this.epsilon=Ct),Rt&&(this.minPts=Rt),oe&&(this.distance=oe)},we.prototype._expandCluster=function(Tt,Ct){for(var Rt=0;Rt<Ct.length;Rt++){var oe=Ct[Rt];if(1!==this._visited[oe]){this._visited[oe]=1;var Pt=this._regionQuery(oe);Pt.length>=this.minPts&&(Ct=this._mergeArrays(Ct,Pt))}1!==this._assigned[oe]&&this._addToCluster(oe,Tt)}},we.prototype._addToCluster=function(Tt,Ct){this.clusters[Ct].push(Tt),this._assigned[Tt]=1},we.prototype._regionQuery=function(Tt){for(var Ct=[],Rt=0;Rt<this._datasetLength;Rt++)this.distance(this.dataset[Tt],this.dataset[Rt])<this.epsilon&&Ct.push(Rt);return Ct},we.prototype._mergeArrays=function(Tt,Ct){for(var Rt=Ct.length,oe=0;oe<Rt;oe++){var Pt=Ct[oe];Tt.indexOf(Pt)<0&&Tt.push(Pt)}return Tt},we.prototype._euclideanDistance=function(Tt,Ct){for(var Rt=0,oe=Math.min(Tt.length,Ct.length);oe--;)Rt+=(Tt[oe]-Ct[oe])*(Tt[oe]-Ct[oe]);return Math.sqrt(Rt)},nn.exports&&(nn.exports=we)},442:nn=>{function we(Tt,Ct,Rt){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(Tt,Ct,Rt)}we.prototype.init=function(Tt,Ct,Rt){this.assignments=[],this.centroids=[],typeof Tt<"u"&&(this.dataset=Tt),typeof Ct<"u"&&(this.k=Ct),typeof Rt<"u"&&(this.distance=Rt)},we.prototype.run=function(Tt,Ct){this.init(Tt,Ct);for(var Rt=this.dataset.length,oe=0;oe<this.k;oe++)this.centroids[oe]=this.randomCentroid();for(var Pt=!0;Pt;){Pt=this.assign();for(var rt=0;rt<this.k;rt++){for(var zt=new Array(Be),ie=0,Yt=0;Yt<Be;Yt++)zt[Yt]=0;for(var Me=0;Me<Rt;Me++){var Be=this.dataset[Me].length;if(rt===this.assignments[Me]){for(Yt=0;Yt<Be;Yt++)zt[Yt]+=this.dataset[Me][Yt];ie++}}if(ie>0){for(Yt=0;Yt<Be;Yt++)zt[Yt]/=ie;this.centroids[rt]=zt}else this.centroids[rt]=this.randomCentroid(),Pt=!0}}return this.getClusters()},we.prototype.randomCentroid=function(){var Ct,Rt,Tt=this.dataset.length-1;do{Rt=Math.round(Math.random()*Tt),Ct=this.dataset[Rt]}while(this.centroids.indexOf(Ct)>=0);return Ct},we.prototype.assign=function(){for(var Rt,Tt=!1,Ct=this.dataset.length,oe=0;oe<Ct;oe++)(Rt=this.argmin(this.dataset[oe],this.centroids,this.distance))!=this.assignments[oe]&&(this.assignments[oe]=Rt,Tt=!0);return Tt},we.prototype.getClusters=function(){for(var Ct,Tt=new Array(this.k),Rt=0;Rt<this.assignments.length;Rt++)typeof Tt[Ct=this.assignments[Rt]]>"u"&&(Tt[Ct]=[]),Tt[Ct].push(Rt);return Tt},we.prototype.argmin=function(Tt,Ct,Rt){for(var zt,oe=Number.MAX_VALUE,Pt=0,rt=Ct.length,ie=0;ie<rt;ie++)(zt=Rt(Tt,Ct[ie]))<oe&&(oe=zt,Pt=ie);return Pt},we.prototype.distance=function(Tt,Ct){for(var Rt=0,oe=Math.min(Tt.length,Ct.length);oe--;){var Pt=Tt[oe]-Ct[oe];Rt+=Pt*Pt}return Math.sqrt(Rt)},nn.exports&&(nn.exports=we)},2195:(nn,we,Tt)=>{if(nn.exports)var Ct=Tt(6216);function Rt(oe,Pt,rt,zt){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(oe,Pt,rt,zt)}Rt.prototype.run=function(oe,Pt,rt,zt){this._init(oe,Pt,rt,zt);for(var ie=0,Yt=this.dataset.length;ie<Yt;ie++)if(1!==this._processed[ie]){this._processed[ie]=1,this.clusters.push([ie]);var Me=this.clusters.length-1;this._orderedList.push(ie);var Be=new Ct(null,null,"asc"),Ce=this._regionQuery(ie);void 0!==this._distanceToCore(ie)&&(this._updateQueue(ie,Ce,Be),this._expandCluster(Me,Be))}return this.clusters},Rt.prototype.getReachabilityPlot=function(){for(var oe=[],Pt=0,rt=this._orderedList.length;Pt<rt;Pt++){var zt=this._orderedList[Pt];oe.push([zt,this._reachability[zt]])}return oe},Rt.prototype._init=function(oe,Pt,rt,zt){if(oe){if(!(oe instanceof Array))throw Error("Dataset must be of type array, "+typeof oe+" given");this.dataset=oe,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}Pt&&(this.epsilon=Pt),rt&&(this.minPts=rt),zt&&(this.distance=zt)},Rt.prototype._updateQueue=function(oe,Pt,rt){var zt=this;this._coreDistance=this._distanceToCore(oe),Pt.forEach(function(ie){if(void 0===zt._processed[ie]){var Yt=zt.distance(zt.dataset[oe],zt.dataset[ie]),Me=Math.max(zt._coreDistance,Yt);void 0===zt._reachability[ie]?(zt._reachability[ie]=Me,rt.insert(ie,Me)):Me<zt._reachability[ie]&&(zt._reachability[ie]=Me,rt.remove(ie),rt.insert(ie,Me))}})},Rt.prototype._expandCluster=function(oe,Pt){for(var rt=Pt.getElements(),zt=0,ie=rt.length;zt<ie;zt++){var Yt=rt[zt];if(void 0===this._processed[Yt]){var Me=this._regionQuery(Yt);this._processed[Yt]=1,this.clusters[oe].push(Yt),this._orderedList.push(Yt),void 0!==this._distanceToCore(Yt)&&(this._updateQueue(Yt,Me,Pt),this._expandCluster(oe,Pt))}}},Rt.prototype._distanceToCore=function(oe){for(var Pt=this.epsilon,rt=0;rt<Pt;rt++)if(this._regionQuery(oe,rt).length>=this.minPts)return rt},Rt.prototype._regionQuery=function(oe,Pt){Pt=Pt||this.epsilon;for(var rt=[],zt=0,ie=this.dataset.length;zt<ie;zt++)this.distance(this.dataset[oe],this.dataset[zt])<Pt&&rt.push(zt);return rt},Rt.prototype._euclideanDistance=function(oe,Pt){for(var rt=0,zt=Math.min(oe.length,Pt.length);zt--;)rt+=(oe[zt]-Pt[zt])*(oe[zt]-Pt[zt]);return Math.sqrt(rt)},nn.exports&&(nn.exports=Rt)},6216:nn=>{function we(Tt,Ct,Rt){this._queue=[],this._priorities=[],this._sorting="desc",this._init(Tt,Ct,Rt)}we.prototype.insert=function(Tt,Ct){for(var Rt=this._queue.length,oe=Rt;oe--;){var Pt=this._priorities[oe];"desc"===this._sorting?Ct>Pt&&(Rt=oe):Ct<Pt&&(Rt=oe)}this._insertAt(Tt,Ct,Rt)},we.prototype.remove=function(Tt){for(var Ct=this._queue.length;Ct--;)if(Tt===this._queue[Ct]){this._queue.splice(Ct,1),this._priorities.splice(Ct,1);break}},we.prototype.forEach=function(Tt){this._queue.forEach(Tt)},we.prototype.getElements=function(){return this._queue},we.prototype.getElementPriority=function(Tt){return this._priorities[Tt]},we.prototype.getPriorities=function(){return this._priorities},we.prototype.getElementsWithPriorities=function(){for(var Tt=[],Ct=0,Rt=this._queue.length;Ct<Rt;Ct++)Tt.push([this._queue[Ct],this._priorities[Ct]]);return Tt},we.prototype._init=function(Tt,Ct,Rt){if(Tt&&Ct){if(this._queue=[],this._priorities=[],Tt.length!==Ct.length)throw new Error("Arrays must have the same length");for(var oe=0;oe<Tt.length;oe++)this.insert(Tt[oe],Ct[oe])}Rt&&(this._sorting=Rt)},we.prototype._insertAt=function(Tt,Ct,Rt){this._queue.length===Rt?(this._queue.push(Tt),this._priorities.push(Ct)):(this._queue.splice(Rt,0,Tt),this._priorities.splice(Rt,0,Ct))},nn.exports&&(nn.exports=we)},3367:(nn,we,Tt)=>{nn.exports&&(nn.exports={DBSCAN:Tt(7649),KMEANS:Tt(442),OPTICS:Tt(2195),PriorityQueue:Tt(6216)})},9145:nn=>{"use strict";function we(Ft,de,Vt){Vt=Vt||2;var Pe,pe,Fe,Ln,On,yn,Yn,At=de&&de.length,ne=At?de[0]*Vt:Ft.length,wt=Tt(Ft,0,ne,Vt,!0),Le=[];if(!wt||wt.next===wt.prev)return Le;if(At&&(wt=function ie(Ft,de,Vt,At){var wt,Le,Fe,ne=[];for(wt=0,Le=de.length;wt<Le;wt++)(Fe=Tt(Ft,de[wt]*At,wt<Le-1?de[wt+1]*At:Ft.length,At,!1))===Fe.next&&(Fe.steiner=!0),ne.push(pt(Fe));for(ne.sort(Yt),wt=0;wt<ne.length;wt++)Vt=Me(ne[wt],Vt);return Vt}(Ft,de,wt,Vt)),Ft.length>80*Vt){Pe=Fe=Ft[0],pe=Ln=Ft[1];for(var Gn=Vt;Gn<ne;Gn+=Vt)(On=Ft[Gn])<Pe&&(Pe=On),(yn=Ft[Gn+1])<pe&&(pe=yn),On>Fe&&(Fe=On),yn>Ln&&(Ln=yn);Yn=0!==(Yn=Math.max(Fe-Pe,Ln-pe))?32767/Yn:0}return Rt(wt,Le,Vt,Pe,pe,Yn,0),Le}function Tt(Ft,de,Vt,At,ne){var wt,Le;if(ne===en(Ft,de,Vt,At)>0)for(wt=de;wt<Vt;wt+=At)Le=Ht(wt,Ft[wt],Ft[wt+1],Le);else for(wt=Vt-At;wt>=de;wt-=At)Le=Ht(wt,Ft[wt],Ft[wt+1],Le);return Le&&ct(Le,Le.next)&&(Et(Le),Le=Le.next),Le}function Ct(Ft,de){if(!Ft)return Ft;de||(de=Ft);var At,Vt=Ft;do{if(At=!1,Vt.steiner||!ct(Vt,Vt.next)&&0!==gt(Vt.prev,Vt,Vt.next))Vt=Vt.next;else{if(Et(Vt),(Vt=de=Vt.prev)===Vt.next)break;At=!0}}while(At||Vt!==de);return de}function Rt(Ft,de,Vt,At,ne,wt,Le){if(Ft){!Le&&wt&&function ee(Ft,de,Vt,At){var ne=Ft;do{0===ne.z&&(ne.z=an(ne.x,ne.y,de,Vt,At)),ne.prevZ=ne.prev,ne.nextZ=ne.next,ne=ne.next}while(ne!==Ft);ne.prevZ.nextZ=null,ne.prevZ=null,function _e(Ft){var de,Vt,At,ne,wt,Le,Pe,pe,Fe=1;do{for(Vt=Ft,Ft=null,wt=null,Le=0;Vt;){for(Le++,At=Vt,Pe=0,de=0;de<Fe&&(Pe++,At=At.nextZ);de++);for(pe=Fe;Pe>0||pe>0&&At;)0!==Pe&&(0===pe||!At||Vt.z<=At.z)?(ne=Vt,Vt=Vt.nextZ,Pe--):(ne=At,At=At.nextZ,pe--),wt?wt.nextZ=ne:Ft=ne,ne.prevZ=wt,wt=ne;Vt=At}wt.nextZ=null,Fe*=2}while(Le>1)}(ne)}(Ft,At,ne,wt);for(var pe,Fe,Pe=Ft;Ft.prev!==Ft.next;)if(pe=Ft.prev,Fe=Ft.next,wt?Pt(Ft,At,ne,wt):oe(Ft))de.push(pe.i/Vt|0),de.push(Ft.i/Vt|0),de.push(Fe.i/Vt|0),Et(Ft),Ft=Fe.next,Pe=Fe.next;else if((Ft=Fe)===Pe){Le?1===Le?Rt(Ft=rt(Ct(Ft),de,Vt),de,Vt,At,ne,wt,2):2===Le&&zt(Ft,de,Vt,At,ne,wt):Rt(Ct(Ft),de,Vt,At,ne,wt,1);break}}}function oe(Ft){var de=Ft.prev,Vt=Ft,At=Ft.next;if(gt(de,Vt,At)>=0)return!1;for(var ne=de.x,wt=Vt.x,Le=At.x,Pe=de.y,pe=Vt.y,Fe=At.y,Ln=ne<wt?ne<Le?ne:Le:wt<Le?wt:Le,On=Pe<pe?Pe<Fe?Pe:Fe:pe<Fe?pe:Fe,yn=ne>wt?ne>Le?ne:Le:wt>Le?wt:Le,Yn=Pe>pe?Pe>Fe?Pe:Fe:pe>Fe?pe:Fe,Gn=At.next;Gn!==de;){if(Gn.x>=Ln&&Gn.x<=yn&&Gn.y>=On&&Gn.y<=Yn&&mt(ne,Pe,wt,pe,Le,Fe,Gn.x,Gn.y)&&gt(Gn.prev,Gn,Gn.next)>=0)return!1;Gn=Gn.next}return!0}function Pt(Ft,de,Vt,At){var ne=Ft.prev,wt=Ft,Le=Ft.next;if(gt(ne,wt,Le)>=0)return!1;for(var Pe=ne.x,pe=wt.x,Fe=Le.x,Ln=ne.y,On=wt.y,yn=Le.y,Yn=Pe<pe?Pe<Fe?Pe:Fe:pe<Fe?pe:Fe,Gn=Ln<On?Ln<yn?Ln:yn:On<yn?On:yn,hn=Pe>pe?Pe>Fe?Pe:Fe:pe>Fe?pe:Fe,Er=Ln>On?Ln>yn?Ln:yn:On>yn?On:yn,di=an(Yn,Gn,de,Vt,At),Te=an(hn,Er,de,Vt,At),st=Ft.prevZ,vt=Ft.nextZ;st&&st.z>=di&&vt&&vt.z<=Te;){if(st.x>=Yn&&st.x<=hn&&st.y>=Gn&&st.y<=Er&&st!==ne&&st!==Le&&mt(Pe,Ln,pe,On,Fe,yn,st.x,st.y)&&gt(st.prev,st,st.next)>=0||(st=st.prevZ,vt.x>=Yn&&vt.x<=hn&&vt.y>=Gn&&vt.y<=Er&&vt!==ne&&vt!==Le&&mt(Pe,Ln,pe,On,Fe,yn,vt.x,vt.y)&&gt(vt.prev,vt,vt.next)>=0))return!1;vt=vt.nextZ}for(;st&&st.z>=di;){if(st.x>=Yn&&st.x<=hn&&st.y>=Gn&&st.y<=Er&&st!==ne&&st!==Le&&mt(Pe,Ln,pe,On,Fe,yn,st.x,st.y)&&gt(st.prev,st,st.next)>=0)return!1;st=st.prevZ}for(;vt&&vt.z<=Te;){if(vt.x>=Yn&&vt.x<=hn&&vt.y>=Gn&&vt.y<=Er&&vt!==ne&&vt!==Le&&mt(Pe,Ln,pe,On,Fe,yn,vt.x,vt.y)&&gt(vt.prev,vt,vt.next)>=0)return!1;vt=vt.nextZ}return!0}function rt(Ft,de,Vt){var At=Ft;do{var ne=At.prev,wt=At.next.next;!ct(ne,wt)&&kt(ne,At,At.next,wt)&&J(ne,wt)&&J(wt,ne)&&(de.push(ne.i/Vt|0),de.push(At.i/Vt|0),de.push(wt.i/Vt|0),Et(At),Et(At.next),At=Ft=wt),At=At.next}while(At!==Ft);return Ct(At)}function zt(Ft,de,Vt,At,ne,wt){var Le=Ft;do{for(var Pe=Le.next.next;Pe!==Le.prev;){if(Le.i!==Pe.i&&ot(Le,Pe)){var pe=St(Le,Pe);return Le=Ct(Le,Le.next),pe=Ct(pe,pe.next),Rt(Le,de,Vt,At,ne,wt,0),void Rt(pe,de,Vt,At,ne,wt,0)}Pe=Pe.next}Le=Le.next}while(Le!==Ft)}function Yt(Ft,de){return Ft.x-de.x}function Me(Ft,de){var Vt=function Be(Ft,de){var Le,Vt=de,At=Ft.x,ne=Ft.y,wt=-1/0;do{if(ne<=Vt.y&&ne>=Vt.next.y&&Vt.next.y!==Vt.y){var Pe=Vt.x+(ne-Vt.y)*(Vt.next.x-Vt.x)/(Vt.next.y-Vt.y);if(Pe<=At&&Pe>wt&&(wt=Pe,Le=Vt.x<Vt.next.x?Vt:Vt.next,Pe===At))return Le}Vt=Vt.next}while(Vt!==de);if(!Le)return null;var yn,pe=Le,Fe=Le.x,Ln=Le.y,On=1/0;Vt=Le;do{At>=Vt.x&&Vt.x>=Fe&&At!==Vt.x&&mt(ne<Ln?At:wt,ne,Fe,Ln,ne<Ln?wt:At,ne,Vt.x,Vt.y)&&(yn=Math.abs(ne-Vt.y)/(At-Vt.x),J(Vt,Ft)&&(yn<On||yn===On&&(Vt.x>Le.x||Vt.x===Le.x&&Ce(Le,Vt)))&&(Le=Vt,On=yn)),Vt=Vt.next}while(Vt!==pe);return Le}(Ft,de);if(!Vt)return de;var At=St(Vt,Ft);return Ct(At,At.next),Ct(Vt,Vt.next)}function Ce(Ft,de){return gt(Ft.prev,Ft,de.prev)<0&&gt(de.next,Ft,Ft.next)<0}function an(Ft,de,Vt,At,ne){return(Ft=1431655765&((Ft=858993459&((Ft=252645135&((Ft=16711935&((Ft=(Ft-Vt)*ne|0)|Ft<<8))|Ft<<4))|Ft<<2))|Ft<<1))|(de=1431655765&((de=858993459&((de=252645135&((de=16711935&((de=(de-At)*ne|0)|de<<8))|de<<4))|de<<2))|de<<1))<<1}function pt(Ft){var de=Ft,Vt=Ft;do{(de.x<Vt.x||de.x===Vt.x&&de.y<Vt.y)&&(Vt=de),de=de.next}while(de!==Ft);return Vt}function mt(Ft,de,Vt,At,ne,wt,Le,Pe){return(ne-Le)*(de-Pe)>=(Ft-Le)*(wt-Pe)&&(Ft-Le)*(At-Pe)>=(Vt-Le)*(de-Pe)&&(Vt-Le)*(wt-Pe)>=(ne-Le)*(At-Pe)}function ot(Ft,de){return Ft.next.i!==de.i&&Ft.prev.i!==de.i&&!function ht(Ft,de){var Vt=Ft;do{if(Vt.i!==Ft.i&&Vt.next.i!==Ft.i&&Vt.i!==de.i&&Vt.next.i!==de.i&&kt(Vt,Vt.next,Ft,de))return!0;Vt=Vt.next}while(Vt!==Ft);return!1}(Ft,de)&&(J(Ft,de)&&J(de,Ft)&&function ue(Ft,de){var Vt=Ft,At=!1,ne=(Ft.x+de.x)/2,wt=(Ft.y+de.y)/2;do{Vt.y>wt!=Vt.next.y>wt&&Vt.next.y!==Vt.y&&ne<(Vt.next.x-Vt.x)*(wt-Vt.y)/(Vt.next.y-Vt.y)+Vt.x&&(At=!At),Vt=Vt.next}while(Vt!==Ft);return At}(Ft,de)&&(gt(Ft.prev,Ft,de.prev)||gt(Ft,de.prev,de))||ct(Ft,de)&&gt(Ft.prev,Ft,Ft.next)>0&&gt(de.prev,de,de.next)>0)}function gt(Ft,de,Vt){return(de.y-Ft.y)*(Vt.x-de.x)-(de.x-Ft.x)*(Vt.y-de.y)}function ct(Ft,de){return Ft.x===de.x&&Ft.y===de.y}function kt(Ft,de,Vt,At){var ne=H(gt(Ft,de,Vt)),wt=H(gt(Ft,de,At)),Le=H(gt(Vt,At,Ft)),Pe=H(gt(Vt,At,de));return!!(ne!==wt&&Le!==Pe||0===ne&&ut(Ft,Vt,de)||0===wt&&ut(Ft,At,de)||0===Le&&ut(Vt,Ft,At)||0===Pe&&ut(Vt,de,At))}function ut(Ft,de,Vt){return de.x<=Math.max(Ft.x,Vt.x)&&de.x>=Math.min(Ft.x,Vt.x)&&de.y<=Math.max(Ft.y,Vt.y)&&de.y>=Math.min(Ft.y,Vt.y)}function H(Ft){return Ft>0?1:Ft<0?-1:0}function J(Ft,de){return gt(Ft.prev,Ft,Ft.next)<0?gt(Ft,de,Ft.next)>=0&&gt(Ft,Ft.prev,de)>=0:gt(Ft,de,Ft.prev)<0||gt(Ft,Ft.next,de)<0}function St(Ft,de){var Vt=new cn(Ft.i,Ft.x,Ft.y),At=new cn(de.i,de.x,de.y),ne=Ft.next,wt=de.prev;return Ft.next=de,de.prev=Ft,Vt.next=ne,ne.prev=Vt,At.next=Vt,Vt.prev=At,wt.next=At,At.prev=wt,At}function Ht(Ft,de,Vt,At){var ne=new cn(Ft,de,Vt);return At?(ne.next=At.next,ne.prev=At,At.next.prev=ne,At.next=ne):(ne.prev=ne,ne.next=ne),ne}function Et(Ft){Ft.next.prev=Ft.prev,Ft.prev.next=Ft.next,Ft.prevZ&&(Ft.prevZ.nextZ=Ft.nextZ),Ft.nextZ&&(Ft.nextZ.prevZ=Ft.prevZ)}function cn(Ft,de,Vt){this.i=Ft,this.x=de,this.y=Vt,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function en(Ft,de,Vt,At){for(var ne=0,wt=de,Le=Vt-At;wt<Vt;wt+=At)ne+=(Ft[Le]-Ft[wt])*(Ft[wt+1]+Ft[Le+1]),Le=wt;return ne}nn.exports=we,nn.exports.default=we,we.deviation=function(Ft,de,Vt,At){var ne=de&&de.length,Le=Math.abs(en(Ft,0,ne?de[0]*Vt:Ft.length,Vt));if(ne)for(var Pe=0,pe=de.length;Pe<pe;Pe++)Le-=Math.abs(en(Ft,de[Pe]*Vt,Pe<pe-1?de[Pe+1]*Vt:Ft.length,Vt));var On=0;for(Pe=0;Pe<At.length;Pe+=3){var yn=At[Pe]*Vt,Yn=At[Pe+1]*Vt,Gn=At[Pe+2]*Vt;On+=Math.abs((Ft[yn]-Ft[Gn])*(Ft[Yn+1]-Ft[yn+1])-(Ft[yn]-Ft[Yn])*(Ft[Gn+1]-Ft[yn+1]))}return 0===Le&&0===On?0:Math.abs((On-Le)/Le)},we.flatten=function(Ft){for(var de=Ft[0][0].length,Vt={vertices:[],holes:[],dimensions:de},At=0,ne=0;ne<Ft.length;ne++){for(var wt=0;wt<Ft[ne].length;wt++)for(var Le=0;Le<de;Le++)Vt.vertices.push(Ft[ne][wt][Le]);ne>0&&Vt.holes.push(At+=Ft[ne-1].length)}return Vt}},474:(nn,we,Tt)=>{"use strict";var Rt=Tt(491)("%Object.defineProperty%",!0)||!1;if(Rt)try{Rt({},"a",{value:1})}catch{Rt=!1}nn.exports=Rt},4500:nn=>{"use strict";nn.exports=EvalError},2050:nn=>{"use strict";nn.exports=Error},2992:nn=>{"use strict";nn.exports=RangeError},3944:nn=>{"use strict";nn.exports=ReferenceError},4203:nn=>{"use strict";nn.exports=SyntaxError},5223:nn=>{"use strict";nn.exports=TypeError},6130:nn=>{"use strict";nn.exports=URIError},238:nn=>{"use strict";var Tt=Object.prototype.toString,Ct=Math.max,oe=function(ie,Yt){for(var Me=[],Be=0;Be<ie.length;Be+=1)Me[Be]=ie[Be];for(var Ce=0;Ce<Yt.length;Ce+=1)Me[Ce+ie.length]=Yt[Ce];return Me};nn.exports=function(ie){var Yt=this;if("function"!=typeof Yt||"[object Function]"!==Tt.apply(Yt))throw new TypeError("Function.prototype.bind called on incompatible "+Yt);for(var Be,Me=function(ie,Yt){for(var Me=[],Be=1,Ce=0;Be<ie.length;Be+=1,Ce+=1)Me[Ce]=ie[Be];return Me}(arguments),ee=Ct(0,Yt.length-Me.length),_e=[],an=0;an<ee;an++)_e[an]="$"+an;if(Be=Function("binder","return function ("+function(zt,ie){for(var Yt="",Me=0;Me<zt.length;Me+=1)Yt+=zt[Me],Me+1<zt.length&&(Yt+=",");return Yt}(_e)+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof Be){var mt=Yt.apply(this,oe(Me,arguments));return Object(mt)===mt?mt:this}return Yt.apply(ie,oe(Me,arguments))}),Yt.prototype){var pt=function(){};pt.prototype=Yt.prototype,Be.prototype=new pt,pt.prototype=null}return Be}},5333:(nn,we,Tt)=>{"use strict";var Ct=Tt(238);nn.exports=Function.prototype.bind||Ct},1552:nn=>{"use strict";var we=function(){return"string"==typeof function(){}.name},Tt=Object.getOwnPropertyDescriptor;if(Tt)try{Tt([],"length")}catch{Tt=null}we.functionsHaveConfigurableNames=function(){if(!we()||!Tt)return!1;var oe=Tt(function(){},"name");return!!oe&&!!oe.configurable};var Ct=Function.prototype.bind;we.boundFunctionsHaveNames=function(){return we()&&"function"==typeof Ct&&""!==function(){}.bind().name},nn.exports=we},3198:(nn,we,Tt)=>{var Ct=Tt(3970),Rt=function(zt){this.precision=zt&&zt.precision?zt.precision:17,this.direction=!(!zt||!zt.direction)&&zt.direction,this.pseudoNode=!(!zt||!zt.pseudoNode)&&zt.pseudoNode,this.objectComparator=zt&&zt.objectComparator?zt.objectComparator:rt};function oe(zt){return zt.coordinates.map(function(ie){return{type:zt.type.replace("Multi",""),coordinates:ie}})}function Pt(zt,ie){return zt.hasOwnProperty("coordinates")?zt.coordinates.length===ie.coordinates.length:zt.length===ie.length}function rt(zt,ie){return Ct(zt,ie,{strict:!0})}Rt.prototype.compare=function(zt,ie){if(zt.type!==ie.type||!Pt(zt,ie))return!1;switch(zt.type){case"Point":return this.compareCoord(zt.coordinates,ie.coordinates);case"LineString":return this.compareLine(zt.coordinates,ie.coordinates,0,!1);case"Polygon":return this.comparePolygon(zt,ie);case"Feature":return this.compareFeature(zt,ie);default:if(0===zt.type.indexOf("Multi")){var Yt=this,Me=oe(zt),Be=oe(ie);return Me.every(function(Ce){return this.some(function(ee){return Yt.compare(Ce,ee)})},Be)}}return!1},Rt.prototype.compareCoord=function(zt,ie){if(zt.length!==ie.length)return!1;for(var Yt=0;Yt<zt.length;Yt++)if(zt[Yt].toFixed(this.precision)!==ie[Yt].toFixed(this.precision))return!1;return!0},Rt.prototype.compareLine=function(zt,ie,Yt,Me){if(!Pt(zt,ie))return!1;var Be=this.pseudoNode?zt:this.removePseudo(zt),Ce=this.pseudoNode?ie:this.removePseudo(ie);if(!Me||this.compareCoord(Be[0],Ce[0])||(Ce=this.fixStartIndex(Ce,Be))){var ee=this.compareCoord(Be[Yt],Ce[Yt]);return this.direction||ee?this.comparePath(Be,Ce):!!this.compareCoord(Be[Yt],Ce[Ce.length-(1+Yt)])&&this.comparePath(Be.slice().reverse(),Ce)}},Rt.prototype.fixStartIndex=function(zt,ie){for(var Yt,Me=-1,Be=0;Be<zt.length;Be++)if(this.compareCoord(zt[Be],ie[0])){Me=Be;break}return Me>=0&&(Yt=[].concat(zt.slice(Me,zt.length),zt.slice(1,Me+1))),Yt},Rt.prototype.comparePath=function(zt,ie){var Yt=this;return zt.every(function(Me,Be){return Yt.compareCoord(Me,this[Be])},ie)},Rt.prototype.comparePolygon=function(zt,ie){if(this.compareLine(zt.coordinates[0],ie.coordinates[0],1,!0)){var Yt=zt.coordinates.slice(1,zt.coordinates.length),Me=ie.coordinates.slice(1,ie.coordinates.length),Be=this;return Yt.every(function(Ce){return this.some(function(ee){return Be.compareLine(Ce,ee,1,!0)})},Me)}return!1},Rt.prototype.compareFeature=function(zt,ie){return!(zt.id!==ie.id||!this.objectComparator(zt.properties,ie.properties)||!this.compareBBox(zt,ie))&&this.compare(zt.geometry,ie.geometry)},Rt.prototype.compareBBox=function(zt,ie){return!!(!zt.bbox&&!ie.bbox||zt.bbox&&ie.bbox&&this.compareCoord(zt.bbox,ie.bbox))},Rt.prototype.removePseudo=function(zt){return zt},nn.exports=Rt},5665:(nn,we,Tt)=>{var Ct=Tt(7571),Rt=Tt(621),oe=Tt(8570),Pt=Tt(1568).Z,rt=oe.featureEach,Yt=Rt.featureCollection;function Me(Be){var Ce=new Ct(Be);return Ce.insert=function(ee){if("Feature"!==ee.type)throw new Error("invalid feature");return ee.bbox=ee.bbox?ee.bbox:Pt(ee),Ct.prototype.insert.call(this,ee)},Ce.load=function(ee){var _e=[];return Array.isArray(ee)?ee.forEach(function(an){if("Feature"!==an.type)throw new Error("invalid features");an.bbox=an.bbox?an.bbox:Pt(an),_e.push(an)}):rt(ee,function(an){if("Feature"!==an.type)throw new Error("invalid features");an.bbox=an.bbox?an.bbox:Pt(an),_e.push(an)}),Ct.prototype.load.call(this,_e)},Ce.remove=function(ee,_e){if("Feature"!==ee.type)throw new Error("invalid feature");return ee.bbox=ee.bbox?ee.bbox:Pt(ee),Ct.prototype.remove.call(this,ee,_e)},Ce.clear=function(){return Ct.prototype.clear.call(this)},Ce.search=function(ee){var _e=Ct.prototype.search.call(this,this.toBBox(ee));return Yt(_e)},Ce.collides=function(ee){return Ct.prototype.collides.call(this,this.toBBox(ee))},Ce.all=function(){var ee=Ct.prototype.all.call(this);return Yt(ee)},Ce.toJSON=function(){return Ct.prototype.toJSON.call(this)},Ce.fromJSON=function(ee){return Ct.prototype.fromJSON.call(this,ee)},Ce.toBBox=function(ee){var _e;if(ee.bbox)_e=ee.bbox;else if(Array.isArray(ee)&&4===ee.length)_e=ee;else if(Array.isArray(ee)&&6===ee.length)_e=[ee[0],ee[1],ee[3],ee[4]];else if("Feature"===ee.type)_e=Pt(ee);else{if("FeatureCollection"!==ee.type)throw new Error("invalid geojson");_e=Pt(ee)}return{minX:_e[0],minY:_e[1],maxX:_e[2],maxY:_e[3]}},Ce}nn.exports=Me,nn.exports.default=Me},7571:function(nn){nn.exports=function(){"use strict";function we(pt,mt,ot,gt,ct){!function kt(ut,H,ht,J,ue){for(;J>ht;){if(J-ht>600){var St=J-ht+1,Ht=H-ht+1,Et=Math.log(St),cn=.5*Math.exp(2*Et/3),en=.5*Math.sqrt(Et*cn*(St-cn)/St)*(Ht-St/2<0?-1:1);kt(ut,H,Math.max(ht,Math.floor(H-Ht*cn/St+en)),Math.min(J,Math.floor(H+(St-Ht)*cn/St+en)),ue)}var Vt=ut[H],At=ht,ne=J;for(Tt(ut,ht,H),ue(ut[J],Vt)>0&&Tt(ut,ht,J);At<ne;){for(Tt(ut,At,ne),At++,ne--;ue(ut[At],Vt)<0;)At++;for(;ue(ut[ne],Vt)>0;)ne--}0===ue(ut[ht],Vt)?Tt(ut,ht,ne):Tt(ut,++ne,J),ne<=H&&(ht=ne+1),H<=ne&&(J=ne-1)}}(pt,mt,ot||0,gt||pt.length-1,ct||Ct)}function Tt(pt,mt,ot){var gt=pt[mt];pt[mt]=pt[ot],pt[ot]=gt}function Ct(pt,mt){return pt<mt?-1:pt>mt?1:0}var Rt=function(pt){void 0===pt&&(pt=9),this._maxEntries=Math.max(4,pt),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function oe(pt,mt,ot){if(!ot)return mt.indexOf(pt);for(var gt=0;gt<mt.length;gt++)if(ot(pt,mt[gt]))return gt;return-1}function Pt(pt,mt){rt(pt,0,pt.children.length,mt,pt)}function rt(pt,mt,ot,gt,ct){ct||(ct=_e(null)),ct.minX=1/0,ct.minY=1/0,ct.maxX=-1/0,ct.maxY=-1/0;for(var kt=mt;kt<ot;kt++){var ut=pt.children[kt];zt(ct,pt.leaf?gt(ut):ut)}return ct}function zt(pt,mt){return pt.minX=Math.min(pt.minX,mt.minX),pt.minY=Math.min(pt.minY,mt.minY),pt.maxX=Math.max(pt.maxX,mt.maxX),pt.maxY=Math.max(pt.maxY,mt.maxY),pt}function ie(pt,mt){return pt.minX-mt.minX}function Yt(pt,mt){return pt.minY-mt.minY}function Me(pt){return(pt.maxX-pt.minX)*(pt.maxY-pt.minY)}function Be(pt){return pt.maxX-pt.minX+(pt.maxY-pt.minY)}function Ce(pt,mt){return pt.minX<=mt.minX&&pt.minY<=mt.minY&&mt.maxX<=pt.maxX&&mt.maxY<=pt.maxY}function ee(pt,mt){return mt.minX<=pt.maxX&&mt.minY<=pt.maxY&&mt.maxX>=pt.minX&&mt.maxY>=pt.minY}function _e(pt){return{children:pt,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function an(pt,mt,ot,gt,ct){for(var kt=[mt,ot];kt.length;)if(!((ot=kt.pop())-(mt=kt.pop())<=gt)){var ut=mt+Math.ceil((ot-mt)/gt/2)*gt;we(pt,ut,mt,ot,ct),kt.push(mt,ut,ut,ot)}}return Rt.prototype.all=function(){return this._all(this.data,[])},Rt.prototype.search=function(pt){var mt=this.data,ot=[];if(!ee(pt,mt))return ot;for(var gt=this.toBBox,ct=[];mt;){for(var kt=0;kt<mt.children.length;kt++){var ut=mt.children[kt],H=mt.leaf?gt(ut):ut;ee(pt,H)&&(mt.leaf?ot.push(ut):Ce(pt,H)?this._all(ut,ot):ct.push(ut))}mt=ct.pop()}return ot},Rt.prototype.collides=function(pt){var mt=this.data;if(!ee(pt,mt))return!1;for(var ot=[];mt;){for(var gt=0;gt<mt.children.length;gt++){var ct=mt.children[gt],kt=mt.leaf?this.toBBox(ct):ct;if(ee(pt,kt)){if(mt.leaf||Ce(pt,kt))return!0;ot.push(ct)}}mt=ot.pop()}return!1},Rt.prototype.load=function(pt){if(!pt||!pt.length)return this;if(pt.length<this._minEntries){for(var mt=0;mt<pt.length;mt++)this.insert(pt[mt]);return this}var ot=this._build(pt.slice(),0,pt.length-1,0);if(this.data.children.length)if(this.data.height===ot.height)this._splitRoot(this.data,ot);else{if(this.data.height<ot.height){var gt=this.data;this.data=ot,ot=gt}this._insert(ot,this.data.height-ot.height-1,!0)}else this.data=ot;return this},Rt.prototype.insert=function(pt){return pt&&this._insert(pt,this.data.height-1),this},Rt.prototype.clear=function(){return this.data=_e([]),this},Rt.prototype.remove=function(pt,mt){if(!pt)return this;for(var ot,gt,ct,kt=this.data,ut=this.toBBox(pt),H=[],ht=[];kt||H.length;){if(kt||(kt=H.pop(),gt=H[H.length-1],ot=ht.pop(),ct=!0),kt.leaf){var J=oe(pt,kt.children,mt);if(-1!==J)return kt.children.splice(J,1),H.push(kt),this._condense(H),this}ct||kt.leaf||!Ce(kt,ut)?gt?(ot++,kt=gt.children[ot],ct=!1):kt=null:(H.push(kt),ht.push(ot),ot=0,gt=kt,kt=kt.children[0])}return this},Rt.prototype.toBBox=function(pt){return pt},Rt.prototype.compareMinX=function(pt,mt){return pt.minX-mt.minX},Rt.prototype.compareMinY=function(pt,mt){return pt.minY-mt.minY},Rt.prototype.toJSON=function(){return this.data},Rt.prototype.fromJSON=function(pt){return this.data=pt,this},Rt.prototype._all=function(pt,mt){for(var ot=[];pt;)pt.leaf?mt.push.apply(mt,pt.children):ot.push.apply(ot,pt.children),pt=ot.pop();return mt},Rt.prototype._build=function(pt,mt,ot,gt){var ct,kt=ot-mt+1,ut=this._maxEntries;if(kt<=ut)return Pt(ct=_e(pt.slice(mt,ot+1)),this.toBBox),ct;gt||(gt=Math.ceil(Math.log(kt)/Math.log(ut)),ut=Math.ceil(kt/Math.pow(ut,gt-1))),(ct=_e([])).leaf=!1,ct.height=gt;var H=Math.ceil(kt/ut),ht=H*Math.ceil(Math.sqrt(ut));an(pt,mt,ot,ht,this.compareMinX);for(var J=mt;J<=ot;J+=ht){var ue=Math.min(J+ht-1,ot);an(pt,J,ue,H,this.compareMinY);for(var St=J;St<=ue;St+=H){var Ht=Math.min(St+H-1,ue);ct.children.push(this._build(pt,St,Ht,gt-1))}}return Pt(ct,this.toBBox),ct},Rt.prototype._chooseSubtree=function(pt,mt,ot,gt){for(;gt.push(mt),!mt.leaf&&gt.length-1!==ot;){for(var ct=1/0,kt=1/0,ut=void 0,H=0;H<mt.children.length;H++){var ht=mt.children[H],J=Me(ht),ue=(St=pt,Ht=ht,(Math.max(Ht.maxX,St.maxX)-Math.min(Ht.minX,St.minX))*(Math.max(Ht.maxY,St.maxY)-Math.min(Ht.minY,St.minY))-J);ue<kt?(kt=ue,ct=J<ct?J:ct,ut=ht):ue===kt&&J<ct&&(ct=J,ut=ht)}mt=ut||mt.children[0]}var St,Ht;return mt},Rt.prototype._insert=function(pt,mt,ot){var gt=ot?pt:this.toBBox(pt),ct=[],kt=this._chooseSubtree(gt,this.data,mt,ct);for(kt.children.push(pt),zt(kt,gt);mt>=0&&ct[mt].children.length>this._maxEntries;)this._split(ct,mt),mt--;this._adjustParentBBoxes(gt,ct,mt)},Rt.prototype._split=function(pt,mt){var ot=pt[mt],gt=ot.children.length,ct=this._minEntries;this._chooseSplitAxis(ot,ct,gt);var kt=this._chooseSplitIndex(ot,ct,gt),ut=_e(ot.children.splice(kt,ot.children.length-kt));ut.height=ot.height,ut.leaf=ot.leaf,Pt(ot,this.toBBox),Pt(ut,this.toBBox),mt?pt[mt-1].children.push(ut):this._splitRoot(ot,ut)},Rt.prototype._splitRoot=function(pt,mt){this.data=_e([pt,mt]),this.data.height=pt.height+1,this.data.leaf=!1,Pt(this.data,this.toBBox)},Rt.prototype._chooseSplitIndex=function(pt,mt,ot){for(var gt,ct,kt,ut,H,ht,J,ue=1/0,St=1/0,Ht=mt;Ht<=ot-mt;Ht++){var Et=rt(pt,0,Ht,this.toBBox),cn=rt(pt,Ht,ot,this.toBBox),en=(ct=Et,kt=cn,void 0,void 0,void 0,void 0,ut=Math.max(ct.minX,kt.minX),H=Math.max(ct.minY,kt.minY),ht=Math.min(ct.maxX,kt.maxX),J=Math.min(ct.maxY,kt.maxY),Math.max(0,ht-ut)*Math.max(0,J-H)),Ft=Me(Et)+Me(cn);en<ue?(ue=en,gt=Ht,St=Ft<St?Ft:St):en===ue&&Ft<St&&(St=Ft,gt=Ht)}return gt||ot-mt},Rt.prototype._chooseSplitAxis=function(pt,mt,ot){var gt=pt.leaf?this.compareMinX:ie,ct=pt.leaf?this.compareMinY:Yt;this._allDistMargin(pt,mt,ot,gt)<this._allDistMargin(pt,mt,ot,ct)&&pt.children.sort(gt)},Rt.prototype._allDistMargin=function(pt,mt,ot,gt){pt.children.sort(gt);for(var ct=this.toBBox,kt=rt(pt,0,mt,ct),ut=rt(pt,ot-mt,ot,ct),H=Be(kt)+Be(ut),ht=mt;ht<ot-mt;ht++){var J=pt.children[ht];zt(kt,pt.leaf?ct(J):J),H+=Be(kt)}for(var ue=ot-mt-1;ue>=mt;ue--){var St=pt.children[ue];zt(ut,pt.leaf?ct(St):St),H+=Be(ut)}return H},Rt.prototype._adjustParentBBoxes=function(pt,mt,ot){for(var gt=ot;gt>=0;gt--)zt(mt[gt],pt)},Rt.prototype._condense=function(pt){for(var mt=pt.length-1,ot=void 0;mt>=0;mt--)0===pt[mt].children.length?mt>0?(ot=pt[mt-1].children).splice(ot.indexOf(pt[mt]),1):this.clear():Pt(pt[mt],this.toBBox)},Rt}()},491:(nn,we,Tt)=>{"use strict";var Ct,Rt=Tt(2050),oe=Tt(4500),Pt=Tt(2992),rt=Tt(3944),zt=Tt(4203),ie=Tt(5223),Yt=Tt(6130),Me=Function,Be=function(At){try{return Me('"use strict"; return ('+At+").constructor;")()}catch{}},Ce=Object.getOwnPropertyDescriptor;if(Ce)try{Ce({},"")}catch{Ce=null}var ee=function(){throw new ie},_e=Ce?function(){try{return ee}catch{try{return Ce(arguments,"callee").get}catch{return ee}}}():ee,an=Tt(6152)(),pt=Tt(9028)(),mt=Object.getPrototypeOf||(pt?function(At){return At.__proto__}:null),ot={},gt=typeof Uint8Array>"u"||!mt?Ct:mt(Uint8Array),ct={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Ct:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Ct:ArrayBuffer,"%ArrayIteratorPrototype%":an&&mt?mt([][Symbol.iterator]()):Ct,"%AsyncFromSyncIteratorPrototype%":Ct,"%AsyncFunction%":ot,"%AsyncGenerator%":ot,"%AsyncGeneratorFunction%":ot,"%AsyncIteratorPrototype%":ot,"%Atomics%":typeof Atomics>"u"?Ct:Atomics,"%BigInt%":typeof BigInt>"u"?Ct:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Ct:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Ct:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Ct:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Rt,"%eval%":eval,"%EvalError%":oe,"%Float32Array%":typeof Float32Array>"u"?Ct:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Ct:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Ct:FinalizationRegistry,"%Function%":Me,"%GeneratorFunction%":ot,"%Int8Array%":typeof Int8Array>"u"?Ct:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Ct:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Ct:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":an&&mt?mt(mt([][Symbol.iterator]())):Ct,"%JSON%":"object"==typeof JSON?JSON:Ct,"%Map%":typeof Map>"u"?Ct:Map,"%MapIteratorPrototype%":typeof Map>"u"||!an||!mt?Ct:mt((new Map)[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Ct:Promise,"%Proxy%":typeof Proxy>"u"?Ct:Proxy,"%RangeError%":Pt,"%ReferenceError%":rt,"%Reflect%":typeof Reflect>"u"?Ct:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Ct:Set,"%SetIteratorPrototype%":typeof Set>"u"||!an||!mt?Ct:mt((new Set)[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Ct:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":an&&mt?mt(""[Symbol.iterator]()):Ct,"%Symbol%":an?Symbol:Ct,"%SyntaxError%":zt,"%ThrowTypeError%":_e,"%TypedArray%":gt,"%TypeError%":ie,"%Uint8Array%":typeof Uint8Array>"u"?Ct:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Ct:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Ct:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Ct:Uint32Array,"%URIError%":Yt,"%WeakMap%":typeof WeakMap>"u"?Ct:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Ct:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Ct:WeakSet};if(mt)try{null.error}catch(At){var kt=mt(mt(At));ct["%Error.prototype%"]=kt}var ut=function At(ne){var wt;if("%AsyncFunction%"===ne)wt=Be("async function () {}");else if("%GeneratorFunction%"===ne)wt=Be("function* () {}");else if("%AsyncGeneratorFunction%"===ne)wt=Be("async function* () {}");else if("%AsyncGenerator%"===ne){var Le=At("%AsyncGeneratorFunction%");Le&&(wt=Le.prototype)}else if("%AsyncIteratorPrototype%"===ne){var Pe=At("%AsyncGenerator%");Pe&&mt&&(wt=mt(Pe.prototype))}return ct[ne]=wt,wt},H={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},ht=Tt(5333),J=Tt(836),ue=ht.call(Function.call,Array.prototype.concat),St=ht.call(Function.apply,Array.prototype.splice),Ht=ht.call(Function.call,String.prototype.replace),Et=ht.call(Function.call,String.prototype.slice),cn=ht.call(Function.call,RegExp.prototype.exec),en=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Ft=/\\(\\)?/g,Vt=function(ne,wt){var Pe,Le=ne;if(J(H,Le)&&(Le="%"+(Pe=H[Le])[0]+"%"),J(ct,Le)){var pe=ct[Le];if(pe===ot&&(pe=ut(Le)),typeof pe>"u"&&!wt)throw new ie("intrinsic "+ne+" exists, but is not available. Please file an issue!");return{alias:Pe,name:Le,value:pe}}throw new zt("intrinsic "+ne+" does not exist!")};nn.exports=function(ne,wt){if("string"!=typeof ne||0===ne.length)throw new ie("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof wt)throw new ie('"allowMissing" argument must be a boolean');if(null===cn(/^%?[^%]*%?$/,ne))throw new zt("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var Le=function(ne){var wt=Et(ne,0,1),Le=Et(ne,-1);if("%"===wt&&"%"!==Le)throw new zt("invalid intrinsic syntax, expected closing `%`");if("%"===Le&&"%"!==wt)throw new zt("invalid intrinsic syntax, expected opening `%`");var Pe=[];return Ht(ne,en,function(pe,Fe,Ln,On){Pe[Pe.length]=Ln?Ht(On,Ft,"$1"):Fe||pe}),Pe}(ne),Pe=Le.length>0?Le[0]:"",pe=Vt("%"+Pe+"%",wt),Fe=pe.name,Ln=pe.value,On=!1,yn=pe.alias;yn&&(Pe=yn[0],St(Le,ue([0,1],yn)));for(var Yn=1,Gn=!0;Yn<Le.length;Yn+=1){var hn=Le[Yn],Er=Et(hn,0,1),di=Et(hn,-1);if(('"'===Er||"'"===Er||"`"===Er||'"'===di||"'"===di||"`"===di)&&Er!==di)throw new zt("property names with quotes must have matching quotes");if(("constructor"===hn||!Gn)&&(On=!0),J(ct,Fe="%"+(Pe+="."+hn)+"%"))Ln=ct[Fe];else if(null!=Ln){if(!(hn in Ln)){if(!wt)throw new ie("base intrinsic for "+ne+" exists, but the property is not available.");return}if(Ce&&Yn+1>=Le.length){var Te=Ce(Ln,hn);Ln=(Gn=!!Te)&&"get"in Te&&!("originalValue"in Te.get)?Te.get:Ln[hn]}else Gn=J(Ln,hn),Ln=Ln[hn];Gn&&!On&&(ct[Fe]=Ln)}}return Ln}},9262:(nn,we,Tt)=>{"use strict";var Rt=Tt(491)("%Object.getOwnPropertyDescriptor%",!0);if(Rt)try{Rt([],"length")}catch{Rt=null}nn.exports=Rt},2486:(nn,we,Tt)=>{"use strict";var Ct=Tt(474),Rt=function(){return!!Ct};Rt.hasArrayLengthDefineBug=function(){if(!Ct)return null;try{return 1!==Ct([],"length",{value:1}).length}catch{return!0}},nn.exports=Rt},9028:nn=>{"use strict";var we={__proto__:null,foo:{}},Tt=Object;nn.exports=function(){return{__proto__:we}.foo===we.foo&&!(we instanceof Tt)}},6152:(nn,we,Tt)=>{"use strict";var Ct=typeof Symbol<"u"&&Symbol,Rt=Tt(5441);nn.exports=function(){return"function"==typeof Ct&&"function"==typeof Symbol&&"symbol"==typeof Ct("foo")&&"symbol"==typeof Symbol("bar")&&Rt()}},5441:nn=>{"use strict";nn.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var Tt={},Ct=Symbol("test"),Rt=Object(Ct);if("string"==typeof Ct||"[object Symbol]"!==Object.prototype.toString.call(Ct)||"[object Symbol]"!==Object.prototype.toString.call(Rt))return!1;for(Ct in Tt[Ct]=42,Tt)return!1;if("function"==typeof Object.keys&&0!==Object.keys(Tt).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(Tt).length)return!1;var Pt=Object.getOwnPropertySymbols(Tt);if(1!==Pt.length||Pt[0]!==Ct||!Object.prototype.propertyIsEnumerable.call(Tt,Ct))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var rt=Object.getOwnPropertyDescriptor(Tt,Ct);if(42!==rt.value||!0!==rt.enumerable)return!1}return!0}},8041:(nn,we,Tt)=>{"use strict";var Ct=Tt(5441);nn.exports=function(){return Ct()&&!!Symbol.toStringTag}},836:(nn,we,Tt)=>{"use strict";var Ct=Function.prototype.call,Rt=Object.prototype.hasOwnProperty,oe=Tt(5333);nn.exports=oe.call(Ct,Rt)},8147:(nn,we,Tt)=>{"use strict";var Ct=Tt(8041)(),oe=Tt(1098)("Object.prototype.toString"),Pt=function(Yt){return!(Ct&&Yt&&"object"==typeof Yt&&Symbol.toStringTag in Yt)&&"[object Arguments]"===oe(Yt)},rt=function(Yt){return!!Pt(Yt)||null!==Yt&&"object"==typeof Yt&&"number"==typeof Yt.length&&Yt.length>=0&&"[object Array]"!==oe(Yt)&&"[object Function]"===oe(Yt.callee)},zt=function(){return Pt(arguments)}();Pt.isLegacyArguments=rt,nn.exports=zt?Pt:rt},2365:(nn,we,Tt)=>{"use strict";var Ct=Date.prototype.getDay,oe=Object.prototype.toString,rt=Tt(8041)();nn.exports=function(ie){return"object"==typeof ie&&null!==ie&&(rt?function(ie){try{return Ct.call(ie),!0}catch{return!1}}(ie):"[object Date]"===oe.call(ie))}},4720:(nn,we,Tt)=>{"use strict";var oe,Pt,rt,zt,Ct=Tt(1098),Rt=Tt(8041)();if(Rt){oe=Ct("Object.prototype.hasOwnProperty"),Pt=Ct("RegExp.prototype.exec"),rt={};var ie=function(){throw rt};zt={toString:ie,valueOf:ie},"symbol"==typeof Symbol.toPrimitive&&(zt[Symbol.toPrimitive]=ie)}var Yt=Ct("Object.prototype.toString"),Me=Object.getOwnPropertyDescriptor;nn.exports=Rt?function(ee){if(!ee||"object"!=typeof ee)return!1;var _e=Me(ee,"lastIndex");if(!_e||!oe(_e,"value"))return!1;try{Pt(ee,zt)}catch(pt){return pt===rt}}:function(ee){return!(!ee||"object"!=typeof ee&&"function"!=typeof ee)&&"[object RegExp]"===Yt(ee)}},2574:function(nn){nn.exports=function(){"use strict";var we,Tt,Ct;function Rt(Pt,rt){if(we)if(Tt){var zt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+we+")(sharedChunk); ("+Tt+")(sharedChunk); self.onerror = null;",ie={};we(ie),Ct=rt(ie),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Ct.workerUrl=window.URL.createObjectURL(new Blob([zt],{type:"text/javascript"})))}else Tt=rt;else we=rt}return Rt(0,function(Pt){var rt=typeof self<"u"?self:{},zt="3.1.2";let ie;const Yt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ie){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ie=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):e}catch{ie=e}}return ie},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Yt.API_URL)return null;try{const e=new URL(Yt.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},Me={supported:!1,testSupport:function(e){!ee&&Ce&&(_e?an(e):Be=e)}};let Be,Ce,ee=!1,_e=!1;function an(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Ce),e.isContextLost())return;Me.supported=!0}catch{}e.deleteTexture(t),ee=!0}rt.document&&(Ce=rt.document.createElement("img"),Ce.onload=function(){Be&&an(Be),Be=null,_e=!0},Ce.onerror=function(){ee=!0,Be=null},Ce.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const pt="01";function mt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ot=gt;function gt(e,t,r,s){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=s}gt.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,s=0;s<8;s++){var a=this.sampleCurveX(r)-e;if(Math.abs(a)<t)return r;var u=this.sampleCurveDerivativeX(r);if(Math.abs(u)<1e-6)break;r-=a/u}var c=0,p=1;for(r=e,s=0;s<20&&(a=this.sampleCurveX(r),!(Math.abs(a-e)<t));s++)e>a?c=r:p=r,r=.5*(p-c)+c;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var ct=mt(ot),kt=ut;function ut(e,t){this.x=e,this.y=t}ut.prototype={clone:function(){return new ut(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),s=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=s,this},_rotateAround:function(e,t){var r=Math.cos(e),s=Math.sin(e),a=t.y+s*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-s*(this.y-t.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ut.convert=function(e){return e instanceof ut?e:Array.isArray(e)?new ut(e[0],e[1]):e};var H=mt(kt);function ht(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!ht(e[r],t[r]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(!ht(e[r],t[r]))return!1;return!0}return e===t}const J=Math.PI/180,ue=180/Math.PI;function St(e){return e*J}function Ht(e){return e*ue}const Et=[[0,0],[1,0],[1,1],[0,1]];function cn(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,r=t*e;return 4*(e<.5?r:3*(e-t)+r-.75)}function en(e){let t=1/0,r=1/0,s=-1/0,a=-1/0;for(const u of e)t=Math.min(t,u.x),r=Math.min(r,u.y),s=Math.max(s,u.x),a=Math.max(a,u.y);return{min:new H(t,r),max:new H(s,a)}}function Ft(e,t,r=0,s=!0){const a=new H(r,r),u=e.sub(a),c=t.add(a),p=[u,new H(c.x,u.y),c,new H(u.x,c.y)];return s&&p.push(u.clone()),p}function de(e,t,r,s){const a=new ct(e,t,r,s);return function(u){return a.solve(u)}}const Vt=de(.25,.1,.25,1);function At(e,t,r){return Math.min(r,Math.max(t,e))}function ne(e,t,r){return(r=At((r-e)/(t-e),0,1))*r*(3-2*r)}function wt(e,t,r){const s=r-t,a=((e-t)%s+s)%s+t;return a===t?r:a}function Le(e,t,r){if(!e.length)return r(null,[]);let s=e.length;const a=new Array(e.length);let u=null;e.forEach((c,p)=>{t(c,(g,y)=>{g&&(u=g),a[p]=y,0==--s&&r(u,a)})})}function Pe(e){const t=[];for(const r in e)t.push(e[r]);return t}function pe(e,...t){for(const r of t)for(const s in r)e[s]=r[s];return e}function Fe(e,t){const r={};for(let s=0;s<t.length;s++){const a=t[s];a in e&&(r[a]=e[a])}return r}let Ln=1;function On(){return Ln++}function yn(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function Yn(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Gn(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function hn(e,t){e.forEach(r=>{t[r]&&(t[r]=t[r].bind(t))})}function Er(e,t){return-1!==e.indexOf(t,e.length-t.length)}function di(e,t,r){const s={};for(const a in e)s[a]=t.call(r||this,e[a],a,e);return s}function Te(e,t,r){const s={};for(const a in e)t.call(r||this,e[a],a,e)&&(s[a]=e[a]);return s}function st(e){return Array.isArray(e)?e.map(st):"object"==typeof e&&e?di(e,st):e}const vt={};function Gt(e){vt[e]||(typeof console<"u"&&console.warn(e),vt[e]=!0)}function Ve(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function sn(e){let t=0;for(let r,s,a=0,u=e.length,c=u-1;a<u;c=a++)r=e[a],s=e[c],t+=(s.x-r.x)*(r.y+s.y);return t}function We([e,t,r]){const s=St(t+90),a=St(r);return{x:e*Math.cos(s)*Math.sin(a),y:e*Math.sin(s)*Math.sin(a),z:e*Math.cos(a),azimuthal:t,polar:r}}function gn(e,t,r){const s=Math.sqrt(e*e+t*t+r*r),a=s>0?Math.acos(r/s)*ue:0;let u=0!==e||0!==t?Math.atan2(-t,-e)*ue+90:0;return u<0&&(u+=360),[s,u,a]}function rn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Rn(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,a,u)=>{const c=a||u;return t[s]=!c||c.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}let jn=null;function Sn(){return!!rt.document.fullscreenElement||!!rt.document.webkitFullscreenElement}function mn(e){try{const t=rt[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ni(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function Zi(e,t,r){e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]}function Nn(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]}function Hr(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]}const fe="mapbox-tiles";let Dt,Jt,W=500,nt=50;function Xt(){try{return rt.caches}catch{}}function Ue(){Xt()&&!Dt&&(Dt=rt.caches.open(fe))}function ke(e){const t=e.indexOf("?");if(t<0)return e;const s=function(a){const u=a.indexOf("?");return u>0?a.slice(u+1).split("&"):[]}(e).filter(a=>{const u=a.split("=");return"language"===u[0]||"worldview"===u[0]});return s.length?`${e.slice(0,t)}?${s.join("&")}`:e.slice(0,t)}let Ye=1/0;function Je(e){Ye++,Ye>nt&&(e.getActor().send("enforceCacheSizeLimit",W),Ye=0)}const Kt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Kt);class lt extends Error{constructor(t,r,s){401===r&&mr(s)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=r,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const se=rn()?()=>self.worker&&self.worker.referrer:()=>("blob:"===rt.location.protocol?rt.parent:rt).location.href,ve=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(se())&&!/^\w+:/.test(r))){if(rt.fetch&&rt.Request&&rt.AbortController&&rt.Request.prototype.hasOwnProperty("signal"))return function(s,a){const u=new rt.AbortController,c=new rt.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:se(),referrerPolicy:s.referrerPolicy,signal:u.signal});let p=!1,g=!1;const y=(x=c.url).indexOf("sku=")>0&&mr(x);var x;"json"===s.type&&c.headers.set("Accept","application/json");const E=(M,D,P)=>{if(g)return;if(M&&"SecurityError"!==M.message&&Gt(M.toString()),D&&P)return S(D);const O=Date.now();rt.fetch(c).then(R=>{if(R.ok){const B=y?R.clone():null;return S(R,B,O)}return a(new lt(R.statusText,R.status,s.url))}).catch(R=>{"AbortError"!==R.name&&a(new Error(`${R.message} ${s.url}`))})},S=(M,D,P)=>{("arrayBuffer"===s.type?M.arrayBuffer():"json"===s.type?M.json():M.text()).then(O=>{g||(D&&P&&function(R,B,j){if(Ue(),!Dt)return;const V={status:B.status,statusText:B.statusText,headers:new rt.Headers};B.headers.forEach((Z,Q)=>V.headers.set(Q,Z));const U=Rn(B.headers.get("Cache-Control")||"");if(U["no-store"])return;U["max-age"]&&V.headers.set("Expires",new Date(j+1e3*U["max-age"]).toUTCString());const G=V.headers.get("Expires");G&&(new Date(G).getTime()-j<42e4||function(Z,Q){if(void 0===Jt)try{new Response(new ReadableStream),Jt=!0}catch{Jt=!1}Jt?Q(Z.body):Z.blob().then(Q)}(B,Z=>{const Q=new rt.Response(Z,V);Ue(),Dt&&Dt.then(et=>et.put(ke(R.url),Q)).catch(et=>Gt(et.message))}))}(c,D,P),p=!0,a(null,O,M.headers.get("Cache-Control"),M.headers.get("Expires")))}).catch(O=>{g||a(new Error(O.message))})};return y?function(M,D){if(Ue(),!Dt)return D(null);const P=ke(M.url);Dt.then(O=>{O.match(P).then(R=>{const B=function(j){if(!j)return!1;const V=new Date(j.headers.get("Expires")||0),U=Rn(j.headers.get("Cache-Control")||"");return V>Date.now()&&!U["no-cache"]}(R);O.delete(P),B&&O.put(P,R.clone()),D(null,R,B)}).catch(D)}).catch(D)}(c,E):E(null,null),{cancel:()=>{g=!0,p||u.abort()}}}(e,t);if(rn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(s,a){const u=new rt.XMLHttpRequest;u.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(u.responseType="arraybuffer");for(const c in s.headers)u.setRequestHeader(c,s.headers[c]);return"json"===s.type&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials="include"===s.credentials,u.onerror=()=>{a(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||0===u.status)&&null!==u.response){let c=u.response;if("json"===s.type)try{c=JSON.parse(u.response)}catch(p){return a(p)}a(null,c,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else a(new lt(u.statusText,u.status,s.url))},u.send(s.body),{cancel:()=>u.abort()}}(e,t)},ye=function(e,t){return ve(pe(e,{type:"json"}),t)},je=function(e,t){return ve(pe(e,{type:"arrayBuffer"}),t)};function tn(e){const t=rt.document.createElement("a");return t.href=e,t.protocol===rt.document.location.protocol&&t.host===rt.document.location.host}const Ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let dn,fn;dn=[],fn=0;const Tn=function(e,t){if(Me.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),fn>=Yt.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return dn.push(u),u}fn++;let r=!1;const s=()=>{if(!r)for(r=!0,fn--;dn.length&&fn<Yt.MAX_PARALLEL_IMAGE_REQUESTS;){const u=dn.shift(),{requestParameters:c,callback:p,cancelled:g}=u;g||(u.cancel=Tn(c,p).cancel)}},a=je(e,(u,c,p,g)=>{s(),u?t(u):c&&(rt.createImageBitmap?function(y,x){const E=new rt.Blob([new Uint8Array(y)],{type:"image/png"});rt.createImageBitmap(E).then(S=>{x(null,S)}).catch(S=>{x(new Error(`Could not load image because of ${S.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(c,(y,x)=>t(y,x,p,g)):function(y,x){const E=new rt.Image,S=rt.URL;E.onload=()=>{x(null,E),S.revokeObjectURL(E.src),E.onload=null,rt.requestAnimationFrame(()=>{E.src=Ge})},E.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new rt.Blob([new Uint8Array(y)],{type:"image/png"});E.src=y.byteLength?S.createObjectURL(M):Ge}(c,(y,x)=>t(y,x,p,g)))});return{cancel:()=>{a.cancel(),s()}}},Ir="NO_ACCESS_TOKEN";class En{constructor(t,r,s){this._transformRequestFn=t,this._customAccessToken=r,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const t=function(){let r="";for(let s=0;s<10;s++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",pt,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeStyleURL(t,r){if(!gr(t))return t;const s=ui(t);return s.params.push(`sdk=js-${zt}`),s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||r)}normalizeGlyphsURL(t,r){if(!gr(t))return t;const s=ui(t);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||r)}normalizeModelURL(t,r){if(!gr(t))return t;const s=ui(t);return s.path=`/models/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||r)}normalizeSourceURL(t,r,s,a){if(!gr(t))return t;const u=ui(t);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),s&&u.params.push(`language=${s}`),a&&u.params.push(`worldview=${a}`),this._makeAPIURL(u,this._customAccessToken||r)}normalizeSpriteURL(t,r,s,a){const u=ui(t);return gr(t)?(u.path=`/styles/v1${u.path}/sprite${r}${s}`,this._makeAPIURL(u,this._customAccessToken||a)):(u.path+=`${r}${s}`,Rr(u))}normalizeTileURL(t,r,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!gr(t))return t;const a=ui(t);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||s&&"raster"!==a.authority&&512===s?"@2x":""}${Me.supported?".webp":"$1"}`),"raster"===a.authority?a.path=`/${Yt.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${Yt.TILE_URL_VERSION}${a.path}`);const u=this._customAccessToken||function(c){for(const p of c){const g=p.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(a.params)||Yt.ACCESS_TOKEN;return Yt.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,u)}canonicalizeTileURL(t,r){const s=ui(t);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return t;let a="mapbox://";s.path.match(/^\/raster\/v1\//)?a+=`raster/${s.path.replace(`/${Yt.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${s.path.replace(`/${Yt.TILE_URL_VERSION}/`,"")}`;let u=s.params;return r&&(u=u.filter(c=>!c.match(/^access_token=/))),u.length&&(a+=`?${u.join("&")}`),a}canonicalizeTileset(t,r){const s=!!r&&gr(r),a=[];for(const u of t.tiles||[])mr(u)?a.push(this.canonicalizeTileURL(u,s)):a.push(u);return a}_makeAPIURL(t,r){const s="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=ui(Yt.API_URL);if(t.protocol=a.protocol,t.authority=a.authority,"http"===t.protocol){const u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if("/"!==a.path&&(t.path=`${a.path}${t.path}`),!Yt.REQUIRE_ACCESS_TOKEN)return Rr(t);if(r=r||Yt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return t.params=t.params.filter(u=>-1===u.indexOf("access_token")),t.params.push(`access_token=${r||""}`),Rr(t)}}function gr(e){return 0===e.indexOf("mapbox:")}function mr(e){return Yt.API_URL_REGEX.test(e)}function ei(e){return Yt.API_CDN_URL_REGEX.test(e)}function Kn(e){return Yt.API_STYLE_REGEX.test(e)&&!li(e)}function li(e){return Yt.API_SPRITE_REGEX.test(e)}const Vi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ui(e){const t=e.match(Vi);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Rr(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}const ls="mapbox.eventData";function Xo(e){if(!e)return null;const t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(rt.atob(t[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class dl{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const r=Xo(Yt.ACCESS_TOKEN);let s="";return s=r&&r.u?rt.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(a,u)=>String.fromCharCode(+("0x"+u)))):Yt.ACCESS_TOKEN||"",t?`${ls}.${t}:${s}`:`${ls}:${s}`}fetchEventData(){const t=mn("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{const a=rt.localStorage.getItem(r);a&&(this.eventData=JSON.parse(a));const u=rt.localStorage.getItem(s);u&&(this.anonId=u)}catch{Gt("Unable to read from LocalStorage")}}saveEventData(){const t=mn("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{rt.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&rt.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{Gt("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,r,s,a){if(!Yt.EVENTS_URL)return;const u=ui(Yt.EVENTS_URL);u.params.push(`access_token=${a||Yt.ACCESS_TOKEN||""}`);const c={event:this.type,created:new Date(t).toISOString()},p=r?pe(c,r):c,g={url:Rr(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([p])};var x;this.pendingRequest=(x=y=>{this.pendingRequest=null,s(y),this.saveEventData(),this.processRequests(a)},ve(pe(g,{method:"POST"}),x))}queueRequest(t,r){this.queue.push(t),this.processRequests(r)}}const js=new class extends dl{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){Yt.EVENTS_URL&&Yt.ACCESS_TOKEN&&Array.isArray(e)&&e.some(r=>gr(r)||mr(r))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Xo(Yt.ACCESS_TOKEN),r=t?t.u:Yt.ACCESS_TOKEN;let s=r!==this.eventData.tokenU;Gn(this.anonId)||(this.anonId=yn(),s=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const u=new Date(this.eventData.lastSuccess),c=new Date(a),p=(a-this.eventData.lastSuccess)/864e5;s=s||p>=1||p<-1||u.getDate()!==c.getDate()}else s=!0;s?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:zt,skuId:pt,"enabled.telemetry":!1,userId:this.anonId},u=>{u||(this.eventData.lastSuccess=a,this.eventData.tokenU=r)},e):this.processRequests()}},wh=js.postTurnstileEvent.bind(js),Vo=new class extends dl{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,r,s){this.skuToken=t,this.errorCb=s,Yt.EVENTS_URL&&(r||Yt.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(Ir)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),Gn(this.anonId)||(this.anonId=yn()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:zt,skuId:pt,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):t&&(this.success[t]=!0)},e))}},ps=Vo.postMapLoadEvent.bind(Vo),Iu=new class extends dl{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){Yt.EVENTS_URL&&(e||Yt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,performanceData:r}=this.queue.shift(),s=function(a){const u=rt.performance.getEntriesByType("resource"),c=rt.performance.getEntriesByType("mark"),p=function(S){const M={};if(S)for(const D in S)if("other"!==D)for(const P of S[D]){const O=`${D}ResolveRangeMin`,R=`${D}ResolveRangeMax`,B=`${D}RequestCount`,j=`${D}RequestCachedCount`;M[O]=Math.min(M[O]||1/0,P.startTime),M[R]=Math.max(M[R]||-1/0,P.responseEnd);const V=U=>{void 0===M[U]&&(M[U]=0),++M[U]};void 0!==P.transferSize&&0===P.transferSize&&V(j),V(B)}return M}(function(S,M){const D={};if(S)for(const P of S){const O=M(P);void 0===D[O]&&(D[O]=[]),D[O].push(P)}return D}(u,gc)),g=rt.devicePixelRatio,y=rt.navigator.connection||rt.navigator.mozConnection||rt.navigator.webkitConnection,x={counters:[],metadata:[],attributes:[]},E=(S,M,D)=>{null!=D&&S.push({name:M,value:D.toString()})};for(const S in p)E(x.counters,S,p[S]);if(a.interactionRange[0]!==1/0&&a.interactionRange[1]!==-1/0&&(E(x.counters,"interactionRangeMin",a.interactionRange[0]),E(x.counters,"interactionRangeMax",a.interactionRange[1])),c)for(const S of Object.keys(Os)){const M=Os[S],D=c.find(P=>P.name===M);D&&E(x.counters,M,D.startTime)}return E(x.counters,"visibilityHidden",a.visibilityHidden),E(x.attributes,"style",function(S){if(S)for(const M of S){const D=M.name.split("?")[0];if(Kn(D)){const P=D.split("/").slice(-2);if(2===P.length)return`mapbox://styles/${P[0]}/${P[1]}`}}}(u)),E(x.attributes,"terrainEnabled",a.terrainEnabled?"true":"false"),E(x.attributes,"fogEnabled",a.fogEnabled?"true":"false"),E(x.attributes,"projection",a.projection),E(x.attributes,"zoom",a.zoom),E(x.metadata,"devicePixelRatio",g),E(x.metadata,"connectionEffectiveType",y?y.effectiveType:void 0),E(x.metadata,"navigatorUserAgent",rt.navigator.userAgent),E(x.metadata,"screenWidth",rt.screen.width),E(x.metadata,"screenHeight",rt.screen.height),E(x.metadata,"windowWidth",rt.innerWidth),E(x.metadata,"windowHeight",rt.innerHeight),E(x.metadata,"mapWidth",a.width/g),E(x.metadata,"mapHeight",a.height/g),E(x.metadata,"webglRenderer",a.renderer),E(x.metadata,"webglVendor",a.vendor),E(x.metadata,"sdkVersion",zt),E(x.metadata,"sdkIdentifier","mapbox-gl-js"),x}(r);for(const a of s.metadata);for(const a of s.counters);for(const a of s.attributes);this.postEvent(t,s,()=>{},e)}},ga=Iu.postPerformanceEvent.bind(Iu),Ja=new class extends dl{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,r,s){if(!Yt.API_URL||!Yt.SESSION_PATH)return;const a=ui(Yt.API_URL+Yt.SESSION_PATH);a.params.push(`sku=${t||""}`),a.params.push(`access_token=${s||Yt.ACCESS_TOKEN||""}`);const u={url:Rr(a),headers:{"Content-Type":"text/plain"}};var p;this.pendingRequest=(p=c=>{this.pendingRequest=null,r(c),this.saveEventData(),this.processRequests(s)},ve(pe(u,{method:"GET"}),p))}getSessionAPI(e,t,r,s){this.skuToken=t,this.errorCb=s,Yt.SESSION_PATH&&Yt.API_URL&&(r||Yt.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(Ir)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,s=>{s?this.errorCb(s):t&&(this.success[t]=!0)},e)}},wi=Ja.getSessionAPI.bind(Ja),jl=new Set;function pl(e,t){t?jl.add(e):jl.delete(e)}const Os={create:"create",load:"load",fullLoad:"fullLoad"},ms={mark(e){rt.performance.mark(e)},measure(e,t,r){rt.performance.measure(e,t,r)}};function gc(e){const t=e.name.split("?")[0];return ei(t)&&t.includes("mapbox-gl.js")?"javascript":ei(t)&&t.includes("mapbox-gl.css")?"css":Yt.API_FONTS_REGEX.test(t)?"fontRange":li(t)?"sprite":Kn(t)?"style":Yt.API_TILEJSON_REGEX.test(t)?"tilejson":"other"}const Vl=rt.performance;function Ml(e){const t=e?e.url.toString():void 0;return Vl.getEntriesByName(t)}var _c=Yo;function Yo(e){return t=e,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var s,a,u=new Blob([""],{type:"text/javascript"}),c=URL.createObjectURL(u);try{a=new Worker(c),s=!0}catch{s=!1}return a&&a.terminate(),URL.revokeObjectURL(c),s}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var s=document.createElement("canvas");s.width=s.height=1;var a=s.getContext("2d");if(!a)return!1;var u=a.getImageData(0,0,1,1);return u&&u.width===s.width}()||(void 0===ef[r=t&&t.failIfMajorPerformanceCaveat]&&(ef[r]=function(s){var a,c,p,g,u=(c=s,p=document.createElement("canvas"),(g=Object.create(Yo.webGLContextAttributes)).failIfMajorPerformanceCaveat=c,p.getContext("webgl",g)||p.getContext("experimental-webgl",g));if(!u)return!1;try{a=u.createShader(u.VERTEX_SHADER)}catch{return!1}return!(!a||u.isContextLost())&&(u.shaderSource(a,"void main() {}"),u.compileShader(a),!0===u.getShaderParameter(a,u.COMPILE_STATUS))}(r)),!ef[r]||document.documentMode));var t,r}var ef={};let ml,Qu,Hc,bi,ru;function Ka(){return null==ml&&(ml=rt.OffscreenCanvas&&new rt.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof rt.createImageBitmap),ml}Yo.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const or={now:()=>void 0!==bi?bi:rt.performance.now(),setNow(e){bi=e},restoreNow(){bi=void 0},frame(e){const t=rt.requestAnimationFrame(e);return{cancel:()=>rt.cancelAnimationFrame(t)}},getImageData(e,t=0){const{width:r,height:s}=e;ru||(ru=rt.document.createElement("canvas"));const a=ru.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(r>ru.width||s>ru.height)&&(ru.width=r,ru.height=s),a.clearRect(-t,-t,r+2*t,s+2*t),a.drawImage(e,0,0,r,s),a.getImageData(-t,-t,r+2*t,s+2*t)},resolveURL:e=>(Qu||(Qu=rt.document.createElement("a")),Qu.href=e,Qu.href),get devicePixelRatio(){return rt.devicePixelRatio},get prefersReducedMotion(){return!!rt.matchMedia&&(null==Hc&&(Hc=rt.matchMedia("(prefers-reduced-motion: reduce)")),Hc.matches)},hasCanvasFingerprintNoise(){if(!Ka())return!1;const e=new rt.OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0});let r=0;for(let a=0;a<e.width;++a)t.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,t.fillRect(a,0,1,1);const s=t.getImageData(0,0,e.width,e.height);r=0;for(let a=0;a<s.data.length;++a)if(a%4!=3&&r++!==s.data[a])return!0;return!1}};function Hn(e,t,r){const s=rt.document.createElement(e);return void 0!==t&&(s.className=t),r&&r.appendChild(s),s}function gl(e,t,r){const s=rt.document.createElementNS("http://www.w3.org/2000/svg",e);for(const a of Object.keys(t))s.setAttributeNS(null,a,t[a]);return r&&r.appendChild(s),s}const N=rt.document&&rt.document.documentElement.style,$=N&&void 0!==N.userSelect?"userSelect":"WebkitUserSelect";let at;function qt(){N&&$&&(at=N[$],N[$]="none")}function he(){N&&$&&(N[$]=at)}function me(e){e.preventDefault(),e.stopPropagation(),rt.removeEventListener("click",me,!0)}function jt(){rt.addEventListener("click",me,!0),rt.setTimeout(()=>{rt.removeEventListener("click",me,!0)},0)}function qe(e,t){const r=e.getBoundingClientRect();return Vn(e,r,t)}function _n(e,t){const r=e.getBoundingClientRect(),s=[];for(let a=0;a<t.length;a++)s.push(Vn(e,r,t[a]));return s}function Dn(e){return void 0!==rt.InstallTrigger&&2===e.button&&e.ctrlKey&&rt.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function Vn(e,t,r){const s=e.offsetWidth===t.width?1:e.offsetWidth/t.width;return new H((r.clientX-t.left)*s,(r.clientY-t.top)*s)}function bn(e,t,r){r[e]&&-1!==r[e].indexOf(t)||(r[e]=r[e]||[],r[e].push(t))}function Ke(e,t,r){if(r&&r[e]){const s=r[e].indexOf(t);-1!==s&&r[e].splice(s,1)}}class Se{constructor(t,r={}){pe(this,r),this.type=t}}class Oe extends Se{constructor(t,r={}){super("error",pe({error:t},r))}}class Qn{on(t,r){return this._listeners=this._listeners||{},bn(t,r,this._listeners),this}off(t,r){return Ke(t,r,this._listeners),Ke(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},bn(t,r,this._oneTimeListeners),this):new Promise(s=>this.once(t,s))}fire(t,r){"string"==typeof t&&(t=new Se(t,r||{}));const s=t.type;if(this.listens(s)){t.target=this;const a=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const p of a)p.call(this,t);const u=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const p of u)Ke(s,p,this._oneTimeListeners),p.call(this,t);const c=this._eventedParent;c&&(pe(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),c.fire(t))}else t instanceof Oe&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var It=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Ne{constructor(t,r,s,a){this.message=(t?`${t}: `:"")+s,a&&(this.identifier=a),null!=r&&r.__line__&&(this.line=r.__line__)}}class Pi extends Ne{}function Mi(e,...t){for(const r of t)for(const s in r)e[s]=r[s];return e}function zn(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Qa(e){if(Array.isArray(e))return e.map(Qa);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const r in e)t[r]=Qa(e[r]);return t}return zn(e)}class ia extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}var Gi=ia;class za{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[s,a]of r)this.bindings[s]=a}concat(t){return new za(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var us=za;const Jo={kind:"null"},In={kind:"number"},Cr={kind:"string"},Nr={kind:"boolean"},Vs={kind:"color"},_l={kind:"object"},sr={kind:"value"},Ma={kind:"collator"},ur={kind:"formatted"},ns={kind:"resolvedImage"};function Wi(e,t){return{kind:"array",itemType:e,N:t}}function rs(e){if("array"===e.kind){const t=rs(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Ko=[Jo,In,Cr,Nr,Vs,ur,_l,Wi(sr),ns];function Cu(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Cu(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const r of Ko)if(!Cu(r,t))return null}return`Expected ${rs(e)} but found ${rs(t)} instead.`}function iu(e,t){return t.some(r=>r.kind===e.kind)}function Tl(e,t){return t.some(r=>"null"===r?null===e:"array"===r?Array.isArray(e):"object"===r?e&&!Array.isArray(e)&&"object"==typeof e:r===typeof e)}var Ys,Dl={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function No(e){return(e=Math.round(e))<0?0:e>255?255:e}function yl(e){return No("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function _a(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function Su(e,t,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}try{Ys={}.parseCSSColor=function(e){var t,r=e.replace(/ /g,"").toLowerCase();if(r in Dl)return Dl[r].slice();if("#"===r[0])return 4===r.length?(t=parseInt(r.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===r.length&&(t=parseInt(r.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var s=r.indexOf("("),a=r.indexOf(")");if(-1!==s&&a+1===r.length){var u=r.substr(0,s),c=r.substr(s+1,a-(s+1)).split(","),p=1;switch(u){case"rgba":if(4!==c.length)return null;p=_a(c.pop());case"rgb":return 3!==c.length?null:[yl(c[0]),yl(c[1]),yl(c[2]),p];case"hsla":if(4!==c.length)return null;p=_a(c.pop());case"hsl":if(3!==c.length)return null;var g=(parseFloat(c[0])%360+360)%360/360,y=_a(c[1]),x=_a(c[2]),E=x<=.5?x*(y+1):x+y-x*y,S=2*x-E;return[No(255*Su(S,E,g+1/3)),No(255*Su(S,E,g)),No(255*Su(S,E,g-1/3)),p];default:return null}}return null}}catch{}class Ei{constructor(t,r,s,a=1){this.r=t,this.g=r,this.b=s,this.a=a}static parse(t){if(!t)return;if(t instanceof Ei)return t;if("string"!=typeof t)return;const r=Ys(t);return r?new Ei(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[t,r,s,a]=this.toArray();return`rgba(${Math.round(t)},${Math.round(r)},${Math.round(s)},${a})`}toArray(){const{r:t,g:r,b:s,a}=this;return 0===a?[0,0,0,0]:[255*t/a,255*r/a,255*s/a,a]}toArray01(){const{r:t,g:r,b:s,a}=this;return 0===a?[0,0,0,0]:[t/a,r/a,s/a,a]}toArray01Scaled(t){const{r,g:s,b:a,a:u}=this;return 0===u?[0,0,0]:[r/u*t,s/u*t,a/u*t]}toArray01PremultipliedAlpha(){const{r:t,g:r,b:s,a}=this;return[t,r,s,a]}toArray01Linear(){const{r:t,g:r,b:s,a}=this;return 0===a?[0,0,0,0]:[Math.pow(t/a,2.2),Math.pow(r/a,2.2),Math.pow(s/a,2.2),a]}}Ei.black=new Ei(0,0,0,1),Ei.white=new Ei(1,1,1,1),Ei.transparent=new Ei(0,0,0,0),Ei.red=new Ei(1,0,0,1),Ei.blue=new Ei(0,0,1,1);var pn=Ei;class Ti{constructor(t,r,s){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ou{constructor(t,r,s,a,u){this.text=t.normalize?t.normalize():t,this.image=r,this.scale=s,this.fontStack=a,this.textColor=u}}class Fo{constructor(t){this.sections=t}static fromString(t){return new Fo([new ou(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.namePrimary.length)}static factory(t){return t instanceof Fo?t:Fo.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const r of this.sections){if(r.image){t.push(["image",r.image.namePrimary]);continue}t.push(r.text);const s={};r.fontStack&&(s["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(s["font-scale"]=r.scale),r.textColor&&(s["text-color"]=["rgba"].concat(r.textColor.toArray())),t.push(s)}return t}}class gi{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,r){return t?new gi({namePrimary:t,nameSecondary:r,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Gl(e,t,r,s){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[e,t,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[e,t,r,s]:[e,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Mu(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof pn||e instanceof Ti||e instanceof Fo||e instanceof gi)return!0;if(Array.isArray(e)){for(const t of e)if(!Mu(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Mu(e[t]))return!1;return!0}return!1}function Zr(e){if(null===e)return Jo;if("string"==typeof e)return Cr;if("boolean"==typeof e)return Nr;if("number"==typeof e)return In;if(e instanceof pn)return Vs;if(e instanceof Ti)return Ma;if(e instanceof Fo)return ur;if(e instanceof gi)return ns;if(Array.isArray(e)){const t=e.length;let r;for(const s of e){const a=Zr(s);if(r){if(r===a)continue;r=sr;break}r=a}return Wi(r||sr,t)}return _l}function yc(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof pn||e instanceof Fo||e instanceof gi?e.toString():JSON.stringify(e)}class _i{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(2!==t.length)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Mu(t[1]))return r.error("invalid value");const s=t[1];let a=Zr(s);const u=r.expectedType;return"array"!==a.kind||0!==a.N||!u||"array"!==u.kind||"number"==typeof u.N&&0!==u.N||(a=u),new _i(a,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof pn?["rgba"].concat(this.value.toArray()):this.value instanceof Fo?this.value.serialize():this.value}}var dr=_i,qr=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const ql={string:Cr,number:In,boolean:Nr,object:_l};class Rs{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let s,a=1;const u=t[0];if("array"===u){let p,g;if(t.length>2){const y=t[1];if("string"!=typeof y||!(y in ql)||"object"===y)return r.error('The item type argument of "array" must be one of string, number, boolean',1);p=ql[y],a++}else p=sr;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);g=t[2],a++}s=Wi(p,g)}else s=ql[u];const c=[];for(;a<t.length;a++){const p=r.parse(t[a],a,sr);if(!p)return null;c.push(p)}return new Rs(s,c)}evaluate(t){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(t);if(!Cu(this.type,Zr(s)))return s;if(r===this.args.length-1)throw new qr(`Expected value to be of type ${rs(this.type)}, but found ${rs(Zr(s))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,r=[t.kind];if("array"===t.kind){const s=t.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){r.push(s.kind);const a=t.N;("number"==typeof a||this.args.length>1)&&r.push(a)}}return r.concat(this.args.map(s=>s.serialize()))}}var Al=Rs;class ii{constructor(t){this.type=ur,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[1];if(!Array.isArray(s)&&"object"==typeof s)return r.error("First argument must be an image or text section.");const a=[];let u=!1;for(let c=1;c<=t.length-1;++c){const p=t[c];if(u&&"object"==typeof p&&!Array.isArray(p)){u=!1;let g=null;if(p["font-scale"]&&(g=r.parse(p["font-scale"],1,In),!g))return null;let y=null;if(p["text-font"]&&(y=r.parse(p["text-font"],1,Wi(Cr)),!y))return null;let x=null;if(p["text-color"]&&(x=r.parse(p["text-color"],1,Vs),!x))return null;const E=a[a.length-1];E.scale=g,E.font=y,E.textColor=x}else{const g=r.parse(t[c],1,sr);if(!g)return null;const y=g.type.kind;if("string"!==y&&"value"!==y&&"null"!==y&&"resolvedImage"!==y)return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,a.push({content:g,scale:null,font:null,textColor:null})}}return new ii(a)}evaluate(t){return new Fo(this.sections.map(r=>{const s=r.content.evaluate(t);return Zr(s)===ns?new ou("",s,null,null,null):new ou(yc(s),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const r of this.sections){t.push(r.content.serialize());const s={};r.scale&&(s["font-scale"]=r.scale.serialize()),r.font&&(s["text-font"]=r.font.serialize()),r.textColor&&(s["text-color"]=r.textColor.serialize()),t.push(s)}return t}}class vl{constructor(t,r){this.type=ns,this.inputPrimary=t,this.inputSecondary=r}static parse(t,r){if(t.length<2)return r.error("Expected two or more arguments.");const s=r.parse(t[1],1,Cr);if(!s)return r.error("No image name provided.");if(2===t.length)return new vl(s);const a=r.parse(t[2],1,Cr);return a?new vl(s,a):r.error("Secondary image variant is not a string.")}evaluate(t){const r=gi.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return r&&t.availableImages&&(r.available=t.availableImages.indexOf(r.namePrimary)>-1,r.nameSecondary&&r.available&&t.availableImages&&(r.available=t.availableImages.indexOf(r.nameSecondary)>-1)),r}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function ar(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const nf={"to-boolean":Nr,"to-color":Vs,"to-number":In,"to-string":Cr};class oa{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[0],a=[];let u=Jo;if("to-array"===s){if(!Array.isArray(t[1]))return null;const c=t[1].length;if(r.expectedType){if("array"!==r.expectedType.kind)return r.error(`Expected ${r.expectedType.kind} but found array.`);u=Wi(r.expectedType.itemType,c)}else{if(!(c>0&&Mu(t[1][0])))return null;u=Wi(Zr(t[1][0]),c)}for(let p=0;p<c;p++){const g=t[1][p];let y;if("array"===ar(g))y=r.parse(g,void 0,u.itemType);else{const x=ar(g);if(x!==u.itemType.kind)return r.error(`Expected ${u.itemType.kind} but found ${x}.`);y=r.registry.literal.parse(["literal",void 0===g?null:g],r)}if(!y)return null;a.push(y)}}else{if(("to-boolean"===s||"to-string"===s)&&2!==t.length)return r.error("Expected one argument.");u=nf[s];for(let c=1;c<t.length;c++){const p=r.parse(t[c],c,sr);if(!p)return null;a.push(p)}}return new oa(u,a)}evaluate(t){if("boolean"===this.type.kind)return!!this.args[0].evaluate(t);if("color"===this.type.kind){let r,s;for(const a of this.args){if(r=a.evaluate(t),s=null,r instanceof pn)return r;if("string"==typeof r){const u=t.parseColor(r);if(u)return u}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Gl(r[0],r[1],r[2],r[3]),!s))return new pn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new qr(s||`Could not parse color from value '${"string"==typeof r?r:String(JSON.stringify(r))}'`)}if("number"===this.type.kind){let r=null;for(const s of this.args){if(r=s.evaluate(t),null===r)return 0;const a=Number(r);if(!isNaN(a))return a}throw new qr(`Could not convert ${JSON.stringify(r)} to number.`)}return"formatted"===this.type.kind?Fo.fromString(yc(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?gi.fromString(yc(this.args[0].evaluate(t))):"array"===this.type.kind?this.args.map(r=>r.evaluate(t)):yc(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new ii([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new vl(this.args[0]).serialize();const t="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{t.push(r.serialize())}),t}}var tl=oa;const vc=["Unknown","Point","LineString","Polygon"];var Gs=class{constructor(e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=e}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?vc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:r,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*t-e[0])+this.featureDistanceData.bearing[1]*(s*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=pn.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}};class Ur{constructor(t,r,s,a,u){this.name=t,this.type=r,this._evaluate=s,this.args=a,this._overloadIndex=u}evaluate(t){if(!this._evaluate){const r=Ur.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,r){const s=t[0],a=Ur.definitions[s];if(!a)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(a)?a[0]:a.type,c=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,p=[];let g=null,y=-1;for(const[x,E]of c){if(Array.isArray(x)&&x.length!==t.length-1)continue;p.push(x),y++,g=new Ch(r.registry,r.path,null,r.scope,void 0,r.options);const S=[];let M=!1;for(let D=1;D<t.length;D++){const P=t[D],O=Array.isArray(x)?x[D-1]:x.type,R=g.parse(P,1+S.length,O);if(!R){M=!0;break}S.push(R)}if(!M)if(Array.isArray(x)&&x.length!==S.length)g.error(`Expected ${x.length} arguments, but found ${S.length} instead.`);else{for(let D=0;D<S.length;D++){const P=Array.isArray(x)?x[D]:x.type,O=S[D];g.concat(D+1).checkSubtype(P,O.type)}if(0===g.errors.length)return new Ur(s,u,E,S,y)}}if(1===p.length)r.errors.push(...g.errors);else{const x=(p.length?p:c.map(([S])=>S)).map(Js).join(" | "),E=[];for(let S=1;S<t.length;S++){const M=r.parse(t[S],1+E.length);if(!M)return null;E.push(rs(M.type))}r.error(`Expected arguments of type ${x}, but found (${E.join(", ")}) instead.`)}return null}static register(t,r){Ur.definitions=r;for(const s in r)t[s]=Ur}}function Js(e){return Array.isArray(e)?`(${e.map(rs).join(", ")})`:`(${rs(e.type)}...)`}var Ns=Ur;class el{constructor(t,r,s){this.type=Ma,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(2!==t.length)return r.error("Expected one argument.");const s=t[1];if("object"!=typeof s||Array.isArray(s))return r.error("Collator options argument must be an object.");const a=r.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,Nr);if(!a)return null;const u=r.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,Nr);if(!u)return null;let c=null;return s.locale&&(c=r.parse(s.locale,1,Cr),!c)?null:new el(a,u,c)}evaluate(t){return new Ti(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}var sa={exports:{}};sa.exports=function(){function e(s,a,u,c,p){for(;c>u;){if(c-u>600){var g=c-u+1,y=a-u+1,x=Math.log(g),E=.5*Math.exp(2*x/3),S=.5*Math.sqrt(x*E*(g-E)/g)*(y-g/2<0?-1:1);e(s,a,Math.max(u,Math.floor(a-y*E/g+S)),Math.min(c,Math.floor(a+(g-y)*E/g+S)),p)}var M=s[a],D=u,P=c;for(t(s,u,a),p(s[c],M)>0&&t(s,u,c);D<P;){for(t(s,D,P),D++,P--;p(s[D],M)<0;)D++;for(;p(s[P],M)>0;)P--}0===p(s[u],M)?t(s,u,P):t(s,++P,c),P<=a&&(u=P+1),a<=P&&(c=P-1)}}function t(s,a,u){var c=s[a];s[a]=s[u],s[u]=c}function r(s,a){return s<a?-1:s>a?1:0}return function(s,a,u,c,p){e(s,a,u||0,c||s.length-1,p||r)}}();var Ms=mt(sa.exports);function xc(e){let t=0;for(let r,s,a=0,u=e.length,c=u-1;a<u;c=a++)r=e[a],s=e[c],t+=(s.x-r.x)*(r.y+s.y);return t}function bc(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Ks(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function xl(e,t,r){const s=e[0]-t[0],a=e[1]-t[1],u=e[0]-r[0],c=e[1]-r[1];return s*c-u*a==0&&s*u<=0&&a*c<=0}function Kr(e,t,r=!1){let s=!1;for(let p=0,g=t.length;p<g;p++){const y=t[p];for(let x=0,E=y.length,S=E-1;x<E;S=x++){const M=y[S],D=y[x];if(xl(e,M,D))return r;(u=M)[1]>(a=e)[1]!=(c=D)[1]>a[1]&&a[0]<(c[0]-u[0])*(a[1]-u[1])/(c[1]-u[1])+u[0]&&(s=!s)}}var a,u,c;return s}function ya(e,t,r,s){const a=s[0]-r[0],u=s[1]-r[1],c=(e[0]-r[0])*u-a*(e[1]-r[1]),p=(t[0]-r[0])*u-a*(t[1]-r[1]);return c>0&&p<0||c<0&&p>0}function mi(e,t,r,s){return(a=[s[0]-r[0],s[1]-r[1]])[0]*(u=[t[0]-e[0],t[1]-e[1]])[1]-a[1]*u[0]!=0&&!(!ya(e,t,r,s)||!ya(r,s,e,t));var a,u}const cs=8192;function su(e,t){const r=(180+e[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,a=Math.pow(2,t.z);return[Math.round(r*a*cs),Math.round(s*a*cs)]}function qs(e,t){for(let r=0;r<t.length;r++)if(Kr(e,t[r]))return!0;return!1}function Qs(e,t,r){for(const s of r)for(let a=0,u=s.length,c=u-1;a<u;c=a++)if(mi(e,t,s[c],s[a]))return!0;return!1}function Tu(e,t){for(let r=0;r<e.length;++r)if(!Kr(e[r],t))return!1;for(let r=0;r<e.length-1;++r)if(Qs(e[r],e[r+1],t))return!1;return!0}function Eh(e,t){for(let r=0;r<t.length;r++)if(Tu(e,t[r]))return!0;return!1}function Qo(e,t,r){const s=[];for(let a=0;a<e.length;a++){const u=[];for(let c=0;c<e[a].length;c++){const p=su(e[a][c],r);bc(t,p),u.push(p)}s.push(u)}return s}function Ta(e,t,r){const s=[];for(let a=0;a<e.length;a++){const u=Qo(e[a],t,r);s.push(u)}return s}function gs(e,t,r,s){if(e[0]<r[0]||e[0]>r[2]){const a=.5*s;let u=e[0]-r[0]>a?-s:r[0]-e[0]>a?s:0;0===u&&(u=e[0]-r[2]>a?-s:r[2]-e[0]>a?s:0),e[0]+=u}bc(t,e)}function bl(e,t,r,s){const a=Math.pow(2,s.z)*cs,u=[s.x*cs,s.y*cs],c=[];if(!e)return c;for(const p of e)for(const g of p){const y=[g.x+u[0],g.y+u[1]];gs(y,t,r,a),c.push(y)}return c}function Vr(e,t,r,s){const a=Math.pow(2,s.z)*cs,u=[s.x*cs,s.y*cs],c=[];if(!e)return c;for(const g of e){const y=[];for(const x of g){const E=[x.x+u[0],x.y+u[1]];bc(t,E),y.push(E)}c.push(y)}if(t[2]-t[0]<=a/2){(p=t)[0]=p[1]=1/0,p[2]=p[3]=-1/0;for(const g of c)for(const y of g)gs(y,t,r,a)}var p;return c}class au{constructor(t,r){this.type=Nr,this.geojson=t,this.geometries=r}static parse(t,r){if(2!==t.length)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Mu(t[1])){const s=t[1];if("FeatureCollection"===s.type)for(let a=0;a<s.features.length;++a){const u=s.features[a].geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new au(s,s.features[a].geometry)}else if("Feature"===s.type){const a=s.geometry.type;if("Polygon"===a||"MultiPolygon"===a)return new au(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new au(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(r,s){const a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],c=r.canonicalID();if(!c)return!1;if("Polygon"===s.type){const p=Qo(s.coordinates,u,c),g=bl(r.geometry(),a,u,c);if(!Ks(a,u))return!1;for(const y of g)if(!Kr(y,p))return!1}if("MultiPolygon"===s.type){const p=Ta(s.coordinates,u,c),g=bl(r.geometry(),a,u,c);if(!Ks(a,u))return!1;for(const y of g)if(!qs(y,p))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(r,s){const a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],c=r.canonicalID();if(!c)return!1;if("Polygon"===s.type){const p=Qo(s.coordinates,u,c),g=Vr(r.geometry(),a,u,c);if(!Ks(a,u))return!1;for(const y of g)if(!Tu(y,p))return!1}if("MultiPolygon"===s.type){const p=Ta(s.coordinates,u,c),g=Vr(r.geometry(),a,u,c);if(!Ks(a,u))return!1;for(const y of g)if(!Eh(y,p))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var wl=au,lu={exports:{}};lu.exports=function(){var e={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},t=1/298.257223563,r=t*(2-t),s=Math.PI/180,a=function(y,x){if(void 0===y)throw new Error("No latitude given.");if(x&&!e[x])throw new Error("Unknown unit "+x+". Use one of: "+Object.keys(e).join(", "));var E=6378.137*s*(x?e[x]:1),S=Math.cos(y*s),M=1/(1-r*(1-S*S)),D=Math.sqrt(M);this.kx=E*D*S,this.ky=E*D*M*(1-r)},u={units:{configurable:!0}};function c(y,x){return y[0]===x[0]&&y[1]===x[1]}function p(y,x,E){var S=g(x[0]-y[0]);return[y[0]+S*E,y[1]+(x[1]-y[1])*E]}function g(y){for(;y<-180;)y+=360;for(;y>180;)y-=360;return y}return a.fromTile=function(y,x,E){var S=Math.PI*(1-2*(y+.5)/Math.pow(2,x)),M=Math.atan(.5*(Math.exp(S)-Math.exp(-S)))/s;return new a(M,E)},u.units.get=function(){return e},a.prototype.distance=function(y,x){var E=g(y[0]-x[0])*this.kx,S=(y[1]-x[1])*this.ky;return Math.sqrt(E*E+S*S)},a.prototype.bearing=function(y,x){var E=g(x[0]-y[0])*this.kx;return Math.atan2(E,(x[1]-y[1])*this.ky)/s},a.prototype.destination=function(y,x,E){var S=E*s;return this.offset(y,Math.sin(S)*x,Math.cos(S)*x)},a.prototype.offset=function(y,x,E){return[y[0]+x/this.kx,y[1]+E/this.ky]},a.prototype.lineDistance=function(y){for(var x=0,E=0;E<y.length-1;E++)x+=this.distance(y[E],y[E+1]);return x},a.prototype.area=function(y){for(var x=0,E=0;E<y.length;E++)for(var S=y[E],M=0,D=S.length,P=D-1;M<D;P=M++)x+=g(S[M][0]-S[P][0])*(S[M][1]+S[P][1])*(E?-1:1);return Math.abs(x)/2*this.kx*this.ky},a.prototype.along=function(y,x){var E=0;if(x<=0)return y[0];for(var S=0;S<y.length-1;S++){var M=y[S],D=y[S+1],P=this.distance(M,D);if((E+=P)>x)return p(M,D,(x-(E-P))/P)}return y[y.length-1]},a.prototype.pointToSegmentDistance=function(y,x,E){var S=x[0],M=x[1],D=g(E[0]-S)*this.kx,P=(E[1]-M)*this.ky,O=0;return 0===D&&0===P||((O=(g(y[0]-S)*this.kx*D+(y[1]-M)*this.ky*P)/(D*D+P*P))>1?(S=E[0],M=E[1]):O>0&&(S+=D/this.kx*O,M+=P/this.ky*O)),D=g(y[0]-S)*this.kx,P=(y[1]-M)*this.ky,Math.sqrt(D*D+P*P)},a.prototype.pointOnLine=function(y,x){for(var E,S,M,D,P=1/0,O=0;O<y.length-1;O++){var R=y[O][0],B=y[O][1],j=g(y[O+1][0]-R)*this.kx,V=(y[O+1][1]-B)*this.ky,U=0;0===j&&0===V||((U=(g(x[0]-R)*this.kx*j+(x[1]-B)*this.ky*V)/(j*j+V*V))>1?(R=y[O+1][0],B=y[O+1][1]):U>0&&(R+=j/this.kx*U,B+=V/this.ky*U));var G=(j=g(x[0]-R)*this.kx)*j+(V=(x[1]-B)*this.ky)*V;G<P&&(P=G,E=R,S=B,M=O,D=U)}return{point:[E,S],index:M,t:Math.max(0,Math.min(1,D))}},a.prototype.lineSlice=function(y,x,E){var S=this.pointOnLine(E,y),M=this.pointOnLine(E,x);if(S.index>M.index||S.index===M.index&&S.t>M.t){var D=S;S=M,M=D}var P=[S.point],O=S.index+1,R=M.index;!c(E[O],P[0])&&O<=R&&P.push(E[O]);for(var B=O+1;B<=R;B++)P.push(E[B]);return c(E[R],M.point)||P.push(M.point),P},a.prototype.lineSliceAlong=function(y,x,E){for(var S=0,M=[],D=0;D<E.length-1;D++){var P=E[D],O=E[D+1],R=this.distance(P,O);if((S+=R)>y&&0===M.length&&M.push(p(P,O,(y-(S-R))/R)),S>=x)return M.push(p(P,O,(x-(S-R))/R)),M;S>y&&M.push(O)}return M},a.prototype.bufferPoint=function(y,x){var E=x/this.ky,S=x/this.kx;return[y[0]-S,y[1]-E,y[0]+S,y[1]+E]},a.prototype.bufferBBox=function(y,x){var E=x/this.ky,S=x/this.kx;return[y[0]-S,y[1]-E,y[2]+S,y[3]+E]},a.prototype.insideBBox=function(y,x){return g(y[0]-x[0])>=0&&g(y[0]-x[2])<=0&&y[1]>=x[1]&&y[1]<=x[3]},Object.defineProperties(a,u),a}();var Ih=mt(lu.exports),Ee={exports:{}};Ee.exports=function(){var e=function(r,s){if(void 0===r&&(r=[]),void 0===s&&(s=t),this.data=r,this.length=this.data.length,this.compare=s,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};function t(r,s){return r<s?-1:r>s?1:0}return e.prototype.push=function(r){this.data.push(r),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(0!==this.length){var r=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),r}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(r){for(var s=this.data,a=this.compare,u=s[r];r>0;){var c=r-1>>1,p=s[c];if(a(u,p)>=0)break;s[r]=p,r=c}s[r]=u},e.prototype._down=function(r){for(var s=this.data,a=this.compare,u=this.length>>1,c=s[r];r<u;){var p=1+(r<<1),g=s[p],y=p+1;if(y<this.length&&a(s[y],g)<0&&(p=y,g=s[y]),a(g,c)>=0)break;s[r]=g,r=p}s[r]=c},e}();var Xe=mt(Ee.exports),$t=8192;function Zn(e,t){return t.dist-e.dist}const Xi=100,Mr=50;function Yi(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Ji(e){return e[1]-e[0]+1}function Fs(e,t){const r=e[1]>=e[0]&&e[1]<t;return r||console.warn("Distance Expression: Index is out of range"),r}function ts(e,t){if(e[0]>e[1])return[null,null];const r=Ji(e);if(t){if(2===r)return[e,null];const s=Math.floor(r/2);return[[e[0],e[0]+s],[e[0]+s,e[1]]]}{if(1===r)return[e,null];const s=Math.floor(r/2)-1;return[[e[0],e[0]+s],[e[0]+s+1,e[1]]]}}function to(e,t){const r=[1/0,1/0,-1/0,-1/0];if(!Fs(t,e.length))return r;for(let s=t[0];s<=t[1];++s)bc(r,e[s]);return r}function As(e){const t=[1/0,1/0,-1/0,-1/0];for(let r=0;r<e.length;++r)for(let s=0;s<e[r].length;++s)bc(t,e[r][s]);return t}function eo(e,t,r){if(Yi(e)||Yi(t))return NaN;let s=0,a=0;return e[2]<t[0]&&(s=t[0]-e[2]),e[0]>t[2]&&(s=e[0]-t[2]),e[1]>t[3]&&(a=e[1]-t[3]),e[3]<t[1]&&(a=t[1]-e[3]),r.distance([0,0],[s,a])}function Go(e,t){const r=Math.pow(2,t.z);return[(a=(e.x/$t+t.x)/r,360*a-180),(s=(e.y/$t+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90)];var s,a}function Bi(e,t){const r=[];for(let s=0;s<e.length;++s)r.push(Go(e[s],t));return r}function tc(e,t,r){const s=r.pointOnLine(t,e).point;return r.distance(e,s)}function nl(e,t,r,s,a){const u=r.slice(s[0],s[1]+1);let c=1/0;for(let p=t[0];p<=t[1];++p)if(0===(c=Math.min(c,tc(e[p],u,a))))return 0;return c}function rl(e,t,r,s,a){const u=Math.min(a.pointToSegmentDistance(e,r,s),a.pointToSegmentDistance(t,r,s)),c=Math.min(a.pointToSegmentDistance(r,e,t),a.pointToSegmentDistance(s,e,t));return Math.min(u,c)}function Ts(e,t,r,s,a){if(!Fs(t,e.length)||!Fs(s,r.length))return NaN;let u=1/0;for(let c=t[0];c<t[1];++c)for(let p=s[0];p<s[1];++p){if(mi(e[c],e[c+1],r[p],r[p+1]))return 0;u=Math.min(u,rl(e[c],e[c+1],r[p],r[p+1],a))}return u}function ta(e,t,r,s,a){if(!Fs(t,e.length)||!Fs(s,r.length))return NaN;let u=1/0;for(let c=t[0];c<=t[1];++c)for(let p=s[0];p<=s[1];++p)if(0===(u=Math.min(u,a.distance(e[c],r[p]))))return u;return u}function Pl(e,t,r){if(Kr(e,t,!0))return 0;let s=1/0;for(const a of t){const u=a.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[u-1]&&0===(s=Math.min(s,r.pointToSegmentDistance(e,a[u-1],a[0])))||0===(s=Math.min(s,tc(e,a,r))))return s}return s}function Ba(e,t,r,s){if(!Fs(t,e.length))return NaN;for(let u=t[0];u<=t[1];++u)if(Kr(e[u],r,!0))return 0;let a=1/0;for(let u=t[0];u<t[1];++u)for(const c of r)for(let p=0,g=c.length,y=g-1;p<g;y=p++){if(mi(e[u],e[u+1],c[y],c[p]))return 0;a=Math.min(a,rl(e[u],e[u+1],c[y],c[p],s))}return a}function ko(e,t){for(const r of e)for(let s=0;s<=r.length-1;++s)if(Kr(r[s],t,!0))return!0;return!1}function qi(e,t,r,s=1/0){const a=As(e),u=As(t);if(s!==1/0&&eo(a,u,r)>=s)return s;if(Ks(a,u)){if(ko(e,t))return 0}else if(ko(t,e))return 0;let c=s;for(const p of e)for(let g=0,y=p.length,x=y-1;g<y;x=g++)for(const E of t)for(let S=0,M=E.length,D=M-1;S<M;D=S++){if(mi(p[x],p[g],E[D],E[S]))return 0;c=Math.min(c,rl(p[x],p[g],E[D],E[S],r))}return c}function Ua(e,t,r,s,a,u,c){if(null===u||null===c)return;const p=eo(to(s,u),to(a,c),r);p<t&&e.push({dist:p,range1:u,range2:c})}function _s(e,t,r,s,a=1/0){let u=Math.min(s.distance(e[0],r[0][0]),a);if(0===u)return u;const c=new Xe([{dist:0,range1:[0,e.length-1],range2:[0,0]}],Zn),p=t?Mr:Xi,g=As(r);for(;c.length;){const y=c.pop();if(y.dist>=u)continue;const x=y.range1;if(Ji(x)<=p){if(!Fs(x,e.length))return NaN;if(t){const E=Ba(e,x,r,s);if(0===(u=Math.min(u,E)))return u}else for(let E=x[0];E<=x[1];++E){const S=Pl(e[E],r,s);if(0===(u=Math.min(u,S)))return u}}else{const E=ts(x,t);if(null!==E[0]){const S=eo(to(e,E[0]),g,s);S<u&&c.push({dist:S,range1:E[0],range2:[0,0]})}if(null!==E[1]){const S=eo(to(e,E[1]),g,s);S<u&&c.push({dist:S,range1:E[1],range2:[0,0]})}}}return u}function Zc(e,t,r,s,a,u=1/0){let c=Math.min(u,a.distance(e[0],r[0]));if(0===c)return c;const p=new Xe([{dist:0,range1:[0,e.length-1],range2:[0,r.length-1]}],Zn),g=t?Mr:Xi,y=s?Mr:Xi;for(;p.length;){const x=p.pop();if(x.dist>=c)continue;const E=x.range1,S=x.range2;if(Ji(E)<=g&&Ji(S)<=y){if(!Fs(E,e.length)||!Fs(S,r.length))return NaN;if(t&&s?c=Math.min(c,Ts(e,E,r,S,a)):t||s?t&&!s?c=Math.min(c,nl(r,S,e,E,a)):!t&&s&&(c=Math.min(c,nl(e,E,r,S,a))):c=Math.min(c,ta(e,E,r,S,a)),0===c)return c}else{const M=ts(E,t),D=ts(S,s);Ua(p,c,a,e,r,M[0],D[0]),Ua(p,c,a,e,r,M[0],D[1]),Ua(p,c,a,e,r,M[1],D[0]),Ua(p,c,a,e,r,M[1],D[1])}}return c}function no(e,t,r,s,a=1/0){let u=a;const c=to(e,[0,e.length-1]);for(const p of r)if(!(u!==1/0&&eo(c,to(p,[0,p.length-1]),s)>=u)&&(u=Math.min(u,Zc(e,t,p,!0,s,u)),0===u))return u;return u}function il(e,t,r,s,a=1/0){let u=a;const c=to(e,[0,e.length-1]);for(const p of r){if(u!==1/0&&eo(c,As(p),s)>=u)continue;const g=_s(e,t,p,s,u);if(isNaN(g))return g;if(0===(u=Math.min(u,g)))return u}return u}function hs(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class qo{constructor(t,r){this.type=In,this.geojson=t,this.geometries=r}static parse(t,r){if(2!==t.length)return r.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(Mu(t[1])){const s=t[1];if("FeatureCollection"===s.type){for(let a=0;a<s.features.length;++a)if(hs(s.features[a].geometry.type))return new qo(s,s.features[a].geometry)}else if("Feature"===s.type){if(hs(s.geometry.type))return new qo(s,s.geometry)}else if(hs(s.type))return new qo(s,s)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const r=t.geometry(),s=t.canonicalID();if(null!=r&&null!=s){if("Point"===t.geometryType())return function(a,u,c){const p=[];for(const y of a)for(const x of y)p.push(Go(x,u));const g=new Ih(p[0][1],"meters");return"Point"===c.type||"MultiPoint"===c.type||"LineString"===c.type?Zc(p,!1,"Point"===c.type?[c.coordinates]:c.coordinates,"LineString"===c.type,g):"MultiLineString"===c.type?no(p,!1,c.coordinates,g):"Polygon"===c.type||"MultiPolygon"===c.type?il(p,!1,"Polygon"===c.type?[c.coordinates]:c.coordinates,g):null}(r,s,this.geometries);if("LineString"===t.geometryType())return function(a,u,c){const p=[];for(const y of a){const x=[];for(const E of y)x.push(Go(E,u));p.push(x)}const g=new Ih(p[0][0][1],"meters");if("Point"===c.type||"MultiPoint"===c.type||"LineString"===c.type)return no("Point"===c.type?[c.coordinates]:c.coordinates,"LineString"===c.type,p,g);if("MultiLineString"===c.type){let y=1/0;for(let x=0;x<c.coordinates.length;x++){const E=no(c.coordinates[x],!0,p,g,y);if(isNaN(E))return E;if(0===(y=Math.min(y,E)))return y}return y}if("Polygon"===c.type||"MultiPolygon"===c.type){let y=1/0;for(let x=0;x<p.length;x++){const E=il(p[x],!0,"Polygon"===c.type?[c.coordinates]:c.coordinates,g,y);if(isNaN(E))return E;if(0===(y=Math.min(y,E)))return y}return y}return null}(r,s,this.geometries);if("Polygon"===t.geometryType())return function(a,u,c){const p=[];for(const y of function(x,E){const S=x.length;if(S<=1)return[x];const M=[];let D,P;for(let O=0;O<S;O++){const R=xc(x[O]);0!==R&&(x[O].area=Math.abs(R),void 0===P&&(P=R<0),P===R<0?(D&&M.push(D),D=[x[O]]):D.push(x[O]))}return D&&M.push(D),M}(a)){const x=[];for(let E=0;E<y.length;++E)x.push(Bi(y[E],u));p.push(x)}const g=new Ih(p[0][0][0][1],"meters");if("Point"===c.type||"MultiPoint"===c.type||"LineString"===c.type)return il("Point"===c.type?[c.coordinates]:c.coordinates,"LineString"===c.type,p,g);if("MultiLineString"===c.type){let y=1/0;for(let x=0;x<c.coordinates.length;x++){const E=il(c.coordinates[x],!0,p,g,y);if(isNaN(E))return E;if(0===(y=Math.min(y,E)))return y}return y}return"Polygon"===c.type||"MultiPolygon"===c.type?function(y,x,E){let S=1/0;for(const M of y)for(const D of x){const P=qi(M,D,E,S);if(isNaN(P))return P;if(0===(S=Math.min(S,P)))return S}return S}("Polygon"===c.type?[c.coordinates]:c.coordinates,p,g):null}(r,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var aa=qo;function $o(e){if(e instanceof Ns&&("get"===e.name&&1===e.args.length||"feature-state"===e.name||"has"===e.name&&1===e.args.length||"properties"===e.name||"geometry-type"===e.name||"id"===e.name||/^filter-/.test(e.name))||e instanceof wl||e instanceof aa)return!1;let t=!0;return e.eachChild(r=>{t&&!$o(r)&&(t=!1)}),t}function zo(e){if(e instanceof Ns&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild(r=>{t&&!zo(r)&&(t=!1)}),t}function Wr(e){if(e instanceof Ns&&"config"===e.name)return!1;let t=!0;return e.eachChild(r=>{t&&!Wr(r)&&(t=!1)}),t}function Oo(e,t){if(e instanceof Ns&&t.indexOf(e.name)>=0)return!1;let r=!0;return e.eachChild(s=>{r&&!Oo(s,t)&&(r=!1)}),r}class $i{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(2!==t.length||"string"!=typeof t[1])return r.error("'var' expression requires exactly one string literal argument.");const s=t[1];return r.scope.has(s)?new $i(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var la=$i;class yi{constructor(t,r=[],s,a=new us,u=[],c){this.registry=t,this.path=r,this.key=r.map(p=>`[${p}]`).join(""),this.scope=a,this.errors=u,this.expectedType=s,this.options=c}parse(t,r,s,a,u={}){return r||s?this.concat(r,s,a)._parse(t,u):this._parse(t,u)}_parse(t,r){function s(a,u,c){return"assert"===c?new Al(u,[a]):"coerce"===c?new tl(u,[a]):a}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a="string"==typeof t[0]?this.registry[t[0]]:void 0;if(a){let u=a.parse(t,this);if(!u)return null;if(this.expectedType){const c=this.expectedType,p=u.type;if("string"!==c.kind&&"number"!==c.kind&&"boolean"!==c.kind&&"object"!==c.kind&&"array"!==c.kind||"value"!==p.kind)if("color"!==c.kind&&"formatted"!==c.kind&&"resolvedImage"!==c.kind||"value"!==p.kind&&"string"!==p.kind){if(this.checkSubtype(c,p))return null}else u=s(u,c,r.typeAnnotation||"coerce");else u=s(u,c,r.typeAnnotation||"assert")}if(!(u instanceof dr)&&"resolvedImage"!==u.type.kind&&ec(u)){const c=new Gs(this.options);try{u=new dr(u.type,u.evaluate(c))}catch(p){return this.error(p.message),null}}return u}return tl.parse(["to-array",t],this)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,s){const a="number"==typeof t?this.path.concat(t):this.path,u=s?this.scope.concat(s):this.scope;return new yi(this.registry,a,r||null,u,this.errors,this.options)}error(t,...r){const s=`${this.key}${r.map(a=>`[${a}]`).join("")}`;this.errors.push(new Gi(s,t))}checkSubtype(t,r){const s=Cu(t,r);return s&&this.error(s),s}}var Ch=yi;function ec(e){if(e instanceof la)return ec(e.boundExpression);if(e instanceof Ns&&"error"===e.name||e instanceof Ns&&"config"===e.name||e instanceof el||e instanceof wl||e instanceof aa)return!1;const t=e instanceof tl||e instanceof Al;let r=!0;return e.eachChild(s=>{r=t?r&&ec(s):r&&s instanceof dr}),!!r&&$o(e)&&Oo(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function is(e,t){const r=e.length-1;let s,a,u=0,c=r,p=0;for(;u<=c;)if(p=Math.floor((u+c)/2),s=e[p],a=e[p+1],s<=t){if(p===r||t<a)return p;u=p+1}else{if(!(s>t))throw new qr("Input is not a number.");c=p-1}return 0}class Du{constructor(t,r,s){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[a,u]of s)this.labels.push(a),this.outputs.push(u)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(t[1],1,In);if(!s)return null;const a=[];let u=null;r.expectedType&&"value"!==r.expectedType.kind&&(u=r.expectedType);for(let c=1;c<t.length;c+=2){const p=1===c?-1/0:t[c],g=t[c+1],y=c,x=c+1;if("number"!=typeof p)return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',y);if(a.length&&a[a.length-1][0]>=p)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',y);const E=r.parse(g,x,u);if(!E)return null;u=u||E.type,a.push([p,E])}return new Du(u,s,a)}evaluate(t){const r=this.labels,s=this.outputs;if(1===r.length)return s[0].evaluate(t);const a=this.input.evaluate(t);if(a<=r[0])return s[0].evaluate(t);const u=r.length;return a>=r[u-1]?s[u-1].evaluate(t):s[is(r,a)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&t.push(this.labels[r]),t.push(this.outputs[r].serialize());return t}}var zf=Du;function An(e,t,r){return e*(1-r)+t*r}function $n(e,t,r){return e.map((s,a)=>An(s,t[a],r))}var cr=Object.freeze({__proto__:null,array:$n,color:function(e,t,r){return new pn(An(e.r,t.r,r),An(e.g,t.g,r),An(e.b,t.b,r),An(e.a,t.a,r))},number:An});const ua=4/29,$s=6/29,nc=3*$s*$s,Li=$s*$s*$s,Wc=Math.PI/180,sl=180/Math.PI;function ni(e){return e>Li?Math.pow(e,1/3):e/nc+ua}function Au(e){return e>$s?e*e*e:nc*(e-ua)}function Yd(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Xc(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Bo(e){const t=Xc(e.r),r=Xc(e.g),s=Xc(e.b),a=ni((.4124564*t+.3575761*r+.1804375*s)/.95047),u=ni((.2126729*t+.7151522*r+.072175*s)/1);return{l:116*u-16,a:500*(a-u),b:200*(u-ni((.0193339*t+.119192*r+.9503041*s)/1.08883)),alpha:e.a}}function Pu(e){let t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,s=isNaN(e.b)?t:t-e.b/200;return t=1*Au(t),r=.95047*Au(r),s=1.08883*Au(s),new pn(Yd(3.2404542*r-1.5371385*t-.4985314*s),Yd(-.969266*r+1.8760108*t+.041556*s),Yd(.0556434*r-.2040259*t+1.0572252*s),e.alpha)}function Lu(e,t,r){const s=t-e;return e+r*(s>180||s<-180?s-360*Math.round(s/360):s)}const al={forward:Bo,reverse:Pu,interpolate:function(e,t,r){return{l:An(e.l,t.l,r),a:An(e.a,t.a,r),b:An(e.b,t.b,r),alpha:An(e.alpha,t.alpha,r)}}},Ll={forward:function(e){const{l:t,a:r,b:s}=Bo(e),a=Math.atan2(s,r)*sl;return{h:a<0?a+360:a,c:Math.sqrt(r*r+s*s),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Wc,r=e.c;return Pu({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:Lu(e.h,t.h,r),c:An(e.c,t.c,r),l:An(e.l,t.l,r),alpha:An(e.alpha,t.alpha,r)}}};var rc=Object.freeze({__proto__:null,hcl:Ll,lab:al});class El{constructor(t,r,s,a,u){this.type=t,this.operator=r,this.interpolation=s,this.input=a,this.labels=[],this.outputs=[];for(const[c,p]of u)this.labels.push(c),this.outputs.push(p)}static interpolationFactor(t,r,s,a){let u=0;if("exponential"===t.name)u=ll(r,t.base,s,a);else if("linear"===t.name)u=ll(r,1,s,a);else if("cubic-bezier"===t.name){const c=t.controlPoints;u=new ct(c[0],c[1],c[2],c[3]).solve(ll(r,1,s,a))}return u}static parse(t,r){let[s,a,u,...c]=t;if(!Array.isArray(a)||0===a.length)return r.error("Expected an interpolation type expression.",1);if("linear"===a[0])a={name:"linear"};else if("exponential"===a[0]){const y=a[1];if("number"!=typeof y)return r.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:y}}else{if("cubic-bezier"!==a[0])return r.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const y=a.slice(1);if(4!==y.length||y.some(x=>"number"!=typeof x||x<0||x>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:y}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(u=r.parse(u,2,In),!u)return null;const p=[];let g=null;"interpolate-hcl"===s||"interpolate-lab"===s?g=Vs:r.expectedType&&"value"!==r.expectedType.kind&&(g=r.expectedType);for(let y=0;y<c.length;y+=2){const x=c[y],E=c[y+1],S=y+3,M=y+4;if("number"!=typeof x)return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(p.length&&p[p.length-1][0]>=x)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',S);const D=r.parse(E,M,g);if(!D)return null;g=g||D.type,p.push([x,D])}return"number"===g.kind||"color"===g.kind||"array"===g.kind&&"number"===g.itemType.kind&&"number"==typeof g.N?new El(g,s,a,u,p):r.error(`Type ${rs(g)} is not interpolatable.`)}evaluate(t){const r=this.labels,s=this.outputs;if(1===r.length)return s[0].evaluate(t);const a=this.input.evaluate(t);if(a<=r[0])return s[0].evaluate(t);const u=r.length;if(a>=r[u-1])return s[u-1].evaluate(t);const c=is(r,a),p=El.interpolationFactor(this.interpolation,a,r[c],r[c+1]),g=s[c].evaluate(t),y=s[c+1].evaluate(t);return"interpolate"===this.operator?cr[this.type.kind.toLowerCase()](g,y,p):"interpolate-hcl"===this.operator?Ll.reverse(Ll.interpolate(Ll.forward(g),Ll.forward(y),p)):al.reverse(al.interpolate(al.forward(g),al.forward(y),p))}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,t,this.input.serialize()];for(let s=0;s<this.labels.length;s++)r.push(this.labels[s],this.outputs[s].serialize());return r}}function ll(e,t,r,s){const a=s-r,u=e-r;return 0===a?0:1===t?u/a:(Math.pow(t,u)-1)/(Math.pow(t,a)-1)}var ca=El;class Tr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let s=null;const a=r.expectedType;a&&"value"!==a.kind&&(s=a);const u=[];for(const p of t.slice(1)){const g=r.parse(p,1+u.length,s,void 0,{typeAnnotation:"omit"});if(!g)return null;s=s||g.type,u.push(g)}const c=a&&u.some(p=>Cu(a,p.type));return new Tr(c?sr:s,u)}evaluate(t){let r,s=null,a=0;for(const u of this.args){if(a++,s=u.evaluate(t),s&&s instanceof gi&&!s.available&&(r||(r=s),s=null,a===this.args.length))return r;if(null!==s)break}return s}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(r=>{t.push(r.serialize())}),t}}var ci=Tr;class Sh{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const s=[];for(let u=1;u<t.length-1;u+=2){const c=t[u];if("string"!=typeof c)return r.error(`Expected string, but found ${typeof c} instead.`,u);if(/[^a-zA-Z0-9_]/.test(c))return r.error("Variable names must contain only alphanumeric characters or '_'.",u);const p=r.parse(t[u+1],u+1);if(!p)return null;s.push([c,p])}const a=r.parse(t[t.length-1],t.length-1,r.expectedType,s);return a?new Sh(s,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[r,s]of this.bindings)t.push(r,s.serialize());return t.push(this.result.serialize()),t}}var Ou=Sh;class Da{constructor(t,r,s){this.type=t,this.index=r,this.input=s}static parse(t,r){if(3!==t.length)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,In),a=r.parse(t[2],2,Wi(r.expectedType||sr));return s&&a?new Da(a.type.itemType,s,a):null}evaluate(t){const r=this.index.evaluate(t),s=this.input.evaluate(t);if(r<0)throw new qr(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new qr(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new qr(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Ru=Da;class va{constructor(t,r){this.type=Nr,this.needle=t,this.haystack=r}static parse(t,r){if(3!==t.length)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,sr),a=r.parse(t[2],2,sr);return s&&a?iu(s.type,[Nr,Cr,In,Jo,sr])?new va(s,a):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${rs(s.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(null==s)return!1;if(!Tl(r,["boolean","string","number","null"]))throw new qr(`Expected first argument to be of type boolean, string, number or null, but found ${rs(Zr(r))} instead.`);if(!Tl(s,["string","array"]))throw new qr(`Expected second argument to be of type array or string, but found ${rs(Zr(s))} instead.`);return s.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var os=va;class wc{constructor(t,r,s){this.type=In,this.needle=t,this.haystack=r,this.fromIndex=s}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,sr),a=r.parse(t[2],2,sr);if(!s||!a)return null;if(!iu(s.type,[Nr,Cr,In,Jo,sr]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${rs(s.type)} instead`);if(4===t.length){const u=r.parse(t[3],3,In);return u?new wc(s,a,u):null}return new wc(s,a)}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!Tl(r,["boolean","string","number","null"]))throw new qr(`Expected first argument to be of type boolean, string, number or null, but found ${rs(Zr(r))} instead.`);if(!Tl(s,["string","array"]))throw new qr(`Expected second argument to be of type array or string, but found ${rs(Zr(s))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(t);return s.indexOf(r,a)}return s.indexOf(r)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var ha=wc;class f{constructor(t,r,s,a,u,c){this.inputType=t,this.type=r,this.input=s,this.cases=a,this.outputs=u,this.otherwise=c}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let s,a;r.expectedType&&"value"!==r.expectedType.kind&&(a=r.expectedType);const u={},c=[];for(let y=2;y<t.length-1;y+=2){let x=t[y];const E=t[y+1];Array.isArray(x)||(x=[x]);const S=r.concat(y);if(0===x.length)return S.error("Expected at least one branch label.");for(const D of x){if("number"!=typeof D&&"string"!=typeof D)return S.error("Branch labels must be numbers or strings.");if("number"==typeof D&&Math.abs(D)>Number.MAX_SAFE_INTEGER)return S.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof D&&Math.floor(D)!==D)return S.error("Numeric branch labels must be integer values.");if(s){if(S.checkSubtype(s,Zr(D)))return null}else s=Zr(D);if(void 0!==u[String(D)])return S.error("Branch labels must be unique.");u[String(D)]=c.length}const M=r.parse(E,y,a);if(!M)return null;a=a||M.type,c.push(M)}const p=r.parse(t[1],1,sr);if(!p)return null;const g=r.parse(t[t.length-1],t.length-1,a);return g?"value"!==p.type.kind&&r.concat(1).checkSubtype(s,p.type)?null:new f(s,a,p,u,c,g):null}evaluate(t){const r=this.input.evaluate(t);return(Zr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),s=[],a={};for(const c of r){const p=a[this.cases[c]];void 0===p?(a[this.cases[c]]=s.length,s.push([this.cases[c],[c]])):s[p][1].push(c)}const u=c=>"number"===this.inputType.kind?Number(c):c;for(const[c,p]of s)t.push(1===p.length?u(p[0]):p.map(u)),t.push(this.outputs[c].serialize());return t.push(this.otherwise.serialize()),t}}var d=f;class v{constructor(t,r,s){this.type=t,this.branches=r,this.otherwise=s}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&"value"!==r.expectedType.kind&&(s=r.expectedType);const a=[];for(let c=1;c<t.length-1;c+=2){const p=r.parse(t[c],c,Nr);if(!p)return null;const g=r.parse(t[c+1],c+1,s);if(!g)return null;a.push([p,g]),s=s||g.type}const u=r.parse(t[t.length-1],t.length-1,s);return u?new v(s,a,u):null}evaluate(t){for(const[r,s]of this.branches)if(r.evaluate(t))return s.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,s]of this.branches)t(r),t(s);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(r=>{t.push(r.serialize())}),t}}var w=v;class T{constructor(t,r,s,a){this.type=t,this.input=r,this.beginIndex=s,this.endIndex=a}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,sr),a=r.parse(t[2],2,In);if(!s||!a)return null;if(!iu(s.type,[Wi(sr),Cr,sr]))return r.error(`Expected first argument to be of type array or string, but found ${rs(s.type)} instead`);if(4===t.length){const u=r.parse(t[3],3,In);return u?new T(s.type,s,a,u):null}return new T(s.type,s,a)}evaluate(t){const r=this.input.evaluate(t),s=this.beginIndex.evaluate(t);if(!Tl(r,["string","array"]))throw new qr(`Expected first argument to be of type array or string, but found ${rs(Zr(r))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(t);return r.slice(s,a)}return r.slice(s)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var k=T;function q(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function K(e,t,r,s){return 0===s.compare(t,r)}function Mt(e,t,r){const s="=="!==e&&"!="!==e;return class jF{constructor(u,c,p){this.type=Nr,this.lhs=u,this.rhs=c,this.collator=p,this.hasUntypedArgument="value"===u.type.kind||"value"===c.type.kind}static parse(u,c){if(3!==u.length&&4!==u.length)return c.error("Expected two or three arguments.");const p=u[0];let g=c.parse(u[1],1,sr);if(!g)return null;if(!q(p,g.type))return c.concat(1).error(`"${p}" comparisons are not supported for type '${rs(g.type)}'.`);let y=c.parse(u[2],2,sr);if(!y)return null;if(!q(p,y.type))return c.concat(2).error(`"${p}" comparisons are not supported for type '${rs(y.type)}'.`);if(g.type.kind!==y.type.kind&&"value"!==g.type.kind&&"value"!==y.type.kind)return c.error(`Cannot compare types '${rs(g.type)}' and '${rs(y.type)}'.`);s&&("value"===g.type.kind&&"value"!==y.type.kind?g=new Al(y.type,[g]):"value"!==g.type.kind&&"value"===y.type.kind&&(y=new Al(g.type,[y])));let x=null;if(4===u.length){if("string"!==g.type.kind&&"string"!==y.type.kind&&"value"!==g.type.kind&&"value"!==y.type.kind)return c.error("Cannot use collator to compare non-string types.");if(x=c.parse(u[3],3,Ma),!x)return null}return new jF(g,y,x)}evaluate(u){const c=this.lhs.evaluate(u),p=this.rhs.evaluate(u);if(s&&this.hasUntypedArgument){const g=Zr(c),y=Zr(p);if(g.kind!==y.kind||"string"!==g.kind&&"number"!==g.kind)throw new qr(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${g.kind}, ${y.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const g=Zr(c),y=Zr(p);if("string"!==g.kind||"string"!==y.kind)return t(u,c,p)}return this.collator?r(u,c,p,this.collator.evaluate(u)):t(u,c,p)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[e];return this.eachChild(c=>{u.push(c.serialize())}),u}}}const ae=Mt("==",function(e,t,r){return t===r},K),Ze=Mt("!=",function(e,t,r){return t!==r},function(e,t,r,s){return!K(0,t,r,s)}),Qe=Mt("<",function(e,t,r){return t<r},function(e,t,r,s){return s.compare(t,r)<0}),Pn=Mt(">",function(e,t,r){return t>r},function(e,t,r,s){return s.compare(t,r)>0}),Bn=Mt("<=",function(e,t,r){return t<=r},function(e,t,r,s){return s.compare(t,r)<=0}),tr=Mt(">=",function(e,t,r){return t>=r},function(e,t,r,s){return s.compare(t,r)>=0});class _r{constructor(t,r,s,a,u,c){this.type=Cr,this.number=t,this.locale=r,this.currency=s,this.unit=a,this.minFractionDigits=u,this.maxFractionDigits=c}static parse(t,r){if(3!==t.length)return r.error("Expected two arguments.");const s=r.parse(t[1],1,In);if(!s)return null;const a=t[2];if("object"!=typeof a||Array.isArray(a))return r.error("NumberFormat options argument must be an object.");let u=null;if(a.locale&&(u=r.parse(a.locale,1,Cr),!u))return null;let c=null;if(a.currency&&(c=r.parse(a.currency,1,Cr),!c))return null;let p=null;if(a.unit&&(p=r.parse(a.unit,1,Cr),!p))return null;let g=null;if(a["min-fraction-digits"]&&(g=r.parse(a["min-fraction-digits"],1,In),!g))return null;let y=null;return a["max-fraction-digits"]&&(y=r.parse(a["max-fraction-digits"],1,In),!y)?null:new _r(s,u,c,p,g,y)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Ki{constructor(t){this.type=In,this.input=t}static parse(t,r){if(2!==t.length)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=r.parse(t[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?r.error(`Expected argument of type string or array, but found ${rs(s.type)} instead.`):new Ki(s):null}evaluate(t){const r=this.input.evaluate(t);if("string"==typeof r||Array.isArray(r))return r.length;throw new qr(`Expected value to be of type string or array, but found ${rs(Zr(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(r=>{t.push(r.serialize())}),t}}function Ps(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const Aa={"==":ae,"!=":Ze,">":Pn,"<":Qe,">=":tr,"<=":Bn,array:Al,at:Ru,boolean:Al,case:w,coalesce:ci,collator:el,format:ii,image:vl,in:os,"index-of":ha,interpolate:ca,"interpolate-hcl":ca,"interpolate-lab":ca,length:Ki,let:Ou,literal:dr,match:d,number:Al,"number-format":_r,object:Al,slice:k,step:zf,string:Al,"to-boolean":tl,"to-color":tl,"to-number":tl,"to-string":tl,var:la,within:wl,distance:aa};function Nu(e,[t,r,s,a]){t=t.evaluate(e),r=r.evaluate(e),s=s.evaluate(e);const u=a?a.evaluate(e):1,c=Gl(t,r,s,u);if(c)throw new qr(c);return new pn(t/255*u,r/255*u,s/255*u,u)}function Ec(e,[t,r,s,a]){t=t.evaluate(e),r=r.evaluate(e),s=s.evaluate(e);const u=a?a.evaluate(e):1,c=(x=r,E=s,S=u,"number"==typeof(y=t)&&y>=0&&y<=360?"number"==typeof x&&x>=0&&x<=100&&"number"==typeof E&&E>=0&&E<=100?void 0===S||"number"==typeof S&&S>=0&&S<=1?null:`Invalid hsla value [${[y,x,E,S].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof S?[y,x,E,S]:[y,x,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof S?[y,x,E,S]:[y,x,E]).join(", ")}]: 'h' must be between 0 and 360.`);var y,x,E,S;if(c)throw new qr(c);const p=`hsla(${t}, ${r}%, ${s}%, ${u})`,g=pn.parse(p);if(!g)throw new qr(`Failed to parse HSLA color: ${p}`);return g}function wm(e,t){return e in t}function Bb(e,t){const r=t[e];return void 0===r?null:r}function tT(e,t){switch(e){case"string":return String(t);case"number":return+t;case"boolean":return!!t;case"color":return pn.parse(t)}return t}function eT(e,t,r,s){return void 0!==s&&(e=s*Math.round(e/s)),void 0!==t&&e<t&&(e=t),void 0!==r&&e>r&&(e=r),e}function P0(e,t,r){r.length&&(t+=`\x1f${r}`);const s=e.getConfig(t);if(!s)return null;const{type:a,value:u,values:c,minValue:p,maxValue:g,stepValue:y}=s,x=s.default.evaluate(e);let E=u?u.evaluate(e):x;return a&&(E=tT(a,E)),void 0!==u&&void 0!==E&&c&&!c.includes(E)&&(E=x,a&&(E=tT(a,E))),void 0===E||void 0===p&&void 0===g&&void 0===y||("number"==typeof E?E=eT(E,p,g,y):Array.isArray(E)&&(E=E.map(S=>"number"==typeof S?eT(S,p,g,y):S))),E}function rf(e){return{type:e}}Ns.register(Aa,{error:[{kind:"error"},[Cr],(e,[t])=>{throw new qr(t.evaluate(e))}],typeof:[Cr,[sr],(e,[t])=>rs(Zr(t.evaluate(e)))],"to-rgba":[Wi(In,4),[Vs],(e,[t])=>t.evaluate(e).toArray()],rgb:[Vs,[In,In,In],Nu],rgba:[Vs,[In,In,In,In],Nu],hsl:[Vs,[In,In,In],Ec],hsla:[Vs,[In,In,In,In],Ec],has:{type:Nr,overloads:[[[Cr],(e,[t])=>wm(t.evaluate(e),e.properties())],[[Cr,_l],(e,[t,r])=>wm(t.evaluate(e),r.evaluate(e))]]},get:{type:sr,overloads:[[[Cr],(e,[t])=>Bb(t.evaluate(e),e.properties())],[[Cr,_l],(e,[t,r])=>Bb(t.evaluate(e),r.evaluate(e))]]},config:{type:sr,overloads:[[[Cr],(e,[t])=>P0(e,t.evaluate(e),"")],[[Cr,Cr],(e,[t,r])=>P0(e,t.evaluate(e),r.evaluate(e))]]},"feature-state":[sr,[Cr],(e,[t])=>Bb(t.evaluate(e),e.featureState||{})],properties:[_l,[],e=>e.properties()],"geometry-type":[Cr,[],e=>e.geometryType()],id:[sr,[],e=>e.id()],zoom:[In,[],e=>e.globals.zoom],pitch:[In,[],e=>e.globals.pitch||0],"distance-from-center":[In,[],e=>e.distanceFromCenter()],"measure-light":[In,[Cr],(e,[t])=>e.measureLight(t.evaluate(e))],"heatmap-density":[In,[],e=>e.globals.heatmapDensity||0],"line-progress":[In,[],e=>e.globals.lineProgress||0],"raster-value":[In,[],e=>e.globals.rasterValue||0],"sky-radial-progress":[In,[],e=>e.globals.skyRadialProgress||0],accumulated:[sr,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[In,rf(In),(e,t)=>{let r=0;for(const s of t)r+=s.evaluate(e);return r}],"*":[In,rf(In),(e,t)=>{let r=1;for(const s of t)r*=s.evaluate(e);return r}],"-":{type:In,overloads:[[[In,In],(e,[t,r])=>t.evaluate(e)-r.evaluate(e)],[[In],(e,[t])=>-t.evaluate(e)]]},"/":[In,[In,In],(e,[t,r])=>t.evaluate(e)/r.evaluate(e)],"%":[In,[In,In],(e,[t,r])=>t.evaluate(e)%r.evaluate(e)],ln2:[In,[],()=>Math.LN2],pi:[In,[],()=>Math.PI],e:[In,[],()=>Math.E],"^":[In,[In,In],(e,[t,r])=>Math.pow(t.evaluate(e),r.evaluate(e))],sqrt:[In,[In],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[In,[In],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[In,[In],(e,[t])=>Math.log(t.evaluate(e))],log2:[In,[In],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[In,[In],(e,[t])=>Math.sin(t.evaluate(e))],cos:[In,[In],(e,[t])=>Math.cos(t.evaluate(e))],tan:[In,[In],(e,[t])=>Math.tan(t.evaluate(e))],asin:[In,[In],(e,[t])=>Math.asin(t.evaluate(e))],acos:[In,[In],(e,[t])=>Math.acos(t.evaluate(e))],atan:[In,[In],(e,[t])=>Math.atan(t.evaluate(e))],min:[In,rf(In),(e,t)=>Math.min(...t.map(r=>r.evaluate(e)))],max:[In,rf(In),(e,t)=>Math.max(...t.map(r=>r.evaluate(e)))],abs:[In,[In],(e,[t])=>Math.abs(t.evaluate(e))],round:[In,[In],(e,[t])=>{const r=t.evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[In,[In],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[In,[In],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Nr,[Cr,sr],(e,[t,r])=>e.properties()[t.value]===r.value],"filter-id-==":[Nr,[sr],(e,[t])=>e.id()===t.value],"filter-type-==":[Nr,[Cr],(e,[t])=>e.geometryType()===t.value],"filter-<":[Nr,[Cr,sr],(e,[t,r])=>{const s=e.properties()[t.value],a=r.value;return typeof s==typeof a&&s<a}],"filter-id-<":[Nr,[sr],(e,[t])=>{const r=e.id(),s=t.value;return typeof r==typeof s&&r<s}],"filter->":[Nr,[Cr,sr],(e,[t,r])=>{const s=e.properties()[t.value],a=r.value;return typeof s==typeof a&&s>a}],"filter-id->":[Nr,[sr],(e,[t])=>{const r=e.id(),s=t.value;return typeof r==typeof s&&r>s}],"filter-<=":[Nr,[Cr,sr],(e,[t,r])=>{const s=e.properties()[t.value],a=r.value;return typeof s==typeof a&&s<=a}],"filter-id-<=":[Nr,[sr],(e,[t])=>{const r=e.id(),s=t.value;return typeof r==typeof s&&r<=s}],"filter->=":[Nr,[Cr,sr],(e,[t,r])=>{const s=e.properties()[t.value],a=r.value;return typeof s==typeof a&&s>=a}],"filter-id->=":[Nr,[sr],(e,[t])=>{const r=e.id(),s=t.value;return typeof r==typeof s&&r>=s}],"filter-has":[Nr,[sr],(e,[t])=>t.value in e.properties()],"filter-has-id":[Nr,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Nr,[Wi(Cr)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Nr,[Wi(sr)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Nr,[Cr,Wi(sr)],(e,[t,r])=>r.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Nr,[Cr,Wi(sr)],(e,[t,r])=>function(s,a,u,c){for(;u<=c;){const p=u+c>>1;if(a[p]===s)return!0;a[p]>s?c=p-1:u=p+1}return!1}(e.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Nr,overloads:[[[Nr,Nr],(e,[t,r])=>t.evaluate(e)&&r.evaluate(e)],[rf(Nr),(e,t)=>{for(const r of t)if(!r.evaluate(e))return!1;return!0}]]},any:{type:Nr,overloads:[[[Nr,Nr],(e,[t,r])=>t.evaluate(e)||r.evaluate(e)],[rf(Nr),(e,t)=>{for(const r of t)if(r.evaluate(e))return!0;return!1}]]},"!":[Nr,[Nr],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Nr,[Cr],(e,[t])=>{const r=e.globals&&e.globals.isSupportedScript;return!r||r(t.evaluate(e))}],upcase:[Cr,[Cr],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Cr,[Cr],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Cr,rf(sr),(e,t)=>t.map(r=>yc(r.evaluate(e))).join("")],"resolved-locale":[Cr,[Ma],(e,[t])=>t.evaluate(e).resolvedLocale()],random:[In,[In,In,sr],(e,t)=>{const[r,s,a]=t.map(c=>c.evaluate(e));if(r>s||r===s)return r;let u;if("string"==typeof a)u=function(c){let p=0;if(0===c.length)return p;for(let g=0;g<c.length;g++)p=(p<<5)-p+c.charCodeAt(g),p&=p;return p}(a);else{if("number"!=typeof a)throw new qr(`Invalid seed input: ${a}`);u=a}return r+Ps(u)()*(s-r)}]});var a_=Aa;function nT(e){return{result:"success",value:e}}function Jd(e){return{result:"error",value:e}}function of(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function uu(e){return"data-driven"===e["property-type"]}function rT(e){return of(e.expression,"measure-light")}function Ub(e){return of(e.expression,"zoom")}function ja(e){return!!e.expression&&e.expression.interpolated}function Bf(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function ic(e){return e}function L0(e,t){const r="color"===t.type,s=e.stops&&"object"==typeof e.stops[0][0],a=s||!(s||void 0!==e.property),u=e.type||(ja(t)?"exponential":"interval");if(r&&((e=Mi({},e)).stops&&(e.stops=e.stops.map(y=>[y[0],pn.parse(y[1])])),e.default=pn.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!rc[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let c,p,g;if("exponential"===u)c=l_;else if("interval"===u)c=Vb;else if("categorical"===u){c=jb,p=Object.create(null);for(const y of e.stops)p[y[0]]=y[1];g=typeof e.stops[0][0]}else{if("identity"!==u)throw new Error(`Unknown function type "${u}"`);c=Gb}if(s){const y={},x=[];for(let M=0;M<e.stops.length;M++){const D=e.stops[M],P=D[0].zoom;void 0===y[P]&&(y[P]={zoom:P,type:e.type,property:e.property,default:e.default,stops:[]},x.push(P)),y[P].stops.push([D[0].value,D[1]])}const E=[];for(const M of x)E.push([y[M].zoom,L0(y[M],t)]);const S={name:"linear"};return{kind:"composite",interpolationType:S,interpolationFactor:ca.interpolationFactor.bind(void 0,S),zoomStops:E.map(M=>M[0]),evaluate:({zoom:M},D)=>l_({stops:E,base:e.base},t,M).evaluate(M,D)}}if(a){const y="exponential"===u?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:y,interpolationFactor:ca.interpolationFactor.bind(void 0,y),zoomStops:e.stops.map(x=>x[0]),evaluate:({zoom:x})=>c(e,t,x,p,g)}}return{kind:"source",evaluate(y,x){const E=x&&x.properties?x.properties[e.property]:void 0;return void 0===E?Kd(e.default,t.default):c(e,t,E,p,g)}}}function Kd(e,t,r){return void 0!==e?e:void 0!==t?t:void 0!==r?r:void 0}function jb(e,t,r,s,a){return Kd(typeof r===a?s[r]:void 0,e.default,t.default)}function Vb(e,t,r){if("number"!==ar(r))return Kd(e.default,t.default);const s=e.stops.length;if(1===s||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[s-1][0])return e.stops[s-1][1];const a=is(e.stops.map(u=>u[0]),r);return e.stops[a][1]}function l_(e,t,r){const s=void 0!==e.base?e.base:1;if("number"!==ar(r))return Kd(e.default,t.default);const a=e.stops.length;if(1===a||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[a-1][0])return e.stops[a-1][1];const u=is(e.stops.map(x=>x[0]),r),c=function(x,E,S,M){const D=M-S,P=x-S;return 0===D?0:1===E?P/D:(Math.pow(E,P)-1)/(Math.pow(E,D)-1)}(r,s,e.stops[u][0],e.stops[u+1][0]),p=e.stops[u][1],g=e.stops[u+1][1];let y=cr[t.type]||ic;if(e.colorSpace&&"rgb"!==e.colorSpace){const x=rc[e.colorSpace];y=(E,S)=>x.reverse(x.interpolate(x.forward(E),x.forward(S),c))}return"function"==typeof p.evaluate?{evaluate(...x){const E=p.evaluate.apply(void 0,x),S=g.evaluate.apply(void 0,x);if(void 0!==E&&void 0!==S)return y(E,S,c)}}:y(p,g,c)}function Gb(e,t,r){return"color"===t.type?r=pn.parse(r):"formatted"===t.type?r=Fo.fromString(r.toString()):"resolvedImage"===t.type?r=gi.fromString(r.toString()):ar(r)===t.type||"enum"===t.type&&t.values[r]||(r=void 0),Kd(r,e.default,t.default)}class Em{constructor(t,r,s){var a;this.expression=t,this._warningHistory={},this._evaluator=new Gs(s),this._defaultValue=r?"color"===(a=r).type&&(Bf(a.default)||Array.isArray(a.default))?new pn(0,0,0,0):"color"===a.type?pn.parse(a.default)||null:void 0===a.default?null:a.default:null,this._enumValues=r&&"enum"===r.type?r.values:null}evaluateWithoutErrorHandling(t,r,s,a,u,c,p,g){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=a||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=c,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=g||null,this.expression.evaluate(this._evaluator)}evaluate(t,r,s,a,u,c,p,g){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=c||null,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=g||null;try{const y=this.expression.evaluate(this._evaluator);if(null==y||"number"==typeof y&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new qr(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function Qd(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in a_}function Mh(e,t,r){const s=new Ch(a_,[],t?function(u){const c={color:Vs,string:Cr,number:In,enum:Cr,boolean:Nr,formatted:ur,resolvedImage:ns};return"array"===u.type?Wi(c[u.value]||sr,u.length):c[u.type]}(t):void 0,void 0,void 0,r),a=s.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return a?nT(new Em(a,t,r)):Jd(s.errors)}class u_{constructor(t,r,s){this.kind=t,this._styleExpression=r,this.isLightConstant=s,this.isStateDependent="constant"!==t&&!zo(r.expression),this.isConfigDependent=!Wr(r.expression)}evaluateWithoutErrorHandling(t,r,s,a,u,c){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,a,u,c)}evaluate(t,r,s,a,u,c){return this._styleExpression.evaluate(t,r,s,a,u,c)}}class Th{constructor(t,r,s,a,u){this.kind=t,this.zoomStops=s,this._styleExpression=r,this.isStateDependent="camera"!==t&&!zo(r.expression),this.isLightConstant=u,this.isConfigDependent=!Wr(r.expression),this.interpolationType=a}evaluateWithoutErrorHandling(t,r,s,a,u,c){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,a,u,c)}evaluate(t,r,s,a,u,c){return this._styleExpression.evaluate(t,r,s,a,u,c)}interpolationFactor(t,r,s){return this.interpolationType?ca.interpolationFactor(this.interpolationType,t,r,s):0}}function tp(e,t,r){if("error"===(e=Mh(e,t,r)).result)return e;const s=e.value.expression,a=$o(s);if(!a&&!uu(t))return Jd([new Gi("","data expressions not supported")]);const u=Oo(s,["zoom","pitch","distance-from-center"]);if(!u&&!Ub(t))return Jd([new Gi("","zoom expressions not supported")]);const c=Oo(s,["measure-light"]);if(!c&&!rT(t))return Jd([new Gi("","measure-light expression not supported")]);const p=t.expression&&t.expression.relaxZoomRestriction,g=Dh(s);return g||u||p?g instanceof Gi?Jd([g]):g instanceof ca&&!ja(t)?Jd([new Gi("",'"interpolate" expressions cannot be used with this property')]):nT(g?new Th(a?"camera":"composite",e.value,g.labels,g instanceof ca?g.interpolation:void 0,c):new u_(a?"constant":"source",e.value,c)):Jd([new Gi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class sf{constructor(t,r){this._parameters=t,this._specification=r,Mi(this,L0(this._parameters,this._specification))}static deserialize(t){return new sf(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Dh(e){let t=null;if(e instanceof Ou)t=Dh(e.result);else if(e instanceof ci){for(const r of e.args)if(t=Dh(r),t)break}else(e instanceof zf||e instanceof ca)&&e.input instanceof Ns&&"zoom"===e.input.name&&(t=e);return t instanceof Gi||e.eachChild(r=>{const s=Dh(r);s instanceof Gi?t=s:t&&s&&t!==s&&(t=new Gi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Fu(e){const t=e.key,r=e.value,s=e.valueSpec||{},a=e.objectElementValidators||{},u=e.style,c=e.styleSpec;let p=[];const g=ar(r);if("object"!==g)return[new Ne(t,r,`object expected, ${g} found`)];for(const y in r){const x=y.split(".")[0];let E;a[x]?E=a[x]:s[x]?E=Pa:a["*"]?E=a["*"]:s["*"]&&(E=Pa),E?p=p.concat(E({key:(t&&`${t}.`)+y,value:r[y],valueSpec:s[x]||s["*"],style:u,styleSpec:c,object:r,objectKey:y},r)):p.push(new Pi(t,r[y],`unknown property "${y}"`))}for(const y in s)a[y]||s[y].required&&void 0===s[y].default&&void 0===r[y]&&p.push(new Ne(t,r,`missing required property "${y}"`));return p}function iT(e){const t=e.value,r=e.valueSpec,s=e.style,a=e.styleSpec,u=e.key,c=e.arrayElementValidator||Pa;if("array"!==ar(t))return[new Ne(u,t,`array expected, ${ar(t)} found`)];if(r.length&&t.length!==r.length)return[new Ne(u,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Ne(u,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let p={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};a.$version<7&&(p.function=r.function),"object"===ar(r.value)&&(p=r.value);let g=[];for(let y=0;y<t.length;y++)g=g.concat(c({array:t,arrayIndex:y,value:t[y],valueSpec:p,style:s,styleSpec:a,key:`${u}[${y}]`},!0));return g}function oT(e){const t=e.key,r=e.value,s=e.valueSpec;let a=ar(r);if("number"===a&&r!=r&&(a="NaN"),"number"!==a)return[new Ne(t,r,`number expected, ${a} found`)];if("minimum"in s){let u=s.minimum;if("array"===ar(s.minimum)&&(u=s.minimum[e.arrayIndex]),r<u)return[new Ne(t,r,`${r} is less than the minimum value ${u}`)]}if("maximum"in s){let u=s.maximum;if("array"===ar(s.maximum)&&(u=s.maximum[e.arrayIndex]),r>u)return[new Ne(t,r,`${r} is greater than the maximum value ${u}`)]}return[]}function sT(e){const t=e.valueSpec,r=zn(e.value.type);let s,a,u,c={};const p="categorical"!==r&&void 0===e.value.property,g=!p,y="array"===ar(e.value.stops)&&"array"===ar(e.value.stops[0])&&"object"===ar(e.value.stops[0][0]),x=Fu({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(M){if("identity"===r)return[new Ne(M.key,M.value,'identity function may not have a "stops" property')];let D=[];const P=M.value;return D=D.concat(iT({key:M.key,value:P,valueSpec:M.valueSpec,style:M.style,styleSpec:M.styleSpec,arrayElementValidator:E})),"array"===ar(P)&&0===P.length&&D.push(new Ne(M.key,P,"array must have at least one stop")),D},default:function(M){return Pa({key:M.key,value:M.value,valueSpec:t,style:M.style,styleSpec:M.styleSpec})}}});return"identity"===r&&p&&x.push(new Ne(e.key,e.value,'missing required property "property"')),"identity"===r||e.value.stops||x.push(new Ne(e.key,e.value,'missing required property "stops"')),"exponential"===r&&e.valueSpec.expression&&!ja(e.valueSpec)&&x.push(new Ne(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(g&&!uu(e.valueSpec)?x.push(new Ne(e.key,e.value,"property functions not supported")):p&&!Ub(e.valueSpec)&&x.push(new Ne(e.key,e.value,"zoom functions not supported"))),"categorical"!==r&&!y||void 0!==e.value.property||x.push(new Ne(e.key,e.value,'"property" property is required')),x;function E(M){let D=[];const P=M.value,O=M.key;if("array"!==ar(P))return[new Ne(O,P,`array expected, ${ar(P)} found`)];if(2!==P.length)return[new Ne(O,P,`array length 2 expected, length ${P.length} found`)];if(y){if("object"!==ar(P[0]))return[new Ne(O,P,`object expected, ${ar(P[0])} found`)];if(void 0===P[0].zoom)return[new Ne(O,P,"object stop key must have zoom")];if(void 0===P[0].value)return[new Ne(O,P,"object stop key must have value")];const R=zn(P[0].zoom);if("number"!=typeof R)return[new Ne(O,P[0].zoom,"stop zoom values must be numbers")];if(u&&u>R)return[new Ne(O,P[0].zoom,"stop zoom values must appear in ascending order")];R!==u&&(u=R,a=void 0,c={}),D=D.concat(Fu({key:`${O}[0]`,value:P[0],valueSpec:{zoom:{}},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{zoom:oT,value:S}}))}else D=D.concat(S({key:`${O}[0]`,value:P[0],valueSpec:{},style:M.style,styleSpec:M.styleSpec},P));return Qd(Qa(P[1]))?D.concat([new Ne(`${O}[1]`,P[1],"expressions are not allowed in function stops.")]):D.concat(Pa({key:`${O}[1]`,value:P[1],valueSpec:t,style:M.style,styleSpec:M.styleSpec}))}function S(M,D){const P=ar(M.value),O=zn(M.value),R=null!==M.value?M.value:D;if(s){if(P!==s)return[new Ne(M.key,R,`${P} stop domain type must match previous stop domain type ${s}`)]}else s=P;if("number"!==P&&"string"!==P&&"boolean"!==P&&"number"!=typeof O&&"string"!=typeof O&&"boolean"!=typeof O)return[new Ne(M.key,R,"stop domain value must be a number, string, or boolean")];if("number"!==P&&"categorical"!==r){let B=`number expected, ${P} found`;return uu(t)&&void 0===r&&(B+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ne(M.key,R,B)]}return"categorical"!==r||"number"!==P||"number"==typeof O&&isFinite(O)&&Math.floor(O)===O?"categorical"!==r&&"number"===P&&"number"==typeof O&&"number"==typeof a&&void 0!==a&&O<a?[new Ne(M.key,R,"stop domain values must appear in ascending order")]:(a=O,"categorical"===r&&O in c?[new Ne(M.key,R,"stop domain values must be unique")]:(c[O]=!0,[])):[new Ne(M.key,R,`integer expected, found ${String(O)}`)]}}function Uf(e){const t=("property"===e.expressionContext?tp:Mh)(Qa(e.value),e.valueSpec);if("error"===t.result)return t.value.map(s=>new Ne(`${e.key}${s.key}`,e.value,s.message));const r=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!r.outputDefined())return[new Ne(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!zo(r))return[new Ne(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return qb(r,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Oo(r,["zoom","feature-state"]))return[new Ne(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!$o(r))return[new Ne(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function qb(e,t){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const a of t.valueSpec.expression.parameters)r.delete(a);if(0===r.size)return[];const s=[];return e instanceof Ns&&r.has(e.name)?[new Ne(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild(a=>{s.push(...qb(a,t))}),s)}function O0(e){const t=e.key,r=e.value,s=e.valueSpec,a=[];return Array.isArray(s.values)?-1===s.values.indexOf(zn(r))&&a.push(new Ne(t,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(s.values).indexOf(zn(r))&&a.push(new Ne(t,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),a}function c_(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!c_(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function ep(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};c_(e)||(e=Cm(e));const r=e;let s=!0;try{s=function(y){if(!Im(y))return y;let x=Qa(y);return h_(x),x=$b(x),x}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(r,null,2)}\n        `)}const a=It[`filter_${t}`],u=Mh(s,a);let c=null;if("error"===u.result)throw new Error(u.value.map(y=>`${y.key}: ${y.message}`).join(", "));c=(y,x,E)=>u.value.evaluate(y,x,{},E);let p=null,g=null;if(s!==r){const y=Mh(r,a);if("error"===y.result)throw new Error(y.value.map(x=>`${x.key}: ${x.message}`).join(", "));p=(x,E,S,M,D)=>y.value.evaluate(x,E,{},S,void 0,void 0,M,D),g=!$o(y.value.expression)}return{filter:c,dynamicFilter:p||void 0,needGeometry:R0(s),needFeature:!!g}}function $b(e){if(!Array.isArray(e))return e;const t=function(r){if(jL.has(r[0]))for(let s=1;s<r.length;s++)if(Im(r[s]))return!0;return r}(e);return!0===t?t:t.map(r=>$b(r))}function h_(e){let t=!1;const r=[];if("case"===e[0]){for(let s=1;s<e.length-1;s+=2)t=t||Im(e[s]),r.push(e[s+1]);r.push(e[e.length-1])}else if("match"===e[0]){t=t||Im(e[1]);for(let s=2;s<e.length-1;s+=2)r.push(e[s+1]);r.push(e[e.length-1])}else if("step"===e[0]){t=t||Im(e[1]);for(let s=1;s<e.length-1;s+=2)r.push(e[s+1])}t&&(e.length=0,e.push("any",...r));for(let s=1;s<e.length;s++)h_(e[s])}function Im(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let r=1;r<e.length;r++)if(Im(e[r]))return!0;return!1}const jL=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function aT(e,t){return e<t?-1:e>t?1:0}function R0(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(R0(e[t]))return!0;return!1}function Cm(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?N0(e[1],e[2],"=="):"!="===t?Sm(N0(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?N0(e[1],e[2],t):"any"===t?(r=e.slice(1),["any"].concat(r.map(Cm))):"all"===t?["all"].concat(e.slice(1).map(Cm)):"none"===t?["all"].concat(e.slice(1).map(Cm).map(Sm)):"in"===t?Hb(e[1],e.slice(2)):"!in"===t?Sm(Hb(e[1],e.slice(2))):"has"===t?Zb(e[1]):"!has"!==t||Sm(Zb(e[1]));var r}function N0(e,t,r){switch(e){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,e,t]}}function Hb(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",e,["literal",t.sort(aT)]]:["filter-in-small",e,["literal",t]]}}function Zb(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Sm(e){return["!",e]}function F0(e){return c_(Qa(e.value))?Uf(Mi({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):k0(e)}function k0(e){const t=e.value,r=e.key;if("array"!==ar(t))return[new Ne(r,t,`array expected, ${ar(t)} found`)];const s=e.styleSpec;let a,u=[];if(t.length<1)return[new Ne(r,t,"filter array must have at least 1 element")];switch(u=u.concat(O0({key:`${r}[0]`,value:t[0],valueSpec:s.filter_operator,style:e.style,styleSpec:e.styleSpec})),zn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===zn(t[1])&&u.push(new Ne(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&u.push(new Ne(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(a=ar(t[1]),"string"!==a&&u.push(new Ne(`${r}[1]`,t[1],`string expected, ${a} found`)));for(let c=2;c<t.length;c++)a=ar(t[c]),"$type"===zn(t[1])?u=u.concat(O0({key:`${r}[${c}]`,value:t[c],valueSpec:s.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==a&&"number"!==a&&"boolean"!==a&&u.push(new Ne(`${r}[${c}]`,t[c],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let c=1;c<t.length;c++)u=u.concat(k0({key:`${r}[${c}]`,value:t[c],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":a=ar(t[1]),2!==t.length?u.push(new Ne(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==a&&u.push(new Ne(`${r}[1]`,t[1],`string expected, ${a} found`))}return u}function Wb(e,t){const r=e.key,s=e.style,a=e.layer,u=e.styleSpec,c=e.value,p=e.objectKey,g=u[`${t}_${e.layerType}`];if(!g)return[];const y=p.match(/^(.*)-transition$/);if("paint"===t&&y&&g[y[1]]&&g[y[1]].transition)return Pa({key:r,value:c,valueSpec:u.transition,style:s,styleSpec:u});const x=e.valueSpec||g[p];if(!x)return[new Pi(r,c,`unknown property "${p}"`)];let E;if("string"===ar(c)&&uu(x)&&!x.tokens&&(E=/^{([^}]+)}$/.exec(c))){const M=`\`{ "type": "identity", "property": ${E?JSON.stringify(E[1]):'"_"'} }\``;return[new Ne(r,c,`"${p}" does not support interpolation syntax\nUse an identity property function instead: ${M}.`)]}const S=[];if("symbol"===e.layerType)"text-field"!==p||!s||s.glyphs||s.imports||S.push(new Ne(r,c,'use of "text-field" requires a style "glyphs" property')),"text-font"===p&&Bf(Qa(c))&&"identity"===zn(c.type)&&S.push(new Ne(r,c,'"text-font" does not support identity functions'));else if("model"===e.layerType&&"paint"===t&&a&&a.layout&&a.layout.hasOwnProperty("model-id")&&uu(x)&&(rT(x)||Ub(x))){const M=tp(Qa(c),x),D=M.value.expression||M.value._styleExpression.expression;D&&!Oo(D,["measure-light"])&&("model-emissive-strength"===p&&$o(D)&&zo(D)||S.push(new Ne(r,c,`${p} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return S.concat(Pa({key:e.key,value:c,valueSpec:x,style:s,styleSpec:u,expressionContext:"property",propertyType:t,propertyKey:p}))}function lT(e){return Wb(e,"paint")}function Xb(e){return Wb(e,"layout")}function Mm(e){let t=[];const r=e.value,s=e.key,a=e.style,u=e.styleSpec;r.type||r.ref||t.push(new Ne(s,r,'either "type" or "ref" is required'));let c=zn(r.type);const p=zn(r.ref);if(r.id){const g=zn(r.id);for(let y=0;y<e.arrayIndex;y++){const x=a.layers[y];zn(x.id)===g&&t.push(new Ne(s,r.id,`duplicate layer id "${r.id}", previously used at line ${x.id.__line__}`))}}if("ref"in r){let g;["type","source","source-layer","filter","layout"].forEach(y=>{y in r&&t.push(new Ne(s,r[y],`"${y}" is prohibited for ref layers`))}),a.layers.forEach(y=>{zn(y.id)===p&&(g=y)}),g?g.ref?t.push(new Ne(s,r.ref,"ref cannot reference another ref layer")):c=zn(g.type):"string"==typeof p&&t.push(new Ne(s,r.ref,`ref layer "${p}" not found`))}else if("background"!==c&&"sky"!==c&&"slot"!==c)if(r.source){const g=a.sources&&a.sources[r.source],y=g&&zn(g.type);g?"vector"===y&&"raster"===c?t.push(new Ne(s,r.source,`layer "${r.id}" requires a raster source`)):"raster"===y&&"raster"!==c?t.push(new Ne(s,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==y||r["source-layer"]?"raster-dem"===y&&"hillshade"!==c?t.push(new Ne(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==c||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||"geojson"===y&&g.lineMetrics||t.push(new Ne(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ne(s,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new Ne(s,r.source,`source "${r.source}" not found`))}else t.push(new Ne(s,r,'missing required property "source"'));return t=t.concat(Fu({key:s,value:r,valueSpec:u.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Pa({key:`${s}.type`,value:r.type,valueSpec:u.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"}),filter:g=>F0(Mi({layerType:c},g)),layout:g=>Fu({layer:r,key:g.key,value:g.value,valueSpec:{},style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":y=>Xb(Mi({layerType:c},y))}}),paint:g=>Fu({layer:r,key:g.key,value:g.value,valueSpec:{},style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":y=>lT(Mi({layerType:c,layer:r},y))}})}})),t}function jf(e){const t=e.value,r=e.key,s=ar(t);return"string"!==s?[new Ne(r,t,`string expected, ${s} found`)]:[]}const Yb={promoteId:function({key:e,value:t}){if("string"===ar(t))return jf({key:e,value:t});{const r=[];for(const s in t)r.push(...jf({key:`${e}.${s}`,value:t[s]}));return r}}};function Jb(e){const t=e.value,r=e.key,s=e.styleSpec,a=e.style;if(!t.type)return[new Ne(r,t,'"type" is required')];const u=zn(t.type);let c=[];switch(["vector","raster","raster-dem"].includes(u)&&(t.url||t.tiles||c.push(new Ne(r,t,'Either "url" or "tiles" is required.'))),u){case"vector":case"raster":case"raster-dem":return c=c.concat(Fu({key:r,value:t,valueSpec:s[`source_${u.replace("-","_")}`],style:e.style,styleSpec:s,objectElementValidators:Yb})),c;case"geojson":if(c=Fu({key:r,value:t,valueSpec:s.source_geojson,style:a,styleSpec:s,objectElementValidators:Yb}),t.cluster)for(const p in t.clusterProperties){const[g,y]=t.clusterProperties[p],x="string"==typeof g?[g,["accumulated"],["get",p]]:g;c.push(...Uf({key:`${r}.${p}.map`,value:y,expressionContext:"cluster-map"})),c.push(...Uf({key:`${r}.${p}.reduce`,value:x,expressionContext:"cluster-reduce"}))}return c;case"video":return Fu({key:r,value:t,valueSpec:s.source_video,style:a,styleSpec:s});case"image":return Fu({key:r,value:t,valueSpec:s.source_image,style:a,styleSpec:s});case"canvas":return[new Ne(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return O0({key:`${r}.type`,value:t.type,valueSpec:{values:Kb(s)},style:a,styleSpec:s})}}function Kb(e){return e.source.reduce((t,r)=>{const s=e[r];return"enum"===s.type.type&&(t=t.concat(Object.keys(s.type.values))),t},[])}function z0(e){const t=e.value;let r=[];if(!t)return r;const s=ar(t);return"string"!==s?(r=r.concat([new Ne(e.key,t,`string expected, "${s}" found`)]),r):(function(a){const u=-1===a.indexOf("://");try{return new URL(a,u?"http://example.com":void 0),!0}catch{return!1}}(t)||(r=r.concat([new Ne(e.key,t,`invalid url "${t}"`)])),r)}function Qb(e){const t=e.value,r=e.styleSpec,s=r.light,a=e.style;let u=[];const c=ar(t);if(void 0===t)return u;if("object"!==c)return u=u.concat([new Ne("light",t,`object expected, ${c} found`)]),u;for(const p in t){const g=p.match(/^(.*)-transition$/);u=u.concat(g&&s[g[1]]&&s[g[1]].transition?Pa({key:p,value:t[p],valueSpec:r.transition,style:a,styleSpec:r}):s[p]?Pa({key:p,value:t[p],valueSpec:s[p],style:a,styleSpec:r}):[new Ne(p,t[p],`unknown property "${p}"`)])}return u}function f_(e){const t=e.value;let r=[];if(!t)return r;const s=ar(t);if("object"!==s)return r=r.concat([new Ne("light-3d",t,`object expected, ${s} found`)]),r;const a=e.styleSpec,u=a["light-3d"],c=e.key,p=e.style,g=e.style.lights;for(const E of["type","id"])if(!(E in t))return r=r.concat([new Ne("light-3d",t,`missing property ${E} on light`)]),r;if(t.type&&g)for(let E=0;E<e.arrayIndex;E++){const S=zn(t.type),M=g[E];zn(M.type)===S&&r.push(new Ne(c,t.id,`duplicate light type "${t.type}", previously defined at line ${M.id.__line__}`))}const y=`properties_light_${t.type}`;if(!(y in a))return r=r.concat([new Ne("light-3d",t,`Invalid light type ${t.type}`)]),r;const x=a[y];for(const E in t)if("properties"===E){const S=t[E],M=ar(S);if("object"!==M)return r=r.concat([new Ne("properties",S,`object expected, ${M} found`)]),r;for(const D in S)r=r.concat(x[D]?Pa({key:D,value:S[D],valueSpec:x[D],style:p,styleSpec:a}):[new Pi(e.key,S[D],`unknown property "${D}"`)])}else{const S=E.match(/^(.*)-transition$/);r=r.concat(S&&u[S[1]]&&u[S[1]].transition?Pa({key:E,value:t[E],valueSpec:a.transition,style:p,styleSpec:a}):u[E]?Pa({key:E,value:t[E],valueSpec:u[E],style:p,styleSpec:a}):[new Pi(E,t[E],`unknown property "${E}"`)])}return r}function tw(e){const t=e.value,r=e.key,s=e.style,a=e.styleSpec,u=a.terrain;let c=[];const p=ar(t);if(void 0===t||"null"===p)return c;if("object"!==p)return c=c.concat([new Ne("terrain",t,`object expected, ${p} found`)]),c;for(const g in t){const y=g.match(/^(.*)-transition$/);c=c.concat(y&&u[y[1]]&&u[y[1]].transition?Pa({key:g,value:t[g],valueSpec:a.transition,style:s,styleSpec:a}):u[g]?Pa({key:g,value:t[g],valueSpec:u[g],style:s,styleSpec:a}):[new Pi(g,t[g],`unknown property "${g}"`)])}if(t.source){const g=s.sources&&s.sources[t.source],y=g&&zn(g.type);g?"raster-dem"!==y&&c.push(new Ne(r,t.source,`terrain cannot be used with a source of type ${String(y)}, it only be used with a "raster-dem" source type`)):c.push(new Ne(r,t.source,`source "${t.source}" not found`))}else c.push(new Ne(r,t,'terrain is missing required property "source"'));return c}function Ic(e){const t=e.value,r=e.style,s=e.styleSpec,a=s.fog;let u=[];const c=ar(t);if(void 0===t)return u;if("object"!==c)return u=u.concat([new Ne("fog",t,`object expected, ${c} found`)]),u;for(const p in t){const g=p.match(/^(.*)-transition$/);u=u.concat(g&&a[g[1]]&&a[g[1]].transition?Pa({key:p,value:t[p],valueSpec:s.transition,style:r,styleSpec:s}):a[p]?Pa({key:p,value:t[p],valueSpec:a[p],style:r,styleSpec:s}):[new Pi(p,t[p],`unknown property "${p}"`)])}return u}const B0={"*":()=>[],array:iT,boolean:function(e){const t=e.value,r=e.key,s=ar(t);return"boolean"!==s?[new Ne(r,t,`boolean expected, ${s} found`)]:[]},number:oT,color:function(e){const t=e.key,r=e.value,s=ar(r);return"string"!==s?[new Ne(t,r,`color expected, ${s} found`)]:null===Ys(r)?[new Ne(t,r,`color expected, "${r}" found`)]:[]},enum:O0,filter:F0,function:sT,layer:Mm,object:Fu,source:Jb,model:z0,light:Qb,"light-3d":f_,terrain:tw,fog:Ic,string:jf,formatted:function(e){return 0===jf(e).length?[]:Uf(e)},resolvedImage:function(e){return 0===jf(e).length?[]:Uf(e)},projection:function(e){const t=e.value,r=e.styleSpec,s=r.projection,a=e.style;let u=[];const c=ar(t);if("object"===c)for(const p in t)u=u.concat(Pa({key:p,value:t[p],valueSpec:s[p],style:a,styleSpec:r}));else"string"!==c&&(u=u.concat([new Ne("projection",t,`object or string expected, ${c} found`)]));return u},import:function(e){const{value:t,styleSpec:r}=e,{data:s,...a}=t;Object.defineProperty(a,"__line__",{value:t.__line__,enumerable:!1});let u=Fu(Mi({},e,{value:a,valueSpec:r.import}));return""===zn(a.id)&&u.push(new Ne(`${e.key}.id`,a,"import id can't be an empty string")),s&&(u=u.concat(d_(s,r,{key:`${e.key}.data`}))),u}};function Pa(e,t=!1){const r=e.value,s=e.valueSpec,a=e.styleSpec;if(s.expression&&Bf(zn(r)))return sT(e);if(s.expression&&Qd(Qa(r)))return Uf(e);if(s.type&&B0[s.type]){const u=B0[s.type](e);return!0===t&&u.length>0&&"array"===ar(e.value)?Uf(e):u}return Fu(Mi({},e,{valueSpec:s.type?a[s.type]:s}))}function ks(e){const t=e.value,r=e.key,s=jf(e);return s.length||(-1===t.indexOf("{fontstack}")&&s.push(new Ne(r,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&s.push(new Ne(r,t,'"glyphs" url must include a "{range}" token'))),s}function d_(e,t=It,r={}){return Pa({key:r.key||"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:ks,"*":()=>[]}})}function Ah(e,t=It){return Cc(d_(e,t))}const cu=e=>Cc(Jb(e)),uT=e=>Cc(Qb(e)),ew=e=>Cc(f_(e)),np=e=>Cc(tw(e)),ku=e=>Cc(Ic(e)),cT=e=>Cc(Mm(e)),U0=e=>Cc(F0(e)),hT=e=>Cc(lT(e)),af=e=>Cc(Xb(e)),nw=e=>Cc(z0(e));function Cc(e){return e.slice().sort((t,r)=>t.line&&r.line?t.line-r.line:0)}function Tm(e,t){let r=!1;if(t&&t.length)for(const s of t)s instanceof Pi?Gt(s.message):(e.fire(new Oe(new Error(s.message))),r=!0);return r}var rw=Yc,Ph=3;function Yc(e,t,r){var s=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var a=new Int32Array(this.arrayBuffer);e=a[0],this.d=(t=a[1])+2*(r=a[2]);for(var u=0;u<this.d*this.d;u++){var c=a[Ph+u],p=a[Ph+u+1];s.push(c===p?null:a.subarray(c,p))}var g=a[Ph+s.length+1];this.keys=a.subarray(a[Ph+s.length],g),this.bboxes=a.subarray(g),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var y=0;y<this.d*this.d;y++)s.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var x=r/t*e;this.min=-x,this.max=e+x}Yc.prototype.insert=function(e,t,r,s,a){this._forEachCell(t,r,s,a,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(a)},Yc.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Yc.prototype._insertCell=function(e,t,r,s,a,u){this.cells[a].push(u)},Yc.prototype.query=function(e,t,r,s,a){var u=this.min,c=this.max;if(e<=u&&t<=u&&c<=r&&c<=s&&!a)return Array.prototype.slice.call(this.keys);var p=[];return this._forEachCell(e,t,r,s,this._queryCell,p,{},a),p},Yc.prototype._queryCell=function(e,t,r,s,a,u,c,p){var g=this.cells[a];if(null!==g)for(var y=this.keys,x=this.bboxes,E=0;E<g.length;E++){var S=g[E];if(void 0===c[S]){var M=4*S;(p?p(x[M+0],x[M+1],x[M+2],x[M+3]):e<=x[M+2]&&t<=x[M+3]&&r>=x[M+0]&&s>=x[M+1])?(c[S]=!0,u.push(y[S])):c[S]=!1}}},Yc.prototype._forEachCell=function(e,t,r,s,a,u,c,p){for(var g=this._convertToCellCoord(e),y=this._convertToCellCoord(t),x=this._convertToCellCoord(r),E=this._convertToCellCoord(s),S=g;S<=x;S++)for(var M=y;M<=E;M++){var D=this.d*M+S;if((!p||p(this._convertFromCellCoord(S),this._convertFromCellCoord(M),this._convertFromCellCoord(S+1),this._convertFromCellCoord(M+1)))&&a.call(this,e,t,r,s,D,u,c,p))return}},Yc.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Yc.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Yc.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=Ph+this.cells.length+1+1,r=0,s=0;s<this.cells.length;s++)r+=this.cells[s].length;var a=new Int32Array(t+r+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var u=t,c=0;c<e.length;c++){var p=e[c];a[Ph+c]=u,a.set(p,u),u+=p.length}return a[Ph+e.length]=u,a.set(this.keys,u),a[Ph+e.length+1]=u+=this.keys.length,a.set(this.bboxes,u),u+=this.bboxes.length,a.buffer};var $r=mt(rw);const Dm={};function Fn(e,t,r={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Dm[t]={klass:e,omit:r.omit||[]}}Fn(Object,"Object"),$r.serialize=function(e,t){const r=e.toArrayBuffer();return t&&t.add(r),{buffer:r}},$r.deserialize=function(e){return new $r(e.buffer)},Object.defineProperty($r,"name",{value:"Grid"}),Fn($r,"Grid"),Fn(pn,"Color"),Fn(Error,"Error"),Fn(lt,"AJAXError"),Fn(gi,"ResolvedImage"),Fn(sf,"StylePropertyFunction"),Fn(Em,"StyleExpression",{omit:["_evaluator"]}),Fn(Th,"ZoomDependentExpression"),Fn(u_,"ZoomConstantExpression"),Fn(Ns,"CompoundExpression",{omit:["_evaluate"]});for(const e in a_)Dm[a_[e]._classRegistryKey]||Fn(a_[e],`Expression${e}`);function iw(e){return e&&typeof ArrayBuffer<"u"&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function ow(e){return rt.ImageBitmap&&e instanceof rt.ImageBitmap}function rp(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(iw(e)||ow(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e)){const r=e;return t&&t.add(r.buffer),r}if(e instanceof rt.ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){const r=[];for(const s of e)r.push(rp(s,t));return r}if(e instanceof Map){const r={$name:"Map"};for(const[s,a]of e.entries())r[s]=rp(a);return r}if("object"==typeof e){const r=e.constructor,s=r._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const a=r.serialize?r.serialize(e,t):{};if(!r.serialize){for(const u in e)e.hasOwnProperty(u)&&(Dm[s].omit.indexOf(u)>=0||(a[u]=rp(e[u],t)));e instanceof Error&&(a.message=e.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(a.$name=s),a}throw new Error("can't serialize object of type "+typeof e)}function Vf(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||iw(e)||ow(e)||ArrayBuffer.isView(e)||e instanceof rt.ImageData)return e;if(Array.isArray(e))return e.map(Vf);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const a=new Map;for(const u of Object.keys(e))"$name"!==u&&a.set(u,Vf(e[u]));return a}const{klass:r}=Dm[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(e);const s=Object.create(r.prototype);for(const a of Object.keys(e))"$name"!==a&&(s[a]=Vf(e[a]));return s}throw new Error("can't deserialize object of type "+typeof e)}const kn={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function j0(e){for(const t of e)if(V0(t.charCodeAt(0)))return!0;return!1}function fT(e){for(const t of e)if(!dT(t.charCodeAt(0)))return!1;return!0}function dT(e){return!(kn.Arabic(e)||kn["Arabic Supplement"](e)||kn["Arabic Extended-A"](e)||kn["Arabic Presentation Forms-A"](e)||kn["Arabic Presentation Forms-B"](e))}function V0(e){return!(746!==e&&747!==e&&(e<4352||!(kn["Bopomofo Extended"](e)||kn.Bopomofo(e)||kn["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||kn["CJK Compatibility Ideographs"](e)||kn["CJK Compatibility"](e)||kn["CJK Radicals Supplement"](e)||kn["CJK Strokes"](e)||!(!kn["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||kn["CJK Unified Ideographs Extension A"](e)||kn["CJK Unified Ideographs"](e)||kn["Enclosed CJK Letters and Months"](e)||kn["Hangul Compatibility Jamo"](e)||kn["Hangul Jamo Extended-A"](e)||kn["Hangul Jamo Extended-B"](e)||kn["Hangul Jamo"](e)||kn["Hangul Syllables"](e)||kn.Hiragana(e)||kn["Ideographic Description Characters"](e)||kn.Kanbun(e)||kn["Kangxi Radicals"](e)||kn["Katakana Phonetic Extensions"](e)||kn.Katakana(e)&&12540!==e||!(!kn["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!kn["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||kn["Unified Canadian Aboriginal Syllabics"](e)||kn["Unified Canadian Aboriginal Syllabics Extended"](e)||kn["Vertical Forms"](e)||kn["Yijing Hexagram Symbols"](e)||kn["Yi Syllables"](e)||kn["Yi Radicals"](e))))}function sw(e){return!(V0(e)||(t=e,kn["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||kn["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||kn["Letterlike Symbols"](t)||kn["Number Forms"](t)||kn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||kn["Control Pictures"](t)&&9251!==t||kn["Optical Character Recognition"](t)||kn["Enclosed Alphanumerics"](t)||kn["Geometric Shapes"](t)||kn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||kn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||kn["CJK Symbols and Punctuation"](t)||kn.Katakana(t)||kn["Private Use Area"](t)||kn["CJK Compatibility Forms"](t)||kn["Small Form Variants"](t)||kn["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t));var t}function wn(e){return e>=1424&&e<=2303||kn["Arabic Presentation Forms-A"](e)||kn["Arabic Presentation Forms-B"](e)}function Uo(e,t){return!(!t&&wn(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||kn.Khmer(e))}function pT(e){for(const t of e)if(wn(t.charCodeAt(0)))return!0;return!1}const G0="deferred",Va="loading",p_="loaded";let Gf=null,fa="unavailable",Jc=null;const m_=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(fa="error"),Gf&&Gf(e)};function q0(){aw.fire(new Se("pluginStateChange",{pluginStatus:fa,pluginURL:Jc}))}const aw=new Qn,g_=function(){return fa},Ol=function(){if(fa!==G0||!Jc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");fa=Va,q0(),Jc&&je({url:Jc},e=>{e?m_(e):(fa=p_,q0())})},La={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>fa===p_||null!=La.applyArabicShaping,isLoading:()=>fa===Va,setState(e){fa=e.pluginStatus,Jc=e.pluginURL},isParsed:()=>null!=La.applyArabicShaping&&null!=La.processBidirectionalText&&null!=La.processStyledBidirectionalText,getPluginURL:()=>Jc};class ss{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(r,s){for(const a of r)if(!Uo(a.charCodeAt(0),s))return!1;return!0}(t,La.isLoaded())}}class Lh{constructor(t,r,s){this.property=t,this.value=r,this.expression=function(a,u,c){if(Bf(a))return new sf(a,u);if(Qd(a)||Array.isArray(a)&&a.length>0){const p=tp(a,u,c);if("error"===p.result)throw new Error(p.value.map(g=>`${g.key}: ${g.message}`).join(", "));return p.value}{let p=a;return"string"==typeof a&&"color"===u.type&&(p=pn.parse(a)),{kind:"constant",isConfigDependent:!1,evaluate:()=>p}}}(void 0===r?t.specification.default:r,t.specification,s)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,r,s){return this.property.possiblyEvaluate(this,t,r,s)}}class Sc{constructor(t,r){this.property=t,this.value=new Lh(t,void 0,r)}transitioned(t,r){return new $0(this.property,this.value,r,pe({},t.transition,this.transition),t.now)}untransitioned(){return new $0(this.property,this.value,null,{},0)}}class Am{constructor(t,r){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._options=r,this.isConfigDependent=!1}getValue(t){return st(this._values[t].value.value)}setValue(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new Sc(this._values[t].property,this._options)),this._values[t].value=new Lh(this._values[t].property,null===r?void 0:st(r),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,r){r&&(this._options=r);const s=this._properties.properties;if(t)for(const a in t){const u=t[a];if(Er(a,"-transition")){const c=a.slice(0,-11);s[c]&&this.setTransition(c,u)}else s[a]&&this.setValue(a,u)}}getTransition(t){return st(this._values[t].transition)}setTransition(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new Sc(this._values[t].property)),this._values[t].transition=st(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);void 0!==s&&(t[r]=s);const a=this.getTransition(r);void 0!==a&&(t[`${r}-transition`]=a)}return t}transitioned(t,r){const s=new lw(this._properties);for(const a of Object.keys(this._values))s._values[a]=this._values[a].transitioned(t,r._values[a]);return s}untransitioned(){const t=new lw(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class $0{constructor(t,r,s,a,u){const c=a.delay||0,p=a.duration||0;u=u||0,this.property=t,this.value=r,this.begin=u+c,this.end=this.begin+p,t.specification.transition&&(a.delay||a.duration)&&(this.prior=s)}possiblyEvaluate(t,r,s){const a=t.now||0,u=this.value.possiblyEvaluate(t,r,s),c=this.prior;if(c){if(a>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(a<this.begin)return c.possiblyEvaluate(t,r,s);{const p=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(c.possiblyEvaluate(t,r,s),u,cn(p))}}return u}}class lw{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,s){const a=new qf(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].possiblyEvaluate(t,r,s);return a}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class mT{constructor(t,r){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._options=r,this.isConfigDependent=!1}getValue(t){return st(this._values[t].value)}setValue(t,r){this._values[t]=new Lh(this._values[t].property,null===r?void 0:st(r),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);void 0!==s&&(t[r]=s)}return t}possiblyEvaluate(t,r,s){const a=new qf(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].possiblyEvaluate(t,r,s);return a}}class lf{constructor(t,r,s){this.property=t,this.value=r,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,r,s,a){return this.property.evaluate(this.value,this.parameters,t,r,s,a)}}class qf{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class un{constructor(t){this.specification=t}possiblyEvaluate(t,r){return t.expression.evaluate(r)}interpolate(t,r,s){const a=cr[this.specification.type];return a?a(t,r,s):t}}class Xn{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,s,a){return new lf(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(r,null,{},s,a)}:t.expression,r)}interpolate(t,r,s){if("constant"!==t.value.kind||"constant"!==r.value.kind)return t;if(void 0===t.value.value||void 0===r.value.value)return new lf(this,{kind:"constant",value:void 0},t.parameters);const a=cr[this.specification.type];return a?new lf(this,{kind:"constant",value:a(t.value.value,r.value.value,s)},t.parameters):t}evaluate(t,r,s,a,u,c){return"constant"===t.kind?t.value:t.evaluate(r,s,a,u,c)}}class Pm{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,a){return!!t.expression.evaluate(r,null,{},s,a)}interpolate(){return!1}}class ys{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new ss(0,{});for(const s in t){const a=t[s];a.specification.overridable&&this.overridableProperties.push(s);const u=this.defaultPropertyValues[s]=new Lh(a,void 0),c=this.defaultTransitionablePropertyValues[s]=new Sc(a);this.defaultTransitioningPropertyValues[s]=c.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=u.possiblyEvaluate(r)}}}Fn(Xn,"DataDrivenProperty"),Fn(un,"DataConstantProperty"),Fn(Pm,"ColorRampProperty");function H0(e){return e.indexOf("\x1f")>=0}function ul(e,t){return t?`${e}\x1f${t}`:e}function Lm(e){const t=e.indexOf("\x1f");return t>=0?e.slice(0,t):e}const Z0="-transition";class $l extends Qn{constructor(t,r,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&"slot"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),this.options=s,t.slot&&(this.slot=t.slot),r.layout&&(this._unevaluatedLayout=new mT(r.layout,s),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),r.paint)){this._transitionablePaint=new Am(r.paint,s);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new qf(r.paint)}}setScope(t){this.scope=t,this.fqid=ul(this.id,t)}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,s={}){if(null!=r&&this._validate(af,`layers.${this.id}.layout.${t}`,t,r,s))return;if("custom"===this.type&&"visibility"===t)return void(this.visibility=r);const a=this._unevaluatedLayout;a._properties.properties[t]&&(a.setValue(t,r),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,"visibility"===t&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return Er(t,Z0)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,s={}){if(null!=r&&this._validate(hT,`layers.${this.id}.paint.${t}`,t,r,s))return!1;const a=this._transitionablePaint,u=a._properties.properties;if(Er(t,Z0)){const S=t.slice(0,-11);return u[S]&&a.setTransition(S,r||void 0),!1}if(!u[t])return!1;const c=a._values[t],p=c.value.isDataDriven(),g=c.value;a.setValue(t,r),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);const y=a._values[t].value,x=y.isDataDriven(),E=Er(t,"pattern")||"line-dasharray"===t;return x||p||E||this._handleOverridablePaintPropertyUpdate(t,g,y)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,r){return null}_handleOverridablePaintPropertyUpdate(t,r,s){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){return Te({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,r)=>!(void 0===t||"layout"===r&&!Object.keys(t).length||"paint"===r&&!Object.keys(t).length))}_validate(t,r,s,a,u={}){return(!u||!1!==u.validate)&&Tm(this,t.call(Ah,{key:r,layerType:this.type,objectKey:s,value:a,styleSpec:It,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof lf&&uu(r.property.specification)&&("source"===r.value.kind||"composite"===r.value.kind)&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ep(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}class gT{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,r){this._updatedSourceCaches[t]=r,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const r=t.scope;this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._updatedLayers[r].add(t.id),this.setDirty()}removeLayer(t){const r=t.scope;this._removedLayers[r]=this._removedLayers[r]||{},this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._removedLayers[r][t.id]=t,this._updatedLayers[r].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const r in this._updatedLayers)t[r]=t[r]||{},t[r].updatedIds=Array.from(this._updatedLayers[r].values());for(const r in this._removedLayers)t[r]=t[r]||{},t[r].removedIds=Object.keys(this._removedLayers[r]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const _T={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class cl{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ao{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function yr(e,t=1){let r=0,s=0;return{members:e.map(a=>{const u=_T[a.type].BYTES_PER_ELEMENT,c=r=uw(r,Math.max(t,u)),p=a.components||1;return s=Math.max(s,u),r+=u*p,{name:a.name,type:a.type,components:p,offset:c}}),size:uw(r,Math.max(s,t)),alignment:t}}function uw(e,t){return Math.ceil(e/t)*t}class hu extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const a=2*t;return this.int16[a+0]=r,this.int16[a+1]=s,t}}hu.prototype.bytesPerElement=4,Fn(hu,"StructArrayLayout2i4");class __ extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,r,s)}emplace(t,r,s,a){const u=3*t;return this.int16[u+0]=r,this.int16[u+1]=s,this.int16[u+2]=a,t}}__.prototype.bytesPerElement=6,Fn(__,"StructArrayLayout3i6");class $f extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,s,a)}emplace(t,r,s,a,u){const c=4*t;return this.int16[c+0]=r,this.int16[c+1]=s,this.int16[c+2]=a,this.int16[c+3]=u,t}}$f.prototype.bytesPerElement=8,Fn($f,"StructArrayLayout4i8");class y_ extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,a,u){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s,a,u)}emplace(t,r,s,a,u,c){const p=5*t;return this.int16[p+0]=r,this.int16[p+1]=s,this.int16[p+2]=a,this.int16[p+3]=u,this.int16[p+4]=c,t}}y_.prototype.bytesPerElement=10,Fn(y_,"StructArrayLayout5i10");class v_ extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,a,u,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,s,a,u,c,p)}emplace(t,r,s,a,u,c,p,g){const y=6*t,x=12*t,E=3*t;return this.int16[y+0]=r,this.int16[y+1]=s,this.uint8[x+4]=a,this.uint8[x+5]=u,this.uint8[x+6]=c,this.uint8[x+7]=p,this.float32[E+2]=g,t}}v_.prototype.bytesPerElement=12,Fn(v_,"StructArrayLayout2i4ub1f12");class oc extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,s,a)}emplace(t,r,s,a,u){const c=4*t;return this.float32[c+0]=r,this.float32[c+1]=s,this.float32[c+2]=a,this.float32[c+3]=u,t}}oc.prototype.bytesPerElement=16,Fn(oc,"StructArrayLayout4f16");class Hl extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,a,u){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s,a,u)}emplace(t,r,s,a,u,c){const p=6*t,g=3*t;return this.uint16[p+0]=r,this.uint16[p+1]=s,this.uint16[p+2]=a,this.uint16[p+3]=u,this.float32[g+2]=c,t}}Hl.prototype.bytesPerElement=12,Fn(Hl,"StructArrayLayout4ui1f12");class x_ extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,s,a)}emplace(t,r,s,a,u){const c=4*t;return this.uint16[c+0]=r,this.uint16[c+1]=s,this.uint16[c+2]=a,this.uint16[c+3]=u,t}}x_.prototype.bytesPerElement=8,Fn(x_,"StructArrayLayout4ui8");class Hf extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,a,u,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,s,a,u,c)}emplace(t,r,s,a,u,c,p){const g=6*t;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=a,this.int16[g+3]=u,this.int16[g+4]=c,this.int16[g+5]=p,t}}Hf.prototype.bytesPerElement=12,Fn(Hf,"StructArrayLayout6i12");class op extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,a,u,c,p,g,y,x,E,S){const M=this.length;return this.resize(M+1),this.emplace(M,t,r,s,a,u,c,p,g,y,x,E,S)}emplace(t,r,s,a,u,c,p,g,y,x,E,S,M){const D=12*t;return this.int16[D+0]=r,this.int16[D+1]=s,this.int16[D+2]=a,this.int16[D+3]=u,this.uint16[D+4]=c,this.uint16[D+5]=p,this.uint16[D+6]=g,this.uint16[D+7]=y,this.int16[D+8]=x,this.int16[D+9]=E,this.int16[D+10]=S,this.int16[D+11]=M,t}}op.prototype.bytesPerElement=24,Fn(op,"StructArrayLayout4i4ui4i24");class sp extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,a,u,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,s,a,u,c)}emplace(t,r,s,a,u,c,p){const g=10*t,y=5*t;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=a,this.float32[y+2]=u,this.float32[y+3]=c,this.float32[y+4]=p,t}}sp.prototype.bytesPerElement=20,Fn(sp,"StructArrayLayout3i3f20");class Om extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}Om.prototype.bytesPerElement=4,Fn(Om,"StructArrayLayout1ul4");class Oh extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const a=2*t;return this.uint16[a+0]=r,this.uint16[a+1]=s,t}}Oh.prototype.bytesPerElement=4,Fn(Oh,"StructArrayLayout2ui4");class b_ extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,a,u,c,p,g,y,x,E,S,M){const D=this.length;return this.resize(D+1),this.emplace(D,t,r,s,a,u,c,p,g,y,x,E,S,M)}emplace(t,r,s,a,u,c,p,g,y,x,E,S,M,D){const P=20*t,O=10*t;return this.int16[P+0]=r,this.int16[P+1]=s,this.int16[P+2]=a,this.int16[P+3]=u,this.int16[P+4]=c,this.float32[O+3]=p,this.float32[O+4]=g,this.float32[O+5]=y,this.float32[O+6]=x,this.int16[P+14]=E,this.uint32[O+8]=S,this.uint16[P+18]=M,this.uint16[P+19]=D,t}}b_.prototype.bytesPerElement=40,Fn(b_,"StructArrayLayout5i4f1i1ul2ui40");class w_ extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,a,u,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,s,a,u,c,p)}emplace(t,r,s,a,u,c,p,g){const y=8*t;return this.int16[y+0]=r,this.int16[y+1]=s,this.int16[y+2]=a,this.int16[y+4]=u,this.int16[y+5]=c,this.int16[y+6]=p,this.int16[y+7]=g,t}}w_.prototype.bytesPerElement=16,Fn(w_,"StructArrayLayout3i2i2i16");class uf extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,a,u){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s,a,u)}emplace(t,r,s,a,u,c){const p=4*t,g=8*t;return this.float32[p+0]=r,this.float32[p+1]=s,this.float32[p+2]=a,this.int16[g+6]=u,this.int16[g+7]=c,t}}uf.prototype.bytesPerElement=16,Fn(uf,"StructArrayLayout2f1f2i16");class Zf extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,s,a)}emplace(t,r,s,a,u){const c=12*t,p=3*t;return this.uint8[c+0]=r,this.uint8[c+1]=s,this.float32[p+1]=a,this.float32[p+2]=u,t}}Zf.prototype.bytesPerElement=12,Fn(Zf,"StructArrayLayout2ub2f12");class ea extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,r,s)}emplace(t,r,s,a){const u=3*t;return this.uint16[u+0]=r,this.uint16[u+1]=s,this.uint16[u+2]=a,t}}ea.prototype.bytesPerElement=6,Fn(ea,"StructArrayLayout3ui6");class cw extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O,R,B,j,V,U){const G=this.length;return this.resize(G+1),this.emplace(G,t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O,R,B,j,V,U)}emplace(t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O,R,B,j,V,U,G){const Z=30*t,Q=15*t,et=60*t;return this.int16[Z+0]=r,this.int16[Z+1]=s,this.int16[Z+2]=a,this.float32[Q+2]=u,this.float32[Q+3]=c,this.uint16[Z+8]=p,this.uint16[Z+9]=g,this.uint32[Q+5]=y,this.uint32[Q+6]=x,this.uint32[Q+7]=E,this.uint16[Z+16]=S,this.uint16[Z+17]=M,this.uint16[Z+18]=D,this.float32[Q+10]=P,this.float32[Q+11]=O,this.uint8[et+48]=R,this.uint8[et+49]=B,this.uint8[et+50]=j,this.uint32[Q+13]=V,this.int16[Z+28]=U,this.uint8[et+58]=G,t}}cw.prototype.bytesPerElement=60,Fn(cw,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Rm extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O,R,B,j,V,U,G,Z,Q,et,it,yt,xt,Nt,ft,Ut,Wt){const le=this.length;return this.resize(le+1),this.emplace(le,t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O,R,B,j,V,U,G,Z,Q,et,it,yt,xt,Nt,ft,Ut,Wt)}emplace(t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O,R,B,j,V,U,G,Z,Q,et,it,yt,xt,Nt,ft,Ut,Wt,le){const Bt=20*t,Zt=40*t,ge=80*t;return this.float32[Bt+0]=r,this.float32[Bt+1]=s,this.int16[Zt+4]=a,this.int16[Zt+5]=u,this.int16[Zt+6]=c,this.int16[Zt+7]=p,this.int16[Zt+8]=g,this.int16[Zt+9]=y,this.int16[Zt+10]=x,this.int16[Zt+11]=E,this.int16[Zt+12]=S,this.uint16[Zt+13]=M,this.uint16[Zt+14]=D,this.uint16[Zt+15]=P,this.uint16[Zt+16]=O,this.uint16[Zt+17]=R,this.uint16[Zt+18]=B,this.uint16[Zt+19]=j,this.uint16[Zt+20]=V,this.uint16[Zt+21]=U,this.uint16[Zt+22]=G,this.uint16[Zt+23]=Z,this.uint16[Zt+24]=Q,this.uint16[Zt+25]=et,this.uint16[Zt+26]=it,this.uint16[Zt+27]=yt,this.uint32[Bt+14]=xt,this.float32[Bt+15]=Nt,this.float32[Bt+16]=ft,this.float32[Bt+17]=Ut,this.float32[Bt+18]=Wt,this.uint8[ge+76]=le,t}}Rm.prototype.bytesPerElement=80,Fn(Rm,"StructArrayLayout2f9i15ui1ul4f1ub80");class E_ extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}E_.prototype.bytesPerElement=4,Fn(E_,"StructArrayLayout1f4");class Wf extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,a,u){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s,a,u)}emplace(t,r,s,a,u,c){const p=5*t;return this.float32[p+0]=r,this.float32[p+1]=s,this.float32[p+2]=a,this.float32[p+3]=u,this.float32[p+4]=c,t}}Wf.prototype.bytesPerElement=20,Fn(Wf,"StructArrayLayout5f20");class W0 extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,a,u,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,s,a,u,c,p)}emplace(t,r,s,a,u,c,p,g){const y=7*t;return this.float32[y+0]=r,this.float32[y+1]=s,this.float32[y+2]=a,this.float32[y+3]=u,this.float32[y+4]=c,this.float32[y+5]=p,this.float32[y+6]=g,t}}W0.prototype.bytesPerElement=28,Fn(W0,"StructArrayLayout7f28");class hw extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,s,a)}emplace(t,r,s,a,u){const c=6*t;return this.uint32[3*t+0]=r,this.uint16[c+2]=s,this.uint16[c+3]=a,this.uint16[c+4]=u,t}}hw.prototype.bytesPerElement=12,Fn(hw,"StructArrayLayout1ul3ui12");class I_ extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}I_.prototype.bytesPerElement=2,Fn(I_,"StructArrayLayout1ui2");class Rh extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,r,s)}emplace(t,r,s,a){const u=3*t;return this.float32[u+0]=r,this.float32[u+1]=s,this.float32[u+2]=a,t}}Rh.prototype.bytesPerElement=12,Fn(Rh,"StructArrayLayout3f12");class Nh extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const a=2*t;return this.float32[a+0]=r,this.float32[a+1]=s,t}}Nh.prototype.bytesPerElement=8,Fn(Nh,"StructArrayLayout2f8");class X0 extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O){const R=this.length;return this.resize(R+1),this.emplace(R,t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O)}emplace(t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O,R){const B=16*t;return this.float32[B+0]=r,this.float32[B+1]=s,this.float32[B+2]=a,this.float32[B+3]=u,this.float32[B+4]=c,this.float32[B+5]=p,this.float32[B+6]=g,this.float32[B+7]=y,this.float32[B+8]=x,this.float32[B+9]=E,this.float32[B+10]=S,this.float32[B+11]=M,this.float32[B+12]=D,this.float32[B+13]=P,this.float32[B+14]=O,this.float32[B+15]=R,t}}X0.prototype.bytesPerElement=64,Fn(X0,"StructArrayLayout16f64");class cf extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,a,u,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,s,a,u,c,p)}emplace(t,r,s,a,u,c,p,g){const y=10*t,x=5*t;return this.uint16[y+0]=r,this.uint16[y+1]=s,this.uint16[y+2]=a,this.uint16[y+3]=u,this.float32[x+2]=c,this.float32[x+3]=p,this.float32[x+4]=g,t}}cf.prototype.bytesPerElement=20,Fn(cf,"StructArrayLayout4ui3f20");class Nm extends Ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint8[1*t+0]=r,t}}Nm.prototype.bytesPerElement=1,Fn(Nm,"StructArrayLayout1ub1");class Fm extends cl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Fm.prototype.size=40;class fw extends b_{get(t){return new Fm(this,t)}}Fn(fw,"CollisionBoxArray");class Y0 extends cl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}Y0.prototype.size=60;class J0 extends cw{get(t){return new Y0(this,t)}}Fn(J0,"PlacedSymbolArray");class dw extends cl{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}dw.prototype.size=80;class Mc extends Rm{get(t){return new dw(this,t)}}Fn(Mc,"SymbolInstanceArray");class pw extends E_{getoffsetX(t){return this.float32[1*t+0]}}Fn(pw,"GlyphOffsetArray");class km extends hu{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Fn(km,"SymbolLineVertexArray");class C_ extends cl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}C_.prototype.size=12;class K0 extends hw{get(t){return new C_(this,t)}}Fn(K0,"FeatureIndexArray");class zm extends Oh{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Fn(zm,"FillExtrusionCentroidArray");const Q0=yr([{name:"a_pos",components:2,type:"Int16"}],4),yT=yr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ui{constructor(t=[]){this.segments=t}_prepareSegment(t,r,s,a){let u=this.segments[this.segments.length-1];return t>Ui.MAX_VERTEX_ARRAY_LENGTH&&Gt(`Max vertices per segment is ${Ui.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!u||u.vertexLength+t>Ui.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==a)&&(u={vertexOffset:r,primitiveOffset:s,vertexLength:0,primitiveLength:0},void 0!==a&&(u.sortKey=a),this.segments.push(u)),u}prepareSegment(t,r,s,a){return this._prepareSegment(t,r.length,s.length,a)}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,s,a){return new Ui([{vertexOffset:t,primitiveOffset:r,vertexLength:s,primitiveLength:a,vaos:{},sortKey:0}])}}function tv(e,t){return 256*(e=At(Math.floor(e),0,255))+At(Math.floor(t),0,255)}Ui.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fn(Ui,"SegmentVector");const mw=yr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),gw=yr([{name:"a_dash",components:4,type:"Uint16"}]);var S_={exports:{}},Xf={exports:function(t,r){var s,a,u,c,p,g,y,x;for(a=t.length-(s=3&t.length),u=r,p=3432918353,g=461845907,x=0;x<a;)y=255&t.charCodeAt(x)|(255&t.charCodeAt(++x))<<8|(255&t.charCodeAt(++x))<<16|(255&t.charCodeAt(++x))<<24,++x,u=27492+(65535&(c=5*(65535&(u=(u^=y=(65535&(y=(y=(65535&y)*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*g+(((y>>>16)*g&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(c>>>16)&65535)<<16);switch(y=0,s){case 3:y^=(255&t.charCodeAt(x+2))<<16;case 2:y^=(255&t.charCodeAt(x+1))<<8;case 1:u^=y=(65535&(y=(y=(65535&(y^=255&t.charCodeAt(x)))*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*g+(((y>>>16)*g&65535)<<16)&4294967295}return u^=t.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}}.exports,_w={exports:{}};_w.exports=function(t,r){for(var s,a=t.length,u=r^a,c=0;a>=4;)s=1540483477*(65535&(s=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24))+((1540483477*(s>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),a-=4,++c;switch(a){case 3:u^=(255&t.charCodeAt(c+2))<<16;case 2:u^=(255&t.charCodeAt(c+1))<<8;case 1:u=1540483477*(65535&(u^=255&t.charCodeAt(c)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var ev=Xf,yw=_w.exports;S_.exports=ev,S_.exports.murmur3=ev,S_.exports.murmur2=yw;var Yf=mt(S_.exports);class Um{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,r,s,a){this.ids.push(Rl(t)),this.positions.push(r,s,a)}eachPosition(t,r){const s=Rl(t);let a=0,u=this.ids.length-1;for(;a<u;){const c=a+u>>1;this.ids[c]>=s?u=c:a=c+1}for(;this.ids[a]===s;)r(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(t,r){const s=new Float64Array(t.ids),a=new Uint32Array(t.positions);return nv(s,a,0,s.length-1),r&&(r.add(s.buffer),r.add(a.buffer)),{ids:s,positions:a}}static deserialize(t){const r=new Um;let s;r.ids=t.ids,r.positions=t.positions;for(const a of r.ids)a!==s&&r.uniqueIds.push(a),s=a;return r.indexed=!0,r}}function Rl(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Yf(String(e))}function nv(e,t,r,s){for(;r<s;){const a=e[r+s>>1];let u=r-1,c=s+1;for(;;){do{u++}while(e[u]<a);do{c--}while(e[c]>a);if(u>=c)break;M_(e,u,c),M_(t,3*u,3*c),M_(t,3*u+1,3*c+1),M_(t,3*u+2,3*c+2)}c-r<s-c?(nv(e,t,r,c),r=c+1):(nv(e,t,c+1,s),s=c)}}function M_(e,t,r){const s=e[t];e[t]=e[r],e[r]=s}Fn(Um,"FeaturePositionMap");class Tc{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,r),this.initialized=!0),!!this.location}}class Gr extends Tc{constructor(t){super(t),this.current=0}set(t,r,s){this.fetchUniformLocation(t,r)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class ln extends Tc{constructor(t){super(t),this.current=0}set(t,r,s){this.fetchUniformLocation(t,r)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Fr extends Tc{constructor(t){super(t),this.current=[0,0]}set(t,r,s){this.fetchUniformLocation(t,r)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class vr extends Tc{constructor(t){super(t),this.current=[0,0,0]}set(t,r,s){this.fetchUniformLocation(t,r)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class Ga extends Tc{constructor(t){super(t),this.current=[0,0,0,0]}set(t,r,s){this.fetchUniformLocation(t,r)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class Dc extends Tc{constructor(t){super(t),this.current=pn.transparent}set(t,r,s){this.fetchUniformLocation(t,r)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const vw=new Float32Array(16);class br extends Tc{constructor(t){super(t),this.current=vw}set(t,r,s){if(this.fetchUniformLocation(t,r)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let a=1;a<16;a++)if(s[a]!==this.current[a]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const ap=new Float32Array(9);class xw extends Tc{constructor(t){super(t),this.current=ap}set(t,r,s){if(this.fetchUniformLocation(t,r))for(let a=0;a<9;a++)if(s[a]!==this.current[a]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}const vT=new Float32Array(4);class bw extends Tc{constructor(t){super(t),this.current=vT}set(t,r,s){if(this.fetchUniformLocation(t,r))for(let a=0;a<4;a++)if(s[a]!==this.current[a]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}function ww(e){return[tv(255*e.r,255*e.g),tv(255*e.b,255*e.a)]}class T_{constructor(t,r,s){this.value=t,this.uniformNames=r.map(a=>`u_${a}`),this.type=s}setUniform(t,r,s,a,u){r.set(t,u,a.constantOr(this.value))}getBinding(t,r){return"color"===this.type?new Dc(t):new ln(t)}}class jm{constructor(t,r){this.uniformNames=r.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,r,s,a,u){const c="u_pattern"===u||"u_dash"===u?this.pattern:"u_pixel_ratio"===u?this.pixelRatio:null;c&&r.set(t,u,c)}getBinding(t,r){return"u_pattern"===r||"u_dash"===r?new Ga(t):new ln(t)}}class hf{constructor(t,r,s,a){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(u=>({name:`a_${u}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(t,r,s,a,u,c,p){const g=this.paintVertexArray.length,y=this.expression.evaluate(new ss(0,{brightness:c}),r,{},u,a,p);this.paintVertexArray.resize(t),this._setPaintValue(g,t,y)}updatePaintArray(t,r,s,a,u,c,p){const g=this.expression.evaluate({zoom:0,brightness:p},s,a,void 0,u);this._setPaintValue(t,r,g)}_setPaintValue(t,r,s){if("color"===this.type){const a=ww(s);for(let u=t;u<r;u++)this.paintVertexArray.emplace(u,a[0],a[1])}else{for(let a=t;a<r;a++)this.paintVertexArray.emplace(a,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Kc{constructor(t,r,s,a,u,c){this.expression=t,this.uniformNames=r.map(p=>`u_${p}_t`),this.type=s,this.useIntegerZoom=a,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=r.map(p=>({name:`a_${p}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new c}populatePaintArray(t,r,s,a,u,c,p){const g=this.expression.evaluate(new ss(this.zoom,{brightness:c}),r,{},u,a,p),y=this.expression.evaluate(new ss(this.zoom+1,{brightness:c}),r,{},u,a,p),x=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(x,t,g,y)}updatePaintArray(t,r,s,a,u,c,p){const g=this.expression.evaluate({zoom:this.zoom,brightness:p},s,a,void 0,u),y=this.expression.evaluate({zoom:this.zoom+1,brightness:p},s,a,void 0,u);this._setPaintValue(t,r,g,y)}_setPaintValue(t,r,s,a){if("color"===this.type){const u=ww(s),c=ww(a);for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,u[0],u[1],c[0],c[1])}else{for(let u=t;u<r;u++)this.paintVertexArray.emplace(u,s,a);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r,s,a,u){const c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,p=At(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);r.set(t,u,p)}getBinding(t,r){return new ln(t)}}class zu{constructor(t,r,s,a,u){this.expression=t,this.layerId=u,this.paintVertexAttributes=("array"===s?gw:mw).members;for(let c=0;c<r.length;++c);this.paintVertexArray=new a}populatePaintArray(t,r,s){const a=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(a,t,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(t,r,s,a,u,c,p){this._setPaintValues(t,r,s.patterns&&s.patterns[this.layerId],c)}_setPaintValues(t,r,s,a){if(!a||!s)return;const u=a[s];if(!u)return;const{tl:c,br:p,pixelRatio:g}=u;for(let y=t;y<r;y++)this.paintVertexArray.emplace(y,c[0],c[1],p[0],p[1],g)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Jf{constructor(t,r,s=(()=>!0)){this.binders={},this._buffers=[];const a=[];for(const u in t.paint._values){const c=t.paint.get(u);if(!s(u)||!(c instanceof lf&&uu(c.property.specification)))continue;const p=xT(u,t.type),g=c.value,y=c.property.specification.type,x=!!c.property.useIntegerZoom,E="line-dasharray"===u||u.endsWith("pattern"),S="line-dasharray"===u&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==g.kind||S)if("source"===g.kind||S||E){const M=Bu(u,y,"source");this.binders[u]=E?new zu(g,p,y,M,t.id):new hf(g,p,y,M),a.push(`/a_${u}`)}else{const M=Bu(u,y,"composite");this.binders[u]=new Kc(g,p,y,x,r,M),a.push(`/z_${u}`)}else this.binders[u]=E?new jm(g.value,p):new T_(g.value,p,y),a.push(`/u_${u}`)}this.cacheKey=a.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof hf||r instanceof Kc?r.maxValue:0}populatePaintArrays(t,r,s,a,u,c,p){for(const g in this.binders){const y=this.binders[g];(y instanceof hf||y instanceof Kc||y instanceof zu)&&y.populatePaintArray(t,r,s,a,u,c,p)}}setConstantPatternPositions(t){for(const r in this.binders){const s=this.binders[r];s instanceof jm&&s.setConstantPatternPositions(t)}}updatePaintArrays(t,r,s,a,u,c,p,g){let y=!1;const x=Object.keys(t),E=0!==x.length,S=E?x:r.uniqueIds;for(const M in this.binders){const D=this.binders[M];if((D instanceof hf||D instanceof Kc||D instanceof zu)&&(!0===D.expression.isStateDependent||!1===D.expression.isLightConstant)){const P=u.paint.get(M);D.expression=P.value;for(const O of S){const R=t[O.toString()];r.eachPosition(O,(B,j,V)=>{const U=a.feature(B);D.updatePaintArray(j,V,U,R,c,p,g)})}if(!E)for(const O of s.uniqueIds){const R=t[O.toString()];s.eachPosition(O,(B,j,V)=>{const U=a.feature(B);D.updatePaintArray(j,V,U,R,c,p,g)})}y=!0}}return y}defines(){const t=[];for(const r in this.binders){const s=this.binders[r];(s instanceof T_||s instanceof jm)&&t.push(...s.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof hf||s instanceof Kc||s instanceof zu)for(let a=0;a<s.paintVertexAttributes.length;a++)t.push(s.paintVertexAttributes[a].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof T_||s instanceof jm||s instanceof Kc)for(const a of s.uniformNames)t.push(a)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const r=[];for(const s in this.binders){const a=this.binders[s];if(a instanceof T_||a instanceof jm||a instanceof Kc)for(const u of a.uniformNames)r.push({name:u,property:s,binding:a.getBinding(t,u)})}return r}setUniforms(t,r,s,a,u){for(const{name:c,property:p,binding:g}of s)this.binders[p].setUniform(t,g,u,a.get(p),c)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const r=this.binders[t];(r instanceof hf||r instanceof Kc||r instanceof zu)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(t){for(const r in this.binders){const s=this.binders[r];(s instanceof hf||s instanceof Kc||s instanceof zu)&&s.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof hf||r instanceof Kc||r instanceof zu)&&r.destroy()}}}class ff{constructor(t,r,s=(()=>!0)){this.programConfigurations={};for(const a of t)this.programConfigurations[a.id]=new Jf(a,r,s);this.needsUpload=!1,this._featureMap=new Um,this._featureMapWithoutIds=new Um,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,r,s,a,u,c,p,g){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(t,r,a,u,c,p,g);void 0!==r.id?this._featureMap.add(r.id,s,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,s,a,u,c){for(const p of s)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,r,p,a,u,c||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const qa={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function xT(e,t){return qa[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const Vm={"line-pattern":{source:Hl,composite:Hl},"fill-pattern":{source:Hl,composite:Hl},"fill-extrusion-pattern":{source:Hl,composite:Hl},"line-dasharray":{source:x_,composite:x_}},bT={color:{source:Nh,composite:oc},number:{source:E_,composite:Nh}};function Bu(e,t,r){const s=Vm[e];return s&&s[r]||bT[t][r]}Fn(T_,"ConstantBinder"),Fn(jm,"PatternConstantBinder"),Fn(hf,"SourceExpressionBinder"),Fn(zu,"PatternCompositeBinder"),Fn(Kc,"CompositeExpressionBinder"),Fn(Jf,"ProgramConfiguration",{omit:["_buffers"]}),Fn(ff,"ProgramConfigurationSet");class $a{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof pr?new pr(t.lng,t.lat):pr.convert(t),this}setSouthWest(t){return this._sw=t instanceof pr?new pr(t.lng,t.lat):pr.convert(t),this}extend(t){const r=this._sw,s=this._ne;let a,u;if(t instanceof pr)a=t,u=t;else{if(!(t instanceof $a))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend($a.convert(t)):this.extend(pr.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(pr.convert(t)):this;if(a=t._sw,u=t._ne,!a||!u)return this}return r||s?(r.lng=Math.min(a.lng,r.lng),r.lat=Math.min(a.lat,r.lat),s.lng=Math.max(u.lng,s.lng),s.lat=Math.max(u.lat,s.lat)):(this._sw=new pr(a.lng,a.lat),this._ne=new pr(u.lng,u.lat)),this}getCenter(){return new pr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new pr(this.getWest(),this.getNorth())}getSouthEast(){return new pr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:s}=pr.convert(t);let a=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&a}static convert(t){return!t||t instanceof $a?t:new $a(t)}}var xa={},na={};Object.defineProperty(na,"__esModule",{value:!0}),na.setMatrixArrayType=function(e){na.ARRAY_TYPE=Ew=e},na.toRadian=function(e){return e*wT},na.equals=function(e,t){return Math.abs(e-t)<=lp*Math.max(1,Math.abs(e),Math.abs(t))},na.RANDOM=na.ARRAY_TYPE=na.EPSILON=void 0;var lp=1e-6;na.EPSILON=lp;var Ew=typeof Float32Array<"u"?Float32Array:Array;na.ARRAY_TYPE=Ew;var VL=Math.random;na.RANDOM=VL;var wT=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var vs={};function Zl(e){return(Zl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(vs,"__esModule",{value:!0}),vs.create=function(){var e=new Qc.ARRAY_TYPE(4);return Qc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},vs.clone=function(e){var t=new Qc.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},vs.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},vs.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},vs.fromValues=function(e,t,r,s){var a=new Qc.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=s,a},vs.set=function(e,t,r,s,a){return e[0]=t,e[1]=r,e[2]=s,e[3]=a,e},vs.transpose=function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},vs.invert=function(e,t){var r=t[0],s=t[1],a=t[2],u=t[3],c=r*u-a*s;return c?(e[0]=u*(c=1/c),e[1]=-s*c,e[2]=-a*c,e[3]=r*c,e):null},vs.adjoint=function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},vs.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},vs.multiply=ET,vs.rotate=function(e,t,r){var s=t[0],a=t[1],u=t[2],c=t[3],p=Math.sin(r),g=Math.cos(r);return e[0]=s*g+u*p,e[1]=a*g+c*p,e[2]=s*-p+u*g,e[3]=a*-p+c*g,e},vs.scale=function(e,t,r){var s=t[1],a=t[2],u=t[3],c=r[0],p=r[1];return e[0]=t[0]*c,e[1]=s*c,e[2]=a*p,e[3]=u*p,e},vs.fromRotation=function(e,t){var r=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=r,e[2]=-r,e[3]=s,e},vs.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},vs.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},vs.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},vs.LDU=function(e,t,r,s){return e[2]=s[2]/s[0],r[0]=s[0],r[1]=s[1],r[3]=s[3]-e[2]*r[1],[e,t,r]},vs.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},vs.subtract=rv,vs.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},vs.equals=function(e,t){var r=e[0],s=e[1],a=e[2],u=e[3],c=t[0],p=t[1],g=t[2],y=t[3];return Math.abs(r-c)<=Qc.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-p)<=Qc.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-g)<=Qc.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(u-y)<=Qc.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))},vs.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},vs.multiplyScalarAndAdd=function(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e[2]=t[2]+r[2]*s,e[3]=t[3]+r[3]*s,e},vs.sub=vs.mul=void 0;var Qc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Zl(e)&&"function"!=typeof e)return{default:e};var r=Kf(void 0);if(r&&r.has(e))return r.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var c=a?Object.getOwnPropertyDescriptor(e,u):null;c&&(c.get||c.set)?Object.defineProperty(s,u,c):s[u]=e[u]}return s.default=e,r&&r.set(e,s),s}(na);function Kf(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Kf=function(s){return s?r:t})(e)}function ET(e,t,r){var s=t[0],a=t[1],u=t[2],c=t[3],p=r[0],g=r[1],y=r[2],x=r[3];return e[0]=s*p+u*g,e[1]=a*p+c*g,e[2]=s*y+u*x,e[3]=a*y+c*x,e}function rv(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}vs.mul=ET,vs.sub=rv;var xs={};function iv(e){return(iv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(xs,"__esModule",{value:!0}),xs.create=function(){var e=new th.ARRAY_TYPE(6);return th.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},xs.clone=function(e){var t=new th.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},xs.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},xs.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},xs.fromValues=function(e,t,r,s,a,u){var c=new th.ARRAY_TYPE(6);return c[0]=e,c[1]=t,c[2]=r,c[3]=s,c[4]=a,c[5]=u,c},xs.set=function(e,t,r,s,a,u,c){return e[0]=t,e[1]=r,e[2]=s,e[3]=a,e[4]=u,e[5]=c,e},xs.invert=function(e,t){var r=t[0],s=t[1],a=t[2],u=t[3],c=t[4],p=t[5],g=r*u-s*a;return g?(e[0]=u*(g=1/g),e[1]=-s*g,e[2]=-a*g,e[3]=r*g,e[4]=(a*p-u*c)*g,e[5]=(s*c-r*p)*g,e):null},xs.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},xs.multiply=Cw,xs.rotate=function(e,t,r){var s=t[0],a=t[1],u=t[2],c=t[3],p=t[4],g=t[5],y=Math.sin(r),x=Math.cos(r);return e[0]=s*x+u*y,e[1]=a*x+c*y,e[2]=s*-y+u*x,e[3]=a*-y+c*x,e[4]=p,e[5]=g,e},xs.scale=function(e,t,r){var s=t[1],a=t[2],u=t[3],c=t[4],p=t[5],g=r[0],y=r[1];return e[0]=t[0]*g,e[1]=s*g,e[2]=a*y,e[3]=u*y,e[4]=c,e[5]=p,e},xs.translate=function(e,t,r){var s=t[0],a=t[1],u=t[2],c=t[3],p=t[4],g=t[5],y=r[0],x=r[1];return e[0]=s,e[1]=a,e[2]=u,e[3]=c,e[4]=s*y+u*x+p,e[5]=a*y+c*x+g,e},xs.fromRotation=function(e,t){var r=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=r,e[2]=-r,e[3]=s,e[4]=0,e[5]=0,e},xs.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},xs.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},xs.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},xs.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},xs.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},xs.subtract=Sw,xs.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},xs.multiplyScalarAndAdd=function(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e[2]=t[2]+r[2]*s,e[3]=t[3]+r[3]*s,e[4]=t[4]+r[4]*s,e[5]=t[5]+r[5]*s,e},xs.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},xs.equals=function(e,t){var r=e[0],s=e[1],a=e[2],u=e[3],c=e[4],p=e[5],g=t[0],y=t[1],x=t[2],E=t[3],S=t[4],M=t[5];return Math.abs(r-g)<=th.EPSILON*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(s-y)<=th.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(a-x)<=th.EPSILON*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(u-E)<=th.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(c-S)<=th.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(p-M)<=th.EPSILON*Math.max(1,Math.abs(p),Math.abs(M))},xs.sub=xs.mul=void 0;var th=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==iv(e)&&"function"!=typeof e)return{default:e};var r=Iw(void 0);if(r&&r.has(e))return r.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var c=a?Object.getOwnPropertyDescriptor(e,u):null;c&&(c.get||c.set)?Object.defineProperty(s,u,c):s[u]=e[u]}return s.default=e,r&&r.set(e,s),s}(na);function Iw(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Iw=function(s){return s?r:t})(e)}function Cw(e,t,r){var s=t[0],a=t[1],u=t[2],c=t[3],p=t[4],g=t[5],y=r[0],x=r[1],E=r[2],S=r[3],M=r[4],D=r[5];return e[0]=s*y+u*x,e[1]=a*y+c*x,e[2]=s*E+u*S,e[3]=a*E+c*S,e[4]=s*M+u*D+p,e[5]=a*M+c*D+g,e}function Sw(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}xs.mul=Cw,xs.sub=Sw;var Hi={};function up(e){return(up="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(Hi,"__esModule",{value:!0}),Hi.create=function(){var e=new Uu.ARRAY_TYPE(9);return Uu.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},Hi.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},Hi.clone=function(e){var t=new Uu.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Hi.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Hi.fromValues=function(e,t,r,s,a,u,c,p,g){var y=new Uu.ARRAY_TYPE(9);return y[0]=e,y[1]=t,y[2]=r,y[3]=s,y[4]=a,y[5]=u,y[6]=c,y[7]=p,y[8]=g,y},Hi.set=function(e,t,r,s,a,u,c,p,g,y){return e[0]=t,e[1]=r,e[2]=s,e[3]=a,e[4]=u,e[5]=c,e[6]=p,e[7]=g,e[8]=y,e},Hi.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},Hi.transpose=function(e,t){if(e===t){var r=t[1],s=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=s,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},Hi.invert=function(e,t){var r=t[0],s=t[1],a=t[2],u=t[3],c=t[4],p=t[5],g=t[6],y=t[7],x=t[8],E=x*c-p*y,S=-x*u+p*g,M=y*u-c*g,D=r*E+s*S+a*M;return D?(e[0]=E*(D=1/D),e[1]=(-x*s+a*y)*D,e[2]=(p*s-a*c)*D,e[3]=S*D,e[4]=(x*r-a*g)*D,e[5]=(-p*r+a*u)*D,e[6]=M*D,e[7]=(-y*r+s*g)*D,e[8]=(c*r-s*u)*D,e):null},Hi.adjoint=function(e,t){var r=t[0],s=t[1],a=t[2],u=t[3],c=t[4],p=t[5],g=t[6],y=t[7],x=t[8];return e[0]=c*x-p*y,e[1]=a*y-s*x,e[2]=s*p-a*c,e[3]=p*g-u*x,e[4]=r*x-a*g,e[5]=a*u-r*p,e[6]=u*y-c*g,e[7]=s*g-r*y,e[8]=r*c-s*u,e},Hi.determinant=function(e){var t=e[3],r=e[4],s=e[5],a=e[6],u=e[7],c=e[8];return e[0]*(c*r-s*u)+e[1]*(-c*t+s*a)+e[2]*(u*t-r*a)},Hi.multiply=Mw,Hi.translate=function(e,t,r){var s=t[0],a=t[1],u=t[2],c=t[3],p=t[4],g=t[5],y=t[6],x=t[7],E=t[8],S=r[0],M=r[1];return e[0]=s,e[1]=a,e[2]=u,e[3]=c,e[4]=p,e[5]=g,e[6]=S*s+M*c+y,e[7]=S*a+M*p+x,e[8]=S*u+M*g+E,e},Hi.rotate=function(e,t,r){var s=t[0],a=t[1],u=t[2],c=t[3],p=t[4],g=t[5],y=t[6],x=t[7],E=t[8],S=Math.sin(r),M=Math.cos(r);return e[0]=M*s+S*c,e[1]=M*a+S*p,e[2]=M*u+S*g,e[3]=M*c-S*s,e[4]=M*p-S*a,e[5]=M*g-S*u,e[6]=y,e[7]=x,e[8]=E,e},Hi.scale=function(e,t,r){var s=r[0],a=r[1];return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Hi.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},Hi.fromRotation=function(e,t){var r=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=r,e[2]=0,e[3]=-r,e[4]=s,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},Hi.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},Hi.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},Hi.fromQuat=function(e,t){var r=t[0],s=t[1],a=t[2],u=t[3],c=r+r,p=s+s,g=a+a,y=r*c,x=s*c,E=s*p,S=a*c,M=a*p,D=a*g,P=u*c,O=u*p,R=u*g;return e[0]=1-E-D,e[3]=x-R,e[6]=S+O,e[1]=x+R,e[4]=1-y-D,e[7]=M-P,e[2]=S-O,e[5]=M+P,e[8]=1-y-E,e},Hi.normalFromMat4=function(e,t){var r=t[0],s=t[1],a=t[2],u=t[3],c=t[4],p=t[5],g=t[6],y=t[7],x=t[8],E=t[9],S=t[10],M=t[11],D=t[12],P=t[13],O=t[14],R=t[15],B=r*p-s*c,j=r*g-a*c,V=r*y-u*c,U=s*g-a*p,G=s*y-u*p,Z=a*y-u*g,Q=x*P-E*D,et=x*O-S*D,it=x*R-M*D,yt=E*O-S*P,xt=E*R-M*P,Nt=S*R-M*O,ft=B*Nt-j*xt+V*yt+U*it-G*et+Z*Q;return ft?(e[0]=(p*Nt-g*xt+y*yt)*(ft=1/ft),e[1]=(g*it-c*Nt-y*et)*ft,e[2]=(c*xt-p*it+y*Q)*ft,e[3]=(a*xt-s*Nt-u*yt)*ft,e[4]=(r*Nt-a*it+u*et)*ft,e[5]=(s*it-r*xt-u*Q)*ft,e[6]=(P*Z-O*G+R*U)*ft,e[7]=(O*V-D*Z-R*j)*ft,e[8]=(D*G-P*V+R*B)*ft,e):null},Hi.projection=function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},Hi.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},Hi.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},Hi.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},Hi.subtract=A_,Hi.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},Hi.multiplyScalarAndAdd=function(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e[2]=t[2]+r[2]*s,e[3]=t[3]+r[3]*s,e[4]=t[4]+r[4]*s,e[5]=t[5]+r[5]*s,e[6]=t[6]+r[6]*s,e[7]=t[7]+r[7]*s,e[8]=t[8]+r[8]*s,e},Hi.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},Hi.equals=function(e,t){var r=e[0],s=e[1],a=e[2],u=e[3],c=e[4],p=e[5],g=e[6],y=e[7],x=e[8],E=t[0],S=t[1],M=t[2],D=t[3],P=t[4],O=t[5],R=t[6],B=t[7],j=t[8];return Math.abs(r-E)<=Uu.EPSILON*Math.max(1,Math.abs(r),Math.abs(E))&&Math.abs(s-S)<=Uu.EPSILON*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(a-M)<=Uu.EPSILON*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(u-D)<=Uu.EPSILON*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(c-P)<=Uu.EPSILON*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(p-O)<=Uu.EPSILON*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(g-R)<=Uu.EPSILON*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(y-B)<=Uu.EPSILON*Math.max(1,Math.abs(y),Math.abs(B))&&Math.abs(x-j)<=Uu.EPSILON*Math.max(1,Math.abs(x),Math.abs(j))},Hi.sub=Hi.mul=void 0;var Uu=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==up(e)&&"function"!=typeof e)return{default:e};var r=D_(void 0);if(r&&r.has(e))return r.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var c=a?Object.getOwnPropertyDescriptor(e,u):null;c&&(c.get||c.set)?Object.defineProperty(s,u,c):s[u]=e[u]}return s.default=e,r&&r.set(e,s),s}(na);function D_(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(D_=function(s){return s?r:t})(e)}function Mw(e,t,r){var s=t[0],a=t[1],u=t[2],c=t[3],p=t[4],g=t[5],y=t[6],x=t[7],E=t[8],S=r[0],M=r[1],D=r[2],P=r[3],O=r[4],R=r[5],B=r[6],j=r[7],V=r[8];return e[0]=S*s+M*c+D*y,e[1]=S*a+M*p+D*x,e[2]=S*u+M*g+D*E,e[3]=P*s+O*c+R*y,e[4]=P*a+O*p+R*x,e[5]=P*u+O*g+R*E,e[6]=B*s+j*c+V*y,e[7]=B*a+j*p+V*x,e[8]=B*u+j*g+V*E,e}function A_(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}Hi.mul=Mw,Hi.sub=A_;var Ar={};function P_(e){return(P_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.create=function(){var e=new bs.ARRAY_TYPE(16);return bs.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},Ar.clone=function(e){var t=new bs.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Ar.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Ar.fromValues=function(e,t,r,s,a,u,c,p,g,y,x,E,S,M,D,P){var O=new bs.ARRAY_TYPE(16);return O[0]=e,O[1]=t,O[2]=r,O[3]=s,O[4]=a,O[5]=u,O[6]=c,O[7]=p,O[8]=g,O[9]=y,O[10]=x,O[11]=E,O[12]=S,O[13]=M,O[14]=D,O[15]=P,O},Ar.set=function(e,t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O){return e[0]=t,e[1]=r,e[2]=s,e[3]=a,e[4]=u,e[5]=c,e[6]=p,e[7]=g,e[8]=y,e[9]=x,e[10]=E,e[11]=S,e[12]=M,e[13]=D,e[14]=P,e[15]=O,e},Ar.identity=ov,Ar.transpose=function(e,t){if(e===t){var r=t[1],s=t[2],a=t[3],u=t[6],c=t[7],p=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=s,e[9]=u,e[11]=t[14],e[12]=a,e[13]=c,e[14]=p}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},Ar.invert=function(e,t){var r=t[0],s=t[1],a=t[2],u=t[3],c=t[4],p=t[5],g=t[6],y=t[7],x=t[8],E=t[9],S=t[10],M=t[11],D=t[12],P=t[13],O=t[14],R=t[15],B=r*p-s*c,j=r*g-a*c,V=r*y-u*c,U=s*g-a*p,G=s*y-u*p,Z=a*y-u*g,Q=x*P-E*D,et=x*O-S*D,it=x*R-M*D,yt=E*O-S*P,xt=E*R-M*P,Nt=S*R-M*O,ft=B*Nt-j*xt+V*yt+U*it-G*et+Z*Q;return ft?(e[0]=(p*Nt-g*xt+y*yt)*(ft=1/ft),e[1]=(a*xt-s*Nt-u*yt)*ft,e[2]=(P*Z-O*G+R*U)*ft,e[3]=(S*G-E*Z-M*U)*ft,e[4]=(g*it-c*Nt-y*et)*ft,e[5]=(r*Nt-a*it+u*et)*ft,e[6]=(O*V-D*Z-R*j)*ft,e[7]=(x*Z-S*V+M*j)*ft,e[8]=(c*xt-p*it+y*Q)*ft,e[9]=(s*it-r*xt-u*Q)*ft,e[10]=(D*G-P*V+R*B)*ft,e[11]=(E*V-x*G-M*B)*ft,e[12]=(p*et-c*yt-g*Q)*ft,e[13]=(r*yt-s*et+a*Q)*ft,e[14]=(P*j-D*U-O*B)*ft,e[15]=(x*U-E*j+S*B)*ft,e):null},Ar.adjoint=function(e,t){var r=t[0],s=t[1],a=t[2],u=t[3],c=t[4],p=t[5],g=t[6],y=t[7],x=t[8],E=t[9],S=t[10],M=t[11],D=t[12],P=t[13],O=t[14],R=t[15];return e[0]=p*(S*R-M*O)-E*(g*R-y*O)+P*(g*M-y*S),e[1]=-(s*(S*R-M*O)-E*(a*R-u*O)+P*(a*M-u*S)),e[2]=s*(g*R-y*O)-p*(a*R-u*O)+P*(a*y-u*g),e[3]=-(s*(g*M-y*S)-p*(a*M-u*S)+E*(a*y-u*g)),e[4]=-(c*(S*R-M*O)-x*(g*R-y*O)+D*(g*M-y*S)),e[5]=r*(S*R-M*O)-x*(a*R-u*O)+D*(a*M-u*S),e[6]=-(r*(g*R-y*O)-c*(a*R-u*O)+D*(a*y-u*g)),e[7]=r*(g*M-y*S)-c*(a*M-u*S)+x*(a*y-u*g),e[8]=c*(E*R-M*P)-x*(p*R-y*P)+D*(p*M-y*E),e[9]=-(r*(E*R-M*P)-x*(s*R-u*P)+D*(s*M-u*E)),e[10]=r*(p*R-y*P)-c*(s*R-u*P)+D*(s*y-u*p),e[11]=-(r*(p*M-y*E)-c*(s*M-u*E)+x*(s*y-u*p)),e[12]=-(c*(E*O-S*P)-x*(p*O-g*P)+D*(p*S-g*E)),e[13]=r*(E*O-S*P)-x*(s*O-a*P)+D*(s*S-a*E),e[14]=-(r*(p*O-g*P)-c*(s*O-a*P)+D*(s*g-a*p)),e[15]=r*(p*S-g*E)-c*(s*S-a*E)+x*(s*g-a*p),e},Ar.determinant=function(e){var t=e[0],r=e[1],s=e[2],a=e[3],u=e[4],c=e[5],p=e[6],g=e[7],y=e[8],x=e[9],E=e[10],S=e[11],M=e[12],D=e[13],P=e[14],O=e[15];return(t*c-r*u)*(E*O-S*P)-(t*p-s*u)*(x*O-S*D)+(t*g-a*u)*(x*P-E*D)+(r*p-s*c)*(y*O-S*M)-(r*g-a*c)*(y*P-E*M)+(s*g-a*p)*(y*D-x*M)},Ar.multiply=Tw,Ar.translate=function(e,t,r){var s,a,u,c,p,g,y,x,E,S,M,D,P=r[0],O=r[1],R=r[2];return t===e?(e[12]=t[0]*P+t[4]*O+t[8]*R+t[12],e[13]=t[1]*P+t[5]*O+t[9]*R+t[13],e[14]=t[2]*P+t[6]*O+t[10]*R+t[14],e[15]=t[3]*P+t[7]*O+t[11]*R+t[15]):(a=t[1],u=t[2],c=t[3],p=t[4],g=t[5],y=t[6],x=t[7],E=t[8],S=t[9],M=t[10],D=t[11],e[0]=s=t[0],e[1]=a,e[2]=u,e[3]=c,e[4]=p,e[5]=g,e[6]=y,e[7]=x,e[8]=E,e[9]=S,e[10]=M,e[11]=D,e[12]=s*P+p*O+E*R+t[12],e[13]=a*P+g*O+S*R+t[13],e[14]=u*P+y*O+M*R+t[14],e[15]=c*P+x*O+D*R+t[15]),e},Ar.scale=function(e,t,r){var s=r[0],a=r[1],u=r[2];return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*u,e[9]=t[9]*u,e[10]=t[10]*u,e[11]=t[11]*u,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Ar.rotate=function(e,t,r,s){var a,u,c,p,g,y,x,E,S,M,D,P,O,R,B,j,V,U,G,Z,Q,et,it,yt,xt=s[0],Nt=s[1],ft=s[2],Ut=Math.hypot(xt,Nt,ft);return Ut<bs.EPSILON?null:(xt*=Ut=1/Ut,Nt*=Ut,ft*=Ut,a=Math.sin(r),u=Math.cos(r),g=t[1],y=t[2],x=t[3],S=t[5],M=t[6],D=t[7],O=t[9],R=t[10],B=t[11],G=xt*Nt*(c=1-u)-ft*a,Z=Nt*Nt*c+u,Q=ft*Nt*c+xt*a,et=xt*ft*c+Nt*a,it=Nt*ft*c-xt*a,yt=ft*ft*c+u,e[0]=(p=t[0])*(j=xt*xt*c+u)+(E=t[4])*(V=Nt*xt*c+ft*a)+(P=t[8])*(U=ft*xt*c-Nt*a),e[1]=g*j+S*V+O*U,e[2]=y*j+M*V+R*U,e[3]=x*j+D*V+B*U,e[4]=p*G+E*Z+P*Q,e[5]=g*G+S*Z+O*Q,e[6]=y*G+M*Z+R*Q,e[7]=x*G+D*Z+B*Q,e[8]=p*et+E*it+P*yt,e[9]=g*et+S*it+O*yt,e[10]=y*et+M*it+R*yt,e[11]=x*et+D*it+B*yt,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},Ar.rotateX=function(e,t,r){var s=Math.sin(r),a=Math.cos(r),u=t[4],c=t[5],p=t[6],g=t[7],y=t[8],x=t[9],E=t[10],S=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=u*a+y*s,e[5]=c*a+x*s,e[6]=p*a+E*s,e[7]=g*a+S*s,e[8]=y*a-u*s,e[9]=x*a-c*s,e[10]=E*a-p*s,e[11]=S*a-g*s,e},Ar.rotateY=function(e,t,r){var s=Math.sin(r),a=Math.cos(r),u=t[0],c=t[1],p=t[2],g=t[3],y=t[8],x=t[9],E=t[10],S=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=u*a-y*s,e[1]=c*a-x*s,e[2]=p*a-E*s,e[3]=g*a-S*s,e[8]=u*s+y*a,e[9]=c*s+x*a,e[10]=p*s+E*a,e[11]=g*s+S*a,e},Ar.rotateZ=function(e,t,r){var s=Math.sin(r),a=Math.cos(r),u=t[0],c=t[1],p=t[2],g=t[3],y=t[4],x=t[5],E=t[6],S=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=u*a+y*s,e[1]=c*a+x*s,e[2]=p*a+E*s,e[3]=g*a+S*s,e[4]=y*a-u*s,e[5]=x*a-c*s,e[6]=E*a-p*s,e[7]=S*a-g*s,e},Ar.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},Ar.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Ar.fromRotation=function(e,t,r){var s,a,u,c=r[0],p=r[1],g=r[2],y=Math.hypot(c,p,g);return y<bs.EPSILON?null:(c*=y=1/y,p*=y,g*=y,s=Math.sin(t),a=Math.cos(t),e[0]=c*c*(u=1-a)+a,e[1]=p*c*u+g*s,e[2]=g*c*u-p*s,e[3]=0,e[4]=c*p*u-g*s,e[5]=p*p*u+a,e[6]=g*p*u+c*s,e[7]=0,e[8]=c*g*u+p*s,e[9]=p*g*u-c*s,e[10]=g*g*u+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},Ar.fromXRotation=function(e,t){var r=Math.sin(t),s=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Ar.fromYRotation=function(e,t){var r=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Ar.fromZRotation=function(e,t){var r=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Ar.fromRotationTranslation=Dw,Ar.fromQuat2=function(e,t){var r=new bs.ARRAY_TYPE(3),s=-t[0],a=-t[1],u=-t[2],c=t[3],p=t[4],g=t[5],y=t[6],x=t[7],E=s*s+a*a+u*u+c*c;return E>0?(r[0]=2*(p*c+x*s+g*u-y*a)/E,r[1]=2*(g*c+x*a+y*s-p*u)/E,r[2]=2*(y*c+x*u+p*a-g*s)/E):(r[0]=2*(p*c+x*s+g*u-y*a),r[1]=2*(g*c+x*a+y*s-p*u),r[2]=2*(y*c+x*u+p*a-g*s)),Dw(e,t,r),e},Ar.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},Ar.getScaling=Qf,Ar.getRotation=function(e,t){var r=new bs.ARRAY_TYPE(3);Qf(r,t);var s=1/r[0],a=1/r[1],u=1/r[2],c=t[0]*s,p=t[1]*a,g=t[2]*u,y=t[4]*s,x=t[5]*a,E=t[6]*u,S=t[8]*s,M=t[9]*a,D=t[10]*u,P=c+x+D,O=0;return P>0?(O=2*Math.sqrt(P+1),e[3]=.25*O,e[0]=(E-M)/O,e[1]=(S-g)/O,e[2]=(p-y)/O):c>x&&c>D?(O=2*Math.sqrt(1+c-x-D),e[3]=(E-M)/O,e[0]=.25*O,e[1]=(p+y)/O,e[2]=(S+g)/O):x>D?(O=2*Math.sqrt(1+x-c-D),e[3]=(S-g)/O,e[0]=(p+y)/O,e[1]=.25*O,e[2]=(E+M)/O):(O=2*Math.sqrt(1+D-c-x),e[3]=(p-y)/O,e[0]=(S+g)/O,e[1]=(E+M)/O,e[2]=.25*O),e},Ar.fromRotationTranslationScale=function(e,t,r,s){var a=t[0],u=t[1],c=t[2],p=t[3],g=a+a,y=u+u,x=c+c,E=a*g,S=a*y,M=a*x,D=u*y,P=u*x,O=c*x,R=p*g,B=p*y,j=p*x,V=s[0],U=s[1],G=s[2];return e[0]=(1-(D+O))*V,e[1]=(S+j)*V,e[2]=(M-B)*V,e[3]=0,e[4]=(S-j)*U,e[5]=(1-(E+O))*U,e[6]=(P+R)*U,e[7]=0,e[8]=(M+B)*G,e[9]=(P-R)*G,e[10]=(1-(E+D))*G,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},Ar.fromRotationTranslationScaleOrigin=function(e,t,r,s,a){var u=t[0],c=t[1],p=t[2],g=t[3],y=u+u,x=c+c,E=p+p,S=u*y,M=u*x,D=u*E,P=c*x,O=c*E,R=p*E,B=g*y,j=g*x,V=g*E,U=s[0],G=s[1],Z=s[2],Q=a[0],et=a[1],it=a[2],yt=(1-(P+R))*U,xt=(M+V)*U,Nt=(D-j)*U,ft=(M-V)*G,Ut=(1-(S+R))*G,Wt=(O+B)*G,le=(D+j)*Z,Bt=(O-B)*Z,Zt=(1-(S+P))*Z;return e[0]=yt,e[1]=xt,e[2]=Nt,e[3]=0,e[4]=ft,e[5]=Ut,e[6]=Wt,e[7]=0,e[8]=le,e[9]=Bt,e[10]=Zt,e[11]=0,e[12]=r[0]+Q-(yt*Q+ft*et+le*it),e[13]=r[1]+et-(xt*Q+Ut*et+Bt*it),e[14]=r[2]+it-(Nt*Q+Wt*et+Zt*it),e[15]=1,e},Ar.fromQuat=function(e,t){var r=t[0],s=t[1],a=t[2],u=t[3],c=r+r,p=s+s,g=a+a,y=r*c,x=s*c,E=s*p,S=a*c,M=a*p,D=a*g,P=u*c,O=u*p,R=u*g;return e[0]=1-E-D,e[1]=x+R,e[2]=S-O,e[3]=0,e[4]=x-R,e[5]=1-y-D,e[6]=M+P,e[7]=0,e[8]=S+O,e[9]=M-P,e[10]=1-y-E,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Ar.frustum=function(e,t,r,s,a,u,c){var p=1/(r-t),g=1/(a-s),y=1/(u-c);return e[0]=2*u*p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*u*g,e[6]=0,e[7]=0,e[8]=(r+t)*p,e[9]=(a+s)*g,e[10]=(c+u)*y,e[11]=-1,e[12]=0,e[13]=0,e[14]=c*u*2*y,e[15]=0,e},Ar.perspectiveNO=cp,Ar.perspectiveZO=function(e,t,r,s,a){var u,c=1/Math.tan(t/2);return e[0]=c/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(e[10]=a*(u=1/(s-a)),e[14]=a*s*u):(e[10]=-1,e[14]=-s),e},Ar.perspectiveFromFieldOfView=function(e,t,r,s){var a=Math.tan(t.upDegrees*Math.PI/180),u=Math.tan(t.downDegrees*Math.PI/180),c=Math.tan(t.leftDegrees*Math.PI/180),p=Math.tan(t.rightDegrees*Math.PI/180),g=2/(c+p),y=2/(a+u);return e[0]=g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=y,e[6]=0,e[7]=0,e[8]=-(c-p)*g*.5,e[9]=(a-u)*y*.5,e[10]=s/(r-s),e[11]=-1,e[12]=0,e[13]=0,e[14]=s*r/(r-s),e[15]=0,e},Ar.orthoNO=Aw,Ar.orthoZO=function(e,t,r,s,a,u,c){var p=1/(t-r),g=1/(s-a),y=1/(u-c);return e[0]=-2*p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=y,e[11]=0,e[12]=(t+r)*p,e[13]=(a+s)*g,e[14]=u*y,e[15]=1,e},Ar.lookAt=function(e,t,r,s){var a,u,c,p,g,y,x,E,S,M,D=t[0],P=t[1],O=t[2],R=s[0],B=s[1],j=s[2],V=r[0],U=r[1],G=r[2];return Math.abs(D-V)<bs.EPSILON&&Math.abs(P-U)<bs.EPSILON&&Math.abs(O-G)<bs.EPSILON?ov(e):(x=D-V,E=P-U,S=O-G,a=B*(S*=M=1/Math.hypot(x,E,S))-j*(E*=M),u=j*(x*=M)-R*S,c=R*E-B*x,(M=Math.hypot(a,u,c))?(a*=M=1/M,u*=M,c*=M):(a=0,u=0,c=0),p=E*c-S*u,g=S*a-x*c,y=x*u-E*a,(M=Math.hypot(p,g,y))?(p*=M=1/M,g*=M,y*=M):(p=0,g=0,y=0),e[0]=a,e[1]=p,e[2]=x,e[3]=0,e[4]=u,e[5]=g,e[6]=E,e[7]=0,e[8]=c,e[9]=y,e[10]=S,e[11]=0,e[12]=-(a*D+u*P+c*O),e[13]=-(p*D+g*P+y*O),e[14]=-(x*D+E*P+S*O),e[15]=1,e)},Ar.targetTo=function(e,t,r,s){var a=t[0],u=t[1],c=t[2],p=s[0],g=s[1],y=s[2],x=a-r[0],E=u-r[1],S=c-r[2],M=x*x+E*E+S*S;M>0&&(x*=M=1/Math.sqrt(M),E*=M,S*=M);var D=g*S-y*E,P=y*x-p*S,O=p*E-g*x;return(M=D*D+P*P+O*O)>0&&(D*=M=1/Math.sqrt(M),P*=M,O*=M),e[0]=D,e[1]=P,e[2]=O,e[3]=0,e[4]=E*O-S*P,e[5]=S*D-x*O,e[6]=x*P-E*D,e[7]=0,e[8]=x,e[9]=E,e[10]=S,e[11]=0,e[12]=a,e[13]=u,e[14]=c,e[15]=1,e},Ar.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},Ar.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},Ar.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},Ar.subtract=IT,Ar.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},Ar.multiplyScalarAndAdd=function(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e[2]=t[2]+r[2]*s,e[3]=t[3]+r[3]*s,e[4]=t[4]+r[4]*s,e[5]=t[5]+r[5]*s,e[6]=t[6]+r[6]*s,e[7]=t[7]+r[7]*s,e[8]=t[8]+r[8]*s,e[9]=t[9]+r[9]*s,e[10]=t[10]+r[10]*s,e[11]=t[11]+r[11]*s,e[12]=t[12]+r[12]*s,e[13]=t[13]+r[13]*s,e[14]=t[14]+r[14]*s,e[15]=t[15]+r[15]*s,e},Ar.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},Ar.equals=function(e,t){var r=e[0],s=e[1],a=e[2],u=e[3],c=e[4],p=e[5],g=e[6],y=e[7],x=e[8],E=e[9],S=e[10],M=e[11],D=e[12],P=e[13],O=e[14],R=e[15],B=t[0],j=t[1],V=t[2],U=t[3],G=t[4],Z=t[5],Q=t[6],et=t[7],it=t[8],yt=t[9],xt=t[10],Nt=t[11],ft=t[12],Ut=t[13],Wt=t[14],le=t[15];return Math.abs(r-B)<=bs.EPSILON*Math.max(1,Math.abs(r),Math.abs(B))&&Math.abs(s-j)<=bs.EPSILON*Math.max(1,Math.abs(s),Math.abs(j))&&Math.abs(a-V)<=bs.EPSILON*Math.max(1,Math.abs(a),Math.abs(V))&&Math.abs(u-U)<=bs.EPSILON*Math.max(1,Math.abs(u),Math.abs(U))&&Math.abs(c-G)<=bs.EPSILON*Math.max(1,Math.abs(c),Math.abs(G))&&Math.abs(p-Z)<=bs.EPSILON*Math.max(1,Math.abs(p),Math.abs(Z))&&Math.abs(g-Q)<=bs.EPSILON*Math.max(1,Math.abs(g),Math.abs(Q))&&Math.abs(y-et)<=bs.EPSILON*Math.max(1,Math.abs(y),Math.abs(et))&&Math.abs(x-it)<=bs.EPSILON*Math.max(1,Math.abs(x),Math.abs(it))&&Math.abs(E-yt)<=bs.EPSILON*Math.max(1,Math.abs(E),Math.abs(yt))&&Math.abs(S-xt)<=bs.EPSILON*Math.max(1,Math.abs(S),Math.abs(xt))&&Math.abs(M-Nt)<=bs.EPSILON*Math.max(1,Math.abs(M),Math.abs(Nt))&&Math.abs(D-ft)<=bs.EPSILON*Math.max(1,Math.abs(D),Math.abs(ft))&&Math.abs(P-Ut)<=bs.EPSILON*Math.max(1,Math.abs(P),Math.abs(Ut))&&Math.abs(O-Wt)<=bs.EPSILON*Math.max(1,Math.abs(O),Math.abs(Wt))&&Math.abs(R-le)<=bs.EPSILON*Math.max(1,Math.abs(R),Math.abs(le))},Ar.sub=Ar.mul=Ar.ortho=Ar.perspective=void 0;var bs=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==P_(e)&&"function"!=typeof e)return{default:e};var r=Gm(void 0);if(r&&r.has(e))return r.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var c=a?Object.getOwnPropertyDescriptor(e,u):null;c&&(c.get||c.set)?Object.defineProperty(s,u,c):s[u]=e[u]}return s.default=e,r&&r.set(e,s),s}(na);function Gm(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Gm=function(s){return s?r:t})(e)}function ov(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Tw(e,t,r){var s=t[0],a=t[1],u=t[2],c=t[3],p=t[4],g=t[5],y=t[6],x=t[7],E=t[8],S=t[9],M=t[10],D=t[11],P=t[12],O=t[13],R=t[14],B=t[15],j=r[0],V=r[1],U=r[2],G=r[3];return e[0]=j*s+V*p+U*E+G*P,e[1]=j*a+V*g+U*S+G*O,e[2]=j*u+V*y+U*M+G*R,e[3]=j*c+V*x+U*D+G*B,e[4]=(j=r[4])*s+(V=r[5])*p+(U=r[6])*E+(G=r[7])*P,e[5]=j*a+V*g+U*S+G*O,e[6]=j*u+V*y+U*M+G*R,e[7]=j*c+V*x+U*D+G*B,e[8]=(j=r[8])*s+(V=r[9])*p+(U=r[10])*E+(G=r[11])*P,e[9]=j*a+V*g+U*S+G*O,e[10]=j*u+V*y+U*M+G*R,e[11]=j*c+V*x+U*D+G*B,e[12]=(j=r[12])*s+(V=r[13])*p+(U=r[14])*E+(G=r[15])*P,e[13]=j*a+V*g+U*S+G*O,e[14]=j*u+V*y+U*M+G*R,e[15]=j*c+V*x+U*D+G*B,e}function Dw(e,t,r){var s=t[0],a=t[1],u=t[2],c=t[3],p=s+s,g=a+a,y=u+u,x=s*p,E=s*g,S=s*y,M=a*g,D=a*y,P=u*y,O=c*p,R=c*g,B=c*y;return e[0]=1-(M+P),e[1]=E+B,e[2]=S-R,e[3]=0,e[4]=E-B,e[5]=1-(x+P),e[6]=D+O,e[7]=0,e[8]=S+R,e[9]=D-O,e[10]=1-(x+M),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Qf(e,t){var r=t[4],s=t[5],a=t[6],u=t[8],c=t[9],p=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(r,s,a),e[2]=Math.hypot(u,c,p),e}function cp(e,t,r,s,a){var u,c=1/Math.tan(t/2);return e[0]=c/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(e[10]=(a+s)*(u=1/(s-a)),e[14]=2*a*s*u):(e[10]=-1,e[14]=-2*s),e}function Aw(e,t,r,s,a,u,c){var p=1/(t-r),g=1/(s-a),y=1/(u-c);return e[0]=-2*p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*y,e[11]=0,e[12]=(t+r)*p,e[13]=(a+s)*g,e[14]=(c+u)*y,e[15]=1,e}function IT(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}Ar.perspective=cp,Ar.ortho=Aw,Ar.mul=Tw,Ar.sub=IT;var wr={},Dr={};function Pw(e){return(Pw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.create=Ow,Dr.clone=function(e){var t=new Fh.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Dr.length=qm,Dr.fromValues=function(e,t,r){var s=new Fh.ARRAY_TYPE(3);return s[0]=e,s[1]=t,s[2]=r,s},Dr.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Dr.set=function(e,t,r,s){return e[0]=t,e[1]=r,e[2]=s,e},Dr.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},Dr.subtract=sv,Dr.multiply=Rw,Dr.divide=av,Dr.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},Dr.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},Dr.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},Dr.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},Dr.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},Dr.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},Dr.scaleAndAdd=function(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e[2]=t[2]+r[2]*s,e},Dr.distance=CT,Dr.squaredDistance=lv,Dr.squaredLength=ST,Dr.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},Dr.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},Dr.normalize=function(e,t){var r=t[0],s=t[1],a=t[2],u=r*r+s*s+a*a;return u>0&&(u=1/Math.sqrt(u)),e[0]=t[0]*u,e[1]=t[1]*u,e[2]=t[2]*u,e},Dr.dot=Nw,Dr.cross=function(e,t,r){var s=t[0],a=t[1],u=t[2],c=r[0],p=r[1],g=r[2];return e[0]=a*g-u*p,e[1]=u*c-s*g,e[2]=s*p-a*c,e},Dr.lerp=function(e,t,r,s){var a=t[0],u=t[1],c=t[2];return e[0]=a+s*(r[0]-a),e[1]=u+s*(r[1]-u),e[2]=c+s*(r[2]-c),e},Dr.hermite=function(e,t,r,s,a,u){var c=u*u,p=c*(2*u-3)+1,g=c*(u-2)+u,y=c*(u-1),x=c*(3-2*u);return e[0]=t[0]*p+r[0]*g+s[0]*y+a[0]*x,e[1]=t[1]*p+r[1]*g+s[1]*y+a[1]*x,e[2]=t[2]*p+r[2]*g+s[2]*y+a[2]*x,e},Dr.bezier=function(e,t,r,s,a,u){var c=1-u,p=c*c,g=u*u,y=p*c,x=3*u*p,E=3*g*c,S=g*u;return e[0]=t[0]*y+r[0]*x+s[0]*E+a[0]*S,e[1]=t[1]*y+r[1]*x+s[1]*E+a[1]*S,e[2]=t[2]*y+r[2]*x+s[2]*E+a[2]*S,e},Dr.random=function(e,t){t=t||1;var r=2*Fh.RANDOM()*Math.PI,s=2*Fh.RANDOM()-1,a=Math.sqrt(1-s*s)*t;return e[0]=Math.cos(r)*a,e[1]=Math.sin(r)*a,e[2]=s*t,e},Dr.transformMat4=function(e,t,r){var s=t[0],a=t[1],u=t[2],c=r[3]*s+r[7]*a+r[11]*u+r[15];return e[0]=(r[0]*s+r[4]*a+r[8]*u+r[12])/(c=c||1),e[1]=(r[1]*s+r[5]*a+r[9]*u+r[13])/c,e[2]=(r[2]*s+r[6]*a+r[10]*u+r[14])/c,e},Dr.transformMat3=function(e,t,r){var s=t[0],a=t[1],u=t[2];return e[0]=s*r[0]+a*r[3]+u*r[6],e[1]=s*r[1]+a*r[4]+u*r[7],e[2]=s*r[2]+a*r[5]+u*r[8],e},Dr.transformQuat=function(e,t,r){var s=r[0],a=r[1],u=r[2],c=t[0],p=t[1],g=t[2],y=a*g-u*p,x=u*c-s*g,E=s*p-a*c,S=a*E-u*x,M=u*y-s*E,D=s*x-a*y,P=2*r[3];return x*=P,E*=P,M*=2,D*=2,e[0]=c+(y*=P)+(S*=2),e[1]=p+x+M,e[2]=g+E+D,e},Dr.rotateX=function(e,t,r,s){var a=[],u=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],u[0]=a[0],u[1]=a[1]*Math.cos(s)-a[2]*Math.sin(s),u[2]=a[1]*Math.sin(s)+a[2]*Math.cos(s),e[0]=u[0]+r[0],e[1]=u[1]+r[1],e[2]=u[2]+r[2],e},Dr.rotateY=function(e,t,r,s){var a=[],u=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],u[0]=a[2]*Math.sin(s)+a[0]*Math.cos(s),u[1]=a[1],u[2]=a[2]*Math.cos(s)-a[0]*Math.sin(s),e[0]=u[0]+r[0],e[1]=u[1]+r[1],e[2]=u[2]+r[2],e},Dr.rotateZ=function(e,t,r,s){var a=[],u=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],u[0]=a[0]*Math.cos(s)-a[1]*Math.sin(s),u[1]=a[0]*Math.sin(s)+a[1]*Math.cos(s),u[2]=a[2],e[0]=u[0]+r[0],e[1]=u[1]+r[1],e[2]=u[2]+r[2],e},Dr.angle=function(e,t){var r=e[0],s=e[1],a=e[2],u=t[0],c=t[1],p=t[2],g=Math.sqrt(r*r+s*s+a*a)*Math.sqrt(u*u+c*c+p*p),y=g&&Nw(e,t)/g;return Math.acos(Math.min(Math.max(y,-1),1))},Dr.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},Dr.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},Dr.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},Dr.equals=function(e,t){var r=e[0],s=e[1],a=e[2],u=t[0],c=t[1],p=t[2];return Math.abs(r-u)<=Fh.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(s-c)<=Fh.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(a-p)<=Fh.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))},Dr.forEach=Dr.sqrLen=Dr.len=Dr.sqrDist=Dr.dist=Dr.div=Dr.mul=Dr.sub=void 0;var Fh=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Pw(e)&&"function"!=typeof e)return{default:e};var r=Lw(void 0);if(r&&r.has(e))return r.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var c=a?Object.getOwnPropertyDescriptor(e,u):null;c&&(c.get||c.set)?Object.defineProperty(s,u,c):s[u]=e[u]}return s.default=e,r&&r.set(e,s),s}(na);function Lw(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Lw=function(s){return s?r:t})(e)}function Ow(){var e=new Fh.ARRAY_TYPE(3);return Fh.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function qm(e){return Math.hypot(e[0],e[1],e[2])}function sv(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Rw(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function av(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function CT(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function lv(e,t){var r=t[0]-e[0],s=t[1]-e[1],a=t[2]-e[2];return r*r+s*s+a*a}function ST(e){var t=e[0],r=e[1],s=e[2];return t*t+r*r+s*s}function Nw(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Dr.sub=sv,Dr.mul=Rw,Dr.div=av,Dr.dist=CT,Dr.sqrDist=lv,Dr.len=qm,Dr.sqrLen=ST;var kh,uv=(kh=Ow(),function(e,t,r,s,a,u){var c,p;for(t||(t=3),r||(r=0),p=s?Math.min(s*t+r,e.length):e.length,c=r;c<p;c+=t)kh[0]=e[c],kh[1]=e[c+1],kh[2]=e[c+2],a(kh,kh,u),e[c]=kh[0],e[c+1]=kh[1],e[c+2]=kh[2];return e});Dr.forEach=uv;var Qr={};function Fw(e){return(Fw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(Qr,"__esModule",{value:!0}),Qr.create=TT,Qr.clone=function(e){var t=new fu.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Qr.fromValues=function(e,t,r,s){var a=new fu.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=s,a},Qr.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Qr.set=function(e,t,r,s,a){return e[0]=t,e[1]=r,e[2]=s,e[3]=a,e},Qr.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},Qr.subtract=DT,Qr.multiply=AT,Qr.divide=PT,Qr.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},Qr.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},Qr.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},Qr.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},Qr.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},Qr.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},Qr.scaleAndAdd=function(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e[2]=t[2]+r[2]*s,e[3]=t[3]+r[3]*s,e},Qr.distance=kw,Qr.squaredDistance=$m,Qr.length=Hm,Qr.squaredLength=cv,Qr.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},Qr.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},Qr.normalize=function(e,t){var r=t[0],s=t[1],a=t[2],u=t[3],c=r*r+s*s+a*a+u*u;return c>0&&(c=1/Math.sqrt(c)),e[0]=r*c,e[1]=s*c,e[2]=a*c,e[3]=u*c,e},Qr.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},Qr.cross=function(e,t,r,s){var a=r[0]*s[1]-r[1]*s[0],u=r[0]*s[2]-r[2]*s[0],c=r[0]*s[3]-r[3]*s[0],p=r[1]*s[2]-r[2]*s[1],g=r[1]*s[3]-r[3]*s[1],y=r[2]*s[3]-r[3]*s[2],x=t[0],E=t[1],S=t[2],M=t[3];return e[0]=E*y-S*g+M*p,e[1]=-x*y+S*c-M*u,e[2]=x*g-E*c+M*a,e[3]=-x*p+E*u-S*a,e},Qr.lerp=function(e,t,r,s){var a=t[0],u=t[1],c=t[2],p=t[3];return e[0]=a+s*(r[0]-a),e[1]=u+s*(r[1]-u),e[2]=c+s*(r[2]-c),e[3]=p+s*(r[3]-p),e},Qr.random=function(e,t){var r,s,a,u,c,p;t=t||1;do{c=(r=2*fu.RANDOM()-1)*r+(s=2*fu.RANDOM()-1)*s}while(c>=1);do{p=(a=2*fu.RANDOM()-1)*a+(u=2*fu.RANDOM()-1)*u}while(p>=1);var g=Math.sqrt((1-c)/p);return e[0]=t*r,e[1]=t*s,e[2]=t*a*g,e[3]=t*u*g,e},Qr.transformMat4=function(e,t,r){var s=t[0],a=t[1],u=t[2],c=t[3];return e[0]=r[0]*s+r[4]*a+r[8]*u+r[12]*c,e[1]=r[1]*s+r[5]*a+r[9]*u+r[13]*c,e[2]=r[2]*s+r[6]*a+r[10]*u+r[14]*c,e[3]=r[3]*s+r[7]*a+r[11]*u+r[15]*c,e},Qr.transformQuat=function(e,t,r){var s=t[0],a=t[1],u=t[2],c=r[0],p=r[1],g=r[2],y=r[3],x=y*s+p*u-g*a,E=y*a+g*s-c*u,S=y*u+c*a-p*s,M=-c*s-p*a-g*u;return e[0]=x*y+M*-c+E*-g-S*-p,e[1]=E*y+M*-p+S*-c-x*-g,e[2]=S*y+M*-g+x*-p-E*-c,e[3]=t[3],e},Qr.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},Qr.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Qr.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Qr.equals=function(e,t){var r=e[0],s=e[1],a=e[2],u=e[3],c=t[0],p=t[1],g=t[2],y=t[3];return Math.abs(r-c)<=fu.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-p)<=fu.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-g)<=fu.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(u-y)<=fu.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))},Qr.forEach=Qr.sqrLen=Qr.len=Qr.sqrDist=Qr.dist=Qr.div=Qr.mul=Qr.sub=void 0;var fu=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Fw(e)&&"function"!=typeof e)return{default:e};var r=MT(void 0);if(r&&r.has(e))return r.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var c=a?Object.getOwnPropertyDescriptor(e,u):null;c&&(c.get||c.set)?Object.defineProperty(s,u,c):s[u]=e[u]}return s.default=e,r&&r.set(e,s),s}(na);function MT(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(MT=function(s){return s?r:t})(e)}function TT(){var e=new fu.ARRAY_TYPE(4);return fu.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function DT(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function AT(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function PT(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function kw(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function $m(e,t){var r=t[0]-e[0],s=t[1]-e[1],a=t[2]-e[2],u=t[3]-e[3];return r*r+s*s+a*a+u*u}function Hm(e){return Math.hypot(e[0],e[1],e[2],e[3])}function cv(e){var t=e[0],r=e[1],s=e[2],a=e[3];return t*t+r*r+s*s+a*a}Qr.sub=DT,Qr.mul=AT,Qr.div=PT,Qr.dist=kw,Qr.sqrDist=$m,Qr.len=Hm,Qr.sqrLen=cv;var zw=function(){var e=TT();return function(t,r,s,a,u,c){var p,g;for(r||(r=4),s||(s=0),g=a?Math.min(a*r+s,t.length):t.length,p=s;p<g;p+=r)e[0]=t[p],e[1]=t[p+1],e[2]=t[p+2],e[3]=t[p+3],u(e,e,c),t[p]=e[0],t[p+1]=e[1],t[p+2]=e[2],t[p+3]=e[3];return t}}();function L_(e){return(L_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Qr.forEach=zw,Object.defineProperty(wr,"__esModule",{value:!0}),wr.create=hv,wr.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},wr.setAxisAngle=Uw,wr.getAxisAngle=function(e,t){var r=2*Math.acos(t[3]),s=Math.sin(r/2);return s>sc.EPSILON?(e[0]=t[0]/s,e[1]=t[1]/s,e[2]=t[2]/s):(e[0]=1,e[1]=0,e[2]=0),r},wr.getAngle=function(e,t){var r=dv(e,t);return Math.acos(2*r*r-1)},wr.multiply=jw,wr.rotateX=function(e,t,r){r*=.5;var s=t[0],a=t[1],u=t[2],c=t[3],p=Math.sin(r),g=Math.cos(r);return e[0]=s*g+c*p,e[1]=a*g+u*p,e[2]=u*g-a*p,e[3]=c*g-s*p,e},wr.rotateY=function(e,t,r){r*=.5;var s=t[0],a=t[1],u=t[2],c=t[3],p=Math.sin(r),g=Math.cos(r);return e[0]=s*g-u*p,e[1]=a*g+c*p,e[2]=u*g+s*p,e[3]=c*g-a*p,e},wr.rotateZ=function(e,t,r){r*=.5;var s=t[0],a=t[1],u=t[2],c=t[3],p=Math.sin(r),g=Math.cos(r);return e[0]=s*g+a*p,e[1]=a*g-s*p,e[2]=u*g+c*p,e[3]=c*g-u*p,e},wr.calculateW=function(e,t){var r=t[0],s=t[1],a=t[2];return e[0]=r,e[1]=s,e[2]=a,e[3]=Math.sqrt(Math.abs(1-r*r-s*s-a*a)),e},wr.exp=fv,wr.ln=O_,wr.pow=function(e,t,r){return O_(e,t),Gw(e,e,r),fv(e,e),e},wr.slerp=R_,wr.random=function(e){var t=sc.RANDOM(),r=sc.RANDOM(),s=sc.RANDOM(),a=Math.sqrt(1-t),u=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*r),e[1]=a*Math.cos(2*Math.PI*r),e[2]=u*Math.sin(2*Math.PI*s),e[3]=u*Math.cos(2*Math.PI*s),e},wr.invert=function(e,t){var r=t[0],s=t[1],a=t[2],u=t[3],c=r*r+s*s+a*a+u*u,p=c?1/c:0;return e[0]=-r*p,e[1]=-s*p,e[2]=-a*p,e[3]=u*p,e},wr.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},wr.fromMat3=Vw,wr.fromEuler=function(e,t,r,s){var a=.5*Math.PI/180;t*=a,r*=a,s*=a;var u=Math.sin(t),c=Math.cos(t),p=Math.sin(r),g=Math.cos(r),y=Math.sin(s),x=Math.cos(s);return e[0]=u*g*x-c*p*y,e[1]=c*p*x+u*g*y,e[2]=c*g*y-u*p*x,e[3]=c*g*x+u*p*y,e},wr.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},wr.setAxes=wr.sqlerp=wr.rotationTo=wr.equals=wr.exactEquals=wr.normalize=wr.sqrLen=wr.squaredLength=wr.len=wr.length=wr.lerp=wr.dot=wr.scale=wr.mul=wr.add=wr.set=wr.copy=wr.fromValues=wr.clone=void 0;var sc=Ac(na),Bw=Ac(Hi),eh=Ac(Dr),Nl=Ac(Qr);function Zm(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Zm=function(s){return s?r:t})(e)}function Ac(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==L_(e)&&"function"!=typeof e)return{default:e};var r=Zm(t);if(r&&r.has(e))return r.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var c=a?Object.getOwnPropertyDescriptor(e,u):null;c&&(c.get||c.set)?Object.defineProperty(s,u,c):s[u]=e[u]}return s.default=e,r&&r.set(e,s),s}function hv(){var e=new sc.ARRAY_TYPE(4);return sc.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Uw(e,t,r){r*=.5;var s=Math.sin(r);return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=Math.cos(r),e}function jw(e,t,r){var s=t[0],a=t[1],u=t[2],c=t[3],p=r[0],g=r[1],y=r[2],x=r[3];return e[0]=s*x+c*p+a*y-u*g,e[1]=a*x+c*g+u*p-s*y,e[2]=u*x+c*y+s*g-a*p,e[3]=c*x-s*p-a*g-u*y,e}function fv(e,t){var r=t[0],s=t[1],a=t[2],u=t[3],c=Math.sqrt(r*r+s*s+a*a),p=Math.exp(u),g=c>0?p*Math.sin(c)/c:0;return e[0]=r*g,e[1]=s*g,e[2]=a*g,e[3]=p*Math.cos(c),e}function O_(e,t){var r=t[0],s=t[1],a=t[2],u=t[3],c=Math.sqrt(r*r+s*s+a*a),p=c>0?Math.atan2(c,u)/c:0;return e[0]=r*p,e[1]=s*p,e[2]=a*p,e[3]=.5*Math.log(r*r+s*s+a*a+u*u),e}function R_(e,t,r,s){var a,u,c,p,g,y=t[0],x=t[1],E=t[2],S=t[3],M=r[0],D=r[1],P=r[2],O=r[3];return(u=y*M+x*D+E*P+S*O)<0&&(u=-u,M=-M,D=-D,P=-P,O=-O),1-u>sc.EPSILON?(a=Math.acos(u),c=Math.sin(a),p=Math.sin((1-s)*a)/c,g=Math.sin(s*a)/c):(p=1-s,g=s),e[0]=p*y+g*M,e[1]=p*x+g*D,e[2]=p*E+g*P,e[3]=p*S+g*O,e}function Vw(e,t){var r,s=t[0]+t[4]+t[8];if(s>0)r=Math.sqrt(s+1),e[3]=.5*r,e[0]=(t[5]-t[7])*(r=.5/r),e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var u=(a+1)%3,c=(a+2)%3;r=Math.sqrt(t[3*a+a]-t[3*u+u]-t[3*c+c]+1),e[a]=.5*r,e[3]=(t[3*u+c]-t[3*c+u])*(r=.5/r),e[u]=(t[3*u+a]+t[3*a+u])*r,e[c]=(t[3*c+a]+t[3*a+c])*r}return e}wr.clone=Nl.clone,wr.fromValues=Nl.fromValues,wr.copy=Nl.copy,wr.set=Nl.set,wr.add=Nl.add,wr.mul=jw;var Gw=Nl.scale;wr.scale=Gw;var dv=Nl.dot;wr.dot=dv,wr.lerp=Nl.lerp;var qw=Nl.length;wr.length=qw,wr.len=qw;var $w=Nl.squaredLength;wr.squaredLength=$w,wr.sqrLen=$w;var Fl=Nl.normalize;wr.normalize=Fl,wr.exactEquals=Nl.exactEquals,wr.equals=Nl.equals;var ju,pv,N_,kl=(ju=eh.create(),pv=eh.fromValues(1,0,0),N_=eh.fromValues(0,1,0),function(e,t,r){var s=eh.dot(t,r);return s<-.999999?(eh.cross(ju,pv,t),eh.len(ju)<1e-6&&eh.cross(ju,N_,t),eh.normalize(ju,ju),Uw(e,ju,Math.PI),e):s>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(eh.cross(ju,t,r),e[0]=ju[0],e[1]=ju[1],e[2]=ju[2],e[3]=1+s,Fl(e,e))});wr.rotationTo=kl;var td,F_,Hw=(td=hv(),F_=hv(),function(e,t,r,s,a,u){return R_(td,t,a,u),R_(F_,r,s,u),R_(e,td,F_,2*u*(1-u)),e});wr.sqlerp=Hw;var Pc,Zw=(Pc=Bw.create(),function(e,t,r,s){return Pc[0]=r[0],Pc[3]=r[1],Pc[6]=r[2],Pc[1]=s[0],Pc[4]=s[1],Pc[7]=s[2],Pc[2]=-t[0],Pc[5]=-t[1],Pc[8]=-t[2],Fl(e,Vw(e,Pc))});wr.setAxes=Zw;var oi={};function k_(e){return(k_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(oi,"__esModule",{value:!0}),oi.create=function(){var e=new Wl.ARRAY_TYPE(8);return Wl.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},oi.clone=function(e){var t=new Wl.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},oi.fromValues=function(e,t,r,s,a,u,c,p){var g=new Wl.ARRAY_TYPE(8);return g[0]=e,g[1]=t,g[2]=r,g[3]=s,g[4]=a,g[5]=u,g[6]=c,g[7]=p,g},oi.fromRotationTranslationValues=function(e,t,r,s,a,u,c){var p=new Wl.ARRAY_TYPE(8);p[0]=e,p[1]=t,p[2]=r,p[3]=s;var g=.5*a,y=.5*u,x=.5*c;return p[4]=g*s+y*r-x*t,p[5]=y*s+x*e-g*r,p[6]=x*s+g*t-y*e,p[7]=-g*e-y*t-x*r,p},oi.fromRotationTranslation=z_,oi.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},oi.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},oi.fromMat4=function(e,t){var r=nh.create();Ww.getRotation(r,t);var s=new Wl.ARRAY_TYPE(3);return Ww.getTranslation(s,t),z_(e,r,s),e},oi.copy=Yw,oi.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},oi.set=function(e,t,r,s,a,u,c,p,g){return e[0]=t,e[1]=r,e[2]=s,e[3]=a,e[4]=u,e[5]=c,e[6]=p,e[7]=g,e},oi.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},oi.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},oi.getTranslation=function(e,t){var r=t[4],s=t[5],a=t[6],u=t[7],c=-t[0],p=-t[1],g=-t[2],y=t[3];return e[0]=2*(r*y+u*c+s*g-a*p),e[1]=2*(s*y+u*p+a*c-r*g),e[2]=2*(a*y+u*g+r*p-s*c),e},oi.translate=function(e,t,r){var s=t[0],a=t[1],u=t[2],c=t[3],p=.5*r[0],g=.5*r[1],y=.5*r[2],x=t[4],E=t[5],S=t[6],M=t[7];return e[0]=s,e[1]=a,e[2]=u,e[3]=c,e[4]=c*p+a*y-u*g+x,e[5]=c*g+u*p-s*y+E,e[6]=c*y+s*g-a*p+S,e[7]=-s*p-a*g-u*y+M,e},oi.rotateX=function(e,t,r){var s=-t[0],a=-t[1],u=-t[2],c=t[3],p=t[4],g=t[5],y=t[6],x=t[7],E=p*c+x*s+g*u-y*a,S=g*c+x*a+y*s-p*u,M=y*c+x*u+p*a-g*s,D=x*c-p*s-g*a-y*u;return nh.rotateX(e,t,r),e[4]=E*(c=e[3])+D*(s=e[0])+S*(u=e[2])-M*(a=e[1]),e[5]=S*c+D*a+M*s-E*u,e[6]=M*c+D*u+E*a-S*s,e[7]=D*c-E*s-S*a-M*u,e},oi.rotateY=function(e,t,r){var s=-t[0],a=-t[1],u=-t[2],c=t[3],p=t[4],g=t[5],y=t[6],x=t[7],E=p*c+x*s+g*u-y*a,S=g*c+x*a+y*s-p*u,M=y*c+x*u+p*a-g*s,D=x*c-p*s-g*a-y*u;return nh.rotateY(e,t,r),e[4]=E*(c=e[3])+D*(s=e[0])+S*(u=e[2])-M*(a=e[1]),e[5]=S*c+D*a+M*s-E*u,e[6]=M*c+D*u+E*a-S*s,e[7]=D*c-E*s-S*a-M*u,e},oi.rotateZ=function(e,t,r){var s=-t[0],a=-t[1],u=-t[2],c=t[3],p=t[4],g=t[5],y=t[6],x=t[7],E=p*c+x*s+g*u-y*a,S=g*c+x*a+y*s-p*u,M=y*c+x*u+p*a-g*s,D=x*c-p*s-g*a-y*u;return nh.rotateZ(e,t,r),e[4]=E*(c=e[3])+D*(s=e[0])+S*(u=e[2])-M*(a=e[1]),e[5]=S*c+D*a+M*s-E*u,e[6]=M*c+D*u+E*a-S*s,e[7]=D*c-E*s-S*a-M*u,e},oi.rotateByQuatAppend=function(e,t,r){var s=r[0],a=r[1],u=r[2],c=r[3],p=t[0],g=t[1],y=t[2],x=t[3];return e[0]=p*c+x*s+g*u-y*a,e[1]=g*c+x*a+y*s-p*u,e[2]=y*c+x*u+p*a-g*s,e[3]=x*c-p*s-g*a-y*u,e[4]=(p=t[4])*c+(x=t[7])*s+(g=t[5])*u-(y=t[6])*a,e[5]=g*c+x*a+y*s-p*u,e[6]=y*c+x*u+p*a-g*s,e[7]=x*c-p*s-g*a-y*u,e},oi.rotateByQuatPrepend=function(e,t,r){var s=t[0],a=t[1],u=t[2],c=t[3],p=r[0],g=r[1],y=r[2],x=r[3];return e[0]=s*x+c*p+a*y-u*g,e[1]=a*x+c*g+u*p-s*y,e[2]=u*x+c*y+s*g-a*p,e[3]=c*x-s*p-a*g-u*y,e[4]=s*(x=r[7])+c*(p=r[4])+a*(y=r[6])-u*(g=r[5]),e[5]=a*x+c*g+u*p-s*y,e[6]=u*x+c*y+s*g-a*p,e[7]=c*x-s*p-a*g-u*y,e},oi.rotateAroundAxis=function(e,t,r,s){if(Math.abs(s)<Wl.EPSILON)return Yw(e,t);var a=Math.hypot(r[0],r[1],r[2]);s*=.5;var u=Math.sin(s),c=u*r[0]/a,p=u*r[1]/a,g=u*r[2]/a,y=Math.cos(s),x=t[0],E=t[1],S=t[2],M=t[3];e[0]=x*y+M*c+E*g-S*p,e[1]=E*y+M*p+S*c-x*g,e[2]=S*y+M*g+x*p-E*c,e[3]=M*y-x*c-E*p-S*g;var D=t[4],P=t[5],O=t[6],R=t[7];return e[4]=D*y+R*c+P*g-O*p,e[5]=P*y+R*p+O*c-D*g,e[6]=O*y+R*g+D*p-P*c,e[7]=R*y-D*c-P*p-O*g,e},oi.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e},oi.multiply=hp,oi.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e},oi.lerp=function(e,t,r,s){var a=1-s;return Jw(t,r)<0&&(s=-s),e[0]=t[0]*a+r[0]*s,e[1]=t[1]*a+r[1]*s,e[2]=t[2]*a+r[2]*s,e[3]=t[3]*a+r[3]*s,e[4]=t[4]*a+r[4]*s,e[5]=t[5]*a+r[5]*s,e[6]=t[6]*a+r[6]*s,e[7]=t[7]*a+r[7]*s,e},oi.invert=function(e,t){var r=Xm(t);return e[0]=-t[0]/r,e[1]=-t[1]/r,e[2]=-t[2]/r,e[3]=t[3]/r,e[4]=-t[4]/r,e[5]=-t[5]/r,e[6]=-t[6]/r,e[7]=t[7]/r,e},oi.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},oi.normalize=function(e,t){var r=Xm(t);if(r>0){r=Math.sqrt(r);var s=t[0]/r,a=t[1]/r,u=t[2]/r,c=t[3]/r,p=t[4],g=t[5],y=t[6],x=t[7],E=s*p+a*g+u*y+c*x;e[0]=s,e[1]=a,e[2]=u,e[3]=c,e[4]=(p-s*E)/r,e[5]=(g-a*E)/r,e[6]=(y-u*E)/r,e[7]=(x-c*E)/r}return e},oi.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},oi.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},oi.equals=function(e,t){var r=e[0],s=e[1],a=e[2],u=e[3],c=e[4],p=e[5],g=e[6],y=e[7],x=t[0],E=t[1],S=t[2],M=t[3],D=t[4],P=t[5],O=t[6],R=t[7];return Math.abs(r-x)<=Wl.EPSILON*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(s-E)<=Wl.EPSILON*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(a-S)<=Wl.EPSILON*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(u-M)<=Wl.EPSILON*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(c-D)<=Wl.EPSILON*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(p-P)<=Wl.EPSILON*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(g-O)<=Wl.EPSILON*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(y-R)<=Wl.EPSILON*Math.max(1,Math.abs(y),Math.abs(R))},oi.sqrLen=oi.squaredLength=oi.len=oi.length=oi.dot=oi.mul=oi.setReal=oi.getReal=void 0;var Wl=Wm(na),nh=Wm(wr),Ww=Wm(Ar);function Xw(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Xw=function(s){return s?r:t})(e)}function Wm(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==k_(e)&&"function"!=typeof e)return{default:e};var r=Xw(t);if(r&&r.has(e))return r.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var c=a?Object.getOwnPropertyDescriptor(e,u):null;c&&(c.get||c.set)?Object.defineProperty(s,u,c):s[u]=e[u]}return s.default=e,r&&r.set(e,s),s}function z_(e,t,r){var s=.5*r[0],a=.5*r[1],u=.5*r[2],c=t[0],p=t[1],g=t[2],y=t[3];return e[0]=c,e[1]=p,e[2]=g,e[3]=y,e[4]=s*y+a*g-u*p,e[5]=a*y+u*c-s*g,e[6]=u*y+s*p-a*c,e[7]=-s*c-a*p-u*g,e}function Yw(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function hp(e,t,r){var s=t[0],a=t[1],u=t[2],c=t[3],p=r[4],g=r[5],y=r[6],x=r[7],E=t[4],S=t[5],M=t[6],D=t[7],P=r[0],O=r[1],R=r[2],B=r[3];return e[0]=s*B+c*P+a*R-u*O,e[1]=a*B+c*O+u*P-s*R,e[2]=u*B+c*R+s*O-a*P,e[3]=c*B-s*P-a*O-u*R,e[4]=s*x+c*p+a*y-u*g+E*B+D*P+S*R-M*O,e[5]=a*x+c*g+u*p-s*y+S*B+D*O+M*P-E*R,e[6]=u*x+c*y+s*g-a*p+M*B+D*R+E*O-S*P,e[7]=c*x-s*p-a*g-u*y+D*B-E*P-S*O-M*R,e}oi.getReal=nh.copy,oi.setReal=nh.copy,oi.mul=hp;var Jw=nh.dot;oi.dot=Jw;var Kw=nh.length;oi.length=Kw,oi.len=Kw;var Xm=nh.squaredLength;oi.squaredLength=Xm,oi.sqrLen=Xm;var kr={};function B_(e){return(B_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(kr,"__esModule",{value:!0}),kr.create=mv,kr.clone=function(e){var t=new ac.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},kr.fromValues=function(e,t){var r=new ac.ARRAY_TYPE(2);return r[0]=e,r[1]=t,r},kr.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},kr.set=function(e,t,r){return e[0]=t,e[1]=r,e},kr.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},kr.subtract=U_,kr.multiply=Jm,kr.divide=Qw,kr.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},kr.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},kr.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},kr.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},kr.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},kr.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},kr.scaleAndAdd=function(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e},kr.distance=tE,kr.squaredDistance=eE,kr.length=nE,kr.squaredLength=rE,kr.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},kr.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},kr.normalize=function(e,t){var r=t[0],s=t[1],a=r*r+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e},kr.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},kr.cross=function(e,t,r){var s=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=s,e},kr.lerp=function(e,t,r,s){var a=t[0],u=t[1];return e[0]=a+s*(r[0]-a),e[1]=u+s*(r[1]-u),e},kr.random=function(e,t){t=t||1;var r=2*ac.RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},kr.transformMat2=function(e,t,r){var s=t[0],a=t[1];return e[0]=r[0]*s+r[2]*a,e[1]=r[1]*s+r[3]*a,e},kr.transformMat2d=function(e,t,r){var s=t[0],a=t[1];return e[0]=r[0]*s+r[2]*a+r[4],e[1]=r[1]*s+r[3]*a+r[5],e},kr.transformMat3=function(e,t,r){var s=t[0],a=t[1];return e[0]=r[0]*s+r[3]*a+r[6],e[1]=r[1]*s+r[4]*a+r[7],e},kr.transformMat4=function(e,t,r){var s=t[0],a=t[1];return e[0]=r[0]*s+r[4]*a+r[12],e[1]=r[1]*s+r[5]*a+r[13],e},kr.rotate=function(e,t,r,s){var a=t[0]-r[0],u=t[1]-r[1],c=Math.sin(s),p=Math.cos(s);return e[0]=a*p-u*c+r[0],e[1]=a*c+u*p+r[1],e},kr.angle=function(e,t){var r=e[0],s=e[1],a=t[0],u=t[1],c=Math.sqrt(r*r+s*s)*Math.sqrt(a*a+u*u);return Math.acos(Math.min(Math.max(c&&(r*a+s*u)/c,-1),1))},kr.zero=function(e){return e[0]=0,e[1]=0,e},kr.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},kr.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},kr.equals=function(e,t){var r=e[0],s=e[1],a=t[0],u=t[1];return Math.abs(r-a)<=ac.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-u)<=ac.EPSILON*Math.max(1,Math.abs(s),Math.abs(u))},kr.forEach=kr.sqrLen=kr.sqrDist=kr.dist=kr.div=kr.mul=kr.sub=kr.len=void 0;var ac=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==B_(e)&&"function"!=typeof e)return{default:e};var r=Ym(void 0);if(r&&r.has(e))return r.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var c=a?Object.getOwnPropertyDescriptor(e,u):null;c&&(c.get||c.set)?Object.defineProperty(s,u,c):s[u]=e[u]}return s.default=e,r&&r.set(e,s),s}(na);function Ym(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Ym=function(s){return s?r:t})(e)}function mv(){var e=new ac.ARRAY_TYPE(2);return ac.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function U_(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function Jm(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function Qw(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function tE(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function eE(e,t){var r=t[0]-e[0],s=t[1]-e[1];return r*r+s*s}function nE(e){return Math.hypot(e[0],e[1])}function rE(e){var t=e[0],r=e[1];return t*t+r*r}kr.len=nE,kr.sub=U_,kr.mul=Jm,kr.div=Qw,kr.dist=tE,kr.sqrDist=eE,kr.sqrLen=rE;var LT=function(){var e=mv();return function(t,r,s,a,u,c){var p,g;for(r||(r=2),s||(s=0),g=a?Math.min(a*r+s,t.length):t.length,p=s;p<g;p+=r)e[0]=t[p],e[1]=t[p+1],u(e,e,c),t[p]=e[0],t[p+1]=e[1];return t}}();function j_(e){return(j_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}kr.forEach=LT,Object.defineProperty(xa,"__esModule",{value:!0});var Oi=xa.vec4=Ot=xa.vec3=xa.vec2=xa.quat2=Ha=xa.quat=ce=xa.mat4=zl=xa.mat3=xa.mat2d=fp=xa.mat2=xa.glMatrix=void 0,gv=lc(na);xa.glMatrix=gv;var _v=lc(vs),fp=xa.mat2=_v,OT=lc(xs);xa.mat2d=OT;var yv=lc(Hi),zl=xa.mat3=yv,ed=lc(Ar),ce=xa.mat4=ed,iE=lc(wr),Ha=xa.quat=iE,GL=lc(oi);xa.quat2=GL;var V_=lc(kr);xa.vec2=V_;var RT=lc(Dr),Ot=xa.vec3=RT,oE=lc(Qr);function vv(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(vv=function(s){return s?r:t})(e)}function lc(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==j_(e)&&"function"!=typeof e)return{default:e};var r=vv(t);if(r&&r.has(e))return r.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var c=a?Object.getOwnPropertyDescriptor(e,u):null;c&&(c.get||c.set)?Object.defineProperty(s,u,c):s[u]=e[u]}return s.default=e,r&&r.set(e,s),s}Oi=xa.vec4=oE;const sE=yr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:nd}=sE,dp=yr([{name:"a_pos_3",components:3,type:"Int16"}]);var zh=yr([{name:"a_pos",type:"Int16",components:2}]),G_={};!function(r){function s(u,c,p){var g=a(256*u,256*(c=Math.pow(2,p)-c-1),p),y=a(256*(u+1),256*(c+1),p);return g[0]+","+g[1]+","+y[0]+","+y[1]}function a(u,c,p){var g=2*Math.PI*6378137/256/Math.pow(2,p);return[u*g-2*Math.PI*6378137/2,c*g-2*Math.PI*6378137/2]}r.getURL=function(u,c,p,g,y,x){return x=x||{},u+"?"+["bbox="+s(p,g,y),"format="+(x.format||"image/png"),"service="+(x.service||"WMS"),"version="+(x.version||"1.1.1"),"request="+(x.request||"GetMap"),"srs="+(x.srs||"EPSG:3857"),"width="+(x.width||256),"height="+(x.height||256),"layers="+c].join("&")},r.getTileBBox=s,r.getMercCoords=a,Object.defineProperty(r,"__esModule",{value:!0})}(G_);var q_=G_;class Vu{constructor(t,r,s){this.z=t,this.x=r,this.y=s,this.key=Qm(0,t,t,r,s)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r){const s=q_.getTileBBox(this.x,this.y,this.z),a=function(u,c,p){let g,y="";for(let x=u;x>0;x--)g=1<<x-1,y+=(c&g?1:0)+(p&g?2:0);return y}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===r?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Km{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Qm(t,r.z,r.z,r.x,r.y)}}class si{constructor(t,r,s,a,u){this.overscaledZ=t,this.wrap=r,this.canonical=new Vu(s,+a,+u),this.key=0===r&&t===s?this.canonical.key:Qm(r,t,s,a,u)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const r=this.canonical.z-t;return t>this.canonical.z?new si(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new si(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r=!0){if(this.overscaledZ===t&&r)return this.key;if(t>this.canonical.z)return Qm(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-t;return Qm(this.wrap*+r,t,t,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new si(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,a=2*this.canonical.y;return[new si(r,this.wrap,r,s,a),new si(r,this.wrap,r,s+1,a),new si(r,this.wrap,r,s,a+1),new si(r,this.wrap,r,s+1,a+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new si(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new si(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Km(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Qm(e,t,r,s,a){const u=1<<Math.min(r,22);let c=u*(a%u)+s%u;return e&&r<22&&(c+=u*u*((e<0?-2*e-1:2*e)%(1<<2*(22-r)))),16*(32*c+r)+(t-r)}const xv=[e=>{let t=e.canonical.x-1,r=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,r--),new si(e.overscaledZ,r,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,r=e.wrap;return t===1<<e.canonical.z&&(t=0,r++),new si(e.overscaledZ,r,e.canonical.z,t,e.canonical.y)},e=>new si(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new si(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];Fn(Vu,"CanonicalTileID"),Fn(si,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class $_{constructor(t,r){this.pos=t,this.dir=r}intersectsPlane(t,r,s){const a=Ot.dot(r,this.dir);if(Math.abs(a)<1e-6)return!1;const u=((t[0]-this.pos[0])*r[0]+(t[1]-this.pos[1])*r[1]+(t[2]-this.pos[2])*r[2])/a;return s[0]=this.pos[0]+this.dir[0]*u,s[1]=this.pos[1]+this.dir[1]*u,s[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(t,r,s){if(Ot.equals(this.pos,t)||0===r)return s[0]=s[1]=s[2]=0,!1;const[a,u,c]=this.dir,p=this.pos[0]-t[0],g=this.pos[1]-t[1],y=this.pos[2]-t[2],x=a*a+u*u+c*c,E=2*(p*a+g*u+y*c),S=E*E-4*x*(p*p+g*g+y*y-r*r);if(S<0){const M=Math.max(-E/2,0),D=p+a*M,P=g+u*M,O=y+c*M,R=Math.hypot(D,P,O);return s[0]=D*r/R,s[1]=P*r/R,s[2]=O*r/R,!1}{const M=(-E-Math.sqrt(S))/(2*x);if(M<0){const D=Math.hypot(p,g,y);return s[0]=p*r/D,s[1]=g*r/D,s[2]=y*r/D,!1}return s[0]=p+a*M,s[1]=g+u*M,s[2]=y+c*M,!0}}}class bv{constructor(t,r,s,a,u){this.TL=t,this.TR=r,this.BR=s,this.BL=a,this.horizon=u}static fromInvProjectionMatrix(t,r,s){const a=[-1,1,1],u=[1,1,1],c=[1,-1,1],p=[-1,-1,1],g=Ot.transformMat4(a,a,t),y=Ot.transformMat4(u,u,t),x=Ot.transformMat4(c,c,t),E=Ot.transformMat4(p,p,t);return new bv(g,y,x,E,r/s)}}function tg(e,t,r){let s=1/0,a=-1/0;const u=[];for(const c of e){Ot.sub(u,c,t);const p=Ot.dot(u,r);s=Math.min(s,p),a=Math.max(a,p)}return[s,a]}function wv(e,t){let r=!0;for(let s=0;s<e.planes.length;s++){const a=e.planes[s];let u=0;for(let c=0;c<t.length;c++)u+=Ot.dot(a,t[c])+a[3]>=0;if(0===u)return 0;u!==t.length&&(r=!1)}return r?2:1}function Ev(e,t){for(const r of e.projections){const s=tg(t,e.points[0],r.axis);if(r.projection[1]<s[0]||r.projection[0]>s[1])return 0}return 1}function eg(e,t){let r=0;const s=[0,0,0,0];for(let a=0;a<e.length;a++)s[0]=e[a][0],s[1]=e[a][1],s[2]=e[a][2],s[3]=1,Oi.dot(s,t)>=0&&r++;return r}class Lc{constructor(t,r){this.points=t||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=Qi.fromPoints(this.points),this.projections=[],this.frustumEdges=[Ot.sub([],this.points[2],this.points[3]),Ot.sub([],this.points[0],this.points[3]),Ot.sub([],this.points[4],this.points[0]),Ot.sub([],this.points[5],this.points[1]),Ot.sub([],this.points[6],this.points[2]),Ot.sub([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const a=[0,-s[2],s[1]],u=[s[2],0,-s[0]];this.projections.push({axis:a,projection:tg(this.points,this.points[0],a)}),this.projections.push({axis:u,projection:tg(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(t,r,s,a){const u=Math.pow(2,s),c=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(y=>{const x=Oi.transformMat4([],y,t),E=1/x[3]/r*u;return Oi.mul(x,x,[E,E,a?1/x[3]:E,E])}),p=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(y=>{const x=Ot.sub([],c[y[0]],c[y[1]]),E=Ot.sub([],c[y[2]],c[y[1]]),S=Ot.normalize([],Ot.cross([],x,E)),M=-Ot.dot(S,c[y[1]]);return S.concat(M)}),g=[];for(let y=0;y<c.length;y++)g.push([c[y][0],c[y][1],c[y][2]]);return new Lc(g,p)}intersectsPrecise(t,r,s){for(let a=0;a<r.length;a++)if(!eg(t,r[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!eg(t,this.planes[a]))return 0;for(const a of s)for(const u of this.frustumEdges){const c=Ot.cross([],a,u),p=Ot.length(c);if(0===p)continue;Ot.scale(c,c,1/p);const g=tg(this.points,this.points[0],c),y=tg(t,this.points[0],c);if(g[0]>y[1]||y[0]>g[1])return 0}return 1}}class Qi{static fromPoints(t){const r=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const a of t)Ot.min(r,r,a),Ot.max(s,s,a);return new Qi(r,s)}static fromTileIdAndHeight(t,r,s){const a=1<<t.canonical.z,u=t.canonical.x,c=t.canonical.y;return new Qi([u/a,c/a,r],[(u+1)/a,(c+1)/a,s])}static applyTransform(t,r){const s=t.getCorners();for(let a=0;a<s.length;++a)Ot.transformMat4(s[a],s[a],r);return Qi.fromPoints(s)}static projectAabbCorners(t,r){const s=t.getCorners();for(let a=0;a<s.length;++a)Ot.transformMat4(s[a],s[a],r);return s}constructor(t,r){this.min=t,this.max=r,this.center=Ot.scale([],Ot.add([],this.min,this.max),.5)}quadrant(t){const r=[t%2==0,t<2],s=Ot.clone(this.min),a=Ot.clone(this.max);for(let u=0;u<r.length;u++)s[u]=r[u]?this.min[u]:this.center[u],a[u]=r[u]?this.center[u]:this.max[u];return a[2]=this.max[2],new Qi(s,a)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,r=this.max;return[[t[0],t[1],t[2]],[r[0],t[1],t[2]],[r[0],r[1],t[2]],[t[0],r[1],t[2]],[t[0],t[1],r[2]],[r[0],t[1],r[2]],[r[0],r[1],r[2]],[t[0],r[1],r[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?wv(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?wv(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,r){return r||this.intersects(t)?Ev(t,this.getCorners()):0}intersectsPreciseFlat(t,r){return r||this.intersectsFlat(t)?Ev(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let r=0;r<3;++r)if(this.min[r]>t.max[r]||t.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],t.min[r]),this.max[r]=Math.max(this.max[r],t.max[r])}encapsulatePoint(t){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],t[r]),this.max[r]=Math.max(this.max[r],t[r])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}Fn(Qi,"Aabb");const ng=5,df=6,Xl=$t/Math.PI/2,NT=16383,Iv=[64,32,16],Il=-Xl,Yl=Xl,Cv=[new Qi([Il,Il,Il],[Yl,Yl,Yl]),new Qi([Il,Il,Il],[0,0,Yl]),new Qi([0,Il,Il],[Yl,0,Yl]),new Qi([Il,0,Il],[0,Yl,Yl]),new Qi([0,0,Il],[Yl,Yl,Yl])];function rg(e){return e*Xl/ig}function Sv(e,t,r,s=!0){const a=Ot.scale([],e._camera.position,e.worldSize),u=[t,r,1,1];Oi.transformMat4(u,u,e.pixelMatrixInverse),Oi.scale(u,u,1/u[3]);const c=Ot.sub([],u,a),p=Ot.normalize([],c),g=e.globeMatrix,y=[g[12],g[13],g[14]],x=Ot.sub([],y,a),E=Ot.length(x),S=Ot.normalize([],x),M=e.worldSize/(2*Math.PI),D=Ot.dot(S,p),P=Math.asin(M/E);if(P<Math.acos(D)){if(!s)return null;const yt=[],xt=[];Ot.scale(yt,p,E/D),Ot.normalize(xt,Ot.sub(xt,yt,x)),Ot.normalize(p,Ot.add(p,x,Ot.scale(p,xt,Math.tan(P)*E)))}const O=[];new $_(a,p).closestPointOnSphere(y,M,O);const R=Ot.normalize([],Ni(g,0)),B=Ot.normalize([],Ni(g,1)),j=Ot.normalize([],Ni(g,2)),V=Ot.dot(R,O),U=Ot.dot(B,O),G=Ot.dot(j,O),Z=Ht(Math.asin(-U/M));let Q=Ht(Math.atan2(V,G));Q=e.center.lng+function(yt,xt){const Nt=(xt-yt+180)%360-180;return Nt<-180?Nt+360:Nt}(e.center.lng,Q);const et=zs(Q),it=At(ba(Z),0,1);return new ri(et,it)}class aE{constructor(t,r,s){this.a=Ot.sub([],t,s),this.b=Ot.sub([],r,s),this.center=s;const a=Ot.normalize([],this.a),u=Ot.normalize([],this.b);this.angle=Math.acos(Ot.dot(a,u))}}function H_(e,t){if(0===e.angle)return null;let r;return r=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),r<0||r>1?null:function(s,a,u,c){const p=Math.sin(u);return s*(Math.sin((1-c)*u)/p)+a*(Math.sin(c*u)/p)}(e.a[t],e.b[t],e.angle,At(r,0,1))+e.center[t]}function Gu(e){if(e.z<=1)return Cv[e.z+2*e.y+e.x];const t=rd(Oc(e));return Qi.fromPoints(t)}function Bh(e,t,r){return Ot.scale(e,e,1-r),Ot.scaleAndAdd(e,e,t,r)}function lE(e,t){const r=da(t.zoom);if(0===r)return Gu(e);const s=Oc(e),a=rd(s),u=zs(s.getWest())*t.worldSize,c=zs(s.getEast())*t.worldSize,p=ba(s.getNorth())*t.worldSize,g=ba(s.getSouth())*t.worldSize,y=[u,p,0],x=[c,p,0],E=[u,g,0],S=[c,g,0],M=ce.invert([],t.globeMatrix);return Ot.transformMat4(y,y,M),Ot.transformMat4(x,x,M),Ot.transformMat4(E,E,M),Ot.transformMat4(S,S,M),a[0]=Bh(a[0],E,r),a[1]=Bh(a[1],S,r),a[2]=Bh(a[2],x,r),a[3]=Bh(a[3],y,r),Qi.fromPoints(a)}function uE(e,t,r){for(const s of e)Ot.transformMat4(s,s,t),Ot.scale(s,s,r)}function Mv(e,t,r,s){const a=t/e.worldSize,u=e.globeMatrix;if(r.z<=1){const et=Gu(r).getCorners();return uE(et,u,a),Qi.fromPoints(et)}const c=Oc(r,s),p=rd(c);uE(p,u,a);const g=Number.MAX_VALUE,y=[-g,-g,-g],x=[g,g,g];if(c.contains(e.center)){for(const yt of p)Ot.min(x,x,yt),Ot.max(y,y,yt);y[2]=0;const et=e.point,it=[et.x*a,et.y*a,0];return Ot.min(x,x,it),Ot.max(y,y,it),new Qi(x,y)}const E=[u[12]*a,u[13]*a,u[14]*a],S=c.getCenter(),M=At(e.center.lat,-Ls,Ls),D=At(S.lat,-Ls,Ls),P=zs(e.center.lng),O=ba(M);let R=P-zs(S.lng);const B=O-ba(D);R>.5?R-=1:R<-.5&&(R+=1);let j=0;if(Math.abs(R)>Math.abs(B))j=R>=0?1:3;else{j=B>=0?0:2;const et=[u[4]*a,u[5]*a,u[6]*a],it=-Math.sin(St(B>=0?c.getSouth():c.getNorth()))*Xl;Ot.scaleAndAdd(E,E,et,it)}const V=p[j],U=p[(j+1)%4],G=new aE(V,U,E),Z=[H_(G,0)||V[0],H_(G,1)||V[1],H_(G,2)||V[2]],Q=da(e.zoom);if(Q>0){const et=function({x:yt,y:xt,z:Nt},ft,Ut,Wt,le){const Bt=1/(1<<Nt);let Zt=yt*Bt,ge=Zt+Bt,be=xt*Bt,xe=be+Bt,Re=0;const ze=(Zt+ge)/2-Wt;return ze>.5?Re=-1:ze<-.5&&(Re=1),Zt=((Zt+Re)*ft-(Wt*=ft))*Ut+Wt,ge=((ge+Re)*ft-Wt)*Ut+Wt,be=(be*ft-(le*=ft))*Ut+le,xe=(xe*ft-le)*Ut+le,[[Zt,xe,0],[ge,xe,0],[ge,be,0],[Zt,be,0]]}(r,t,e._pixelsPerMercatorPixel,P,O);for(let yt=0;yt<p.length;yt++)Bh(p[yt],et[yt],Q);const it=Ot.add([],et[j],et[(j+1)%4]);Ot.scale(it,it,.5),Bh(Z,it,Q)}for(const et of p)Ot.min(x,x,et),Ot.max(y,y,et);return x[2]=Math.min(V[2],U[2]),Ot.min(x,x,Z),Ot.max(y,y,Z),new Qi(x,y)}function Oc({x:e,y:t,z:r},s=!1){const a=1/(1<<r),u=new pr(pu(e*a),t===(1<<r)-1&&s?-90:ws((t+1)*a)),c=new pr(pu((e+1)*a),0===t&&s?90:ws(t*a));return new $a(u,c)}function rd(e){const t=St(e.getNorth()),r=St(e.getSouth()),s=Math.cos(t),a=Math.cos(r),u=Math.sin(t),c=Math.sin(r),p=e.getWest(),g=e.getEast();return[pp(a,c,p),pp(a,c,g),pp(s,u,g),pp(s,u,p)]}function pp(e,t,r,s=Xl){return r=St(r),[e*Math.sin(r)*s,-t*s,e*Math.cos(r)*s]}function du(e,t,r){return pp(Math.cos(St(e)),Math.sin(St(e)),t,r)}function Z_(e,t,r,s){const a=1<<r.z,u=(e/$t+r.x)/a;return du(ws((t/$t+r.y)/a),pu(u),s)}function Tv({min:e,max:t}){return NT/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const FT=new Float64Array(16);function id(e){const t=Tv(e),r=ce.fromScaling(FT,[t,t,t]);return ce.translate(r,r,Ot.negate([],e.min))}function W_(e){const t=ce.fromTranslation(FT,e.min),r=1/Tv(e);return ce.scale(t,t,[r,r,r])}function Dv(e){const t=$t/(2*Math.PI);return e/(2*Math.PI)/t}function cE(e,t){return $t/(512*Math.pow(2,e))*Tv(Gu(t))}function hE(e,t,r,s,a){const u=Dv(r),c=[e,t,-r/(2*Math.PI)],p=ce.identity(new Float64Array(16));return ce.translate(p,p,c),ce.scale(p,p,[u,u,u]),ce.rotateX(p,p,St(-a)),ce.rotateY(p,p,St(-s)),p}function fE(e){const t=e.pixelsPerMeter,r=t/ji(1,e.center.lat),s=ce.identity(new Float64Array(16));return ce.translate(s,s,[e.point.x,e.point.y,0]),ce.scale(s,s,[r,r,t]),Float32Array.from(s)}function da(e){return ne(ng,df,e)}function rh(e,t,r){const s=ce.identity(new Float64Array(16)),a=(t/(1<<e)-.5)*Math.PI*2;return ce.rotateY(s,r.globeMatrix,a),Float32Array.from(s)}function mp(e,t,r){const s=da(r.zoom),a=e.style.map._antialias,u=t.options.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===s&&!a&&!u}function Av(e,t,r,s){const a=t.getNorth(),u=t.getSouth(),c=t.getWest(),p=t.getEast(),g=1<<e.z,y=p-c,x=a-u,E=y/64,S=-x/Iv[r],M=[0,E,0,S,0,0,a,c,0];if(e.z>0){const D=180/s;zl.multiply(M,M,[D/y+1,0,0,0,D/x+1,0,-.5*D/E,.5*D/S,1])}return M[2]=g,M[5]=e.x,M[8]=e.y,M}function dE(e){const t=Ls-5;e=At(e,-t,t)/t*90;const r=Math.pow(Math.abs(Math.sin(St(e))),3);return Math.round(r*(Iv.length-1))}function Pv(e){const t=[0,0,0],r=ce.identity(new Float64Array(16));return ce.multiply(r,e.pixelMatrix,e.globeMatrix),Ot.transformMat4(t,t,r),new H(t[0],t[1])}function kT(e,t){const r=du(t.lat,t.lng),s=function(u){const c=du(u._center.lat,u._center.lng),p=Ot.fromValues(0,1,0);let g=Ot.cross([],p,c);const y=ce.fromRotation([],-u.angle,c);g=Ot.transformMat4(g,g,y),ce.fromRotation(y,-u._pitch,g);const x=Ot.normalize([],c);return Ot.scale(x,x,rg(u.cameraToCenterDistance/u.pixelsPerMeter)),Ot.transformMat4(x,x,y),Ot.add([],c,x)}(e),a=Ot.subtract([],s,r);return Ot.angle(a,r)}function Lv(e,t){return kT(e,t)>Math.PI/2*1.01}const zT=St(85),Ov=Math.cos(zT),Rv=Math.sin(zT);class qL{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,r){const s=new hu,a=new ea,u=[],c=t+1+2,p=r[0]+1,g=r[0]+1+(1+r.length),y=(x,E,S)=>{let M=x===c-1?x-2:0===x?x:x-1;return M+=S?24575:0,[M,E]};for(let x=0;x<c;++x)s.emplaceBack(...y(x,0,!0));for(let x=0;x<p;++x)for(let E=0;E<c;++E)s.emplaceBack(...y(E,x,(0===E||E===c-1)&&!0));for(let x=0;x<r.length;++x){const E=r[x];for(let S=0;S<c;++S)s.emplaceBack(...y(S,E,!0))}for(let x=0;x<r.length;++x){const E=a.length,S=r[x]+1+2,M=new ea;for(let O=0;O<S-1;O++){const R=O===S-2,B=R?c*(g-r.length+x-O):c;for(let j=0;j<c-1;j++){const V=O*c+j;0===O||R||0===j||j===c-2?(M.emplaceBack(V+1,V,V+B),M.emplaceBack(V+B,V+B+1,V+1)):(a.emplaceBack(V+1,V,V+B),a.emplaceBack(V+B,V+B+1,V+1))}}const D=Ui.simpleSegment(0,E,s.length,a.length-E);for(let O=0;O<M.uint16.length;O+=3)a.emplaceBack(M.uint16[O],M.uint16[O+1],M.uint16[O+2]);const P=Ui.simpleSegment(0,E,s.length,a.length-E);u.push({withoutSkirts:D,withSkirts:P})}return{vertices:s,indices:a,segments:u}}_createGrid(t){const r=this._fillGridMeshWithLods(64,Iv);this._gridSegments=r.segments,this._gridBuffer=t.createVertexBuffer(r.vertices,zh.members),this._gridIndexBuffer=t.createIndexBuffer(r.indices,!0)}_createPoles(t){const r=new ea;for(let p=0;p<=64;p++)r.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=t.createIndexBuffer(r,!0);const s=new Wf,a=new Wf,u=new Wf,c=new Wf;this._poleSegments=[];for(let p=0,g=0;p<ng;p++){const y=360/(1<<p);s.emplaceBack(0,-Xl,0,.5,0),a.emplaceBack(0,-Xl,0,.5,1),u.emplaceBack(0,-Xl,0,.5,.5),c.emplaceBack(0,-Xl,0,.5,.5);for(let x=0;x<=64;x++){let E=x/64,S=0;const M=An(0,y,E),[D,P,O]=pp(Ov,Rv,M,Xl);s.emplaceBack(D,P,O,E,S),a.emplaceBack(D,P,O,E,1-S);const R=St(M);E=.5+.5*Math.sin(R),S=.5+.5*Math.cos(R),u.emplaceBack(D,P,O,E,S),c.emplaceBack(D,P,O,E,1-S)}this._poleSegments.push(Ui.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(s,nd,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(a,nd,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(u,nd,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(c,nd,!1)}getGridBuffers(t,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,r){return[r?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,r?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}}const ig=6371008.8,X_=2*Math.PI*ig;class mf{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new mf(wt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,s=this.lat*r,a=t.lat*r,u=Math.sin(s)*Math.sin(a)+Math.cos(s)*Math.cos(a)*Math.cos((t.lng-this.lng)*r);return ig*Math.acos(Math.min(u,1))}toBounds(t=0){const r=360*t/40075017,s=r/Math.cos(Math.PI/180*this.lat);return new $a(new mf(this.lng-s,this.lat-r),new mf(this.lng+s,this.lat+r))}toEcef(t){const r=rg(t);return du(this.lat,this.lng,Xl+r)}static convert(t){if(t instanceof mf)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new mf(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new mf(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var pr=mf;const BT=0,UT=25.5;function og(e){return X_*Math.cos(e*Math.PI/180)}function zs(e){return(180+e)/360}function ba(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function ji(e,t){return e/og(t)}function pu(e){return 360*e-180}function ws(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function pE(e,t){return e*og(ws(t))}const Ls=85.051129;function Nv(e){return Math.cos(St(At(e,-Ls,Ls)))}function Uh(e,t){const r=At(t,BT,UT),s=Math.pow(2,r);return Nv(e)*X_/(512*s)}function Fv(e){return 1/Math.cos(e*Math.PI/180)}function sg(e,t=0){const r=Math.exp(Math.PI*(1-(e.y+t/$t)/(1<<e.z)*2));return 80150034*r/(r*r+1)/$t/(1<<e.z)}class ri{constructor(t,r,s=0){this.x=+t,this.y=+r,this.z=+s}static fromLngLat(t,r=0){const s=pr.convert(t);return new ri(zs(s.lng),ba(s.lat),ji(r,s.lat))}toLngLat(){return new pr(pu(this.x),ws(this.y))}toAltitude(){return pE(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/X_*Fv(ws(this.y))}}function kv(e,t,r,s,a,u,c,p,g){const y=(t+s)/2,x=(r+a)/2,E=new H(y,x);p(E),function(S,M,D,P,O,R){const B=D-O,j=P-R;return Math.abs((P-M)*B-(D-S)*j)/Math.hypot(B,j)}(E.x,E.y,u.x,u.y,c.x,c.y)>=g?(kv(e,t,r,y,x,u,E,p,g),kv(e,y,x,s,a,E,c,p,g)):e.push(c)}function mE(e,t,r){let s=e[0],a=s.x,u=s.y;t(s);const c=[s];for(let p=1;p<e.length;p++){const g=e[p],{x:y,y:x}=g;t(g),kv(c,a,u,y,x,s,g,t,r),a=y,u=x,s=g}return c}function gE(e,t,r,s){if(s(t,r)){const a=t.add(r)._mult(.5);gE(e,t,a,s),gE(e,a,r,s)}else e.push(r)}function $L(e,t){let r=e[0];const s=[r];for(let a=1;a<e.length;a++){const u=e[a];gE(s,r,u,t),r=u}return s}const od=Math.pow(2,14)-1,ag=-od-1;function _E(e,t){const r=Math.round(e.x*t),s=Math.round(e.y*t);return e.x=At(r,ag,od),e.y=At(s,ag,od),(r<e.x||r>e.x+1||s<e.y||s>e.y+1)&&Gt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Rc(e,t,r){const s=e.loadGeometry(),a=e.extent,u=$t/a;if(t&&r&&r.projection.isReprojectedInTileSpace){const c=1<<t.z,{scale:p,x:g,y,projection:x}=r,E=S=>{const M=pu((t.x+S.x/a)/c),D=ws((t.y+S.y/a)/c),P=x.project(M,D);S.x=(P.x*p-g)*a,S.y=(P.y*p-y)*a};for(let S=0;S<s.length;S++)if(1!==e.type)s[S]=mE(s[S],E,1);else{const M=[];for(const D of s[S])D.x<0||D.x>=a||D.y<0||D.y>=a||(E(D),M.push(D));s[S]=M}}for(const c of s)for(const p of c)_E(p,u);return s}function ih(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Rc(e):[]}}function lg(e,t,r,s,a){e.emplaceBack(2*t+(s+1)/2,2*r+(a+1)/2)}function Y_(e,t,r){e.emplaceBack(t.x,t.y,t.z,16384*r[0],16384*r[1],16384*r[2])}class J_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new hu,this.indexArray=new ea,this.segments=new Ui,this.programConfigurations=new ff(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s,a){const u=this.layers[0],c=[];let p=null;"circle"===u.type&&(p=u.layout.get("circle-sort-key"));for(const{feature:y,id:x,index:E,sourceLayerIndex:S}of t){const M=this.layers[0]._featureFilter.needGeometry,D=ih(y,M);if(!this.layers[0]._featureFilter.filter(new ss(this.zoom),D,s))continue;const P=p?p.evaluate(D,{},s):void 0,O={id:x,properties:y.properties,type:y.type,sourceLayerIndex:S,index:E,geometry:M?D.geometry:Rc(y,s,a),patterns:{},sortKey:P};c.push(O)}p&&c.sort((y,x)=>y.sortKey-x.sortKey);let g=null;"globe"===a.projection.name&&(this.globeExtVertexArray=new Hf,g=a.projection);for(const y of c){const{geometry:x,index:E,sourceLayerIndex:S}=y,M=t[E].feature;this.addFeature(y,x,E,r.availableImages,s,g,r.brightness),r.featureIndex.insert(M,x,E,S,this.index)}}update(t,r,s,a,u){const c=0!==Object.keys(t).length;c&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,r,c?this.stateDependentLayers:this.layers,s,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Q0.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,yT.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,r,s,a,u,c,p){for(const g of r)for(const y of g){const x=y.x,E=y.y;if(x<0||x>=$t||E<0||E>=$t)continue;if(c){const D=c.projectTilePoint(x,E,u),P=c.upVector(u,x,E),O=this.globeExtVertexArray;Y_(O,D,P),Y_(O,D,P),Y_(O,D,P),Y_(O,D,P)}const S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),M=S.vertexLength;lg(this.layoutVertexArray,x,E,-1,-1),lg(this.layoutVertexArray,x,E,1,-1),lg(this.layoutVertexArray,x,E,1,1),lg(this.layoutVertexArray,x,E,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+2,M+3),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},a,u,p)}}function zv(e,t){for(let r=0;r<e.length;r++)if(_f(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(_f(e,t[r]))return!0;return!!Uv(e,t)}function K_(e,t,r){return!!_f(e,t)||!!Q_(t,e,r)}function jT(e,t){if(1===e.length)return gf(t,e[0]);for(let r=0;r<t.length;r++){const s=t[r];for(let a=0;a<s.length;a++)if(_f(e,s[a]))return!0}for(let r=0;r<e.length;r++)if(gf(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(Uv(e,t[r]))return!0;return!1}function Bv(e,t,r){if(e.length>1){if(Uv(e,t))return!0;for(let s=0;s<t.length;s++)if(Q_(t[s],e,r))return!0}for(let s=0;s<e.length;s++)if(Q_(e[s],t,r))return!0;return!1}function Uv(e,t){if(0===e.length||0===t.length)return!1;for(let r=0;r<e.length-1;r++){const s=e[r],a=e[r+1];for(let u=0;u<t.length-1;u++)if(jv(s,a,t[u],t[u+1]))return!0}return!1}function jv(e,t,r,s){return Ve(e,r,s)!==Ve(t,r,s)&&Ve(e,t,r)!==Ve(e,t,s)}function Q_(e,t,r){const s=r*r;if(1===t.length)return e.distSqr(t[0])<s;for(let a=1;a<t.length;a++)if(Vv(e,t[a-1],t[a])<s)return!0;return!1}function Vv(e,t,r){const s=t.distSqr(r);if(0===s)return e.distSqr(t);const a=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/s;return e.distSqr(a<0?t:a>1?r:r.sub(t)._mult(a)._add(t))}function gf(e,t){let r,s,a,u=!1;for(let c=0;c<e.length;c++){r=e[c];for(let p=0,g=r.length-1;p<r.length;g=p++)s=r[p],a=r[g],s.y>t.y!=a.y>t.y&&t.x<(a.x-s.x)*(t.y-s.y)/(a.y-s.y)+s.x&&(u=!u)}return u}function _f(e,t){let r=!1;for(let s=0,a=e.length-1;s<e.length;a=s++){const u=e[s],c=e[a];u.y>t.y!=c.y>t.y&&t.x<(c.x-u.x)*(t.y-u.y)/(c.y-u.y)+u.x&&(r=!r)}return r}function ty(e,t,r,s,a){for(const c of e)if(t<=c.x&&r<=c.y&&s>=c.x&&a>=c.y)return!0;const u=[new H(t,r),new H(t,a),new H(s,a),new H(s,r)];if(e.length>2)for(const c of u)if(_f(e,c))return!0;for(let c=0;c<e.length-1;c++)if(ey(e[c],e[c+1],u))return!0;return!1}function ey(e,t,r){const s=r[0],a=r[2];if(e.x<s.x&&t.x<s.x||e.x>a.x&&t.x>a.x||e.y<s.y&&t.y<s.y||e.y>a.y&&t.y>a.y)return!1;const u=Ve(e,t,r[0]);return u!==Ve(e,t,r[1])||u!==Ve(e,t,r[2])||u!==Ve(e,t,r[3])}function gp(e,t,r,s,a,u){let c=t.y-e.y,p=e.x-t.x;if(u=u||0){const g=c*c+p*p;if(0===g)return!0;const y=Math.sqrt(g);c/=y,p/=y}return!((r.x-e.x)*c+(r.y-e.y)*p-u<0||(s.x-e.x)*c+(s.y-e.y)*p-u<0||(a.x-e.x)*c+(a.y-e.y)*p-u<0)}function ug(e,t,r,s,a,u,c){return!(gp(e,t,s,a,u,c)||gp(t,r,s,a,u,c)||gp(r,e,s,a,u,c)||gp(s,a,e,t,r,c)||gp(a,u,e,t,r,c)||gp(u,s,e,t,r,c))}function jh(e,t,r){const s=t.paint.get(e).value;return"constant"===s.kind?s.value:r.programConfigurations.get(t.id).getMaxValue(e)}function uc(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function sd(e,t,r,s,a){if(!t[0]&&!t[1])return e;const u=H.convert(t)._mult(a);"viewport"===r&&u._rotate(-s);const c=[];for(let p=0;p<e.length;p++)c.push(e[p].sub(u));return c}function ny(e,t,r,s){const a=H.convert(e)._mult(s);return"viewport"===t&&a._rotate(-r),a}Fn(J_,"CircleBucket",{omit:["layers"]});const VT=new ys({"circle-sort-key":new Xn(It.layout_circle["circle-sort-key"]),visibility:new un(It.layout_circle.visibility)});var GT={paint:new ys({"circle-radius":new Xn(It.paint_circle["circle-radius"]),"circle-color":new Xn(It.paint_circle["circle-color"]),"circle-blur":new Xn(It.paint_circle["circle-blur"]),"circle-opacity":new Xn(It.paint_circle["circle-opacity"]),"circle-translate":new un(It.paint_circle["circle-translate"]),"circle-translate-anchor":new un(It.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new un(It.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new un(It.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Xn(It.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Xn(It.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Xn(It.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new un(It.paint_circle["circle-emissive-strength"])}),layout:VT};const yE=ce.create(),_p=(e,t,r,s,a,u)=>{const c=e.transform,p="globe"===c.projection.name;let g;if("map"===u.paint.get("circle-pitch-alignment"))if(p){const x=cE(c.zoom,t.canonical)*c._pixelsPerMercatorPixel;g=Float32Array.from([x,0,0,x])}else g=c.calculatePixelsToTileUnitsMatrix(r);else g=new Float32Array([c.pixelsToGLUnits[0],0,0,c.pixelsToGLUnits[1]]);const y={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(c.projection),u_matrix:e.translatePosMatrix(t.projMatrix,r,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:or.devicePixelRatio,u_extrude_scale:g,u_inv_rot_matrix:yE,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(p){y.u_inv_rot_matrix=s,y.u_merc_center=a,y.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],y.u_zoom_transition=da(c.zoom);const x=a[0]*$t,E=a[1]*$t;y.u_up_dir=c.projection.upVector(new Vu(0,0,0),x,E)}return y},vE=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function xE(e,t,r,s,a,u,c,p,g){if(u&&e.queryGeometry.isAboveHorizon)return!1;u&&(g*=e.pixelToTileUnitsFactor);const y=e.tileID.canonical,x=r.projection.upVectorScale(y,r.center.lat,r.worldSize).metersToTile;for(const E of t)for(const S of E){const M=S.add(p),D=a&&r.elevation?r.elevation.exaggeration()*a.getElevationAt(M.x,M.y,!0):0,P=r.projection.projectTilePoint(M.x,M.y,y);if(D>0){const j=r.projection.upVector(y,M.x,M.y);P.x+=j[0]*x*D,P.y+=j[1]*x*D,P.z+=j[2]*x*D}const O=u?M:qT(P.x,P.y,P.z,s),R=u?e.tilespaceRays.map(j=>$T(j,D)):e.queryGeometry.screenGeometry,B=Oi.transformMat4([],[P.x,P.y,P.z,1],s);if(!c&&u?g*=B[3]/r.cameraToCenterDistance:c&&!u&&(g*=r.cameraToCenterDistance/B[3]),u){const j=ws((S.y/$t+y.y)/(1<<y.z));g/=r.projection.pixelsPerMeter(j,1)/ji(1,j)}if(K_(R,O,g))return!0}return!1}function qT(e,t,r,s){const a=Oi.transformMat4([],[e,t,r,1],s);return new H(a[0]/a[3],a[1]/a[3])}const ry=Ot.fromValues(0,0,0),iy=Ot.fromValues(0,0,1);function $T(e,t){const r=Ot.create();return ry[2]=t,e.intersectsPlane(ry,iy,r),new H(r[0],r[1])}class Gv extends J_{}function ad(e,{width:t,height:r},s,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==t*r*s)throw new RangeError("mismatched image size")}else a=new Uint8Array(t*r*s);return e.width=t,e.height=r,e.data=a,e}function HT(e,t,r){const{width:s,height:a}=t;s===e.width&&a===e.height||(bE(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,s),height:Math.min(e.height,a)},r),e.width=s,e.height=a,e.data=t.data)}function bE(e,t,r,s,a,u){if(0===a.width||0===a.height)return t;if(a.width>e.width||a.height>e.height||r.x>e.width-a.width||r.y>e.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>t.width||a.height>t.height||s.x>t.width-a.width||s.y>t.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const c=e.data,p=t.data;for(let g=0;g<a.height;g++){const y=((r.y+g)*e.width+r.x)*u,x=((s.y+g)*t.width+s.x)*u;for(let E=0;E<a.width*u;E++)p[x+E]=c[y+E]}return t}Fn(Gv,"HeatmapBucket",{omit:["layers"]});class oh{constructor(t,r){ad(this,t,1,r)}resize(t){HT(this,new oh(t),1)}clone(){return new oh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,a,u){bE(t,r,s,a,u,1)}}class Hs{constructor(t,r){ad(this,t,4,r)}resize(t){HT(this,new Hs(t),4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Hs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,a,u){bE(t,r,s,a,u,4)}}class ZT{constructor(t,r){this.width=t.width,this.height=t.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}Fn(oh,"AlphaImage"),Fn(Hs,"RGBAImage");const HL=new ys({visibility:new un(It.layout_heatmap.visibility)});var oy={paint:new ys({"heatmap-radius":new Xn(It.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Xn(It.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new un(It.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Pm(It.paint_heatmap["heatmap-color"]),"heatmap-opacity":new un(It.paint_heatmap["heatmap-opacity"])}),layout:HL};function sy(e){const t={},r=e.resolution||256,s=e.clips?e.clips.length:1,a=e.image||new Hs({width:r,height:s}),u=(c,p,g)=>{t[e.evaluationKey]=g;const y=e.expression.evaluate(t);y&&(a.data[c+p+0]=Math.floor(255*y.r/y.a),a.data[c+p+1]=Math.floor(255*y.g/y.a),a.data[c+p+2]=Math.floor(255*y.b/y.a),a.data[c+p+3]=Math.floor(255*y.a))};if(e.clips)for(let c=0,p=0;c<s;++c,p+=4*r)for(let g=0,y=0;g<r;g++,y+=4){const x=g/(r-1),{start:E,end:S}=e.clips[c];u(p,y,E*(1-x)+S*x)}else for(let c=0,p=0;c<r;c++,p+=4)u(0,p,c/(r-1));return a}const qv=new ys({visibility:new un(It.layout_hillshade.visibility)});var $v={paint:new ys({"hillshade-illumination-direction":new un(It.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new un(It.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new un(It.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new un(It.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new un(It.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new un(It.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new un(It.paint_hillshade["hillshade-emissive-strength"])}),layout:qv};const yp=yr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Hv}=yp;var cg={exports:{}};function yf(e,t,r){r=r||2;var s,a,u,c,p,g,y,x=t&&t.length,E=x?t[0]*r:e.length,S=hg(e,0,E,r,!0),M=[];if(!S||S.next===S.prev)return M;if(x&&(S=function(P,O,R,B){var j,V,U,G=[];for(j=0,V=O.length;j<V;j++)(U=hg(P,O[j]*B,j<V-1?O[j+1]*B:P.length,B,!1))===U.next&&(U.steiner=!0),G.push(XT(U));for(G.sort(fg),j=0;j<G.length;j++)R=WT(G[j],R);return R}(e,t,S,r)),e.length>80*r){s=u=e[0],a=c=e[1];for(var D=r;D<E;D+=r)(p=e[D])<s&&(s=p),(g=e[D+1])<a&&(a=g),p>u&&(u=p),g>c&&(c=g);y=0!==(y=Math.max(u-s,c-a))?32767/y:0}return ld(S,M,r,s,a,y,0),M}function hg(e,t,r,s,a){var u,c;if(a===Jv(e,t,r,s)>0)for(u=t;u<r;u+=s)c=Yv(u,e[u],e[u+1],c);else for(u=r-s;u>=t;u-=s)c=Yv(u,e[u],e[u+1],c);return c&&ly(c,c.next)&&(hd(c),c=c.next),c}function cc(e,t){if(!e)return e;t||(t=e);var r,s=e;do{if(r=!1,s.steiner||!ly(s,s.next)&&0!==pa(s.prev,s,s.next))s=s.next;else{if(hd(s),(s=t=s.prev)===s.next)break;r=!0}}while(r||s!==t);return t}function ld(e,t,r,s,a,u,c){if(e){!c&&u&&function(x,E,S,M){var D=x;do{0===D.z&&(D.z=Xv(D.x,D.y,E,S,M)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next}while(D!==x);D.prevZ.nextZ=null,D.prevZ=null,function(P){var O,R,B,j,V,U,G,Z,Q=1;do{for(R=P,P=null,V=null,U=0;R;){for(U++,B=R,G=0,O=0;O<Q&&(G++,B=B.nextZ);O++);for(Z=Q;G>0||Z>0&&B;)0!==G&&(0===Z||!B||R.z<=B.z)?(j=R,R=R.nextZ,G--):(j=B,B=B.nextZ,Z--),V?V.nextZ=j:P=j,j.prevZ=V,V=j;R=B}V.nextZ=null,Q*=2}while(U>1)}(D)}(e,s,a,u);for(var p,g,y=e;e.prev!==e.next;)if(p=e.prev,g=e.next,u?ay(e,s,a,u):Zv(e))t.push(p.i/r|0),t.push(e.i/r|0),t.push(g.i/r|0),hd(e),e=g.next,y=g.next;else if((e=g)===y){c?1===c?ld(e=ZL(cc(e),t,r),t,r,s,a,u,2):2===c&&Wv(e,t,r,s,a,u):ld(cc(e),t,r,s,a,u,1);break}}}function Zv(e){var t=e.prev,r=e,s=e.next;if(pa(t,r,s)>=0)return!1;for(var a=t.x,u=r.x,c=s.x,p=t.y,g=r.y,y=s.y,x=a<u?a<c?a:c:u<c?u:c,E=p<g?p<y?p:y:g<y?g:y,S=a>u?a>c?a:c:u>c?u:c,M=p>g?p>y?p:y:g>y?g:y,D=s.next;D!==t;){if(D.x>=x&&D.x<=S&&D.y>=E&&D.y<=M&&vf(a,p,u,g,c,y,D.x,D.y)&&pa(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}function ay(e,t,r,s){var a=e.prev,u=e,c=e.next;if(pa(a,u,c)>=0)return!1;for(var p=a.x,g=u.x,y=c.x,x=a.y,E=u.y,S=c.y,M=p<g?p<y?p:y:g<y?g:y,D=x<E?x<S?x:S:E<S?E:S,P=p>g?p>y?p:y:g>y?g:y,O=x>E?x>S?x:S:E>S?E:S,R=Xv(M,D,t,r,s),B=Xv(P,O,t,r,s),j=e.prevZ,V=e.nextZ;j&&j.z>=R&&V&&V.z<=B;){if(j.x>=M&&j.x<=P&&j.y>=D&&j.y<=O&&j!==a&&j!==c&&vf(p,x,g,E,y,S,j.x,j.y)&&pa(j.prev,j,j.next)>=0||(j=j.prevZ,V.x>=M&&V.x<=P&&V.y>=D&&V.y<=O&&V!==a&&V!==c&&vf(p,x,g,E,y,S,V.x,V.y)&&pa(V.prev,V,V.next)>=0))return!1;V=V.nextZ}for(;j&&j.z>=R;){if(j.x>=M&&j.x<=P&&j.y>=D&&j.y<=O&&j!==a&&j!==c&&vf(p,x,g,E,y,S,j.x,j.y)&&pa(j.prev,j,j.next)>=0)return!1;j=j.prevZ}for(;V&&V.z<=B;){if(V.x>=M&&V.x<=P&&V.y>=D&&V.y<=O&&V!==a&&V!==c&&vf(p,x,g,E,y,S,V.x,V.y)&&pa(V.prev,V,V.next)>=0)return!1;V=V.nextZ}return!0}function ZL(e,t,r){var s=e;do{var a=s.prev,u=s.next.next;!ly(a,u)&&YT(a,s,s.next,u)&&cd(a,u)&&cd(u,a)&&(t.push(a.i/r|0),t.push(s.i/r|0),t.push(u.i/r|0),hd(s),hd(s.next),s=e=u),s=s.next}while(s!==e);return cc(s)}function Wv(e,t,r,s,a,u){var c=e;do{for(var p=c.next.next;p!==c.prev;){if(c.i!==p.i&&EE(c,p)){var g=IE(c,p);return c=cc(c,c.next),g=cc(g,g.next),ld(c,t,r,s,a,u,0),void ld(g,t,r,s,a,u,0)}p=p.next}c=c.next}while(c!==e)}function fg(e,t){return e.x-t.x}function WT(e,t){var r=function(a,u){var c,p=u,g=a.x,y=a.y,x=-1/0;do{if(y<=p.y&&y>=p.next.y&&p.next.y!==p.y){var E=p.x+(y-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(E<=g&&E>x&&(x=E,c=p.x<p.next.x?p:p.next,E===g))return c}p=p.next}while(p!==u);if(!c)return null;var S,M=c,D=c.x,P=c.y,O=1/0;p=c;do{g>=p.x&&p.x>=D&&g!==p.x&&vf(y<P?g:x,y,D,P,y<P?x:g,y,p.x,p.y)&&(S=Math.abs(y-p.y)/(g-p.x),cd(p,a)&&(S<O||S===O&&(p.x>c.x||p.x===c.x&&wE(c,p)))&&(c=p,O=S)),p=p.next}while(p!==M);return c}(e,t);if(!r)return t;var s=IE(r,e);return cc(s,s.next),cc(r,r.next)}function wE(e,t){return pa(e.prev,e,t.prev)<0&&pa(t.next,e,e.next)<0}function Xv(e,t,r,s,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function XT(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function vf(e,t,r,s,a,u,c,p){return(a-c)*(t-p)>=(e-c)*(u-p)&&(e-c)*(s-p)>=(r-c)*(t-p)&&(r-c)*(u-p)>=(a-c)*(s-p)}function EE(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,s){var a=r;do{if(a.i!==r.i&&a.next.i!==r.i&&a.i!==s.i&&a.next.i!==s.i&&YT(a,a.next,r,s))return!0;a=a.next}while(a!==r);return!1}(e,t)&&(cd(e,t)&&cd(t,e)&&function(r,s){var a=r,u=!1,c=(r.x+s.x)/2,p=(r.y+s.y)/2;do{a.y>p!=a.next.y>p&&a.next.y!==a.y&&c<(a.next.x-a.x)*(p-a.y)/(a.next.y-a.y)+a.x&&(u=!u),a=a.next}while(a!==r);return u}(e,t)&&(pa(e.prev,e,t.prev)||pa(e,t.prev,t))||ly(e,t)&&pa(e.prev,e,e.next)>0&&pa(t.prev,t,t.next)>0)}function pa(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function ly(e,t){return e.x===t.x&&e.y===t.y}function YT(e,t,r,s){var a=ud(pa(e,t,r)),u=ud(pa(e,t,s)),c=ud(pa(r,s,e)),p=ud(pa(r,s,t));return a!==u&&c!==p||!(0!==a||!uy(e,r,t))||!(0!==u||!uy(e,s,t))||!(0!==c||!uy(r,e,s))||!(0!==p||!uy(r,t,s))}function uy(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function ud(e){return e>0?1:e<0?-1:0}function cd(e,t){return pa(e.prev,e,e.next)<0?pa(e,t,e.next)>=0&&pa(e,e.prev,t)>=0:pa(e,t,e.prev)<0||pa(e,e.next,t)<0}function IE(e,t){var r=new vp(e.i,e.x,e.y),s=new vp(t.i,t.x,t.y),a=e.next,u=t.prev;return e.next=t,t.prev=e,r.next=a,a.prev=r,s.next=r,r.prev=s,u.next=s,s.prev=u,s}function Yv(e,t,r,s){var a=new vp(e,t,r);return s?(a.next=s.next,a.prev=s,s.next.prev=a,s.next=a):(a.prev=a,a.next=a),a}function hd(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function vp(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Jv(e,t,r,s){for(var a=0,u=t,c=r-s;u<r;u+=s)a+=(e[c]-e[u])*(e[u+1]+e[c+1]),c=u;return a}cg.exports=yf,cg.exports.default=yf,yf.deviation=function(e,t,r,s){var a=t&&t.length,u=Math.abs(Jv(e,0,a?t[0]*r:e.length,r));if(a)for(var c=0,p=t.length;c<p;c++)u-=Math.abs(Jv(e,t[c]*r,c<p-1?t[c+1]*r:e.length,r));var g=0;for(c=0;c<s.length;c+=3){var y=s[c]*r,x=s[c+1]*r,E=s[c+2]*r;g+=Math.abs((e[y]-e[E])*(e[x+1]-e[y+1])-(e[y]-e[x])*(e[E+1]-e[y+1]))}return 0===u&&0===g?0:Math.abs((g-u)/u)},yf.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},s=0,a=0;a<e.length;a++){for(var u=0;u<e[a].length;u++)for(var c=0;c<t;c++)r.vertices.push(e[a][u][c]);a>0&&r.holes.push(s+=e[a-1].length)}return r};var dg=mt(cg.exports);function Kv(e,t){const r=e.length;if(r<=1)return[e];const s=[];let a,u;for(let c=0;c<r;c++){const p=sn(e[c]);0!==p&&(e[c].area=Math.abs(p),void 0===u&&(u=p<0),u===p<0?(a&&s.push(a),a=[e[c]]):a.push(e[c]))}if(a&&s.push(a),t>1)for(let c=0;c<s.length;c++)s[c].length<=t||(Ms(s[c],t,1,s[c].length-1,CE),s[c]=s[c].slice(0,t));return s}function CE(e,t){return t.area-e.area}function SE(e,t,r){const s=r.patternDependencies;let a=!1;for(const u of t){const c=u.paint.get(`${e}-pattern`);c.isConstant()||(a=!0);const p=c.constantOr(null);p&&(a=!0,s[p]=!0)}return a}function Qv(e,t,r,s,a){const u=a.patternDependencies;for(const c of t){const p=c.paint.get(`${e}-pattern`).value;if("constant"!==p.kind){let g=p.evaluate({zoom:s},r,{},a.availableImages);g=g&&g.name?g.name:g,u[g]=!0,r.patterns[c.id]=g}}return r}class fd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new hu,this.indexArray=new ea,this.indexArray2=new Oh,this.programConfigurations=new ff(t.layers,t.zoom),this.segments=new Ui,this.segments2=new Ui,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=t.projection}populate(t,r,s,a){this.hasPattern=SE("fill",this.layers,r);const u=this.layers[0].layout.get("fill-sort-key"),c=[];for(const{feature:p,id:g,index:y,sourceLayerIndex:x}of t){const E=this.layers[0]._featureFilter.needGeometry,S=ih(p,E);if(!this.layers[0]._featureFilter.filter(new ss(this.zoom),S,s))continue;const M=u?u.evaluate(S,{},s,r.availableImages):void 0,D={id:g,properties:p.properties,type:p.type,sourceLayerIndex:x,index:y,geometry:E?S.geometry:Rc(p,s,a),patterns:{},sortKey:M};c.push(D)}u&&c.sort((p,g)=>p.sortKey-g.sortKey);for(const p of c){const{geometry:g,index:y,sourceLayerIndex:x}=p;if(this.hasPattern){const E=Qv("fill",this.layers,p,this.zoom,r);this.patternFeatures.push(E)}else this.addFeature(p,g,y,s,{},r.availableImages,r.brightness);r.featureIndex.insert(t[y].feature,g,y,x,this.index)}}update(t,r,s,a,u){const c=0!==Object.keys(t).length;c&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,r,c?this.stateDependentLayers:this.layers,s,a,u)}addFeatures(t,r,s,a,u,c){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,s,a,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Hv),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,s,a,u,c=[],p){for(const g of Kv(r,500)){let y=0;for(const P of g)y+=P.length;const x=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),E=x.vertexLength,S=[],M=[];for(const P of g){if(0===P.length)continue;P!==g[0]&&M.push(S.length/2);const O=this.segments2.prepareSegment(P.length,this.layoutVertexArray,this.indexArray2),R=O.vertexLength;this.layoutVertexArray.emplaceBack(P[0].x,P[0].y),this.indexArray2.emplaceBack(R+P.length-1,R),S.push(P[0].x),S.push(P[0].y);for(let B=1;B<P.length;B++)this.layoutVertexArray.emplaceBack(P[B].x,P[B].y),this.indexArray2.emplaceBack(R+B-1,R+B),S.push(P[B].x),S.push(P[B].y);O.vertexLength+=P.length,O.primitiveLength+=P.length}const D=dg(S,M);for(let P=0;P<D.length;P+=3)this.indexArray.emplaceBack(E+D[P],E+D[P+1],E+D[P+2]);x.vertexLength+=y,x.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,u,c,a,p)}}Fn(fd,"FillBucket",{omit:["layers","patternFeatures"]});const JT=new ys({"fill-sort-key":new Xn(It.layout_fill["fill-sort-key"]),visibility:new un(It.layout_fill.visibility)});var xp={paint:new ys({"fill-antialias":new un(It.paint_fill["fill-antialias"]),"fill-opacity":new Xn(It.paint_fill["fill-opacity"]),"fill-color":new Xn(It.paint_fill["fill-color"]),"fill-outline-color":new Xn(It.paint_fill["fill-outline-color"]),"fill-translate":new un(It.paint_fill["fill-translate"]),"fill-translate-anchor":new un(It.paint_fill["fill-translate-anchor"]),"fill-pattern":new Xn(It.paint_fill["fill-pattern"]),"fill-emissive-strength":new un(It.paint_fill["fill-emissive-strength"])}),layout:JT};const bp=yr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),KT=yr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),ME=yr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),TE=yr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),QT=yr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:tD}=bp;var wp={},eD=kt,cy=pg;function pg(e,t,r,s,a){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=s,this._values=a,e.readFields(t1,this,t)}function t1(e,t,r){1==e?t.id=r.readVarint():2==e?function(s,a){for(var u=s.readVarint()+s.pos;s.pos<u;){var c=a._keys[s.readVarint()],p=a._values[s.readVarint()];a.properties[c]=p}}(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function DE(e){for(var t,r,s=0,a=0,u=e.length,c=u-1;a<u;c=a++)s+=((r=e[c]).x-(t=e[a]).x)*(t.y+r.y);return s}pg.types=["Unknown","Point","LineString","Polygon"],pg.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,s=1,a=0,u=0,c=0,p=[];e.pos<r;){if(a<=0){var g=e.readVarint();s=7&g,a=g>>3}if(a--,1===s||2===s)u+=e.readSVarint(),c+=e.readSVarint(),1===s&&(t&&p.push(t),t=[]),t.push(new eD(u,c));else{if(7!==s)throw new Error("unknown command "+s);t&&t.push(t[0].clone())}}return t&&p.push(t),p},pg.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,s=0,a=0,u=0,c=1/0,p=-1/0,g=1/0,y=-1/0;e.pos<t;){if(s<=0){var x=e.readVarint();r=7&x,s=x>>3}if(s--,1===r||2===r)(a+=e.readSVarint())<c&&(c=a),a>p&&(p=a),(u+=e.readSVarint())<g&&(g=u),u>y&&(y=u);else if(7!==r)throw new Error("unknown command "+r)}return[c,g,p,y]},pg.prototype.toGeoJSON=function(e,t,r){var s,a,u=this.extent*Math.pow(2,r),c=this.extent*e,p=this.extent*t,g=this.loadGeometry(),y=pg.types[this.type];function x(M){for(var D=0;D<M.length;D++){var P=M[D];M[D]=[360*(P.x+c)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(P.y+p)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var E=[];for(s=0;s<g.length;s++)E[s]=g[s][0];x(g=E);break;case 2:for(s=0;s<g.length;s++)x(g[s]);break;case 3:for(g=function(M){var D=M.length;if(D<=1)return[M];for(var P,O,R=[],B=0;B<D;B++){var j=DE(M[B]);0!==j&&(void 0===O&&(O=j<0),O===j<0?(P&&R.push(P),P=[M[B]]):P.push(M[B]))}return P&&R.push(P),R}(g),s=0;s<g.length;s++)for(a=0;a<g[s].length;a++)x(g[s][a])}1===g.length?g=g[0]:y="Multi"+y;var S={type:"Feature",geometry:{type:y,coordinates:g},properties:this.properties};return"id"in this&&(S.id=this.id),S};var nD=cy,AE=e1;function e1(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(rD,this,t),this.length=this._features.length}function rD(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(s){for(var a=null,u=s.readVarint()+s.pos;s.pos<u;){var c=s.readVarint()>>3;a=1===c?s.readString():2===c?s.readFloat():3===c?s.readDouble():4===c?s.readVarint64():5===c?s.readVarint():6===c?s.readSVarint():7===c?s.readBoolean():null}return a}(r))}e1.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new nD(this._pbf,t,this.extent,this._keys,this._values)};var PE=AE;function iD(e,t,r){if(3===e){var s=new PE(r,r.readVarint()+r.pos);s.length&&(t[s.name]=s)}}var n1=wp.VectorTile=function(e,t){this.layers=e.readFields(iD,{},t)},r1=wp.VectorTileFeature=cy;function mg(e,t,r,s){const a=[],u=0===s?(c,p,g,y,x,E)=>{c.push(new H(E,g+(E-p)/(y-p)*(x-g)))}:(c,p,g,y,x,E)=>{c.push(new H(p+(E-g)/(x-g)*(y-p),E))};for(const c of e){const p=[];for(const g of c){if(g.length<=2)continue;const y=[];for(let S=0;S<g.length-1;S++){const M=g[S].x,D=g[S].y,P=g[S+1].x,O=g[S+1].y,R=0===s?M:D,B=0===s?P:O;R<t?B>t&&u(y,M,D,P,O,t):R>r?B<r&&u(y,M,D,P,O,r):y.push(g[S]),B<t&&R>=t&&u(y,M,D,P,O,t),B>r&&R<=r&&u(y,M,D,P,O,r)}let x=g[g.length-1];const E=0===s?x.x:x.y;E>=t&&E<=r&&y.push(x),y.length&&(x=y[y.length-1],y[0].x===x.x&&y[0].y===x.y||y.push(y[0]),p.push(y))}p.length&&a.push(p)}return a}wp.VectorTileLayer=AE;class i1{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const s=t[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}var sh={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(e,t,r,s,a){var u,c,p=8*a-s-1,g=(1<<p)-1,y=g>>1,x=-7,E=r?a-1:0,S=r?-1:1,M=e[t+E];for(E+=S,u=M&(1<<-x)-1,M>>=-x,x+=p;x>0;u=256*u+e[t+E],E+=S,x-=8);for(c=u&(1<<-x)-1,u>>=-x,x+=s;x>0;c=256*c+e[t+E],E+=S,x-=8);if(0===u)u=1-y;else{if(u===g)return c?NaN:1/0*(M?-1:1);c+=Math.pow(2,s),u-=y}return(M?-1:1)*c*Math.pow(2,u-s)},write:function(e,t,r,s,a,u){var c,p,g,y=8*u-a-1,x=(1<<y)-1,E=x>>1,S=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,M=s?0:u-1,D=s?1:-1,P=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(p=isNaN(t)?1:0,c=x):(c=Math.floor(Math.log(t)/Math.LN2),t*(g=Math.pow(2,-c))<1&&(c--,g*=2),(t+=c+E>=1?S/g:S*Math.pow(2,1-E))*g>=2&&(c++,g/=2),c+E>=x?(p=0,c=x):c+E>=1?(p=(t*g-1)*Math.pow(2,a),c+=E):(p=t*Math.pow(2,E-1)*Math.pow(2,a),c=0));a>=8;e[r+M]=255&p,M+=D,p/=256,a-=8);for(c=c<<a|p,y+=a;y>0;e[r+M]=255&c,M+=D,c/=256,y-=8);e[r+M-D]|=128*P}},o1=Ho,s1=sh;function Ho(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Ho.Varint=0,Ho.Fixed64=1,Ho.Bytes=2,Ho.Fixed32=5;var Nc=4294967296,hy=1/Nc,LE=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function xf(e){return e.type===Ho.Bytes?e.readVarint()+e.pos:e.pos+1}function fy(e,t,r){var s=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(s);for(var a=r.pos-1;a>=e;a--)r.buf[a+s]=r.buf[a]}function Vh(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function OE(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function oD(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function WL(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function wa(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function sD(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function a1(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function aD(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function lD(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function Ip(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function dd(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function l1(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}Ho.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),a=s>>3,u=this.pos;this.type=7&s,e(a,t,this),this.pos===u&&this.skip(s)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Ip(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=l1(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Ip(this.buf,this.pos)+Ip(this.buf,this.pos+4)*Nc;return this.pos+=8,e},readSFixed64:function(){var e=Ip(this.buf,this.pos)+l1(this.buf,this.pos+4)*Nc;return this.pos+=8,e},readFloat:function(){var e=s1.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=s1.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,s=this.buf;return t=127&(r=s[this.pos++]),r<128?t:(t|=(127&(r=s[this.pos++]))<<7,r<128?t:(t|=(127&(r=s[this.pos++]))<<14,r<128?t:(t|=(127&(r=s[this.pos++]))<<21,r<128?t:function(a,u,c){var p,g,y=c.buf;if(p=(112&(g=y[c.pos++]))>>4,g<128||(p|=(127&(g=y[c.pos++]))<<3,g<128)||(p|=(127&(g=y[c.pos++]))<<10,g<128)||(p|=(127&(g=y[c.pos++]))<<17,g<128)||(p|=(127&(g=y[c.pos++]))<<24,g<128)||(p|=(1&(g=y[c.pos++]))<<31,g<128))return function Ep(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}(a,p,u);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=s[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&LE?LE.decode(this.buf.subarray(t,e)):function(r,s,a){for(var u="",c=s;c<a;){var p,g,y,x=r[c],E=null,S=x>239?4:x>223?3:x>191?2:1;if(c+S>a)break;1===S?x<128&&(E=x):2===S?128==(192&(p=r[c+1]))&&(E=(31&x)<<6|63&p)<=127&&(E=null):3===S?(g=r[c+2],128==(192&(p=r[c+1]))&&128==(192&g)&&((E=(15&x)<<12|(63&p)<<6|63&g)<=2047||E>=55296&&E<=57343)&&(E=null)):4===S&&(g=r[c+2],y=r[c+3],128==(192&(p=r[c+1]))&&128==(192&g)&&128==(192&y)&&((E=(15&x)<<18|(63&p)<<12|(63&g)<<6|63&y)<=65535||E>=1114112)&&(E=null)),null===E?(E=65533,S=1):E>65535&&(E-=65536,u+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),u+=String.fromCharCode(E),c+=S}return u}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Ho.Bytes)return e.push(this.readVarint(t));var r=xf(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Ho.Bytes)return e.push(this.readSVarint());var t=xf(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Ho.Bytes)return e.push(this.readBoolean());var t=xf(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Ho.Bytes)return e.push(this.readFloat());var t=xf(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Ho.Bytes)return e.push(this.readDouble());var t=xf(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Ho.Bytes)return e.push(this.readFixed32());var t=xf(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Ho.Bytes)return e.push(this.readSFixed32());var t=xf(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Ho.Bytes)return e.push(this.readFixed64());var t=xf(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Ho.Bytes)return e.push(this.readSFixed64());var t=xf(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Ho.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ho.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ho.Fixed32)this.pos+=4;else{if(t!==Ho.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),dd(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),dd(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),dd(this.buf,-1&e,this.pos),dd(this.buf,Math.floor(e*hy),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),dd(this.buf,-1&e,this.pos),dd(this.buf,Math.floor(e*hy),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var s,a,u,p;if(t>=0?(s=t%4294967296|0,a=t/4294967296|0):(a=~(-t/4294967296),4294967295^(s=~(-t%4294967296))?s=s+1|0:(s=0,a=a+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),u=s,(p=r).buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,p.buf[p.pos]=127&(u>>>=7),function(u,c){var p=(7&u)<<4;c.buf[c.pos++]|=p|((u>>>=3)?128:0),u&&(c.buf[c.pos++]=127&u|((u>>>=7)?128:0),u&&(c.buf[c.pos++]=127&u|((u>>>=7)?128:0),u&&(c.buf[c.pos++]=127&u|((u>>>=7)?128:0),u&&(c.buf[c.pos++]=127&u|((u>>>=7)?128:0),u&&(c.buf[c.pos++]=127&u)))))}(a,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(s,a,u){for(var c,p,g=0;g<a.length;g++){if((c=a.charCodeAt(g))>55295&&c<57344){if(!p){c>56319||g+1===a.length?(s[u++]=239,s[u++]=191,s[u++]=189):p=c;continue}if(c<56320){s[u++]=239,s[u++]=191,s[u++]=189,p=c;continue}c=p-55296<<10|c-56320|65536,p=null}else p&&(s[u++]=239,s[u++]=191,s[u++]=189,p=null);c<128?s[u++]=c:(c<2048?s[u++]=c>>6|192:(c<65536?s[u++]=c>>12|224:(s[u++]=c>>18|240,s[u++]=c>>12&63|128),s[u++]=c>>6&63|128),s[u++]=63&c|128)}return u}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&fy(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),s1.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),s1.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var s=this.pos-r;s>=128&&fy(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(e,t,r){this.writeTag(e,Ho.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Vh,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,OE,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,wa,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,oD,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,WL,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,sD,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,a1,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,aD,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,lD,t)},writeBytesField:function(e,t){this.writeTag(e,Ho.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Ho.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Ho.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Ho.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Ho.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Ho.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Ho.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Ho.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Ho.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Ho.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};var dy=mt(o1);const RE=["tile","layer","source","sourceLayer","state"];class u1{constructor(t,r,s,a,u){this.type="Feature",this._vectorTileFeature=t,this._z=r,this._x=s,this._y=a,this.properties=t.properties,this.id=u}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const r of RE)void 0!==this[r]&&(t[r]=this[r]);return t}}class uD{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,s){const a=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][a]=this.stateChanges[t][a]||{},pe(this.stateChanges[t][a],s),null===this.deletedStates[t]){this.deletedStates[t]={};for(const u in this.state[t])u!==a&&(this.deletedStates[t][u]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][a]){this.deletedStates[t][a]={};for(const u in this.state[t][a])s[u]||(this.deletedStates[t][a][u]=null)}else for(const u in s)this.deletedStates[t]&&this.deletedStates[t][a]&&null===this.deletedStates[t][a][u]&&delete this.deletedStates[t][a][u]}removeFeatureState(t,r,s){if(null===this.deletedStates[t])return;const a=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},s&&void 0!==r)null!==this.deletedStates[t][a]&&(this.deletedStates[t][a]=this.deletedStates[t][a]||{},this.deletedStates[t][a][s]=null);else if(void 0!==r)if(this.stateChanges[t]&&this.stateChanges[t][a])for(s in this.deletedStates[t][a]={},this.stateChanges[t][a])this.deletedStates[t][a][s]=null;else this.deletedStates[t][a]=null;else this.deletedStates[t]=null}getState(t,r){const s=String(r),a=pe({},(this.state[t]||{})[s],(this.stateChanges[t]||{})[s]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const u=this.deletedStates[t][r];if(null===u)return{};for(const c in u)delete a[c]}return a}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const s={};for(const a in this.stateChanges){this.state[a]=this.state[a]||{};const u={};for(const c in this.stateChanges[a])this.state[a][c]||(this.state[a][c]={}),pe(this.state[a][c],this.stateChanges[a][c]),u[c]=this.state[a][c];s[a]=u}for(const a in this.deletedStates){this.state[a]=this.state[a]||{};const u={};if(null===this.deletedStates[a])for(const c in this.state[a])u[c]={},this.state[a][c]={};else for(const c in this.deletedStates[a]){if(null===this.deletedStates[a][c])this.state[a][c]={};else if(this.state[a][c])for(const p of Object.keys(this.deletedStates[a][c]))delete this.state[a][c][p];u[c]=this.state[a][c]}s[a]=s[a]||{},pe(s[a],u)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const a in t)t[a].setFeatureState(s,r)}}class NE{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,r){const s=this.toIdx(t,r);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(t,r){return this.leaves[this.toIdx(t,r)]}toIdx(t,r){return r*this.size+t}}function FE(e,t,r,s){let a=0,u=Number.MAX_VALUE;for(let c=0;c<3;c++)if(Math.abs(s[c])<1e-15){if(r[c]<e[c]||r[c]>t[c])return null}else{const p=1/s[c];let g=(e[c]-r[c])*p,y=(t[c]-r[c])*p;if(g>y){const x=g;g=y,y=x}if(g>a&&(a=g),y<u&&(u=y),a>u)return null}return a}function c1(e,t,r,s,a,u,c,p,g,y,x){const E=s-e,S=a-t,M=u-r,D=c-e,P=p-t,O=g-r,R=x[1]*O-x[2]*P,B=x[2]*D-x[0]*O,j=x[0]*P-x[1]*D,V=E*R+S*B+M*j;if(Math.abs(V)<1e-15)return null;const U=1/V,G=y[0]-e,Z=y[1]-t,Q=y[2]-r,et=(G*R+Z*B+Q*j)*U;if(et<0||et>1)return null;const it=Z*M-Q*S,yt=Q*E-G*M,xt=G*S-Z*E,Nt=(x[0]*it+x[1]*yt+x[2]*xt)*U;return Nt<0||et+Nt>1?null:(D*it+P*yt+O*xt)*U}function pd(e,t,r){return(e-t)/(r-t)}function ah(e,t,r,s,a,u,c,p,g){const y=1<<r,x=u-s,E=c-a,S=(e+1)/y*x+s,M=(t+0)/y*E+a,D=(t+1)/y*E+a;p[0]=(e+0)/y*x+s,p[1]=M,g[0]=S,g[1]=D}class md{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(u){const c=Math.ceil(Math.log2(u.dim/8)),p=[];let g=Math.ceil(Math.pow(2,c));const y=1/g,x=(M,D,P,O,R)=>{const B=O?1:0,j=(M+1)*P-B,V=D*P,U=(D+1)*P-B;R[0]=M*P,R[1]=V,R[2]=j,R[3]=U};let E=new NE(g);const S=[];for(let M=0;M<g*g;M++){x(M%g,Math.floor(M/g),y,!1,S);const D=bf(S[0],S[1],u),P=bf(S[2],S[1],u),O=bf(S[2],S[3],u),R=bf(S[0],S[3],u);E.minimums.push(Math.min(D,P,O,R)),E.maximums.push(Math.max(D,P,O,R)),E.leaves.push(1)}for(p.push(E),g/=2;g>=1;g/=2){const M=p[p.length-1];E=new NE(g);for(let D=0;D<g*g;D++){x(D%g,Math.floor(D/g),2,!0,S);const P=M.getElevation(S[0],S[1]),O=M.getElevation(S[2],S[1]),R=M.getElevation(S[2],S[3]),B=M.getElevation(S[0],S[3]),j=M.isLeaf(S[0],S[1]),V=M.isLeaf(S[2],S[1]),U=M.isLeaf(S[2],S[3]),G=M.isLeaf(S[0],S[3]),Z=Math.min(P.min,O.min,R.min,B.min),Q=Math.max(P.max,O.max,R.max,B.max),et=j&&V&&U&&G;E.maximums.push(Q),E.minimums.push(Z),E.leaves.push(Q-Z<=5&&et?1:0)}p.push(E)}return p}(this.dem),s=r.length-1,a=r[s];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(r,0,0,s,0)}raycastRoot(t,r,s,a,u,c,p=1){return FE([t,r,-100],[s,a,this.maximums[0]*p],u,c)}raycast(t,r,s,a,u,c,p=1){if(!this.nodeCount)return null;const g=this.raycastRoot(t,r,s,a,u,c,p);if(null==g)return null;const y=[],x=[],E=[],S=[],M=[{idx:0,t:g,nodex:0,nodey:0,depth:0}];for(;M.length>0;){const{idx:D,t:P,nodex:O,nodey:R,depth:B}=M.pop();if(this.leaves[D]){ah(O,R,B,t,r,s,a,E,S);const V=1<<B,U=(O+0)/V,G=(O+1)/V,Z=(R+0)/V,Q=(R+1)/V,et=bf(U,Z,this.dem)*p,it=bf(G,Z,this.dem)*p,yt=bf(G,Q,this.dem)*p,xt=bf(U,Q,this.dem)*p,Nt=c1(E[0],E[1],et,S[0],E[1],it,S[0],S[1],yt,u,c),ft=c1(S[0],S[1],yt,E[0],S[1],xt,E[0],E[1],et,u,c),Ut=Math.min(null!==Nt?Nt:Number.MAX_VALUE,null!==ft?ft:Number.MAX_VALUE);if(Ut!==Number.MAX_VALUE)return Ut;{const Wt=Ot.scaleAndAdd([],u,c,P);if(kE(et,it,xt,yt,pd(Wt[0],E[0],S[0]),pd(Wt[1],E[1],S[1]))>=Wt[2])return P}continue}let j=0;for(let V=0;V<this._siblingOffset.length;V++){ah((O<<1)+this._siblingOffset[V][0],(R<<1)+this._siblingOffset[V][1],B+1,t,r,s,a,E,S),E[2]=-100,S[2]=this.maximums[this.childOffsets[D]+V]*p;const U=FE(E,S,u,c);if(null!=U){const G=U;y[V]=G;let Z=!1;for(let Q=0;Q<j&&!Z;Q++)G>=y[x[Q]]&&(x.splice(Q,0,V),Z=!0);Z||(x[j]=V),j++}}for(let V=0;V<j;V++){const U=x[V];M.push({idx:this.childOffsets[D]+U,t:y[U],nodex:(O<<1)+this._siblingOffset[U][0],nodey:(R<<1)+this._siblingOffset[U][1],depth:B+1})}}return null}_addNode(t,r,s){return this.minimums.push(t),this.maximums.push(r),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(t,r,s,a,u){if(1===t[a].isLeaf(r,s))return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const c=a-1,p=t[c];let g=0,y=0;for(let x=0;x<this._siblingOffset.length;x++){const E=2*r+this._siblingOffset[x][0],S=2*s+this._siblingOffset[x][1],M=p.getElevation(E,S),D=p.isLeaf(E,S),P=this._addNode(M.min,M.max,D);D&&(g|=1<<x),y||(y=P)}for(let x=0;x<this._siblingOffset.length;x++)g&1<<x||this._construct(t,2*r+this._siblingOffset[x][0],2*s+this._siblingOffset[x][1],c,y+x)}}function kE(e,t,r,s,a,u){return An(An(e,r,u),An(t,s,u),a)}function bf(e,t,r){const s=r.dim,a=At(e*s-.5,0,s-1),u=At(t*s-.5,0,s-1),c=Math.floor(a),p=Math.floor(u),g=Math.min(c+1,s-1),y=Math.min(p+1,s-1);return kE(r.get(c,p),r.get(g,p),r.get(c,y),r.get(g,y),a-c,u-p)}const zE={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function BE(e,t,r){return(256*e*256+256*t+r)/10-1e4}function h1(e,t,r){return 256*e+t+r/256-32768}class wf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,r,s,a=!1){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return Gt(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const u=this.dim=r.height-2,c=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=a,this._modifiedForSources={},!a){for(let g=0;g<u;g++)c[this._idx(-1,g)]=c[this._idx(0,g)],c[this._idx(u,g)]=c[this._idx(u-1,g)],c[this._idx(g,-1)]=c[this._idx(g,0)],c[this._idx(g,u)]=c[this._idx(g,u-1)];c[this._idx(-1,-1)]=c[this._idx(0,0)],c[this._idx(u,-1)]=c[this._idx(u-1,0)],c[this._idx(-1,u)]=c[this._idx(0,u-1)],c[this._idx(u,u)]=c[this._idx(u-1,u-1)]}const p="terrarium"===s?h1:BE;for(let g=0;g<c.length;++g){const y=4*g;this.floatView[g]=p(this.pixels[y],this.pixels[y+1],this.pixels[y+2])}this._timestamp=or.now()}_buildQuadTree(){this._tree=new md(this)}get(t,r,s=!1){s&&(t=At(t,-1,this.dim),r=At(r,-1,this.dim));const a=this._idx(t,r);return this.floatView[a]}set(t,r,s){const a=this._idx(t,r),u=this.floatView[a];return this.floatView[a]=s,s-u}static getUnpackVector(t){return zE[t]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}static pack(t,r){const s=[0,0,0,0],a=wf.getUnpackVector(r);let u=Math.floor((t+a[3])/a[2]);return s[2]=u%256,u=Math.floor(u/256),s[1]=u%256,u=Math.floor(u/256),s[0]=u,s}getPixels(){return new ZT({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,r,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let a=r*this.dim,u=r*this.dim+this.dim,c=s*this.dim,p=s*this.dim+this.dim;switch(r){case-1:a=u-1;break;case 1:u=a+1}switch(s){case-1:c=p-1;break;case 1:p=c+1}const g=-r*this.dim,y=-s*this.dim;for(let x=c;x<p;x++)for(let E=a;E<u;E++){const S=4*this._idx(E,x),M=4*this._idx(E+g,x+y);this.pixels[S+0]=t.pixels[M+0],this.pixels[S+1]=t.pixels[M+1],this.pixels[S+2]=t.pixels[M+2],this.pixels[S+3]=t.pixels[M+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Fn(wf,"DEMData"),Fn(md,"DemMinMaxQuadTree",{omit:["dem"]});class py{isDataAvailableAtPoint(t){const r=this._source();if(this.isUsingMockSource()||!r||t.y<0||t.y>1)return!1;const s=r.getSource().maxzoom,a=1<<s,u=Math.floor(t.x),c=Math.floor((t.x-u)*a),p=Math.floor(t.y*a),g=this.findDEMTileFor(new si(s,u,s,c,p));return!(!g||!g.dem)}getAtPointOrZero(t,r=0){return this.getAtPoint(t,r)||0}getAtPoint(t,r,s=!0){if(this.isUsingMockSource())return null;null==r&&(r=null);const a=this._source();if(!a||t.y<0||t.y>1)return r;const u=a.getSource().maxzoom,c=1<<u,p=Math.floor(t.x),g=t.x-p,y=new si(u,p,u,Math.floor(g*c),Math.floor(t.y*c)),x=this.findDEMTileFor(y);if(!x||!x.dem)return r;const E=x.dem,S=1<<x.tileID.canonical.z,M=(g*S-x.tileID.canonical.x)*E.dim,D=(t.y*S-x.tileID.canonical.y)*E.dim,P=Math.floor(M),O=Math.floor(D);return(s?this.exaggeration():1)*An(An(E.get(P,O),E.get(P,O+1),D-O),An(E.get(P+1,O),E.get(P+1,O+1),D-O),M-P)}getAtTileOffset(t,r,s){const a=1<<t.canonical.z;return this.getAtPointOrZero(new ri(t.wrap+(t.canonical.x+r/$t)/a,(t.canonical.y+s/$t)/a))}getAtTileOffsetFunc(t,r,s,a){return u=>{const c=this.getAtTileOffset(t,u.x,u.y),p=a.upVector(t.canonical,u.x,u.y),g=a.upVectorScale(t.canonical,r,s).metersToTile;return Ot.scale(p,p,c*g),p}}getForTilePoints(t,r,s,a){if(this.isUsingMockSource())return!1;const u=gd.create(this,t,a);return!!u&&(r.forEach(c=>{c[2]=this.exaggeration()*u.getElevationAt(c[0],c[1],s)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(t);if(!r||!r.dem)return null;const s=r.dem.tree,a=r.tileID,u=1<<t.canonical.z-a.canonical.z;let c=t.canonical.x/u-a.canonical.x,p=t.canonical.y/u-a.canonical.y,g=0;for(let y=0;y<t.canonical.z-a.canonical.z&&!s.leaves[g];y++){c*=2,p*=2;const x=2*Math.floor(p)+Math.floor(c);g=s.childOffsets[g]+x,c%=1,p%=1}return{min:this.exaggeration()*s.minimums[g],max:this.exaggeration()*s.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,r,s){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(0===t.length)return null;let r=!1,s=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const u of t){const c=this.getMinMaxForTile(u.tileID);c&&(s=Math.min(s,c.min),a=Math.max(a,c.max),r=!0)}return r?{min:s,max:a}:null}}class gd{constructor(t,r,s){this._demTile=t,this._dem=this._demTile.dem,this._scale=r,this._offset=s}static create(t,r,s){const a=s||t.findDEMTileFor(r);if(!a||!a.dem)return;const u=a.dem,c=a.tileID,p=1<<r.canonical.z-c.canonical.z;return new gd(a,u.dim/$t/p,[(r.canonical.x/p-c.canonical.x)*u.dim,(r.canonical.y/p-c.canonical.y)*u.dim])}tileCoordToPixel(t,r){const s=r*this._scale+this._offset[1],a=Math.floor(t*this._scale+this._offset[0]),u=Math.floor(s);return new H(a,u)}getElevationAt(t,r,s,a){const u=t*this._scale+this._offset[0],c=r*this._scale+this._offset[1],p=Math.floor(u),g=Math.floor(c),y=this._dem;return a=!!a,s?An(An(y.get(p,g,a),y.get(p,g+1,a),c-g),An(y.get(p+1,g,a),y.get(p+1,g+1,a),c-g),u-p):y.get(p,g,a)}getElevationAtPixel(t,r,s){return this._dem.get(t,r,!!s)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*ji(1,t)*this._dem.stride}}class my{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new $r($t,16,0),this.featureIndexArray=new K0,this.promoteId=r}insert(t,r,s,a,u,c=0){const p=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,a,u,c);const g=this.grid;for(let y=0;y<r.length;y++){const x=r[y],E=[1/0,1/0,-1/0,-1/0];for(let S=0;S<x.length;S++){const M=x[S];E[0]=Math.min(E[0],M.x),E[1]=Math.min(E[1],M.y),E[2]=Math.max(E[2],M.x),E[3]=Math.max(E[3],M.y)}E[0]<$t&&E[1]<$t&&E[2]>=0&&E[3]>=0&&g.insert(p,E[0],E[1],E[2],E[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new n1(new dy(this.rawTileData)).layers,this.sourceLayerCoder=new i1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,r,s,a){this.loadVTLayers();const u=t.params||{},c=ep(u.filter),p=t.tileResult,g=t.transform,y=p.bufferedTilespaceBounds,x=this.grid.query(y.min.x,y.min.y,y.max.x,y.max.y,(D,P,O,R)=>ty(p.bufferedTilespaceGeometry,D,P,O,R));x.sort(cD);let E=null;g.elevation&&x.length>0&&(E=gd.create(g.elevation,this.tileID));const S={};let M;for(let D=0;D<x.length;D++){const P=x[D];if(P===M)continue;M=P;const O=this.featureIndexArray.get(P);let R=null;this.loadMatchingFeature(S,O,c,u.layers,u.availableImages,r,s,a,(B,j,V,U=0)=>(R||(R=Rc(B,this.tileID.canonical,t.tileTransform)),j.queryIntersectsFeature(p,B,V,R,this.z,t.transform,t.pixelPosMatrix,E,U)))}return S}loadMatchingFeature(t,r,s,a,u,c,p,g,y){const{featureIndex:x,bucketIndex:E,sourceLayerIndex:S,layoutVertexArrayOffset:M}=r,D=this.bucketLayerIDs[E];if(a&&!function(B,j){for(let V=0;V<B.length;V++)if(j.indexOf(B[V])>=0)return!0;return!1}(a,D))return;const P=this.sourceLayerCoder.decode(S),O=this.vtLayers[P].feature(x);if(s.needGeometry){const B=ih(O,!0);if(!s.filter(new ss(this.tileID.overscaledZ),B,this.tileID.canonical))return}else if(!s.filter(new ss(this.tileID.overscaledZ),O))return;const R=this.getId(O,P);for(let B=0;B<D.length;B++){const j=D[B];if(a&&a.indexOf(j)<0)continue;const V=c[j];if(!V)continue;let U={};void 0!==R&&g&&(U=g.getState(V.sourceLayer||"_geojsonTileLayer",R));const G=pe({},p[j]);G.paint=UE(G.paint,V.paint,O,U,u),G.layout=UE(G.layout,V.layout,O,U,u);const Z=!y||y(O,V,U,M);if(!Z)continue;const Q=new u1(O,this.z,this.x,this.y,R);Q.layer=G;let et=t[j];void 0===et&&(et=t[j]=[]),et.push({featureIndex:x,feature:Q,intersectionZ:Z})}}lookupSymbolFeatures(t,r,s,a,u,c,p,g){const y={};this.loadVTLayers();const x=ep(u);for(const E of t)this.loadMatchingFeature(y,{bucketIndex:s,sourceLayerIndex:a,featureIndex:E,layoutVertexArrayOffset:0},x,c,p,g,r);return y}loadFeature(t){const{featureIndex:r,sourceLayerIndex:s}=t;this.loadVTLayers();const a=this.sourceLayerCoder.decode(s),u=this.vtFeatures[a];if(u[r])return u[r];const c=this.vtLayers[a].feature(r);return u[r]=c,c}hasLayer(t){for(const r of this.bucketLayerIDs)for(const s of r)if(t===s)return!0;return!1}getId(t,r){let s=t.id;if(this.promoteId){const a="string"==typeof this.promoteId?this.promoteId:this.promoteId[r];null!=a&&(s=t.properties[a]),"boolean"==typeof s&&(s=Number(s))}return s}}function UE(e,t,r,s,a){return di(e,(u,c)=>{const p=t instanceof qf?t.get(c):null;return p&&p.evaluate?p.evaluate(r,s,a):p})}function cD(e,t){return t-e}Fn(my,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const hD=yr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),fD=yr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),jE=yr([{name:"a_projected_pos",components:4,type:"Float32"}],4);yr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const XL=yr([{name:"a_z_offset",components:1,type:"Float32"}],4),dD=yr([{name:"a_texb",components:2,type:"Uint16"}]),YL=yr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),JL=yr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);yr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const f1=yr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),VE=yr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);yr([{name:"triangle",components:3,type:"Uint16"}]),yr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),yr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),yr([{type:"Float32",name:"offsetX"}]),yr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Oa=24;const mu=128;function gy(e,t){const{expression:r}=t;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new ss(e+1))};if("source"===r.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:a}=r;let u=0;for(;u<s.length&&s[u]<=e;)u++;u=Math.max(0,u-1);let c=u;for(;c<s.length&&s[c]<e+1;)c++;c=Math.min(s.length-1,c);const p=s[u],g=s[c];return"composite"===r.kind?{kind:"composite",minZoom:p,maxZoom:g,interpolationType:a}:{kind:"camera",minZoom:p,maxZoom:g,minSize:r.evaluate(new ss(p)),maxSize:r.evaluate(new ss(g)),interpolationType:a}}}function Cp(e,{uSize:t,uSizeT:r},{lowerSize:s,upperSize:a}){return"source"===e.kind?s/mu:"composite"===e.kind?An(s/mu,a/mu,r):t}function lh(e,t){let r=0,s=0;if("constant"===e.kind)s=e.layoutSize;else if("source"!==e.kind){const{interpolationType:a,minZoom:u,maxZoom:c}=e,p=a?At(ca.interpolationFactor(a,t,u,c),0,1):0;"camera"===e.kind?s=An(e.minSize,e.maxSize,p):r=p}return{uSizeT:r,uSize:s}}var GE=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:mu,evaluateSizeForFeature:Cp,evaluateSizeForZoom:lh,getSizeData:gy});function qE(e,t,r){return e.sections.forEach(s=>{s.text=function(a,u,c){const p=u.layout.get("text-transform").evaluate(c,{});return"uppercase"===p?a=a.toLocaleUpperCase():"lowercase"===p&&(a=a.toLocaleLowerCase()),La.applyArabicShaping&&(a=La.applyArabicShaping(a)),a}(s.text,t,r)}),e}const hi={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function pD(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function $E(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}const Fi=3;function mD(e,t,r){t.glyphs=[],1===e&&r.readMessage(gD,t)}function gD(e,t,r){if(3===e){const{id:s,bitmap:a,width:u,height:c,left:p,top:g,advance:y}=r.readMessage(_y,{});t.glyphs.push({id:s,bitmap:new oh({width:u+2*Fi,height:c+2*Fi},a),metrics:{width:u,height:c,left:p,top:g,advance:y}})}else 4===e?t.ascender=r.readSVarint():5===e&&(t.descender=r.readSVarint())}function _y(e,t,r){1===e?t.id=r.readVarint():2===e?t.bitmap=r.readBytes():3===e?t.width=r.readVarint():4===e?t.height=r.readVarint():5===e?t.left=r.readSVarint():6===e?t.top=r.readSVarint():7===e&&(t.advance=r.readVarint())}const _d=Fi,Zo={horizontal:1,vertical:2,horizontalOnly:3},Sp=-17;class Mp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const s=new Mp;return s.scale=t||1,s.fontStack=r,s}static forImage(t){const r=new Mp;return r.imageName=t,r}}class Ef{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const s=new Ef;for(let a=0;a<t.sections.length;a++){const u=t.sections[a];u.image?s.addImageSection(u):s.addTextSection(u,r)}return s}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(r,s){let a="";for(let u=0;u<r.length;u++){const c=r.charCodeAt(u+1)||null,p=r.charCodeAt(u-1)||null;a+=!s&&(c&&sw(c)&&!hi[r[u+1]]||p&&sw(p)&&!hi[r[u-1]])||!hi[r[u]]?r[u]:hi[r[u]]}return a}(this.text,t)}trim(){let t=0;for(let s=0;s<this.text.length&&Tp[this.text.charCodeAt(s)];s++)t++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=t&&Tp[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const s=new Ef;return s.text=this.text.substring(t,r),s.sectionIndex=this.sectionIndex.slice(t,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(Mp.forText(t.scale,t.fontStack||r));const s=this.sections.length-1;for(let a=0;a<t.text.length;++a)this.sectionIndex.push(s)}addImageSection(t){const r=t.image?t.image.namePrimary:"";if(0===r.length)return void Gt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCodePoint(s),this.sections.push(Mp.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Gt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function gg(e,t,r,s,a,u,c,p,g,y,x,E,S,M,D){const P=Ef.fromFeature(e,a);E===Zo.vertical&&P.verticalizePunctuation(S);let O=[];const R=function(G,Z,Q,et,it,yt){if(!G)return[];const xt=[],Nt=function(le,Bt,Zt,ge,be,xe){let Re=0;for(let ze=0;ze<le.length();ze++){const $e=le.getSection(ze);Re+=yy(le.getCodePoint(ze),$e,ge,be,Bt,xe)}return Re/Math.max(1,Math.ceil(Re/Zt))}(G,Z,Q,et,it,yt),ft=G.text.indexOf("\u200b")>=0;let Ut=0;for(let le=0;le<G.length();le++){const Bt=G.getSection(le),Zt=G.getCodePoint(le);if(Tp[Zt]||(Ut+=yy(Zt,Bt,et,it,Z,yt)),le<G.length()-1){const ge=!((Wt=Zt)<11904||!(kn["Bopomofo Extended"](Wt)||kn.Bopomofo(Wt)||kn["CJK Compatibility Forms"](Wt)||kn["CJK Compatibility Ideographs"](Wt)||kn["CJK Compatibility"](Wt)||kn["CJK Radicals Supplement"](Wt)||kn["CJK Strokes"](Wt)||kn["CJK Symbols and Punctuation"](Wt)||kn["CJK Unified Ideographs Extension A"](Wt)||kn["CJK Unified Ideographs"](Wt)||kn["Enclosed CJK Letters and Months"](Wt)||kn["Halfwidth and Fullwidth Forms"](Wt)||kn.Hiragana(Wt)||kn["Ideographic Description Characters"](Wt)||kn["Kangxi Radicals"](Wt)||kn["Katakana Phonetic Extensions"](Wt)||kn.Katakana(Wt)||kn["Vertical Forms"](Wt)||kn["Yi Radicals"](Wt)||kn["Yi Syllables"](Wt)));(HE[Zt]||ge||Bt.imageName)&&xt.push(WE(le+1,Ut,Nt,xt,_D(Zt,G.getCodePoint(le+1),ge&&ft),!1))}}var Wt;return d1(WE(G.length(),Ut,Nt,xt,0,!0))}(P,y,u,t,s,M),{processBidirectionalText:B,processStyledBidirectionalText:j}=La;if(B&&1===P.sections.length){const G=B(P.toString(),R);for(const Z of G){const Q=new Ef;Q.text=Z,Q.sections=P.sections;for(let et=0;et<Z.length;et++)Q.sectionIndex.push(0);O.push(Q)}}else if(j){const G=j(P.text,P.sectionIndex,R);for(const Z of G){const Q=new Ef;Q.text=Z[0],Q.sectionIndex=Z[1],Q.sections=P.sections,O.push(Q)}}else O=function(G,Z){const Q=[],et=G.text;let it=0;for(const yt of Z)Q.push(G.substring(it,yt)),it=yt;return it<et.length&&Q.push(G.substring(it,et.length)),Q}(P,R);const V=[],U={positionedLines:V,text:P.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(G,Z,Q,et,it,yt,xt,Nt,ft,Ut,Wt,le){let Bt=0,Zt=0,ge=0;const be="right"===Nt?1:"left"===Nt?0:.5;let xe=!1;for(const vn of it){const xn=vn.getSections();for(const Cn of xn){if(Cn.imageName)continue;const Mn=Z[Cn.fontStack];if(Mn&&(xe=void 0!==Mn.ascender&&void 0!==Mn.descender,!xe))break}if(!xe)break}let Re=0;for(const vn of it){vn.trim();const xn=vn.getMaxScale(),Cn=(xn-1)*Oa,Mn={positionedGlyphs:[],lineOffset:0};G.positionedLines[Re]=Mn;const hr=Mn.positionedGlyphs;let qn=0;if(!vn.length()){Zt+=yt,++Re;continue}let xi=0,Xr=0;for(let ir=0;ir<vn.length();ir++){const Wn=vn.getSection(ir),Yr=vn.getSectionIndex(ir),ai=vn.getCodePoint(ir);let Pr=Wn.scale,Ci=null,Ds=null,ki=null,Ro=Oa,Us=0;const Es=!(ft===Zo.horizontal||!Wt&&!V0(ai)||Wt&&(Tp[ai]||(ze=ai,kn.Arabic(ze)||kn["Arabic Supplement"](ze)||kn["Arabic Extended-A"](ze)||kn["Arabic Presentation Forms-A"](ze)||kn["Arabic Presentation Forms-B"](ze))));if(Wn.imageName){const jo=et[Wn.imageName];if(!jo)continue;ki=Wn.imageName,G.iconsInText=G.iconsInText||!0,Ds=jo.paddedRect;const Ai=jo.displaySize;Pr=Pr*Oa/le,Ci={width:Ai[0],height:Ai[1],left:0,top:-_d,advance:Es?Ai[1]:Ai[0],localGlyph:!1},Us=xe?-Ci.height*Pr:Sp+xn*Oa-Ai[1]*Pr,Ro=Ci.advance;const Wa=(Es?Ai[0]:Ai[1])*Pr-Oa*xn;Wa>0&&Wa>qn&&(qn=Wa)}else{const jo=Q[Wn.fontStack];if(!jo)continue;jo[ai]&&(Ds=jo[ai]);const Ai=Z[Wn.fontStack];if(!Ai)continue;const Wa=Ai.glyphs[ai];if(!Wa)continue;if(Ci=Wa.metrics,Ro=8203!==ai?Oa:0,xe){const Jh=void 0!==Ai.ascender?Math.abs(Ai.ascender):0,Df=void 0!==Ai.descender?Math.abs(Ai.descender):0,_h=(Jh+Df)*Pr;xi<_h&&(xi=_h,Xr=(Jh-Df)/2*Pr),Us=-Jh*Pr}else Us=Sp+(xn-Pr)*Oa}Es?(G.verticalizable=!0,hr.push({glyph:ai,imageName:ki,x:Bt,y:Zt+Us,vertical:Es,scale:Pr,localGlyph:Ci.localGlyph,fontStack:Wn.fontStack,sectionIndex:Yr,metrics:Ci,rect:Ds}),Bt+=Ro*Pr+Ut):(hr.push({glyph:ai,imageName:ki,x:Bt,y:Zt+Us,vertical:Es,scale:Pr,localGlyph:Ci.localGlyph,fontStack:Wn.fontStack,sectionIndex:Yr,metrics:Ci,rect:Ds}),Bt+=Ci.advance*Pr+Ut)}0!==hr.length&&(ge=Math.max(Bt-Ut,ge),xe?XE(hr,be,qn,Xr,yt*xn/2):XE(hr,be,qn,0,yt/2)),Bt=0;const fr=yt*xn+qn;Mn.lineOffset=Math.max(qn,Cn),Zt+=fr,++Re}var ze;const $e=Zt,{horizontalAlign:Ie,verticalAlign:on}=vy(xt);(function(vn,xn,Cn,Mn,hr,qn){const xi=(xn-Cn)*hr,Xr=-qn*Mn;for(const fr of vn)for(const ir of fr.positionedGlyphs)ir.x+=xi,ir.y+=Xr})(G.positionedLines,be,Ie,on,ge,$e),G.top+=-on*$e,G.bottom=G.top+$e,G.left+=-Ie*ge,G.right=G.left+ge,G.hasBaseline=xe}(U,t,r,s,O,c,p,g,E,y,S,D),!function(G){for(const Z of G)if(0!==Z.positionedGlyphs.length)return!1;return!0}(V)&&U}const Tp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},HE={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function yy(e,t,r,s,a,u){if(t.imageName){const c=s[t.imageName];return c?c.displaySize[0]*t.scale*Oa/u+a:0}{const c=r[t.fontStack],p=c&&c.glyphs[e];return p?p.metrics.advance*t.scale+a:0}}function ZE(e,t,r,s){const a=Math.pow(e-t,2);return s?e<t?a/2:2*a:a+Math.abs(r)*r}function _D(e,t,r){let s=0;return 10===e&&(s-=1e4),r&&(s+=150),40!==e&&65288!==e||(s+=50),41!==t&&65289!==t||(s+=50),s}function WE(e,t,r,s,a,u){let c=null,p=ZE(t,r,a,u);for(const g of s){const y=ZE(t-g.x,r,a,u)+g.badness;y<=p&&(c=g,p=y)}return{index:e,x:t,priorBreak:c,badness:p}}function d1(e){return e?d1(e.priorBreak).concat(e.index):[]}function vy(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function XE(e,t,r,s,a){if(!(t||r||s||a))return;const u=e.length-1,c=e[u],p=(c.x+c.metrics.advance*c.scale)*t;for(let g=0;g<=u;g++)e[g].x-=p,e[g].y+=r+s+a}function yD(e,t,r,s){const{horizontalAlign:a,verticalAlign:u}=vy(s),c=r[0]-e.displaySize[0]*a,p=r[1]-e.displaySize[1]*u;return{imagePrimary:e,imageSecondary:t,top:p,bottom:p+e.displaySize[1],left:c,right:c+e.displaySize[0]}}function YE(e,t,r,s,a,u){const c=e.imagePrimary;let p;if(c.content){const O=c.content,R=c.pixelRatio||1;p=[O[0]/R,O[1]/R,c.displaySize[0]-O[2]/R,c.displaySize[1]-O[3]/R]}const g=t.left*u,y=t.right*u;let x,E,S,M;"width"===r||"both"===r?(M=a[0]+g-s[3],E=a[0]+y+s[1]):(M=a[0]+(g+y-c.displaySize[0])/2,E=M+c.displaySize[0]);const D=t.top*u,P=t.bottom*u;return"height"===r||"both"===r?(x=a[1]+D-s[0],S=a[1]+P+s[2]):(x=a[1]+(D+P-c.displaySize[1])/2,S=x+c.displaySize[1]),{imagePrimary:c,imageSecondary:void 0,top:x,right:E,bottom:S,left:M,collisionPadding:p}}class uh extends H{constructor(t,r,s,a,u){super(t,r),this.angle=a,this.z=s,void 0!==u&&(this.segment=u)}clone(){return new uh(this.x,this.y,this.z,this.angle,this.segment)}}function p1(e,t,r,s,a){if(void 0===t.segment)return!0;let u=t,c=t.segment+1,p=0;for(;p>-r/2;){if(c--,c<0)return!1;p-=e[c].dist(u),u=e[c]}p+=e[c].dist(e[c+1]),c++;const g=[];let y=0;for(;p<r/2;){const x=e[c],E=e[c+1];if(!E)return!1;let S=e[c-1].angleTo(x)-x.angleTo(E);for(S=Math.abs((S+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:p,angleDelta:S}),y+=S;p-g[0].distance>s;)y-=g.shift().angleDelta;if(y>a)return!1;c++,p+=x.dist(E)}return!0}function JE(e){let t=0;for(let r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function KE(e,t,r){return e?.6*t*r:0}function gu(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function vD(e,t,r,s,a,u){const c=KE(r,a,u),p=gu(r,s)*u;let g=0;const y=JE(e)/2;for(let x=0;x<e.length-1;x++){const E=e[x],S=e[x+1],M=E.dist(S);if(g+M>y){const D=(y-g)/M,P=An(E.x,S.x,D),O=An(E.y,S.y,D),R=new uh(P,O,0,S.angleTo(E),x);return!c||p1(e,R,p,c,t)?R:void 0}g+=M}}function xD(e,t,r,s,a,u,c,p,g){const y=KE(s,u,c),x=gu(s,a),E=x*c,S=0===e[0].x||e[0].x===g||0===e[0].y||e[0].y===g;return t-E<t/4&&(t=E+t/4),bD(e,S?t/2*p%t:(x/2+2*u)*c*p%t,t,y,r,E,S,!1,g)}function bD(e,t,r,s,a,u,c,p,g){const y=u/2,x=JE(e);let E=0,S=t-r,M=[];for(let D=0;D<e.length-1;D++){const P=e[D],O=e[D+1],R=P.dist(O),B=O.angleTo(P);for(;S+r<E+R;){S+=r;const j=(S-E)/R,V=An(P.x,O.x,j),U=An(P.y,O.y,j);if(V>=0&&V<g&&U>=0&&U<g&&S-y>=0&&S+y<=x){const G=new uh(V,U,0,B,D);s&&!p1(e,G,u,s,a)||M.push(G)}}E+=R}return p||M.length||c||(M=bD(e,E/2,r,s,a,u,c,!0,g)),M}function xy(e,t,r,s,a){const u=[];for(let c=0;c<e.length;c++){const p=e[c];let g;for(let y=0;y<p.length-1;y++){let x=p[y],E=p[y+1];x.x<t&&E.x<t||(x.x<t?x=new H(t,x.y+(t-x.x)/(E.x-x.x)*(E.y-x.y))._round():E.x<t&&(E=new H(t,x.y+(t-x.x)/(E.x-x.x)*(E.y-x.y))._round()),x.y<r&&E.y<r||(x.y<r?x=new H(x.x+(r-x.y)/(E.y-x.y)*(E.x-x.x),r)._round():E.y<r&&(E=new H(x.x+(r-x.y)/(E.y-x.y)*(E.x-x.x),r)._round()),x.x>=s&&E.x>=s||(x.x>=s?x=new H(s,x.y+(s-x.x)/(E.x-x.x)*(E.y-x.y))._round():E.x>=s&&(E=new H(s,x.y+(s-x.x)/(E.x-x.x)*(E.y-x.y))._round()),x.y>=a&&E.y>=a||(x.y>=a?x=new H(x.x+(a-x.y)/(E.y-x.y)*(E.x-x.x),a)._round():E.y>=a&&(E=new H(x.x+(a-x.y)/(E.y-x.y)*(E.x-x.x),a)._round()),g&&x.equals(g[g.length-1])||(g=[x],u.push(g)),g.push(E)))))}}return u}function by(e){let t=0,r=0;for(const c of e)t+=c.w*c.h,r=Math.max(r,c.w);e.sort((c,p)=>p.h-c.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let a=0,u=0;for(const c of e)for(let p=s.length-1;p>=0;p--){const g=s[p];if(!(c.w>g.w||c.h>g.h)){if(c.x=g.x,c.y=g.y,u=Math.max(u,c.y+c.h),a=Math.max(a,c.x+c.w),c.w===g.w&&c.h===g.h){const y=s.pop();p<s.length&&(s[p]=y)}else c.h===g.h?(g.x+=c.w,g.w-=c.w):c.w===g.w?(g.y+=c.h,g.h-=c.h):(s.push({x:g.x+c.w,y:g.y,w:g.w-c.w,h:c.h}),g.y+=c.h,g.h-=c.h);break}}return{w:a,h:u,fill:t/(a*u)||0}}Fn(uh,"Anchor");const _u=1;class m1{constructor(t,{pixelRatio:r,version:s,stretchX:a,stretchY:u,content:c}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=a,this.stretchY=u,this.content=c,this.version=s}get tl(){return[this.paddedRect.x+_u,this.paddedRect.y+_u]}get br(){return[this.paddedRect.x+this.paddedRect.w-_u,this.paddedRect.y+this.paddedRect.h-_u]}get displaySize(){return[(this.paddedRect.w-2*_u)/this.pixelRatio,(this.paddedRect.h-2*_u)/this.pixelRatio]}}class QE{constructor(t,r){const s={},a={};this.haveRenderCallbacks=[];const u=[];this.addImages(t,s,u),this.addImages(r,a,u);const{w:c,h:p}=by(u),g=new Hs({width:c||1,height:p||1});for(const y in t){const x=t[y],E=s[y].paddedRect;Hs.copy(x.data,g,{x:0,y:0},{x:E.x+_u,y:E.y+_u},x.data)}for(const y in r){const x=r[y],E=a[y].paddedRect,S=E.x+_u,M=E.y+_u,D=x.data.width,P=x.data.height;Hs.copy(x.data,g,{x:0,y:0},{x:S,y:M},x.data),Hs.copy(x.data,g,{x:0,y:P-1},{x:S,y:M-1},{width:D,height:1}),Hs.copy(x.data,g,{x:0,y:0},{x:S,y:M+P},{width:D,height:1}),Hs.copy(x.data,g,{x:D-1,y:0},{x:S-1,y:M},{width:1,height:P}),Hs.copy(x.data,g,{x:0,y:0},{x:S+D,y:M},{width:1,height:P})}this.image=g,this.iconPositions=s,this.patternPositions=a}addImages(t,r,s){for(const a in t){const u=t[a],c={x:0,y:0,w:u.data.width+2*_u,h:u.data.height+2*_u};s.push(c),r[a]=new m1(c,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(t,r,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>t.hasImage(a,s)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const a in t.getUpdatedImages(s))this.patchUpdatedImage(this.iconPositions[a],t.getImage(a,s),r),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a,s),r)}patchUpdatedImage(t,r,s){if(!t||!r||t.version===r.version)return;t.version=r.version;const[a,u]=t.tl;s.update(r.data,void 0,{x:a,y:u})}}Fn(m1,"ImagePosition"),Fn(QE,"ImageAtlas");const Dp=1e20;function tI(e,t,r,s,a,u,c,p,g){for(let y=t;y<t+s;y++)eI(e,r*u+y,u,a,c,p,g);for(let y=r;y<r+a;y++)eI(e,y*u+t,1,s,c,p,g)}function eI(e,t,r,s,a,u,c){u[0]=0,c[0]=-Dp,c[1]=Dp,a[0]=e[t];for(let p=1,g=0,y=0;p<s;p++){a[p]=e[t+p*r];const x=p*p;do{const E=u[g];y=(a[p]-a[E]+x-E*E)/(p-E)/2}while(y<=c[g]&&--g>-1);g++,u[g]=p,c[g]=y,c[g+1]=Dp}for(let p=0,g=0;p<s;p++){for(;c[g+1]<p;)g++;const y=u[g],x=p-y;e[t+p*r]=a[y]+x*x}}const qu=2;class Ap{constructor(t,r,s){this.requestManager=t,this.localGlyphMode=r,this.localFontFamily=s,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,r){this.urls[r]=t}getGlyphs(t,r,s){const a=[],u=this.urls[r]||Yt.GLYPHS_URL;for(const c in t)for(const p of t[c])a.push({stack:c,id:p});Le(a,({stack:c,id:p},g)=>{let y=this.entries[c];y||(y=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=y.glyphs[p];if(void 0!==x)return void g(null,{stack:c,id:p,glyph:x});if(x=this._tinySDF(y,c,p),x)return y.glyphs[p]=x,void g(null,{stack:c,id:p,glyph:x});const E=Math.floor(p/256);if(256*E>65535)return void g(new Error("glyphs > 65535 not supported"));if(y.ranges[E])return void g(null,{stack:c,id:p,glyph:x});let S=y.requests[E];S||(S=y.requests[E]=[],Ap.loadGlyphRange(c,E,u,this.requestManager,(M,D)=>{if(D){y.ascender=D.ascender,y.descender=D.descender;for(const P in D.glyphs)this._doesCharSupportLocalGlyph(+P)||(y.glyphs[+P]=D.glyphs[+P]);y.ranges[E]=!0}for(const P of S)P(M,D);delete y.requests[E]})),S.push((M,D)=>{M?g(M):D&&g(null,{stack:c,id:p,glyph:D.glyphs[p]||null})})},(c,p)=>{if(c)s(c);else if(p){const g={};for(const{stack:y,id:x,glyph:E}of p)void 0===g[y]&&(g[y]={}),void 0===g[y].glyphs&&(g[y].glyphs={}),g[y].glyphs[x]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},g[y].ascender=this.entries[y].ascender,g[y].descender=this.entries[y].descender;s(null,g)}})}_doesCharSupportLocalGlyph(t){return 0!==this.localGlyphMode&&(2===this.localGlyphMode?!!this.localFontFamily:!!this.localFontFamily&&(kn["CJK Unified Ideographs"](t)||kn["Hangul Syllables"](t)||kn.Hiragana(t)||kn.Katakana(t)||kn["CJK Symbols and Punctuation"](t)||kn["CJK Unified Ideographs Extension A"](t)||kn["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,r,s){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(s))return;let u=t.tinySDF;if(!u){let P="400";/bold/i.test(r)?P="900":/medium/i.test(r)?P="500":/light/i.test(r)&&(P="200"),u=t.tinySDF=new Ap.TinySDF({fontFamily:a,fontWeight:P,fontSize:24*qu,buffer:3*qu,radius:8*qu}),u.fontWeight=P}if(this.localGlyphs[u.fontWeight][s])return this.localGlyphs[u.fontWeight][s];const c=String.fromCodePoint(s),{data:p,width:g,height:y,glyphWidth:x,glyphHeight:E,glyphLeft:S,glyphTop:M,glyphAdvance:D}=u.draw(c);return this.localGlyphs[u.fontWeight][s]={id:s,bitmap:new oh({width:g,height:y},p),metrics:{width:x/qu,height:E/qu,left:S/qu,top:M/qu-27,advance:D/qu,localGlyph:!0}}}}Ap.loadGlyphRange=function(e,t,r,s,a){const u=256*t,c=u+255,p=s.transformRequest(s.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}",`${u}-${c}`),Kt.Glyphs);je(p,(g,y)=>{if(g)a(g);else if(y){const x={},E=new dy(y).readFields(mD,{});for(const S of E.glyphs)x[S.id]=S;a(null,{glyphs:x,ascender:E.ascender,descender:E.descender})}})},Ap.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:s=.25,fontFamily:a="sans-serif",fontWeight:u="normal",fontStyle:c="normal"}={}){this.buffer=t,this.cutoff=s,this.radius=r;const p=this.size=e+4*t,g=this._createCanvas(p),y=this.ctx=g.getContext("2d",{willReadFrequently:!0});y.font=`${c} ${u} ${e}px ${a}`,y.textBaseline="alphabetic",y.textAlign="left",y.fillStyle="black",this.gridOuter=new Float64Array(p*p),this.gridInner=new Float64Array(p*p),this.f=new Float64Array(p),this.z=new Float64Array(p+1),this.v=new Uint16Array(p)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:s,actualBoundingBoxLeft:a,actualBoundingBoxRight:u}=this.ctx.measureText(e),c=Math.ceil(r),p=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-a))),g=Math.min(this.size-this.buffer,c+Math.ceil(s)),y=p+2*this.buffer,x=g+2*this.buffer,E=Math.max(y*x,0),S=new Uint8ClampedArray(E),M={data:S,width:y,height:x,glyphWidth:p,glyphHeight:g,glyphTop:c,glyphLeft:0,glyphAdvance:t};if(0===p||0===g)return M;const{ctx:D,buffer:P,gridInner:O,gridOuter:R}=this;D.clearRect(P,P,p,g),D.fillText(e,P,P+c);const B=D.getImageData(P,P,p,g);R.fill(Dp,0,E),O.fill(0,0,E);for(let j=0;j<g;j++)for(let V=0;V<p;V++){const U=B.data[4*(j*p+V)+3]/255;if(0===U)continue;const G=(j+P)*y+V+P;if(1===U)R[G]=0,O[G]=Dp;else{const Z=.5-U;R[G]=Z>0?Z*Z:0,O[G]=Z<0?Z*Z:0}}tI(R,0,0,y,x,y,this.f,this.v,this.z),tI(O,P,P,p,g,y,this.f,this.v,this.z);for(let j=0;j<E;j++){const V=Math.sqrt(R[j])-Math.sqrt(O[j]);S[j]=Math.round(255-255*(V/this.radius+this.cutoff))}return M}};const If=_u;function nI(e,t,r,s){const a=[],u=e.imagePrimary,c=u.pixelRatio,p=u.paddedRect.w-2*If,g=u.paddedRect.h-2*If,y=e.right-e.left,x=e.bottom-e.top,E=u.stretchX||[[0,p]],S=u.stretchY||[[0,g]],M=(yt,xt)=>yt+xt[1]-xt[0],D=E.reduce(M,0),P=S.reduce(M,0),O=p-D,R=g-P;let B=0,j=D,V=0,U=P,G=0,Z=O,Q=0,et=R;if(u.content&&s){const yt=u.content;B=wy(E,0,yt[0]),V=wy(S,0,yt[1]),j=wy(E,yt[0],yt[2]),U=wy(S,yt[1],yt[3]),G=yt[0]-B,Q=yt[1]-V,Z=yt[2]-yt[0]-j,et=yt[3]-yt[1]-U}const it=(yt,xt,Nt,ft)=>{const Ut=$u(yt.stretch-B,j,y,e.left),Wt=Pp(yt.fixed-G,Z,yt.stretch,D),le=$u(xt.stretch-V,U,x,e.top),Bt=Pp(xt.fixed-Q,et,xt.stretch,P),Zt=$u(Nt.stretch-B,j,y,e.left),ge=Pp(Nt.fixed-G,Z,Nt.stretch,D),be=$u(ft.stretch-V,U,x,e.top),xe=Pp(ft.fixed-Q,et,ft.stretch,P),Re=new H(Ut,le),ze=new H(Zt,le),$e=new H(Zt,be),Ie=new H(Ut,be),on=new H(Wt/c,Bt/c),vn=new H(ge/c,xe/c),xn=t*Math.PI/180;if(xn){const Xr=Math.sin(xn),fr=Math.cos(xn),ir=[fr,-Xr,Xr,fr];Re._matMult(ir),ze._matMult(ir),Ie._matMult(ir),$e._matMult(ir)}const Cn=yt.stretch+yt.fixed,Mn=Nt.stretch+Nt.fixed,hr=xt.stretch+xt.fixed,qn=ft.stretch+ft.fixed,xi=e.imageSecondary;return{tl:Re,tr:ze,bl:Ie,br:$e,texPrimary:{x:u.paddedRect.x+If+Cn,y:u.paddedRect.y+If+hr,w:Mn-Cn,h:qn-hr},texSecondary:xi?{x:xi.paddedRect.x+If+Cn,y:xi.paddedRect.y+If+hr,w:Mn-Cn,h:qn-hr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:on,pixelOffsetBR:vn,minFontScaleX:Z/c/y,minFontScaleY:et/c/x,isSDF:r}};if(s&&(u.stretchX||u.stretchY)){const yt=rI(E,O,D),xt=rI(S,R,P);for(let Nt=0;Nt<yt.length-1;Nt++){const ft=yt[Nt],Ut=yt[Nt+1];for(let Wt=0;Wt<xt.length-1;Wt++)a.push(it(ft,xt[Wt],Ut,xt[Wt+1]))}}else a.push(it({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:p+1},{fixed:0,stretch:g+1}));return a}function wy(e,t,r){let s=0;for(const a of e)s+=Math.max(t,Math.min(r,a[1]))-Math.max(t,Math.min(r,a[0]));return s}function rI(e,t,r){const s=[{fixed:-If,stretch:0}];for(const[a,u]of e){const c=s[s.length-1];s.push({fixed:a-c.stretch,stretch:c.stretch}),s.push({fixed:a-c.stretch,stretch:c.stretch+(u-a)})}return s.push({fixed:t+If,stretch:r}),s}function $u(e,t,r,s){return e/t*r+s}function Pp(e,t,r,s){return e-t*r/s}function wD(e,t,r,s){const a=t+e.positionedLines[s].lineOffset;return 0===s?r+a/2:r+(a+(t+e.positionedLines[s-1].lineOffset))/2}function iI(e,t=1,r=!1){let s=1/0,a=1/0,u=-1/0,c=-1/0;const p=e[0];for(let M=0;M<p.length;M++){const D=p[M];(!M||D.x<s)&&(s=D.x),(!M||D.y<a)&&(a=D.y),(!M||D.x>u)&&(u=D.x),(!M||D.y>c)&&(c=D.y)}const g=Math.min(u-s,c-a);let y=g/2;const x=new Xe([],ED);if(0===g)return new H(s,a);for(let M=s;M<u;M+=g)for(let D=a;D<c;D+=g)x.push(new yd(M+y,D+y,y,e));let E=function(M){let D=0,P=0,O=0;const R=M[0];for(let B=0,j=R.length,V=j-1;B<j;V=B++){const U=R[B],G=R[V],Z=U.x*G.y-G.x*U.y;P+=(U.x+G.x)*Z,O+=(U.y+G.y)*Z,D+=3*Z}return new yd(P/D,O/D,0,M)}(e),S=x.length;for(;x.length;){const M=x.pop();(M.d>E.d||!E.d)&&(E=M,r&&console.log("found best %d after %d probes",Math.round(1e4*M.d)/1e4,S)),M.max-E.d<=t||(y=M.h/2,x.push(new yd(M.p.x-y,M.p.y-y,y,e)),x.push(new yd(M.p.x+y,M.p.y-y,y,e)),x.push(new yd(M.p.x-y,M.p.y+y,y,e)),x.push(new yd(M.p.x+y,M.p.y+y,y,e)),S+=4)}return r&&(console.log(`num probes: ${S}`),console.log(`best distance: ${E.d}`)),E.p}function ED(e,t){return t.max-e.max}class yd{constructor(t,r,s,a){this.p=new H(t,r),this.h=s,this.d=function(u,c){let p=!1,g=1/0;for(let y=0;y<c.length;y++){const x=c[y];for(let E=0,S=x.length,M=S-1;E<S;M=E++){const D=x[E],P=x[M];D.y>u.y!=P.y>u.y&&u.x<(P.x-D.x)*(u.y-D.y)/(P.y-D.y)+D.x&&(p=!p),g=Math.min(g,Vv(u,D,P))}}return(p?1:-1)*Math.sqrt(g)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const vd=7,Lp=Number.POSITIVE_INFINITY,g1=Math.sqrt(2);function oI(e,[t,r]){let s=0,a=0;if(r===Lp){t<0&&(t=0);const u=t/g1;switch(e){case"top-right":case"top-left":a=u-vd;break;case"bottom-right":case"bottom-left":a=-u+vd;break;case"bottom":a=-t+vd;break;case"top":a=t-vd}switch(e){case"top-right":case"bottom-right":s=-u;break;case"top-left":case"bottom-left":s=u;break;case"left":s=t;break;case"right":s=-t}}else{switch(t=Math.abs(t),r=Math.abs(r),e){case"top-right":case"top-left":case"top":a=r-vd;break;case"bottom-right":case"bottom-left":case"bottom":a=-r+vd}switch(e){case"top-right":case"bottom-right":case"right":s=-t;break;case"top-left":case"bottom-left":case"left":s=t}}return[s,a]}function sI(e,t,r,s,a,u,c,p,g,y,x){e.createArrays(),e.tilePixelRatio=$t/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const E=e.layers[0].layout,S=e.layers[0]._unevaluatedLayout._values,M={};if("composite"===e.textSizeData.kind){const{minZoom:R,maxZoom:B}=e.textSizeData;M.compositeTextSizes=[S["text-size"].possiblyEvaluate(new ss(R),p),S["text-size"].possiblyEvaluate(new ss(B),p)]}if("composite"===e.iconSizeData.kind){const{minZoom:R,maxZoom:B}=e.iconSizeData;M.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new ss(R),p),S["icon-size"].possiblyEvaluate(new ss(B),p)]}M.layoutTextSize=S["text-size"].possiblyEvaluate(new ss(g+1),p),M.layoutIconSize=S["icon-size"].possiblyEvaluate(new ss(g+1),p),M.textMaxSize=S["text-size"].possiblyEvaluate(new ss(18),p);const D="map"===E.get("text-rotation-alignment")&&"point"!==E.get("symbol-placement"),P=E.get("text-size");let O=!1;for(const R of e.features)if(R.icon&&R.icon.nameSecondary){O=!0;break}for(const R of e.features){const B=E.get("text-font").evaluate(R,{},p).join(","),j=P.evaluate(R,{},p),V=M.layoutTextSize.evaluate(R,{},p),U=(M.layoutIconSize.evaluate(R,{},p),{horizontal:{},vertical:void 0}),G=R.text;let Z,Q=[0,0];if(G){const yt=G.toString(),xt=E.get("text-letter-spacing").evaluate(R,{},p)*Oa,Nt=E.get("text-line-height").evaluate(R,{},p)*Oa,ft=fT(yt)?xt:0,Ut=E.get("text-anchor").evaluate(R,{},p),Wt=E.get("text-variable-anchor");if(!Wt){const be=E.get("text-radial-offset").evaluate(R,{},p);Q=be?oI(Ut,[be*Oa,Lp]):E.get("text-offset").evaluate(R,{},p).map(xe=>xe*Oa)}let le=D?"center":E.get("text-justify").evaluate(R,{},p);const Bt="point"===E.get("symbol-placement"),Zt=Bt?E.get("text-max-width").evaluate(R,{},p)*Oa:1/0,ge=be=>{e.allowVerticalPlacement&&j0(yt)&&(U.vertical=gg(G,t,r,a,B,Zt,Nt,Ut,be,ft,Q,Zo.vertical,!0,V,j))};if(!D&&Wt){const be="auto"===le?Wt.map(Re=>Ey(Re)):[le];let xe=!1;for(let Re=0;Re<be.length;Re++){const ze=be[Re];if(!U.horizontal[ze])if(xe)U.horizontal[ze]=U.horizontal[0];else{const $e=gg(G,t,r,a,B,Zt,Nt,"center",ze,ft,Q,Zo.horizontal,!1,V,j);$e&&(U.horizontal[ze]=$e,xe=1===$e.positionedLines.length)}}ge("left")}else{if("auto"===le&&(le=Ey(Ut)),Bt||E.get("text-writing-mode").indexOf("horizontal")>=0||!j0(yt)){const be=gg(G,t,r,a,B,Zt,Nt,Ut,le,ft,Q,Zo.horizontal,!1,V,j);be&&(U.horizontal[le]=be)}ge(Bt?"left":le)}}let et=!1;if(R.icon&&R.icon.namePrimary){const yt=s[R.icon.namePrimary];yt&&(Z=yD(a[R.icon.namePrimary],R.icon.nameSecondary?a[R.icon.nameSecondary]:void 0,E.get("icon-offset").evaluate(R,{},p),E.get("icon-anchor").evaluate(R,{},p)),et=yt.sdf,void 0===e.sdfIcons?e.sdfIcons=yt.sdf:e.sdfIcons!==yt.sdf&&Gt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(yt.pixelRatio!==e.pixelRatio||0!==E.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const it=lI(U.horizontal)||U.vertical;e.iconsInText||(e.iconsInText=!!it&&it.iconsInText),(it||Z)&&aI(e,R,U,Z,s,M,V,0,Q,et,c,p,y,x,O)}u&&e.generateCollisionDebugBuffers(g,e.collisionBoxArray)}function Ey(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function aI(e,t,r,s,a,u,c,p,g,y,x,E,S,M,D){let P=u.textMaxSize.evaluate(t,{},E);void 0===P&&(P=c);const O=e.layers[0].layout,R=O.get("icon-offset").evaluate(t,{},E),B=lI(r.horizontal)||r.vertical,j="globe"===S.name,V=Oa,U=c/V,G=e.tilePixelRatio*P/V,Z=(Ut=e.overscaling,e.zoom>18&&Ut>2&&(Ut>>=1),Math.max($t/(512*Ut),1)*O.get("symbol-spacing")),Q=O.get("text-padding")*e.tilePixelRatio,et=O.get("icon-padding")*e.tilePixelRatio,it=St(O.get("text-max-angle")),yt="map"===O.get("text-rotation-alignment")&&"point"!==O.get("symbol-placement"),xt="map"===O.get("icon-rotation-alignment")&&"point"!==O.get("symbol-placement"),Nt=O.get("symbol-placement"),ft=Z/2;var Ut;const Wt=O.get("icon-text-fit").evaluate(t,{},E),le=O.get("icon-text-fit-padding").evaluate(t,{},E),Bt="none"!==Wt;let Zt;!1===e.hasAnyIconTextFit&&Bt&&(e.hasAnyIconTextFit=!0),s&&Bt&&(e.allowVerticalPlacement&&r.vertical&&(Zt=YE(s,r.vertical,Wt,le,R,U)),B&&(s=YE(s,B,Wt,le,R,U)));const ge=(be,xe,Re)=>{if(xe.x<0||xe.x>=$t||xe.y<0||xe.y>=$t)return;let ze=null;if(j){const{x:$e,y:Ie,z:on}=S.projectTilePoint(xe.x,xe.y,Re);ze={anchor:new uh($e,Ie,on,0,void 0),up:S.upVector(Re,xe.x,xe.y)}}!function($e,Ie,on,vn,xn,Cn,Mn,hr,qn,xi,Xr,fr,ir,Wn,Yr,ai,Pr,Ci,Ds,ki,Ro,Us,Es,jo,Ai,Wa,Jh){const Df=$e.addToLineVertexArray(Ie,vn);let _h,t_,e_,_0,$S,ab,lb,ub=0,HS=0,ZS=0,cb=0,_m=-1,WS=-1;const jc={};let ym=Yf("");const Vd=on?on.anchor:Ie,hb="none"!==qn.layout.get("icon-text-fit").evaluate(Ro,{},Ai);let XS=0,YS=0;if(void 0===qn._unevaluatedLayout.getValue("text-radial-offset")?[XS,YS]=qn.layout.get("text-offset").evaluate(Ro,{},Ai).map(bu=>bu*Oa):(XS=qn.layout.get("text-radial-offset").evaluate(Ro,{},Ai)*Oa,YS=Lp),$e.allowVerticalPlacement&&xn.vertical){const bu=xn.vertical;if(Yr)ab=_g(bu),hr&&(lb=_g(hr));else{const eu=qn.layout.get("text-rotate").evaluate(Ro,{},Ai)+90;e_=Iy(xi,Vd,Ie,Xr,fr,ir,bu,Wn,eu,ai),hr&&(_0=Iy(xi,Vd,Ie,Xr,fr,ir,hr,Ci,eu))}}if(Cn){const bu=qn.layout.get("icon-rotate").evaluate(Ro,{},Ai),eu=nI(Cn,bu,Es,hb),Gd=hr?nI(hr,bu,Es,hb):void 0;t_=Iy(xi,Vd,Ie,Xr,fr,ir,Cn,Ci,bu),ub=4*eu.length;const JS=$e.iconSizeData;let Pf=null;"source"===JS.kind?(Pf=[mu*qn.layout.get("icon-size").evaluate(Ro,{},Ai)],Pf[0]>ch&&Gt(`${$e.layerIds[0]}: Value for "icon-size" is >= ${Op}. Reduce your "icon-size".`)):"composite"===JS.kind&&(Pf=[mu*Us.compositeIconSizes[0].evaluate(Ro,{},Ai),mu*Us.compositeIconSizes[1].evaluate(Ro,{},Ai)],(Pf[0]>ch||Pf[1]>ch)&&Gt(`${$e.layerIds[0]}: Value for "icon-size" is >= ${Op}. Reduce your "icon-size".`)),$e.addSymbols($e.icon,eu,Pf,ki,Ds,Ro,!1,on,Ie,Df.lineStartIndex,Df.lineLength,-1,jo,Ai,Wa,Jh),_m=$e.icon.placedSymbolArray.length-1,Gd&&(HS=4*Gd.length,$e.addSymbols($e.icon,Gd,Pf,ki,Ds,Ro,Zo.vertical,on,Ie,Df.lineStartIndex,Df.lineLength,-1,jo,Ai,Wa,Jh),WS=$e.icon.placedSymbolArray.length-1)}for(const bu in xn.horizontal){const eu=xn.horizontal[bu];_h||(ym=Yf(eu.text),Yr?$S=_g(eu):_h=Iy(xi,Vd,Ie,Xr,fr,ir,eu,Wn,qn.layout.get("text-rotate").evaluate(Ro,{},Ai),ai));const Gd=1===eu.positionedLines.length;if(ZS+=hh($e,on,Ie,eu,Mn,qn,Yr,Ro,ai,Df,xn.vertical?Zo.horizontal:Zo.horizontalOnly,Gd?Object.keys(xn.horizontal):[bu],jc,_m,Us,jo,Ai,Wa),Gd)break}xn.vertical&&(cb+=hh($e,on,Ie,xn.vertical,Mn,qn,Yr,Ro,ai,Df,Zo.vertical,["vertical"],jc,WS,Us,jo,Ai,Wa));let Af=-1;const fb=(bu,eu)=>bu?Math.max(bu,eu):eu;Af=fb($S,Af),Af=fb(ab,Af),Af=fb(lb,Af);const KA=Af>-1?1:0;$e.glyphOffsetArray.length>=Bp.MAX_GLYPHS&&Gt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Ro.sortKey&&$e.addToSortKeyRanges($e.symbolInstances.length,Ro.sortKey),$e.symbolInstances.emplaceBack(Ie.x,Ie.y,Vd.x,Vd.y,Vd.z,jc.right>=0?jc.right:-1,jc.center>=0?jc.center:-1,jc.left>=0?jc.left:-1,jc.vertical>=0?jc.vertical:-1,_m,WS,ym,void 0!==_h?_h:$e.collisionBoxArray.length,void 0!==_h?_h+1:$e.collisionBoxArray.length,void 0!==e_?e_:$e.collisionBoxArray.length,void 0!==e_?e_+1:$e.collisionBoxArray.length,void 0!==t_?t_:$e.collisionBoxArray.length,void 0!==t_?t_+1:$e.collisionBoxArray.length,_0||$e.collisionBoxArray.length,_0?_0+1:$e.collisionBoxArray.length,Xr,ZS,cb,ub,HS,KA,0,XS,YS,Af,0,hb?1:0)}(e,xe,ze,be,r,s,a,Zt,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,Q,yt,g,0,et,xt,R,t,u,y,x,E,M,D)};if("line"===Nt)for(const be of xy(t.geometry,0,0,$t,$t)){const xe=xD(be,Z,it,r.vertical||B,s,V,G,e.overscaling,$t);for(const Re of xe)B&&ID(e,B.text,ft,Re)||ge(be,Re,E)}else if("line-center"===Nt){for(const be of t.geometry)if(be.length>1){const xe=vD(be,it,r.vertical||B,s,V,G);xe&&ge(be,xe,E)}}else if("Polygon"===t.type)for(const be of Kv(t.geometry,0)){const xe=iI(be,16);ge(be[0],new uh(xe.x,xe.y,0,0,void 0),E)}else if("LineString"===t.type)for(const be of t.geometry)ge(be,new uh(be[0].x,be[0].y,0,0,void 0),E);else if("Point"===t.type)for(const be of t.geometry)for(const xe of be)ge([xe],new uh(xe.x,xe.y,0,0,void 0),E)}const Op=255,ch=Op*mu;function hh(e,t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O,R){const B=function(U,G,Z,Q,et,it,yt,xt){const Nt=[];if(0===G.positionedLines.length)return Nt;const ft=Q.layout.get("text-rotate").evaluate(it,{})*Math.PI/180,Ut=function(ge){const be=ge[0],xe=ge[1],Re=be*xe;return Re>0?[be,-xe]:Re<0?[-be,xe]:0===be?[xe,be]:[xe,-be]}(Z);let Wt=Math.abs(G.top-G.bottom);for(const ge of G.positionedLines)Wt-=ge.lineOffset;const le=G.positionedLines.length,Bt=Wt/le;let Zt=G.top-Z[1];for(let ge=0;ge<le;++ge){const be=G.positionedLines[ge];Zt=wD(G,Bt,Zt,ge);for(const xe of be.positionedGlyphs){if(!xe.rect)continue;const Re=xe.rect||{};let ze=_d+1,$e=!0,Ie=1,on=0;if(xe.imageName){const ki=yt[xe.imageName];if(!ki)continue;if(ki.sdf){Gt("SDF images are not supported in formatted text and will be ignored.");continue}$e=!1,Ie=ki.pixelRatio,ze=_u/Ie}const vn=(et||xt)&&xe.vertical,xn=xe.metrics.advance*xe.scale/2,Cn=xe.metrics,Mn=xe.rect;if(null===Mn)continue;xt&&G.verticalizable&&(on=xe.imageName?xn-xe.metrics.width*xe.scale/2:0);const hr=et?[xe.x+xn,xe.y]:[0,0];let qn=[0,0],xi=[0,0],Xr=!1;et||(vn?(xi=[xe.x+xn+Ut[0],xe.y+Ut[1]-on],Xr=!0):qn=[xe.x+xn+Z[0],xe.y+Z[1]-on]);const fr=Mn.w*xe.scale/(Ie*(xe.localGlyph?qu:1)),ir=Mn.h*xe.scale/(Ie*(xe.localGlyph?qu:1));let Wn,Yr,ai,Pr;if(vn){const ki=xe.y-Zt,Ro=new H(-xn,xn-ki),Us=-Math.PI/2,Es=new H(...xi);Wn=new H(-xn+qn[0],qn[1]),Wn._rotateAround(Us,Ro)._add(Es),Wn.x+=-ki+xn,Wn.y-=(Cn.left-ze)*xe.scale;const jo=xe.imageName?Cn.advance*xe.scale:Oa*xe.scale,Ai=String.fromCodePoint(xe.glyph);pD(Ai)?Wn.x+=(1-ze)*xe.scale:$E(Ai)?Wn.x+=jo-Cn.height*xe.scale+(-ze-1)*xe.scale:Wn.x+=xe.imageName||Cn.width+2*ze===Mn.w&&Cn.height+2*ze===Mn.h?(jo-ir)/2:(jo-(Cn.height+2*ze)*xe.scale)/2,Yr=new H(Wn.x,Wn.y-fr),ai=new H(Wn.x+ir,Wn.y),Pr=new H(Wn.x+ir,Wn.y-fr)}else{const ki=(Cn.left-ze)*xe.scale-xn+qn[0],Ro=(-Cn.top-ze)*xe.scale+qn[1],Us=ki+fr,Es=Ro+ir;Wn=new H(ki,Ro),Yr=new H(Us,Ro),ai=new H(ki,Es),Pr=new H(Us,Es)}if(ft){let ki;ki=et?new H(0,0):Xr?new H(Ut[0],Ut[1]):new H(Z[0],Z[1]),Wn._rotateAround(ft,ki),Yr._rotateAround(ft,ki),ai._rotateAround(ft,ki),Pr._rotateAround(ft,ki)}const Ci=new H(0,0),Ds=new H(0,0);Nt.push({tl:Wn,tr:Yr,bl:ai,br:Pr,texPrimary:Re,texSecondary:void 0,writingMode:G.writingMode,glyphOffset:hr,sectionIndex:xe.sectionIndex,isSDF:$e,pixelOffsetTL:Ci,pixelOffsetBR:Ds,minFontScaleX:0,minFontScaleY:0})}}return Nt}(0,s,g,u,c,p,a,e.allowVerticalPlacement),j=e.textSizeData;let V=null;"source"===j.kind?(V=[mu*u.layout.get("text-size").evaluate(p,{},O)],V[0]>ch&&Gt(`${e.layerIds[0]}: Value for "text-size" is >= ${Op}. Reduce your "text-size".`)):"composite"===j.kind&&(V=[mu*D.compositeTextSizes[0].evaluate(p,{},O),mu*D.compositeTextSizes[1].evaluate(p,{},O)],(V[0]>ch||V[1]>ch)&&Gt(`${e.layerIds[0]}: Value for "text-size" is >= ${Op}. Reduce your "text-size".`)),e.addSymbols(e.text,B,V,g,c,p,x,t,r,y.lineStartIndex,y.lineLength,M,P,O,R,!1);for(const U of E)S[U]=e.text.placedSymbolArray.length-1;return 4*B.length}function lI(e){for(const t in e)return e[t];return null}function Iy(e,t,r,s,a,u,c,p,g,y){let x=c.top,E=c.bottom,S=c.left,M=c.right;const D=c.collisionPadding;if(D&&(S-=D[0],x-=D[1],M+=D[2],E+=D[3]),g){const P=new H(S,x),O=new H(M,x),R=new H(S,E),B=new H(M,E),j=St(g);let V=new H(0,0);y&&(V=new H(y[0],y[1])),P._rotateAround(j,V),O._rotateAround(j,V),R._rotateAround(j,V),B._rotateAround(j,V),S=Math.min(P.x,O.x,R.x,B.x),M=Math.max(P.x,O.x,R.x,B.x),x=Math.min(P.y,O.y,R.y,B.y),E=Math.max(P.y,O.y,R.y,B.y)}return e.emplaceBack(t.x,t.y,t.z,r.x,r.y,S,x,M,E,p,s,a,u),e.length-1}function _g(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function ID(e,t,r,s){const a=e.compareText;if(t in a){const u=a[t];for(let c=u.length-1;c>=0;c--)if(s.dist(u[c])<r)return!0}else a[t]=[];return a[t].push(s),!1}function _1(e,t){const r=e.fovAboveCenter,s=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,a=(e._camera.position[2]*e.worldSize-s)/Math.cos(e._pitch),u=Math.sin(r)*a/Math.sin(Math.max(Math.PI/2-e._pitch-r,.01)),c=Math.sin(e._pitch)*u+a;return Math.min(1.01*c,a*(1/e._horizonShift))}function xd(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const r=Math.pow(2,-e.z),s=e.x*r,a=(e.x+1)*r,u=e.y*r,c=(e.y+1)*r,p=pu(s),g=pu(a),y=ws(u),x=ws(c),E=t.project(p,y),S=t.project(g,y),M=t.project(g,x),D=t.project(p,x);let P=Math.min(E.x,S.x,M.x,D.x),O=Math.min(E.y,S.y,M.y,D.y),R=Math.max(E.x,S.x,M.x,D.x),B=Math.max(E.y,S.y,M.y,D.y);const j=r/16;function V(G,Z,Q,et,it,yt){const xt=(Q+it)/2,Nt=(et+yt)/2,ft=t.project(pu(xt),ws(Nt)),Ut=Math.max(0,P-ft.x,O-ft.y,ft.x-R,ft.y-B);P=Math.min(P,ft.x),R=Math.max(R,ft.x),O=Math.min(O,ft.y),B=Math.max(B,ft.y),Ut>j&&(V(G,ft,Q,et,xt,Nt),V(ft,Z,xt,Nt,it,yt))}V(E,S,s,u,a,u),V(S,M,a,u,a,c),V(M,D,a,c,s,c),V(D,E,s,c,s,u),P-=j,O-=j,R+=j,B+=j;const U=1/Math.max(R-P,B-O);return{scale:U,x:P*U,y:O*U,x2:R*U,y2:B*U,projection:t}}function yg(e,t,r,s,a,u,c,p,g){if("globe"===g.name)return Mv(e,t,new Vu(r,s,a),!1);const y=xd({z:r,x:s,y:a},g);return new Qi([(u+y.x/y.scale)*t,t*(y.y/y.scale),c],[(u+y.x2/y.scale)*t,t*(y.y2/y.scale),p])}function Rp(e,{x:t,y:r},s=0){return new H(((t-s)*e.scale-e.x)*$t,(r*e.scale-e.y)*$t)}function y1(e,t,r=0){return Ot.fromValues(((t.x-r)*e.scale-e.x)*$t,(t.y*e.scale-e.y)*$t,pE(t.z,t.y))}const Cy=ce.identity(new Float32Array(16));class bd{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,r){return{x:0,y:0,z:0}}unproject(t,r){return new pr(0,0)}projectTilePoint(t,r,s){return{x:t,y:r,z:0}}locationPoint(t,r,s=!0){return t._coordinatePoint(t.locationCoordinate(r),s)}pixelsPerMeter(t,r){return ji(1,t)*r}pixelSpaceConversion(t,r,s){return 1}farthestPixelDistance(t){return _1(t,t.pixelsPerMeter)}pointCoordinate(t,r,s,a){const u=t.horizonLineFromTop(!1),c=new H(r,Math.max(u,s));return t.rayIntersectionCoordinate(t.pointRayIntersection(c,a))}pointCoordinate3D(t,r,s){const a=new H(r,s);if(t.elevation)return t.elevation.pointCoordinate(a);{const u=this.pointCoordinate(t,a.x,a.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(t,r){if(t.elevation)return!this.pointCoordinate3D(t,r.x,r.y);const s=t.horizonLineFromTop();return r.y<s}createInversionMatrix(t,r){return Cy}createTileMatrix(t,r,s){let a,u,c;const p=s.canonical,g=ce.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const y=xd(p,this);a=1,u=y.x+s.wrap*y.scale,c=y.y,ce.scale(g,g,[a/y.scale,a/y.scale,t.pixelsPerMeter/r])}else a=r/t.zoomScale(p.z),u=(p.x+Math.pow(2,p.z)*s.wrap)*a,c=p.y*a;return ce.translate(g,g,[u,c,0]),ce.scale(g,g,[a/$t,a/$t,1]),g}upVector(t,r,s){return[0,0,1]}upVectorScale(t,r,s){return{metersToTile:1}}}class CD extends bd{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[r,s]=this.parallels=t.parallels||[29.5,45.5],a=Math.sin(St(r));this.n=(a+Math.sin(St(s)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(t,r){const{n:s,c:a,r0:u}=this,c=St(t-this.center[0]),p=St(r),g=Math.sqrt(a-2*s*Math.sin(p))/s;return{x:g*Math.sin(c*s),y:g*Math.cos(c*s)-u,z:0}}unproject(t,r){const{n:s,c:a,r0:u}=this,c=u+r;let p=Math.atan2(t,Math.abs(c))*Math.sign(c);c*s<0&&(p-=Math.PI*Math.sign(t)*Math.sign(c));const g=St(this.center[0])*s;p=wt(p,-Math.PI-g,Math.PI-g);const y=At(Ht(p/s)+this.center[0],-180,180),x=Math.asin(At((a-(t*t+c*c)*s*s)/(2*s),-1,1)),E=At(Ht(x),-Ls,Ls);return new pr(y,E)}}const Np=1.340264,Fp=-.081106,vg=893e-6,xg=.003796,bg=Math.sqrt(3)/2;class uI extends bd{project(t,r){r=r/180*Math.PI,t=t/180*Math.PI;const s=Math.asin(bg*Math.sin(r)),a=s*s,u=a*a*a;return{x:.5*(t*Math.cos(s)/(bg*(Np+3*Fp*a+u*(7*vg+9*xg*a)))/Math.PI+.5),y:1-.5*(s*(Np+Fp*a+u*(vg+xg*a))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,a=s*s,u=a*a*a;for(let x,E,S,M=0;M<12&&(E=s*(Np+Fp*a+u*(vg+xg*a))-r,S=Np+3*Fp*a+u*(7*vg+9*xg*a),x=E/S,s=At(s-x,-Math.PI/3,Math.PI/3),a=s*s,u=a*a*a,!(Math.abs(x)<1e-12));++M);const c=bg*t*(Np+3*Fp*a+u*(7*vg+9*xg*a))/Math.cos(s),p=Math.asin(Math.sin(s)/bg),g=At(180*c/Math.PI,-180,180),y=At(180*p/Math.PI,-Ls,Ls);return new pr(g,y)}}class wg extends bd{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){return{x:.5+t/360,y:.5-r/360,z:0}}unproject(t,r){const s=360*(t-.5),a=At(360*(.5-r),-Ls,Ls);return new pr(s,a)}}const kp=Math.PI/2;function Eg(e){return Math.tan((kp+e)/2)}class cI extends bd{constructor(t){super(t),this.center=t.center||[0,30];const[r,s]=this.parallels=t.parallels||[30,30];let a=St(r),u=St(s);this.southernCenter=a+u<0,this.southernCenter&&(a=-a,u=-u);const c=Math.cos(a),p=Eg(a);this.n=a===u?Math.sin(a):Math.log(c/Math.cos(u))/Math.log(Eg(u)/p),this.f=c*Math.pow(Eg(a),this.n)/this.n}project(t,r){r=St(r),this.southernCenter&&(r=-r),t=St(t-this.center[0]);const s=1e-6,{n:a,f:u}=this;u>0?r<-kp+s&&(r=-kp+s):r>kp-s&&(r=kp-s);const c=u/Math.pow(Eg(r),a);let p=c*Math.sin(a*t),g=u-c*Math.cos(a*t);return p=.5*(p/Math.PI+.5),g=.5*(g/Math.PI+.5),{x:p,y:this.southernCenter?g:1-g,z:0}}unproject(t,r){t=(2*t-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:s,f:a}=this,u=a-r,c=Math.sign(u),p=Math.sign(s)*Math.sqrt(t*t+u*u);let g=Math.atan2(t,Math.abs(u))*c;u*s<0&&(g-=Math.PI*Math.sign(t)*c);const y=At(Ht(g/s)+this.center[0],-180,180),x=At(Ht(2*Math.atan(Math.pow(a/p,1/s))-kp),-Ls,Ls);return new pr(y,this.southernCenter?-x:x)}}class hI extends bd{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,r){return{x:zs(t),y:ba(r),z:0}}unproject(t,r){const s=pu(t),a=ws(r);return new pr(s,a)}}const fI=St(Ls);class Ig extends bd{project(t,r){const s=(r=St(r))*r,a=s*s;return{x:.5*((t=St(t))*(.8707-.131979*s+a*(a*(.003971*s-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+s*(.015085+a*(.028874*s-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,a=25,u=0,c=s*s;do{c=s*s;const y=c*c;u=(s*(1.007226+c*(.015085+y*(.028874*c-.044475-.005916*y)))-r)/(1.007226+c*(.045255+y*(.259866*c-.311325-.005916*11*y))),s=At(s-u,-fI,fI)}while(Math.abs(u)>1e-6&&--a>0);c=s*s;const p=At(Ht(t/(.8707+c*(c*(c*c*c*(.003971-.001529*c)-.013791)-.131979))),-180,180),g=Ht(s);return new pr(p,g)}}const dI=St(Ls);class SD extends bd{project(t,r){r=St(r),t=St(t);const s=Math.cos(r),a=2/Math.PI,u=Math.acos(s*Math.cos(t/2)),c=Math.sin(u)/u,p=.5*(t*a+2*s*Math.sin(t/2)/c)||0,g=.5*(r+Math.sin(r)/c)||0;return{x:.5*(p/Math.PI+.5),y:1-.5*(g/Math.PI+1),z:0}}unproject(t,r){let s=t=(2*t-.5)*Math.PI,a=r=(2*(1-r)-1)*Math.PI,u=25;const c=1e-6;let p=0,g=0;do{const y=Math.cos(a),x=Math.sin(a),E=2*x*y,S=x*x,M=y*y,D=Math.cos(s/2),P=Math.sin(s/2),O=2*D*P,R=P*P,B=1-M*D*D,j=B?1/B:0,V=B?Math.acos(y*D)*Math.sqrt(1/B):0,U=.5*(2*V*y*P+2*s/Math.PI)-t,G=.5*(V*x+a)-r,Z=.5*j*(M*R+V*y*D*S)+1/Math.PI,Q=j*(O*E/4-V*x*P),et=.125*j*(E*P-V*x*M*O),it=.5*j*(S*D+V*R*y)+.5,yt=Q*et-it*Z;p=(G*Q-U*it)/yt,g=(U*et-G*Z)/yt,s=At(s-p,-Math.PI,Math.PI),a=At(a-g,-dI,dI)}while((Math.abs(p)>c||Math.abs(g)>c)&&--u>0);return new pr(Ht(s),Ht(a))}}class pI extends bd{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(St(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){const{scale:s,cosPhi:a}=this;return{x:St(t)*a*s+.5,y:-Math.sin(St(r))/a*s+.5,z:0}}unproject(t,r){const{scale:s,cosPhi:a}=this,u=-(r-.5)/s,c=At(Ht((t-.5)/s)/a,-180,180),p=Math.asin(At(u*a,-1,1)),g=At(Ht(p),-Ls,Ls);return new pr(c,g)}}class MD extends hI{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,r,s){const a=Z_(t,r,s),u=id(Gu(s));return Ot.transformMat4(a,a,u),{x:a[0],y:a[1],z:a[2]}}locationPoint(t,r){const s=du(r.lat,r.lng),a=Ot.normalize([],s),u=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(r),t._centerAltitude):t._centerAltitude,c=ji(1,0)*$t*u;Ot.scaleAndAdd(s,s,a,c);const p=ce.identity(new Float64Array(16));return ce.multiply(p,t.pixelMatrix,t.globeMatrix),Ot.transformMat4(s,s,p),new H(s[0],s[1])}pixelsPerMeter(t,r){return ji(1,0)*r}pixelSpaceConversion(t,r,s){const a=ji(1,t)*r,u=An(ji(1,45)*r,a,s);return this.pixelsPerMeter(t,r)/u}createTileMatrix(t,r,s){const a=W_(Gu(s.canonical));return ce.multiply(new Float64Array(16),t.globeMatrix,a)}createInversionMatrix(t,r){const{center:s}=t,a=id(Gu(r));return ce.rotateY(a,a,St(s.lng)),ce.rotateX(a,a,St(s.lat)),ce.scale(a,a,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(t,r,s,a){return Sv(t,r,s,!0)||new ri(0,0)}pointCoordinate3D(t,r,s){const a=this.pointCoordinate(t,r,s,0);return[a.x,a.y,a.z]}isPointAboveHorizon(t,r){return!Sv(t,r.x,r.y,!1)}farthestPixelDistance(t){const r=function(a,u){const c=a.cameraToCenterDistance,p=a._centerAltitude*u,g=a._camera,y=a._camera.forward(),x=Ot.add([],Ot.scale([],y,-c),[0,0,p]),E=a.worldSize/(2*Math.PI),S=[0,0,-E],M=a.width/a.height,D=Math.tan(a.fovAboveCenter),P=Ot.scale([],g.up(),D),O=Ot.scale([],g.right(),D*M),R=Ot.normalize([],Ot.add([],Ot.add([],y,P),O)),B=[];let j;if(new $_(x,R).closestPointOnSphere(S,E,B)){const V=Ot.add([],B,S),U=Ot.sub([],V,x);j=Math.cos(a.fovAboveCenter)*Ot.length(U)}else{const V=Ot.sub([],x,S),U=Ot.sub([],S,x);Ot.normalize(U,U);const G=Ot.length(V)-E;j=Math.sqrt(G*(G+2*E));const Z=Math.acos(j/(E+G))-Math.acos(Ot.dot(y,U));j*=Math.cos(Z)}return 1.01*j}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),s=da(t.zoom);if(s>0){const a=_1(t,ji(1,t.center.lat)*t.worldSize),u=t.worldSize/(2*Math.PI),c=Math.max(t.width,t.height)/t.worldSize*Math.PI;return An(r,a+u*(1-Math.cos(c)),Math.pow(s,10))}return r}upVector(t,r,s){return Z_(r,s,t,1)}upVectorScale(t){return{metersToTile:rg(Tv(Gu(t)))}}}function Sy(e){const t=e.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new hI(e);case"equirectangular":return new wg(e);case"naturalEarth":return new Ig(e);case"equalEarth":return new uI(e);case"winkelTripel":return new SD(e);case"albers":return r?new pI(e):new CD(e);case"lambertConformalConic":return r?new pI(e):new cI(e);case"globe":return new MD(e)}throw new Error(`Invalid projection name: ${e.name}`)}const TD=new ys({"symbol-placement":new un(It.layout_symbol["symbol-placement"]),"symbol-spacing":new un(It.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new un(It.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Xn(It.layout_symbol["symbol-sort-key"]),"symbol-z-order":new un(It.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new un(It.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new un(It.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new un(It.layout_symbol["icon-ignore-placement"]),"icon-optional":new un(It.layout_symbol["icon-optional"]),"icon-rotation-alignment":new un(It.layout_symbol["icon-rotation-alignment"]),"icon-size":new Xn(It.layout_symbol["icon-size"]),"icon-text-fit":new Xn(It.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xn(It.layout_symbol["icon-text-fit-padding"]),"icon-image":new Xn(It.layout_symbol["icon-image"]),"icon-rotate":new Xn(It.layout_symbol["icon-rotate"]),"icon-padding":new un(It.layout_symbol["icon-padding"]),"icon-keep-upright":new un(It.layout_symbol["icon-keep-upright"]),"icon-offset":new Xn(It.layout_symbol["icon-offset"]),"icon-anchor":new Xn(It.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new un(It.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new un(It.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new un(It.layout_symbol["text-rotation-alignment"]),"text-field":new Xn(It.layout_symbol["text-field"]),"text-font":new Xn(It.layout_symbol["text-font"]),"text-size":new Xn(It.layout_symbol["text-size"]),"text-max-width":new Xn(It.layout_symbol["text-max-width"]),"text-line-height":new Xn(It.layout_symbol["text-line-height"]),"text-letter-spacing":new Xn(It.layout_symbol["text-letter-spacing"]),"text-justify":new Xn(It.layout_symbol["text-justify"]),"text-radial-offset":new Xn(It.layout_symbol["text-radial-offset"]),"text-variable-anchor":new un(It.layout_symbol["text-variable-anchor"]),"text-anchor":new Xn(It.layout_symbol["text-anchor"]),"text-max-angle":new un(It.layout_symbol["text-max-angle"]),"text-writing-mode":new un(It.layout_symbol["text-writing-mode"]),"text-rotate":new Xn(It.layout_symbol["text-rotate"]),"text-padding":new un(It.layout_symbol["text-padding"]),"text-keep-upright":new un(It.layout_symbol["text-keep-upright"]),"text-transform":new Xn(It.layout_symbol["text-transform"]),"text-offset":new Xn(It.layout_symbol["text-offset"]),"text-allow-overlap":new un(It.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new un(It.layout_symbol["text-ignore-placement"]),"text-optional":new un(It.layout_symbol["text-optional"]),visibility:new un(It.layout_symbol.visibility)});var v1={paint:new ys({"icon-opacity":new Xn(It.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Xn(It.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Xn(It.paint_symbol["text-emissive-strength"]),"icon-color":new Xn(It.paint_symbol["icon-color"]),"icon-halo-color":new Xn(It.paint_symbol["icon-halo-color"]),"icon-halo-width":new Xn(It.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Xn(It.paint_symbol["icon-halo-blur"]),"icon-translate":new un(It.paint_symbol["icon-translate"]),"icon-translate-anchor":new un(It.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Xn(It.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Xn(It.paint_symbol["text-opacity"]),"text-color":new Xn(It.paint_symbol["text-color"],{runtimeType:Vs,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Xn(It.paint_symbol["text-halo-color"]),"text-halo-width":new Xn(It.paint_symbol["text-halo-width"]),"text-halo-blur":new Xn(It.paint_symbol["text-halo-blur"]),"text-translate":new un(It.paint_symbol["text-translate"]),"text-translate-anchor":new un(It.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new un(It.paint_symbol["icon-color-saturation"])}),layout:TD};class mI{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Jo,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Fn(mI,"FormatSectionOverride",{omit:["defaultValue"]});class Cg extends $l{constructor(t,r){super(t,v1,r)}recalculate(t,r){super.recalculate(t,r),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const a=[];for(const u of s)a.indexOf(u)<0&&a.push(u);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,r,s,a){const u=this.layout.get(t).evaluate(r,{},s,a),c=this._unevaluatedLayout._values[t];return c.isDataDriven()||Qd(c.value)||!u?u:(p=r.properties,u.replace(/{([^{}]+)}/g,(y,x)=>x in p?String(p[x]):""));var p}createBucket(t){return new Bp(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of v1.paint.overridableProperties){if(!Cg.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),s=new mI(r),a=new Em(s,r.property.specification);let u=null;u="constant"===r.value.kind||"source"===r.value.kind?new u_("source",a):new Th("composite",a,r.value.zoomStops,r.value._interpolationType),this.paint._values[t]=new lf(r.property,u,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&Cg.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const s=t.get("text-field"),a=v1.paint.properties[r];let u=!1;const c=p=>{for(const g of p)if(a.overrides&&a.overrides.hasOverride(g))return void(u=!0)};if("constant"===s.value.kind&&s.value.value instanceof Fo)c(s.value.value.sections);else if("source"===s.value.kind){const p=y=>{u||(y instanceof dr&&Zr(y.value)===ur?c(y.value.sections):y instanceof ii?c(y.sections):y.eachChild(p))},g=s.value;g._styleExpression&&p(g._styleExpression.expression)}return u}getProgramIds(){const t=0!==this.paint.get("icon-opacity").constantOr(1),r=0!==this.paint.get("text-opacity").constantOr(1),s=[];return t&&s.push("symbolIcon"),r&&s.push("symbolSDF"),s}getDefaultProgramParams(t,r){return{config:new Jf(this,r),overrideFog:!1}}}const gI=r1.types,DD=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wd(e,t,r,s,a,u,c,p,g,y,x,E,S){const M=p?Math.min(ch,Math.round(p[0])):0,D=p?Math.min(ch,Math.round(p[1])):0;e.emplaceBack(t,r,Math.round(32*s),Math.round(32*a),u,c,(M<<1)+(g?1:0),D,16*y,16*x,256*E,256*S)}function My(e,t,r){e.emplaceBack(t,r)}function Ty(e,t,r,s,a,u,c){e.emplaceBack(t,r,s,a,u,c)}function Dy(e,t,r,s,a){const u=5*t+2;e.float32[u+0]=r,e.float32[u+1]=s,e.float32[u+2]=a}function zp(e,t,r,s,a){e.emplaceBack(t,r,s,a),e.emplaceBack(t,r,s,a),e.emplaceBack(t,r,s,a),e.emplaceBack(t,r,s,a)}function AD(e){for(const t of e.sections)if(pT(t.text))return!0;return!1}class x1{constructor(t){this.layoutVertexArray=new op,this.indexArray=new ea,this.programConfigurations=t,this.segments=new Ui,this.dynamicLayoutVertexArray=new oc,this.opacityVertexArray=new Om,this.placedSymbolArray=new J0,this.iconTransitioningVertexArray=new Oh,this.globeExtVertexArray=new sp,this.zOffsetVertexArray=new E_}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(t,r,s,a,u){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hD.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,jE.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,DD,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,dD.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,fD.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,XL.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||a)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Fn(x1,"SymbolBuffers");class b1{constructor(t,r,s){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new s,this.segments=new Ui,this.collisionVertexArray=new Zf,this.collisionVertexArrayExt=new oc}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,YL.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,JL.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Fn(b1,"CollisionBuffers");class Sg{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ce.identity([]),this.placementViewportMatrix=ce.identity([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=gy(this.zoom,r["text-size"]),this.iconSizeData=gy(this.zoom,r["icon-size"]);const s=this.layers[0].layout,a=s.get("symbol-sort-key"),u=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==u&&void 0!==a.constantOr(1),this.sortFeaturesByY=("viewport-y"===u||"auto"===u&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(c=>Zo[c]),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=s.get("symbol-z-elevate")}createArrays(){this.text=new x1(new ff(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new x1(new ff(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new pw,this.lineVertexArray=new km,this.symbolInstances=new Mc}calculateGlyphDependencies(t,r,s,a,u){for(let c=0;c<t.length;c++){const p=t.codePointAt(c);if(void 0===p)break;if(r[p]=!0,a&&u&&p<=65535){const g=hi[t.charAt(c)];g&&(r[g.charCodeAt(0)]=!0)}}}populate(t,r,s,a){const u=this.layers[0],c=u.layout,p="globe"===this.projection.name,g=c.get("text-font"),y=c.get("text-field"),x=c.get("icon-image"),E=("constant"!==y.value.kind||y.value.value instanceof Fo&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&("constant"!==g.value.kind||g.value.value.length>0),S="constant"!==x.value.kind||!!x.value.value||Object.keys(x.parameters).length>0,M=c.get("symbol-sort-key");if(this.features=[],!E&&!S)return;const D=r.iconDependencies,P=r.glyphDependencies,O=r.availableImages,R=new ss(this.zoom);for(const{feature:B,id:j,index:V,sourceLayerIndex:U}of t){const G=u._featureFilter.needGeometry,Z=ih(B,G);if(!u._featureFilter.filter(R,Z,s))continue;if(G||(Z.geometry=Rc(B,s,a)),p&&1!==B.type&&s.z<=5){const yt=Z.geometry,xt=.98078528056,Nt=(ft,Ut)=>{const Wt=Z_(ft.x,ft.y,s,1),le=Z_(Ut.x,Ut.y,s,1);return Ot.dot(Wt,le)<xt};for(let ft=0;ft<yt.length;ft++)yt[ft]=$L(yt[ft],Nt)}let Q,et;if(E){const yt=u.getValueAndResolveTokens("text-field",Z,s,O),xt=Fo.factory(yt);AD(xt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===g_()||this.hasRTLText&&La.isParsed())&&(Q=qE(xt,u,Z))}if(S){const yt=u.getValueAndResolveTokens("icon-image",Z,s,O);et=yt instanceof gi?yt:gi.fromString(yt)}if(!Q&&!et)continue;const it=this.sortFeaturesByKey?M.evaluate(Z,{},s):void 0;if(this.features.push({id:j,text:Q,icon:et,index:V,sourceLayerIndex:U,geometry:Z.geometry,properties:B.properties,type:gI[B.type],sortKey:it}),et&&(D[et.namePrimary]=!0,et.nameSecondary&&(D[et.nameSecondary]=!0)),Q){const yt=g.evaluate(Z,{},s).join(","),xt="map"===c.get("text-rotation-alignment")&&"point"!==c.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Zo.vertical)>=0;for(const Nt of Q.sections)if(Nt.image)D[Nt.image.namePrimary]=!0;else{const ft=j0(Q.toString()),Ut=Nt.fontStack||yt,Wt=P[Ut]=P[Ut]||{};this.calculateGlyphDependencies(Nt.text,Wt,xt,this.allowVerticalPlacement,ft)}}}"line"===c.get("symbol-placement")&&(this.features=function(B){const j={},V={},U=[];let G=0;function Z(yt){U.push(B[yt]),G++}function Q(yt,xt,Nt){const ft=V[yt];return delete V[yt],V[xt]=ft,U[ft].geometry[0].pop(),U[ft].geometry[0]=U[ft].geometry[0].concat(Nt[0]),ft}function et(yt,xt,Nt){const ft=j[xt];return delete j[xt],j[yt]=ft,U[ft].geometry[0].shift(),U[ft].geometry[0]=Nt[0].concat(U[ft].geometry[0]),ft}function it(yt,xt,Nt){const ft=Nt?xt[0][xt[0].length-1]:xt[0][0];return`${yt}:${ft.x}:${ft.y}`}for(let yt=0;yt<B.length;yt++){const xt=B[yt],Nt=xt.geometry,ft=xt.text?xt.text.toString():null;if(!ft){Z(yt);continue}const Ut=it(ft,Nt),Wt=it(ft,Nt,!0);if(Ut in V&&Wt in j&&V[Ut]!==j[Wt]){const le=et(Ut,Wt,Nt),Bt=Q(Ut,Wt,U[le].geometry);delete j[Ut],delete V[Wt],V[it(ft,U[Bt].geometry,!0)]=Bt,U[le].geometry=null}else Ut in V?Q(Ut,Wt,Nt):Wt in j?et(Ut,Wt,Nt):(Z(yt),j[Ut]=G-1,V[Wt]=G-1)}return U.filter(yt=>yt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((B,j)=>B.sortKey-j.sortKey)}update(t,r,s,a,u){const c=0!==Object.keys(t).length;if(c&&!this.stateDependentLayers.length)return;const p=c?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,r,p,s,a,u),this.icon.programConfigurations.updatePaintArrays(t,r,p,s,a,u)}updateZOffset(){const t=(u,c,p)=>{s+=c,s>u.length&&u.resize(s);for(let g=-c;g<0;g++)u.emplace(g+s,p)},r=(u,c,p)=>{a+=c,a>u.length&&u.resize(a);for(let g=-c;g<0;g++)u.emplace(g+a,p)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,a=0;for(let u=0;u<this.symbolInstances.length;u++){const c=this.symbolInstances.get(u),{numHorizontalGlyphVertices:p,numVerticalGlyphVertices:g,numIconVertices:y}=c,x=c.zOffset,E=y>0;if((p>0||g>0)&&(t(this.text.zOffsetVertexArray,p,x),t(this.text.zOffsetVertexArray,g,x)),E){const{placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:M}=c;S>=0&&r(this.icon.zOffsetVertexArray,y,x),M>=0&&r(this.icon.zOffsetVertexArray,c.numVerticalIconVertices,x)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Sy(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const s=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:a,y:u}of r)this.lineVertexArray.emplaceBack(a,u);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O){const R=t.indexArray,B=t.layoutVertexArray,j=t.globeExtVertexArray,V=t.segments.prepareSegment(4*r.length,B,R,this.canOverlap?c.sortKey:void 0),U=this.glyphOffsetArray.length,G=V.vertexLength,Z=this.allowVerticalPlacement&&p===Zo.vertical?Math.PI/2:0,Q=c.text&&c.text.sections;for(let it=0;it<r.length;it++){const{tl:yt,tr:xt,bl:Nt,br:ft,texPrimary:Ut,texSecondary:Wt,pixelOffsetTL:le,pixelOffsetBR:Bt,minFontScaleX:Zt,minFontScaleY:ge,glyphOffset:be,isSDF:xe,sectionIndex:Re}=r[it],ze=V.vertexLength,$e=be[1];if(wd(B,y.x,y.y,yt.x,$e+yt.y,Ut.x,Ut.y,s,xe,le.x,le.y,Zt,ge),wd(B,y.x,y.y,xt.x,$e+xt.y,Ut.x+Ut.w,Ut.y,s,xe,Bt.x,le.y,Zt,ge),wd(B,y.x,y.y,Nt.x,$e+Nt.y,Ut.x,Ut.y+Ut.h,s,xe,le.x,Bt.y,Zt,ge),wd(B,y.x,y.y,ft.x,$e+ft.y,Ut.x+Ut.w,Ut.y+Ut.h,s,xe,Bt.x,Bt.y,Zt,ge),g){const{x:Ie,y:on,z:vn}=g.anchor,[xn,Cn,Mn]=g.up;Ty(j,Ie,on,vn,xn,Cn,Mn),Ty(j,Ie,on,vn,xn,Cn,Mn),Ty(j,Ie,on,vn,xn,Cn,Mn),Ty(j,Ie,on,vn,xn,Cn,Mn),zp(t.dynamicLayoutVertexArray,Ie,on,vn,Z)}else zp(t.dynamicLayoutVertexArray,y.x,y.y,y.z,Z);if(O){const Ie=Wt||Ut;My(t.iconTransitioningVertexArray,Ie.x,Ie.y),My(t.iconTransitioningVertexArray,Ie.x+Ie.w,Ie.y),My(t.iconTransitioningVertexArray,Ie.x,Ie.y+Ie.h),My(t.iconTransitioningVertexArray,Ie.x+Ie.w,Ie.y+Ie.h)}R.emplaceBack(ze,ze+1,ze+2),R.emplaceBack(ze+1,ze+2,ze+3),V.vertexLength+=4,V.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(be[0]),it!==r.length-1&&Re===r[it+1].sectionIndex||t.programConfigurations.populatePaintArrays(B.length,c,c.index,{},M,D,P,Q&&Q[Re])}const et=g?g.anchor:y;t.placedSymbolArray.emplaceBack(et.x,et.y,et.z,y.x,y.y,U,this.glyphOffsetArray.length-U,G,x,E,y.segment,s?s[0]:0,s?s[1]:0,a[0],a[1],p,0,!1,0,S,0)}_commitLayoutVertex(t,r,s,a,u,c,p){t.emplaceBack(r,s,a,u,c,Math.round(p.x),Math.round(p.y))}_addCollisionDebugVertices(t,r,s,a,u,c,p){const g=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),y=g.vertexLength,x=p.tileAnchorX,E=p.tileAnchorY;for(let M=0;M<4;M++)s.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,r,t.padding,p.zOffset),this._commitLayoutVertex(s.layoutVertexArray,a,u,c,x,E,new H(t.x1,t.y1)),this._commitLayoutVertex(s.layoutVertexArray,a,u,c,x,E,new H(t.x2,t.y1)),this._commitLayoutVertex(s.layoutVertexArray,a,u,c,x,E,new H(t.x2,t.y2)),this._commitLayoutVertex(s.layoutVertexArray,a,u,c,x,E,new H(t.x1,t.y2)),g.vertexLength+=4;const S=s.indexArray;S.emplaceBack(y,y+1),S.emplaceBack(y+1,y+2),S.emplaceBack(y+2,y+3),S.emplaceBack(y+3,y),g.primitiveLength+=4}_addTextDebugCollisionBoxes(t,r,s,a,u,c){for(let p=a;p<u;p++){const g=s.get(p),y=this.getSymbolInstanceTextSize(t,c,r,p);this._addCollisionDebugVertices(g,y,this.textCollisionBox,g.projectedAnchorX,g.projectedAnchorY,g.projectedAnchorZ,c)}}_addIconDebugCollisionBoxes(t,r,s,a,u,c){for(let p=a;p<u;p++){const g=s.get(p),y=this.getSymbolInstanceIconSize(t,r,c.placedIconSymbolIndex);this._addCollisionDebugVertices(g,y,this.iconCollisionBox,g.projectedAnchorX,g.projectedAnchorY,g.projectedAnchorZ,c)}}generateCollisionDebugBuffers(t,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new b1(w_,f1.members,Oh),this.iconCollisionBox=new b1(w_,f1.members,Oh);const s=lh(this.iconSizeData,t),a=lh(this.textSizeData,t);for(let u=0;u<this.symbolInstances.length;u++){const c=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(a,t,r,c.textBoxStartIndex,c.textBoxEndIndex,c),this._addTextDebugCollisionBoxes(a,t,r,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c),this._addIconDebugCollisionBoxes(s,t,r,c.iconBoxStartIndex,c.iconBoxEndIndex,c),this._addIconDebugCollisionBoxes(s,t,r,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c)}}getSymbolInstanceTextSize(t,r,s,a){const u=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:a),c=Cp(this.textSizeData,t,u)/Oa;return this.tilePixelRatio*c}getSymbolInstanceIconSize(t,r,s){const a=this.icon.placedSymbolArray.get(s),u=Cp(this.iconSizeData,t,a);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(t,r,s,a){t.emplaceBack(r,-s,-s,a),t.emplaceBack(r,s,-s,a),t.emplaceBack(r,s,s,a),t.emplaceBack(r,-s,s,a)}_updateTextDebugCollisionBoxes(t,r,s,a,u,c){for(let p=a;p<u;p++){const g=s.get(p),y=this.getSymbolInstanceTextSize(t,c,r,p);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,y,g.padding,c.zOffset)}}_updateIconDebugCollisionBoxes(t,r,s,a,u,c){for(let p=a;p<u;p++){const g=s.get(p),y=this.getSymbolInstanceIconSize(t,r,c.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,y,g.padding,c.zOffset)}}updateCollisionDebugBuffers(t,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=lh(this.iconSizeData,t),a=lh(this.textSizeData,t);for(let u=0;u<this.symbolInstances.length;u++){const c=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(a,t,r,c.textBoxStartIndex,c.textBoxEndIndex,c),this._updateTextDebugCollisionBoxes(a,t,r,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c),this._updateIconDebugCollisionBoxes(s,t,r,c.iconBoxStartIndex,c.iconBoxEndIndex,c),this._updateIconDebugCollisionBoxes(s,t,r,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,r,s,a,u,c,p,g,y){const x={};if(r<s){const{x1:E,y1:S,x2:M,y2:D,padding:P,projectedAnchorX:O,projectedAnchorY:R,projectedAnchorZ:B,tileAnchorX:j,tileAnchorY:V,featureIndex:U}=t.get(r);x.textBox={x1:E,y1:S,x2:M,y2:D,padding:P,projectedAnchorX:O,projectedAnchorY:R,projectedAnchorZ:B,tileAnchorX:j,tileAnchorY:V},x.textFeatureIndex=U}if(a<u){const{x1:E,y1:S,x2:M,y2:D,padding:P,projectedAnchorX:O,projectedAnchorY:R,projectedAnchorZ:B,tileAnchorX:j,tileAnchorY:V,featureIndex:U}=t.get(a);x.verticalTextBox={x1:E,y1:S,x2:M,y2:D,padding:P,projectedAnchorX:O,projectedAnchorY:R,projectedAnchorZ:B,tileAnchorX:j,tileAnchorY:V},x.verticalTextFeatureIndex=U}if(c<p){const{x1:E,y1:S,x2:M,y2:D,padding:P,projectedAnchorX:O,projectedAnchorY:R,projectedAnchorZ:B,tileAnchorX:j,tileAnchorY:V,featureIndex:U}=t.get(c);x.iconBox={x1:E,y1:S,x2:M,y2:D,padding:P,projectedAnchorX:O,projectedAnchorY:R,projectedAnchorZ:B,tileAnchorX:j,tileAnchorY:V},x.iconFeatureIndex=U}if(g<y){const{x1:E,y1:S,x2:M,y2:D,padding:P,projectedAnchorX:O,projectedAnchorY:R,projectedAnchorZ:B,tileAnchorX:j,tileAnchorY:V,featureIndex:U}=t.get(g);x.verticalIconBox={x1:E,y1:S,x2:M,y2:D,padding:P,projectedAnchorX:O,projectedAnchorY:R,projectedAnchorZ:B,tileAnchorX:j,tileAnchorY:V},x.verticalIconFeatureIndex=U}return x}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,r){const s=t.placedSymbolArray.get(r),a=s.vertexStartIndex+4*s.numGlyphs;for(let u=s.vertexStartIndex;u<a;u+=4)t.indexArray.emplaceBack(u,u+1,u+2),t.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const r=Math.sin(t),s=Math.cos(t),a=[],u=[],c=[];for(let p=0;p<this.symbolInstances.length;++p){c.push(p);const g=this.symbolInstances.get(p);a.push(0|Math.round(r*g.tileAnchorX+s*g.tileAnchorY)),u.push(g.featureIndex)}return c.sort((p,g)=>a[p]-a[g]||u[g]-u[p]),c}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:c,verticalPlacedTextSymbolIndex:p,placedIconSymbolIndex:g,verticalPlacedIconSymbolIndex:y}=s;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),u>=0&&u!==a&&this.addIndicesForPlacedSymbol(this.text,u),c>=0&&c!==u&&c!==a&&this.addIndicesForPlacedSymbol(this.text,c),p>=0&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&this.addIndicesForPlacedSymbol(this.icon,g),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Fn(Sg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Sg.MAX_GLYPHS=65535,Sg.addDynamicAttributes=zp;var Bp=Sg;const PD=yr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:KL}=PD,_I=yr([{name:"a_packed",components:4,type:"Float32"}]),{members:LD}=_I,QL=r1.types,Ay=Math.cos(Math.PI/180*37.5);class Py{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new v_,this.layoutVertexArray2=new oc,this.indexArray=new ea,this.programConfigurations=new ff(t.layers,t.zoom),this.segments=new Ui,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s,a){this.hasPattern=SE("line",this.layers,r);const u=this.layers[0].layout.get("line-sort-key"),c=[];for(const{feature:x,id:E,index:S,sourceLayerIndex:M}of t){const D=this.layers[0]._featureFilter.needGeometry,P=ih(x,D);if(!this.layers[0]._featureFilter.filter(new ss(this.zoom),P,s))continue;const O=u?u.evaluate(P,{},s):void 0,R={id:E,properties:x.properties,type:x.type,sourceLayerIndex:M,index:S,geometry:D?P.geometry:Rc(x,s,a),patterns:{},sortKey:O};c.push(R)}u&&c.sort((x,E)=>x.sortKey-E.sortKey);const{lineAtlas:p,featureIndex:g}=r,y=this.addConstantDashes(p);for(const x of c){const{geometry:E,index:S,sourceLayerIndex:M}=x;if(y&&this.addFeatureDashes(x,p),this.hasPattern){const D=Qv("line",this.layers,x,this.zoom,r);this.patternFeatures.push(D)}else this.addFeature(x,E,S,s,p.positions,r.availableImages,r.brightness);g.insert(t[S].feature,E,S,M,this.index)}}addConstantDashes(t){let r=!1;for(const s of this.layers){const a=s.paint.get("line-dasharray").value,u=s.layout.get("line-cap").value;if("constant"!==a.kind||"constant"!==u.kind)r=!0;else{const c=u.value,p=a.value;if(!p)continue;t.addDash(p,c)}}return r}addFeatureDashes(t,r){const s=this.zoom;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,c=a.layout.get("line-cap").value;if("constant"===u.kind&&"constant"===c.kind)continue;let p,g;if("constant"===u.kind){if(p=u.value,!p)continue}else p=u.evaluate({zoom:s},t);g="constant"===c.kind?c.value:c.evaluate({zoom:s},t),r.addDash(p,g),t.patterns[a.id]=r.getKey(p,g)}}update(t,r,s,a,u){const c=0!==Object.keys(t).length;c&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,r,c?this.stateDependentLayers:this.layers,s,a,u)}addFeatures(t,r,s,a,u,c){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,s,a,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,LD)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,KL),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,s,a,u,c,p){const g=this.layers[0].layout,y=g.get("line-join").evaluate(t,{}),x=g.get("line-cap").evaluate(t,{}),E=g.get("line-miter-limit"),S=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const M of r)this.addLine(M,t,y,x,E,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,u,c,a,p)}addLine(t,r,s,a,u,c){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let R=0;R<t.length-1;R++)this.totalDistance+=t[R].dist(t[R+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const p="Polygon"===QL[r.type];let g=t.length;for(;g>=2&&t[g-1].equals(t[g-2]);)g--;let y=0;for(;y<g-1&&t[y].equals(t[y+1]);)y++;if(g<(p?3:2))return;"bevel"===s&&(u=1.05);const x=this.overscaling<=16?15*$t/(512*this.overscaling):0,E=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray);let S,M,D,P,O;this.e1=this.e2=-1,p&&(S=t[g-2],O=t[y].sub(S)._unit()._perp());for(let R=y;R<g;R++){if(D=R===g-1?p?t[y+1]:void 0:t[R+1],D&&t[R].equals(D))continue;O&&(P=O),S&&(M=S),S=t[R],O=D?D.sub(S)._unit()._perp():P,P=P||O;let B=P.add(O);0===B.x&&0===B.y||B._unit();const j=P.x*O.x+P.y*O.y,V=B.x*O.x+B.y*O.y,U=0!==V?1/V:1/0,G=2*Math.sqrt(2-2*V),Z=V<Ay&&M&&D,Q=P.x*O.y-P.y*O.x>0;if(Z&&R>y){const yt=S.dist(M);if(yt>2*x){const xt=S.sub(S.sub(M)._mult(x/yt)._round());this.updateDistance(M,xt),this.addCurrentVertex(xt,P,0,0,E),M=xt}}const et=M&&D;let it=et?s:p?"butt":a;if(et&&"round"===it&&(U<c?it="miter":U<=2&&(it="fakeround")),"miter"===it&&U>u&&(it="bevel"),"bevel"===it&&(U>2&&(it="flipbevel"),U<u&&(it="miter")),M&&this.updateDistance(M,S),"miter"===it)B._mult(U),this.addCurrentVertex(S,B,0,0,E);else if("flipbevel"===it){if(U>100)B=O.mult(-1);else{const yt=U*P.add(O).mag()/P.sub(O).mag();B._perp()._mult(yt*(Q?-1:1))}this.addCurrentVertex(S,B,0,0,E),this.addCurrentVertex(S,B.mult(-1),0,0,E)}else if("bevel"===it||"fakeround"===it){const yt=-Math.sqrt(U*U-1),xt=Q?yt:0,Nt=Q?0:yt;if(M&&this.addCurrentVertex(S,P,xt,Nt,E),"fakeround"===it){const ft=Math.round(180*G/Math.PI/20);for(let Ut=1;Ut<ft;Ut++){let Wt=Ut/ft;if(.5!==Wt){const Bt=Wt-.5;Wt+=Wt*Bt*(Wt-1)*((1.0904+j*(j*(3.55645-1.43519*j)-3.2452))*Bt*Bt+(.848013+j*(.215638*j-1.06021)))}const le=O.sub(P)._mult(Wt)._add(P)._unit()._mult(Q?-1:1);this.addHalfVertex(S,le.x,le.y,!1,Q,0,E)}}D&&this.addCurrentVertex(S,O,-xt,-Nt,E)}else if("butt"===it)this.addCurrentVertex(S,B,0,0,E);else if("square"===it){const yt=M?1:-1;M||this.addCurrentVertex(S,B,yt,yt,E),this.addCurrentVertex(S,B,0,0,E),M&&this.addCurrentVertex(S,B,yt,yt,E)}else"round"===it&&(M&&(this.addCurrentVertex(S,P,0,0,E),this.addCurrentVertex(S,P,1,1,E,!0)),D&&(this.addCurrentVertex(S,O,-1,-1,E,!0),this.addCurrentVertex(S,O,0,0,E)));if(Z&&R<g-1){const yt=S.dist(D);if(yt>2*x){const xt=S.add(D.sub(S)._mult(x/yt)._round());this.updateDistance(S,xt),this.addCurrentVertex(xt,O,0,0,E),S=xt}}}}addCurrentVertex(t,r,s,a,u,c=!1){const p=r.y*a-r.x,g=-r.y-r.x*a;this.addHalfVertex(t,r.x+r.y*s,r.y-r.x*s,c,!1,s,u),this.addHalfVertex(t,p,g,c,!0,-a,u)}addHalfVertex({x:t,y:r},s,a,u,c,p,g){this.layoutVertexArray.emplaceBack((t<<1)+(u?1:0),(r<<1)+(c?1:0),Math.round(63*s)+128,Math.round(63*a)+128,1+(0===p?0:p<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const y=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,y),g.primitiveLength++),c?this.e2=y:this.e1=y}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}Fn(Py,"LineBucket",{omit:["layers","patternFeatures"]});class fs{constructor(t,r,s,a){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(r,a)}update(t,r,s){const{width:a,height:u}=t,{context:c}=this,{gl:p}=c,{HTMLImageElement:g,HTMLCanvasElement:y,HTMLVideoElement:x,ImageData:E,ImageBitmap:S}=rt;if(p.bindTexture(p.TEXTURE_2D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA&&(!r||!1!==r.premultiply)),s||this.size&&this.size[0]===a&&this.size[1]===u){const{x:M,y:D}=s||{x:0,y:0};if(t instanceof g||t instanceof y||t instanceof x||t instanceof E||S&&t instanceof S)p.texSubImage2D(p.TEXTURE_2D,0,M,D,p.RGBA,p.UNSIGNED_BYTE,t);else{let P=this.format,O=p.UNSIGNED_BYTE;this.format===p.R32F&&(P=p.RED,O=p.FLOAT),p.texSubImage2D(p.TEXTURE_2D,0,M,D,a,u,P,O,t.data)}}else if(this.size=[a,u],t instanceof g||t instanceof y||t instanceof x||t instanceof E||S&&t instanceof S){let M=this.format;this.format===p.R8&&(M=p.RED),p.texImage2D(p.TEXTURE_2D,0,this.format,M,p.UNSIGNED_BYTE,t)}else{let M=this.format,D=this.format,P=p.UNSIGNED_BYTE;this.format===p.DEPTH_COMPONENT&&(M=p.DEPTH_COMPONENT16,P=p.UNSIGNED_SHORT),this.format===p.R32F&&(P=p.FLOAT,D=p.RED),p.texImage2D(p.TEXTURE_2D,0,M,a,u,0,D,P,t.data)}this.useMipmap=!(!r||!r.useMipmap),this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(t,r){const{context:s}=this,{gl:a}=s;a.bindTexture(a.TEXTURE_2D,this.texture),t!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?t===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),r!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,r),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(t,r,s,a){const{context:u}=this,{gl:c}=u;c.bindTexture(c.TEXTURE_2D,this.texture),r!==this.magFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,r),this.magFilter=r),t!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?t===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),s!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,s),this.wrapS=s),a!==this.wrapT&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,a),this.wrapT=a)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Up{constructor(t,r){this.context=t,this.texture=r}bind(t,r){const{context:s}=this,{gl:a}=s;a.bindTexture(a.TEXTURE_2D,this.texture),t!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,t),this.minFilter=t),r!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,r),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,r),this.wrapS=r)}}const fc=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,r=0,s=0,a=0,u=0,c=0,p=0;for(1&t?a=u=c=32:r=s=p=32;(t>>=1)>1;){const y=r+a>>1,x=s+u>>1;1&t?(a=r,u=s,r=c,s=p):(r=a,s=u,a=c,u=p),c=y,p=x}const g=4*e;fc[g+0]=r,fc[g+1]=s,fc[g+2]=a,fc[g+3]=u}const Zs=new Uint16Array(2178),yu=new Uint8Array(1089),Ed=new Uint16Array(1089);function Hu(e){return 0===e?-.03125:32===e?.03125:0}var Ly=yr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Id={type:2,extent:$t,loadGeometry:()=>[[new H(0,0),new H($t+1,0),new H($t+1,$t+1),new H(0,$t+1),new H(0,0)]]};class fh{constructor(t,r,s,a,u){this.tileID=t,this.uid=On(),this.uses=0,this.tileSize=r,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,a&&a.style&&(this._lastUpdatedBrightness=a.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",a&&a.transform&&(this.projection=a.transform.projection)}registerFadeDuration(t){const r=t+this.timeAdded;r<or.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=xd(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,s){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(a,u){const c={};if(!u)return c;for(const p of a){const g=p.layerIds.map(y=>u.getLayer(y)).filter(Boolean);if(0!==g.length){p.layers=g,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(y=>g.filter(x=>x.id===y)[0]));for(const y of g)c[y.fqid]=p}}return c}(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const a in this.buckets){const u=this.buckets[a];if(u instanceof Bp){if(this.hasSymbolBuckets=!0,!s)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const a in this.buckets){const u=this.buckets[a];if(u instanceof Bp&&u.hasRTLText){this.hasRTLText=!0,La.isLoading()||La.isLoaded()||"deferred"!==g_()||Ol();break}}this.queryPadding=0;for(const a in this.buckets){const u=this.buckets[a],c=r.style.getOwnLayer(a);if(!c)continue;const p=c.queryRadius(u);this.queryPadding=Math.max(this.queryPadding,p)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new fw}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const s in this.buckets){const a=this.buckets[s];a.uploadPending()&&a.upload(t)}const r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new fs(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new fs(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new fs(t,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t,r,s){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,s),!r||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const a=r.style.getBrightness();(this._lastUpdatedBrightness||a)&&(this._lastUpdatedBrightness&&a&&Math.abs(this._lastUpdatedBrightness-a)<.001||(this._lastUpdatedBrightness=a,this.updateBuckets(void 0,r)))}queryRenderedFeatures(t,r,s,a,u,c,p,g){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:a,pixelPosMatrix:p,transform:c,params:u,tileTransform:this.tileTransform},t,r,s):{}}querySourceFeatures(t,r){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const a=s.loadVTLayers(),u=r?r.sourceLayer:"",c=a._geojsonTileLayer||a[u];if(!c)return;const p=ep(r&&r.filter),{z:g,x:y,y:x}=this.tileID.canonical,E={z:g,x:y,y:x};for(let S=0;S<c.length;S++){const M=c.feature(S);if(p.needGeometry){const O=ih(M,!0);if(!p.filter(new ss(this.tileID.overscaledZ),O,this.tileID.canonical))continue}else if(!p.filter(new ss(this.tileID.overscaledZ),M))continue;const D=s.getId(M,u),P=new u1(M,g,y,x,D);P.tile=E,t.push(P)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const t in this.buckets)if(this.buckets[t].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const s=Rn(t.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const s=Date.now();let a=!1;if(this.expirationTime>s)a=!1;else if(r)if(this.expirationTime<r)a=!0;else{const u=this.expirationTime-r;u?this.expirationTime=s+Math.max(u,3e4):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length&&r&&this.updateBuckets(t,r)}updateBuckets(t,r){if(!this.latestFeatureIndex)return;const s=this.latestFeatureIndex.loadVTLayers(),a=r.style.listImages(),u=r.style.getBrightness();for(const c in this.buckets){if(!r.style.hasLayer(c))continue;const p=this.buckets[c],g=p.layers[0].sourceLayer||"_geojsonTileLayer",y=s[g];let x={};if(t&&(x=t[g],!y||!x||0===Object.keys(x).length))continue;if(p.update(x,y,a,this.imageAtlas&&this.imageAtlas.patternPositions||{},u),p instanceof Py||p instanceof fd){const S=r.style.getOwnSourceCache(p.layers[0].source);r._terrain&&r._terrain.enabled&&S&&p.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(S.id,this.tileID)}const E=r&&r.style&&r.style.getOwnLayer(c);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(p)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<or.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=or.now()+t}setTexture(t,r){const s=r.context,a=s.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof fs?this.texture.update(t,{useMipmap:!0}):(this.texture=new fs(s,t,a.RGBA,{useMipmap:!0}),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE))}setDependencies(t,r){const s={};for(const a of r)s[a]=!0;this.dependencies[t]=s}hasDependency(t,r){for(const s of t){const a=this.dependencies[s];if(a)for(const u of r)if(a[u])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||"mercator"===r.name||this._tileDebugBuffer)return;const s=Rc(Id,this.tileID.canonical,this.tileTransform)[0],a=new hu,u=new I_;for(let c=0;c<s.length;c++){const{x:p,y:g}=s[c];a.emplaceBack(p,g),u.emplaceBack(c)}u.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(u),this._tileDebugBuffer=t.createVertexBuffer(a,zh.members),this._tileDebugSegments=Ui.simpleSegment(0,0,a.length,u.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||"mercator"===r.name)return;const s=Rc(Id,this.tileID.canonical,this.tileTransform)[0];let a,u;if(this.isRaster){const c=function(p,g){const y=xd(p,g),x=Math.pow(2,p.z);for(let O=0;O<33;O++)for(let R=0;R<33;R++){const B=pu((p.x+(R+Hu(R))/32)/x),j=ws((p.y+(O+Hu(O))/32)/x),V=g.project(B,j),U=33*O+R;Zs[2*U+0]=Math.round((V.x*y.scale-y.x)*$t),Zs[2*U+1]=Math.round((V.y*y.scale-y.y)*$t)}yu.fill(0),Ed.fill(0);for(let O=2045;O>=0;O--){const R=4*O,B=fc[R+0],j=fc[R+1],V=fc[R+2],U=fc[R+3],G=B+V>>1,Z=j+U>>1,Q=G+Z-j,et=Z+B-G,it=33*j+B,yt=33*U+V,xt=33*Z+G,Nt=Math.hypot((Zs[2*it+0]+Zs[2*yt+0])/2-Zs[2*xt+0],(Zs[2*it+1]+Zs[2*yt+1])/2-Zs[2*xt+1])>=16;yu[xt]=yu[xt]||(Nt?1:0),O<1022&&(yu[xt]=yu[xt]||yu[33*(j+et>>1)+(B+Q>>1)]||yu[33*(U+et>>1)+(V+Q>>1)])}const E=new $f,S=new ea;let M=0;function D(O,R){const B=33*R+O;return 0===Ed[B]&&(E.emplaceBack(Zs[2*B+0],Zs[2*B+1],O*$t/32,R*$t/32),Ed[B]=++M),Ed[B]-1}function P(O,R,B,j,V,U){const G=O+B>>1,Z=R+j>>1;if(Math.abs(O-V)+Math.abs(R-U)>1&&yu[33*Z+G])P(V,U,O,R,G,Z),P(B,j,V,U,G,Z);else{const Q=D(O,R),et=D(B,j),it=D(V,U);S.emplaceBack(Q,et,it)}}return P(0,0,32,32,32,0),P(32,32,0,0,0,32),{vertices:E,indices:S}}(this.tileID.canonical,r);a=c.vertices,u=c.indices}else{a=new $f,u=new ea;for(const{x:p,y:g}of s)a.emplaceBack(p,g,0,0);const c=dg(a.int16,void 0,4);for(let p=0;p<c.length;p+=3)u.emplaceBack(c[p],c[p+1],c[p+2])}this._tileBoundsBuffer=t.createVertexBuffer(a,Ly.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(u),this._tileBoundsSegments=Ui.simpleSegment(0,0,a.length,u.length)}_makeGlobeTileDebugBuffers(t,r){const s=r.projection;if(!s||"globe"!==s.name||r.freezeTileCoverage)return;const a=this.tileID.canonical,u=id(lE(a,r)),c=da(r.zoom);let p;c>0&&(p=ce.invert(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,a,r,u,p,c),this._makeGlobeTileDebugTextBuffer(t,a,r,u,p,c)}_globePoint(t,r,s,a,u,c,p){let g=Z_(t,r,s);if(c){const y=1<<s.z,x=zs(a.center.lng),E=ba(a.center.lat),S=(s.x+.5)/y-x;let M=0;S>.5?M=-1:S<-.5&&(M=1);let D=(t/$t+s.x)/y+M,P=(r/$t+s.y)/y;D=(D-x)*a._pixelsPerMercatorPixel+x,P=(P-E)*a._pixelsPerMercatorPixel+E;const O=[D*a.worldSize,P*a.worldSize,0];Ot.transformMat4(O,O,c),g=Bh(g,O,p)}return Ot.transformMat4(g,g,u)}_makeGlobeTileDebugBorderBuffer(t,r,s,a,u,c){const p=new hu,g=new I_,y=new __,x=(S,M,D,P,O)=>{const R=(D-S)/(O-1),B=(P-M)/(O-1),j=p.length;for(let V=0;V<O;V++){const U=S+V*R,G=M+V*B;p.emplaceBack(U,G);const Z=this._globePoint(U,G,r,s,a,u,c);y.emplaceBack(Z[0],Z[1],Z[2]),g.emplaceBack(j+V)}},E=$t;x(0,0,E,0,16),x(E,0,E,E,16),x(E,E,0,E,16),x(0,E,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(g),this._tileDebugBuffer=t.createVertexBuffer(p,zh.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(y,dp.members),this._tileDebugSegments=Ui.simpleSegment(0,0,p.length,g.length)}_makeGlobeTileDebugTextBuffer(t,r,s,a,u,c){const p=$t/4,g=new hu,y=new ea,x=new __,E=25;y.reserve(32),g.reserve(E),x.reserve(E);const S=(M,D)=>E*M+D;for(let M=0;M<E;M++){const D=M*p;for(let P=0;P<E;P++){const O=P*p;g.emplaceBack(O,D);const R=this._globePoint(O,D,r,s,a,u,c);x.emplaceBack(R[0],R[1],R[2])}}for(let M=0;M<4;M++)for(let D=0;D<4;D++){const P=S(M,D),O=S(M,D+1),R=S(M+1,D),B=S(M+1,D+1);y.emplaceBack(P,O,R),y.emplaceBack(R,O,B)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(y),this._tileDebugTextBuffer=t.createVertexBuffer(g,zh.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(x,dp.members),this._tileDebugTextSegments=Ui.simpleSegment(0,0,E,32)}destroy(t=!1){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof fs&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class jp{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,s){const a=t.wrapped().key;void 0===this.data[a]&&(this.data[a]=[]);const u={value:r,timeout:void 0};if(void 0!==s&&(u.timeout=setTimeout(()=>{this.remove(t,u)},s)),this.data[a].push(u),this.order.push(a),this.order.length>this.max){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const s=t.wrapped().key,a=void 0===r?0:this.data[s].indexOf(r),u=this.data[s][a];return this.data[s].splice(a,1),u.timeout&&clearTimeout(u.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(u.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const s in this.data)for(const a of this.data[s])t(a.value)||r.push(a);for(const s of r)this.remove(s.value.tileID,s)}}let Cd=(()=>{class e{constructor(r,s,a,u){this.id=e.uniqueIdxCounter,e.uniqueIdxCounter++,this.context=r;const c=r.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||u||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){this.id=e.uniqueIdxCounter,e.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return e.uniqueIdxCounter=0,e})();const Vp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Gp{constructor(t,r,s,a,u,c){this.length=r.length,this.attributes=s,this.itemSize=r.bytesPerElement,this.dynamicDraw=a,this.instanceCount=c,this.context=t;const p=t.gl;this.buffer=p.createBuffer(),t.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||u||r.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let s=0;s<this.attributes.length;s++){const a=r.attributes[this.attributes[s].name];void 0!==a&&t.enableVertexAttribArray(a)}}setVertexAttribPointers(t,r,s){for(let a=0;a<this.attributes.length;a++){const u=this.attributes[a],c=r.attributes[u.name];void 0!==c&&t.vertexAttribPointer(c,u.components,t[Vp[u.type]],!1,this.itemSize,u.offset+this.itemSize*(s||0))}}setVertexAttribDivisor(t,r,s){for(let a=0;a<this.attributes.length;a++){const u=r.attributes[this.attributes[a].name];void 0!==u&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(u,s)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ro{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qp extends ro{getDefault(){return pn.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class $p extends ro{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class yI extends ro{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class vI extends ro{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class xI extends ro{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class bI extends ro{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class wI extends ro{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class EI extends ro{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class II extends ro{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class CI extends ro{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class SI extends ro{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class w1 extends ro{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class OD extends ro{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class tO extends ro{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class eO extends ro{getDefault(){return pn.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class RD extends ro{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class ND extends ro{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class nO extends ro{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class FD extends ro{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let rO=class extends ro{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class kD extends ro{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class zD extends ro{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class BD extends ro{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class E1 extends ro{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Mg extends ro{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class I1 extends ro{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Oy extends ro{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class MI extends ro{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Tg extends ro{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class TI extends ro{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class UD extends ro{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Sd extends ro{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class jD extends Sd{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class DI extends Sd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,this.attachment(),r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class VD extends Sd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,this.attachment(),r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class GD extends DI{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class C1{constructor(t,r,s,a,u){this.context=t,this.width=r,this.height=s;const c=this.framebuffer=t.gl.createFramebuffer();a&&(this.colorAttachment=new jD(t,c)),u&&(this.depthAttachmentType=u,this.depthAttachment="renderbuffer"===u?new DI(t,c):new VD(t,c))}destroy(){const t=this.context.gl;if(this.colorAttachment){const r=this.colorAttachment.get();r&&t.deleteTexture(r)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r)}else{const r=this.depthAttachment.get();r&&t.deleteTexture(r)}t.deleteFramebuffer(this.framebuffer)}}class rr{constructor(t,r,s){this.func=t,this.mask=r,this.range=s}}rr.ReadOnly=!1,rr.ReadWrite=!0,rr.disabled=new rr(519,rr.ReadOnly,[0,1]);class jr{constructor(t,r,s,a,u,c){this.test=t,this.ref=r,this.mask=s,this.fail=a,this.depthFail=u,this.pass=c}}jr.disabled=new jr({func:519,mask:0},0,0,7680,7680,7680);class vi{constructor(t,r,s,a){this.blendFunction=t,this.blendColor=r,this.mask=s,this.blendEquation=a}}vi.Replace=[1,0,1,0],vi.disabled=new vi(vi.Replace,pn.transparent,[!1,!1,!1,!1]),vi.unblended=new vi(vi.Replace,pn.transparent,[!0,!0,!0,!0]),vi.alphaBlended=new vi([1,771,1,771],pn.transparent,[!0,!0,!0,!0]),vi.multiply=new vi([774,0,774,0],pn.transparent,[!0,!0,!0,!0]);class zr{constructor(t,r,s){this.enable=t,this.mode=r,this.frontFace=s}}zr.disabled=new zr(!1,1029,2305),zr.backCCW=new zr(!0,1029,2305),zr.backCW=new zr(!0,1029,2304),zr.frontCW=new zr(!0,1028,2304),zr.frontCCW=new zr(!0,1028,2305);class qD{constructor(t,r){this.gl=t,this.clearColor=new qp(this),this.clearDepth=new $p(this),this.clearStencil=new yI(this),this.colorMask=new vI(this),this.depthMask=new xI(this),this.stencilMask=new bI(this),this.stencilFunc=new wI(this),this.stencilOp=new EI(this),this.stencilTest=new II(this),this.depthRange=new CI(this),this.depthTest=new SI(this),this.depthFunc=new w1(this),this.blend=new OD(this),this.blendFunc=new tO(this),this.blendColor=new eO(this),this.blendEquation=new RD(this),this.cullFace=new ND(this),this.cullFaceSide=new nO(this),this.frontFace=new FD(this),this.program=new rO(this),this.activeTexture=new kD(this),this.viewport=new zD(this),this.bindFramebuffer=new BD(this),this.bindRenderbuffer=new E1(this),this.bindTexture=new Mg(this),this.bindVertexBuffer=new I1(this),this.bindElementBuffer=new Oy(this),this.bindVertexArrayOES=new MI(this),this.pixelStoreUnpack=new Tg(this),this.pixelStoreUnpackPremultiplyAlpha=new TI(this),this.pixelStoreUnpackFlipY=new UD(this),this.options=r?{...r}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r,s){return new Cd(this,t,r,s)}createVertexBuffer(t,r,s,a,u){return new Gp(this,t,r,s,a,u)}createRenderbuffer(t,r,s){const a=this.gl,u=a.createRenderbuffer();return this.bindRenderbuffer.set(u),a.renderbufferStorage(a.RENDERBUFFER,t,r,s),this.bindRenderbuffer.set(null),u}createFramebuffer(t,r,s,a){return new C1(this,t,r,s,a)}clear({color:t,depth:r,stencil:s,colorMask:a}){const u=this.gl;let c=0;t&&(c|=u.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(a||[!0,!0,!0,!0])),void 0!==r&&(c|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),void 0!==s&&(c|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(s),this.stencilMask.set(255)),u.clear(c)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){ht(t.blendFunction,vi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Fc extends Qn{constructor(t,r,s){super(),this.id=t,this._onlySymbols=s,r.on("data",a=>{"source"===a.dataType&&"metadata"===a.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===a.dataType&&"content"===a.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new jp(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new uD,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const r=this._tiles[t];if("errored"!==r.state&&("loaded"!==r.state||!r.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,r){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const s=this._tiles[r];s.upload(t),s.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Pe(this._tiles).map(t=>t.tileID).sort(AI).map(t=>t.key)}getRenderableIds(t,r){const s=[];for(const a in this._tiles)this._isIdRenderable(+a,t,r)&&s.push(this._tiles[a]);return t?s.sort((a,u)=>{const c=a.tileID,p=u.tileID,g=new H(c.canonical.x,c.canonical.y)._rotate(this.transform.angle),y=new H(p.canonical.x,p.canonical.y)._rotate(this.transform.angle);return c.overscaledZ-p.overscaledZ||y.y-g.y||y.x-g.x}).map(a=>a.tileID.key):s.map(a=>a.tileID).sort(AI).map(a=>a.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())&&(s||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,r){const s=this._tiles[t];s&&("loading"!==s.state&&(s.state=r),this._loadTile(s,this._tileLoaded.bind(this,s,t,r)))}_tileLoaded(t,r,s,a){if(a)if(t.state="errored",404!==a.status)this._source.fire(new Oe(a,{tile:t}));else{if(!(t.tileID.key in this._loadedParentTiles))return void this._source.fire(new Se("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=or.now(),"expired"===s&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Se("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const r=this.getRenderableIds();for(let a=0;a<r.length;a++){const u=r[a];if(t.neighboringTiles&&t.neighboringTiles[u]){const c=this.getTileByID(u);s(t,c),s(c,t)}}function s(a,u){if(!a.dem||a.dem.borderReady)return;a.needsHillshadePrepare=!0,a.needsDEMTextureUpload=!0;let c=u.tileID.canonical.x-a.tileID.canonical.x;const p=u.tileID.canonical.y-a.tileID.canonical.y,g=Math.pow(2,a.tileID.canonical.z),y=u.tileID.key;0===c&&0===p||Math.abs(p)>1||(Math.abs(c)>1&&(1===Math.abs(c+g)?c+=g:1===Math.abs(c-g)&&(c-=g)),u.dem&&a.dem&&(a.dem.backfillBorder(u.dem,c,p),a.neighboringTiles&&a.neighboringTiles[y]&&(a.neighboringTiles[y].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,s,a){for(const u in this._tiles){let c=this._tiles[u];if(a[u]||!c.hasData()||c.tileID.overscaledZ<=r||c.tileID.overscaledZ>s)continue;let p=c.tileID;for(;c&&c.tileID.overscaledZ>r+1;){const y=c.tileID.scaledTo(c.tileID.overscaledZ-1);c=this._tiles[y.key],c&&c.hasData()&&(p=y)}let g=p;for(;g.overscaledZ>r;)if(g=g.scaledTo(g.overscaledZ-1),t[g.key]){a[p.key]=p;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const s=this._loadedParentTiles[t.key];return s&&s.tileID.overscaledZ>=r?s:null}for(let s=t.overscaledZ-1;s>=r;s--){const a=t.scaledTo(s),u=this._getLoadedTile(a);if(u)return u}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,r){r=r||this._source.tileSize;const s=Math.ceil(t.width/r)+1,a=Math.ceil(t.height/r)+1,u=Math.floor(s*a*5),c="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,u):u,p="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(p)}handleWrapJump(t){const r=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,r){const s={};for(const a in this._tiles){const u=this._tiles[a];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+r),s[u.tileID.key]=u}this._tiles=s;for(const a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(const a in this._tiles)this._setTileReloadTimer(+a,this._tiles[a])}}update(t,r,s,a){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let u;if(this.updateCacheSize(t,r),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(g=>new si(g.canonical.z,g.wrap,g.canonical.z,g.canonical.x,g.canonical.y)):(u=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(g=>this._source.hasTile(g)))):u=[],u.length>0&&this.castsShadows&&a&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Ny(this._source.type)){const g=t.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!s}),y=Math.min(g,this._source.maxzoom),x=t.extendTileCoverForShadows(u,a,y);for(const E of x)this._shadowCasterTiles[E.key]=!0,u.push(E)}const c=this._updateRetainedTiles(u);if(Ny(this._source.type)&&0!==u.length){const g={},y={},x=Object.keys(c);for(const S of x){const M=c[S],D=this._tiles[S];if(!D||D.fadeEndTime&&D.fadeEndTime<=or.now())continue;const P=this.findLoadedParent(M,Math.max(M.overscaledZ-Fc.maxOverzooming,this._source.minzoom));P&&(this._addTile(P.tileID),g[P.tileID.key]=P.tileID),y[S]=M}const E=u[u.length-1].overscaledZ;for(const S in this._tiles){const M=this._tiles[S];if(c[S]||!M.hasData())continue;let D=M.tileID;for(;D.overscaledZ>E;){D=D.scaledTo(D.overscaledZ-1);const P=this._tiles[D.key];if(P&&P.hasData()&&y[D.key]){c[S]=M.tileID;break}}}for(const S in g)c[S]||(this._coveredTiles[S]=!0,c[S]=g[S])}for(const g in c)this._tiles[g].clearFadeHold();const p=function(g,y){const x=[];for(const E in g)E in y||x.push(E);return x}(this._tiles,c);for(const g of p){const y=this._tiles[g];y.hasSymbolBuckets&&!y.holdingForFade()?y.setHoldDuration(this.map._fadeDuration):y.hasSymbolBuckets&&!y.symbolFadeFinished()||this._removeTile(+g)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const r={};if(0===t.length)return r;const s={},a=t.reduce((y,x)=>Math.min(y,x.overscaledZ),1/0),u=t[0].overscaledZ,c=Math.max(u-Fc.maxOverzooming,this._source.minzoom),p=Math.max(u+Fc.maxUnderzooming,this._source.minzoom),g={};for(const y of t){const x=this._addTile(y);r[y.key]=y,x.hasData()||a<this._source.maxzoom&&(g[y.key]=y)}this._retainLoadedChildren(g,a,p,r);for(const y of t){let x=this._tiles[y.key];if(x.hasData())continue;if(y.canonical.z>=this._source.maxzoom){const S=y.children(this._source.maxzoom)[0],M=this.getTile(S);if(M&&M.hasData()){r[S.key]=S;continue}}else{const S=y.children(this._source.maxzoom);if(r[S[0].key]&&r[S[1].key]&&r[S[2].key]&&r[S[3].key])continue}let E=x.wasRequested();for(let S=y.overscaledZ-1;S>=c;--S){const M=y.scaledTo(S);if(s[M.key]||(s[M.key]=!0,x=this.getTile(M),!x&&E&&(x=this._addTile(M)),x&&(r[M.key]=M,E=x.wasRequested(),x.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let s,a=this._tiles[t].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){s=this._loadedParentTiles[a.key];break}r.push(a.key);const u=a.scaledTo(a.overscaledZ-1);if(s=this._getLoadedTile(u),s)break;a=u}for(const u of r)this._loadedParentTiles[u]=s}}_addTile(t){let r=this._tiles[t.key];if(r)return!0!==r.isExtraShadowCaster||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const s=!!r;if(!s){const a=this.map?this.map.painter:null;r=new fh(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,a,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r?(r.uses++,this._tiles[t.key]=r,s||this._source.fire(new Se("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const s=r.getExpiryTimeout();s&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},s))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&"reloading"!==r.state?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,s){const a=[],u=this.transform;if(!u)return a;const c="globe"===u.projection.name,p=zs(u.center.lng);for(const g in this._tiles){const y=this._tiles[g];if(s&&y.clearQueryDebugViz(),y.holdingForFade())continue;let x;if(c){const E=y.tileID.canonical;if(0===E.z){const S=[Math.abs(At(p,...Zp(E,-1))-p),Math.abs(At(p,...Zp(E,1))-p)];x=[0,2*S.indexOf(Math.min(...S))-1]}else{const S=[Math.abs(At(p,...Zp(E,-1))-p),Math.abs(At(p,...Zp(E,0))-p),Math.abs(At(p,...Zp(E,1))-p)];x=[S.indexOf(Math.min(...S))-1]}}else x=[0];for(const E of x){const S=t.containsTile(y,u,r,E);S&&a.push(S)}}return a}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,r){const s=this.getRenderableIds(t,r).map(u=>this._tiles[u].tileID),a="globe"===this.transform.projection.name;for(const u of s)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped()),u.expandedProjMatrix=a?this.transform.calculateProjMatrix(u.toUnwrapped(),!1,!0):u.projMatrix;return s}sortCoordinatesByDistance(t){const r=t.slice(),s=this.transform._camera.position,a=this.transform._camera.forward(),u={};for(const c of r){const p=1/(1<<c.canonical.z);u[c.key]=((c.canonical.x+.5)*p+c.wrap-s[0])*a[0]+((c.canonical.y+.5)*p-s[1])*a[1]-s[2]*a[2]}return r.sort((c,p)=>u[c.key]-u[p.key]),r}hasTransition(){if(this._source.hasTransition())return!0;if(Ny(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=or.now())return!0}return!1}setFeatureState(t,r,s){this._state.updateState(t=t||"_geojsonTileLayer",r,s)}removeFeatureState(t,r,s){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,s)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,s){const a=this._tiles[t];a&&a.setDependencies(r,s)}reloadTilesForDependencies(t,r){for(const s in this._tiles)this._tiles[s].hasDependency(t,r)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(t,r))}_preloadTiles(t,r){if(!this._sourceLoaded){const p=()=>{this._sourceLoaded&&(this._source.off("data",p),this._preloadTiles(t,r))};return void this._source.on("data",p)}const s=new Map,a=Array.isArray(t)?t:[t],u=this.map.painter.terrain,c=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(const p of a){const g=p.coveringTiles({tileSize:c,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const y of g)s.set(y.key,y);this.usedForTerrain&&p.updateElevation(!1)}Le(Array.from(s.values()),(p,g)=>{const y=new fh(p,this._source.tileSize*p.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(y,x=>{"raster-dem"===this._source.type&&y.dem&&this._backfillDEM(y),g(x,y)})},r)}}function AI(e,t){const r=Math.abs(2*e.wrap)-+(e.wrap<0),s=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||s-r||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Ny(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function Zp(e,t){const r=1<<e.z;return[e.x/r+t,(e.x+1)/r+t]}Fc.maxOverzooming=10,Fc.maxUnderzooming=3;const $D=yr([{name:"a_pos_3f",components:3,type:"Float32"}]),HD=yr([{name:"a_color_3f",components:3,type:"Float32"}]),ZD=yr([{name:"a_color_4f",components:4,type:"Float32"}]),WD=yr([{name:"a_uv_2f",components:2,type:"Float32"}]),PI=yr([{name:"a_normal_3f",components:3,type:"Float32"}]),M1=yr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),XD=yr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class Md{constructor(t=0,r=0,s=0,a=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(s)||s<0||isNaN(a)||a<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=s,this.right=a}interpolate(t,r,s){return null!=r.top&&null!=t.top&&(this.top=An(t.top,r.top,s)),null!=r.bottom&&null!=t.bottom&&(this.bottom=An(t.bottom,r.bottom,s)),null!=r.left&&null!=t.left&&(this.left=An(t.left,r.left,s)),null!=r.right&&null!=t.right&&(this.right=An(t.right,r.right,s)),this}getCenter(t,r){const s=At((this.left+t-this.right)/2,0,t),a=At((this.top+r-this.bottom)/2,0,r);return new H(s,a)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Md(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Td(e,t){const r=Ni(e,3);ce.fromQuat(e,t),Zi(e,3,r)}function Dd(e,t){const r=Ha.identity([]);return Ha.rotateZ(r,r,-t),Ha.rotateX(r,r,-e),r}function T1(e,t){const r=[e[0],e[1],0],s=[t[0],t[1],0];if(Ot.length(r)>=1e-15){const c=Ot.normalize([],r);Ot.scale(s,c,Ot.dot(s,c)),t[0]=s[0],t[1]=s[1]}const a=Ot.cross([],t,e);if(Ot.len(a)<1e-15)return null;const u=Math.atan2(-a[1],a[0]);return Dd(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),u)}class LI{constructor(t,r){this.position=t,this.orientation=r}get position(){return this._position}set position(t){if(t){const r=t instanceof ri?t:new ri(t[0],t[1],t[2]);this._renderWorldCopies&&(r.x=wt(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(t,r){if(this.orientation=null,!this.position)return;const s=this.position,a=this._elevation?this._elevation.getAtPointOrZero(ri.fromLngLat(t)):0,u=ri.fromLngLat(t,a),c=[u.x-s.x,u.y-s.y,u.z-s.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=T1(c,r)}setPitchBearing(t,r){this.orientation=Dd(St(t),St(-r))}}class Fy{constructor(t,r){this._transform=ce.identity([]),this.orientation=r,this.position=t}get mercatorPosition(){const t=this.position;return new ri(t[0],t[1],t[2])}get position(){const t=Ni(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var r;t&&Zi(this._transform,3,[(r=t)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||Ha.identity([]),t&&Td(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),r=this.right();return{bearing:Math.atan2(-r[1],r[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,r){this._orientation=Dd(t,r),Td(this._transform,this._orientation)}forward(){const t=Ni(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=Ni(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=Ni(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,r){const s=new Float64Array(16);return ce.invert(s,this.getWorldToCamera(t,r)),s}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,r,s){const a=this.position;Ot.scale(a,a,-t);const u=new Float64Array(16);return ce.fromScaling(u,[s,s,s]),ce.translate(u,u,a),u[10]*=r,u}getWorldToCamera(t,r){const s=new Float64Array(16),a=new Float64Array(4),u=this.position;return Ha.conjugate(a,this._orientation),Ot.scale(u,u,-t),ce.fromQuat(s,a),ce.translate(s,s,u),s[1]*=-1,s[5]*=-1,s[9]*=-1,s[13]*=-1,s[8]*=r,s[9]*=r,s[10]*=r,s[11]*=r,s}getCameraToClipPerspective(t,r,s,a){const u=new Float64Array(16);return ce.perspective(u,t,r,s,a),u}getCameraToClipOrthographic(t,r,s,a,u,c){const p=new Float64Array(16);return ce.ortho(p,t,r,s,a,u,c),p}getDistanceToElevation(t,r=!1){const s=0===t?0:ji(t,r?ws(this.position[1]):this.position[1]),a=this.forward();return(s-this.position[2])/a[2]}clone(){return new Fy([...this.position],[...this.orientation])}}function OI(e,t){const r=Ad(e.projection,e.zoom,e.width,e.height),s=function(u,c,p,g,y){const x=new pr(p.lng-180*Gh,p.lat),E=new pr(p.lng+180*Gh,p.lat),S=u.project(x.lng,x.lat),M=u.project(E.lng,E.lat),D=-Math.atan2(M.y-S.y,M.x-S.x),P=ri.fromLngLat(p);P.y=At(P.y,-1+Gh,1-Gh);const O=P.toLngLat(),R=u.project(O.lng,O.lat),B=ri.fromLngLat(O);B.x+=Gh;const j=B.toLngLat(),V=u.project(j.lng,j.lat),U=RI(V.x-R.x,V.y-R.y,D),G=ri.fromLngLat(O);G.y+=Gh;const Z=G.toLngLat(),Q=u.project(Z.lng,Z.lat),et=RI(Q.x-R.x,Q.y-R.y,D),it=Math.abs(U.x)/Math.abs(et.y),yt=ce.identity([]);ce.rotateZ(yt,yt,-D*(1-(y?0:g)));const xt=ce.identity([]);return ce.scale(xt,xt,[1,1-(1-it)*g,1]),xt[4]=-et.x/et.y*g,ce.rotateZ(xt,xt,D),ce.multiply(xt,yt,xt),xt}(e.projection,0,e.center,r,t),a=ky(e);return ce.scale(s,s,[a,a,1]),s}function ky(e){const t=e.projection,r=Ad(e.projection,e.zoom,e.width,e.height),s=D1(t,e.center),a=D1(t,pr.convert(t.center));return Math.pow(2,s*r+(1-r)*a)}function Ad(e,t,r,s,a=1/0){const u=e.range;if(!u)return 0;const c=Math.min(a,Math.max(r,s)),p=Math.log(c/1024)/Math.LN2;return ne(u[0]+p,u[1]+p,t)}const Gh=1/4e4;function D1(e,t){const r=At(t.lat,-Ls,Ls),s=new pr(t.lng-180*Gh,r),a=new pr(t.lng+180*Gh,r),u=e.project(s.lng,r),c=e.project(a.lng,r),p=ri.fromLngLat(s),g=ri.fromLngLat(a),y=c.x-u.x,x=c.y-u.y,E=g.x-p.x,S=g.y-p.y,M=Math.sqrt((E*E+S*S)/(y*y+x*x));return Math.log(M)/Math.LN2}function RI(e,t,r){const s=Math.cos(r),a=Math.sin(r);return{x:e*s-t*a,y:e*a+t*s}}function Pd(e,t,r){return t*($t/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}const Wp={unknown:0,flipRequired:1,flipNotRequired:2},A1=Math.tan(85*Math.PI/180);function Ag(e,t,r,s,a,u,c){const p=ce.create();if(r)if("globe"===u.name){const g=function(y,x){const{x:E,y:S}=y.point,M=hE(E,S,y.worldSize/y._pixelsPerMercatorPixel,0,0);return ce.multiply(M,M,W_(Gu(x)))}(a,t);ce.multiply(p,p,g)}else{const g=fp.invert([],c);p[0]=g[0],p[1]=g[1],p[4]=g[2],p[5]=g[3],s||ce.rotateZ(p,p,a.angle)}else ce.multiply(p,a.labelPlaneMatrix,e);return p}function P1(e,t,r,s,a,u,c){const p=Ag(e,t,r,s,a,u,c);return"globe"===u.name&&r||(p[2]=p[6]=p[10]=p[14]=0),p}function L1(e,t,r,s,a,u,c){if(r){if("globe"===u.name){const p=Ag(e,t,r,s,a,u,c);return ce.invert(p,p),ce.multiply(p,e,p),p}{const p=ce.clone(e),g=ce.identity([]);return g[0]=c[0],g[1]=c[1],g[4]=c[2],g[5]=c[3],ce.multiply(p,p,g),s||ce.rotateZ(p,p,-a.angle),p}}return a.glCoordMatrix}function kc(e,t,r,s){const a=[e,t,r,1];r?Oi.transformMat4(a,a,s):N1(a,a,s);const u=a[3];return a[0]/=u,a[1]/=u,a[2]/=u,a}function O1(e,t){return Math.min(.5+e/t*.5,1.5)}function NI(e,t){const r=e[0]/e[3],s=e[1]/e[3];return r>=-t[0]&&r<=t[0]&&s>=-t[1]&&s<=t[1]}function FI(e,t,r,s,a,u,c,p,g,y){const x=r.transform,E=s?e.textSizeData:e.iconSizeData,S=lh(E,r.transform.zoom),M="globe"===x.projection.name,D=[256/r.width*2+1,256/r.height*2+1],P=s?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;P.clear();let O=null;M&&(O=s?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);const R=e.lineVertexArray,B=s?e.text.placedSymbolArray:e.icon.placedSymbolArray,j=r.transform.width/r.transform.height;let V,U=!1;for(let G=0;G<B.length;G++){const Z=B.get(G),{numGlyphs:Q,writingMode:et}=Z;if(et!==Zo.vertical||U||V===Zo.horizontal||(U=!0),V=et,(Z.hidden||et===Zo.vertical)&&!U){Ld(Q,P);continue}U=!1;const it=new H(Z.tileAnchorX,Z.tileAnchorY);let{x:yt,y:xt,z:Nt}=x.projection.projectTilePoint(it.x,it.y,y.canonical);if(g){const[Re,ze,$e]=g(it);yt+=Re,xt+=ze,Nt+=$e}const ft=[yt,xt,Nt,1];if(Oi.transformMat4(ft,ft,t),!NI(ft,D)){Ld(Q,P);continue}const Ut=ft[3],Wt=O1(r.transform.getCameraToCenterDistance(x.projection),Ut),le=Cp(E,S,Z),Bt=c?le/Wt:le*Wt,Zt=kc(yt,xt,Nt,a);if(Zt[3]<=0){Ld(Q,P);continue}let ge={};const be=c?null:g,xe=BI(Z,Bt,!1,p,t,a,u,e.glyphOffsetArray,R,P,O,Zt,it,ge,j,be,x.projection,y,c);U=xe.useVertical,be&&xe.needsFlipping&&(ge={}),(xe.notEnoughRoom||U||xe.needsFlipping&&BI(Z,Bt,!0,p,t,a,u,e.glyphOffsetArray,R,P,O,Zt,it,ge,j,be,x.projection,y,c).notEnoughRoom)&&Ld(Q,P)}s?(e.text.dynamicLayoutVertexBuffer.updateData(P),O&&e.text.globeExtVertexBuffer&&e.text.globeExtVertexBuffer.updateData(O)):(e.icon.dynamicLayoutVertexBuffer.updateData(P),O&&e.icon.globeExtVertexBuffer&&e.icon.globeExtVertexBuffer.updateData(O))}function kI(e,t,r,s,a,u,c,p,g,y,x,E,S,M,D,P){const{lineStartIndex:O,glyphStartIndex:R,segment:B}=p,j=R+p.numGlyphs,V=O+p.lineLength,U=t.getoffsetX(R),G=t.getoffsetX(j-1),Z=Xp(e*U,r,s,a,u,c,B,O,V,g,y,x,E,S,!0,M,D,P);if(!Z)return null;const Q=Xp(e*G,r,s,a,u,c,B,O,V,g,y,x,E,S,!0,M,D,P);return Q?{first:Z,last:Q}:null}function zI(e,t,r,s){return e===Zo.horizontal&&Math.abs(s)>Math.abs(r)?{useVertical:!0}:e===Zo.vertical?s>0?{needsFlipping:!0}:null:t!==Wp.unknown&&(0===(a=r)||Math.abs(s/a)>A1)?t===Wp.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null;var a}function BI(e,t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O,R,B){const j=t/24,V=e.lineOffsetX*j,U=e.lineOffsetY*j,{lineStartIndex:G,glyphStartIndex:Z,numGlyphs:Q,segment:et,writingMode:it,flipState:yt}=e,xt=G+e.lineLength,Nt=ft=>{if(x){const[Bt,Zt,ge]=ft.up,be=y.length;Dy(x,be+0,Bt,Zt,ge),Dy(x,be+1,Bt,Zt,ge),Dy(x,be+2,Bt,Zt,ge),Dy(x,be+3,Bt,Zt,ge)}const[Ut,Wt,le]=ft.point;zp(y,Ut,Wt,le,ft.angle)};if(Q>1){const ft=kI(j,p,V,U,r,E,S,e,g,u,M,P,!1,O,R,B);if(!ft)return{notEnoughRoom:!0};if(s&&!r){let[Ut,Wt,le]=ft.first.point,[Bt,Zt,ge]=ft.last.point;[Ut,Wt]=kc(Ut,Wt,le,c),[Bt,Zt]=kc(Bt,Zt,ge,c);const be=zI(it,yt,(Bt-Ut)*D,Zt-Wt);if(e.flipState=be&&be.needsFlipping?Wp.flipRequired:Wp.flipNotRequired,be)return be}Nt(ft.first);for(let Ut=Z+1;Ut<Z+Q-1;Ut++){const Wt=Xp(j*p.getoffsetX(Ut),V,U,r,E,S,et,G,xt,g,u,M,P,!1,!1,O,R,B);if(!Wt)return y.length-=4*(Ut-Z),{notEnoughRoom:!0};Nt(Wt)}Nt(ft.last)}else{if(s&&!r){const Ut=kc(S.x,S.y,0,a),Wt=G+et+1,le=new H(g.getx(Wt),g.gety(Wt)),Bt=kc(le.x,le.y,0,a),Zt=Bt[3]>0?Bt:R1(S,le,Ut,1,a,void 0,O,R.canonical),ge=zI(it,yt,(Zt[0]-Ut[0])*D,Zt[1]-Ut[1]);if(e.flipState=ge&&ge.needsFlipping?Wp.flipRequired:Wp.flipNotRequired,ge)return ge}const ft=Xp(j*p.getoffsetX(Z),V,U,r,E,S,et,G,xt,g,u,M,P,!1,!1,O,R,B);if(!ft)return{notEnoughRoom:!0};Nt(ft)}return{}}function UI(e,t,r,s,a){const{x:u,y:c,z:p}=s.projectTilePoint(e.x,e.y,t);if(!a)return kc(u,c,p,r);const[g,y,x]=a(e);return kc(u+g,c+y,p+x,r)}function R1(e,t,r,s,a,u,c,p){const g=UI(e.sub(t)._unit()._add(e),p,a,c,u);return Ot.sub(g,r,g),Ot.normalize(g,g),Ot.scaleAndAdd(g,r,g,s)}function Xp(e,t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O,R){const B=s?e-t:e+t;let j=B>0?1:-1,V=0;s&&(j*=-1,V=Math.PI),j<0&&(V+=Math.PI);let U=p+c+(j>0?0:1)|0,G=a,Z=a,Q=0,et=0;const it=Math.abs(B),yt=[],xt=[];let Nt=u,ft=Nt;const Ut=()=>R1(ft,Nt,Z,it-Q+1,x,S,P,O.canonical);for(;Q+et<=it;){if(U+=j,U<p||U>=g)return null;if(Z=G,ft=Nt,yt.push(Z),M&&xt.push(ft),Nt=new H(y.getx(U),y.gety(U)),G=E[U],!G){const ze=UI(Nt,O.canonical,x,P,S);G=ze[3]>0?E[U]=ze:Ut()}Q+=et,et=Ot.distance(Z,G)}D&&S&&(E[U]&&(G=Ut(),et=Ot.distance(Z,G)),E[U]=G);const Wt=(it-Q)/et,le=Nt.sub(ft)._mult(Wt)._add(ft),Bt=Ot.sub([],G,Z),Zt=Ot.scaleAndAdd([],Z,Bt,Wt);let ge=[0,0,1],be=Bt[0],xe=Bt[1];if(R&&(ge=P.upVector(O.canonical,le.x,le.y),0!==ge[0]||0!==ge[1]||1!==ge[2])){const ze=[ge[2],0,-ge[0]],$e=Ot.cross([],ge,ze);Ot.normalize(ze,ze),Ot.normalize($e,$e),be=Ot.dot(Bt,ze),xe=Ot.dot(Bt,$e)}if(r){const ze=Ot.cross([],ge,Bt);Ot.normalize(ze,ze),Ot.scaleAndAdd(Zt,Zt,ze,r*j)}const Re=V+Math.atan2(xe,be);return yt.push(Zt),M&&xt.push(le),{point:Zt,angle:Re,path:yt,tilePath:xt,up:ge}}function Ld(e,t){const r=t.length,s=r+4*e;t.resize(s),t.float32.fill(-1/0,4*r,4*s)}function N1(e,t,r){const s=t[0],a=t[1];return e[0]=r[0]*s+r[4]*a+r[12],e[1]=r[1]*s+r[5]*a+r[13],e[3]=r[3]*s+r[7]*a+r[15],e}const F1=(e,t,r)=>(1-r)*e+r*t,k1=e=>e*e*e*e*e;class zy{constructor(t,r,s,a,u,c,p){this.tileSize=512,this._renderWorldCopies=void 0===u||u,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=s??0,this._maxPitch=a??60,this.setProjection(c),this.setMaxBounds(p),this.width=0,this.height=0,this._center=new pr(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Md,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Fy,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new zy(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(t,r=!1){const s=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||s)&&this._updateCameraOnTerrain(),(t||s)&&this._constrainCamera(r),this._calcMatrices()}getProjection(){return Fe(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=Sy(this.projectionOptions);const s=!ht(r,this.getProjection());return s&&this._calcMatrices(),this.mercatorFromTransition=!1,s}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=Sy({name:"mercator"});const r=t!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return ji(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new H(this.width,this.height)}get bearing(){return wt(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const r=-t*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=fp.create(),fp.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=At(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=St(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._setZoom(r),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,r=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!r||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const s=this._elevation;r||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&s.exaggeration()&&this._centerAltitudeValidForExaggeration!==s.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*s.exaggeration(),this._centerAltitudeValidForExaggeration=s.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=s.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],s=this.horizonLineFromTop();let a=0,u=0;for(let c=0;c<r.length;c++){const p=new H(r[c][0]*this.width,s+r[c][1]*(this.height-s)),g=t.pointCoordinate(p);if(!g)continue;const y=1/Math.hypot(g[0]-this._camera.position[0],g[1]-this._camera.position[1]);a+=g[3]*y,u+=y}return 0===u?NaN:a/u}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const t=this._seaLevelZoom,r=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),s=this.pixelsPerMeter/this.worldSize*r,a=this._mercatorZfromZoom(t),u=this._mercatorZfromZoom(this._maxZoom),c=Math.max(a-s,u);this._setZoom(this._zoomFromMercatorZ(c))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let s;s=t.z<this._camera.position[2]?[r.x,r.y,r.z]:[t.x,t.y,t.z];const a=Ot.length(Ot.sub([],this._camera.position,s));return At(this._zoomFromMercatorZ(a),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let r=!1;if(t.orientation&&!Ha.exactEquals(t.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(t.orientation)),t.position){const s=[t.position.x,t.position.y,t.position.z];Ot.exactEquals(s,this._camera.position)||(this._setCameraPosition(s),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,r=new LI;return r.position=new ri(t[0],t[1],t[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(t){if(!Ha.length(t))return!1;Ha.normalize(t,t);const r=Ot.transformQuat([],[0,0,-1],t),s=Ot.transformQuat([],[0,-1,0],t);if(s[2]<0)return!1;const a=T1(r,s);return!!a&&(this._camera.orientation=a,!0)}_setCameraPosition(t){const r=this.zoomScale(this.minZoom)*this.tileSize,s=this.zoomScale(this.maxZoom)*this.tileSize,a=this.cameraToCenterDistance;t[2]=At(t[2],a/s,a/r),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,s){this._unmodified=!1,this._edgeInsets.interpolate(t,r,s),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new Km(0,t)];if(this.renderWorldCopies){const s=this.pointCoordinate(new H(0,0)),a=this.pointCoordinate(new H(this.width,0)),u=this.pointCoordinate(new H(this.width,this.height)),c=this.pointCoordinate(new H(0,this.height)),p=Math.floor(Math.min(s.x,a.x,u.x,c.x)),g=Math.floor(Math.max(s.x,a.x,u.x,c.x)),y=1;for(let x=p-y;x<=g+y;x++)0!==x&&r.push(new Km(x,t))}return r}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(t,r,s){let a=[];if(0===r[0]&&0===r[1])return a;for(const c of t){const p=c.canonical,g=c.overscaledZ,y=c.wrap,x=1<<p.z,E=p.x+1<x,S=p.x>0,M=p.y+1<x,D=p.y>0,P=c.wrap-(S?0:1),O=c.wrap+(E?0:1),R=S?p.x-1:x-1,B=E?p.x+1:0;r[0]<0?(a.push(new si(g,O,p.z,B,p.y)),r[1]<0&&M&&(a.push(new si(g,y,p.z,p.x,p.y+1)),a.push(new si(g,O,p.z,B,p.y+1))),r[1]>0&&D&&(a.push(new si(g,y,p.z,p.x,p.y-1)),a.push(new si(g,O,p.z,B,p.y-1)))):r[0]>0?(a.push(new si(g,P,p.z,R,p.y)),r[1]<0&&M&&(a.push(new si(g,y,p.z,p.x,p.y+1)),a.push(new si(g,P,p.z,R,p.y+1))),r[1]>0&&D&&(a.push(new si(g,y,p.z,p.x,p.y-1)),a.push(new si(g,P,p.z,R,p.y-1)))):r[1]<0&&M?a.push(new si(g,y,p.z,p.x,p.y+1)):D&&a.push(new si(g,y,p.z,p.x,p.y-1))}if(a.length>1){a.sort((g,y)=>g.overscaledZ-y.overscaledZ||g.wrap-y.wrap||g.canonical.z-y.canonical.z||g.canonical.x-y.canonical.x||g.canonical.y-y.canonical.y);let c=0,p=0;for(;p<a.length;)a[p].equals(a[c])?++p:a[++c]=a[p++];a.length=c+1}const u=[];for(const c of a)a.some(p=>c.isChildOf(p))||u.push(c);return a=u.filter(c=>!t.some(p=>!!(c.overscaledZ<s&&p.isChildOf(c))||c.equals(p)||c.isChildOf(p))),a}coveringTiles(t){let r=this.coveringZoomLevel(t);const s=r,a=this.elevation&&this.elevation.exaggeration(),u=a&&!t.isTerrainDEM,c="mercator"===this.projection.name;if(void 0!==t.minzoom&&r<t.minzoom)return[];void 0!==t.maxzoom&&r>t.maxzoom&&(r=t.maxzoom);const p=this.locationCoordinate(this.center),g=this.center.lat,y=1<<r,x=[y*p.x,y*p.y,0],E="globe"===this.projection.name,S=!E,M=Lc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,S),D=E?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),P=y*ji(1,this.center.lat),O=this._camera.position[2]/ji(1,this.center.lat),R=[y*D.x,y*D.y,O*(S?1:P)],B=E||a,j=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),V=this.isLODDisabled(!0)?r:0;let U;if(this._elevation&&t.isTerrainDEM)U=1e4*this._elevation.exaggeration();else if(this._elevation){const Bt=this._elevation.getMinMaxForVisibleTiles();U=Bt?Bt.max:this._centerAltitude}else U=this._centerAltitude;const G=t.isTerrainDEM?-U:this._elevation?this._elevation.getMinElevationBelowMSL():0,Z=this.projection.isReprojectedInTileSpace?ky(this):1,Q=Bt=>{const ge=new ri(Bt.x+25e-6,Bt.y,Bt.z),be=new ri(Bt.x,Bt.y+25e-6,Bt.z),xe=Bt.toLngLat(),Re=ge.toLngLat(),ze=be.toLngLat(),$e=this.locationCoordinate(xe),Ie=this.locationCoordinate(Re),on=this.locationCoordinate(ze),vn=Math.hypot(Ie.x-$e.x,Ie.y-$e.y),xn=Math.hypot(on.x-$e.x,on.y-$e.y);return Math.sqrt(vn*xn)*Z/25e-6},et=Bt=>{const Zt=U,ge=G;return{aabb:yg(this,y,0,0,0,Bt,ge,Zt,this.projection),zoom:0,x:0,y:0,minZ:ge,maxZ:Zt,wrap:Bt,fullyVisible:!1}},it=[];let yt=[];const xt=r,Nt=t.reparseOverscaled?s:r,ft=Bt=>Bt*Bt,Ut=ft((O-this._centerAltitude)*P),Wt=Bt=>{if(!this._elevation||!Bt.tileID||!c)return;const Zt=this._elevation.getMinMaxForTile(Bt.tileID),ge=Bt.aabb;Zt?(ge.min[2]=Zt.min,ge.max[2]=Zt.max,ge.center[2]=(ge.min[2]+ge.max[2])/2):(Bt.shouldSplit=le(Bt),Bt.shouldSplit||(ge.min[2]=ge.max[2]=ge.center[2]=this._centerAltitude))},le=Bt=>{if(Bt.zoom<V)return!0;if(Bt.zoom===xt)return!1;if(null!=Bt.shouldSplit)return Bt.shouldSplit;const Zt=Bt.aabb.distanceX(R),ge=Bt.aabb.distanceY(R);let be=Ut,xe=1;if(E){be=ft(Bt.aabb.distanceZ(R));const $e=Math.pow(2,Bt.zoom),Ie=ws((Bt.y+1)/$e),on=ws(Bt.y/$e),vn=Math.min(Math.max(g,Ie),on),xn=og(vn)/og(g);if(xe=vn===g?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,xn/this._mercatorScaleRatio),this.zoom<=ng&&Bt.zoom===xt-1&&xn>=.9)return!0}else if(u&&(be=ft(Bt.aabb.distanceZ(R)*P)),this.projection.isReprojectedInTileSpace&&s<=5){const $e=Math.pow(2,Bt.zoom),Ie=Q(new ri((Bt.x+.5)/$e,(Bt.y+.5)/$e));xe=Ie>.85?1:Ie}const Re=Zt*Zt+ge*ge+be;return Re<ft((1<<xt-Bt.zoom)*j*xe*(($e,Ie)=>{if(Ie*ft(.707)<$e)return 1;const on=Math.sqrt(Ie/$e);return on/(1.4144271570014144+(Math.pow(1.1,on-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(be,Ut),Re))};if(this.renderWorldCopies)for(let Bt=1;Bt<=3;Bt++)it.push(et(-Bt)),it.push(et(Bt));for(it.push(et(0));it.length>0;){const Bt=it.pop(),Zt=Bt.x,ge=Bt.y;let be=Bt.fullyVisible;const xe=()=>"globe"===this.projection.name&&(0===Bt.y||Bt.y===(1<<Bt.zoom)-1);if(!be){let Re=B?Bt.aabb.intersects(M):Bt.aabb.intersectsFlat(M);if(0===Re&&xe()){const ze=new Vu(Bt.zoom,Zt,ge);Re=Mv(this,y,ze,!0).intersects(M)}if(0===Re)continue;be=2===Re}if(Bt.zoom!==xt&&le(Bt))for(let Re=0;Re<4;Re++){const ze=(Zt<<1)+Re%2,$e=(ge<<1)+(Re>>1),Ie={aabb:c?Bt.aabb.quadrant(Re):yg(this,y,Bt.zoom+1,ze,$e,Bt.wrap,Bt.minZ,Bt.maxZ,this.projection),zoom:Bt.zoom+1,x:ze,y:$e,wrap:Bt.wrap,fullyVisible:be,tileID:void 0,shouldSplit:void 0,minZ:Bt.minZ,maxZ:Bt.maxZ};u&&!E&&(Ie.tileID=new si(Bt.zoom+1===xt?Nt:Bt.zoom+1,Bt.wrap,Bt.zoom+1,ze,$e),Wt(Ie)),it.push(Ie)}else{const Re=Bt.zoom===xt?Nt:Bt.zoom;if(t.minzoom&&t.minzoom>Re)continue;if(!be){let on=B?Bt.aabb.intersectsPrecise(M):Bt.aabb.intersectsPreciseFlat(M);if(0===on&&xe()){const vn=new Vu(Bt.zoom,Zt,ge);on=Mv(this,y,vn,!0).intersectsPrecise(M)}if(0===on)continue}const ze=x[0]-(.5+Zt+(Bt.wrap<<Bt.zoom))*(1<<r-Bt.zoom),$e=x[1]-.5-ge,Ie=Bt.tileID?Bt.tileID:new si(Re,Bt.wrap,Bt.zoom,Zt,ge);yt.push({tileID:Ie,distanceSq:ze*ze+$e*$e})}}if(this.fogCullDistSq){const Bt=this.fogCullDistSq,Zt=this.horizonLineFromTop();yt=yt.filter(ge=>{const be=[0,0,0,1],xe=[$t,$t,0,1],Re=this.calculateFogTileMatrix(ge.tileID.toUnwrapped());Oi.transformMat4(be,be,Re),Oi.transformMat4(xe,xe,Re);const ze=function(on,vn,xn){let Cn=0;for(let Mn=0;Mn<2;++Mn)on[Mn]>0&&(Cn+=(on[Mn]-0)*(on[Mn]-0)),vn[Mn]<0&&(Cn+=(0-vn[Mn])*(0-vn[Mn]));return Cn}(Oi.min([],be,xe),Oi.max([],be,xe));if(0===ze)return!0;let $e=!1;const Ie=this._elevation;if(Ie&&ze>Bt&&0!==Zt){const on=this.calculateProjMatrix(ge.tileID.toUnwrapped());let vn;t.isTerrainDEM||(vn=Ie.getMinMaxForTile(ge.tileID)),vn||(vn={min:G,max:U});const xn=function(Mn){const hr=Math.round((Mn+45+360)%360/90)%4;return Et[hr]}(this.rotation),Cn=[xn[0]*$t,xn[1]*$t,vn.max];Ot.transformMat4(Cn,Cn,on),$e=(1-Cn[1])*this.height*.5<Zt}return ze<Bt||$e})}return yt.sort((Bt,Zt)=>Bt.distanceSq-Zt.distanceSq).map(Bt=>Bt.tileID)}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const r=At(t.lat,-Ls,Ls),s=this.projection.project(t.lng,r);return new H(s.x*this.worldSize,s.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/ji(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,r){let s,a;const u=this.centerPoint;if("globe"===this.projection.name){const p=this.worldSize;s=(r.x-u.x)/p,a=(r.y-u.y)/p}else{const p=this.pointCoordinate(r),g=this.pointCoordinate(u);s=p.x-g.x,a=p.y-g.y}const c=this.locationCoordinate(t);this.setLocation(new ri(c.x-s,c.y-a))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,r){const s=r?ji(r,t.lat):void 0,a=this.projection.project(t.lng,t.lat);return new ri(a.x,a.y,s)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,r){const s=r??this._centerAltitude,a=[t.x,t.y,0,1],u=[t.x,t.y,1,1];Oi.transformMat4(a,a,this.pixelMatrixInverse),Oi.transformMat4(u,u,this.pixelMatrixInverse);const c=u[3];Oi.scale(a,a,1/a[3]),Oi.scale(u,u,1/c);const p=a[2],g=u[2];return{p0:a,p1:u,t:p===g?0:(s-p)/(g-p)}}screenPointToMercatorRay(t){const r=[t.x,t.y,0,1],s=[t.x,t.y,1,1];return Oi.transformMat4(r,r,this.pixelMatrixInverse),Oi.transformMat4(s,s,this.pixelMatrixInverse),Oi.scale(r,r,1/r[3]),Oi.scale(s,s,1/s[3]),r[2]=ji(r[2],this._center.lat)*this.worldSize,s[2]=ji(s[2],this._center.lat)*this.worldSize,Oi.scale(r,r,1/this.worldSize),Oi.scale(s,s,1/this.worldSize),new $_([r[0],r[1],r[2]],Ot.normalize([],Ot.sub([],s,r)))}rayIntersectionCoordinate(t){const{p0:r,p1:s,t:a}=t,u=ji(r[2],this._center.lat),c=ji(s[2],this._center.lat);return new ri(An(r[0],s[0],a)/this.worldSize,An(r[1],s[1],a)/this.worldSize,An(u,c,a))}pointCoordinate(t,r=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,r)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let r=this.projection.pointCoordinate3D(this,t.x,t.y);if(r)return new ri(r[0],r[1],r[2]);let s=0,a=this.horizonLineFromTop();if(t.y>a)return this.pointCoordinate(t);const u=.02*a,c=t.clone();for(let p=0;p<10&&a-s>u;p++){c.y=An(s,a,.66);const g=this.projection.pointCoordinate3D(this,c.x,c.y);g?(a=c.y,r=g):s=c.y}return r?new ri(r[0],r[1],r[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=df)return!this.isPointAboveHorizon(t);const r=this.pointCoordinate(t);return r.y>=0&&r.y<=1}_coordinatePoint(t,r){const s=r&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,a=[t.x*this.worldSize,t.y*this.worldSize,s+t.toAltitude(),1];return Oi.transformMat4(a,a,this.pixelMatrix),a[3]>0?new H(a[0]/a[3],a[1]/a[3]):new H(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:r}=this._edgeInsets,s=this.height-this._edgeInsets.bottom,a=this.width-this._edgeInsets.right,u=this.pointLocation3D(new H(r,t)),c=this.pointLocation3D(new H(a,t)),p=this.pointLocation3D(new H(a,s)),g=this.pointLocation3D(new H(r,s));let y=Math.min(u.lng,c.lng,p.lng,g.lng),x=Math.max(u.lng,c.lng,p.lng,g.lng),E=Math.min(u.lat,c.lat,p.lat,g.lat),S=Math.max(u.lat,c.lat,p.lat,g.lat);const M=Math.pow(2,-this.zoom)/16*270,D="globe"===this.projection.name?1:4,P=(O,R,B,j,V)=>{const U=(O+B)/2,G=(R+j)/2,Z=new H(U,G),{lng:Q,lat:et}=this.pointLocation3D(Z),it=Math.max(0,y-Q,E-et,Q-x,et-S);y=Math.min(y,Q),x=Math.max(x,Q),E=Math.min(E,et),S=Math.max(S,et),(V<D||it>M)&&(P(O,R,U,G,V+1),P(U,G,B,j,V+1))};if(P(r,t,a,t,1),P(a,t,a,s,1),P(a,s,r,s,1),P(r,s,r,t,1),"globe"===this.projection.name){const[O,R]=function(B){const j=ce.identity(new Float64Array(16));ce.multiply(j,B.pixelMatrix,B.globeMatrix);const V=[0,Il,0],U=[0,Yl,0];return Ot.transformMat4(V,V,j),Ot.transformMat4(U,U,j),[V[0]>0&&V[0]<=B.width&&V[1]>0&&V[1]<=B.height&&!Lv(B,new pr(B.center.lat,90)),U[0]>0&&U[0]<=B.width&&U[1]>0&&U[1]<=B.height&&!Lv(B,new pr(B.center.lat,-90))]}(this);O?(S=90,x=180,y=-180):R&&(E=-90,x=180,y=-180)}return new $a(new pr(y,E),new pr(x,S))}_getBoundsRectangular(t,r){const{top:s,left:a}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,c=this.width-this._edgeInsets.right,p=new H(a,s),g=new H(c,s),y=new H(c,u),x=new H(a,u);let E=this.pointCoordinate(p,t),S=this.pointCoordinate(g,t);const M=this.pointCoordinate(y,r),D=this.pointCoordinate(x,r),P=(O,R)=>(R.y-O.y)/(R.x-O.x);return E.y>1&&S.y>=0?E=new ri((1-D.y)/P(D,E)+D.x,1):E.y<0&&S.y<=1&&(E=new ri(-D.y/P(D,E)+D.x,0)),S.y>1&&E.y>=0?S=new ri((1-M.y)/P(M,S)+M.x,1):S.y<0&&E.y<=1&&(S=new ri(-M.y/P(M,S)+M.x,0)),(new $a).extend(this.coordinateLocation(E)).extend(this.coordinateLocation(S)).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(M))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const r=t.visibleDemTiles.reduce((s,a)=>{if(a.dem){const u=a.dem.tree;s.min=Math.min(s.min,u.minimums[0]),s.max=Math.max(s.max,u.maximums[0])}return s},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(r.min*t.exaggeration(),r.max*t.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const r=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,s=this.height/2-r*(1-this._horizonShift);return t?Math.max(0,s):s}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-Ls,this.maxLat=Ls,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=zs(this.minLng)*this.tileSize,this.worldMaxX=zs(this.maxLng)*this.tileSize,this.worldMinY=ba(this.maxLat)*this.tileSize,this.worldMaxY=ba(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,r){return this.projection.createTileMatrix(this,r,t)}calculateDistanceTileData(t){const r=t.key,s=this._distanceTileDataCache;if(s[r])return s[r];const a=t.canonical,u=1/this.height,c=this.cameraWorldSize,p=c/this.zoomScale(a.z),g=(a.x+Math.pow(2,a.z)*t.wrap)*p,y=a.y*p,x=this.point;x.x*=c/this.worldSize,x.y*=c/this.worldSize;const E=this.angle,S=Math.sin(-E),M=-Math.cos(-E);return s[r]={bearing:[S,M],center:[(x.x-g)*u,(x.y-y)*u],scale:p/$t*u},s[r]}calculateFogTileMatrix(t){const r=t.key,s=this._fogTileMatrixCache;if(s[r])return s[r];const a=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return ce.multiply(a,this.worldToFogMatrix,a),s[r]=new Float32Array(a),s[r]}calculateProjMatrix(t,r=!1,s=!1){const a=t.key;let u;if(u=s?this._expandedProjMatrixCache:r?this._alignedProjMatrixCache:this._projMatrixCache,u[a])return u[a];const c=this.calculatePosMatrix(t,this.worldSize);let p;return p=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:s?this.expandedFarZProjMatrix:r?this.alignedProjMatrix:this.projMatrix,ce.multiply(c,p,c),u[a]=new Float32Array(c),u[a]}calculatePixelsToTileUnitsMatrix(t){const r=t.tileID.key,s=this._pixelsToTileUnitsCache;if(s[r])return s[r];const a=function(u,c){const{scale:p}=u.tileTransform,g=p*$t/(u.tileSize*Math.pow(2,c.zoom-u.tileID.overscaledZ+u.tileID.canonical.z));return fp.scale(new Float32Array(4),c.inverseAdjustmentMatrix,[g,g])}(t,this);return s[r]=a,s[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,r=ce.fromScaling([],[t,t,t]);return ce.multiply(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const r=ji(1,this._center.lat)*this.worldSize,s=this._computeCameraPosition(r),a=this._camera.forward(),u=ji(1,this._center.lat);s[2]/=u,a[2]/=u,Ot.normalize(a,a);const c=t.raycast(s,a,t.exaggeration());if(c){const p=Ot.scaleAndAdd([],s,a,c),g=new ri(p[0],p[1],ji(p[2],ws(p[1]))),y=(g.z+Ot.length([g.x-s[0],g.y-s[1],g.z-s[2]*u]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(y),this._centerAltitude=g.toAltitude(),this._center=this.coordinateLocation(g),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const r=this._elevation,s=ji(1,this._center.lat)*this.worldSize,a=this._computeCameraPosition(s),u=r.getAtPointOrZero(new ri(...a)),c=this.pixelsPerMeter/this.worldSize*u,p=this._minimumHeightOverTerrain(),g=a[2]-c;if(g<=p)if(g<0||t){const y=this.locationCoordinate(this._center,this._centerAltitude),x=[a[0],a[1],y.z-a[2]],E=Ot.length(x);x[2]-=(p-g)/this._pixelsPerMercatorPixel;const S=Ot.length(x);if(0===S)return;Ot.scale(x,x,E/S*this._pixelsPerMercatorPixel),this._camera.position=[a[0],a[1],y.z*this._pixelsPerMercatorPixel-x[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const S=this.center;return S.lat=At(S.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(S.lng=At(S.lng,this.minLng,this.maxLng)),this.center=S,void(this._constraining=!1)}const r=this._unmodified,{x:s,y:a}=this.point;let u=0,c=s,p=a;const g=this.width/2,y=this.height/2,x=this.worldMinY*this.scale,E=this.worldMaxY*this.scale;if(a-y<x&&(p=x+y),a+y>E&&(p=E-y),E-x<this.height&&(u=Math.max(u,this.height/(E-x)),p=(E+x)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const S=this.worldMinX*this.scale,M=this.worldMaxX*this.scale,D=this.worldSize/2-(S+M)/2;c=(s+D+this.worldSize)%this.worldSize-D,c-g<S&&(c=S+g),c+g>M&&(c=M-g),M-S<this.width&&(u=Math.max(u,this.width/(M-S)),c=(M+S)/2)}c===s&&p===a||(this.center=this.unproject(new H(c,p))),u&&(this.zoom+=this.scaleZoom(u)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r="globe"===this.projection.name,s=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=ji(1,this.center.lat)/ji(1,45));const a=Ad(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,a),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const u="meters"===this.projection.zAxisUnit?s:1,c=this._camera.getWorldToCamera(this.worldSize,u);let p;const g=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(g[8]=2*-t.x/this.width,g[9]=2*t.y/this.height,this.isOrthographic){let et=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),it=et*this.aspect,yt=-it,xt=-et;it-=t.x,yt-=t.x,et+=t.y,xt+=t.y,p=this._camera.getCameraToClipOrthographic(yt,it,xt,et,this._nearZ,this._farZ),((Nt,ft,Ut,Wt)=>{for(let le=0;le<16;le++)Nt[le]=F1(ft[le],Ut[le],Wt)})(p,p,g,k1(this.pitch>=15?1:this.pitch/15))}else p=g;const y=ce.mul([],g,c);let x=ce.mul([],p,c);if(this.projection.isReprojectedInTileSpace){const et=this.locationCoordinate(this.center),it=ce.identity([]);ce.translate(it,it,[et.x*this.worldSize,et.y*this.worldSize,0]),ce.multiply(it,it,OI(this)),ce.translate(it,it,[-et.x*this.worldSize,-et.y*this.worldSize,0]),ce.multiply(x,x,it),ce.multiply(y,y,it),this.inverseAdjustmentMatrix=function(yt){const xt=OI(yt,!0);return fp.invert([],[xt[0],xt[1],xt[4],xt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=ce.scale([],x,[this.worldSize,this.worldSize,this.worldSize/u,1]),this.projMatrix=x,this.invProjMatrix=ce.invert(new Float64Array(16),this.projMatrix),r){const et=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);et[8]=2*-t.x/this.width,et[9]=2*t.y/this.height,this.expandedFarZProjMatrix=ce.mul([],et,c)}else this.expandedFarZProjMatrix=this.projMatrix;const E=ce.invert([],p);this.frustumCorners=bv.fromInvProjectionMatrix(E,this.horizonLineFromTop(),this.height),this.cameraFrustum=Lc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!r);const S=new Float32Array(16);ce.identity(S),ce.scale(S,S,[1,-1,1]),ce.rotateX(S,S,this._pitch),ce.rotateZ(S,S,this.angle);const M=ce.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=ce.clone(M);const D=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;M[8]=2*-t.x/this.width,M[9]=2*(t.y+D)/this.height,this.skyboxMatrix=ce.multiply(S,M,S);const P=this.point,O=P.x,R=P.y,B=this.width%2/2,j=this.height%2/2,V=Math.cos(this.angle),U=Math.sin(this.angle),G=O-Math.round(O)+V*B+U*j,Z=R-Math.round(R)+V*j+U*B,Q=new Float64Array(x);if(ce.translate(Q,Q,[G>.5?G-1:G,Z>.5?Z-1:Z,0]),this.alignedProjMatrix=Q,x=ce.create(),ce.scale(x,x,[this.width/2,-this.height/2,1]),ce.translate(x,x,[1,-1,0]),this.labelPlaneMatrix=x,x=ce.create(),ce.scale(x,x,[1,-1,1]),ce.translate(x,x,[-1,-1,0]),ce.scale(x,x,[2/this.width,2/this.height,1]),this.glCoordMatrix=x,this.pixelMatrix=ce.multiply(new Float64Array(16),this.labelPlaneMatrix,y),this._calcFogMatrices(),this._distanceTileDataCache={},x=ce.invert(new Float64Array(16),this.pixelMatrix),!x)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=x,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=function(it){const{x:yt,y:xt}=it.point,{lng:Nt,lat:ft}=it._center;return hE(yt,xt,it.worldSize,Nt,ft)}(this);const et=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=Ot.transformMat4(et,et,c),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=x;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,s=this._camera.position,a=1/this.height/this._pixelsPerMercatorPixel,u=[t,t,r];Ot.scale(u,u,a),Ot.scale(s,s,-1),Ot.multiply(s,s,u);const c=ce.create();ce.translate(c,c,s),ce.scale(c,c,u),this.mercatorFogMatrix=c,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,r,a)}_computeCameraPosition(t){const r=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,s=this._camera.forward(),a=this.point,u=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*r-t/this.worldSize*this._centerAltitude;return[a.x/this.worldSize-s[0]*u,a.y/this.worldSize-s[1]*u,t/this.worldSize*this._centerAltitude-s[2]*u]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),s=this._camera.position[2],a=t[2];let u=1;this.projection.wrap&&(this.center=this.center.wrap()),a>0&&(u=Math.min((r-s)/a,1)),this._camera.position=Ot.scaleAndAdd([],this._camera.position,t,u),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,r=this._camera.forward(),{pitch:s,bearing:a}=this._camera.getPitchBearing(),u=ji(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,c=this._mercatorZfromZoom(this._maxZoom)*Math.cos(St(this._maxPitch)),p=Math.max((t[2]-u)/Math.cos(s),c),g=this._zoomFromMercatorZ(p);Ot.scaleAndAdd(t,t,r,p),this._pitch=At(s,St(this.minPitch),St(this.maxPitch)),this.angle=wt(a,-Math.PI,Math.PI),this._setZoom(At(g,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new ri(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let r=0,s=df,a=0,u=1/0;for(;s-r>1e-6&&s>r;){const c=r+.5*(s-r),p=this.tileSize*Math.pow(2,c),g=this.getCameraToCenterDistance(this.projection,c,p),y=this.scaleZoom(g/(t*this.tileSize)),x=Math.abs(c-y);x<u&&(u=x,a=c),c<y?r=c:s=c}return a}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(Gt("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,r){const s=Math.min(t.x,r.x),a=Math.max(t.x,r.x),u=Math.min(t.y,r.y),c=Math.max(t.y,r.y);if(u<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const p=[new H(s,u),new H(a,c),new H(s,c),new H(a,u)],g=this.renderWorldCopies?-3:0,y=this.renderWorldCopies?4:1;for(const x of p){const E=this.pointRayIntersection(x);if(E.t<0)return!0;const S=this.rayIntersectionCoordinate(E);if(S.x<g||S.y<0||S.x>y||S.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+Ht(this.fovAboveCenter)>88||this.anyCornerOffEdge(new H(0,0),new H(this.width,this.height))}zoomDeltaToMovement(t,r){const s=Ot.length(Ot.sub([],this._camera.position,t)),a=this._zoomFromMercatorZ(s)+r;return s-this._mercatorZfromZoom(a)}getCameraPoint(){if("globe"===this.projection.name){const t=function([r,s,a],u){const c=[r,s,a,1];Oi.transformMat4(c,c,u);const p=c[3]=Math.max(c[3],1e-6);return c[0]/=p,c[1]/=p,c[2]/=p,c}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new H(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new H(0,t))}}getCameraToCenterDistance(t,r=this.zoom,s=this.worldSize){const a=Ad(t,r,this.width,this.height,1024),u=t.pixelSpaceConversion(this.center.lat,s,a);let c=.5/Math.tan(.5*this._fov)*this.height*u;return this.isOrthographic&&(c=F1(1,c,k1(this.pitch>=15?1:this.pitch/15))),c}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&ce.multiply(t,t,this.globeMatrix),t}getFrustum(t){return Lc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}function z1(e,t,r){ce.identity(e),ce.rotateZ(e,e,St(t[2])),ce.rotateX(e,e,St(t[0])),ce.rotateY(e,e,St(t[1])),ce.scale(e,e,r),ce.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Pg(e,t,r,s,a,u,c,p){const g=[r[0]-t[0],r[1]-t[1],0],y=[s[0]-t[0],s[1]-t[1],0];if(Ot.length(g)<1e-12||Ot.length(y)<1e-12)return Ha.identity(e);const x=Ot.cross([],g,y);Ot.normalize(x,x),Ot.subtract(y,s,t),g[2]=(u-a)*p,y[2]=(c-a)*p;const E=g;return Ot.cross(E,g,y),Ot.normalize(E,E),Ha.rotationTo(e,x,E)}function B1(e,t,r=!1){const s=da(t.zoom),a=function(u,c,p){const g=c.worldSize,y=[u[12],u[13],u[14]],x=ws(y[1]/g),E=pu(y[0]/g),S=ce.identity([]),M=ji(1,x)*g,D=ji(1,0)*g*Uh(x,c.zoom),P=1/Dv(g);let O=D*P;if(p){const V=Ad(c.projection,c.zoom,c.width,c.height,1024);O=P*c.projection.pixelSpaceConversion(c.center.lat,g,V)}const R=du(x,E);Ot.add(R,R,Ot.scale([],Ot.normalize([],R),M*O*y[2]));const B=function(V){const U=[V[0],V[1],V[2]];let G=[0,1,0];const Z=Ot.cross([],G,U);return Ot.cross(G,U,Z),0===Ot.squaredLength(G)&&(G=[0,1,0],Ot.cross(Z,U,G)),Ot.normalize(Z,Z),Ot.normalize(G,G),Ot.normalize(U,U),[Z[0],Z[1],Z[2],0,G[0],G[1],G[2],0,U[0],U[1],U[2],0,V[0],V[1],V[2],1]}(R);ce.scale(S,S,[O,O,O*M]),ce.translate(S,S,[-y[0],-y[1],-y[2]]);const j=ce.multiply([],c.globeMatrix,B);return ce.multiply(j,j,S),ce.multiply(j,j,u),j}(e,t,r);return s>0?function(c,p,g){const y=(D,P,O)=>{const R=Ot.length(D),B=Ot.length(P),j=Bh(D,P,O);return Ot.scale(j,j,1/Ot.length(j)*An(R,B,O))},x=y([c[0],c[1],c[2]],[p[0],p[1],p[2]],g),E=y([c[4],c[5],c[6]],[p[4],p[5],p[6]],g),S=y([c[8],c[9],c[10]],[p[8],p[9],p[10]],g),M=Bh([c[12],c[13],c[14]],[p[12],p[13],p[14]],g);return[x[0],x[1],x[2],0,E[0],E[1],E[2],0,S[0],S[1],S[2],0,M[0],M[1],M[2],1]}(a,function(c,p){const g=p.worldSize,y=ji(1,0)*g*Uh(p.center.lat,p.zoom)/Dv(g),x=ji(1,p.center.lat)*g,E=ce.identity([]);return ce.rotateY(E,E,St(p.center.lng)),ce.rotateX(E,E,St(p.center.lat)),ce.translate(E,E,[0,0,Xl]),ce.scale(E,E,[y,y,y*x]),ce.translate(E,E,[p.point.x-.5*g,p.point.y-.5*g,0]),ce.multiply(E,E,c),ce.multiply(E,p.globeMatrix,E)}(e,t),s):a}const Cf=[1,1,1];class jI{constructor(t,r,s,a){this.id=t,this.position=null!=r?new pr(r[0],r[1]):new pr(0,0),this.orientation=s??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new Qi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,r){if(ce.multiply(t.matrix,r,t.matrix),t.meshes)for(const s of t.meshes){const a=Qi.applyTransform(s.aabb,t.matrix);this.aabb.encapsulate(a)}if(t.children)for(const s of t.children)this._applyTransformations(s,t.matrix)}computeBoundsAndApplyParent(){const t=ce.identity([]);for(const r of this.nodes)this._applyTransformations(r,t)}_positionModelOnTerrain(t,r){const s=t.elevation;if(!s)return 0;const a=Qi.projectAabbCorners(this.aabb,this.matrix),u=ji(1,this.position.lat)*t.worldSize,c=function(R,B){const j=[0,0,1],V=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const U of V){const G=R[U.corners[0]],Z=R[U.corners[1]],Q=R[U.corners[2]],et=[Z[0]-G[0],Z[1]-G[1],B*(Z[2]-G[2])],it=Ot.cross(et,et,[Q[0]-G[0],Q[1]-G[1],B*(Q[2]-G[2])]);Ot.normalize(it,it),U.dotProductWithUp=Ot.dot(it,j)}return V.sort((U,G)=>U.dotProductWithUp-G.dotProductWithUp),V[0].corners}(a,u),p=a[c[0]],g=a[c[1]],y=a[c[2]],x=a[c[3]],E=s.getAtPointOrZero(new ri(p[0]/t.worldSize,p[1]/t.worldSize),0),S=s.getAtPointOrZero(new ri(g[0]/t.worldSize,g[1]/t.worldSize),0),M=s.getAtPointOrZero(new ri(y[0]/t.worldSize,y[1]/t.worldSize),0),D=s.getAtPointOrZero(new ri(x[0]/t.worldSize,x[1]/t.worldSize),0),P=(E+D)/2,O=(S+M)/2;return P>O?S<M?Pg(r,g,x,p,S,D,E,u):Pg(r,y,p,x,M,E,D,u):E<D?Pg(r,p,g,y,E,S,M,u):Pg(r,x,y,g,D,M,S,u),Math.max(P,O)}computeModelMatrix(t,r,s,a,u,c,p=!1){const g=t.transform,y=g.zoom,x=g.project(this.position),E=Uh(this.position.lat,y),S=1/E;ce.identity(this.matrix),ce.translate(this.matrix,this.matrix,[x.x+a[0]*S,x.y+a[1]*S,a[2]]);let M=1,D=1;const P=g.worldSize;if(p){if("mercator"===g.projection.name){let j=0;g.elevation&&(j=g.elevation.getAtPointOrZero(new ri(x.x/P,x.y/P),0));const V=Oi.transformMat4([],[x.x,x.y,j,1],g.projMatrix)[3]/g.cameraToCenterDistance;M=V,D=V*Uh(g.center.lat,y)}else if("globe"===g.projection.name){const j=B1(this.matrix,g),V=ce.multiply([],g.projMatrix,j),U=[0,0,0,1];Oi.transformMat4(U,U,V);const G=U[3]/g.cameraToCenterDistance,Z=da(y),Q=g.projection.pixelsPerMeter(this.position.lat,P)*Uh(this.position.lat,y),et=g.projection.pixelsPerMeter(g.center.lat,P)*Uh(g.center.lat,y);M=G/An(Q,Nv(g.center.lat),Z),D=G*E/Q,M*=et,D*=et}}else M=S;ce.scale(this.matrix,this.matrix,[M,M,D]);const O=[...this.matrix],R=this.orientation,B=[];if(z1(B,[R[0]+r[0],R[1]+r[1],R[2]+r[2]],s),ce.multiply(this.matrix,O,B),u&&g.elevation){let j=0;const V=[];if(c&&g.elevation){j=this._positionModelOnTerrain(g,V);const U=ce.fromQuat([],V),G=ce.multiply([],U,B);ce.multiply(this.matrix,O,G)}else j=g.elevation.getAtPointOrZero(new ri(x.x/P,x.y/P),0);0!==j&&(this.matrix[14]+=j)}}upload(t){if(!this.uploaded){for(const r of this.nodes)qh(r,t);for(const r of this.nodes)Yp(r);this.uploaded=!0}}destroy(){for(const t of this.nodes)By(t)}}function Lg(e,t,r=!1){e.uploaded||(e.gfxTexture=new fs(t,e.image,r?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function U1(e,t,r){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,$D.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,PI.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,WD.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?HD:ZD).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,XD.members,!0)),e.segments=Ui.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const s=e.material;s.pbrMetallicRoughness.baseColorTexture&&Lg(s.pbrMetallicRoughness.baseColorTexture,t),s.pbrMetallicRoughness.metallicRoughnessTexture&&Lg(s.pbrMetallicRoughness.metallicRoughnessTexture,t),s.normalTexture&&Lg(s.normalTexture,t),s.occlusionTexture&&Lg(s.occlusionTexture,t,r),s.emissionTexture&&Lg(s.emissionTexture,t)}function qh(e,t,r){if(e.meshes)for(const s of e.meshes)U1(s,t,r);if(e.children)for(const s of e.children)qh(s,t,r)}function Yp(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)Yp(t)}function By(e){if(e.meshes)for(const r of e.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((t=r.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const r of e.children)By(r)}class Uy{constructor(t,r){this.feature=t,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class YD{constructor(){this.instancedDataArray=new X0,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class JD{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(t,r,s,a){this.tileToMeter=sg(s);const u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:c,id:p,index:g,sourceLayerIndex:y}of t){const x=ih(c,u);if(!this.layers[0]._featureFilter.filter(new ss(this.zoom),x,s))continue;const E={id:p,sourceLayerIndex:y,index:g,geometry:u?x.geometry:Rc(c,s,a),properties:c.properties,type:c.type,patterns:{}},S=this.addFeature(E,E.geometry,x);S&&r.featureIndex.insert(c,E.geometry,g,y,this.index,this.instancesPerModel[S].instancedDataArray.length)}this.lookup=null}update(t,r,s,a){for(const u in this.instancesPerModel){const c=this.instancesPerModel[u];for(const p in t)c.idToFeaturesIndex.hasOwnProperty(p)&&this.evaluate(c.features[c.idToFeaturesIndex[p]],t[p],c,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const r in this.instancesPerModel){const s=this.instancesPerModel[r];for(const a of s.features){const u=this.layers[0],c=a.feature,p=this.canonical,g=u.paint.get("model-rotation").evaluate(c,{},p),y=u.paint.get("model-scale").evaluate(c,{},p),x=u.paint.get("model-translation").evaluate(c,{},p);Ot.exactEquals(a.rotation,g)&&Ot.exactEquals(a.scale,y)&&Ot.exactEquals(a.translation,x)||(this.evaluate(a,a.featureStates,s,!0),t=!0)}}return t}isEmpty(){for(const t in this.instancesPerModel)if(0!==this.instancesPerModel[t].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const r in this.instancesPerModel){const s=this.instancesPerModel[r];s.instancedDataArray.length<0||0===s.instancedDataArray.length||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=t.createVertexBuffer(s.instancedDataArray,M1.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const r=this.instancesPerModel[t];0!==r.instancedDataArray.length&&r.instancedDataBuffer&&r.instancedDataBuffer.destroy()}}addFeature(t,r,s){const a=this.layers[0],u=a.layout.get("model-id").evaluate(s,{},this.canonical);if(!u)return Gt(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),u;this.instancesPerModel[u]||(this.instancesPerModel[u]=new YD);const c=this.instancesPerModel[u],p=c.instancedDataArray,g=new Uy(s,p.length);for(const y of r)for(const x of y){if(x.x<0||x.x>=$t||x.y<0||x.y>=$t)continue;const E=(this.lookupDim-1)/$t,S=this.lookupDim*(x.y*E|0)+x.x*E|0;if(this.lookup){if(0!==this.lookup[S])continue;this.lookup[S]=1}this.instanceCount++;const M=p.length;p.resize(M+1),c.instancesEvaluatedElevation.push(0),p.float32[16*M]=x.x,p.float32[16*M+1]=x.y}return g.instancedDataCount=c.instancedDataArray.length-g.instancedDataOffset,g.instancedDataCount>0&&(t.id&&(c.idToFeaturesIndex[t.id]=c.features.length),c.features.push(g),this.evaluate(g,{},c,!1)),u}evaluate(t,r,s,a){const u=this.layers[0],c=t.feature,p=this.canonical,g=t.rotation=u.paint.get("model-rotation").evaluate(c,r,p),y=t.scale=u.paint.get("model-scale").evaluate(c,r,p),x=t.translation=u.paint.get("model-translation").evaluate(c,r,p),E=u.paint.get("model-color").evaluate(c,r,p);E.a=u.paint.get("model-color-mix-intensity").evaluate(c,r,p);const S=[];this.maxVerticalOffset<x[2]&&(this.maxVerticalOffset=x[2]),this.maxScale=Math.max(Math.max(this.maxScale,y[0]),Math.max(y[1],y[2])),z1(S,g,y);const M=Math.round(100*E.a)+E.b/1.05;for(let D=0;D<t.instancedDataCount;++D){const P=t.instancedDataOffset+D,O=16*P,R=s.instancedDataArray.float32;let B=0;a&&(B=R[O+6]-s.instancesEvaluatedElevation[P]);const j=0|R[O+1];R[O]=(0|R[O])+E.r/1.05,R[O+1]=j+E.g/1.05,R[O+2]=M,R[O+3]=1/(p.z>10?this.tileToMeter:sg(p,j)),R[O+4]=x[0],R[O+5]=x[1],R[O+6]=x[2]+B,R[O+7]=S[0],R[O+8]=S[1],R[O+9]=S[2],R[O+10]=S[4],R[O+11]=S[5],R[O+12]=S[6],R[O+13]=S[8],R[O+14]=S[9],R[O+15]=S[10],s.instancesEvaluatedElevation[P]=x[2]}}}Fn(JD,"ModelBucket",{omit:["layers"]}),Fn(YD,"PerModelAttributes"),Fn(Uy,"ModelFeature");const KD=new ys({visibility:new un(It.layout_model.visibility),"model-id":new Xn(It.layout_model["model-id"])});var QD={paint:new ys({"model-opacity":new un(It.paint_model["model-opacity"]),"model-rotation":new Xn(It.paint_model["model-rotation"]),"model-scale":new Xn(It.paint_model["model-scale"]),"model-translation":new Xn(It.paint_model["model-translation"]),"model-color":new Xn(It.paint_model["model-color"]),"model-color-mix-intensity":new Xn(It.paint_model["model-color-mix-intensity"]),"model-type":new un(It.paint_model["model-type"]),"model-cast-shadows":new un(It.paint_model["model-cast-shadows"]),"model-receive-shadows":new un(It.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new un(It.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Xn(It.paint_model["model-emissive-strength"]),"model-roughness":new Xn(It.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Xn(It.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new un(It.paint_model["model-cutoff-fade-range"])}),layout:KD};const jy=new Float32Array(262144),Od=new Uint8Array(262144);function Ra(e){let t=0;if(e.meshes)for(const r of e.meshes)t=Math.max(t,r.aabb.max[2]);if(e.children)for(const r of e.children)t=Math.max(t,Ra(r));return t}const j1=["","wall","door","roof","window","lamp","logo"];class VI{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:Ra(t)}}}}class GI{constructor(t,r,s,a){this.nodes=t,this.id=r,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,s&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=a,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const s of r){const a=s.node;this.uploaded?this.updatePbrBuffer(a):qh(a,t,!0)}for(const s of r)Yp(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let r=!1;if(!t.meshes)return r;for(const s of t.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),r=!0);return r}needsReEvaluation(t,r,s){const a=t.transform.projectionOptions,u=t.style.getBrightness(),c=this.brightness!==u;return!!(!this.uploaded||this.dirty||a.name!==this.projection.name||Jp(s.paint.get("model-color").value,c)||Jp(s.paint.get("model-color-mix-intensity").value,c)||Jp(s.paint.get("model-roughness").value,c)||Jp(s.paint.get("model-emissive-strength").value,c)||Jp(s.paint.get("model-height-based-emissive-strength-multiplier").value,c))&&(this.projection=a,this.brightness=u,!0)}evaluateScale(t,r){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const s=this.getNodesInfo(),a=this.id.canonical;for(const u of s){const c=u.feature;u.evaluatedScale=r.paint.get("model-scale").evaluate(c,{},a)}}evaluate(t){const r=this.getNodesInfo();for(const s of r){if(!s.node.meshes)continue;const a=s.feature,u=s.node.meshes&&s.node.meshes[0].featureData,c=s.evaluatedColor[2],p=s.evaluatedRMEA[2],g=this.id.canonical;if(s.hasTranslucentParts=!1,u){for(let y=0;y<j1.length;y++){const x=j1[y];x.length&&(a.properties.part=x);const E=t.paint.get("model-color").evaluate(a,{},g),S=t.paint.get("model-color-mix-intensity").evaluate(a,{},g);s.evaluatedColor[y]=[E.r,E.g,E.b,S],s.evaluatedRMEA[y][0]=t.paint.get("model-roughness").evaluate(a,{},g),s.evaluatedRMEA[y][2]=t.paint.get("model-emissive-strength").evaluate(a,{},g),s.evaluatedRMEA[y][3]=E.a,s.emissionHeightBasedParams[y]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(a,{},g),!s.hasTranslucentParts&&E.a<1&&(s.hasTranslucentParts=!0)}delete a.properties.part,qI(s,c!==s.evaluatedColor[2]||p!==s.evaluatedRMEA[2])}s.evaluatedScale=t.paint.get("model-scale").evaluate(a,{},g),this.updatePbrBuffer(s.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,r,s,a){const u=t.findDEMTileFor(s);if(u&&(u.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;const c=gd.create(t,s,u);if(!c)return;4&this.modelTraits&&this.updateDEM(t,c,s,a);for(const p of this.getNodesInfo()){const g=p.node;if(!g.footprint||!g.footprint.vertices||!g.footprint.vertices.length)continue;const y=g.footprint.vertices;let x=c.getElevationAt(y[0].x,y[0].y,!0,!0);for(let E=1;E<y.length;E++)x=Math.min(x,c.getElevationAt(y[E].x,y[E].y,!0,!0));g.elevation=x}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=r}}updateDEM(t,r,s,a){let u=r._dem._modifiedForSources[a];if(void 0===u&&(r._dem._modifiedForSources[a]=[],u=r._dem._modifiedForSources[a]),u.includes(s.canonical))return;const c=r._dem.dim;u.push(s.canonical);let p=!1;for(const g of this.getNodesInfo()){const y=g.node;if(!y.footprint||!y.footprint.grid)continue;const x=y.footprint.grid,E=r.tileCoordToPixel(x.min.x,x.min.y),S=r.tileCoordToPixel(x.max.x,x.max.y),M=Math.min(Math.min(c-S.y,E.x),Math.min(E.y,c-S.x));if(M<0)continue;const D=At(M,2,5);let P=Math.max(0,E.x-D),O=Math.max(0,E.y-D),R=Math.min(S.x+D,c-1),B=Math.min(S.y+D,c-1);for(let G=O;G<=B;++G)for(let Z=P;Z<=R;++Z)Od[G*c+Z]=255;let j=0,V=0;for(let G=0;G<x.cellsY;++G)for(let Z=0;Z<x.cellsX;++Z){if(!x.cells[G*x.cellsX+Z])continue;const Q=r.tileCoordToPixel(x.min.x+Z/x.xScale,x.min.y+G/x.yScale),et=r.tileCoordToPixel(x.min.x+(Z+1)/x.xScale,x.min.y+(G+1)/x.yScale);for(let it=Q.y;it<=Math.min(et.y+1,c-1);++it)for(let yt=Q.x;yt<=Math.min(et.x+1,c-1);++yt)255===Od[it*c+yt]&&(Od[it*c+yt]=0,j+=r.getElevationAtPixel(yt,it),V++)}const U=j/V;P=Math.max(1,E.x-D),O=Math.max(1,E.y-D),R=Math.min(S.x+D,c-2),B=Math.min(S.y+D,c-2),p=!0;for(let G=O;G<=B;++G)for(let Z=P;Z<=R;++Z)0===Od[G*c+Z]&&(jy[G*c+Z]=r._dem.set(Z,G,U));for(let G=1;G<D;++G){P=Math.max(1,E.x-G),O=Math.max(1,E.y-G),R=Math.min(S.x+G,c-2),B=Math.min(S.y+G,c-2);for(let Z=O;Z<=B;++Z)for(let Q=P;Q<=R;++Q){const et=Z*c+Q;if(255===Od[et]){let it=0,yt=0,xt=-1,Nt=-1;for(let ft=-1;ft<=1;++ft)for(let Ut=-1;Ut<=1;++Ut){const Wt=(Z+ft)*c+Q+Ut;if(Od[Wt]>=G)continue;const le=jy[Wt],Bt=Math.abs(le);Bt>yt&&(it=le,yt=Bt,xt=Ut,Nt=ft)}if(yt>.1){const ft=1-(G+.5*Math.abs(xt*Nt))/D;let Ut=r._dem.get(Q,Z)+it*ft;const Wt=r._dem.get(Q+xt,Z+Nt),le=r._dem.get(Q-xt,Z-Nt,!0);(Ut-Wt)*(Ut-le)>0&&(Ut=(Wt+le)/2),jy[et]=r._dem.set(Q,Z,Ut),Od[et]=G}}}}}p&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=or.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const t of this.nodes)this.nodesInfo.push(new VI(t));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const t of this.nodes)By(t);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const t=this.getNodesInfo();for(const r of t)Yp(r.node),By(r.node)}isEmpty(){return!this.nodes.length}updateReplacement(t,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const s=r.getReplacementRegionsForTile(t.toUnwrapped()),a=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){const c=a[u].node;a[u].hiddenByReplacement=!!c.footprint&&!s.find(p=>p.footprint===c.footprint)}}getHeightAtTileCoord(t,r){const s=this.getNodesInfo(),a=[];for(let u=0;u<this.nodesInfo.length;u++){const c=s[u],p=c.node.meshes[0];if(t<p.aabb.min[0]||r<p.aabb.min[1]||t>p.aabb.max[0]||r>p.aabb.max[1])continue;const g=(t-p.aabb.min[0])/(p.aabb.max[0]-p.aabb.min[0])*64|0,y=64*Math.min(63,(r-p.aabb.min[1])/(p.aabb.max[1]-p.aabb.min[1])*64|0)+Math.min(63,g);if(!(p.heightmap[y]<0&&c.node.footprint))return c.hiddenByReplacement?void 0:{height:p.heightmap[y],maxHeight:c.feature.properties.height,hidden:!1,verticalScale:c.evaluatedScale[2]};if(c.node.footprint.grid.query(new H(t,r),new H(t,r),a),a.length>0)return{height:void 0,maxHeight:c.feature.properties.height,hidden:c.hiddenByReplacement,verticalScale:c.evaluatedScale[2]}}}}function Jp(e,t){return!e.isLightConstant&&t}function t2(e,t,r,s,a,u,c,p){let g=(61440&t|(61440&t)>>4)>>8,y=(3840&t|(3840&t)>>4)>>4,x=240&t|(240&t)>>4;r[3]>0&&(g=An(g,255*r[0],r[3]),y=An(y,255*r[1],r[3]),x=An(x,255*r[2],r[3]));const E=g<<8|y,S=x<<8|Math.floor(255*s[3]),M=function(G){const Z=At(G,0,2);return Math.min(Math.round(.5*Z*255),255)}(s[2])<<8|15*s[0]<<4|15*s[1],D=At(a[0],0,1),P=At(a[1],0,1),O=At(a[2],0,1),R=At(a[3],0,1);let B,j,V,U;if(D!==P&&c!==u&&P!==D){const G=c-u;j=1/(G*(P-D)),V=-(u+G*D)/(G*(P-D));const Z=At(a[4],-1,1);U=Math.pow(10,Z),B=255*O<<8|255*R}else B=65535,j=0,V=1,U=1;if(e.emplaceBack(E,S,M,B,j,V,U),p){const G=p.length;p.clear();for(let Z=0;Z<G;Z++)p.emplaceBack(E,S,M,B,j,V,U)}}function qI(e,t){const r=e.node;let s=0;for(const a of r.meshes){if(r.lights&&r.lightMeshIndex===s||!a.featureData)continue;a.featureArray=new cf,a.featureArray.reserve(a.featureData.length);let u=t;for(const c of a.featureData){let p;const g=65535&c,y=(15&g)<8?15&g:0,x=c>>16&65535,E=e.evaluatedRMEA[y],S=e.evaluatedColor[y],M=e.emissionHeightBasedParams[y];if(u&&2===y&&r.lights&&(p=new cf,p.resize(10*r.lights.length)),t2(a.featureArray,x,S,E,M,a.aabb.min[2],a.aabb.max[2],p),p&&u){u=!1;const D=r.meshes[r.lightMeshIndex];D.featureArray=p,D.featureArray._trim()}}a.featureArray._trim(),s++}}Fn(GI,"Tiled3dModelBucket",{omit:["layers"]}),Fn(VI,"Tiled3dModelFeature");class $I{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const r=V1(new H(0,0),new H($t,$t),t),s=[];for(const a of this._activeRegions){if(a.hiddenByOverlap||!ZI(r,a))continue;const u=e2(a.min,a.max,t);s.push({min:u.min,max:u.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId})}return s}setSources(t){this._setSources(t.map(r=>({getSourceId:()=>r.cache.id,getFootprints:()=>{const s=[];for(const a of r.cache.getVisibleCoordinates()){const u=r.cache.getTile(a).buckets[r.layer];if(u)for(const c of u.getNodesInfo()){const p=c.node;p.footprint&&s.push({footprint:p.footprint,id:a.toUnwrapped()})}}return s}})))}_addSource(t){const r=t.getFootprints();if(0!==r.length){for(const s of r){if(!s.footprint)continue;const a=V1(s.footprint.min,s.footprint.max,s.id);this._activeRegions.push({min:a.min,max:a.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:s.id,footprint:s.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((r,s)=>r.priority-s.priority||$h(r.min,s.min)||$h(r.max,s.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let r=0,s=0;for(;!t&&r!==this._activeRegions.length;){const a=this._activeRegions[r],u=this._prevRegions[s];t=a.priority!==u.priority||!HI(a,u),++r,++s}}if(t){++this._updateTime;const r=s=>{const a=this._activeRegions;if(s>=a.length)return s;const u=a[s].priority;for(;s<a.length&&a[s].priority===u;)++s;return s};if(this._sourceIds.length>1){let s=0,a=r(s);for(;s!==a;){let u=s;const c=s;for(;u!==a;){const p=this._activeRegions[u];p.hiddenByOverlap=!1;for(let g=0;g<c;g++){const y=this._activeRegions[g];if(!y.hiddenByOverlap&&ZI(p,y)&&(p.hiddenByOverlap=n2(p.footprint,p.tileId,y.footprint,y.tileId),p.hiddenByOverlap))break}++u}s=a,a=r(s)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let r=t.length-1;r>=0;r--)this._addSource(t[r]);this._computeReplacement()}}function $h(e,t){return e.x-t.x||e.y-t.y}function HI(e,t){return 0===$h(e.min,t.min)&&0===$h(e.max,t.max)}function ZI(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function V1(e,t,r){const s=1/$t,a=1/(1<<r.canonical.z),u=(t.x*s+r.canonical.x)*a+r.wrap,c=(t.y*s+r.canonical.y)*a;return{min:new H((e.x*s+r.canonical.x)*a+r.wrap,(e.y*s+r.canonical.y)*a),max:new H(u,c)}}function e2(e,t,r){const s=1<<r.canonical.z,a=((t.x-r.wrap)*s-r.canonical.x)*$t,u=(t.y*s-r.canonical.y)*$t;return{min:new H(((e.x-r.wrap)*s-r.canonical.x)*$t,(e.y*s-r.canonical.y)*$t),max:new H(a,u)}}function G1(e,t,r,s,a,u,c){const p=e.indices,g=e.vertices,y=[];for(let x=s;x<s+a;x+=3){const E=t[r[x+0]+u],S=t[r[x+1]+u],M=t[r[x+2]+u],D=Math.min(E.x,S.x,M.x),P=Math.max(E.x,S.x,M.x),O=Math.min(E.y,S.y,M.y),R=Math.max(E.y,S.y,M.y);y.length=0,e.grid.query(new H(D,O),new H(P,R),y);for(let B=0;B<y.length;B++){const j=y[B];if(ug(g[p[3*j+0]],g[p[3*j+1]],g[p[3*j+2]],E,S,M,c))return!0}}return!1}function n2(e,t,r,s){if(!e||!r)return!1;let a=e.vertices;if(!t.canonical.equals(s.canonical)||t.wrap!==s.wrap){if(r.vertices.length<e.vertices.length)return n2(r,s,e,t);const u=t.canonical,c=s.canonical,p=Math.pow(2,c.z-u.z);a=e.vertices.map(g=>new H(g.x*u.x*$t*p-c.x*$t,g.y*u.y*$t*p-c.y*$t))}return G1(r,a,e.indices,0,e.indices.length,0,0)}const WI=r1.types,XI=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],ph=["fill-extrusion-flood-light-ground-radius"],r2=Math.pow(2,13),o2=Math.pow(2,15)-1,zc=new H(0,1),Na=2147483648;function Jl(e,t,r,s,a,u,c,p){e.emplaceBack((t<<1)+c,(r<<1)+u,(Math.floor(s*r2)<<1)+a,Math.round(p))}function Og(e,t,r,s,a,u){e.emplaceBack(t.x,t.y,(r.x<<1)+s,(r.y<<1)+a,u)}function Kp(e,t,r){e.emplaceBack(t.x,t.y,t.z,16384*r[0],16384*r[1],16384*r[2])}class YI{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class JI{constructor(){this.centroidXY=new H(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new H(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new H(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new H(this.max.x-this.min.x,this.max.y-this.min.y)}}class KI{constructor(){this.acc=new H(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,r){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=r.x,t.min.y=t.max.y=r.y)}appendEdge(t,r,s){this.accCount++,this.acc._add(r);let a=!!this.borders;r.x<t.min.x?(t.min.x=r.x,a=!0):r.x>t.max.x&&(t.max.x=r.x,a=!0),r.y<t.min.y?(t.min.y=r.y,a=!0):r.y>t.max.y&&(t.max.y=r.y,a=!0),((0===r.x||r.x===$t)&&r.x===s.x)!=((0===r.y||r.y===$t)&&r.y===s.y)&&this.processBorderOverlap(r,s),a&&this.checkBorderIntersection(r,s)}checkBorderIntersection(t,r){r.x<0!=t.x<0&&this.addBorderIntersection(0,An(r.y,t.y,(0-r.x)/(t.x-r.x))),r.x>$t!=t.x>$t&&this.addBorderIntersection(1,An(r.y,t.y,($t-r.x)/(t.x-r.x))),r.y<0!=t.y<0&&this.addBorderIntersection(2,An(r.x,t.x,(0-r.y)/(t.y-r.y))),r.y>$t!=t.y>$t&&this.addBorderIntersection(3,An(r.x,t.x,($t-r.y)/(t.y-r.y)))}addBorderIntersection(t,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[t];r<s[0]&&(s[0]=r),r>s[1]&&(s[1]=r)}processBorderOverlap(t,r){if(t.x===r.x){if(t.y===r.y)return;const s=0===t.x?0:1;this.addBorderIntersection(s,r.y),this.addBorderIntersection(s,t.y)}else{const s=0===t.y?2:3;this.addBorderIntersection(s,r.x),this.addBorderIntersection(s,t.x)}}centroid(){return 0===this.accCount?new H(0,0):new H(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,r)=>t+ +(r[0]!==Number.MAX_VALUE),0):0}}function QI(e,t){const r=e.add(t)._unit(),s=At(e.x*r.x+e.y*r.y,-1,1);var a,u,c;return a=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(a)))/4*o2*((u=e).x*(c=t).y-u.y*c.x<0?-1:1)}const q1=[e=>e.x<0,e=>e.x>$t,e=>e.y<0,e=>e.y>$t];function Rg(e,t,r,s){const a=[4];if(0===s)return a;r._mult(s);const u=e.sub(r),c=t.sub(r),p=[e,t,u,c];for(let g=0;g<4;g++)for(const y of p)if(q1[g](y)){a.push(g);break}return a}class tC{constructor(t){this.vertexArray=new y_,this.indexArray=new ea,this.programConfigurations=new ff(t.layers,t.zoom,r=>ph.includes(r)),this._segments=new Ui,this.hiddenByLandmarkVertexArray=new Nm,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Ui}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(t,r,s,a=!1){const u=t.length;if(u>2){let c=Math.max(0,this._segments.get().length-1);const p=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[c].length);let g;c!==this._segments.get().length-1&&(c++,this._segmentToGroundQuads[c]=[],this._segmentToRegionTriCounts[c]=[0,0,0,0,0]);{const y=t[0],x=t[1];g=QI(y.sub(t[u-1])._perp()._unit(),x.sub(y)._perp()._unit())}for(let y=0;y<u;y++){const x=y===u-1?0:y+1,E=t[y],S=t[x],M=t[x===u-1?0:x+1],D=S.sub(E)._perp()._unit(),P=QI(D,M.sub(S)._perp()._unit()),O=g,R=P;if(Vy(E,S,r)||a&&Ng(E,r)&&Ng(S,r)){g=P;continue}const B=p.vertexLength;Og(this.vertexArray,E,S,1,1,O),Og(this.vertexArray,E,S,1,0,O),Og(this.vertexArray,E,S,0,1,R),Og(this.vertexArray,E,S,0,0,R),p.vertexLength+=4;const j=Rg(E,S,D,s);for(const V of j)this._segmentToGroundQuads[c].push({id:B,region:V}),this._segmentToRegionTriCounts[c][V]+=2,p.primitiveLength+=2;g=P}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),r=t.length;for(let s=0;s<r;s++)this._segmentToGroundQuads[s].sort((a,u)=>a.region-u.region);for(let s=0;s<r;s++){const a=this._segmentToGroundQuads[s],u=t[s],c=this._segmentToRegionTriCounts[s];c.reduce((g,y)=>g+y,0);let p=0;for(let g=0;g<=4;g++){const y=c[g];if(0!==y){let x=this.regionSegments[g];x||(x=this.regionSegments[g]=new Ui);const E={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+p,vertexLength:u.vertexLength,primitiveLength:y};x.get().push(E)}p+=y}for(let g=0;g<a.length;g++){const y=a[g].id;this.indexArray.emplaceBack(y,y+1,y+3),this.indexArray.emplaceBack(y,y+3,y+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,r,s,a,u,c){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,r,s,a,u,c)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,KT.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,r,s,a,u,c){this.hasData()&&this.programConfigurations.updatePaintArrays(t,r,s,a,u,c)}updateHiddenByLandmark(t){if(!this.hasData())return;const r=t.groundVertexCount+t.groundVertexArrayOffset;if(0===t.groundVertexCount)return;const s=t.flags&Na?1:0;for(let a=t.groundVertexArrayOffset;a<r;++a)this.hiddenByLandmarkVertexArray.emplace(a,s);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,TE.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const r=this.regionSegments[t];r&&r.destroy()}}}}class Qp{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ea,this.footprintVertices=new hu,this.footprintSegments=[],this.layoutVertexArray=new $f,this.centroidVertexArray=new zm,this.indexArray=new ea,this.programConfigurations=new ff(t.layers,t.zoom,r=>XI.includes(r)),this.segments=new Ui,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new tC(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(t,r,s,a){this.features=[],this.hasPattern=SE("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=sg(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:u,id:c,index:p,sourceLayerIndex:g}of t){const y=this.layers[0]._featureFilter.needGeometry,x=ih(u,y);if(!this.layers[0]._featureFilter.filter(new ss(this.zoom),x,s))continue;const E={id:c,sourceLayerIndex:g,index:p,geometry:y?x.geometry:Rc(u,s,a),properties:u.properties,type:u.type,patterns:{}},S=this.layoutVertexArray.length;this.hasPattern?this.features.push(Qv("fill-extrusion",this.layers,E,this.zoom,r)):this.addFeature(E,E.geometry,p,s,{},r.availableImages,a,r.brightness),r.featureIndex.insert(u,E.geometry,p,g,this.index,S)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,r,s,a,u,c){for(const p of this.features){const{geometry:g}=p;this.addFeature(p,g,p.index,r,s,a,u,c)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(t,r,s,a,u){const c=0!==Object.keys(t).length;if(c&&!this.stateDependentLayers.length)return;const p=c?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,r,p,s,a,u),this.groundEffect.update(t,r,p,s,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,tD),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,QT.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,ME.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,s,a,u,c,p,g){const y=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,x=[new H(0,0),new H($t,$t)],E=p.projection,S="globe"===E.name,M="Polygon"===WI[t.type],D=new KI;D.centroidDataIndex=this.centroidData.length;const P=new JI,O=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},a)<=0,R=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},a);P.height=R,P.vertexArrayOffset=this.layoutVertexArray.length,P.groundVertexArrayOffset=this.groundEffect.vertexArray.length,S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Hf);const B=Kv(r,500);for(let Q=B.length-1;Q>=0;Q--){const et=B[Q];(0===et.length||(j=et[0]).every(it=>it.x<=0)||j.every(it=>it.x>=$t)||j.every(it=>it.y<=0)||j.every(it=>it.y>=$t))&&B.splice(Q,1)}var j;let V;if(S)V=Z1(B,x,a);else{V=[];for(const Q of B)V.push({polygon:Q,bounds:x})}const U=M?this.edgeRadius:0,G=U>0&&this.zoom<17,Z=(Q,et)=>{if(0===Q.length)return!1;const it=Q[Q.length-1];return et.x===it.x&&et.y===it.y};for(const{polygon:Q,bounds:et}of V){let it=0,yt=0;for(const Ut of Q)M&&!Ut[0].equals(Ut[Ut.length-1])&&Ut.push(Ut[0]),yt+=M?Ut.length-1:Ut.length;const xt=this.segments.prepareSegment((M?5:4)*yt,this.layoutVertexArray,this.indexArray);P.footprintSegIdx<0&&(P.footprintSegIdx=this.footprintSegments.length),P.polygonSegIdx<0&&(P.polygonSegIdx=this.polygonSegments.length);const Nt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ft=new YI;if(ft.vertexOffset=this.footprintVertices.length,ft.indexOffset=3*this.footprintIndices.length,ft.ringIndices=[],M){const Ut=[],Wt=[];it=xt.vertexLength;for(let Bt=0;Bt<Q.length;Bt++){const Zt=Q[Bt];Zt.length&&0!==Bt&&Wt.push(Ut.length/2);const ge=[];let be,xe;be=Zt[1].sub(Zt[0])._perp()._unit(),ft.ringIndices.push(Zt.length-1);for(let Re=1;Re<Zt.length;Re++){const ze=Zt[Re],$e=Zt[Re===Zt.length-1?1:Re+1],Ie=ze.clone();if(U){xe=$e.sub(ze)._perp()._unit();const on=be.add(xe)._unit(),vn=U*Math.min(4,1/(be.x*on.x+be.y*on.y));Ie.x+=vn*on.x,Ie.y+=vn*on.y,Ie.x=Math.round(Ie.x),Ie.y=Math.round(Ie.y),be=xe}!O||0!==U&&!G||Z(ge,Ie)||ge.push(Ie),Jl(this.layoutVertexArray,Ie.x,Ie.y,0,0,1,1,0),xt.vertexLength++,this.footprintVertices.emplaceBack(ze.x,ze.y),Ut.push(ze.x,ze.y),S&&Kp(this.layoutVertexExtArray,E.projectTilePoint(Ie.x,Ie.y,a),E.upVector(a,Ie.x,Ie.y))}O&&(0===U||G)&&(0!==ge.length&&Z(ge,ge[0])&&ge.pop(),this.groundEffect.addData(ge,et,y))}const le=dg(Ut,Wt);for(let Bt=0;Bt<le.length;Bt+=3)this.footprintIndices.emplaceBack(ft.vertexOffset+le[Bt+0],ft.vertexOffset+le[Bt+1],ft.vertexOffset+le[Bt+2]),this.indexArray.emplaceBack(it+le[Bt],it+le[Bt+2],it+le[Bt+1]),xt.primitiveLength++;ft.indexCount+=le.length,ft.vertexCount+=this.footprintVertices.length-ft.vertexOffset}for(let Ut=0;Ut<Q.length;Ut++){const Wt=Q[Ut];D.startRing(P,Wt[0]);let le=Wt.length>4&&nC(Wt[Wt.length-2],Wt[0],Wt[1]),Bt=U?s2(Wt[Wt.length-2],Wt[0],Wt[1],U):0;const Zt=[];let ge,be,xe;be=Wt[1].sub(Wt[0])._perp()._unit();let Re=!0;for(let ze=1,$e=0;ze<Wt.length;ze++){let Ie=Wt[ze-1],on=Wt[ze];const vn=Wt[ze===Wt.length-1?1:ze+1];if(D.appendEdge(P,on,Ie),Vy(on,Ie,et)){U&&(be=vn.sub(on)._perp()._unit(),Re=!Re);continue}const xn=on.sub(Ie)._perp(),Cn=xn.x/(Math.abs(xn.x)+Math.abs(xn.y)),Mn=xn.y>0?1:0,hr=Ie.dist(on);if($e+hr>32768&&($e=0),U){xe=vn.sub(on)._perp()._unit();let fr=$1(Ie,on,vn,eC(be,xe),U);isNaN(fr)&&(fr=0);const ir=on.sub(Ie)._unit();Ie=Ie.add(ir.mult(Bt))._round(),on=on.add(ir.mult(-fr))._round(),Bt=fr,be=xe,O&&this.zoom>=17&&(Z(Zt,Ie)||Zt.push(Ie),Z(Zt,on)||Zt.push(on))}const qn=xt.vertexLength,xi=Wt.length>4&&nC(Ie,on,vn);let Xr=H1($e,le,Re);if(Jl(this.layoutVertexArray,Ie.x,Ie.y,Cn,Mn,0,0,Xr),Jl(this.layoutVertexArray,Ie.x,Ie.y,Cn,Mn,0,1,Xr),$e+=hr,Xr=H1($e,xi,!Re),le=xi,Jl(this.layoutVertexArray,on.x,on.y,Cn,Mn,0,0,Xr),Jl(this.layoutVertexArray,on.x,on.y,Cn,Mn,0,1,Xr),xt.vertexLength+=4,this.indexArray.emplaceBack(qn+0,qn+1,qn+2),this.indexArray.emplaceBack(qn+1,qn+3,qn+2),xt.primitiveLength+=2,U){const fr=it+(1===ze?Wt.length-2:ze-2),ir=1===ze?it:fr+1;if(this.indexArray.emplaceBack(qn+1,fr,qn+3),this.indexArray.emplaceBack(fr,ir,qn+3),xt.primitiveLength+=2,void 0===ge&&(ge=qn),!Vy(vn,Wt[ze],et)){const Wn=ze===Wt.length-1?ge:xt.vertexLength;this.indexArray.emplaceBack(qn+2,qn+3,Wn),this.indexArray.emplaceBack(qn+3,Wn+1,Wn),this.indexArray.emplaceBack(qn+3,ir,Wn+1),xt.primitiveLength+=3}Re=!Re}if(S){const fr=this.layoutVertexExtArray,ir=E.projectTilePoint(Ie.x,Ie.y,a),Wn=E.projectTilePoint(on.x,on.y,a),Yr=E.upVector(a,Ie.x,Ie.y),ai=E.upVector(a,on.x,on.y);Kp(fr,ir,Yr),Kp(fr,ir,Yr),Kp(fr,Wn,ai),Kp(fr,Wn,ai)}}M&&(it+=Wt.length-1),O&&U&&this.zoom>=17&&(0!==Zt.length&&Z(Zt,Zt[0])&&Zt.pop(),this.groundEffect.addData(Zt,et,y,U>0))}this.footprintSegments.push(ft),Nt.triangleCount=this.indexArray.length-Nt.triangleArrayOffset,this.polygonSegments.push(Nt),++P.footprintSegLen,++P.polygonSegLen}if(P.vertexCount=this.layoutVertexArray.length-P.vertexArrayOffset,P.groundVertexCount=this.groundEffect.vertexArray.length-P.groundVertexArrayOffset,0!==P.vertexCount){if(P.centroidXY=D.borders?zc:this.encodeCentroid(D,P),this.centroidData.push(P),D.borders){this.featuresOnBorder.push(D);const Q=this.featuresOnBorder.length-1;for(let et=0;et<D.borders.length;et++)D.borders[et][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[et].push(Q)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,u,c,a,g),this.groundEffect.addPaintPropertiesData(t,s,u,c,a,g),this.maxHeight=Math.max(this.maxHeight,R)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((r,s)=>this.featuresOnBorder[r].borders[t][0]-this.featuresOnBorder[s].borders[t][0])}splitToSubtiles(){const t=[];for(let p=0;p<this.centroidData.length;p++){const g=this.centroidData[p],y=+(g.min.y+g.max.y>$t),x=2*y+(+(g.min.x+g.max.x>$t)^y);for(let E=0;E<g.polygonSegLen;E++){const S=g.polygonSegIdx+E;t.push({centroidIdx:p,subtile:x,polygonSegmentIdx:S,triangleSegmentIdx:this.polygonSegments[S].triangleSegIdx})}}const r=new ea;t.sort((p,g)=>p.triangleSegmentIdx===g.triangleSegmentIdx?p.subtile-g.subtile:p.triangleSegmentIdx-g.triangleSegmentIdx);let s=0,a=0,u=0;for(const p of t){if(p.triangleSegmentIdx!==s)break;u++}const c=t.length;for(;a!==t.length;){s=t[a].triangleSegmentIdx;let p=0,g=a,y=a;for(let x=g;x<u&&t[x].subtile===p;x++)y++;for(;g!==u;){const x=t[g];p=x.subtile;const E=this.centroidData[x.centroidIdx].min.clone(),S=this.centroidData[x.centroidIdx].max.clone(),M={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let D=g;D<y;D++){const P=t[D],O=this.polygonSegments[P.polygonSegmentIdx],R=this.centroidData[P.centroidIdx].min,B=this.centroidData[P.centroidIdx].max,j=this.indexArray.uint16;for(let V=O.triangleArrayOffset;V<O.triangleArrayOffset+O.triangleCount;V++)r.emplaceBack(j[3*V],j[3*V+1],j[3*V+2]);M.primitiveLength+=O.triangleCount,E.x=Math.min(E.x,R.x),E.y=Math.min(E.y,R.y),S.x=Math.max(S.x,B.x),S.y=Math.max(S.y,B.y)}M.primitiveLength>0&&this.triangleSubSegments.push({segment:M,min:E,max:S}),g=y;for(let D=g;D<u&&t[D].subtile===t[g].subtile;D++)y++}a=u;for(let x=a;x<c&&t[x].triangleSegmentIdx===t[a].triangleSegmentIdx;x++)u++}r._trim(),this.indexArray=r}getVisibleSegments(t,r,s){let a=0,u=0;const c=1<<t.canonical.z;if(r){const P=r.getMinMaxForTile(t);P&&(a=P.min,u=P.max)}u+=this.maxHeight;const p=t.toUnwrapped();let g;const y=[p.canonical.x/c+p.wrap,p.canonical.y/c],x=[(p.canonical.x+1)/c+p.wrap,(p.canonical.y+1)/c],E=new Ui,S=(P,O,R)=>[P[0]*(1-R[0])+O[0]*R[0],P[1]*(1-R[1])+O[1]*R[1]],M=[],D=[];for(const P of this.triangleSubSegments){M[0]=P.min.x/$t,M[1]=P.min.y/$t,D[0]=P.max.x/$t,D[1]=P.max.y/$t;const O=S(y,x,M),R=S(y,x,D);if(0===new Qi([O[0],O[1],a],[R[0],R[1],u]).intersectsPrecise(s)){g&&(E.segments.push(g),g=void 0);continue}const B=P.segment;g&&g.vertexOffset!==B.vertexOffset&&(E.segments.push(g),g=void 0),g?(g.vertexLength+=B.vertexLength,g.primitiveLength+=B.primitiveLength):g={vertexOffset:B.vertexOffset,primitiveLength:B.primitiveLength,vertexLength:B.vertexLength,primitiveOffset:B.primitiveOffset,sortKey:void 0,vaos:{}}}return g&&E.segments.push(g),E}encodeCentroid(t,r){const s=t.centroid(),a=r.span(),u=Math.min(7,Math.round(a.x*this.tileToMeter/10)),c=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new H(At(s.x,1,$t-1)<<3|u,At(s.y,1,$t-1)<<3|c)}showCentroid(t){const r=this.centroidData[t.centroidDataIndex];r.flags&=Na,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const r=t.vertexArrayOffset,s=t.vertexCount+t.vertexArrayOffset,a=t.flags&Na?zc:t.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==a.y||u!==a.x){for(let c=r;c<s;++c)this.centroidVertexArray.emplace(c,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const s=r.getReplacementRegionsForTile(t.toUnwrapped());if(function(u,c){if(u.length!==c.length)return!1;for(let p=0;p<u.length;p++)if(u[p].sourceId!==c[p].sourceId||!HI(u[p],c[p]))return!1;return!0}(this.activeReplacements,s))return;if(this.activeReplacements=s,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const u of this.centroidData)u.flags&=2147483647;const a=[];for(const u of this.activeReplacements){const c=Math.pow(2,u.footprintTileId.canonical.z-t.canonical.z);for(const p of this.centroidData)if(!(p.flags&Na||u.min.x>p.max.x||p.min.x>u.max.x||u.min.y>p.max.y||p.min.y>u.max.y))for(let g=0;g<p.footprintSegLen;g++){const y=this.footprintSegments[p.footprintSegIdx+g];if(a.length=0,a2(this.footprintVertices,y.vertexOffset,y.vertexCount,u.footprintTileId.canonical,t.canonical,a),G1(u.footprint,a,this.footprintIndices.uint16,y.indexOffset,y.indexCount,-y.vertexOffset,-c)){p.flags|=Na;break}}}for(const u of this.centroidData)this.writeCentroidToBuffer(u);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,r,s){let a=!1;for(let u=0;u<s.footprintSegLen;u++){const c=this.footprintSegments[s.footprintSegIdx+u];let p=0;for(const g of c.ringIndices){for(let y=p,x=g+p-1;y<g+p;x=y++){const E=this.footprintVertices.int16[2*(y+c.vertexOffset)+0],S=this.footprintVertices.int16[2*(y+c.vertexOffset)+1],M=this.footprintVertices.int16[2*(x+c.vertexOffset)+1];S>r!=M>r&&t<(this.footprintVertices.int16[2*(x+c.vertexOffset)+0]-E)*(r-S)/(M-S)+E&&(a=!a)}p=g}}return a}getHeightAtTileCoord(t,r){let s=Number.NEGATIVE_INFINITY,a=!0;const u=4*(t+$t)*$t+(r+$t);if(this.partLookup.hasOwnProperty(u)){const c=this.partLookup[u];return c?{height:c.height,hidden:!!(c.flags&Na)}:void 0}for(const c of this.centroidData)t>c.max.x||c.min.x>t||r>c.max.y||c.min.y>r||this.footprintContainsPoint(t,r,c)&&c&&c.height>s&&(s=c.height,this.partLookup[u]=c,a=!!(c.flags&Na));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:a};this.partLookup[u]=void 0}}function eC(e,t){const r=e.add(t)._unit();return e.x*r.x+e.y*r.y}function s2(e,t,r,s){const a=t.sub(e)._perp()._unit(),u=r.sub(t)._perp()._unit();return $1(e,t,r,eC(a,u),s)}function $1(e,t,r,s,a){const u=Math.sqrt(1-s*s);return Math.min(e.dist(t)/3,t.dist(r)/3,a*u/s)}function Vy(e,t,r){return e.x<r[0].x&&t.x<r[0].x||e.x>r[1].x&&t.x>r[1].x||e.y<r[0].y&&t.y<r[0].y||e.y>r[1].y&&t.y>r[1].y}function Ng(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function nC(e,t,r){if(e.x<0||e.x>=$t||t.x<0||t.x>=$t||r.x<0||r.x>=$t)return!1;const s=r.sub(t),a=s.perp(),u=e.sub(t);return(s.x*u.x+s.y*u.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(u.x*u.x+u.y*u.y))>-.866&&a.x*u.x+a.y*u.y<0}function H1(e,t,r){const s=t?2|e:-3&e;return r?1|s:-2&s}function Gy(){const e=Math.PI/32,t=Math.tan(e),r=ig;return r*Math.sqrt(1+2*t*t)-r}function Z1(e,t,r){const s=1<<r.z,a=pu(r.x/s),u=pu((r.x+1)/s),c=ws(r.y/s),p=ws((r.y+1)/s);return function(g,y,x,E,S=0,M){const D=[];if(!g.length||!x||!E)return D;const P=(G,Z)=>{for(const Q of G)D.push({polygon:Q,bounds:Z})},O=Math.ceil(Math.log2(x)),R=Math.ceil(Math.log2(E)),B=O-R,j=[];for(let G=0;G<Math.abs(B);G++)j.push(B>0?0:1);for(let G=0;G<Math.min(O,R);G++)j.push(0),j.push(1);let V=g;if(V=mg(V,y[0].y-S,y[1].y+S,1),V=mg(V,y[0].x-S,y[1].x+S,0),!V.length)return D;const U=[];for(j.length?U.push({polygons:V,bounds:y,depth:0}):P(V,y);U.length;){const G=U.pop(),Z=G.depth,Q=j[Z],et=G.bounds[0],it=G.bounds[1],yt=0===Q?et.x:et.y,xt=0===Q?it.x:it.y,Nt=M?M(Q,yt,xt):.5*(yt+xt),ft=mg(G.polygons,yt-S,Nt+S,Q),Ut=mg(G.polygons,Nt-S,xt+S,Q);if(ft.length){const Wt=[et,new H(0===Q?Nt:it.x,1===Q?Nt:it.y)];j.length>Z+1?U.push({polygons:ft,bounds:Wt,depth:Z+1}):P(ft,Wt)}if(Ut.length){const Wt=[new H(0===Q?Nt:et.x,1===Q?Nt:et.y),it];j.length>Z+1?U.push({polygons:Ut,bounds:Wt,depth:Z+1}):P(Ut,Wt)}}return D}(e,t,Math.ceil((u-a)/11.25),Math.ceil((c-p)/11.25),1,(g,y,x)=>{if(0===g)return.5*(y+x);{const E=ws((r.y+y/$t)/s);return(ba(.5*(ws((r.y+x/$t)/s)+E))*s-r.y)*$t}})}function a2(e,t,r,s,a,u){const c=Math.pow(2,s.z-a.z);for(let p=0;p<r;p++){let g=e.int16[2*(p+t)+0],y=e.int16[2*(p+t)+1];g=(g+a.x*$t)*c-s.x*$t,y=(y+a.y*$t)*c-s.y*$t,u.push(new H(g,y))}}Fn(Qp,"FillExtrusionBucket",{omit:["layers","features"]}),Fn(JI,"PartData"),Fn(YI,"FootprintSegment"),Fn(KI,"BorderCentroidData"),Fn(tC,"GroundEffect");const l2=new ys({visibility:new un(It["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new un(It["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var rC={paint:new ys({"fill-extrusion-opacity":new un(It["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Xn(It["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new un(It["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new un(It["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Xn(It["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Xn(It["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Xn(It["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new un(It["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new un(It["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new un(It["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new un(It["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new un(It["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new un(It["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new un(It["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new un(It["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Xn(It["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Xn(It["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new un(It["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new un(It["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new un(It["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new un(It["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new un(It["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:l2};class Sf extends H{constructor(t,r,s){super(t,r),this.z=s}}function tm(e,t){return e.x*t.x+e.y*t.y}function W1(e,t){if(1===e.length){let r=0;const s=t[r++];let a;for(;!a||s.equals(a);)if(a=t[r++],!a)return 1/0;for(;r<t.length;r++){const u=t[r],c=e[0],p=a.sub(s),g=u.sub(s),y=c.sub(s),x=tm(p,p),E=tm(p,g),S=tm(g,g),M=tm(y,p),D=tm(y,g),P=x*S-E*E,O=(S*M-E*D)/P,R=(x*D-E*M)/P,B=s.z*(1-O-R)+a.z*O+u.z*R;if(isFinite(B))return B}return 1/0}{let r=1/0;for(const s of t)r=Math.min(r,s.z);return r}}function X1(e,t,r,s,a,u,c,p){const g=c*a.getElevationAt(e,t,!0,!0),y=0!==u[0],x=y?0===u[1]?c*(u[0]/7-450):c*function(E,S,M){const D=Math.floor(S[0]/8),P=Math.floor(S[1]/8),O=10*(S[0]-8*D),R=10*(S[1]-8*P),B=E.getElevationAt(D,P,!0,!0),j=E.getMeterToDEM(M),V=Math.floor(.5*(O*j-1)),U=Math.floor(.5*(R*j-1)),G=E.tileCoordToPixel(D,P),Z=2*V+1,Q=2*U+1,et=(Bt=Z,Zt=Q,[(Ut=E).getElevationAtPixel(Wt=G.x-V,le=G.y-U,!0),Ut.getElevationAtPixel(Wt+Zt,le,!0),Ut.getElevationAtPixel(Wt,le+Zt,!0),Ut.getElevationAtPixel(Wt+Bt,le+Zt,!0)]),it=Math.abs(et[0]-et[1]),yt=Math.abs(et[2]-et[3]),xt=Math.abs(et[0]-et[2])+Math.abs(et[1]-et[3]),Nt=Math.min(.25,.5*j*(it+yt)/Z),ft=Math.min(.25,.5*j*xt/Q);var Ut,Wt,le,Bt,Zt;return B+Math.max(Nt*O,ft*R)}(a,u,p):g;return{base:g+(0===r)?-1:r,top:y?Math.max(x+s,g+r+2):g+s}}const iC=new ys({"line-cap":new Xn(It.layout_line["line-cap"]),"line-join":new Xn(It.layout_line["line-join"]),"line-miter-limit":new un(It.layout_line["line-miter-limit"]),"line-round-limit":new un(It.layout_line["line-round-limit"]),"line-sort-key":new Xn(It.layout_line["line-sort-key"]),visibility:new un(It.layout_line.visibility)});var Y1={paint:new ys({"line-opacity":new Xn(It.paint_line["line-opacity"]),"line-color":new Xn(It.paint_line["line-color"]),"line-translate":new un(It.paint_line["line-translate"]),"line-translate-anchor":new un(It.paint_line["line-translate-anchor"]),"line-width":new Xn(It.paint_line["line-width"]),"line-gap-width":new Xn(It.paint_line["line-gap-width"]),"line-offset":new Xn(It.paint_line["line-offset"]),"line-blur":new Xn(It.paint_line["line-blur"]),"line-dasharray":new Xn(It.paint_line["line-dasharray"]),"line-pattern":new Xn(It.paint_line["line-pattern"]),"line-gradient":new Pm(It.paint_line["line-gradient"]),"line-trim-offset":new un(It.paint_line["line-trim-offset"]),"line-emissive-strength":new un(It.paint_line["line-emissive-strength"]),"line-border-width":new Xn(It.paint_line["line-border-width"]),"line-border-color":new Xn(It.paint_line["line-border-color"])}),layout:iC};const oC=(e,t,r,s,a,u,c)=>{const p=e.transform,g=p.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:aC(e,t,r,s),u_pixels_to_tile_units:g,u_device_pixel_ratio:u,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:uC(r)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:J1(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:c,u_emissive_strength:r.paint.get("line-emissive-strength")}},sC=(e,t,r,s,a)=>{const u=e.transform;return{u_matrix:aC(e,t,r,s),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:u.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:a,u_image:0,u_tile_units_to_pixels:J1(t,u),u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function J1(e,t){return 1/Pd(e,1,t.tileZoom)}function aC(e,t,r,s){return e.translatePosMatrix(s||t.tileID.projMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const lC=e=>{const t=[];uC(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const r=e.paint.get("line-trim-offset");return 0===r[0]&&0===r[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER"),t};function uC(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const cC=new class extends Xn{possiblyEvaluate(e,t){return t=new ss(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,r,s){return t=pe({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,r,s)}}(Y1.paint.properties["line-width"].specification);function hC(e,t){return t>0?t+2*e:e}cC.useIntegerZoom=!0;const u2=new ys({visibility:new un(It.layout_background.visibility)});var c2={paint:new ys({"background-color":new un(It.paint_background["background-color"]),"background-pattern":new un(It.paint_background["background-pattern"]),"background-opacity":new un(It.paint_background["background-opacity"]),"background-emissive-strength":new un(It.paint_background["background-emissive-strength"])}),layout:u2};const h2=new ys({visibility:new un(It.layout_raster.visibility)});var f2={paint:new ys({"raster-opacity":new un(It.paint_raster["raster-opacity"]),"raster-color":new Pm(It.paint_raster["raster-color"]),"raster-color-mix":new un(It.paint_raster["raster-color-mix"]),"raster-color-range":new un(It.paint_raster["raster-color-range"]),"raster-hue-rotate":new un(It.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new un(It.paint_raster["raster-brightness-min"]),"raster-brightness-max":new un(It.paint_raster["raster-brightness-max"]),"raster-saturation":new un(It.paint_raster["raster-saturation"]),"raster-contrast":new un(It.paint_raster["raster-contrast"]),"raster-resampling":new un(It.paint_raster["raster-resampling"]),"raster-fade-duration":new un(It.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new un(It.paint_raster["raster-emissive-strength"]),"raster-array-band":new un(It.paint_raster["raster-array-band"]),"raster-elevation":new un(It.paint_raster["raster-elevation"])}),layout:h2};function fC(e,t,r,s,a,u,c,p){const g=[e,r,a,t,s,u,1,1,1],y=[c,p,1],x=zl.adjoint([],g),[E,S,M]=Ot.transformMat3(y,y,zl.transpose(x,x));return zl.multiply(g,[E,0,0,0,S,0,0,0,M],g)}class dc extends Qn{constructor(t,r,s,a){super(),this.id=t,this.dispatcher=s,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=r,this._dirty=!1}load(t,r){if(this._loaded=r||!1,this.fire(new Se("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=Tn(this.map._requestManager.transformRequest(this.url,Kt.Image),(s,a)=>{if(this._imageRequest=null,this._loaded=!0,s)this.fire(new Oe(s));else if(a){const{HTMLImageElement:u}=rt;this.image=a instanceof u?or.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Up(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Se("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Up||this.texture.destroy()}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=t[0][1],s=t[0][1];for(const u of t)u[1]>s&&(s=u[1]),u[1]<r&&(r=u[1]);const a=(s+r)/2;if(a>Ls?this.onNorthPole=!0:a<-Ls&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const u=t.map(ri.fromLngLat);this.tileID=function(c){let p=1/0,g=1/0,y=-1/0,x=-1/0;for(const D of c)p=Math.min(p,D.x),g=Math.min(g,D.y),y=Math.max(y,D.x),x=Math.max(x,D.y);const E=Math.max(y-p,x-g),S=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),M=Math.pow(2,S);return new Vu(S,Math.floor((p+y)/2*M),Math.floor((g+x)/2*M))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Se("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const g in this.tiles){const y=this.tiles[g];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}if(this._boundsArray)return;const r=xd(this.tileID,this.map.transform.projection),[s,a,u,c]=this.coordinates.map(g=>{const y=r.projection.project(g[0],g[1]);return Rp(r,y)._round()});this.perspectiveTransform=function(g,y,x,E,S,M,D,P,O,R){const B=fC(0,0,g,0,0,y,g,y),j=fC(x,E,S,M,D,P,O,R);return zl.multiply(j,zl.adjoint(B,B),j),[j[6]/j[8]*g/$t,j[7]/j[8]*y/$t]}(this.width,this.height,s.x,s.y,a.x,a.y,c.x,c.y,u.x,u.y);const p=this._boundsArray=new $f;p.emplaceBack(s.x,s.y,0,0),p.emplaceBack(a.x,a.y,$t,0),p.emplaceBack(c.x,c.y,0,$t),p.emplaceBack(u.x,u.y,$t,$t),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(p,Ly.members),this.boundsSegments=Ui.simpleSegment(0,0,4,2)}prepare(){const t=0!==Object.keys(this.tiles).length;if(this.tileID&&!t)return;const r=this.map.painter.context,s=r.gl;!this._dirty||this.texture instanceof Up||(this.texture?this.texture.update(this.image):(this.texture=new fs(r,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(r)}loadTile(t,r){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},r(null)):(t.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class d2 extends $l{constructor(t){super(t,{}),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(t){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}const p2=new ys({visibility:new un(It.layout_sky.visibility)});var m2={paint:new ys({"sky-type":new un(It.paint_sky["sky-type"]),"sky-atmosphere-sun":new un(It.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new un(It.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new un(It.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new un(It.paint_sky["sky-gradient-radius"]),"sky-gradient":new Pm(It.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new un(It.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new un(It.paint_sky["sky-atmosphere-color"]),"sky-opacity":new un(It.paint_sky["sky-opacity"])}),layout:p2};function K1(e,t,r){const s=[0,0,1],a=Ha.identity([]);return Ha.rotateY(a,a,r?-St(e)+Math.PI:St(e)),Ha.rotateX(a,a,-St(t)),Ot.transformQuat(s,s,a),Ot.normalize(s,s)}var g2={paint:new ys({})};const _2={circle:class extends $l{constructor(e,t){super(e,GT,t)}createBucket(e){return new J_(e)}queryRadius(e){const t=e;return jh("circle-radius",this,t)+jh("circle-stroke-width",this,t)+uc(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,r,s,a,u,c,p){const g=ny(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,e.pixelToTileUnitsFactor),y=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return xE(e,s,u,c,p,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),g,y)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){const r=vE(this);return{config:new Jf(this,t),defines:r,overrideFog:!1}}},heatmap:class extends $l{createBucket(e){return new Gv(e)}constructor(e,t){super(e,oy,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=sy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return jh("heatmap-radius",this,e)}queryIntersectsFeature(e,t,r,s,a,u,c,p){const g=this.paint.get("heatmap-radius").evaluate(t,r);return xE(e,s,u,c,p,!0,!0,new H(0,0),g)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return"heatmap"===e?{config:new Jf(this,t),overrideFog:!1}:{}}},hillshade:class extends $l{constructor(e,t){super(e,$v,t)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends $l{constructor(e,t){super(e,xp,t)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(e,t){return{config:new Jf(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new fd(e)}queryRadius(){return uc(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,r,s,a,u){return!e.queryGeometry.isAboveHorizon&&jT(sd(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,e.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends $l{constructor(e,t){super(e,rC,t),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new Qp(e)}queryRadius(){return uc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,r,s,a,u,c,p,g){const y=ny(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,e.pixelToTileUnitsFactor),x=this.paint.get("fill-extrusion-height").evaluate(t,r),E=this.paint.get("fill-extrusion-base").evaluate(t,r),S=[0,0],M=p&&u.elevation,D=u.elevation?u.elevation.exaggeration():1,P=e.tile.getBucket(this);if(M&&P instanceof Qp){const V=P.centroidVertexArray,U=g+1;U<V.length&&(S[0]=V.geta_centroid_pos0(U),S[1]=V.geta_centroid_pos1(U))}if(0===S[0]&&1===S[1])return!1;"globe"===u.projection.name&&(s=Z1([s],[new H(0,0),new H($t,$t)],e.tileID.canonical).map(V=>V.polygon).flat());const O=M?p:null,[R,B]=(U=s,G=E,Z=x,Q=y,et=c,it=O,yt=S,xt=D,Nt=u.center.lat,"globe"===(V=u).projection.name?function(Ut,Wt,le,Bt,Zt,ge,be,xe,Re,ze,$e){const Ie=[],on=[],vn=Ut.projection.upVectorScale($e,Ut.center.lat,Ut.worldSize).metersToTile,xn=[0,0,0,1],Cn=[0,0,0,1],Mn=(qn,xi,Xr,fr)=>{qn[0]=xi,qn[1]=Xr,qn[2]=fr,qn[3]=1},hr=Gy();le>0&&(le+=hr),Bt+=hr;for(const qn of Wt){const xi=[],Xr=[];for(const fr of qn){const ir=fr.x+Zt.x,Wn=fr.y+Zt.y,Yr=Ut.projection.projectTilePoint(ir,Wn,$e),ai=Ut.projection.upVector($e,fr.x,fr.y);let Pr=le,Ci=Bt;if(be){const Ds=X1(ir,Wn,le,Bt,be,xe,Re,ze);Pr+=Ds.base,Ci+=Ds.top}0!==le?Mn(xn,Yr.x+ai[0]*vn*Pr,Yr.y+ai[1]*vn*Pr,Yr.z+ai[2]*vn*Pr):Mn(xn,Yr.x,Yr.y,Yr.z),Mn(Cn,Yr.x+ai[0]*vn*Ci,Yr.y+ai[1]*vn*Ci,Yr.z+ai[2]*vn*Ci),Ot.transformMat4(xn,xn,ge),Ot.transformMat4(Cn,Cn,ge),xi.push(new Sf(xn[0],xn[1],xn[2])),Xr.push(new Sf(Cn[0],Cn[1],Cn[2]))}Ie.push(xi),on.push(Xr)}return[Ie,on]}(V,U,G,Z,Q,et,it,yt,xt,Nt,e.tileID.canonical):it?function(Ut,Wt,le,Bt,Zt,ge,be,xe,Re){const ze=[],$e=[],Ie=[0,0,0,1];for(const on of Ut){const vn=[],xn=[];for(const Cn of on){const Mn=Cn.x+Bt.x,hr=Cn.y+Bt.y,qn=X1(Mn,hr,Wt,le,ge,be,xe,Re);Ie[0]=Mn,Ie[1]=hr,Ie[2]=qn.base,Ie[3]=1,Oi.transformMat4(Ie,Ie,Zt),Ie[3]=Math.max(Ie[3],1e-5);const xi=new Sf(Ie[0]/Ie[3],Ie[1]/Ie[3],Ie[2]/Ie[3]);Ie[0]=Mn,Ie[1]=hr,Ie[2]=qn.top,Ie[3]=1,Oi.transformMat4(Ie,Ie,Zt),Ie[3]=Math.max(Ie[3],1e-5);const Xr=new Sf(Ie[0]/Ie[3],Ie[1]/Ie[3],Ie[2]/Ie[3]);vn.push(xi),xn.push(Xr)}ze.push(vn),$e.push(xn)}return[ze,$e]}(U,G,Z,Q,et,it,yt,xt,Nt):function(Ut,Wt,le,Bt,Zt){const ge=[],be=[],xe=Zt[8]*Wt,Re=Zt[9]*Wt,ze=Zt[10]*Wt,$e=Zt[11]*Wt,Ie=Zt[8]*le,on=Zt[9]*le,vn=Zt[10]*le,xn=Zt[11]*le;for(const Cn of Ut){const Mn=[],hr=[];for(const qn of Cn){const xi=qn.x+Bt.x,Xr=qn.y+Bt.y,fr=Zt[0]*xi+Zt[4]*Xr+Zt[12],ir=Zt[1]*xi+Zt[5]*Xr+Zt[13],Wn=Zt[2]*xi+Zt[6]*Xr+Zt[14],Yr=Zt[3]*xi+Zt[7]*Xr+Zt[15],ai=fr+xe,Pr=ir+Re,Ci=Wn+ze,Ds=Math.max(Yr+$e,1e-5),ki=fr+Ie,Ro=ir+on,Us=Wn+vn,Es=Math.max(Yr+xn,1e-5);Mn.push(new Sf(ai/Ds,Pr/Ds,Ci/Ds)),hr.push(new Sf(ki/Es,Ro/Es,Us/Es))}ge.push(Mn),be.push(hr)}return[ge,be]}(U,G,Z,Q,et)),j=e.queryGeometry;var V,U,G,Z,Q,et,it,yt,xt,Nt;return function(V,U,G){let Z=1/0;jT(G,U)&&(Z=W1(G,U[0]));for(let Q=0;Q<U.length;Q++){const et=U[Q],it=V[Q];for(let yt=0;yt<et.length-1;yt++){const xt=et[yt],Nt=[xt,et[yt+1],it[yt+1],it[yt],xt];zv(G,Nt)&&(Z=Math.min(Z,W1(G,Nt)))}}return Z!==1/0&&Z}(R,B,j.isPointQuery()?j.screenBounds:j.screenGeometry)}},line:class extends $l{constructor(e,t){super(e,Y1,t),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof zf,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=cC.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Py(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){const r=lC(this);return{config:new Jf(this,t),defines:r,overrideFog:!1}}queryRadius(e){const t=e,r=hC(jh("line-width",this,t),jh("line-gap-width",this,t)),s=jh("line-offset",this,t);return r/2+Math.abs(s)+uc(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,r,s,a,u){if(e.queryGeometry.isAboveHorizon)return!1;const c=sd(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,e.pixelToTileUnitsFactor),p=e.pixelToTileUnitsFactor/2*hC(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),g=this.paint.get("line-offset").evaluate(t,r);return g&&(s=function(y,x){const E=[],S=new H(0,0);for(let M=0;M<y.length;M++){const D=y[M],P=[];for(let O=0;O<D.length;O++){const R=D[O],B=D[O+1],j=0===O?S:R.sub(D[O-1])._unit()._perp(),V=O===D.length-1?S:B.sub(R)._unit()._perp(),U=j._add(V)._unit();U._mult(1/(U.x*V.x+U.y*V.y)),P.push(U._mult(x)._add(R))}E.push(P)}return E}(s,g*e.pixelToTileUnitsFactor)),function(y,x,E){for(let S=0;S<x.length;S++){const M=x[S];if(y.length>=3)for(let D=0;D<M.length;D++)if(_f(y,M[D]))return!0;if(Bv(y,M,E))return!0}return!1}(c,s,p)}isTileClipped(){return!0}},symbol:Cg,background:class extends $l{constructor(e,t){super(e,c2,t)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:class extends $l{constructor(e,t){super(e,f2,t),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(e){return!(e&&e._source instanceof dc)||!e._source.onNorthPole&&!e._source.onSouthPole&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-color"].value.expression,[t,r]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=sy({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:t,end:r}],resolution:256}),this.colorRampTexture=null}},sky:class extends $l{constructor(e,t){super(e,m2,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=sy({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),a=!s,u=e.style.light,c=u.properties.get("position");return a&&"viewport"===u.properties.get("anchor")&&Gt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?K1(c.azimuthal,90-c.polar,t):K1(s[0],90-s[1],t)}const r=this.paint.get("sky-gradient-center");return K1(r[0],90-r[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends $l{constructor(e,t){super(e,g2)}},model:class extends $l{constructor(e,t){super(e,QD,t)}createBucket(e){return new JD(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof Th}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function qy(e,t){return"custom"===e.type?new d2(e):new _2[e.type](e,t)}function dC(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class pC extends Qn{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new Hs({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,r){if(this.loaded[r]!==t&&(this.loaded[r]=t,t)){for(const{ids:s,callback:a}of this.requestors)this._notify(s,r,a);this.requestors=[]}}hasImage(t,r){return!!this.getImage(t,r)}getImage(t,r){return this.images[r][t]}addImage(t,r,s){this._validate(t,s)&&(this.images[r][t]=s)}_validate(t,r){let s=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new Oe(new Error(`Image "${t}" has invalid "stretchX" value`))),s=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new Oe(new Error(`Image "${t}" has invalid "stretchY" value`))),s=!1),this._validateContent(r.content,r)||(this.fire(new Oe(new Error(`Image "${t}" has invalid "content" value`))),s=!1),s}_validateStretch(t,r){if(!t)return!0;let s=0;for(const a of t){if(a[0]<s||a[1]<a[0]||r<a[1])return!1;s=a[1]}return!0}_validateContent(t,r){return!(t&&(4!==t.length||t[0]<0||r.data.width<t[0]||t[1]<0||r.data.height<t[1]||t[2]<0||r.data.width<t[2]||t[3]<0||r.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,r,s){s.version=this.images[r][t].version+1,this.images[r][t]=s,this.updatedImages[r][t]=!0}removeImage(t,r){const s=this.images[r][t];delete this.images[r][t],delete this.patterns[r][t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,r,s){let a=!0;const u=!!this.loaded[r];if(!u)for(const c of t)this.images[r][c]||(a=!1);u||a?this._notify(t,r,s):this.requestors.push({ids:t,scope:r,callback:s})}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,r,s){const a={};for(const u of t){this.images[r][u]||this.fire(new Se("styleimagemissing",{id:u}));const c=this.images[r][u];c?a[u]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,hasRenderCallback:!(!c.userImage||!c.userImage.render)}:Gt(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,a)}getPixelSize(t){const{width:r,height:s}=this.atlasImage[t];return{width:r,height:s}}getPattern(t,r){const s=this.patterns[r][t],a=this.getImage(t,r);if(!a)return null;if(s&&s.position.version===a.version)return s.position;if(s)s.position.version=a.version;else{const u={w:a.data.width+2,h:a.data.height+2,x:0,y:0},c=new m1(u,a);this.patterns[r][t]={bin:u,position:c}}return this._updatePatternAtlas(r),this.patterns[r][t].position}bind(t,r){const s=t.gl;let a=this.atlasTexture[r];a?this.dirty&&(a.update(this.atlasImage[r]),this.dirty=!1):(a=new fs(t,this.atlasImage[r],s.RGBA),this.atlasTexture[r]=a),a.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(t){const r=[];for(const c in this.patterns[t])r.push(this.patterns[t][c].bin);const{w:s,h:a}=by(r),u=this.atlasImage[t];u.resize({width:s||1,height:a||1});for(const c in this.patterns[t]){const{bin:p}=this.patterns[t][c],g=p.x+1,y=p.y+1,x=this.images[t][c].data,E=x.width,S=x.height;Hs.copy(x,u,{x:0,y:0},{x:g,y},{width:E,height:S}),Hs.copy(x,u,{x:0,y:S-1},{x:g,y:y-1},{width:E,height:1}),Hs.copy(x,u,{x:0,y:0},{x:g,y:y+S},{width:E,height:1}),Hs.copy(x,u,{x:E-1,y:0},{x:g-1,y},{width:1,height:S}),Hs.copy(x,u,{x:0,y:0},{x:g+E,y},{width:1,height:S})}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,r){for(const s of t){if(this.callbackDispatchedThisFrame[r][s])continue;this.callbackDispatchedThisFrame[r][s]=!0;const a=this.images[r][s];dC(a)&&this.updateImage(s,r,a)}}}const mC=new ys({anchor:new un(It.light.anchor),position:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return We(e.expression.evaluate(t))}interpolate(e,t,r){return{x:An(e.x,t.x,r),y:An(e.y,t.y,r),z:An(e.z,t.z,r),azimuthal:An(e.azimuthal,t.azimuthal,r),polar:An(e.polar,t.polar,r)}}}(It.light.position),color:new un(It.light.color),intensity:new un(It.light.intensity)});class Q1 extends Qn{constructor(t,r="flat"){super(),this._transitionable=new Am(mC),this.setLight(t,r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r,s={}){this._validate(uT,t,s)||(this._transitionable.setTransitionOrValue(t),this.id=r)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,s){return(!s||!1!==s.validate)&&Tm(this,t.call(Ah,pe({value:r,style:{glyphs:!0,sprite:!0},styleSpec:It})))}}const gC=new ys({source:new un(It.terrain.source),exaggeration:new un(It.terrain.exaggeration)});let _C=class extends Qn{constructor(e,t,r,s){super(),this.scope=r,this._transitionable=new Am(gC,s),this._transitionable.setTransitionOrValue(e,s),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(e){return this._transitioning.possiblyEvaluate(new ss(e)).get("exaggeration")}isZoomDependent(){const e=this._transitionable._values.exaggeration;return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof Th}};const tx=45,ex=65,Mf=.05;function Fg(e,t,r,s){const a=ne(tx,ex,r),[u,c]=nx(e,s);let p=1-Math.min(1,Math.exp((t-u)/(c-u)*-6));return p*=p*p,p=Math.min(1,1.00747*p),p*a*e.alpha}function nx(e,t){const r=.5/Math.tan(.5*t);return[e.range[0]+r,e.range[1]+r]}function Tf(e,t,r,s,a){const u=Ot.transformMat4([],[t,r,s],a.mercatorFogMatrix);return Fg(e,Ot.length(u),a.pitch,a._fov)}function yC(e,t,r,s,a,u,c){const p=[[r,s,0],[a,s,0],[a,u,0],[r,u,0]];let g=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(const x of p){const E=Ot.transformMat4([],x,t),S=Ot.length(E);g=Math.min(g,S),y=Math.max(y,S)}return[Fg(e,g,c.pitch,c._fov),Fg(e,y,c.pitch,c._fov)]}const y2=new ys({range:new un(It.fog.range),color:new un(It.fog.color),"high-color":new un(It.fog["high-color"]),"space-color":new un(It.fog["space-color"]),"horizon-blend":new un(It.fog["horizon-blend"]),"star-intensity":new un(It.fog["star-intensity"]),"vertical-range":new un(It.fog["vertical-range"])});class em extends Qn{constructor(t,r){super(),this._transitionable=new Am(y2),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=r}get state(){const t=this._transform,r="globe"===t.projection.name,s=da(t.zoom),a=this.properties.get("range"),u=[.5,3];return{range:r?[An(u[0],a[0],s),An(u[1],a[1],s)]:a,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,r={}){if(this._validate(ku,t,r))return;const s=pe({},t);for(const a of Object.keys(It.fog))void 0===s[a]&&(s[a]=It.fog[a].default);this._transitionable.setTransitionOrValue(s)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:ne(tx,ex,t))*r.a}getOpacityAtLatLng(t,r){return this._transform.projection.supportsFog?function(s,a,u){const c=ri.fromLngLat(a),p=u.elevation?u.elevation.getAtPointOrZero(c):0;return Tf(s,c.x,c.y,p,u)}(this.state,t,r):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const r=this._transform.calculateFogTileMatrix(t.toUnwrapped());return yC(this.state,r,0,0,$t,$t,this._transform)}getOpacityForBounds(t,r,s,a,u){return this._transform.projection.supportsFog?yC(this.state,t,r,s,a,u,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?nx(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const r=[4,5,6,7];for(const s of r){const a=t.points[s];let u;if(a[2]>=0)u=a;else{const c=t.points[s-4];u=$n(c,a,c[2]/(c[2]-a[2]))}if(Tf(this.state,u[0],u[1],0,this._transform)>=Mf)return!0}return!1}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,s){return(!s||!1!==s.validate)&&Tm(this,t.call(Ah,pe({value:r,style:{glyphs:!0,sprite:!0},styleSpec:It})))}}class iO{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Kl{constructor(){this.tasks={},this.taskQueue=[],hn(["process"],this),this.invoker=new iO(this.process),this.nextId=0}add(t,r){const s=this.nextId++,a=function({type:u,isSymbolTile:c,zoom:p}){return p=p||0,"message"===u?0:"maybePrepare"!==u||c?"parseTile"!==u||c?"parseTile"===u&&c?300-p:"maybePrepare"===u&&c?400-p:500:200-p:100-p}(r);if(0===a){rn();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:t,metadata:r,priority:a,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){rn();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const r=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let t=null,r=1/0;for(let a=0;a<this.taskQueue.length;a++){const u=this.tasks[this.taskQueue[a]];u.priority<r&&(r=u.priority,t=a)}if(null===t)return null;const s=this.taskQueue[t];return this.taskQueue.splice(t,1),s}remove(){this.invoker.remove()}}class v2{constructor(t,r,s){this.target=t,this.parent=r,this.mapId=s,this.callbacks={},this.cancelCallbacks={},hn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Kl}send(t,r,s,a,u=!1,c){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=c,this.callbacks[p]=s);const g=new Set;return this.target.postMessage({id:p,type:t,hasCallback:!!s,targetMapId:a,mustQueue:u,sourceMapId:this.mapId,data:rp(r,g)},g),{cancel:()=>{s&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(t){const r=t.data,s=r.id;if(s&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const a=this.cancelCallbacks[s];delete this.cancelCallbacks[s],a&&a.cancel()}else if(r.mustQueue||rn()){const a=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,r),a&&a.metadata||{type:"message"})}else this.processTask(s,r)}processTask(t,r){if("<response>"===r.type){const s=this.callbacks[t];delete this.callbacks[t],s&&(r.error?s(Vf(r.error)):s(null,Vf(r.data)))}else{const s=new Set,a=r.hasCallback?(c,p)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:c?rp(c):null,data:rp(p,s)},s)}:c=>{},u=Vf(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,u,a);else if(this.parent.getWorkerSource){const c=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,c[0],u.source,u.scope)[c[1]](u,a)}else a(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let kg=(()=>{class e{constructor(r,s){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=On();const a=this.workerPool.acquire(this.id);for(let u=0;u<a.length;u++){const c=new e.Actor(a[u],s,this.id);c.name=`Worker ${u}`,this.actors.push(c)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,s,a){Le(this.actors,(u,c)=>{u.send(r,s,c)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}return e.Actor=v2,e})();class rx extends Qn{constructor(t,r,s,a){super(),this.scope=s,this._options=t,this.properties=new qf(r),this._transitionable=new Am(r,new Map(a)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,r){this._options=t,this._transitionable.setTransitionOrValue(t.properties,r)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const oO=new ys({color:new un(It.properties_light_ambient.color),intensity:new un(It.properties_light_ambient.intensity)}),Bs=new ys({direction:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function([r,s]){const a=We([1,r,s]);return{x:a.x,y:a.y,z:a.z}}(e.expression.evaluate(t))}interpolate(e,t,r){return{x:An(e.x,t.x,r),y:An(e.y,t.y,r),z:An(e.z,t.z,r)}}}(It.properties_light_directional.direction),color:new un(It.properties_light_directional.color),intensity:new un(It.properties_light_directional.intensity),"cast-shadows":new un(It.properties_light_directional["cast-shadows"]),"shadow-intensity":new un(It.properties_light_directional["shadow-intensity"])});class ix{constructor(t,r,s,a){this.screenBounds=t,this.cameraPoint=r,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=s,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,a)}static createFromScreenPoints(t,r){let s,a;if(t instanceof H||"number"==typeof t[0]){const u=H.convert(t);s=[u],a=r.isPointAboveHorizon(u)}else{const u=H.convert(t[0]),c=H.convert(t[1]);s=[u,c],a=Ft(u,c).every(p=>r.isPointAboveHorizon(p))}return new ix(s,r.getCameraPoint(),a,r)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return Ft(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const r=this.screenBounds[0],s=1===this.screenBounds.length?this.screenBounds[0].add(new H(1,1)):this.screenBounds[1],a=Ft(r,s,0,!1);return this.cameraPoint.y>s.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<s.x?a.splice(3,0,this.cameraPoint):this.cameraPoint.x>=s.x?a[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(a[3]=this.cameraPoint)),function(u,c){const p=[];for(let g=0;g<u.length;g++){const y=wt(g-1,-1,u.length-1),x=wt(g+1,-1,u.length-1),E=u[g],S=u[x],M=u[y].sub(E).unit(),D=S.sub(E).unit(),P=D.angleWithSep(M.x,M.y),O=M.add(D).unit().mult(-1*c/Math.sin(P/2));p.push(E.add(O))}return p}(a,t)}bufferedCameraGeometryGlobe(t){const r=this.screenBounds[0],s=1===this.screenBounds.length?this.screenBounds[0].add(new H(1,1)):this.screenBounds[1],a=Ft(r,s,t),u=this.cameraPoint.clone();switch(3*((u.y>r.y)+(u.y>s.y))+((u.x>r.x)+(u.x>s.x))){case 0:a[0]=u,a[4]=u.clone();break;case 1:a.splice(1,0,u);break;case 2:a[1]=u;break;case 3:a.splice(4,0,u);break;case 5:a.splice(2,0,u);break;case 6:a[3]=u;break;case 7:a.splice(3,0,u);break;case 8:a[2]=u}return a}containsTile(t,r,s,a=0){const u=t.queryPadding/r._pixelsPerMercatorPixel+1,c=s?this._bufferedCameraMercator(u,r):this._bufferedScreenMercator(u,r);let p=t.tileID.wrap+(c.unwrapped?a:0);const g=c.polygon.map(O=>Rp(t.tileTransform,O,p));if(!ty(g,0,0,$t,$t))return;p=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?a:0);const y=this.screenGeometryMercator.polygon.map(O=>y1(t.tileTransform,O,p)),x=y.map(O=>new H(O[0],O[1])),E=r.getFreeCameraOptions().position||new ri(0,0,0),S=y1(t.tileTransform,E,p),M=y.map(O=>{const R=Ot.sub(O,O,S);return Ot.normalize(R,R),new $_(S,R)}),D=Pd(t,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:x,tilespaceRays:M,bufferedTilespaceGeometry:g,bufferedTilespaceBounds:(P=en(g),P.min.x=At(P.min.x,0,$t),P.min.y=At(P.min.y,0,$t),P.max.x=At(P.max.x,0,$t),P.max.y=At(P.max.y,0,$t),P),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:D};var P}_bufferedScreenMercator(t,r){const s=Rd(t);if(this._screenRaycastCache[s])return this._screenRaycastCache[s];{let a;return a="globe"===r.projection.name?this._projectAndResample(this.bufferedScreenGeometry(t),r):{polygon:this.bufferedScreenGeometry(t).map(u=>r.pointCoordinate3D(u)),unwrapped:!0},this._screenRaycastCache[s]=a,a}}_bufferedCameraMercator(t,r){const s=Rd(t);if(this._cameraRaycastCache[s])return this._cameraRaycastCache[s];{let a;return a="globe"===r.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),r):{polygon:this.bufferedCameraGeometry(t).map(u=>r.pointCoordinate3D(u)),unwrapped:!0},this._cameraRaycastCache[s]=a,a}}_projectAndResample(t,r){const s=function(u,c){const p=ce.multiply([],c.pixelMatrix,c.globeMatrix),g=[0,-Xl,0,1],y=[0,Xl,0,1],x=[0,0,0,1];Oi.transformMat4(g,g,p),Oi.transformMat4(y,y,p),Oi.transformMat4(x,x,p);const E=new H(g[0]/g[3],g[1]/g[3]),S=new H(y[0]/y[3],y[1]/y[3]),M=_f(u,E)&&g[3]<x[3],D=_f(u,S)&&y[3]<x[3];if(!M&&!D)return null;const P=function(Z,Q,et){for(let it=1;it<Z.length;it++){const yt=zg(Q.pointCoordinate3D(Z[it-1]).x),xt=zg(Q.pointCoordinate3D(Z[it]).x);if(et<0){if(yt<xt)return{idx:it,t:-yt/(xt-1-yt)}}else if(xt<yt)return{idx:it,t:(1-yt)/(xt+1-yt)}}return null}(u,c,M?-1:1);if(!P)return null;const{idx:O,t:R}=P;let B=O>1?ox(u.slice(0,O),c):[],j=O<u.length?ox(u.slice(O),c):[];B=B.map(Z=>new H(zg(Z.x),Z.y)),j=j.map(Z=>new H(zg(Z.x),Z.y));const V=[...B];0===V.length&&V.push(j[j.length-1]);const U=An(V[V.length-1].y,(0===j.length?B[0]:j[0]).y,R);let G;return G=M?[new H(0,U),new H(0,0),new H(1,0),new H(1,U)]:[new H(1,U),new H(1,1),new H(0,1),new H(0,U)],V.push(...G),0===j.length?V.push(B[0]):V.push(...j),{polygon:V.map(Z=>new ri(Z.x,Z.y)),unwrapped:!1}}(t,r);if(s)return s;const a=function(u,c){let p=!1,g=-1/0,y=0;for(let E=0;E<u.length-1;E++)u[E].x>g&&(g=u[E].x,y=E);for(let E=0;E<u.length-1;E++){const S=(y+E)%(u.length-1),M=u[S],D=u[S+1];Math.abs(M.x-D.x)>.5&&(M.x<D.x?(M.x+=1,0===S&&(u[u.length-1].x+=1)):(D.x+=1,S+1===u.length-1&&(u[0].x+=1)),p=!0)}const x=zs(c.center.lng);return p&&x<Math.abs(x-1)&&u.forEach(E=>{E.x-=1}),{polygon:u,unwrapped:p}}(ox(t,r).map(u=>new H(zg(u.x),u.y)),r);return{polygon:a.polygon.map(u=>new ri(u.x,u.y)),unwrapped:a.unwrapped}}}function ox(e,t){return mE(e,r=>{const s=t.pointCoordinate3D(r);r.x=s.x,r.y=s.y},1/256)}function zg(e){return e<0?1+e%1:e%1}function Rd(e){return 100*e|0}function sx(e,t,r,s,a){const u=function(c,p){if(c)return a(c);if(p){e.url&&p.tiles&&e.tiles&&delete e.tiles;const g=Fe(pe(p,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);p.vector_layers&&(g.vectorLayers=p.vector_layers,g.vectorLayerIds=g.vectorLayers.map(y=>y.id)),g.tiles=t.canonicalizeTileset(g,e.url),a(null,g)}};return e.url?ye(t.transformRequest(t.normalizeSourceURL(e.url,null,r,s),Kt.Source),u):or.frame(()=>u(null,e))}class Nd{constructor(t,r,s){this.bounds=$a.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=s||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),s=Math.floor(zs(this.bounds.getWest())*r),a=Math.floor(ba(this.bounds.getNorth())*r),u=Math.ceil(zs(this.bounds.getEast())*r),c=Math.ceil(ba(this.bounds.getSouth())*r);return t.x>=s&&t.x<u&&t.y>=a&&t.y<c}}class Bg{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.image=new oh({width:t,height:r}),this.positions={},this.uploaded=!1}getDash(t,r){const s=this.getKey(t,r);return this.positions[s]}trim(){const t=this.width,r=this.height=Yn(this.nextRow);this.image.resize({width:t,height:r})}getKey(t,r){return t.join(",")+r}getDashRanges(t,r,s){const a=[];let u=t.length%2==1?-t[t.length-1]*s:0,c=t[0]*s,p=!0;a.push({left:u,right:c,isDash:p,zeroLength:0===t[0]});let g=t[0];for(let y=1;y<t.length;y++){p=!p;const x=t[y];u=g*s,g+=x,c=g*s,a.push({left:u,right:c,isDash:p,zeroLength:0===x})}return a}addRoundDash(t,r,s){const a=r/2;for(let u=-s;u<=s;u++){const c=this.width*(this.nextRow+s+u);let p=0,g=t[p];for(let y=0;y<this.width;y++){y/g.right>1&&(g=t[++p]);const x=Math.abs(y-g.left),E=Math.abs(y-g.right),S=Math.min(x,E);let M;const D=u/s*(a+1);if(g.isDash){const P=a-Math.abs(D);M=Math.sqrt(S*S+P*P)}else M=a-Math.sqrt(S*S+D*D);this.image.data[c+y]=Math.max(0,Math.min(255,M+128))}}}addRegularDash(t,r){for(let g=t.length-1;g>=0;--g){const y=t[g],x=t[g+1];y.zeroLength?t.splice(g,1):x&&x.isDash===y.isDash&&(x.left=y.left,t.splice(g,1))}const s=t[0],a=t[t.length-1];s.isDash===a.isDash&&(s.left=a.left-this.width,a.right=s.right+this.width);const u=this.width*this.nextRow;let c=0,p=t[c];for(let g=0;g<this.width;g++){g/p.right>1&&(p=t[++c]);const y=Math.abs(g-p.left),x=Math.abs(g-p.right),E=Math.min(y,x);this.image.data[u+g]=Math.max(0,Math.min(255,(p.isDash?E:-E)+r+128))}}addDash(t,r){const s=this.getKey(t,r);if(this.positions[s])return this.positions[s];const a="round"===r,u=a?7:0,c=2*u+1;if(this.nextRow+c>this.height)return Gt("LineAtlas out of space"),null;0===t.length&&t.push(1);let p=0;for(let x=0;x<t.length;x++)t[x]<0&&(Gt("Negative value is found in line dasharray, replacing values with 0"),t[x]=0),p+=t[x];if(0!==p){const x=this.width/p,E=this.getDashRanges(t,this.width,x);a?this.addRoundDash(E,x,u):this.addRegularDash(E,"square"===r?.5*x:0)}const g=this.nextRow+u;this.nextRow+=c;const y={tl:[g,u],br:[p,0]};return this.positions[s]=y,y}}Fn(Bg,"LineAtlas");const Ql=1*qu;class x2{constructor(t){const r={},s=[];for(const p in t){const g=t[p],y=r[p]={};for(const x in g.glyphs){const E=g.glyphs[+x];if(!E||0===E.bitmap.width||0===E.bitmap.height)continue;const S=E.metrics.localGlyph?Ql:1,M={x:0,y:0,w:E.bitmap.width+2*S,h:E.bitmap.height+2*S};s.push(M),y[x]=M}}const{w:a,h:u}=by(s),c=new oh({width:a||1,height:u||1});for(const p in t){const g=t[p];for(const y in g.glyphs){const x=g.glyphs[+y];if(!x||0===x.bitmap.width||0===x.bitmap.height)continue;const E=r[p][y],S=x.metrics.localGlyph?Ql:1;oh.copy(x.bitmap,c,{x:0,y:0},{x:E.x+S,y:E.y+S},x.bitmap)}}this.image=c,this.positions=r}}Fn(x2,"GlyphAtlas");class vC{constructor(t){this.tileID=new si(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=xd(t.tileID.canonical,t.projection),this.projection=t.projection,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster}parse(t,r,s,a,u){this.status="parsing",this.data=t,this.collisionBoxArray=new fw;const c=new i1(Object.keys(t.layers).sort()),p=new my(this.tileID,this.promoteId);p.bucketLayerIDs=[];const g={},y=new Bg(256,256),x={featureIndex:p,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:y,availableImages:s,brightness:this.brightness},E=r.familiesBySource[this.source];for(const B in E){const j=t.layers[B];if(!j)continue;let V=!1,U=!1,G=!1;for(const et of E[B])"symbol"===et[0].type?V=!0:U=!0,et[0].is3D()&&"model"!==et[0].type&&(G=!0);if(this.extraShadowCaster&&!G||!0===this.isSymbolTile&&!V||!1===this.isSymbolTile&&!U)continue;1===j.version&&Gt(`Vector tile source "${this.source}" layer "${B}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Z=c.encode(B),Q=[];for(let et=0;et<j.length;et++){const it=j.feature(et),yt=p.getId(it,B);Q.push({feature:it,id:yt,index:et,sourceLayerIndex:Z})}for(const et of E[B]){const it=et[0];(!this.extraShadowCaster||it.is3D()&&"model"!==it.type)&&(void 0!==this.isSymbolTile&&"symbol"===it.type!==this.isSymbolTile||it.minzoom&&this.zoom<Math.floor(it.minzoom)||it.maxzoom&&this.zoom>=it.maxzoom||"none"!==it.visibility&&($y(et,this.zoom,x.brightness,s),(g[it.id]=it.createBucket({index:p.bucketLayerIDs.length,layers:et,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Z,sourceID:this.source,projection:this.projection.spec})).populate(Q,x,this.tileID.canonical,this.tileTransform),p.bucketLayerIDs.push(et.map(yt=>yt.id))))}}let S,M,D,P;y.trim();const O={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},R=()=>{if(S)return this.status="done",u(S);if(this.extraShadowCaster)this.status="done",u(null,{buckets:Pe(g).filter(B=>!B.isEmpty()),featureIndex:p,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:x.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(M&&D&&P){const B=new x2(M),j=new QE(D,P);for(const V in g){const U=g[V];U instanceof Bp?($y(U.layers,this.zoom,x.brightness,s),sI(U,M,B.positions,D,j.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):U.hasPattern&&(U instanceof Py||U instanceof fd||U instanceof Qp)&&($y(U.layers,this.zoom,x.brightness,s),U.addFeatures(x,this.tileID.canonical,j.patternPositions,s,this.tileTransform,this.brightness))}this.status="done",u(null,{buckets:Pe(g).filter(V=>!V.isEmpty()),featureIndex:p,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:B.image,lineAtlas:y,imageAtlas:j,brightness:x.brightness})}};if(!this.extraShadowCaster){const B=di(x.glyphDependencies,U=>Object.keys(U).map(Number));Object.keys(B).length?a.send("getGlyphs",{uid:this.uid,stacks:B,scope:this.scope},(U,G)=>{S||(S=U,M=G,R())},void 0,!1,O):M={};const j=Object.keys(x.iconDependencies);j.length?a.send("getImages",{icons:j,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(U,G)=>{S||(S=U,D=G,R())},void 0,!1,O):D={};const V=Object.keys(x.patternDependencies);V.length?a.send("getImages",{icons:V,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(U,G)=>{S||(S=U,P=G,R())},void 0,!1,O):P={}}R()}}function $y(e,t,r,s){const a=new ss(t,{brightness:r});for(const u of e)u.recalculate(a,s)}class xC{constructor(t){this.entries={},this.scheduler=t}request(t,r,s,a){const u=this.entries[t]=this.entries[t]||{callbacks:[]};if(u.result){const[c,p]=u.result;return this.scheduler?this.scheduler.add(()=>{a(c,p)},r):a(c,p),()=>{}}return u.callbacks.push(a),u.cancel||(u.cancel=s((c,p)=>{u.result=[c,p];for(const g of u.callbacks)this.scheduler?this.scheduler.add(()=>{g(c,p)},r):g(c,p);setTimeout(()=>delete this.entries[t],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(c=>c!==a),u.callbacks.length||(u.cancel(),delete this.entries[t]))}}}function ax(e,t,r){const s=JSON.stringify(e.request);return e.data&&(this.deduped.entries[s]={result:[null,e.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},a=>{const u=je(e.request,(c,p,g,y)=>{c?a(c):p&&a(null,{vectorTile:r?void 0:new n1(new dy(p)),rawData:p,cacheControl:g,expires:y})});return()=>{u.cancel(),a()}},t)}class lx extends Qn{constructor(t,r,s,a){if(super(),this.id=t,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,pe(this,Fe(r,["url","scheme","tileSize","promoteId"])),this._options=pe({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(a),this._tileWorkers={},this._deduped=new xC}load(t){this._loaded=!1,this.fire(new Se("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map._worldview;this._tileJSONRequest=sx(this._options,this.map._requestManager,r,s,(a,u)=>{this._tileJSONRequest=null,this._loaded=!0,a?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),s&&2!==s.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new Oe(a))):u&&(pe(this,u),u.bounds&&(this.tileBounds=new Nd(u.bounds,this.minzoom,this.maxzoom)),wh(u.tiles,this.map._requestManager._customAccessToken),this.fire(new Se("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Se("data",{dataType:"source",sourceDataType:"content"}))),t&&t(a)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=ul(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return pe({},this._options)}loadTile(t,r){const s=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),a={request:this.map._requestManager.transformRequest(s,Kt.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:or.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster};if(a.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=r:t.request=t.actor.send("reloadTile",a,u.bind(this));else if(t.actor=this._tileWorkers[s]=this._tileWorkers[s]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",a,u.bind(this),void 0,!0);else{const c=ax.call({deduped:this._deduped},a,(p,g)=>{p||!g?u.call(this,p):(a.data={cacheControl:g.cacheControl,expires:g.expires,rawData:g.rawData.slice(0)},t.actor&&t.actor.send("loadTile",a,u.bind(this),void 0,!0))},!0);t.request={cancel:c}}function u(c,p){return delete t.request,t.aborted?r(null):c&&404!==c.status?r(c):(p&&p.resourceTiming&&(t.resourceTiming=p.resourceTiming),this.map._refreshExpiredTiles&&p&&t.setExpiryData(p),t.loadVectorData(p,this.map.painter),Je(this.dispatcher),r(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Hy extends Qn{constructor(t,r,s,a){super(),this.id=t,this.dispatcher=s,this.setEventedParent(a),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=pe({type:"raster"},r),pe(this,Fe(r,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new Se("dataloading",{dataType:"source"})),this._tileJSONRequest=sx(this._options,this.map._requestManager,null,null,(r,s)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new Oe(r)):s&&(pe(this,s),s.bounds&&(this.tileBounds=new Nd(s.bounds,this.minzoom,this.maxzoom)),wh(s.tiles),this.fire(new Se("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Se("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=ul(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return pe({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const s=or.devicePixelRatio>=2,a=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),s,this.tileSize);t.request=Tn(this.map._requestManager.transformRequest(a,Kt.Tile),(u,c,p,g)=>(delete t.request,t.aborted?(t.state="unloaded",r(null)):u?(t.state="errored",r(u)):c?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:p,expires:g}),t.setTexture(c,this.map.painter),t.state="loaded",Je(this.dispatcher),void r(null)):r(null)))}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r()}unloadTile(t,r){t.texture&&t.texture instanceof fs?(t.destroy(!0),t.texture&&t.texture instanceof fs&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function bC(){return null!=Qg.workerClass?new Qg.workerClass:new rt.Worker(Qg.workerUrl)}const ux="mapboxgl_preloaded_worker_pool";class nm{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<nm.workerCount;)this.workers.push(new bC);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&0===this.numActive()&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ux]}numActive(){return Object.keys(this.active).length}}let Ug;function Hh(){return Ug||(Ug=new nm),Ug}nm.workerCount=2;let Zy,cx,Bc,rm=null;function hx(){return rn()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:cx||Yt.DRACO_URL}const Wy=5123,Xy=5126,fx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[Wy]:Uint16Array,5125:Uint32Array,[Xy]:Float32Array},jg={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[Wy]:"DT_UINT16",5125:"DT_UINT32",[Xy]:"DT_FLOAT32"},Fd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function wC(e,t,r){const s=r.json.bufferViews.length,a=r.buffers.length;t.bufferView=s,r.json.bufferViews[s]={buffer:a,byteLength:e.byteLength},r.buffers[a]=e}const dx="KHR_draco_mesh_compression";function b2(e,t){const r=e.extensions&&e.extensions[dx];if(!r)return;const s=new Bc.Decoder,a=_x(t,r.bufferView),u=new Bc.Mesh;if(!s.DecodeArrayToMesh(a,a.byteLength,u))throw new Error("Failed to decode Draco mesh");const c=t.json.accessors[e.indices],p=fx[c.componentType],g=c.count*p.BYTES_PER_ELEMENT,y=Bc._malloc(g);p===Uint16Array?s.GetTrianglesUInt16Array(u,g,y):s.GetTrianglesUInt32Array(u,g,y),wC(Bc.memory.buffer.slice(y,y+g),c,t),Bc._free(y);for(const x of Object.keys(r.attributes)){const E=s.GetAttributeByUniqueId(u,r.attributes[x]),S=t.json.accessors[e.attributes[x]],M=jg[S.componentType],D=S.count*Fd[S.type]*fx[S.componentType].BYTES_PER_ELEMENT,P=Bc._malloc(D);s.GetAttributeDataArrayForAllPoints(u,E,Bc[M],D,P),wC(Bc.memory.buffer.slice(P,P+D),S,t),Bc._free(P)}s.destroy(),u.destroy(),delete e.extensions[dx]}const px=1179937895,mx=new TextDecoder("utf8");function gx(e,t){return new URL(e,t).href}function w2(e,t,r,s){return fetch(gx(e.uri,s)).then(a=>a.arrayBuffer()).then(a=>{t.buffers[r]=a})}function _x(e,t){const r=e.json.bufferViews[t];return new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function E2(e,t,r,s){if(e.uri){const a=gx(e.uri,s);return fetch(a).then(u=>u.blob()).then(u=>rt.createImageBitmap(u)).then(u=>{t.images[r]=u})}if(void 0!==e.bufferView){const a=_x(t,e.bufferView),u=new rt.Blob([a],{type:e.mimeType});return rt.createImageBitmap(u).then(c=>{t.images[r]=c})}}function EC(e,t=0,r){const s={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===px){const y=new Uint32Array(e,t);let x=2;const E=(y[x++]>>2)-3,S=y[x++]>>2;if(x++,s.json=JSON.parse(mx.decode(y.subarray(x,x+S))),x+=S,x<E){const M=y[x++];x++;const D=t+(x<<2);s.buffers[0]=e.slice(D,D+M)}}else s.json=JSON.parse(mx.decode(new Uint8Array(e,t)));const{buffers:a,images:u,meshes:c,extensionsUsed:p}=s.json;let g=Promise.resolve();if(a){const y=[];for(let x=0;x<a.length;x++){const E=a[x];E.uri?y.push(w2(E,s,x,r)):s.buffers[x]||(s.buffers[x]=null)}g=Promise.all(y)}return g.then(()=>{const y=[],x=p&&p.includes(dx);if(x&&y.push(function(){if(!Bc)return Zy||(Zy=function(E){let S,M=null;function D(){S=new Uint8Array(M.buffer)}function P(){throw new Error("Unexpected Draco error.")}const O={a:{a:P,d:function(R,B,j){return S.copyWithin(R,B,B+j)},c:function(R){const B=S.length,j=Math.max(R>>>0,Math.ceil(1.2*B)),V=Math.ceil((j-B)/65536);try{return M.grow(V),D(),!0}catch{return!1}},b:P}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(E,O):E.then(R=>R.arrayBuffer()).then(R=>WebAssembly.instantiate(R,O))).then(R=>{const{Rb:B,Qb:j,P:V,T:U,X:G,Ja:Z,La:Q,Qa:et,Va:it,Wa:yt,eb:xt,jb:Nt,f:ft,e:Ut,yb:Wt,zb:le,Ab:Bt,Bb:Zt,Db:ge,Gb:be}=R.instance.exports;M=Ut;const xe=(()=>{let Re=0,ze=0,$e=0,Ie=0;return on=>{$e&&(B(Ie),B(Re),ze+=$e,$e=Re=0),Re||(ze+=128,Re=j(ze));const vn=on.length+7&-8;let xn=Re;vn>=ze&&($e=vn,xn=Ie=j(vn));for(let Cn=0;Cn<on.length;Cn++)S[xn+Cn]=on[Cn];return xn}})();return D(),ft(),{memory:Ut,_free:B,_malloc:j,Mesh:class{constructor(){this.ptr=V()}destroy(){U(this.ptr)}},Decoder:class{constructor(){this.ptr=Z()}destroy(){Nt(this.ptr)}DecodeArrayToMesh(Re,ze,$e){const Ie=xe(Re),on=Q(this.ptr,Ie,ze,$e.ptr);return!!G(on)}GetAttributeByUniqueId(Re,ze){return{ptr:et(this.ptr,Re.ptr,ze)}}GetTrianglesUInt16Array(Re,ze,$e){it(this.ptr,Re.ptr,ze,$e)}GetTrianglesUInt32Array(Re,ze,$e){yt(this.ptr,Re.ptr,ze,$e)}GetAttributeDataArrayForAllPoints(Re,ze,$e,Ie,on){xt(this.ptr,Re.ptr,ze.ptr,$e,Ie,on)}},DT_INT8:Wt(),DT_UINT8:le(),DT_INT16:Bt(),DT_UINT16:Zt(),DT_UINT32:ge(),DT_FLOAT32:be()}})}(fetch(hx())),Zy.then(E=>{Bc=E,Zy=void 0}))}()),u)for(let E=0;E<u.length;E++)y.push(E2(u[E],s,E,r));return(y.length?Promise.all(y):Promise.resolve()).then(()=>{if(x&&c)for(const{primitives:E}of c)for(const S of E)b2(S,s);return s})})}function I2(e){return fetch(e).then(t=>t.arrayBuffer()).then(t=>EC(t,0,e))}class C2{constructor(t,r,s){if(this.triangleCount=r.length/3,this.min=new H(0,0),this.max=new H(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===t.length||0===s)return;const a=t.map(x=>x.x),u=t.map(x=>x.y);this.min=new H(Math.min(...a),Math.min(...u)),this.max=new H(Math.max(...a),Math.max(...u));const c=this.max.sub(this.min);c.x=Math.max(c.x,1),c.y=Math.max(c.y,1);const p=Math.max(c.x,c.y)/s;this.cellsX=Math.max(1,Math.ceil(c.x/p)),this.cellsY=Math.max(1,Math.ceil(c.y/p)),this.xScale=1/p,this.yScale=1/p;const g=[];for(let x=0;x<this.triangleCount;x++){const E=t[r[3*x+0]].sub(this.min),S=t[r[3*x+1]].sub(this.min),M=t[r[3*x+2]].sub(this.min),D=kd(Math.floor(Math.min(E.x,S.x,M.x)),this.xScale,this.cellsX),P=kd(Math.floor(Math.max(E.x,S.x,M.x)),this.xScale,this.cellsX),O=kd(Math.floor(Math.min(E.y,S.y,M.y)),this.yScale,this.cellsY),R=kd(Math.floor(Math.max(E.y,S.y,M.y)),this.yScale,this.cellsY),B=new H(0,0),j=new H(0,0),V=new H(0,0),U=new H(0,0);for(let G=O;G<=R;++G){B.y=j.y=G*p,V.y=U.y=(G+1)*p;for(let Z=D;Z<=P;++Z)B.x=V.x=Z*p,j.x=U.x=(Z+1)*p,(ug(E,S,M,B,j,U)||ug(E,S,M,B,U,V))&&g.push({cellIdx:G*this.cellsX+Z,triIdx:x})}}if(0===g.length)return;g.sort((x,E)=>x.cellIdx-E.cellIdx||x.triIdx-E.triIdx);let y=0;for(;y<g.length;){const x=g[y].cellIdx,E={start:this.payload.length,len:0};for(;y<g.length&&g[y].cellIdx===x;)++E.len,this.payload.push(g[y++].triIdx);this.cells[x]=E}}query(t,r,s){if(0===this.triangleCount||0===this.cells.length||t.x>this.max.x||this.min.x>r.x||t.y>this.max.y||this.min.y>r.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let g=0;g<this.lookup.length;g++)this.lookup[g]=0;const a=kd(t.x-this.min.x,this.xScale,this.cellsX),u=kd(r.x-this.min.x,this.xScale,this.cellsX),c=kd(t.y-this.min.y,this.yScale,this.cellsY),p=kd(r.y-this.min.y,this.yScale,this.cellsY);for(let g=c;g<=p;g++)for(let y=a;y<=u;y++){const x=this.cells[g*this.cellsX+y];if(x)for(let E=0;E<x.len;E++){const S=this.payload[x.start+E],M=Math.floor(S/8),D=1<<S%8;if(!(this.lookup[M]&D)&&(this.lookup[M]|=D,s.push(S),s.length===this.triangleCount))return}}}}function kd(e,t,r){return Math.max(0,Math.min(r-1,Math.floor(e*t)))}function im(e,t){const r=e.json.bufferViews[t.bufferView];return new fx[t.componentType](e.buffers[r.buffer],(t.byteOffset||0)+(r.byteOffset||0),t.count*Fd[t.type])}function IC(e,t,r){const s=e.indices,a=e.attributes,u={};u.indexArray=new ea;const c=t.json.accessors[s],p=c.count/3;u.indexArray.reserve(p);const g=im(t,c);for(let S=0;S<p;S++)u.indexArray.emplaceBack(g[3*S],g[3*S+1],g[3*S+2]);u.indexArray._trim(),u.vertexArray=new Rh;const y=t.json.accessors[a.POSITION];u.vertexArray.reserve(y.count);const x=im(t,y);for(let S=0;S<y.count;S++)u.vertexArray.emplaceBack(x[3*S],x[3*S+1],x[3*S+2]);if(u.vertexArray._trim(),u.aabb=new Qi(y.min,y.max),u.centroid=function(S,M){const D=[0,0,0],P=S.length;if(P>0){for(let O=0;O<P;O++){const R=3*S[O];D[0]+=M[R],D[1]+=M[R+1],D[2]+=M[R+2]}D[0]/=P,D[1]/=P,D[2]/=P}return D}(g,x),void 0!==a.COLOR_0){const S=t.json.accessors[a.COLOR_0],M=Fd[S.type];if(S.componentType===Xy){u.colorArray=3===M?new Rh:new oc,u.colorArray.reserve(S.count);const D=im(t,S);if(3===M)for(let P=0;P<S.count;P++)u.colorArray.emplaceBack(D[3*P],D[3*P+1],D[3*P+2]);else for(let P=0;P<S.count;P++)u.colorArray.emplaceBack(D[4*P],D[4*P+1],D[4*P+2],D[4*P+3]);u.colorArray._trim()}else if(S.componentType===Wy&&4===M){u.colorArray=new oc,u.colorArray.resize(S.count);const D=im(t,S),P=1/65535,O=u.colorArray.float32;for(let R=0;R<4*D.length;++R)O[R]=D[R]*P}else Gt(`glTF color buffer parsing for accessor ${JSON.stringify(S)} is not supported`)}if(void 0!==a.NORMAL){u.normalArray=new Rh;const S=t.json.accessors[a.NORMAL];u.normalArray.reserve(S.count);const M=im(t,S);for(let D=0;D<S.count;D++)u.normalArray.emplaceBack(M[3*D],M[3*D+1],M[3*D+2]);u.normalArray._trim()}if(void 0!==a.TEXCOORD_0&&r.length>0){u.texcoordArray=new Nh;const S=t.json.accessors[a.TEXCOORD_0];u.texcoordArray.reserve(S.count);const M=im(t,S);for(let D=0;D<S.count;D++)u.texcoordArray.emplaceBack(M[2*D],M[2*D+1]);u.texcoordArray._trim()}const E=e.material;return u.material=function(S,M){const{emissiveFactor:D=[0,0,0],alphaMode:P="OPAQUE",alphaCutoff:O=.5,normalTexture:R,occlusionTexture:B,emissiveTexture:j,doubleSided:V}=S,{baseColorFactor:U=[1,1,1,1],metallicFactor:G=1,roughnessFactor:Z=1,baseColorTexture:Q,metallicRoughnessTexture:et}=S.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new pn(...U),metallicFactor:G,roughnessFactor:Z,baseColorTexture:Q?M[Q.index]:void 0,metallicRoughnessTexture:et?M[et.index]:void 0},doubleSided:V,emissiveFactor:D,alphaMode:P,alphaCutoff:O,normalTexture:R?M[R.index]:void 0,occlusionTexture:B?M[B.index]:void 0,emissionTexture:j?M[j.index]:void 0,defined:void 0===S.defined}}(void 0!==E?t.json.materials[E]:{defined:!1},r),void 0!==a._FEATURE_RGBA4444&&(u.featureData=new Uint32Array(im(t,t.json.accessors[a._FEATURE_RGBA4444]).buffer)),u}function Vg(e,t,r){const{matrix:s,rotation:a,translation:u,scale:c,mesh:p,extras:g,children:y}=e,x={};if(x.matrix=s||ce.fromRotationTranslationScale([],a||[0,0,0,1],u||[0,0,0],c||[1,1,1]),void 0!==p){x.meshes=r[p];const E=x.anchor=[0,0];for(const S of x.meshes){const{min:M,max:D}=S.aabb;E[0]+=M[0]+D[0],E[1]+=M[1]+D[1]}E[0]=Math.floor(E[0]/x.meshes.length/2),E[1]=Math.floor(E[1]/x.meshes.length/2)}if(g&&(g.id&&(x.id=g.id),g.lights&&(x.lights=function(E){if(!E.length)return[];const S=function(R){const B=atob(R),j=new Uint8Array(B.length);for(let V=0;V<B.length;V++)j[V]=B.codePointAt(V);return j}(E),M=[],D=S.length/24,P=new Uint16Array(S.buffer),O=new Float32Array(S.buffer);for(let R=0;R<D;R++){const B=P[2*R*6]/30,j=P[2*R*6+1]/30,V=P[2*R*6+10]/100,U=O[6*R+1],G=O[6*R+2],Z=O[6*R+3],Q=O[6*R+4],et=Z-U,it=Q-G,yt=Math.hypot(et,it);M.push({pos:[U+.5*et,G+.5*it,j],normal:[it/yt,-et/yt,0],width:yt,height:B,depth:V,points:[U,G,Z,Q]})}return M}(g.lights))),y){const E=[];for(const S of y)E.push(Vg(t.json.nodes[S],t,r));x.children=E}return x}function S2(e){if(0===e.vertices.length||0===e.indices.length)return null;const[t,r]=[e.vertices[0].clone(),e.vertices[0].clone()];for(let c=1;c<e.vertices.length;++c){const p=e.vertices[c];t.x=Math.min(t.x,p.x),t.y=Math.min(t.y,p.y),r.x=Math.max(r.x,p.x),r.y=Math.max(r.y,p.y)}const s=Math.ceil(Math.max(r.x-t.x,r.y-t.y)/256),a=Math.max(8,s),u=new C2(e.vertices,e.indices,a);return{vertices:e.vertices,indices:e.indices,grid:u,min:t,max:r}}function M2(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const r=t[0];if(!r||!Array.isArray(r)||0===r.length)return null;const s=[];for(const c of r){if(!Array.isArray(c)||2!==c.length)continue;const p=c[0],g=c[1];"number"==typeof p&&"number"==typeof g&&s.push(new H(p,g))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let a=0;for(let c=0;c<s.length;c++){const p=s[c],g=s[(c+1)%s.length],y=s[(c+2)%s.length];a+=(p.x-g.x)*(y.y-g.y)-(y.x-g.x)*(p.y-g.y)}a>0&&s.reverse();const u=dg(s.flatMap(c=>[c.x,c.y]),[]);return 0===u.length?null:{vertices:s,indices:u}}function CC(e){const t=[],r=[];let s=0;for(const a of e){s=t.length;const u=a.vertexArray.float32,c=a.indexArray.uint16;for(let p=0;p<a.vertexArray.length;p++)t.push(new H(u[3*p+0],u[3*p+1]));for(let p=0;p<3*a.indexArray.length;p++)r.push(c[p]+s)}if(r.length%3!=0)return null;for(let a=0;a<r.length;a+=3){const u=t[r[a+0]],c=t[r[a+1]],p=t[r[a+2]];(u.x-c.x)*(p.y-c.y)-(p.x-c.x)*(u.y-c.y)>0&&([r[a+1],r[a+2]]=[r[a+2],r[a+1]])}return{vertices:t,indices:r}}function zd(e){const r=function(g,y){const x=[];for(const E of g.json.meshes){const S=[];for(const M of E.primitives)S.push(IC(M,g,y));x.push(S)}return x}(e,function(g,y){const x=[],E=rt.WebGL2RenderingContext;if(g.json.textures)for(const S of g.json.textures){const M={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};void 0!==S.sampler&&Object.assign(M,g.json.samplers[S.sampler]),x.push({image:y[S.source],sampler:M,uploaded:!1})}return x}(e,e.images)),{scenes:s,scene:a,nodes:u}=e.json,c=s?s[a||0].nodes:u,p=[];for(const g of c)p.push(Vg(u[g],e,r));return function(g,y,x){const E={},S=new Set;for(let M=0;M<g.length;M++){const D=x[y[M]];if(!D.extras)continue;const P=D.extras["mapbox:footprint:version"],O=D.extras["mapbox:footprint:id"];(P||O)&&S.add(M),"1.0.0"===P&&O&&(E[O]=M)}for(let M=0;M<g.length;M++){if(S.has(M))continue;const D=g[M],P=x[y[M]];if(!P.extras)continue;let O=null;D.id in E&&(O=CC(g[E[D.id]].meshes)),O||(O=M2(P)),O&&(D.footprint=S2(O))}if(S.size>0){const M=Array.from(S.values()).sort((D,P)=>D-P);for(let D=M.length-1;D>=0;D--)g.splice(M[D],1)}}(p,c,e.json.nodes),p}function T2(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,r=e.aabb.min[0]-1,s=e.aabb.min[1]-1,a=64/(e.aabb.max[0]-r+2),u=64/(e.aabb.max[1]-s+2);for(let c=0;c<t.length;c+=3){const p=t[c+2],g=(t[c+0]-r)*a|0,y=(t[c+1]-s)*u|0;p>e.heightmap[64*y+g]&&(e.heightmap[64*y+g]=p)}}function D2(e,t){const r={};r.indexArray=new ea,r.indexArray.reserve(4*e.length),r.vertexArray=new Rh,r.vertexArray.reserve(10*e.length),r.colorArray=new oc,r.vertexArray.reserve(10*e.length);let s=0;for(const c of e){const p=Math.min(10,Math.max(4,1.3*c.height))*t,g=[-c.normal[1],c.normal[0],0],y=Math.min(.29,.1*c.width/c.depth),x=c.width-2*c.depth*t*(y+.01),E=Ot.scaleAndAdd([],c.pos,g,x/2),S=Ot.scaleAndAdd([],c.pos,g,-x/2),M=[E[0],E[1],E[2]+c.height],D=[S[0],S[1],S[2]+c.height],P=Ot.scaleAndAdd([],c.normal,g,y);Ot.scale(P,P,p);const O=Ot.scaleAndAdd([],c.normal,g,-y);Ot.scale(O,O,p),Ot.add(P,E,P),Ot.add(O,S,O),E[2]+=.1,S[2]+=.1,r.vertexArray.emplaceBack(P[0],P[1],P[2]),r.vertexArray.emplaceBack(O[0],O[1],O[2]),r.vertexArray.emplaceBack(E[0],E[1],E[2]),r.vertexArray.emplaceBack(S[0],S[1],S[2]),r.vertexArray.emplaceBack(M[0],M[1],M[2]),r.vertexArray.emplaceBack(D[0],D[1],D[2]),r.vertexArray.emplaceBack(E[0],E[1],E[2]),r.vertexArray.emplaceBack(S[0],S[1],S[2]),r.vertexArray.emplaceBack(P[0],P[1],P[2]),r.vertexArray.emplaceBack(O[0],O[1],O[2]);const R=x/p/2;r.colorArray.emplaceBack(-R-y,-1,R,.8),r.colorArray.emplaceBack(R+y,-1,R,.8),r.colorArray.emplaceBack(-R,0,R,1.3),r.colorArray.emplaceBack(R,0,R,1.3),r.colorArray.emplaceBack(R+y,-.8,R,.7),r.colorArray.emplaceBack(R+y,-.8,R,.7),r.colorArray.emplaceBack(0,0,R,1.3),r.colorArray.emplaceBack(0,0,R,1.3),r.colorArray.emplaceBack(R+y,-1.2,R,.8),r.colorArray.emplaceBack(R+y,-1.2,R,.8),r.indexArray.emplaceBack(6+s,4+s,8+s),r.indexArray.emplaceBack(7+s,9+s,5+s),r.indexArray.emplaceBack(0+s,1+s,2+s),r.indexArray.emplaceBack(1+s,3+s,2+s),s+=10}const a={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=pn.white,a.pbrMetallicRoughness=u,r.material=a,r.aabb=new Qi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}Fn(C2,"TriangleGridIndex");const yx={vector:lx,raster:Hy,"raster-dem":class extends Hy{constructor(e,t,r,s){super(e,t,r,s),this.type="raster-dem",this.maxzoom=22,this._options=pe({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(e,t){const r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function s(a,u){a&&(e.state="errored",t(a)),u&&(e.dem=u,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",t(null))}e.request=Tn(this.map._requestManager.transformRequest(r,Kt.Tile),function(a,u,c,p){if(delete e.request,e.aborted)e.state="unloaded",t(null);else if(a)e.state="errored",t(a);else if(u){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:c,expires:p});const y=rt.ImageBitmap&&u instanceof rt.ImageBitmap&&Ka(),x=1-(u.width-((g=u.width)<=1?1:Math.pow(2,Math.floor(Math.log(g)/Math.LN2))))/2;x<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const E=y?u:or.getImageData(u,x),S={uid:e.uid,coord:e.tileID,source:this.id,scope:this.scope,rawImageData:E,encoding:this.encoding,padding:x};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",S,s.bind(this),void 0,!0))}var g}.bind(this))}_getNeighboringTiles(e){const t=e.canonical,r=Math.pow(2,t.z),s=(t.x-1+r)%r,a=0===t.x?e.wrap-1:e.wrap,u=(t.x+1+r)%r,c=t.x+1===r?e.wrap+1:e.wrap,p={};return p[new si(e.overscaledZ,a,t.z,s,t.y).key]={backfilled:!1},p[new si(e.overscaledZ,c,t.z,u,t.y).key]={backfilled:!1},t.y>0&&(p[new si(e.overscaledZ,a,t.z,s,t.y-1).key]={backfilled:!1},p[new si(e.overscaledZ,e.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},p[new si(e.overscaledZ,c,t.z,u,t.y-1).key]={backfilled:!1}),t.y+1<r&&(p[new si(e.overscaledZ,a,t.z,s,t.y+1).key]={backfilled:!1},p[new si(e.overscaledZ,e.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},p[new si(e.overscaledZ,c,t.z,u,t.y+1).key]={backfilled:!1}),p}},geojson:class extends Qn{constructor(e,t,r,s){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(s),this._data=t.data,this._options=pe({},t),this._collectResourceTiming=t.collectResourceTiming,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const a=$t/this.tileSize;this.workerOptions=pe({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(void 0!==t.buffer?t.buffer:128)*a,tolerance:(void 0!==t.tolerance?t.tolerance:.375)*a,extent:$t,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:void 0!==t.clusterMaxZoom?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:$t,radius:(void 0!==t.clusterRadius?t.clusterRadius:50)*a,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,r,s){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:r},s),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new Se("dataloading",{dataType:"source"})),this._loaded=!1;const e=pe({},this.workerOptions);e.scope=this.scope;const t=this._data;"string"==typeof t?(e.request=this.map._requestManager.transformRequest(or.resolveURL(t),Kt.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,e,(r,s)=>{if(this._loaded=!0,this._pendingLoad=null,r)this.fire(new Oe(r));else{const a={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&s&&s.resourceTiming&&s.resourceTiming[this.id]&&(a.resourceTiming=s.resourceTiming[this.id]),this.fire(new Se("data",a)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(e,t){const r=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const s={type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:or.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};e.request=this.actor.send(r,s,(a,u)=>(delete e.request,e.destroy(),e.aborted?t(null):a?t(a):(e.loadVectorData(u,this.map.painter,"reloadTile"===r),t(null))),void 0,"loadTile"===r)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return pe({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends dc{constructor(e,t,r,s){super(e,t,r,s),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,Kt.Source).url);!function(t,r){const s=rt.document.createElement("video");s.muted=!0,s.onloadstart=function(){r(null,s)};for(let a=0;a<t.length;a++){const u=rt.document.createElement("source");tn(t[a])||(s.crossOrigin="Anonymous"),u.src=t[a],s.appendChild(u)}}(this.urls,(t,r)=>{this._loaded=!0,t?this.fire(new Oe(t)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const t=this.video.seekable;e<t.start(0)||e>t.end(0)?this.fire(new Oe(new Ne(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,t=e.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new fs(e,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:dc,model:class extends Qn{constructor(e,t,r,s){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const e=[];for(const t in this._options.models){const r=this._options.models[t],s=I2(this.map._requestManager.transformRequest(r.uri,Kt.Model).url).then(a=>{if(!a)return;const u=zd(a),c=new jI(t,r.position,r.orientation,u);c.computeBoundsAndApplyParent(),this.models.push(c)}).catch(a=>{this.fire(new Oe(new Error(`Could not load model ${t} from ${r.uri}: ${a.message}`)))});e.push(s)}return Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new Se("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new Oe(new Error(`Could not load models: ${t.message}`)))})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends Qn{constructor(e,t,r,s){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(s)}onAdd(e){this.map=e,this.load()}load(e){this._loaded=!1,this.fire(new Se("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=sx(this._options,this.map._requestManager,t,r,(s,a)=>{this._tileJSONRequest=null,this._loaded=!0,s?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),r&&2!==r.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new Oe(s))):a&&(pe(this,a),a.bounds&&(this.tileBounds=new Nd(a.bounds,this.minzoom,this.maxzoom)),wh(a.tiles,this.map._requestManager._customAccessToken),this.fire(new Se("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Se("data",{dataType:"source",sourceDataType:"content"}))),e&&e(s)})}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(e,t){const r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),s={request:this.map._requestManager.transformRequest(r,Kt.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(e.actor&&"expired"!==e.state)if("loading"===e.state)e.reloadCallback=t;else{if(e.buckets){const u=Object.values(e.buckets);for(const c of u)c.dirty=!0;return void(e.state="loaded")}e.request=e.actor.send("reloadTile",s,a.bind(this))}else e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",s,a.bind(this),void 0,!0);function a(u,c){return e.aborted?t(null):u&&404!==u.status?t(u):(c&&(c.resourceTiming&&(e.resourceTiming=c.resourceTiming),this.map._refreshExpiredTiles&&e.setExpiryData(c),e.buckets={...e.buckets,...c.buckets}),e.state="loaded",void t(null))}}serialize(){return pe({},this._options)}},canvas:class extends dc{constructor(e,t,r,s){super(e,t,r,s),t.coordinates?Array.isArray(t.coordinates)&&4===t.coordinates.length&&!t.coordinates.some(a=>!Array.isArray(a)||2!==a.length||a.some(u=>"number"!=typeof u))||this.fire(new Oe(new Ne(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new Oe(new Ne(`sources.${e}`,null,'missing required property "coordinates"'))),t.animate&&"boolean"!=typeof t.animate&&this.fire(new Oe(new Ne(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),t.canvas?"string"==typeof t.canvas||t.canvas instanceof rt.HTMLCanvasElement||this.fire(new Oe(new Ne(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new Oe(new Ne(`sources.${e}`,null,'missing required property "canvas"'))),this.options=t,this.animate=void 0===t.animate||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof rt.HTMLCanvasElement?this.options.canvas:rt.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new Oe(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const t=this.map.painter.context;this.texture?!e&&!this._playing||this.texture instanceof Up||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new fs(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends Qn{constructor(e,t,r,s){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=t,this.setEventedParent(s),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new Oe(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new Oe(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Nd(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),pe(this,Fe(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return Fe(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new Se("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Se("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new Se("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:r,z:s}=e.canonical;return this._implementation.hasTile({x:t,y:r,z:s})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const{x:r,y:s,z:a}=e.tileID.canonical,u=new rt.AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:r,y:s,z:a},{signal:u.signal})).then(function(c){return delete e.request,e.aborted?(e.state="unloaded",t(null)):void 0===c?(e.state="errored",t(null)):null===c?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):(p=c)instanceof rt.ImageData||p instanceof rt.HTMLCanvasElement||p instanceof rt.ImageBitmap||p instanceof rt.HTMLImageElement?(this.loadTileData(e,c),e.state="loaded",void t(null)):(e.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var p}.bind(this)).catch(c=>{20!==c.code&&(e.state="errored",t(c))}),e.request.cancel=()=>u.abort()}loadTileData(e,t){e.setTexture(t,this._map.painter)}unloadTile(e,t){if(e.texture&&e.texture instanceof fs?(e.destroy(!0),e.texture&&e.texture instanceof fs&&this._map.painter.saveTileTexture(e.texture)):e.destroy(),this._implementation.unloadTile){const{x:r,y:s,z:a}=e.tileID.canonical;this._implementation.unloadTile({x:r,y:s,z:a})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z}))}_clearTiles(){const e=ul(this.id,this.scope);this._map.style.clearSource(e)}_update(){this.fire(new Se("data",{dataType:"source",sourceDataType:"content"}))}}},vx=function(e,t,r,s){const a=new yx[t.type](e,t,r,s);if(a.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${a.id}`);return hn(["load","abort","unload","serialize","prepare"],a),a};function sO(e,t){const r=ce.identity([]);return ce.scale(r,r,[.5*e.width,.5*-e.height,1]),ce.translate(r,r,[1,-1,0]),ce.multiply(r,r,e.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(r)}function A2(e,t,r,s,a,u,c,p=!1){const g=e.tilesIn(s,c,p);g.sort(MC);const y=[];for(const E of g)y.push({wrappedTileID:E.tile.tileID.wrapped().key,queryResults:E.tile.queryRenderedFeatures(t,r,e._state,E,a,u,sO(e.transform,E.tile.tileID),p)});const x=function(E){const S={},M={};for(const D of E){const P=D.queryResults,O=D.wrappedTileID,R=M[O]=M[O]||{};for(const B in P){const j=P[B],V=R[B]=R[B]||{},U=S[B]=S[B]||[];for(const G of j)V[G.featureIndex]||(V[G.featureIndex]=!0,U.push(G))}}return S}(y);for(const E in x)x[E].forEach(S=>{const M=S.feature,D=M.layer;D&&"background"!==D.type&&"sky"!==D.type&&"slot"!==D.type&&(M.source=D.source,D["source-layer"]&&(M.sourceLayer=D["source-layer"]),M.state=void 0!==M.id?e.getFeatureState(D["source-layer"],M.id):{})});return x}function SC(e,t){const r=e.getRenderableIds().map(u=>e.getTileByID(u)),s=[],a={};for(let u=0;u<r.length;u++){const c=r[u],p=c.tileID.canonical.key;a[p]||(a[p]=!0,c.querySourceFeatures(s,t))}return s}function MC(e,t){const r=e.tileID,s=t.tileID;return r.overscaledZ-s.overscaledZ||r.canonical.y-s.canonical.y||r.wrap-s.wrap||r.canonical.x-s.canonical.x}class P2{constructor(t){this.style=t}processLayersChanged(){this.layers=[];for(const t in this.style._mergedLayers){const r=this.style._mergedLayers[t];if("fill-extrusion"===r.type)this.layers.push(r);else if("model"===r.type){const s=this.style.getLayerSource(r);s&&"batched-model"===s.type&&this.layers.push(r)}}}updateZOffset(t,r){this.currentBuildingBuckets=[];for(let a=0;a<this.layers.length;++a){const u=this.layers[a],c=this.style.getLayerSourceCache(u);let p=1;"fill-extrusion"===u.type&&(p=u.paint.get("fill-extrusion-opacity")>0?u.paint.get("fill-extrusion-vertical-scale"):0);let g=c?c.getTile(r):null;if(!g&&c&&r.canonical.z>c.getSource().minzoom){let y=r.scaledTo(Math.min(c.getSource().maxzoom,r.overscaledZ-1));for(;y.overscaledZ>=c.getSource().minzoom&&(g=c.getTile(y),!g&&0!==y.overscaledZ);)y=y.scaledTo(y.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:g?g.getBucket(u):null,tileID:g?g.tileID:r,verticalScale:p})}t.hasAnyZOffset=!1;let s=!1;for(let a=0;a<t.symbolInstances.length;a++){const u=t.symbolInstances.get(a),c=u.zOffset,p=this._getHeightAtTileOffset(r,u.tileAnchorX,u.tileAnchorY);u.zOffset=-1!==p?p:c,s||c===u.zOffset||(s=!0),t.hasAnyZOffset||0===u.zOffset||(t.hasAnyZOffset=!0)}s&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,r,s,a){let u=r,c=s;if(t.canonical.z!==a.canonical.z){const p=a.canonical,g=1/(1<<t.canonical.z-p.z);u=(r+t.canonical.x*$t)*g-p.x*$t|0,c=(s+t.canonical.y*$t)*g-p.y*$t|0}return{tileX:u,tileY:c}}_getHeightAtTileOffset(t,r,s){let a;for(let u=0;u<this.layers.length;++u){if("fill-extrusion"!==this.layers[u].type)continue;const{bucket:c,tileID:p,verticalScale:g}=this.currentBuildingBuckets[u];if(!c)continue;const{tileX:y,tileY:x}=this._mapCoordToOverlappingTile(t,r,s,p),E=c.getHeightAtTileCoord(y,x);if(E&&void 0!==E.height){if(!E.hidden)return E.height*g;a=E.height}}for(let u=0;u<this.layers.length;++u){if("model"!==this.layers[u].type)continue;const{bucket:c,tileID:p}=this.currentBuildingBuckets[u];if(!c)continue;const{tileX:g,tileY:y}=this._mapCoordToOverlappingTile(t,r,s,p),x=c.getHeightAtTileCoord(g,y);if(x&&!x.hidden)return void 0===x.height&&void 0!==a?Math.min(x.maxHeight,a)*x.verticalScale:(x.height||0)*x.verticalScale}return-1}}var om=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function L2(e,t){const r={};for(const s in e)"ref"!==s&&(r[s]=e[s]);return om.forEach(s=>{s in t&&(r[s]=t[s])}),r}function xx(e){e=e.slice();const t=Object.create(null);for(let r=0;r<e.length;r++)t[e[r].id]=e[r];for(let r=0;r<e.length;r++)"ref"in e[r]&&(e[r]=L2(e[r],t[e[r].ref]));return e}const Di={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function bx(e,t,r){r.push({command:Di.addSource,args:[e,t[e]]})}function TC(e,t,r){t.push({command:Di.removeSource,args:[e]}),r[e]=!0}function DC(e,t,r,s){TC(e,r,s),bx(e,t,r)}function O2(e,t,r){let s;for(s in e[r])if(e[r].hasOwnProperty(s)&&"data"!==s&&!ht(e[r][s],t[r][s]))return!1;for(s in t[r])if(t[r].hasOwnProperty(s)&&"data"!==s&&!ht(e[r][s],t[r][s]))return!1;return!0}function sm(e,t,r,s,a,u){let c;for(c in t=t||{},e=e||{})e.hasOwnProperty(c)&&(ht(e[c],t[c])||r.push({command:u,args:[s,c,t[c],a]}));for(c in t)t.hasOwnProperty(c)&&!e.hasOwnProperty(c)&&(ht(e[c],t[c])||r.push({command:u,args:[s,c,t[c],a]}))}function Yy(e){return e.id}function Gg(e,t){return e[t.id]=t,e}class AC{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let s=1;s<this.points.length;s++)this._distances[s]=this._distances[s-1]+this.points[s].dist(this.points[s-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=At(t,0,1);let r=1,s=this._distances[r];const a=t*this.paddedLength+this.padding;for(;s<a&&r<this._distances.length;)s=this._distances[++r];const u=r-1,c=this._distances[u],p=s-c,g=p>0?(a-c)/p:0;return this.points[u].mult(1-g).add(this.points[r].mult(g))}}class PC{constructor(t,r,s){const a=this.boxCells=[],u=this.circleCells=[];this.xCellCount=Math.ceil(t/s),this.yCellCount=Math.ceil(r/s);for(let c=0;c<this.xCellCount*this.yCellCount;c++)a.push([]),u.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,s,a,u){this._forEachCell(r,s,a,u,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(a),this.bboxes.push(u)}insertCircle(t,r,s,a){this._forEachCell(r-a,s-a,r+a,s+a,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(s),this.circles.push(a)}_insertBoxCell(t,r,s,a,u,c){this.boxCells[u].push(c)}_insertCircleCell(t,r,s,a,u,c){this.circleCells[u].push(c)}_query(t,r,s,a,u,c){if(s<0||t>this.width||a<0||r>this.height)return!u&&[];const p=[];if(t<=0&&r<=0&&this.width<=s&&this.height<=a){if(u)return!0;for(let g=0;g<this.boxKeys.length;g++)p.push({key:this.boxKeys[g],x1:this.bboxes[4*g],y1:this.bboxes[4*g+1],x2:this.bboxes[4*g+2],y2:this.bboxes[4*g+3]});for(let g=0;g<this.circleKeys.length;g++){const y=this.circles[3*g],x=this.circles[3*g+1],E=this.circles[3*g+2];p.push({key:this.circleKeys[g],x1:y-E,y1:x-E,x2:y+E,y2:x+E})}return c?p.filter(c):p}return this._forEachCell(t,r,s,a,this._queryCell,p,{hitTest:u,seenUids:{box:{},circle:{}}},c),u?p.length>0:p}_queryCircle(t,r,s,a,u){const c=t-s,p=t+s,g=r-s,y=r+s;if(p<0||c>this.width||y<0||g>this.height)return!a&&[];const x=[];return this._forEachCell(c,g,p,y,this._queryCellCircle,x,{hitTest:a,circle:{x:t,y:r,radius:s},seenUids:{box:{},circle:{}}},u),a?x.length>0:x}query(t,r,s,a,u){return this._query(t,r,s,a,!1,u)}hitTest(t,r,s,a,u){return this._query(t,r,s,a,!0,u)}hitTestCircle(t,r,s,a){return this._queryCircle(t,r,s,!0,a)}_queryCell(t,r,s,a,u,c,p,g){const y=p.seenUids,x=this.boxCells[u];if(null!==x){const S=this.bboxes;for(const M of x)if(!y.box[M]){y.box[M]=!0;const D=4*M;if(t<=S[D+2]&&r<=S[D+3]&&s>=S[D+0]&&a>=S[D+1]&&(!g||g(this.boxKeys[M]))){if(p.hitTest)return c.push(!0),!0;c.push({key:this.boxKeys[M],x1:S[D],y1:S[D+1],x2:S[D+2],y2:S[D+3]})}}}const E=this.circleCells[u];if(null!==E){const S=this.circles;for(const M of E)if(!y.circle[M]){y.circle[M]=!0;const D=3*M;if(this._circleAndRectCollide(S[D],S[D+1],S[D+2],t,r,s,a)&&(!g||g(this.circleKeys[M]))){if(p.hitTest)return c.push(!0),!0;{const P=S[D],O=S[D+1],R=S[D+2];c.push({key:this.circleKeys[M],x1:P-R,y1:O-R,x2:P+R,y2:O+R})}}}}}_queryCellCircle(t,r,s,a,u,c,p,g){const y=p.circle,x=p.seenUids,E=this.boxCells[u];if(null!==E){const M=this.bboxes;for(const D of E)if(!x.box[D]){x.box[D]=!0;const P=4*D;if(this._circleAndRectCollide(y.x,y.y,y.radius,M[P+0],M[P+1],M[P+2],M[P+3])&&(!g||g(this.boxKeys[D])))return c.push(!0),!0}}const S=this.circleCells[u];if(null!==S){const M=this.circles;for(const D of S)if(!x.circle[D]){x.circle[D]=!0;const P=3*D;if(this._circlesCollide(M[P],M[P+1],M[P+2],y.x,y.y,y.radius)&&(!g||g(this.circleKeys[D])))return c.push(!0),!0}}}_forEachCell(t,r,s,a,u,c,p,g){const y=this._convertToXCellCoord(t),x=this._convertToYCellCoord(r),E=this._convertToXCellCoord(s),S=this._convertToYCellCoord(a);for(let M=y;M<=E;M++)for(let D=x;D<=S;D++)if(u.call(this,t,r,s,a,this.xCellCount*D+M,c,p,g))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,s,a,u,c){const p=a-t,g=u-r,y=s+c;return y*y>p*p+g*g}_circleAndRectCollide(t,r,s,a,u,c,p){const g=(c-a)/2,y=Math.abs(t-(a+g));if(y>g+s)return!1;const x=(p-u)/2,E=Math.abs(r-(u+x));if(E>x+s)return!1;if(y<=g||E<=x)return!0;const S=y-g,M=E-x;return S*S+M*M<=s*s}}const mh=100;class R2{constructor(t,r,s=new PC(t.width+200,t.height+200,25),a=new PC(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=a,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+mh,this.screenBottomBoundary=t.height+mh,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=r}placeCollisionBox(t,r,s,a,u,c,p,g){let y=s.projectedAnchorX,x=s.projectedAnchorY,E=s.projectedAnchorZ;const S=s.elevation,M=s.tileID,D=t.getProjection();if(S&&M){const[G,Z,Q]=D.upVector(M.canonical,s.tileAnchorX,s.tileAnchorY),et=D.upVectorScale(M.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;y+=G*S*et,x+=Z*S*et,E+=Q*S*et}const P=this.projectAndGetPerspectiveRatio(p,y,x,E,s.tileID,"globe"===D.name||!!S||this.transform.pitch>0,D),O=c*P.perspectiveRatio,R=(s.x1*r+a.x-s.padding)*O+P.point.x,B=(s.y1*r+a.y-s.padding)*O+P.point.y,j=(s.x2*r+a.x+s.padding)*O+P.point.x,V=(s.y2*r+a.y+s.padding)*O+P.point.y,U=P.perspectiveRatio<=.55||P.occluded;return!this.isInsideGrid(R,B,j,V)||!u&&this.grid.hitTest(R,B,j,V,g)||U?{box:[],offscreen:!1,occluded:P.occluded}:{box:[R,B,j,V],offscreen:this.isOffscreen(R,B,j,V),occluded:!1}}placeCollisionCircles(t,r,s,a,u,c,p,g,y,x,E,S,M,D,P){const O=[],R=this.transform.elevation,B=t.getProjection(),j=R?R.getAtTileOffsetFunc(P,this.transform.center.lat,this.transform.worldSize,B):null,V=new H(s.tileAnchorX,s.tileAnchorY);let{x:U,y:G,z:Z}=B.projectTilePoint(V.x,V.y,P.canonical);if(j){const[le,Bt,Zt]=j(V);U+=le,G+=Bt,Z+=Zt}const Q="globe"===B.name,et=this.projectAndGetPerspectiveRatio(p,U,G,Z,P,Q||!!R||this.transform.pitch>0,B),{perspectiveRatio:it}=et,yt=(E?c/it:c*it)/Oa,xt=kc(U,G,Z,g),Nt=et.signedDistanceFromCamera>0?kI(yt,u,s.lineOffsetX*yt,s.lineOffsetY*yt,!1,xt,V,s,a,g,{},R&&!E?j:null,E&&!!R,B,P,E):null;let ft=!1,Ut=!1,Wt=!0;if(Nt&&!et.occluded){const le=.5*M*it+D,Bt=new H(-100,-100),Zt=new H(this.screenRightBoundary,this.screenBottomBoundary),ge=new AC,{first:be,last:xe}=Nt,Re=be.path.length;let ze=[];for(let on=Re-1;on>=1;on--)ze.push(be.path[on]);for(let on=1;on<xe.path.length;on++)ze.push(xe.path[on]);const $e=2.5*le;y&&(ze=ze.map(([on,vn,xn],Cn)=>(j&&!Q&&(xn=j(Cn<Re-1?be.tilePath[Re-1-Cn]:xe.tilePath[Cn-Re+2])[2]),kc(on,vn,xn,y))),ze.some(on=>on[3]<=0)&&(ze=[]));let Ie=[];if(ze.length>0){let on=1/0,vn=-1/0,xn=1/0,Cn=-1/0;for(const Mn of ze)on=Math.min(on,Mn[0]),xn=Math.min(xn,Mn[1]),vn=Math.max(vn,Mn[0]),Cn=Math.max(Cn,Mn[1]);vn>=Bt.x&&on<=Zt.x&&Cn>=Bt.y&&xn<=Zt.y&&(Ie=[ze.map(Mn=>new H(Mn[0],Mn[1]))],(on<Bt.x||vn>Zt.x||xn<Bt.y||Cn>Zt.y)&&(Ie=xy(Ie,Bt.x,Bt.y,Zt.x,Zt.y)))}for(const on of Ie){ge.reset(on,.25*le);let vn=0;vn=ge.length<=.5*le?1:Math.ceil(ge.paddedLength/$e)+1;for(let xn=0;xn<vn;xn++){const Cn=xn/Math.max(vn-1,1),Mn=ge.lerp(Cn),hr=Mn.x+mh,qn=Mn.y+mh;O.push(hr,qn,le,0);const xi=hr-le,Xr=qn-le,fr=hr+le,ir=qn+le;if(Wt=Wt&&this.isOffscreen(xi,Xr,fr,ir),Ut=Ut||this.isInsideGrid(xi,Xr,fr,ir),!r&&this.grid.hitTestCircle(hr,qn,le,S)&&(ft=!0,!x))return{circles:[],offscreen:!1,collisionDetected:ft,occluded:!1}}}}return{circles:!x&&ft||!Ut?[]:O,offscreen:Wt,collisionDetected:ft,occluded:et.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const r=[];let s=1/0,a=1/0,u=-1/0,c=-1/0;for(const x of t){const E=new H(x.x+mh,x.y+mh);s=Math.min(s,E.x),a=Math.min(a,E.y),u=Math.max(u,E.x),c=Math.max(c,E.y),r.push(E)}const p=this.grid.query(s,a,u,c).concat(this.ignoredGrid.query(s,a,u,c)),g={},y={};for(const x of p){const E=x.key;void 0===g[E.bucketInstanceId]&&(g[E.bucketInstanceId]={}),g[E.bucketInstanceId][E.featureIndex]||zv(r,[new H(x.x1,x.y1),new H(x.x2,x.y1),new H(x.x2,x.y2),new H(x.x1,x.y2)])&&(g[E.bucketInstanceId][E.featureIndex]=!0,void 0===y[E.bucketInstanceId]&&(y[E.bucketInstanceId]=[]),y[E.bucketInstanceId].push(E.featureIndex))}return y}insertCollisionBox(t,r,s,a,u){(r?this.ignoredGrid:this.grid).insert({bucketInstanceId:s,featureIndex:a,collisionGroupID:u},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,s,a,u){const c=r?this.ignoredGrid:this.grid,p={bucketInstanceId:s,featureIndex:a,collisionGroupID:u};for(let g=0;g<t.length;g+=4)c.insertCircle(p,t[g],t[g+1],t[g+2])}projectAndGetPerspectiveRatio(t,r,s,a,u,c,p){const g=[r,s,a,1];let y=!1;a||this.transform.pitch>0?(Oi.transformMat4(g,g,t),this.fogState&&u&&"globe"!==p.name&&(y=function(S,M,D,P,O,R){const B=R.calculateFogTileMatrix(O),j=[M,D,P];return Ot.transformMat4(j,j,B),Fg(S,Ot.length(j),R.pitch,R._fov)}(this.fogState,r,s,a,u.toUnwrapped(),this.transform)>.9)):N1(g,g,t);const x=g[3];return{point:new H((g[0]/x+1)/2*this.transform.width+mh,(-g[1]/x+1)/2*this.transform.height+mh),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(p)/x*.5,1.5),signedDistanceFromCamera:x,occluded:c&&g[2]>x||y}}isOffscreen(t,r,s,a){return s<mh||t>=this.screenRightBoundary||a<mh||r>this.screenBottomBoundary}isInsideGrid(t,r,s,a){return s>=0&&t<this.gridRightBoundary&&a>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=ce.identity([]);return ce.translate(t,t,[-100,-100,0]),t}}function qg(e,t,r){const s=t.createTileMatrix(e,e.worldSize,r.toUnwrapped());return ce.multiply(new Float32Array(16),e.projMatrix,s)}function N2(e,t,r){if(t.projection.name===r.projection.name)return e.projMatrix;const s=r.clone();return s.setProjection(t.projection),qg(s,t.getProjection(),e)}function Jy(e,t,r){return t.name===r.projection.name?e.projMatrix:qg(r,t,e)}class LC{constructor(t,r,s,a){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):a&&s?1:0,this.placed=s}isHidden(){return 0===this.opacity&&!this.placed}}class $g{constructor(t,r,s,a,u,c=!1){this.text=new LC(t?t.text:null,r,s,u),this.icon=new LC(t?t.icon:null,r,a,u),this.clipped=c}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class wx{constructor(t,r,s,a=!1){this.text=t,this.icon=r,this.skipFade=s,this.clipped=a}}class F2{constructor(){this.invProjMatrix=ce.create(),this.viewportMatrix=ce.create(),this.circles=[]}}class k2{constructor(t,r,s,a,u){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=s,this.bucketIndex=a,this.tileID=u}}class z2{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:s=>s.collisionGroupID===r}}return this.collisionGroups[t]}}function OC(e,t,r,s,a){const{horizontalAlign:u,verticalAlign:c}=vy(e),p=-(u-.5)*t,g=-(c-.5)*r,y=oI(e,s);return new H(p+y[0]*a,g+y[1]*a)}function Ex(e,t,r,s,a){const u=new H(e,t);return r&&u._rotate(s?a:-a),u}class RC{constructor(t,r,s,a,u,c){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new R2(this.transform,u),this.buildingIndex=c,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=r,this.retainedQueryData={},this.collisionGroups=new z2(s),this.collisionCircleArrays={},this.prevPlacement=a,a&&(a.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,s,a){const u=s.getBucket(r),c=s.latestFeatureIndex;if(!u||!c||r.fqid!==u.layerIds[0])return;const p=u.layers[0].layout,g=s.collisionBoxArray,y=Math.pow(2,this.transform.zoom-s.tileID.overscaledZ),x=s.tileSize/$t,E=s.tileID.toUnwrapped();this.transform.setProjection(u.projection);const S=(M=s.tileID,D=u.getProjection(),P=this.transform,D.name===this.projection?P.calculateProjMatrix(M.toUnwrapped()):qg(P,D,M));var M,D,P;const O="map"===p.get("text-pitch-alignment"),R="map"===p.get("text-rotation-alignment");r.compileFilter();const B=r.dynamicFilter(),j=r.dynamicFilterNeedsFeature(),V=this.transform.calculatePixelsToTileUnitsMatrix(s),U=P1(S,s.tileID.canonical,O,R,this.transform,u.getProjection(),V);let G=null;if(O){const et=L1(S,s.tileID.canonical,O,R,this.transform,u.getProjection(),V);G=ce.multiply([],this.transform.labelPlaneMatrix,et)}let Z=null;B&&s.latestFeatureIndex&&(Z={unwrappedTileID:E,dynamicFilter:B,dynamicFilterNeedsFeature:j,featureIndex:s.latestFeatureIndex}),this.retainedQueryData[u.bucketInstanceId]=new k2(u.bucketInstanceId,c,u.sourceLayerIndex,u.index,s.tileID);const Q={bucket:u,layout:p,posMatrix:S,textLabelPlaneMatrix:U,labelToScreenMatrix:G,clippingData:Z,scale:y,textPixelRatio:x,holdingForFade:s.holdingForFade(),collisionBoxArray:g,partiallyEvaluatedTextSize:lh(u.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:lh(u.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(u.sourceID)};if(a)for(const et of u.sortKeyRanges){const{sortKey:it,symbolInstanceStart:yt,symbolInstanceEnd:xt}=et;t.push({sortKey:it,symbolInstanceStart:yt,symbolInstanceEnd:xt,parameters:Q})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:u.symbolInstances.length,parameters:Q})}attemptAnchorPlacement(t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O,R,B){const{textOffset0:j,textOffset1:V,crossTileID:U}=S,G=[j,V],Z=OC(t,s,a,G,u),Q=this.collisionIndex.placeCollisionBox(D,u,r,Ex(Z.x,Z.y,c,p,this.transform.angle),E,g,y,x.predicate);if(O){const et=D.getSymbolInstanceIconSize(B,this.transform.zoom,S.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(D,et,O,Ex(Z.x,Z.y,c,p,this.transform.angle),E,g,y,x.predicate).box.length)return}if(Q.box.length>0){let et;return this.prevPlacement&&this.prevPlacement.variableOffsets[U]&&this.prevPlacement.placements[U]&&this.prevPlacement.placements[U].text&&(et=this.prevPlacement.variableOffsets[U].anchor),this.variableOffsets[U]={textOffset:G,width:s,height:a,anchor:t,textScale:u,prevAnchor:et},this.markUsedJustification(D,t,S,P),D.allowVerticalPlacement&&(this.markUsedOrientation(D,P,S),this.placedOrientations[U]=P),{shift:Z,placedGlyphBoxes:Q}}}placeLayerBucketPart(t,r,s,a){const{bucket:u,layout:c,posMatrix:p,textLabelPlaneMatrix:g,labelToScreenMatrix:y,clippingData:x,textPixelRatio:E,holdingForFade:S,collisionBoxArray:M,partiallyEvaluatedTextSize:D,partiallyEvaluatedIconSize:P,collisionGroup:O}=t.parameters,R=c.get("text-optional"),B=c.get("icon-optional"),j=c.get("text-allow-overlap"),V=c.get("icon-allow-overlap"),U="map"===c.get("text-rotation-alignment"),G="map"===c.get("text-pitch-alignment"),Z="viewport-y"===c.get("symbol-z-order"),Q=c.get("symbol-z-elevate");this.transform.setProjection(u.projection);let et=j&&(V||!u.hasIconData()||B),it=V&&(j||!u.hasTextData()||R);!u.collisionArrays&&M&&u.deserializeCollisionBoxes(M),s&&a&&u.updateCollisionDebugBuffers(this.transform.zoom,M);const yt=(xt,Nt,ft)=>{const{crossTileID:Ut,numVerticalGlyphVertices:Wt}=xt;if(x){const fr={zoom:this.transform.zoom,pitch:this.transform.pitch};let ir=null;if(x.dynamicFilterNeedsFeature){const Wn=this.retainedQueryData[u.bucketInstanceId];ir=x.featureIndex.loadFeature({featureIndex:xt.featureIndex,bucketIndex:Wn.bucketIndex,sourceLayerIndex:Wn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,x.dynamicFilter)(fr,ir,this.retainedQueryData[u.bucketInstanceId].tileID.canonical,new H(xt.tileAnchorX,xt.tileAnchorY),this.transform.calculateDistanceTileData(x.unwrappedTileID)))return this.placements[Ut]=new wx(!1,!1,!1,!0),void r.add(Ut)}if(r.has(Ut))return;if(S)return void(this.placements[Ut]=new wx(!1,!1,!1));let le=!1,Bt=!1,Zt=!0,ge=!1,be=!1,xe=null,Re={box:null,offscreen:null,occluded:null},ze={box:null,offscreen:null,occluded:null},$e=null,Ie=null,on=null,vn=0,xn=0,Cn=0;ft.textFeatureIndex?vn=ft.textFeatureIndex:xt.useRuntimeCollisionCircles&&(vn=xt.featureIndex),ft.verticalTextFeatureIndex&&(xn=ft.verticalTextFeatureIndex);const Mn=fr=>{fr.tileID=this.retainedQueryData[u.bucketInstanceId].tileID;const ir=this.transform.elevation;fr.elevation=xt.zOffset+(ir?ir.getAtTileOffset(fr.tileID,fr.tileAnchorX,fr.tileAnchorY):0)},hr=ft.textBox;if(hr){Mn(hr);const fr=Wn=>{let Yr=Zo.horizontal;if(u.allowVerticalPlacement&&!Wn&&this.prevPlacement){const ai=this.prevPlacement.placedOrientations[Ut];ai&&(this.placedOrientations[Ut]=ai,Yr=ai,this.markUsedOrientation(u,Yr,xt))}return Yr},ir=(Wn,Yr)=>{if(u.allowVerticalPlacement&&Wt>0&&ft.verticalTextBox){for(const ai of u.writingModes)if(ai===Zo.vertical?(Re=Yr(),ze=Re):Re=Wn(),Re&&Re.box&&Re.box.length)break}else Re=Wn()};if(c.get("text-variable-anchor")){let Wn=c.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ut]){const Pr=this.prevPlacement.variableOffsets[Ut];Wn.indexOf(Pr.anchor)>0&&(Wn=Wn.filter(Ci=>Ci!==Pr.anchor),Wn.unshift(Pr.anchor))}const Yr=(Pr,Ci,Ds)=>{const ki=u.getSymbolInstanceTextSize(D,xt,this.transform.zoom,Nt),Ro=(Pr.x2-Pr.x1)*ki+2*Pr.padding,Us=(Pr.y2-Pr.y1)*ki+2*Pr.padding,Es=xt.hasIconTextFit&&!V?Ci:null;Es&&Mn(Es);let jo={box:[],offscreen:!1,occluded:!1};const Ai=j?2*Wn.length:Wn.length;for(let Wa=0;Wa<Ai;++Wa){const Jh=this.attemptAnchorPlacement(Wn[Wa%Wn.length],Pr,Ro,Us,ki,U,G,E,p,O,Wa>=Wn.length,xt,Nt,u,Ds,Es,D,P);if(Jh&&(jo=Jh.placedGlyphBoxes,jo&&jo.box&&jo.box.length)){le=!0,xe=Jh.shift;break}}return jo};ir(()=>Yr(hr,ft.iconBox,Zo.horizontal),()=>{const Pr=ft.verticalTextBox;return Pr&&Mn(Pr),u.allowVerticalPlacement&&!(Re&&Re.box&&Re.box.length)&&Wt>0&&Pr?Yr(Pr,ft.verticalIconBox,Zo.vertical):{box:null,offscreen:null,occluded:null}}),Re&&(le=Re.box,Zt=Re.offscreen,ge=Re.occluded);const ai=fr(!(!Re||!Re.box));if(!le&&this.prevPlacement){const Pr=this.prevPlacement.variableOffsets[Ut];Pr&&(this.variableOffsets[Ut]=Pr,this.markUsedJustification(u,Pr.anchor,xt,ai))}}else{const Wn=(Yr,ai)=>{const Pr=u.getSymbolInstanceTextSize(D,xt,this.transform.zoom,Nt),Ci=this.collisionIndex.placeCollisionBox(u,Pr,Yr,new H(0,0),j,E,p,O.predicate);return Ci&&Ci.box&&Ci.box.length&&(this.markUsedOrientation(u,ai,xt),this.placedOrientations[Ut]=ai),Ci};ir(()=>Wn(hr,Zo.horizontal),()=>{const Yr=ft.verticalTextBox;return u.allowVerticalPlacement&&Wt>0&&Yr?(Mn(Yr),Wn(Yr,Zo.vertical)):{box:null,offscreen:null,occluded:null}}),fr(!!(Re&&Re.box&&Re.box.length))}}if($e=Re,le=$e&&$e.box&&$e.box.length>0,Zt=$e&&$e.offscreen,ge=$e&&$e.occluded,xt.useRuntimeCollisionCircles){const fr=u.text.placedSymbolArray.get(xt.centerJustifiedTextSymbolIndex>=0?xt.centerJustifiedTextSymbolIndex:xt.verticalPlacedTextSymbolIndex),ir=Cp(u.textSizeData,D,fr),Wn=c.get("text-padding");Ie=this.collisionIndex.placeCollisionCircles(u,j,fr,u.lineVertexArray,u.glyphOffsetArray,ir,p,g,y,s,G,O.predicate,xt.collisionCircleDiameter*ir/Oa,Wn,this.retainedQueryData[u.bucketInstanceId].tileID),le=j||Ie.circles.length>0&&!Ie.collisionDetected,Zt=Zt&&Ie.offscreen,ge=Ie.occluded}if(ft.iconFeatureIndex&&(Cn=ft.iconFeatureIndex),ft.iconBox){const fr=ir=>{Mn(ir);const Wn=xt.hasIconTextFit&&xe?Ex(xe.x,xe.y,U,G,this.transform.angle):new H(0,0),Yr=u.getSymbolInstanceIconSize(P,this.transform.zoom,xt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(u,Yr,ir,Wn,V,E,p,O.predicate)};ze&&ze.box&&ze.box.length&&ft.verticalIconBox?(on=fr(ft.verticalIconBox),Bt=on.box.length>0):(on=fr(ft.iconBox),Bt=on.box.length>0),Zt=Zt&&on.offscreen,be=on.occluded}const qn=R||0===xt.numHorizontalGlyphVertices&&0===Wt,xi=B||0===xt.numIconVertices;if(qn||xi?xi?qn||(Bt=Bt&&le):le=Bt&&le:Bt=le=Bt&&le,le&&$e&&$e.box&&this.collisionIndex.insertCollisionBox($e.box,c.get("text-ignore-placement"),u.bucketInstanceId,ze&&ze.box&&xn?xn:vn,O.ID),Bt&&on&&this.collisionIndex.insertCollisionBox(on.box,c.get("icon-ignore-placement"),u.bucketInstanceId,Cn,O.ID),Ie&&(le&&this.collisionIndex.insertCollisionCircles(Ie.circles,c.get("text-ignore-placement"),u.bucketInstanceId,vn,O.ID),s)){const fr=u.bucketInstanceId;let ir=this.collisionCircleArrays[fr];void 0===ir&&(ir=this.collisionCircleArrays[fr]=new F2);for(let Wn=0;Wn<Ie.circles.length;Wn+=4)ir.circles.push(Ie.circles[Wn+0]),ir.circles.push(Ie.circles[Wn+1]),ir.circles.push(Ie.circles[Wn+2]),ir.circles.push(Ie.collisionDetected?1:0)}const Xr="globe"!==u.projection.name;et=et&&(Xr||!ge),it=it&&(Xr||!be),this.placements[Ut]=new wx(le||et,Bt||it,Zt||u.justReloaded),r.add(Ut)};if(Q&&this.buildingIndex&&(this.buildingIndex.updateZOffset(u,this.retainedQueryData[u.bucketInstanceId].tileID),u.updateZOffset()),Z){const xt=u.getSortedSymbolIndexes(this.transform.angle);for(let Nt=xt.length-1;Nt>=0;--Nt){const ft=xt[Nt];yt(u.symbolInstances.get(ft),ft,u.collisionArrays[ft])}u.hasAnyZOffset&&Gt(`${u.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(u.hasAnyZOffset){const xt=u.getSortedIndexesByZOffset();for(let Nt=0;Nt<xt.length;++Nt){const ft=xt[Nt];yt(u.symbolInstances.get(ft),ft,u.collisionArrays[ft])}}else for(let xt=t.symbolInstanceStart;xt<t.symbolInstanceEnd;xt++)yt(u.symbolInstances.get(xt),xt,u.collisionArrays[xt]);if(s&&u.bucketInstanceId in this.collisionCircleArrays){const xt=this.collisionCircleArrays[u.bucketInstanceId];ce.invert(xt.invProjMatrix,p),xt.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}markUsedJustification(t,r,s,a){const{leftJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:c,rightJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:g,crossTileID:y}=s,x=Ey(r),E=a===Zo.vertical?g:"left"===x?u:"center"===x?c:"right"===x?p:-1;u>=0&&(t.text.placedSymbolArray.get(u).crossTileID=E>=0&&u!==E?0:y),c>=0&&(t.text.placedSymbolArray.get(c).crossTileID=E>=0&&c!==E?0:y),p>=0&&(t.text.placedSymbolArray.get(p).crossTileID=E>=0&&p!==E?0:y),g>=0&&(t.text.placedSymbolArray.get(g).crossTileID=E>=0&&g!==E?0:y)}markUsedOrientation(t,r,s){const a=r===Zo.horizontal||r===Zo.horizontalOnly?r:0,u=r===Zo.vertical?r:0,{leftJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:p,rightJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:y}=s,x=t.text.placedSymbolArray;c>=0&&(x.get(c).placedOrientation=a),p>=0&&(x.get(p).placedOrientation=a),g>=0&&(x.get(g).placedOrientation=a),y>=0&&(x.get(y).placedOrientation=u)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let s=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const a=r?r.symbolFadeChange(t):1,u=r?r.opacities:{},c=r?r.variableOffsets:{},p=r?r.placedOrientations:{};for(const g in this.placements){const y=this.placements[g],x=u[g];x?(this.opacities[g]=new $g(x,a,y.text,y.icon,null,y.clipped),s=s||y.text!==x.text.placed||y.icon!==x.icon.placed):(this.opacities[g]=new $g(null,a,y.text,y.icon,y.skipFade,y.clipped),s=s||y.text||y.icon)}for(const g in u){const y=u[g];if(!this.opacities[g]){const x=new $g(y,a,!1,!1);x.isHidden()||(this.opacities[g]=x,s=s||y.text.placed||y.icon.placed)}}for(const g in c)this.variableOffsets[g]||!this.opacities[g]||this.opacities[g].isHidden()||(this.variableOffsets[g]=c[g]);for(const g in p)this.placedOrientations[g]||!this.opacities[g]||this.opacities[g].isHidden()||(this.placedOrientations[g]=p[g]);s?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r){const s=new Set;for(const a of r){const u=a.getBucket(t);u&&a.latestFeatureIndex&&t.fqid===u.layerIds[0]&&(this.updateBucketOpacities(u,s,a.collisionBoxArray),u.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(u,a.tileID),u.updateZOffset()))}}updateBucketOpacities(t,r,s){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const a=t.layers[0].layout,u=!!t.layers[0].dynamicFilter(),c=new $g(null,0,!1,!1,!0),p=a.get("text-allow-overlap"),g=a.get("icon-allow-overlap"),y=a.get("text-variable-anchor"),x="map"===a.get("text-rotation-alignment"),E="map"===a.get("text-pitch-alignment"),S=new $g(null,0,p&&(g||!t.hasIconData()||a.get("icon-optional")),g&&(p||!t.hasTextData()||a.get("text-optional")),!0);!t.collisionArrays&&s&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(s);const M=(P,O,R)=>{for(let B=0;B<O/4;B++)P.opacityVertexArray.emplaceBack(R)};let D=0;for(let P=0;P<t.symbolInstances.length;P++){const O=t.symbolInstances.get(P),{numHorizontalGlyphVertices:R,numVerticalGlyphVertices:B,crossTileID:j,numIconVertices:V}=O,U=r.has(j);let G=this.opacities[j];U?G=c:G||(G=S,this.opacities[j]=G),r.add(j);const Z=R>0||B>0,Q=V>0,et=this.placedOrientations[j],it=et===Zo.vertical,yt=et===Zo.horizontal||et===Zo.horizontalOnly;if(!Z&&!Q||G.isHidden()||D++,Z){const xt=Ky(G.text);M(t.text,R,it?am:xt),M(t.text,B,yt?am:xt);const Nt=G.text.isHidden(),{leftJustifiedTextSymbolIndex:ft,centerJustifiedTextSymbolIndex:Ut,rightJustifiedTextSymbolIndex:Wt,verticalPlacedTextSymbolIndex:le}=O,Bt=t.text.placedSymbolArray,Zt=Nt||it?1:0;ft>=0&&(Bt.get(ft).hidden=Zt),Ut>=0&&(Bt.get(Ut).hidden=Zt),Wt>=0&&(Bt.get(Wt).hidden=Zt),le>=0&&(Bt.get(le).hidden=Nt||yt?1:0);const ge=this.variableOffsets[j];ge&&this.markUsedJustification(t,ge.anchor,O,et);const be=this.placedOrientations[j];be&&(this.markUsedJustification(t,"left",O,be),this.markUsedOrientation(t,be,O))}if(Q){const xt=Ky(G.icon),{placedIconSymbolIndex:Nt,verticalPlacedIconSymbolIndex:ft}=O,Ut=t.icon.placedSymbolArray,Wt=G.icon.isHidden()?1:0;Nt>=0&&(M(t.icon,V,it?am:xt),Ut.get(Nt).hidden=Wt),ft>=0&&(M(t.icon,O.numVerticalIconVertices,yt?am:xt),Ut.get(ft).hidden=Wt)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const xt=t.collisionArrays[P];if(xt){let Nt=new H(0,0),ft=!0;if(xt.textBox||xt.verticalTextBox){if(y){const Wt=this.variableOffsets[j];Wt?(Nt=OC(Wt.anchor,Wt.width,Wt.height,Wt.textOffset,Wt.textScale),x&&Nt._rotate(E?this.transform.angle:-this.transform.angle)):ft=!1}u&&(ft=!G.clipped),xt.textBox&&Hg(t.textCollisionBox.collisionVertexArray,G.text.placed,!ft||it,Nt.x,Nt.y),xt.verticalTextBox&&Hg(t.textCollisionBox.collisionVertexArray,G.text.placed,!ft||yt,Nt.x,Nt.y)}const Ut=ft&&!(yt||!xt.verticalIconBox);xt.iconBox&&Hg(t.iconCollisionBox.collisionVertexArray,G.icon.placed,Ut,O.hasIconTextFit?Nt.x:0,O.hasIconTextFit?Nt.y:0),xt.verticalIconBox&&Hg(t.iconCollisionBox.collisionVertexArray,G.icon.placed,!Ut,O.hasIconTextFit?Nt.x:0,O.hasIconTextFit?Nt.y:0)}}}if(t.fullyClipped=0===D,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const P=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=P.invProjMatrix,t.placementViewportMatrix=P.viewportMatrix,t.collisionCircleArray=P.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const s=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*s>t}setStale(){this.stale=!0}}function Hg(e,t,r,s,a){e.emplaceBack(t?1:0,r?1:0,s||0,a||0),e.emplaceBack(t?1:0,r?1:0,s||0,a||0),e.emplaceBack(t?1:0,r?1:0,s||0,a||0),e.emplaceBack(t?1:0,r?1:0,s||0,a||0)}const B2=Math.pow(2,25),U2=Math.pow(2,24),NC=Math.pow(2,17),j2=Math.pow(2,16),V2=Math.pow(2,9),G2=Math.pow(2,8),q2=Math.pow(2,1);function Ky(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,r=Math.floor(127*e.opacity);return r*B2+t*U2+r*NC+t*j2+r*V2+t*G2+r*q2+t}const am=0;class FC{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,r,s,a,u){const c=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(c,a,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,u())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,c.sort((p,g)=>p.sortKey-g.sortKey));this._currentPartIndex<c.length;){const p=c[this._currentPartIndex];if(r.placeLayerBucketPart(p,this._seenCrossTileIDs,s,0===p.symbolInstanceStart),this._currentPartIndex++,u())return!0}return!1}}class Ix{constructor(t,r,s,a,u,c,p,g,y){this.placement=new RC(t,u,c,p,g,y),this._currentPlacementIndex=r.length-1,this._forceFullPlacement=s,this._showCollisionBoxes=a,this._done=!1}isDone(){return this._done}continuePlacement(t,r,s,a){const u=or.now(),c=()=>{const p=or.now()-u;return!this._forceFullPlacement&&p>2};for(;this._currentPlacementIndex>=0;){const p=r[t[this._currentPlacementIndex]],g=this.placement.collisionIndex.transform.zoom;if("symbol"===p.type&&(!p.minzoom||p.minzoom<=g)&&(!p.maxzoom||p.maxzoom>g)){const y=p,x=y.layout.get("symbol-z-elevate"),E=this._inProgressLayer=this._inProgressLayer||new FC(y),S=ul(p.source,p.scope);if(E.continuePlacement(x?a[S]:s[S],this.placement,this._showCollisionBoxes,p,c))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const kC=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Qy{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(t,0,2);if(219!==r)throw new Error("Data does not appear to be in a KDBush format.");const a=s>>4;if(1!==a)throw new Error(`Got v${a} data when expected v1.`);const u=kC[15&s];if(!u)throw new Error("Unrecognized array type.");const[c]=new Uint16Array(t,2,1),[p]=new Uint32Array(t,4,1);return new Qy(p,c,u,t)}constructor(t,r=64,s=Float64Array,a){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const u=kC.indexOf(this.ArrayType),c=2*t*this.ArrayType.BYTES_PER_ELEMENT,p=t*this.IndexArrayType.BYTES_PER_ELEMENT,g=(8-p%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${s}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+p+g,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+c+p+g),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+p+g,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=t,this.coords[this._pos++]=r,s}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Zg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,s,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:c,nodeSize:p}=this,g=[0,u.length-1,0],y=[];for(;g.length;){const x=g.pop()||0,E=g.pop()||0,S=g.pop()||0;if(E-S<=p){for(let O=S;O<=E;O++){const R=c[2*O],B=c[2*O+1];R>=t&&R<=s&&B>=r&&B<=a&&y.push(u[O])}continue}const M=S+E>>1,D=c[2*M],P=c[2*M+1];D>=t&&D<=s&&P>=r&&P<=a&&y.push(u[M]),(0===x?t<=D:r<=P)&&(g.push(S),g.push(M-1),g.push(1-x)),(0===x?s>=D:a>=P)&&(g.push(M+1),g.push(E),g.push(1-x))}return y}within(t,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:u,nodeSize:c}=this,p=[0,a.length-1,0],g=[],y=s*s;for(;p.length;){const x=p.pop()||0,E=p.pop()||0,S=p.pop()||0;if(E-S<=c){for(let O=S;O<=E;O++)BC(u[2*O],u[2*O+1],t,r)<=y&&g.push(a[O]);continue}const M=S+E>>1,D=u[2*M],P=u[2*M+1];BC(D,P,t,r)<=y&&g.push(a[M]),(0===x?t-s<=D:r-s<=P)&&(p.push(S),p.push(M-1),p.push(1-x)),(0===x?t+s>=D:r+s>=P)&&(p.push(M+1),p.push(E),p.push(1-x))}return g}}function Zg(e,t,r,s,a,u){if(a-s<=r)return;const c=s+a>>1;zC(e,t,c,s,a,u),Zg(e,t,r,s,c-1,1-u),Zg(e,t,r,c+1,a,1-u)}function zC(e,t,r,s,a,u){for(;a>s;){if(a-s>600){const y=a-s+1,x=r-s+1,E=Math.log(y),S=.5*Math.exp(2*E/3),M=.5*Math.sqrt(E*S*(y-S)/y)*(x-y/2<0?-1:1);zC(e,t,r,Math.max(s,Math.floor(r-x*S/y+M)),Math.min(a,Math.floor(r+(y-x)*S/y+M)),u)}const c=t[2*r+u];let p=s,g=a;for(Wg(e,t,s,r),t[2*a+u]>c&&Wg(e,t,s,a);p<g;){for(Wg(e,t,p,g),p++,g--;t[2*p+u]<c;)p++;for(;t[2*g+u]>c;)g--}t[2*s+u]===c?Wg(e,t,s,g):(g++,Wg(e,t,g,a)),g<=r&&(s=g+1),r<=g&&(a=g-1)}}function Wg(e,t,r,s){Zh(e,r,s),Zh(t,2*r,2*s),Zh(t,2*r+1,2*s+1)}function Zh(e,t,r){const s=e[t];e[t]=e[r],e[r]=s}function BC(e,t,r,s){const a=e-r,u=t-s;return a*a+u*u}const Cx=512/$t/2;class aO{constructor(t,r,s){this.tileID=t,this.bucketInstanceId=s,this.index=new Qy(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const a=t.canonical.x*$t,u=t.canonical.y*$t;for(let c=0;c<r.length;c++){const{key:p,crossTileID:g,tileAnchorX:y,tileAnchorY:x}=r.get(c),E=Math.floor((a+y)*Cx),S=Math.floor((u+x)*Cx);this.index.add(E,S),this.keys.push(p),this.crossTileIDs.push(g)}this.index.finish()}findMatches(t,r,s){const a=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),u=Cx/Math.pow(2,r.canonical.z-this.tileID.canonical.z),c=r.canonical.x*$t,p=r.canonical.y*$t;for(let g=0;g<t.length;g++){const y=t.get(g);if(y.crossTileID)continue;const{key:x,tileAnchorX:E,tileAnchorY:S}=y,M=Math.floor((c+E)*u),D=Math.floor((p+S)*u),P=this.index.range(M-a,D-a,M+a,D+a);for(const O of P){const R=this.crossTileIDs[O];if(this.keys[O]===x&&!s.has(R)){s.add(R),y.crossTileID=R;break}}}}}class Sx{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Mx{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(0!==r)for(const s in this.indexes){const a=this.indexes[s],u={};for(const c in a){const p=a[c];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+r),u[p.tileID.key]=p}this.indexes[s]=u}this.lng=t}addBucket(t,r,s){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let u=0;u<r.symbolInstances.length;u++)r.symbolInstances.get(u).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const a=this.usedCrossTileIDs[t.overscaledZ];for(const u in this.indexes){const c=this.indexes[u];if(Number(u)>t.overscaledZ)for(const p in c){const g=c[p];g.tileID.isChildOf(t)&&g.findMatches(r.symbolInstances,t,a)}else{const p=c[t.scaledTo(Number(u)).key];p&&p.findMatches(r.symbolInstances,t,a)}}for(let u=0;u<r.symbolInstances.length;u++){const c=r.symbolInstances.get(u);c.crossTileID||(c.crossTileID=s.generate(),a.add(c.crossTileID))}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new aO(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const s of r.crossTileIDs)this.usedCrossTileIDs[t].delete(s)}removeStaleBuckets(t){let r=!1;for(const s in this.indexes){const a=this.indexes[s];for(const u in a)t[a[u].bucketInstanceId]||(this.removeBucketCrossTileIDs(s,a[u]),delete a[u],r=!0)}return r}}class $2{constructor(){this.layerIndexes={},this.crossTileIDs=new Sx,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,s,a){let u=this.layerIndexes[t.fqid];void 0===u&&(u=this.layerIndexes[t.fqid]=new Mx);let c=!1;const p={};"globe"!==a.name&&u.handleWrapJump(s);for(const g of r){const y=g.getBucket(t);y&&t.fqid===y.layerIds[0]&&(y.bucketInstanceId||(y.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(g.tileID,y,this.crossTileIDs)&&(c=!0),p[y.bucketInstanceId]=!0)}return u.removeStaleBuckets(p)&&(c=!0),c}pruneUnusedLayers(t){const r={};t.forEach(s=>{r[s]=!0});for(const s in this.layerIndexes)r[s]||delete this.layerIndexes[s]}}var Tx="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",UC="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",jC="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",VC="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",t0="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Dx="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(vec2 texCoord,vec2 texResolution,out vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(vec2 fxy,vec4 colorMix,float colorOffset,vec4 t00,vec4 t10,vec4 t01,vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)\n);}vec2 raTexture2D_image1_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)\n);}vec2 raTexture2D_image0_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",Ax="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",Px="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const Lx=[];Rx(Tx,Lx);const e0={"_prelude_fog.vertex.glsl":VC,"_prelude_terrain.vertex.glsl":jC,"_prelude_shadow.vertex.glsl":Ax,"_prelude_fog.fragment.glsl":t0,"_prelude_shadow.fragment.glsl":Px,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":Dx},n0={};Ri("",jC),Ri(t0,VC),Ri(Px,Ax),Ri(Dx,"");const GC=Ri("\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif","\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}"),qC=Tx;var Ox={background:Ri('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Ri('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Ri('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Ri("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ri('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Ri("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ri("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Ri("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ri("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Ri('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:Ri('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Ri('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in vec2 v_pos;in vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;out vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Ri('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Ri('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef RENDER_CUTOFF\ncolor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\n#ifdef RENDER_CUTOFF\ninvariant gl_Position;\n#endif\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),fillExtrusionDepth:Ri("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Ri('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Ri('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Ri("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;HANDLE_WIREFRAME_DEBUG;\n#endif\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;\n#ifdef FORCE_ABS_FL_GROUND_RADIUS\nfl_ground_radius=abs(flood_light_ground_radius);\n#endif\nfloat flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Ri("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ri('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Ri('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:Ri('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:Ri('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform vec4 u_tl_br;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#elif defined(PROJECTION_GLOBE_VIEW)\nin vec2 a_pos;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec2 globe_tl=vec2(u_tl_br.x,u_tl_br.y);vec2 globe_br=vec2(u_tl_br.z,u_tl_br.w);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=1.0-((mercatorY-globe_br.y)/(globe_tl.y-globe_br.y));float mercatorX=mercatorXfromLng(latLng[1]);float uvX=(mercatorX-globe_br.x)/(globe_tl.x-globe_br.x);vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);uv=vec2(uvX,uvY);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\nuv=a_texture_pos/8192.0;\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),symbolIcon:Ri('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nuniform mediump float u_icon_saturation;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef SATURATION\nvec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:Ri('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:Ri('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:Ri('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}'),terrainDepth:Ri("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Ri('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',UC),skyboxGradient:Ri('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',UC),skyboxCapture:Ri("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ri('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Ri('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Ri('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\ntexColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(diffuse,1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nao=(texture(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Ri("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Ri("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function Rx(e,t){const r=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let s of r)if(s=s.trim(),"#"===s[0]&&s.includes("if")&&!s.includes("endif")){s=s.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const a=s.split(" ");for(const u of a)t.includes(u)||t.push(u)}}function Ri(e,t){const r=/#include\s+"([^"]+)"/g,s=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let a=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);a&&(a=a.map(y=>{const x=y.split(" ");return x[x.length-1]}),a=[...new Set(a)]);const u={},c=[],p=[];e=e.replace(r,(y,x)=>(p.push(x),"")),t=t.replace(r,(y,x)=>(c.push(x),""));let g=[...Lx];Rx(e,g),Rx(t,g);for(const y of[...c,...p])e0[y]||console.error(`Undefined include: ${y}`),n0[y]||(n0[y]=[],Rx(e0[y],n0[y])),g=[...g,...n0[y]];return{fragmentSource:e=e.replace(s,(y,x,E,S,M)=>(u[M]=!0,"define"===x?`\n#ifndef HAS_UNIFORM_u_${M}\nin ${E} ${S} ${M};\n#else\nuniform ${E} ${S} u_${M};\n#endif\n`:"initialize"===x?`\n#ifdef HAS_UNIFORM_u_${M}\n    ${E} ${S} ${M} = u_${M};\n#endif\n`:"define-attribute"===x?`\n#ifdef HAS_ATTRIBUTE_a_${M}\n    in ${E} ${S} ${M};\n#endif\n`:"initialize-attribute"===x?"":void 0)),vertexSource:t=t.replace(s,(y,x,E,S,M)=>{const D="float"===S?"vec2":S,P=M.match(/color/)?"color":D;return"define-attribute-vertex-shader-only"===x?`\n#ifdef HAS_ATTRIBUTE_a_${M}\nin ${E} ${S} a_${M};\n#endif\n`:u[M]?"define"===x?`\n#ifndef HAS_UNIFORM_u_${M}\nuniform lowp float u_${M}_t;\nin ${E} ${D} a_${M};\nout ${E} ${S} ${M};\n#else\nuniform ${E} ${S} u_${M};\n#endif\n`:"initialize"===x?"vec4"===P?`\n#ifndef HAS_UNIFORM_u_${M}\n    ${M} = a_${M};\n#else\n    ${E} ${S} ${M} = u_${M};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${M}\n    ${M} = unpack_mix_${P}(a_${M}, u_${M}_t);\n#else\n    ${E} ${S} ${M} = u_${M};\n#endif\n`:"define-attribute"===x?`\n#ifdef HAS_ATTRIBUTE_a_${M}\n    in ${E} ${S} a_${M};\n    out ${E} ${S} ${M};\n#endif\n`:"initialize-attribute"===x?`\n#ifdef HAS_ATTRIBUTE_a_${M}\n    ${M} = a_${M};\n#endif\n`:void 0:"define"===x?`\n#ifndef HAS_UNIFORM_u_${M}\nuniform lowp float u_${M}_t;\nin ${E} ${D} a_${M};\n#else\nuniform ${E} ${S} u_${M};\n#endif\n`:"define-instanced"===x?"mat4"===P?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${M}0;\nin vec4 a_${M}1;\nin vec4 a_${M}2;\nin vec4 a_${M}3;\n#else\nuniform ${E} ${S} u_${M};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${E} ${D} a_${M};\n#else\nuniform ${E} ${S} u_${M};\n#endif\n`:"initialize-attribute-custom"===x?`\n#ifdef HAS_ATTRIBUTE_a_${M}\n    ${E} ${S} ${M} = a_${M};\n#endif\n`:"vec4"===P?`\n#ifndef HAS_UNIFORM_u_${M}\n    ${E} ${S} ${M} = a_${M};\n#else\n    ${E} ${S} ${M} = u_${M};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${M}\n    ${E} ${S} ${M} = unpack_mix_${P}(a_${M}, u_${M}_t);\n#else\n    ${E} ${S} ${M} = u_${M};\n#endif\n`}),staticAttributes:a,usedDefines:g,vertexIncludes:c,fragmentIncludes:p}}class H2{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,r,s,a,u,c,p,g){this.context=t;let y=this.boundPaintVertexBuffers.length!==a.length;for(let E=0;!y&&E<a.length;E++)this.boundPaintVertexBuffers[E]!==a[E]&&(y=!0);let x=this.boundDynamicVertexBuffers.length!==p.length;for(let E=0;!x&&E<p.length;E++)this.boundDynamicVertexBuffers[E]!==p[E]&&(x=!0);if(!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==s||y||x||this.boundIndexBuffer!==u||this.boundVertexOffset!==c)this.freshBind(r,s,a,u,c,p,g);else{t.bindVertexArrayOES.set(this.vao);for(const E of p)E&&(E.bind(),g&&E.instanceCount&&E.setVertexAttribDivisor(t.gl,r,g));u&&u.dynamicDraw&&u.bind()}}freshBind(t,r,s,a,u,c,p){const g=t.numAttributes,y=this.context,x=y.gl;this.vao&&this.destroy(),this.vao=y.gl.createVertexArray(),y.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=s,this.boundIndexBuffer=a,this.boundVertexOffset=u,this.boundDynamicVertexBuffers=c,r.enableAttributes(x,t),r.bind(),r.setVertexAttribPointers(x,t,u);for(const E of s)E.enableAttributes(x,t),E.bind(),E.setVertexAttribPointers(x,t,u);for(const E of c)E&&(E.enableAttributes(x,t),E.bind(),E.setVertexAttribPointers(x,t,u),p&&E.instanceCount&&E.setVertexAttribDivisor(x,t,p));a&&a.bind(),y.currentNumAttributes=g}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Z2(e,t){const r=Math.pow(2,t.canonical.z),s=t.canonical.y;return[new ri(0,s/r).toLngLat().lat,new ri(0,(s+1)/r).toLngLat().lat]}function lO(e,t,r,s,a,u,c){const p=e.context,g=p.gl,y=r.hillshadeFBO;if(!y)return;e.prepareDrawTile();const x=e.isTileAffectedByFog(t),E=e.getOrCreateProgram("hillshade",{overrideFog:x});p.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,y.colorAttachment.get());const S=((O,R,B,j)=>{const V=B.paint.get("hillshade-shadow-color"),U=B.paint.get("hillshade-highlight-color"),G=B.paint.get("hillshade-accent-color"),Z=B.paint.get("hillshade-emissive-strength");let Q=St(B.paint.get("hillshade-illumination-direction"));if("viewport"===B.paint.get("hillshade-illumination-anchor"))Q-=O.transform.angle;else if(O.style&&O.style.enable3dLights()&&O.style.directionalLight){const it=O.style.directionalLight.properties.get("direction");Q=St(gn(it.x,it.y,it.z)[1])}const et=!O.options.moving;return{u_matrix:j||O.transform.calculateProjMatrix(R.tileID.toUnwrapped(),et),u_image:0,u_latrange:Z2(0,R.tileID),u_light:[B.paint.get("hillshade-exaggeration"),Q],u_shadow:V,u_highlight:U,u_emissive_strength:Z,u_accent:G}})(e,r,s,e.terrain?t.projMatrix:null);e.uploadCommonUniforms(p,E,t.toUnwrapped());const{tileBoundsBuffer:M,tileBoundsIndexBuffer:D,tileBoundsSegments:P}=e.getTileBoundsBuffers(r);E.draw(e,g.TRIANGLES,a,u,c,zr.disabled,S,s.id,M,D,P)}function $C(e,t,r){if(!t.needsDEMTextureUpload)return;const s=e.context,a=s.gl;s.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||e.getTileTexture(r.stride);const u=r.getPixels();t.demTexture?t.demTexture.update(u,{premultiply:!1}):t.demTexture=new fs(s,u,a.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function W2(e,t,r){const s=e.context,a=s.gl;if(!t.dem)return;const u=t.dem;if(s.activeTexture.set(a.TEXTURE1),$C(e,t,u),!t.demTexture)return;t.demTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE);const c=u.dim;s.activeTexture.set(a.TEXTURE0);let p=t.hillshadeFBO;if(!p){const S=new fs(s,{width:c,height:c,data:null},a.RGBA);S.bind(a.LINEAR,a.CLAMP_TO_EDGE),p=t.hillshadeFBO=s.createFramebuffer(c,c,!0,"renderbuffer"),p.colorAttachment.set(S.texture)}s.bindFramebuffer.set(p.framebuffer),s.viewport.set([0,0,c,c]);const{tileBoundsBuffer:g,tileBoundsIndexBuffer:y,tileBoundsSegments:x}=e.getMercatorTileBoundsBuffers(),E=[];e.linearFloatFilteringSupported()&&E.push("TERRAIN_DEM_FLOAT_FORMAT"),e.getOrCreateProgram("hillshadePrepare",{defines:E}).draw(e,a.TRIANGLES,rr.disabled,jr.disabled,vi.unblended,zr.disabled,((S,M)=>{const D=M.stride,P=ce.create();return ce.ortho(P,0,$t,-$t,0,0,1),ce.translate(P,P,[0,-$t,0]),{u_matrix:P,u_image:1,u_dimension:[D,D],u_zoom:S.overscaledZ}})(t.tileID,u),r.id,g,y,x),t.needsHillshadePrepare=!1}const HC=e=>({u_matrix:new br(e),u_image0:new Gr(e),u_skirt_height:new ln(e),u_ground_shadow_factor:new vr(e)}),ZC=(e,t,r)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:r}),WC=(e,t,r,s,a,u,c,p,g,y,x,E,S,M,D)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(s),u_merc_matrix:r,u_zoom_transition:a,u_merc_center:u,u_image0:0,u_frustum_tl:c,u_frustum_tr:p,u_frustum_br:g,u_frustum_bl:y,u_globe_pos:x,u_globe_radius:E,u_viewport:S,u_grid_matrix:D?Float32Array.from(D):new Float32Array(9),u_skirt_height:M}),lm=(e,t)=>{if(t>0&&e.terrain&&Gt("Cutoff is currently disabled on terrain"),t<=0||e.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};const r=e.transform,s=Math.max(Math.abs(r._zoom-(e.minCutoffZoom-1)),1),a=r.isLODDisabled(!1)?ne(60,45,r.pitch):ne(30,15,r.pitch),u=r._farZ-r._nearZ,c=t*r.height,p=((1-(g=a))*(.75*r.cameraToCenterDistance)+g*(r._farZ+c))*s;var g;return{shouldRenderCutoff:a<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(p-r._nearZ)/u,(p-c-r._nearZ)/u]}}};function XC(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const um=new class{constructor(){this.operations={}}newMorphing(e,t,r,s,a){if(e in this.operations){const u=this.operations[e];u.to.tileID.key!==r.tileID.key&&(u.queued=r)}else this.operations[e]={startTime:s,phase:0,duration:a,from:t,to:r,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const r=this.operations[t];for(r.phase=(e-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},YC={0:null,1:"TERRAIN_VERTEX_MORPHING"};function JC(e,t,r){if(0===t)return 0;const s=t<1&&514===r?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*s}function X2(e,t){const r=1<<e.z;return!t&&(0===e.x||e.x===r-1)||0===e.y||e.y===r-1}const Nx=e=>({u_matrix:e});function cm(e,t,r,s,a){if(a>0){const u=or.now(),c=(u-e.timeAdded)/a,p=t?(u-t.timeAdded)/a:-1,g=r.getSource(),y=s.coveringZoomLevel({tileSize:g.tileSize,roundZoom:g.roundZoom}),x=!t||Math.abs(t.tileID.overscaledZ-y)>Math.abs(e.tileID.overscaledZ-y),E=x&&e.refreshedUponExpiration?1:At(x?c:1-p,0,1);return e.refreshedUponExpiration&&c>=1&&(e.refreshedUponExpiration=!1),t?{opacity:1,mix:1-E}:{opacity:E,mix:0}}return{opacity:1,mix:0}}class KC extends Fc{constructor(t){const r={type:"raster-dem",maxzoom:t.transform.maxZoom},s=new kg(Hh(),null),a=vx("mock-dem",r,s,t.style);super("mock-dem",a,!1),a.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,r){t.state="loaded",r(null)}}class QC extends Fc{constructor(t){const r=vx("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new kg(Hh(),null),t.style);super("proxy",r,!1),r.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,r,s){if(t.freezeTileCoverage)return;this.transform=t;const a=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((u,c)=>{if(u[c.key]="",!this._tiles[c.key]){const p=new fh(c,this._source.tileSize*c.overscaleFactor(),t.tileZoom);p.state="loaded",this._tiles[c.key]=p}return u},{});for(const u in this._tiles)u in a||(this.freeFBO(u),this._tiles[u].unloadVectorData(),delete this._tiles[u])}freeFBO(t){const r=this.proxyCachedFBO[t];if(void 0!==r){const s=Object.values(r);this.renderCachePool.push(...s),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Fx extends si{constructor(t,r,s){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=r,this.projMatrix=s}}class tS extends py{constructor(t,r){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[s,a,u]=function(g){const y=new hu,x=new ea,E=131;y.reserve(17161),x.reserve(33800);const S=$t/128,M=$t+S/2,D=M+S;for(let O=-S;O<D;O+=S)for(let R=-S;R<D;R+=S){const B=R<0||R>M||O<0||O>M?24575:0,j=At(Math.round(R),0,$t),V=At(Math.round(O),0,$t);y.emplaceBack(j+B,V)}const P=(O,R)=>{const B=R*E+O;x.emplaceBack(B+1,B,B+E),x.emplaceBack(B+E,B+E+1,B+1)};for(let O=1;O<129;O++)for(let R=1;R<129;R++)P(R,O);return[0,129].forEach(O=>{for(let R=0;R<130;R++)P(R,O),P(O,R)}),[y,x,32768]}(),c=t.context;this.gridBuffer=c.createVertexBuffer(s,zh.members),this.gridIndexBuffer=c.createIndexBuffer(a),this.gridSegments=Ui.simpleSegment(0,0,s.length,a.length),this.gridNoSkirtSegments=Ui.simpleSegment(0,0,s.length,u),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new QC(r.map),this.orthoMatrix=ce.create(),ce.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,$t,0,$t,0,1);const p=c.gl;this._overlapStencilMode=new jr({func:p.GEQUAL,mask:255},0,255,p.KEEP,p.KEEP,p.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new KC(r.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,r,s){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const a=t.terrain.properties,u=0===t.terrain.drapeRenderMode,c=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=or.now();const p=t.terrain&&t.terrain.scope,g=a.get("source"),y=u?this._mockSourceCache:t.getSourceCache(g,p);if(!y)return void Gt(`Couldn't find terrain source "${g}".`);if(this.sourceCache=y,this._exaggeration=c?this.calculateExaggeration(r):a.get("exaggeration"),!r.projection.requiresDraping&&c&&0===this._exaggeration)return void this._disable();this.enabled=!0;const x=()=>{this.sourceCache.used&&Gt(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.getScaledDemTileSize();this.sourceCache.update(r,E,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,x(),this._initializing=!0),x(),r.updateElevation(!0,s),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(t){const r=this._previousCameraAltitude,s=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=s;const a=null!=r?s-r:Number.MAX_VALUE;if(Math.abs(a)<2)return this._exaggeration;const u=t.zoom,c=this._style.terrain;if(!this._previousUpdateTimestamp)return c.getExaggeration(u);let p=u-this._previousZoom;const g=this._previousUpdateTimestamp;let y=u;null!=this._evaluationZoom&&(y=this._evaluationZoom,Math.abs(u-y)>.5&&(p=.5*(u-y+p)),p*a<0&&(y+=p)),this._evaluationZoom=y;const x=c.getExaggeration(y),E=x===c.getExaggeration(Math.max(0,y-.1));if(E&&Math.abs(x-this._exaggeration)<.01)return x;let S=Math.min(.1,.00375*(this._updateTimestamp-g));return(E||x<.1||Math.abs(p)<1e-4)&&(S=Math.min(.2,4*S)),An(this._exaggeration,x,S)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,s=this.painter.transform;this._initializing&&(this._initializing=0===s._centerAltitude&&-1===this.getAtPointOrZero(ri.fromLngLat(s.center),-1),this._emptyDEMTextureDirty=!this._initializing);const a=this.proxyCoords=r.getIds().map(g=>{const y=r.getTileByID(g).tileID;return y.projMatrix=s.calculateProjMatrix(y.toUnwrapped()),y});!function(g,y){const x=y.transform.pointCoordinate(y.transform.getCameraPoint()),E=new H(x.x,x.y);g.sort((S,M)=>{if(M.overscaledZ-S.overscaledZ)return M.overscaledZ-S.overscaledZ;const D=new H(S.canonical.x+(1<<S.canonical.z)*S.wrap,S.canonical.y),P=new H(M.canonical.x+(1<<M.canonical.z)*M.wrap,M.canonical.y),O=E.mult(1<<S.canonical.z);return O.x-=.5,O.y-=.5,O.distSqr(D)-O.distSqr(P)})}(a,this.painter);const u=this.proxyToSource||{};this.proxyToSource={},a.forEach(g=>{this.proxyToSource[g.key]={}}),this.terrainTileForTile={};const c=this._style._mergedSourceCaches;for(const g in c){const y=c[g];if(!y.used||(y!==this.sourceCache&&this.resetTileLookupCache(y.id),this._setupProxiedCoordsForOrtho(y,t[g],u),y.usedForTerrain))continue;const x=t[g];y.getSource().reparseOverscaled&&this._assignTerrainTiles(x)}this.proxiedCoords[r.id]=a.map(g=>new Fx(g,g.key,this.orthoMatrix)),this._assignTerrainTiles(a),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(u),this.renderingToTexture=!1;const p={};this._visibleDemTiles=[];for(const g of this.proxyCoords){const y=this.terrainTileForTile[g.key];if(!y)continue;const x=y.tileID.key;x in p||(this._visibleDemTiles.push(y),p[x]=x)}}_assignTerrainTiles(t){this._initializing||t.forEach(r=>{if(this.terrainTileForTile[r.key])return;const s=this._findTileCoveringTileID(r,this.sourceCache);s&&(this.terrainTileForTile[r.key]=s)})}_prepareDEMTextures(){const t=this.painter.context,r=t.gl;for(const s in this.terrainTileForTile){const a=this.terrainTileForTile[s],u=a.dem;!u||a.demTexture&&!a.needsDEMTextureUpload||(t.activeTexture.set(r.TEXTURE1),$C(this.painter,a,u))}}_prepareDemTileUniforms(t,r,s,a){if(!r||null==r.demTexture)return!1;const u=t.tileID.canonical,c=Math.pow(2,r.tileID.canonical.z-u.z),p=a||"";return s[`u_dem_tl${p}`]=[u.x*c%1,u.y*c%1],s[`u_dem_scale${p}`]=c,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,r=t.gl;if(!this._emptyDepthBufferTexture){const s=new Hs({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new fs(t,s,r.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const r=this._visibleDemTiles.reduce((s,a)=>{if(!a.dem)return s;const u=a.dem.tree.minimums[0];return u>0&&t++,s+u},0);return t?r/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,r=t.gl;t.activeTexture.set(r.TEXTURE2);const s=this._getLoadedAreaMinimum(),[a,u]=(()=>{const p=new ZT({width:1,height:1},new Float32Array([s]));return[r.R32F,p]})();this._emptyDEMTextureDirty=!1;let c=this._emptyDEMTexture;return c?c.update(u,{premultiply:!1}):c=this._emptyDEMTexture=new fs(t,u,a,{premultiply:!1}),c}setupElevationDraw(t,r,s){const a=this.painter.context,u=a.gl,c={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};c.u_exaggeration=this.exaggeration();let p=null,g=null,y=1;if(s&&s.morphing&&this._useVertexMorphing){const S=s.morphing.srcDemTile,M=s.morphing.dstDemTile;y=s.morphing.phase,S&&M&&(this._prepareDemTileUniforms(t,S,c,"_prev")&&(g=S),this._prepareDemTileUniforms(t,M,c)&&(p=M))}const x=S=>S&&S.demTexture&&this.painter.linearFloatFilteringSupported()?u.LINEAR:u.NEAREST,E=S=>{c.u_dem_size=1===S.size[0]?1:S.size[0]-2};if(g&&p)a.activeTexture.set(u.TEXTURE2),p.demTexture.bind(x(p),u.CLAMP_TO_EDGE),a.activeTexture.set(u.TEXTURE4),g.demTexture.bind(x(g),u.CLAMP_TO_EDGE),p.demTexture&&E(p.demTexture),c.u_dem_lerp=y;else{p=this.terrainTileForTile[t.tileID.key],a.activeTexture.set(u.TEXTURE2);const S=this._prepareDemTileUniforms(t,p,c)?p.demTexture:this.emptyDEMTexture;S.bind(x(p),u.CLAMP_TO_EDGE),E(S)}if(a.activeTexture.set(u.TEXTURE3),s&&s.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE),this._depthFBO&&(c.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE),c.u_depth_size_inv=[1,1]),s&&s.useMeterToDem&&p){const S=(1<<p.tileID.canonical.z)*ji(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;c.u_meter_to_dem=S}if(s&&s.labelPlaneMatrixInv&&(c.u_label_plane_matrix_inv=s.labelPlaneMatrixInv),r.setTerrainUniformValues(a,c),"globe"===this.painter.transform.projection.name){const S=this.globeUniformValues(this.painter.transform,t.tileID.canonical,s&&s.useDenormalizedUpVectorScale);r.setGlobeUniformValues(a,S)}}globeUniformValues(t,r,s){const a=t.projection;return{u_tile_tl_up:a.upVector(r,0,0),u_tile_tr_up:a.upVector(r,$t,0),u_tile_br_up:a.upVector(r,$t,$t),u_tile_bl_up:a.upVector(r,0,$t),u_tile_up_scale:s?rg(1):a.upVectorScale(r,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const r=this.painter,s=this.painter.context;0!==t.length&&(s.bindFramebuffer.set(null),s.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(a,u,c,p,g){if("globe"===a.transform.projection.name)!function(y,x,E,S,M){const D=y.context,P=D.gl;let O,R;const B=y.transform,j=mp(y,D,B),V=(Nt,ft)=>{if(R===ft)return;const Ut=[YC[ft],"PROJECTION_GLOBE_VIEW"];j&&Ut.push("CUSTOM_ANTIALIASING");const Wt=y.isTileAffectedByFog(Nt);O=y.getOrCreateProgram("globeRaster",{defines:Ut,overrideFog:Wt}),R=ft},U=y.colorModeForRenderPass(),G=new rr(P.LEQUAL,rr.ReadWrite,y.depthRangeFor3D);um.update(M);const Z=fE(B),Q=[zs(B.center.lng),ba(B.center.lat)],et=y.globeSharedBuffers,it=[B.width*or.devicePixelRatio,B.height*or.devicePixelRatio],yt=Float32Array.from(B.globeMatrix),xt={useDenormalizedUpVectorScale:!0};{const Nt=y.transform,ft=JC(Nt.zoom,x.exaggeration(),x.sourceCache._source.tileSize);R=-1;const Ut=P.TRIANGLES;for(const Wt of S){const le=E.getTile(Wt),Bt=jr.disabled,Zt=x.prevTerrainTileForTile[Wt.key],ge=x.terrainTileForTile[Wt.key];XC(Zt,ge)&&um.newMorphing(Wt.key,Zt,ge,M,250),D.activeTexture.set(P.TEXTURE0),le.texture&&le.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE);const be=um.getMorphValuesForProxy(Wt.key),xe=be?1:0;be&&Mi(xt,{morphing:{srcDemTile:be.from,dstDemTile:be.to,phase:cn(be.phase)}});const Re=Oc(Wt.canonical),ze=dE(Re.getCenter().lat),$e=Av(Wt.canonical,Re,ze,Nt.worldSize/Nt._pixelsPerMercatorPixel),Ie=id(Gu(Wt.canonical)),on=WC(Nt.expandedFarZProjMatrix,yt,Z,Ie,da(Nt.zoom),Q,Nt.frustumCorners.TL,Nt.frustumCorners.TR,Nt.frustumCorners.BR,Nt.frustumCorners.BL,Nt.globeCenterInViewSpace,Nt.globeRadius,it,ft,$e);if(V(Wt,xe),O&&(x.setupElevationDraw(le,O,xt),y.uploadCommonUniforms(D,O,Wt.toUnwrapped()),et)){const[vn,xn,Cn]=et.getGridBuffers(ze,0!==ft);O.draw(y,Ut,G,Bt,U,zr.backCCW,on,"globe_raster",vn,xn,Cn)}}}if(et&&(y.renderDefaultNorthPole||y.renderDefaultSouthPole)){const Nt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];j&&Nt.push("CUSTOM_ANTIALIASING"),O=y.getOrCreateProgram("globeRaster",{defines:Nt});for(const ft of S){const{x:Ut,y:Wt,z:le}=ft.canonical,Bt=0===Wt,Zt=Wt===(1<<le)-1,[ge,be,xe,Re]=et.getPoleBuffers(le,!1);if(Re&&(Bt||Zt)){const ze=E.getTile(ft);D.activeTexture.set(P.TEXTURE0),ze.texture&&ze.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE);let $e=rh(le,Ut,B);const Ie=id(Gu(ft.canonical)),on=(vn,xn)=>vn.draw(y,P.TRIANGLES,G,jr.disabled,U,zr.disabled,WC(B.expandedFarZProjMatrix,$e,$e,Ie,0,Q,B.frustumCorners.TL,B.frustumCorners.TR,B.frustumCorners.BR,B.frustumCorners.BL,B.globeCenterInViewSpace,B.globeRadius,it,0),"globe_pole_raster",xn,xe,Re);x.setupElevationDraw(ze,O,xt),y.uploadCommonUniforms(D,O,ft.toUnwrapped()),Bt&&y.renderDefaultNorthPole&&on(O,ge),Zt&&y.renderDefaultSouthPole&&($e=ce.scale(ce.create(),$e,[1,-1,1]),on(O,be))}}}}(a,u,c,p,g);else{const y=a.context,x=y.gl;let E,S;const M=a.shadowRenderer,D=lm(a,a.longestCutoffRange),P=U=>{if(S===U)return;const G=[];G.push(YC[U]),D.shouldRenderCutoff&&G.push("RENDER_CUTOFF"),E=a.getOrCreateProgram("terrainRaster",{defines:G}),S=U},O=a.colorModeForRenderPass(),R=new rr(x.LEQUAL,rr.ReadWrite,a.depthRangeFor3D);um.update(g);const B=a.transform,j=JC(B.zoom,u.exaggeration(),u.sourceCache._source.tileSize);let V=[0,0,0];if(M){const U=a.style.directionalLight,G=a.style.ambientLight;U&&G&&(V=wS(U,G))}{S=-1;const U=x.TRIANGLES,[G,Z]=[u.gridIndexBuffer,u.gridSegments];for(const Q of p){const et=c.getTile(Q),it=jr.disabled,yt=u.prevTerrainTileForTile[Q.key],xt=u.terrainTileForTile[Q.key];XC(yt,xt)&&um.newMorphing(Q.key,yt,xt,g,250),y.activeTexture.set(x.TEXTURE0),et.texture&&et.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE);const Nt=um.getMorphValuesForProxy(Q.key),ft=Nt?1:0;let Ut;Nt&&(Ut={morphing:{srcDemTile:Nt.from,dstDemTile:Nt.to,phase:cn(Nt.phase)}});const Wt=ZC(Q.projMatrix,X2(Q.canonical,B.renderWorldCopies)?j/10:j,V);if(P(ft),!E)continue;u.setupElevationDraw(et,E,Ut);const le=Q.toUnwrapped();M&&M.setupShadows(le,E),a.uploadCommonUniforms(y,E,le,null,D),E.draw(a,U,R,it,O,zr.backCCW,Wt,"terrain_raster",u.gridBuffer,G,Z)}}}}(r,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const r=this.painter,s=this.painter.context,a=this.proxySourceCache,u=this.proxiedCoords[a.id],c=this._drapedRenderBatches.shift(),p=r.style.order,g=[];let y=0;for(const x of u){const E=a.getTileByID(x.proxyTileKey),S=a.proxyCachedFBO[x.key]?a.proxyCachedFBO[x.key][t]:void 0,M=void 0!==S?a.renderCache[S]:this.pool[y++],D=void 0!==S;if(E.texture=M.tex,D&&!M.dirty){g.push(E.tileID);continue}let P;s.bindFramebuffer.set(M.fb.framebuffer),this.renderedToTile=!1,M.dirty&&(s.clear({color:pn.transparent,stencil:0}),M.dirty=!1);for(let O=c.start;O<=c.end;++O){const R=r.style._mergedLayers[p[O]];if(R.isHidden(r.transform.zoom))continue;const B=r.style.getLayerSourceCache(R),j=B?this.proxyToSource[x.key][B.id]:[x];if(!j)continue;const V=j;s.viewport.set([0,0,M.fb.width,M.fb.height]),P!==(B?B.id:null)&&(this._setupStencil(M,j,R,B),P=B?B.id:null),r.renderLayer(r,B,R,V)}if(0===this._drapedRenderBatches.length)for(const O of this._pendingGroundEffectLayers){const R=r.style._mergedLayers[p[O]];if(R.isHidden(r.transform.zoom))continue;const B=r.style.getLayerSourceCache(R),j=B?this.proxyToSource[x.key][B.id]:[x];if(!j)continue;const V=j;s.viewport.set([0,0,M.fb.width,M.fb.height]),P!==(B?B.id:null)&&(this._setupStencil(M,j,R,B),P=B?B.id:null),r.renderLayer(r,B,R,V)}this.renderedToTile?(M.dirty=!0,g.push(E.tileID)):D||--y,5===y&&(y=0,this.renderToBackBuffer(g))}return this.renderToBackBuffer(g),this.renderingToTexture=!1,s.bindFramebuffer.set(null),s.viewport.set([0,0,r.width,r.height]),c.end+1}postRender(){}isLayerOrderingCorrect(t){const r=t.order.length;let s=-1,a=r;for(let u=0;u<r;++u)this._style.isLayerDraped(t._mergedLayers[t.order[u]])?s=Math.max(s,u):a=Math.min(a,u);return a>s}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(r=>r.dem).forEach(r=>{t=Math.min(t,r.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(t,r,s){if(!this._visibleDemTiles)return null;const a=this._visibleDemTiles.filter(u=>u.dem).map(u=>{const c=u.tileID,p=1<<c.overscaledZ,{x:g,y}=c.canonical,x=g/p,E=(g+1)/p,S=y/p,M=(y+1)/p;return{minx:x,miny:S,maxx:E,maxy:M,t:u.dem.tree.raycastRoot(x,S,E,M,t,r,s),tile:u}});a.sort((u,c)=>(null!==u.t?u.t:Number.MAX_VALUE)-(null!==c.t?c.t:Number.MAX_VALUE));for(const u of a){if(null==u.t)return null;const c=u.tile.dem.tree.raycast(u.minx,u.miny,u.maxx,u.maxy,t,r,s);if(null!=c)return c}return null}_createFBO(){const t=this.painter.context,r=t.gl,s=this.drapeBufferSize;t.activeTexture.set(r.TEXTURE0);const a=new fs(t,{width:s[0],height:s[1],data:null},r.RGBA);a.bind(r.LINEAR,r.CLAMP_TO_EDGE);const u=t.createFramebuffer(s[0],s[1],!0,null);return u.colorAttachment.set(a.texture),u.depthAttachment=new GD(t,u.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,s[0],s[1]),this._stencilRef=0,u.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):u.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:u,tex:a,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const r=this._style._mergedLayers[t],s=r.isHidden(this.painter.transform.zoom);return"custom"===r.type?!s&&r.shouldRedrape():!s&&r.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const s of this._style.getSources())if(s instanceof lx){t=!0;break}if(!t)return;const r={};for(let s=0;s<this._style.order.length;++s){const a=this._style._mergedLayers[this._style.order[s]],u=this._style.getLayerSourceCache(a);if(u&&!r[u.id]&&!a.isHidden(this.painter.transform.zoom)&&"line"===a.type&&a.widthExpression()instanceof Th){r[u.id]=!0;for(const c of this.proxyCoords){const p=this.proxyToSource[c.key][u.id];if(p)for(const g of p)this._clearRenderCacheForTile(u.id,g)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s]._source instanceof Hy){t=!0;break}if(!t)return;const r={};for(let s=0;s<this._style.order.length;++s){const a=this._style._mergedLayers[this._style.order[s]],u=this._style.getLayerSourceCache(a);if(!u||r[u.id]||a.isHidden(this.painter.transform.zoom)||"raster"!==a.type)continue;const c=a.paint.get("raster-fade-duration");for(const p of this.proxyCoords){const g=this.proxyToSource[p.key][u.id];if(g)for(const y of g){const x=cm(u.getTile(y),u.findLoadedParent(y,0),u,this.painter.transform,c);(1!==x.opacity||0!==x.mix)&&this._clearRenderCacheForTile(u.id,y)}}}}_setupDrapedRenderBatches(){const t=this._style.order,r=t.length;if(0===r)return;const s=[];this._pendingGroundEffectLayers=[];let a,u=0,c=this._style._mergedLayers[t[u]];for(;!this._style.isLayerDraped(c)&&c.isHidden(this.painter.transform.zoom)&&++u<r;)c=this._style._mergedLayers[t[u]];for(;u<r;++u){const p=this._style._mergedLayers[t[u]];p.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(p)?void 0===a&&(a=u):("fill-extrusion"===p.type&&this._pendingGroundEffectLayers.push(u),void 0!==a&&(s.push({start:a,end:u-1}),a=void 0)))}if(void 0!==a&&s.push({start:a,end:u-1}),0!==s.length){const p=s[s.length-1];this._pendingGroundEffectLayers.every(y=>y>p.end)||Gt("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=s}_setupRenderCache(t){const r=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,r.renderCache.length>r.renderCachePool.length){const c=Object.values(r.proxyCachedFBO);r.proxyCachedFBO={};for(let p=0;p<c.length;++p){const g=Object.values(c[p]);r.renderCachePool.push(...g)}}return}this._clearRasterLayersFromRenderCache();const s=this.proxyCoords,a=this._tilesDirty;for(let c=s.length-1;c>=0;c--){const p=s[c];if(r.getTileByID(p.key),void 0!==r.proxyCachedFBO[p.key]){const g=t[p.key],y=this.proxyToSource[p.key];let x=0;for(const E in y){const S=y[E],M=g[E];if(!M||M.length!==S.length||S.some((D,P)=>D!==M[P]||a[E]&&a[E].hasOwnProperty(D.key))){x=-1;break}++x}for(const E in r.proxyCachedFBO[p.key])r.renderCache[r.proxyCachedFBO[p.key][E]].dirty=x<0||x!==Object.values(g).length}}const u=[...this._drapedRenderBatches];u.sort((c,p)=>p.end-p.start-(c.end-c.start));for(const c of u)for(const p of s){if(r.proxyCachedFBO[p.key])continue;let g=r.renderCachePool.pop();void 0===g&&r.renderCache.length<50&&(g=r.renderCache.length,r.renderCache.push(this._createFBO())),void 0!==g&&(r.proxyCachedFBO[p.key]={},r.proxyCachedFBO[p.key][c.start]=g,r.renderCache[g].dirty=!0)}this._tilesDirty={}}_setupStencil(t,r,s,a){if(!a||!this._sourceTilesOverlap[a.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const u=this.painter.context,c=u.gl;if(r.length<=1)return void(this._overlapStencilType=!1);let p;if(s.isTileClipped())p=r.length,this._overlapStencilMode.test={func:c.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(r[0].overscaledZ>r[r.length-1].overscaledZ))return void(this._overlapStencilType=!1);p=1,this._overlapStencilMode.test={func:c.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+p>255&&(u.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=p,this._overlapStencilMode.ref=this._stencilRef,s.isTileClipped()&&this._renderTileClippingMasks(r,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):jr.disabled}_renderTileClippingMasks(t,r){const s=this.painter,a=this.painter.context,u=a.gl;s._tileClippingMaskIDs={},a.setColorMode(vi.disabled),a.setDepthMode(rr.disabled);const c=s.getOrCreateProgram("clippingMask");for(const p of t){const g=s._tileClippingMaskIDs[p.key]=--r;c.draw(s,u.TRIANGLES,rr.disabled,new jr({func:u.ALWAYS,mask:0},g,255,u.KEEP,u.KEEP,u.REPLACE),vi.disabled,zr.disabled,Nx(p.projMatrix),"$clipping",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments)}}pointCoordinate(t){const r=this.painter.transform;if(t.x<0||t.x>r.width||t.y<0||t.y>r.height)return null;const s=[t.x,t.y,1,1];Oi.transformMat4(s,s,r.pixelMatrixInverse),Oi.scale(s,s,1/s[3]),s[0]/=r.worldSize,s[1]/=r.worldSize;const a=r._camera.position,u=ji(1,r.center.lat),c=[a[0],a[1],a[2]/u,0],p=Ot.subtract([],s.slice(0,3),c);Ot.normalize(p,p);const g=this.raycast(c,p,this._exaggeration);return null!==g&&g?(Ot.scaleAndAdd(c,c,p,g),c[3]=c[2],c[2]*=u,c):null}drawDepth(){const t=this.painter,r=t.context,s=this.proxySourceCache,a=Math.ceil(t.width),u=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===a&&this._depthFBO.height===u||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const c=r.gl,p=r.createFramebuffer(a,u,!0,"renderbuffer");r.activeTexture.set(c.TEXTURE0);const g=new fs(r,{width:a,height:u,data:null},c.RGBA);g.bind(c.NEAREST,c.CLAMP_TO_EDGE),p.colorAttachment.set(g.texture);const y=r.createRenderbuffer(r.gl.DEPTH_COMPONENT16,a,u);p.depthAttachment.set(y),this._depthFBO=p,this._depthTexture=g}r.bindFramebuffer.set(this._depthFBO.framebuffer),r.viewport.set([0,0,a,u]),function(c,p,g,y){if("globe"===c.transform.projection.name)return;const x=c.context,E=x.gl;x.clear({depth:1});const S=c.getOrCreateProgram("terrainDepth"),M=new rr(E.LESS,rr.ReadWrite,c.depthRangeFor3D);for(const D of y){const P=g.getTile(D),O=ZC(D.projMatrix,0,[0,0,0]);p.setupElevationDraw(P,S),S.draw(c,E.TRIANGLES,M,jr.disabled,vi.unblended,zr.backCCW,O,"terrain_depth",p.gridBuffer,p.gridIndexBuffer,p.gridNoSkirtSegments)}}(t,this,s,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,r,s){if(t.getSource()instanceof dc)return this._setupProxiedCoordsForImageSource(t,r,s);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const a=this.proxiedCoords[t.id]=[],u=this.proxyCoords;for(let p=0;p<u.length;p++){const g=u[p],y=this._findTileCoveringTileID(g,t);if(y){const x=this._createProxiedId(g,y,s[g.key]&&s[g.key][t.id]);a.push(x),this.proxyToSource[g.key][t.id]=[x]}}let c=!1;for(let p=0;p<r.length;p++){const g=t.getTile(r[p]);if(!g||!g.hasData())continue;const y=this._findTileCoveringTileID(g.tileID,this.proxySourceCache);if(y&&y.tileID.canonical.z!==g.tileID.canonical.z){const x=this.proxyToSource[y.tileID.key][t.id],E=this._createProxiedId(y.tileID,g,s[y.tileID.key]&&s[y.tileID.key][t.id]);x?x.splice(x.length-1,0,E):this.proxyToSource[y.tileID.key][t.id]=[E],a.push(E),c=!0}}this._sourceTilesOverlap[t.id]=c}_setupProxiedCoordsForImageSource(t,r,s){if(!t.getSource().loaded())return;const a=this.proxiedCoords[t.id]=[],u=this.proxyCoords,c=t.getSource(),p=c.tileID;if(!p)return;const g=new H(p.x,p.y)._div(1<<p.z),y=c.coordinates.map(ri.fromLngLat).reduce((E,S)=>(E.min.x=Math.min(E.min.x,S.x-g.x),E.min.y=Math.min(E.min.y,S.y-g.y),E.max.x=Math.max(E.max.x,S.x-g.x),E.max.y=Math.max(E.max.y,S.y-g.y),E),{min:new H(Number.MAX_VALUE,Number.MAX_VALUE),max:new H(-Number.MAX_VALUE,-Number.MAX_VALUE)}),x=(E,S)=>{const M=E.wrap+E.canonical.x/(1<<E.canonical.z),D=E.canonical.y/(1<<E.canonical.z),P=$t/(1<<E.canonical.z),O=S.wrap+S.canonical.x/(1<<S.canonical.z),R=S.canonical.y/(1<<S.canonical.z);return M+P<O+y.min.x||M>O+y.max.x||D+P<R+y.min.y||D>R+y.max.y};for(let E=0;E<u.length;E++){const S=u[E];for(let M=0;M<r.length;M++){const D=t.getTile(r[M]);if(!D||!D.hasData()||x(S,D.tileID))continue;const P=this._createProxiedId(S,D,s[S.key]&&s[S.key][t.id]),O=this.proxyToSource[S.key][t.id];O?O.push(P):this.proxyToSource[S.key][t.id]=[P],a.push(P)}}}_createProxiedId(t,r,s){let a=this.orthoMatrix;if(s){const u=s.find(c=>c.key===r.tileID.key);if(u)return u}if(r.tileID.key!==t.key){const u=t.canonical.z-r.tileID.canonical.z;let c,p,g;a=ce.create();const y=r.tileID.wrap-t.wrap<<t.overscaledZ;u>0?(c=$t>>u,p=c*((r.tileID.canonical.x<<u)-t.canonical.x+y),g=c*((r.tileID.canonical.y<<u)-t.canonical.y)):(c=$t<<-u,p=$t*(r.tileID.canonical.x-(t.canonical.x+y<<-u)),g=$t*(r.tileID.canonical.y-(t.canonical.y<<-u))),ce.ortho(a,0,c,0,c,0,1),ce.translate(a,a,[p,g,0])}return new Fx(r.tileID,t.key,a)}_findTileCoveringTileID(t,r){let s=r.getTile(t);if(s&&s.hasData())return s;const a=this._findCoveringTileCache[r.id],u=a[t.key];if(s=u?r.getTileByID(u):null,s&&s.hasData()||null===u)return s;let c=s?s.tileID:t,p=c.overscaledZ;const g=r.getSource().minzoom,y=[];if(!u){const E=r.getSource().maxzoom;if(t.canonical.z>=E){const S=t.canonical.z-E;r.getSource().reparseOverscaled?(p=Math.max(t.canonical.z+2,r.transform.tileZoom),c=new si(p,t.wrap,E,t.canonical.x>>S,t.canonical.y>>S)):0!==S&&(p=E,c=new si(p,t.wrap,E,t.canonical.x>>S,t.canonical.y>>S))}c.key!==t.key&&(y.push(c.key),s=r.getTile(c))}const x=E=>{y.forEach(S=>{a[S]=E}),y.length=0};for(p-=1;p>=g&&(!s||!s.hasData());p--){s&&x(s.tileID.key);const E=c.calculateScaledKey(p);if(s=r.getTileByID(E),s&&s.hasData())break;const S=a[E];if(null===S)break;void 0===S?y.push(E):s=r.getTileByID(S)}return x(s?s.tileID.key:null),s&&s.hasData()?s:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,r){let s=this._tilesDirty[t];s||(s=this._tilesDirty[t]={}),s[r.key]=!0}}function eS(e,t,r){const s=function(p,g,y){const x=Ot.dot(g,p),E=Ot.dot(y,[.2126,.7152,.0722]),S=(D,P,O)=>(1-O)*D+O*P,M=S(1-.3*Math.min(E,1),1,Math.min(x+1,1));return S(.92,1,Math.asin(At(g[2],-1,1))/Math.PI+.5)*M}(e,[0,0,1],t),a=[0,0,0];Ot.scale(a,r.slice(0,3),s);const u=[0,0,0];Ot.scale(u,t.slice(0,3),e[2]);const c=[0,0,0];return Ot.add(c,a,u),Hr(c)}const Y2=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],J2=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class K2{static cacheKey(t,r,s,a){let u=`${r}${a?a.cacheKey:""}`;for(const c of s)t.usedDefines.includes(c)&&(u+=`/${c}`);return u}constructor(t,r,s,a,u,c){const p=t.gl;this.program=p.createProgram(),this.configuration=a,this.name=r,this.fixedDefines=[...c];const g=a?a.getBinderAttributes():[],y=(s.staticAttributes||[]).concat(g);let x=a?a.defines():[];x=x.concat(c.map(O=>`#define ${O}`));const E="#version 300 es\n";let S=E+x.concat("precision mediump float;",qC,GC.fragmentSource).join("\n");for(const O of s.fragmentIncludes)S+=`\n${e0[O]}`;S+=`\n${s.fragmentSource}`;let M=E+x.concat("precision highp float;",qC,GC.vertexSource).join("\n");for(const O of s.vertexIncludes)M+=`\n${e0[O]}`;M+=`\n${s.vertexSource}`;const D=p.createShader(p.FRAGMENT_SHADER);if(p.isContextLost())return void(this.failedToCreate=!0);p.shaderSource(D,S),p.compileShader(D),p.attachShader(this.program,D);const P=p.createShader(p.VERTEX_SHADER);if(p.isContextLost())this.failedToCreate=!0;else{p.shaderSource(P,M),p.compileShader(P),p.attachShader(this.program,P),this.attributes={},this.numAttributes=y.length;for(let O=0;O<this.numAttributes;O++)if(y[O]){const R=y[O].startsWith("a_")?y[O]:`a_${y[O]}`;p.bindAttribLocation(this.program,O,R),this.attributes[R]=O}p.linkProgram(this.program),p.deleteShader(P),p.deleteShader(D),this.fixedUniforms=u(t),this.binderUniforms=a?a.getUniforms(t):[],c.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new Gr(O=t),u_dem_prev:new Gr(O),u_dem_tl:new Fr(O),u_dem_scale:new ln(O),u_dem_tl_prev:new Fr(O),u_dem_scale_prev:new ln(O),u_dem_size:new ln(O),u_dem_lerp:new ln(O),u_exaggeration:new ln(O),u_depth:new Gr(O),u_depth_size_inv:new Fr(O),u_meter_to_dem:new ln(O),u_label_plane_matrix_inv:new br(O)}),c.includes("GLOBE")&&(this.globeUniforms=(O=>({u_tile_tl_up:new vr(O),u_tile_tr_up:new vr(O),u_tile_br_up:new vr(O),u_tile_bl_up:new vr(O),u_tile_up_scale:new ln(O)}))(t)),c.includes("FOG")&&(this.fogUniforms=(O=>({u_fog_matrix:new br(O),u_fog_range:new Fr(O),u_fog_color:new Ga(O),u_fog_horizon_blend:new ln(O),u_fog_vertical_limit:new Fr(O),u_fog_temporal_offset:new ln(O),u_frustum_tl:new vr(O),u_frustum_tr:new vr(O),u_frustum_br:new vr(O),u_frustum_bl:new vr(O),u_globe_pos:new vr(O),u_globe_radius:new ln(O),u_globe_transition:new ln(O),u_is_globe:new Gr(O),u_viewport:new Fr(O)}))(t)),c.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(O=>({u_cutoff_params:new Ga(O)}))(t)),c.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(O=>({u_lighting_ambient_color:new vr(O),u_lighting_directional_dir:new vr(O),u_lighting_directional_color:new vr(O),u_ground_radiance:new vr(O)}))(t)),c.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(O=>({u_light_matrix_0:new br(O),u_light_matrix_1:new br(O),u_fade_range:new Fr(O),u_shadow_normal_offset:new vr(O),u_shadow_intensity:new ln(O),u_shadow_texel_size:new ln(O),u_shadow_map_resolution:new ln(O),u_shadow_direction:new vr(O),u_shadow_bias:new vr(O),u_shadowmap_0:new Gr(O),u_shadowmap_1:new Gr(O)}))(t))}var O}setTerrainUniformValues(t,r){if(!this.terrainUniforms)return;const s=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const a in r)s[a]&&s[a].set(this.program,a,r[a])}}setGlobeUniformValues(t,r){if(!this.globeUniforms)return;const s=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const a in r)s[a]&&s[a].set(this.program,a,r[a])}}setFogUniformValues(t,r){if(!this.fogUniforms)return;const s=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const a in r)s[a].set(this.program,a,r[a])}}setCutoffUniformValues(t,r){if(!this.cutoffUniforms)return;const s=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const a in r)s[a].set(this.program,a,r[a])}}setLightsUniformValues(t,r){if(!this.lightsUniforms)return;const s=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const a in r)s[a].set(this.program,a,r[a])}}setShadowUniformValues(t,r){if(this.failedToCreate||!this.shadowUniforms)return;const s=this.shadowUniforms;t.program.set(this.program);for(const a in r)s[a].set(this.program,a,r[a])}_drawDebugWireframe(t,r,s,a,u,c,p,g,y,x){const E=t.options.wireframe;if(!1===E.terrain&&!1===E.layers2D&&!1===E.layers3D)return;const S=t.context;if(!(()=>!(!E.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!E.layers2D||t._terrain&&t._terrain.renderingToTexture||!Y2.includes(this.name))||!(!E.layers3D||!J2.includes(this.name)))())return;const M=S.gl,D=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,u,S);if(!D)return;const P=[...this.fixedDefines];P.push("DEBUG_WIREFRAME");const O=t.getOrCreateProgram(this.name,{config:this.configuration,defines:P});S.program.set(O.program);const R=(V,U,G)=>{if(U[V]&&G[V])for(const Z in U[V])G[V][Z]&&G[V][Z].set(G.program,Z,U[V][Z].current)};y&&y.setUniforms(O.program,S,O.binderUniforms,p,{zoom:g}),R("fixedUniforms",this,O),R("terrainUniforms",this,O),R("globeUniforms",this,O),R("fogUniforms",this,O),R("lightsUniforms",this,O),R("shadowUniforms",this,O),D.bind(),S.setColorMode(new vi([M.ONE,M.ONE_MINUS_SRC_ALPHA,M.ZERO,M.ONE],pn.transparent,[!0,!0,!0,!1])),S.setDepthMode(new rr(r.func===M.LESS?M.LEQUAL:r.func,rr.ReadOnly,r.range)),S.setStencilMode(jr.disabled);const B=3*c.primitiveLength*2,j=3*c.primitiveOffset*2*2;x&&x>1?M.drawElementsInstanced(M.LINES,B,M.UNSIGNED_SHORT,j,x):M.drawElements(M.LINES,B,M.UNSIGNED_SHORT,j),u.bind(),S.program.set(this.program),S.setDepthMode(r),S.setStencilMode(s),S.setColorMode(a)}draw(t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O){const R=t.context,B=R.gl;if(this.failedToCreate)return;R.program.set(this.program),R.setDepthMode(s),R.setStencilMode(a),R.setColorMode(u),R.setCullFace(c);for(const U of Object.keys(this.fixedUniforms))this.fixedUniforms[U].set(this.program,U,p[U]);D&&D.setUniforms(this.program,R,this.binderUniforms,S,{zoom:M});const j={[B.LINES]:2,[B.TRIANGLES]:3,[B.LINE_STRIP]:1}[r],V=O&&O>0?1:void 0;for(const U of E.get()){const G=U.vaos||(U.vaos={});(G[g]||(G[g]=new H2)).bind(R,this,y,D?D.getPaintVertexBuffers():[],x,U.vertexOffset,P||[],V),O&&O>1?B.drawElementsInstanced(r,U.primitiveLength*j,B.UNSIGNED_SHORT,U.primitiveOffset*j*2,O):B.drawElements(r,U.primitiveLength*j,B.UNSIGNED_SHORT,U.primitiveOffset*j*2),r===B.TRIANGLES&&this._drawDebugWireframe(t,s,a,u,x,U,S,M,D,O)}}}function Q2(e,t){const r=Math.pow(2,t.tileID.overscaledZ),s=t.tileSize*Math.pow(2,e.transform.tileZoom)/r,a=s*(t.tileID.canonical.x+t.tileID.wrap*r),u=s*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/Pd(t,1,e.transform.tileZoom),u_pixel_coord_upper:[a>>16,u>>16],u_pixel_coord_lower:[65535&a,65535&u]}}const tA=ce.create(),nS=(e,t,r,s,a,u,c,p,g,y,x,E,S,M,D,P)=>{const O=t.style.light,R=O.properties.get("position"),B=[R.x,R.y,R.z],j=zl.create();"viewport"===O.properties.get("anchor")&&(zl.fromRotation(j,-t.transform.angle),Ot.transformMat3(B,B,j));const V=O.properties.get("color"),U=t.transform,G={u_matrix:e,u_lightpos:B,u_lightintensity:O.properties.get("intensity"),u_lightcolor:[V.r,V.g,V.b],u_vertical_gradient:+r,u_opacity:s,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:tA,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:a,u_edge_radius:u,u_flood_light_color:E,u_vertical_scale:S,u_flood_light_intensity:M,u_ground_shadow_factor:D,u_emissive_strength:P};return"globe"===U.projection.name&&(G.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],G.u_zoom_transition=g,G.u_inv_rot_matrix=x,G.u_merc_center=y,G.u_up_dir=U.projection.upVector(new Vu(0,0,0),y[0]*$t,y[1]*$t),G.u_height_lift=p),G},eA=(e,t,r)=>({u_matrix:e,u_edge_radius:t,u_vertical_scale:r}),nA=(e,t,r,s,a,u,c,p,g,y,x,E,S,M)=>{const D=nS(e,t,r,s,a,u,c,g,y,x,E,S,M,1,[0,0,0],0),P={u_height_factor:-Math.pow(2,c.overscaledZ)/p.tileSize/8};return pe(D,Q2(t,p),P)},rS=(e,t)=>({u_matrix:e,u_emissive_strength:t}),hm=(e,t,r,s)=>pe(rS(e,t),Q2(r,s)),rA=(e,t,r)=>({u_matrix:e,u_world:r,u_emissive_strength:t}),kx=(e,t,r,s,a)=>pe(hm(e,t,r,s),{u_world:a}),iA=(e,t,r,s)=>{const a=$t/r.tileSize;return{u_matrix:e,u_camera_to_center_distance:t.getCameraToCenterDistance(s),u_extrude_scale:[t.pixelsToGLUnits[0]/a,t.pixelsToGLUnits[1]/a]}},oA=(e,t,r=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:r}),sA=ce.create(),uO=(e,t,r,s,a,u,c)=>{const p=e.transform,g="globe"===p.projection.name,y=g?cE(p.zoom,t.canonical)*p._pixelsPerMercatorPixel:Pd(r,1,u),x={u_matrix:t.projMatrix,u_extrude_scale:y,u_intensity:c,u_inv_rot_matrix:sA,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(g){x.u_inv_rot_matrix=s,x.u_merc_center=a,x.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],x.u_zoom_transition=da(p.zoom);const E=a[0]*$t,S=a[1]*$t;x.u_up_dir=p.projection.upVector(new Vu(0,0,0),E,S)}return x},gh=(e,t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O,R,B,j,V,U)=>{return{u_matrix:e,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:s,u_grid_matrix:a,u_tl_parent:u,u_scale_parent:x,u_fade_t:E.mix,u_opacity:E.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(Z=S.paint.get("raster-saturation"),Z>0?1-1/(1.001-Z):-Z),u_contrast_factor:(G=S.paint.get("raster-contrast"),G>0?1/(1-G):1+G),u_spin_weights:aA(S.paint.get("raster-hue-rotate")),u_perspective_transform:M,u_raster_elevation:D,u_tl_br:c,u_zoom_transition:p,u_merc_center:g,u_cutoff_params:y,u_colorization_mix:lA(O,B),u_colorization_offset:uA(R,B),u_color_ramp:P,u_texture_offset:[V/(j+2*V),j/(j+2*V)],u_texture_res:[j+2*V,j+2*V],u_emissive_strength:U};var G,Z};function aA(e){e*=Math.PI/180;const t=Math.sin(e),r=Math.cos(e);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}function lA([e,t,r,s],[a,u]){if(a===u)return[0,0,0,0];const c=259/257/(u-a);return[e*c,t*c,r*c,s*c]}function uA(e,[t,r]){return t===r?0:((e-t)/(r-t)*259-1)/257}const Xg=ce.create(),zx=(e,t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O,R)=>{const B=a.transform,j={u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:B.getCameraToCenterDistance(P),u_rotate_symbol:+r,u_aspect_ratio:B.width/B.height,u_fade_change:a.options.fadeDuration?a.symbolFadeChange:1,u_matrix:u,u_label_plane_matrix:c,u_coord_matrix:p,u_is_text:+g,u_pitch_with_map:+s,u_texsize:y,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Xg,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Xg,u_up_vector:[0,-1,0],u_icon_transition:R||0,u_icon_saturation:O};return"globe"===P.name&&(j.u_tile_id=[x.canonical.x,x.canonical.y,1<<x.canonical.z],j.u_zoom_transition=E,j.u_inv_rot_matrix=M,j.u_merc_center=S,j.u_camera_forward=B._camera.forward(),j.u_ecef_origin=function(V,U){const G=[0,0,0],Z=id(Gu(U.canonical));return Ot.transformMat4(G,G,Z),Ot.transformMat4(G,G,V),G}(B.globeMatrix,x.toUnwrapped()),j.u_tile_matrix=Float32Array.from(B.globeMatrix),j.u_up_vector=D),j},iS=(e,t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O)=>pe(zx(e,t,r,s,a,u,c,p,g,y,E,S,M,D,P,O,1),{u_gamma_scale:s?a.transform.getCameraToCenterDistance(O)*Math.cos(a.terrain?0:a.transform._pitch):1,u_device_pixel_ratio:or.devicePixelRatio,u_is_halo:+x,undefined:void 0}),oS=(e,t,r,s,a,u,c,p,g,y,x,E,S,M,D,P)=>pe(iS(e,t,r,s,a,u,c,p,!0,g,!0,x,E,S,M,D,P),{u_texsize_icon:y,u_texture_icon:1}),r0=(e,t,r,s)=>({u_matrix:e,u_emissive_strength:t,u_opacity:r,u_color:s}),cA=(e,t,r,s,a,u,c)=>pe(function(p,g,y,x){const E=y.imageManager.getPattern(p.toString(),g),{width:S,height:M}=y.imageManager.getPixelSize(g),D=Math.pow(2,x.tileID.overscaledZ),P=x.tileSize*Math.pow(2,y.transform.tileZoom)/D,O=P*(x.tileID.canonical.x+x.tileID.wrap*D),R=P*x.tileID.canonical.y;return{u_image:0,u_pattern_tl:E.tl,u_pattern_br:E.br,u_texsize:[S,M],u_pattern_size:E.displaySize,u_tile_units_to_pixels:1/Pd(x,1,y.transform.tileZoom),u_pixel_coord_upper:[O>>16,R>>16],u_pixel_coord_lower:[65535&O,65535&R]}}(a,u,s,c),{u_matrix:e,u_emissive_strength:t,u_opacity:r}),vu={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},o0=(e,t,r,s,a,u,c,p,g,y,x,E,S=[0,0,0])=>{const M=s.style.light,D=M.properties.get("position"),P=[-D.x,-D.y,D.z],O=zl.create();"viewport"===M.properties.get("anchor")&&(zl.fromRotation(O,-s.transform.angle),Ot.transformMat3(P,P,O));const R="MASK"===y.alphaMode,B=M.properties.get("color"),j=E.paint.get("model-ambient-occlusion-intensity"),V=E.paint.get("model-color").constantOr(pn.white),U=E.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:e,u_lighting_matrix:t,u_normal_matrix:r,u_lightpos:P,u_lightintensity:M.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_camera_pos:S,u_opacity:a,u_baseTextureIsAlpha:0,u_alphaMask:+R,u_alphaCutoff:y.alphaCutoff,u_baseColorFactor:[u.r,u.g,u.b,u.a],u_emissiveFactor:[c[0],c[1],c[2],1],u_metallicFactor:p,u_roughnessFactor:g,u_baseColorTexture:vu.BaseColor,u_metallicRoughnessTexture:vu.MetallicRoughness,u_normalTexture:vu.Normal,u_occlusionTexture:vu.Occlusion,u_emissionTexture:vu.Emission,u_color_mix:[V.r,V.g,V.b,U],u_aoIntensity:j,u_emissive_strength:x}},sS=new Float32Array(16),aS=(e,t=sS,r=sS)=>({u_matrix:e,u_instance:t,u_node_matrix:r}),lS={fillExtrusion:e=>({u_matrix:new br(e),u_lightpos:new vr(e),u_lightintensity:new ln(e),u_lightcolor:new vr(e),u_vertical_gradient:new ln(e),u_opacity:new ln(e),u_edge_radius:new ln(e),u_ao:new Fr(e),u_tile_id:new vr(e),u_zoom_transition:new ln(e),u_inv_rot_matrix:new br(e),u_merc_center:new Fr(e),u_up_dir:new vr(e),u_height_lift:new ln(e),u_flood_light_color:new vr(e),u_vertical_scale:new ln(e),u_flood_light_intensity:new ln(e),u_ground_shadow_factor:new vr(e),u_emissive_strength:new ln(e)}),fillExtrusionDepth:e=>({u_matrix:new br(e),u_edge_radius:new ln(e),u_vertical_scale:new ln(e)}),fillExtrusionPattern:e=>({u_matrix:new br(e),u_lightpos:new vr(e),u_lightintensity:new ln(e),u_lightcolor:new vr(e),u_vertical_gradient:new ln(e),u_height_factor:new ln(e),u_edge_radius:new ln(e),u_ao:new Fr(e),u_tile_id:new vr(e),u_zoom_transition:new ln(e),u_inv_rot_matrix:new br(e),u_merc_center:new Fr(e),u_up_dir:new vr(e),u_height_lift:new ln(e),u_image:new Gr(e),u_texsize:new Fr(e),u_pixel_coord_upper:new Fr(e),u_pixel_coord_lower:new Fr(e),u_tile_units_to_pixels:new ln(e),u_opacity:new ln(e)}),fillExtrusionGroundEffect:e=>({u_matrix:new br(e),u_opacity:new ln(e),u_ao_pass:new ln(e),u_meter_to_tile:new ln(e),u_ao:new Fr(e),u_flood_light_intensity:new ln(e),u_flood_light_color:new vr(e),u_attenuation:new ln(e),u_edge_radius:new ln(e),u_fb:new Gr(e),u_fb_size:new ln(e)}),fill:e=>({u_matrix:new br(e),u_emissive_strength:new ln(e)}),fillPattern:e=>({u_matrix:new br(e),u_emissive_strength:new ln(e),u_image:new Gr(e),u_texsize:new Fr(e),u_pixel_coord_upper:new Fr(e),u_pixel_coord_lower:new Fr(e),u_tile_units_to_pixels:new ln(e)}),fillOutline:e=>({u_matrix:new br(e),u_emissive_strength:new ln(e),u_world:new Fr(e)}),fillOutlinePattern:e=>({u_matrix:new br(e),u_emissive_strength:new ln(e),u_world:new Fr(e),u_image:new Gr(e),u_texsize:new Fr(e),u_pixel_coord_upper:new Fr(e),u_pixel_coord_lower:new Fr(e),u_tile_units_to_pixels:new ln(e)}),circle:e=>({u_camera_to_center_distance:new ln(e),u_extrude_scale:new bw(e),u_device_pixel_ratio:new ln(e),u_matrix:new br(e),u_inv_rot_matrix:new br(e),u_merc_center:new Fr(e),u_tile_id:new vr(e),u_zoom_transition:new ln(e),u_up_dir:new vr(e),u_emissive_strength:new ln(e)}),collisionBox:e=>({u_matrix:new br(e),u_camera_to_center_distance:new ln(e),u_extrude_scale:new Fr(e)}),collisionCircle:e=>({u_matrix:new br(e),u_inv_matrix:new br(e),u_camera_to_center_distance:new ln(e),u_viewport_size:new Fr(e)}),debug:e=>({u_color:new Dc(e),u_matrix:new br(e),u_overlay:new Gr(e),u_overlay_scale:new ln(e)}),clippingMask:e=>({u_matrix:new br(e)}),heatmap:e=>({u_extrude_scale:new ln(e),u_intensity:new ln(e),u_matrix:new br(e),u_inv_rot_matrix:new br(e),u_merc_center:new Fr(e),u_tile_id:new vr(e),u_zoom_transition:new ln(e),u_up_dir:new vr(e)}),heatmapTexture:e=>({u_image:new Gr(e),u_color_ramp:new Gr(e),u_opacity:new ln(e)}),hillshade:e=>({u_matrix:new br(e),u_image:new Gr(e),u_latrange:new Fr(e),u_light:new Fr(e),u_shadow:new Dc(e),u_highlight:new Dc(e),u_emissive_strength:new ln(e),u_accent:new Dc(e)}),hillshadePrepare:e=>({u_matrix:new br(e),u_image:new Gr(e),u_dimension:new Fr(e),u_zoom:new ln(e)}),line:e=>({u_matrix:new br(e),u_pixels_to_tile_units:new bw(e),u_device_pixel_ratio:new ln(e),u_units_to_pixels:new Fr(e),u_dash_image:new Gr(e),u_gradient_image:new Gr(e),u_image_height:new ln(e),u_texsize:new Fr(e),u_tile_units_to_pixels:new ln(e),u_alpha_discard_threshold:new ln(e),u_trim_offset:new Fr(e),u_emissive_strength:new ln(e)}),linePattern:e=>({u_matrix:new br(e),u_texsize:new Fr(e),u_pixels_to_tile_units:new bw(e),u_device_pixel_ratio:new ln(e),u_image:new Gr(e),u_units_to_pixels:new Fr(e),u_tile_units_to_pixels:new ln(e),u_alpha_discard_threshold:new ln(e)}),raster:e=>({u_matrix:new br(e),u_normalize_matrix:new br(e),u_globe_matrix:new br(e),u_merc_matrix:new br(e),u_grid_matrix:new xw(e),u_tl_parent:new Fr(e),u_scale_parent:new ln(e),u_fade_t:new ln(e),u_opacity:new ln(e),u_image0:new Gr(e),u_image1:new Gr(e),u_brightness_low:new ln(e),u_brightness_high:new ln(e),u_saturation_factor:new ln(e),u_contrast_factor:new ln(e),u_spin_weights:new vr(e),u_perspective_transform:new Fr(e),u_raster_elevation:new ln(e),u_tl_br:new Ga(e),u_zoom_transition:new ln(e),u_merc_center:new Fr(e),u_cutoff_params:new Ga(e),u_colorization_mix:new Ga(e),u_colorization_offset:new ln(e),u_color_ramp:new Gr(e),u_texture_offset:new Fr(e),u_texture_res:new Fr(e),u_emissive_strength:new ln(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new Gr(e),u_is_size_feature_constant:new Gr(e),u_size_t:new ln(e),u_size:new ln(e),u_camera_to_center_distance:new ln(e),u_rotate_symbol:new Gr(e),u_aspect_ratio:new ln(e),u_fade_change:new ln(e),u_matrix:new br(e),u_label_plane_matrix:new br(e),u_coord_matrix:new br(e),u_is_text:new Gr(e),u_pitch_with_map:new Gr(e),u_texsize:new Fr(e),u_tile_id:new vr(e),u_zoom_transition:new ln(e),u_inv_rot_matrix:new br(e),u_merc_center:new Fr(e),u_camera_forward:new vr(e),u_tile_matrix:new br(e),u_up_vector:new vr(e),u_ecef_origin:new vr(e),u_texture:new Gr(e),u_icon_transition:new ln(e),u_icon_saturation:new ln(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new Gr(e),u_is_size_feature_constant:new Gr(e),u_size_t:new ln(e),u_size:new ln(e),u_camera_to_center_distance:new ln(e),u_rotate_symbol:new Gr(e),u_aspect_ratio:new ln(e),u_fade_change:new ln(e),u_matrix:new br(e),u_label_plane_matrix:new br(e),u_coord_matrix:new br(e),u_is_text:new Gr(e),u_pitch_with_map:new Gr(e),u_texsize:new Fr(e),u_texture:new Gr(e),u_gamma_scale:new ln(e),u_device_pixel_ratio:new ln(e),u_tile_id:new vr(e),u_zoom_transition:new ln(e),u_inv_rot_matrix:new br(e),u_merc_center:new Fr(e),u_camera_forward:new vr(e),u_tile_matrix:new br(e),u_up_vector:new vr(e),u_ecef_origin:new vr(e),u_is_halo:new Gr(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new Gr(e),u_is_size_feature_constant:new Gr(e),u_size_t:new ln(e),u_size:new ln(e),u_camera_to_center_distance:new ln(e),u_rotate_symbol:new Gr(e),u_aspect_ratio:new ln(e),u_fade_change:new ln(e),u_matrix:new br(e),u_label_plane_matrix:new br(e),u_coord_matrix:new br(e),u_is_text:new Gr(e),u_pitch_with_map:new Gr(e),u_texsize:new Fr(e),u_texsize_icon:new Fr(e),u_texture:new Gr(e),u_texture_icon:new Gr(e),u_gamma_scale:new ln(e),u_device_pixel_ratio:new ln(e),u_is_halo:new Gr(e)}),background:e=>({u_matrix:new br(e),u_emissive_strength:new ln(e),u_opacity:new ln(e),u_color:new Dc(e)}),backgroundPattern:e=>({u_matrix:new br(e),u_emissive_strength:new ln(e),u_opacity:new ln(e),u_image:new Gr(e),u_pattern_tl:new Fr(e),u_pattern_br:new Fr(e),u_texsize:new Fr(e),u_pattern_size:new Fr(e),u_pixel_coord_upper:new Fr(e),u_pixel_coord_lower:new Fr(e),u_tile_units_to_pixels:new ln(e)}),terrainRaster:HC,terrainDepth:HC,skybox:e=>({u_matrix:new br(e),u_sun_direction:new vr(e),u_cubemap:new Gr(e),u_opacity:new ln(e),u_temporal_offset:new ln(e)}),skyboxGradient:e=>({u_matrix:new br(e),u_color_ramp:new Gr(e),u_center_direction:new vr(e),u_radius:new ln(e),u_opacity:new ln(e),u_temporal_offset:new ln(e)}),skyboxCapture:e=>({u_matrix_3f:new xw(e),u_sun_direction:new vr(e),u_sun_intensity:new ln(e),u_color_tint_r:new Ga(e),u_color_tint_m:new Ga(e),u_luminance:new ln(e)}),globeRaster:e=>({u_proj_matrix:new br(e),u_globe_matrix:new br(e),u_normalize_matrix:new br(e),u_merc_matrix:new br(e),u_zoom_transition:new ln(e),u_merc_center:new Fr(e),u_image0:new Gr(e),u_grid_matrix:new xw(e),u_skirt_height:new ln(e),u_frustum_tl:new vr(e),u_frustum_tr:new vr(e),u_frustum_br:new vr(e),u_frustum_bl:new vr(e),u_globe_pos:new vr(e),u_globe_radius:new ln(e),u_viewport:new Fr(e)}),globeAtmosphere:e=>({u_frustum_tl:new vr(e),u_frustum_tr:new vr(e),u_frustum_br:new vr(e),u_frustum_bl:new vr(e),u_horizon:new ln(e),u_transition:new ln(e),u_fadeout_range:new ln(e),u_color:new Ga(e),u_high_color:new Ga(e),u_space_color:new Ga(e),u_temporal_offset:new ln(e),u_horizon_angle:new ln(e)}),model:e=>({u_matrix:new br(e),u_lighting_matrix:new br(e),u_normal_matrix:new br(e),u_lightpos:new vr(e),u_lightintensity:new ln(e),u_lightcolor:new vr(e),u_camera_pos:new vr(e),u_opacity:new ln(e),u_baseColorFactor:new Ga(e),u_emissiveFactor:new Ga(e),u_metallicFactor:new ln(e),u_roughnessFactor:new ln(e),u_baseTextureIsAlpha:new Gr(e),u_alphaMask:new Gr(e),u_alphaCutoff:new ln(e),u_baseColorTexture:new Gr(e),u_metallicRoughnessTexture:new Gr(e),u_normalTexture:new Gr(e),u_occlusionTexture:new Gr(e),u_emissionTexture:new Gr(e),u_color_mix:new Ga(e),u_aoIntensity:new ln(e),u_emissive_strength:new ln(e)}),modelDepth:e=>({u_matrix:new br(e),u_instance:new br(e),u_node_matrix:new br(e)}),groundShadow:e=>({u_matrix:new br(e),u_ground_shadow_factor:new vr(e)}),stars:e=>({u_matrix:new br(e),u_up:new vr(e),u_right:new vr(e),u_intensity_multiplier:new ln(e)})};let Zu;function uS(e,t,r,s,a,u,c){const p=e.context,g=p.gl,y=e.transform,x=e.getOrCreateProgram("collisionBox"),E=[];let S=0,M=0;for(let V=0;V<s.length;V++){const U=s[V],G=t.getTile(U),Z=G.getBucket(r);if(!Z)continue;const Q=N2(U,Z,y);let et=Q;0===a[0]&&0===a[1]||(et=e.translatePosMatrix(Q,G,a,u));const it=c?Z.textCollisionBox:Z.iconCollisionBox,yt=Z.collisionCircleArray;if(yt.length>0){const xt=ce.create(),Nt=et;ce.mul(xt,Z.placementInvProjMatrix,y.glCoordMatrix),ce.mul(xt,xt,Z.placementViewportMatrix),E.push({circleArray:yt,circleOffset:M,transform:Nt,invTransform:xt,projection:Z.getProjection()}),S+=yt.length/4,M=S}it&&(e.terrain&&e.terrain.setupElevationDraw(G,x),x.draw(e,g.LINES,rr.disabled,jr.disabled,e.colorModeForRenderPass(),zr.disabled,iA(et,y,G,Z.getProjection()),r.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,null,y.zoom,null,[it.collisionVertexBuffer,it.collisionVertexBufferExt]))}if(!c||!E.length)return;const D=e.getOrCreateProgram("collisionCircle"),P=new uf;P.resize(4*S),P._trim();let O=0;for(const V of E)for(let U=0;U<V.circleArray.length/4;U++){const G=4*U,Z=V.circleArray[G+0],Q=V.circleArray[G+1],et=V.circleArray[G+2],it=V.circleArray[G+3];P.emplace(O++,Z,Q,et,it,0),P.emplace(O++,Z,Q,et,it,1),P.emplace(O++,Z,Q,et,it,2),P.emplace(O++,Z,Q,et,it,3)}(!Zu||Zu.length<2*S)&&(Zu=function(V){const U=2*V,G=new ea;G.resize(U),G._trim();for(let Z=0;Z<U;Z++){const Q=6*Z;G.uint16[Q+0]=4*Z+0,G.uint16[Q+1]=4*Z+1,G.uint16[Q+2]=4*Z+2,G.uint16[Q+3]=4*Z+2,G.uint16[Q+4]=4*Z+3,G.uint16[Q+5]=4*Z+0}return G}(S));const R=p.createIndexBuffer(Zu,!0),B=p.createVertexBuffer(P,VE.members,!0);for(const V of E){const U={u_matrix:V.transform,u_inv_matrix:V.invTransform,u_camera_to_center_distance:(j=y).getCameraToCenterDistance(V.projection),u_viewport_size:[j.width,j.height]};D.draw(e,g.TRIANGLES,rr.disabled,jr.disabled,e.colorModeForRenderPass(),zr.disabled,U,r.id,B,R,Ui.simpleSegment(0,2*V.circleOffset,V.circleArray.length,V.circleArray.length/2),null,y.zoom)}var j;B.destroy(),R.destroy()}const cS=ce.create();function hS({width:e,height:t,anchor:r,textOffset:s,textScale:a},u){const{horizontalAlign:c,verticalAlign:p}=vy(r),g=-(c-.5)*e,y=-(p-.5)*t,x=oI(r,s);return new H((g/a+x[0])*u,(y/a+x[1])*u)}function fS(e,t,r,s,a,u,c,p,g,y,x){const E=e.text.placedSymbolArray,S=e.text.dynamicLayoutVertexArray,M=e.icon.dynamicLayoutVertexArray,D={},P=e.getProjection(),O=Jy(p,P,u),R=u.elevation,B=P.upVectorScale(p.canonical,u.center.lat,u.worldSize).metersToTile;S.clear();for(let j=0;j<E.length;j++){const V=E.get(j),{tileAnchorX:U,tileAnchorY:G,numGlyphs:Z}=V,Q=V.hidden||!V.crossTileID||e.allowVerticalPlacement&&!V.placedOrientation?null:s[V.crossTileID];if(Q){let et=0,it=0,yt=0;if(R){const ge=R?R.getAtTileOffset(p,U,G):0,[be,xe,Re]=P.upVector(p.canonical,U,G);et=ge*be*B,it=ge*xe*B,yt=ge*Re*B}let[xt,Nt,ft,Ut]=kc(V.projectedAnchorX+et,V.projectedAnchorY+it,V.projectedAnchorZ+yt,r?O:c);const Wt=O1(u.getCameraToCenterDistance(P),Ut);let le=a.evaluateSizeForFeature(e.textSizeData,y,V)*Wt/Oa;r&&(le*=e.tilePixelRatio/g);const Bt=hS(Q,le);r?(({x:xt,y:Nt,z:ft}=P.projectTilePoint(U+Bt.x,G+Bt.y,p.canonical)),[xt,Nt,ft]=kc(xt+et,Nt+it,ft+yt,c)):(t&&Bt._rotate(-u.angle),xt+=Bt.x,Nt+=Bt.y,ft=0);const Zt=e.allowVerticalPlacement&&V.placedOrientation===Zo.vertical?Math.PI/2:0;for(let ge=0;ge<Z;ge++)zp(S,xt,Nt,ft,Zt);x&&V.associatedIconIndex>=0&&(D[V.associatedIconIndex]={x:xt,y:Nt,z:ft,angle:Zt})}else Ld(Z,S)}if(x){M.clear();const j=e.icon.placedSymbolArray;for(let V=0;V<j.length;V++){const U=j.get(V),{numGlyphs:G}=U,Z=D[V];if(U.hidden||!Z)Ld(G,M);else{const{x:Q,y:et,z:it,angle:yt}=Z;for(let xt=0;xt<G;xt++)zp(M,Q,et,it,yt)}}e.icon.dynamicLayoutVertexBuffer.updateData(M)}e.text.dynamicLayoutVertexBuffer.updateData(S)}function Bx(e,t,r){return r.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function Ux(e,t,r,s,a,u,c,p,g,y,x,E,S){const M=e.context,D=M.gl,P=e.transform,O="map"===p,R="map"===g,B=O&&"point"!==r.layout.get("symbol-placement"),j=O&&!R&&!B,V=void 0!==r.layout.get("symbol-sort-key").constantOr(1);let U=!1;const G=e.depthModeForSublayer(0,rr.ReadOnly),Z=[zs(P.center.lng),ba(P.center.lat)],Q=r.layout.get("text-variable-anchor"),et="globe"===P.projection.name,it=[],yt=[0,-1,0];let xt=yt;!et&&!P.mercatorFromTransition||O||(xt=function(Nt){const ft=Nt._camera.getWorldToCamera(Nt.worldSize,1),Ut=ce.multiply([],ft,Nt.globeMatrix);ce.invert(Ut,Ut);const Wt=[0,0,0],le=[0,1,0,0];return Oi.transformMat4(le,le,Ut),Wt[0]=le[0],Wt[1]=le[1],Wt[2]=le[2],Ot.normalize(Wt,Wt),Wt}(P));for(const Nt of s){const ft=t.getTile(Nt),Ut=ft.getBucket(r);if(!Ut||"mercator"===Ut.projection.name&&et)continue;const Wt=a?Ut.text:Ut.icon;if(!Wt||Ut.fullyClipped||!Wt.segments.get().length)continue;const le=Wt.programConfigurations.get(r.id),Bt=a||Ut.sdfIcons,Zt=a?Ut.textSizeData:Ut.iconSizeData,ge=R||0!==P.pitch,be=lh(Zt,P.zoom);let xe,Re,ze,$e,Ie=[0,0],on=null;if(a)Re=ft.glyphAtlasTexture?ft.glyphAtlasTexture:null,ze=D.LINEAR,xe=ft.glyphAtlasTexture?ft.glyphAtlasTexture.size:[0,0],Ut.iconsInText&&(Ie=ft.imageAtlasTexture?ft.imageAtlasTexture.size:[0,0],on=ft.imageAtlasTexture?ft.imageAtlasTexture:null,$e=ge||e.options.rotating||e.options.zooming||"composite"===Zt.kind||"camera"===Zt.kind?D.LINEAR:D.NEAREST);else{const jo=1!==r.layout.get("icon-size").constantOr(0)||Ut.iconsNeedLinear;Re=ft.imageAtlasTexture?ft.imageAtlasTexture:null,ze=Bt||e.options.rotating||e.options.zooming||jo||ge?D.LINEAR:D.NEAREST,xe=ft.imageAtlasTexture?ft.imageAtlasTexture.size:[0,0]}const vn="globe"===Ut.projection.name,xn=vn?xt:yt,Cn=vn?da(P.zoom):0,Mn=Jy(Nt,Ut.getProjection(),P),hr=P.calculatePixelsToTileUnitsMatrix(ft),qn=Ag(Mn,ft.tileID.canonical,R,O,P,Ut.getProjection(),hr),xi=e.terrain&&R&&B?ce.invert(ce.create(),qn):cS,Xr=L1(Mn,ft.tileID.canonical,R,O,P,Ut.getProjection(),hr),fr=Q&&Ut.hasTextData(),ir=Ut.hasIconTextFit()&&fr&&Ut.hasIconData();if(B){const jo=P.elevation,Ai=jo?jo.getAtTileOffsetFunc(Nt,P.center.lat,P.worldSize,Ut.getProjection()):null,Wa=P1(Mn,ft.tileID.canonical,R,O,P,Ut.getProjection(),hr);FI(Ut,Mn,e,a,Wa,Xr,R,y,Ai,Nt)}const Wn=B||a&&Q||ir,Yr=e.translatePosMatrix(Mn,ft,u,c),ai=Wn?cS:qn,Pr=e.translatePosMatrix(Xr,ft,u,c,!0),Ci=Ut.getProjection().createInversionMatrix(P,Nt.canonical),Ds=r.paint.get("icon-image-cross-fade").constantOr(0),ki=[];e.terrainRenderModeElevated()&&R&&ki.push("PITCH_WITH_MAP_TERRAIN"),vn&&(ki.push("PROJECTION_GLOBE_VIEW"),Wn&&ki.push("PROJECTED_POS_ON_VIEWPORT")),Ds>0&&ki.push("ICON_TRANSITION"),Wt.zOffsetVertexBuffer&&ki.push("Z_OFFSET");const Ro=Bt&&0!==r.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1);let Us;Bt?Us=Ut.iconsInText?oS(Zt.kind,be,j,R,e,Yr,ai,Pr,xe,Ie,Nt,Cn,Z,Ci,xn,Ut.getProjection()):iS(Zt.kind,be,j,R,e,Yr,ai,Pr,a,xe,!0,Nt,Cn,Z,Ci,xn,Ut.getProjection()):(x<1&&ki.push("SATURATION"),Us=zx(Zt.kind,be,j,R,e,Yr,ai,Pr,a,xe,Nt,Cn,Z,Ci,xn,Ut.getProjection(),x,Ds));const Es={program:e.getOrCreateProgram(Bx(Bt,a,Ut),{config:le,defines:ki}),buffers:Wt,uniformValues:Us,atlasTexture:Re,atlasTextureIcon:on,atlasInterpolation:ze,atlasInterpolationIcon:$e,isSDF:Bt,hasHalo:Ro,tile:ft,labelPlaneMatrixInv:xi};if(V&&Ut.canOverlap){U=!0;const jo=Wt.segments.get();for(const Ai of jo)it.push({segments:new Ui([Ai]),sortKey:Ai.sortKey,state:Es})}else it.push({segments:Wt.segments,sortKey:0,state:Es})}U&&it.sort((Nt,ft)=>Nt.sortKey-ft.sortKey);for(const Nt of it){const ft=Nt.state;if(e.terrain&&e.terrain.setupElevationDraw(ft.tile,ft.program,{useDepthForOcclusion:P.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ft.labelPlaneMatrixInv}),M.activeTexture.set(D.TEXTURE0),ft.atlasTexture&&ft.atlasTexture.bind(ft.atlasInterpolation,D.CLAMP_TO_EDGE),ft.atlasTextureIcon&&(M.activeTexture.set(D.TEXTURE1),ft.atlasTextureIcon&&ft.atlasTextureIcon.bind(ft.atlasInterpolationIcon,D.CLAMP_TO_EDGE)),e.uploadCommonLightUniforms(e.context,ft.program),ft.hasHalo){const Ut=ft.uniformValues;Ut.u_is_halo=1,jx(ft.buffers,Nt.segments,r,e,ft.program,G,E,S,Ut,2),Ut.u_is_halo=0}else{if(ft.isSDF){const Ut=ft.uniformValues;ft.hasHalo&&(Ut.u_is_halo=1,jx(ft.buffers,Nt.segments,r,e,ft.program,G,E,S,Ut,1)),Ut.u_is_halo=0}jx(ft.buffers,Nt.segments,r,e,ft.program,G,E,S,ft.uniformValues,1)}}}function jx(e,t,r,s,a,u,c,p,g,y){const x=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];a.draw(s,s.context.gl.TRIANGLES,u,c,p,zr.disabled,g,r.id,e.layoutVertexBuffer,e.indexBuffer,t,r.paint,s.transform.zoom,e.programConfigurations.get(r.id),x,y)}function Vx(e,t,r,s,a,u,c){const p=e.context.gl,g=r.paint.get("fill-pattern"),y=g&&g.constantOr(1);let x,E,S,M,D;c?(E=y&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",x=p.LINES):(E=y?"fillPattern":"fill",x=p.TRIANGLES);for(const P of s){const O=t.getTile(P);if(y&&!O.patternsLoaded())continue;const R=O.getBucket(r);if(!R)continue;e.prepareDrawTile();const B=R.programConfigurations.get(r.id),j=e.isTileAffectedByFog(P),V=e.getOrCreateProgram(E,{config:B,overrideFog:j});y&&(e.context.activeTexture.set(p.TEXTURE0),O.imageAtlasTexture&&O.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),B.updatePaintBuffers());const U=g.constantOr(null);if(U&&O.imageAtlas){const Q=O.imageAtlas.patternPositions[U.toString()];Q&&B.setConstantPatternPositions(Q)}const G=e.translatePosMatrix(P.projMatrix,O,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor")),Z=r.paint.get("fill-emissive-strength");if(c){M=R.indexBuffer2,D=R.segments2;const Q=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[p.drawingBufferWidth,p.drawingBufferHeight];S="fillOutlinePattern"===E&&y?kx(G,Z,e,O,Q):rA(G,Z,Q)}else M=R.indexBuffer,D=R.segments,S=y?hm(G,Z,e,O):rS(G,Z);e.uploadCommonUniforms(e.context,V,P.toUnwrapped()),V.draw(e,x,a,e.stencilModeForClipping(P),u,zr.disabled,S,r.id,R.layoutVertexBuffer,M,D,r.paint,e.transform.zoom,B,void 0)}}function Yg(e,t,r,s,a,u,c,p){r.resetLayerRenderingStats();const g=e.context,y=g.gl,x=e.transform,E=r.paint.get("fill-extrusion-pattern"),S=E.constantOr(1),M=r.paint.get("fill-extrusion-opacity"),D=e.style.enable3dLights(),P=r.paint.get(D&&!S?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),O=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),P],R=r.layout.get("fill-extrusion-edge-radius"),B=R>0&&!r.paint.get("fill-extrusion-rounded-roof"),j=B?0:R,V="globe"===x.projection.name?Gy():0,U="globe"===x.projection.name,G=U?da(x.zoom):0,Z=[zs(x.center.lng),ba(x.center.lat)],Q=r.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),et=r.paint.get("fill-extrusion-flood-light-intensity"),it=r.paint.get("fill-extrusion-vertical-scale"),yt=lm(e,r.paint.get("fill-extrusion-cutoff-fade-range")),xt=r.paint.get("fill-extrusion-emissive-strength"),Nt=[];let ft;U&&Nt.push("PROJECTION_GLOBE_VIEW"),O[0]>0&&Nt.push("FAUX_AO"),B&&Nt.push("ZERO_ROOF_RADIUS"),p&&Nt.push("HAS_CENTROID"),et>0&&Nt.push("FLOOD_LIGHT"),yt.shouldRenderCutoff&&Nt.push("RENDER_CUTOFF");const Ut="shadow"===e.renderPass,Wt=e.shadowRenderer,le=Ut&&!!Wt;e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0);let Bt=[0,0,0];if(Wt){const be=e.style.directionalLight,xe=e.style.ambientLight;be&&xe&&(Bt=wS(be,xe)),ft=Nt.concat(["SHADOWS_SINGLE_CASCADE"])}const Zt=le?"fillExtrusionDepth":S?"fillExtrusionPattern":"fillExtrusion",ge=r.getLayerRenderingStats();for(const be of s){const xe=t.getTile(be),Re=xe.getBucket(r);if(!Re||Re.projection.name!==x.projection.name)continue;let ze=!1;Wt&&(ze=0===Wt.getMaxCascadeForTile(be.toUnwrapped()));const $e=e.isTileAffectedByFog(be),Ie=Re.programConfigurations.get(r.id),on=e.getOrCreateProgram(Zt,{config:Ie,defines:ze?ft:Nt,overrideFog:$e});if(e.terrain&&e.terrain.setupElevationDraw(xe,on,{useMeterToDem:!0}),!Re.centroidVertexBuffer){const qn=on.attributes.a_centroid_pos;void 0!==qn&&y.vertexAttrib2f(qn,0,0)}!Ut&&Wt&&Wt.setupShadows(xe.tileID.toUnwrapped(),on,"vector-tile",xe.tileID.overscaledZ),S&&(e.context.activeTexture.set(y.TEXTURE0),xe.imageAtlasTexture&&xe.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),Ie.updatePaintBuffers());const vn=E.constantOr(null);if(vn&&xe.imageAtlas){const qn=xe.imageAtlas.patternPositions[vn.toString()];qn&&Ie.setConstantPatternPositions(qn)}const xn=r.paint.get("fill-extrusion-vertical-gradient");let Cn;if(Ut&&Wt){if($x(xe.tileID,Re,e))continue;const qn=Wt.calculateShadowPassMatrixFromTile(xe.tileID.toUnwrapped());Cn=eA(qn,j,it)}else{const qn=e.translatePosMatrix(be.expandedProjMatrix,xe,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),xi=x.projection.createInversionMatrix(x,be.canonical);Cn=S?nA(qn,e,xn,M,O,j,be,xe,V,G,Z,xi,Q,it):nS(qn,e,xn,M,O,j,be,V,G,Z,xi,Q,it,et,Bt,xt)}e.uploadCommonUniforms(g,on,be.toUnwrapped(),null,yt);let Mn=Re.segments;if("mercator"===x.projection.name&&!Ut&&(Mn=Re.getVisibleSegments(xe.tileID,e.terrain,e.transform.getFrustum(0)),!Mn.get().length))continue;if(ge)if(Ut)for(const qn of Mn.get())ge.numRenderedVerticesInShadowPass+=qn.primitiveLength;else for(const qn of Mn.get())ge.numRenderedVerticesInTransparentPass+=qn.primitiveLength;const hr=[];(e.terrain||p)&&hr.push(Re.centroidVertexBuffer),U&&hr.push(Re.layoutVertexExtBuffer),on.draw(e,g.gl.TRIANGLES,a,u,c,zr.backCCW,Cn,r.id,Re.layoutVertexBuffer,Re.indexBuffer,Mn,r.paint,e.transform.zoom,Ie,hr)}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1)}function fm(e,t,r,s,a,u,c,p,g,y,x,E,S,M,D,P,O,R,B){const j=e.context,V=j.gl,U=e.transform,G=e.transform.zoom,Z=[],Q=lm(e,r.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===y?(Z.push("CLEAR_SUBPASS"),B&&(Z.push("CLEAR_FROM_TEXTURE"),j.activeTexture.set(V.TEXTURE0),B.bind(V.LINEAR,V.CLAMP_TO_EDGE))):"sdf"===y&&Z.push("SDF_SUBPASS"),O&&Z.push("HAS_CENTROID"),Q.shouldRenderCutoff&&Z.push("RENDER_CUTOFF");const et=r.layout.get("fill-extrusion-edge-radius"),it=(yt,xt,Nt,ft,Ut)=>{const Wt=xt.programConfigurations.get(r.id),le=e.isTileAffectedByFog(yt),Bt=e.getOrCreateProgram("fillExtrusionGroundEffect",{config:Wt,defines:Z,overrideFog:le}),Zt={u_matrix:ft,u_opacity:x,u_ao_pass:g?1:0,u_meter_to_tile:Ut,u_ao:[E,S*Ut],u_flood_light_intensity:M,u_flood_light_color:D,u_attenuation:P,u_edge_radius:G>=17?0:et*Ut,u_fb:0,u_fb_size:B?B.size[0]:0},ge=[];O&&ge.push(xt.hiddenByLandmarkVertexBuffer),e.uploadCommonUniforms(j,Bt,yt.toUnwrapped(),null,Q),Bt.draw(e,j.gl.TRIANGLES,a,u,c,p,Zt,r.id,xt.vertexBuffer,xt.indexBuffer,Nt,r.paint,G,Wt,ge)};for(const yt of s){const xt=t.getTile(yt),Nt=xt.getBucket(r);if(!Nt||Nt.projection.name!==U.projection.name||!Nt.groundEffect||Nt.groundEffect&&!Nt.groundEffect.hasData())continue;const ft=Nt.groundEffect,Ut=1/Nt.tileToMeter;{const Wt=e.translatePosMatrix(yt.projMatrix,xt,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),le=ft.getDefaultSegment();it(yt,ft,le,Wt,Ut)}if(R)for(let Wt=0;Wt<4;Wt++){const le=xv[Wt](yt),Bt=t.getTile(le);if(!Bt)continue;const Zt=Bt.getBucket(r);if(!Zt||Zt.projection.name!==U.projection.name||!Zt.groundEffect||Zt.groundEffect&&!Zt.groundEffect.hasData())continue;const ge=Zt.groundEffect;let be,xe;0===Wt?(be=[-$t,0,0],xe=1):1===Wt?(be=[$t,0,0],xe=0):2===Wt?(be=[0,-$t,0],xe=3):(be=[0,$t,0],xe=2);const Re=ge.regionSegments[xe];if(!Re)continue;const ze=new Float32Array(16);ce.translate(ze,yt.projMatrix,be),it(yt,ge,Re,e.translatePosMatrix(ze,xt,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Ut)}}}function hA(e,t,r,s,a,u,c){0===s.centroidVertexArray.length&&s.createCentroidsBuffer();const p=u?u.findDEMTileFor(r):null;if(!(p&&p.dem||c))return;const g=R=>{const B=t.getSource().minzoom,j=U=>{const G=t.getTileByID(U);if(G&&G.hasData())return G.getBucket(a)},V=[0,-1,1];for(const U of V){if(R.overscaledZ+U<B)continue;const G=j(R.calculateScaledKey(R.overscaledZ+U));if(G)return G}},y=[0,0,0],x=(R,B)=>(y[0]=Math.min(R.min.y,B.min.y),y[1]=Math.max(R.max.y,B.max.y),y[2]=$t-B.min.x>R.max.x?B.min.x-$t:R.max.x,y),E=(R,B)=>(y[0]=Math.min(R.min.x,B.min.x),y[1]=Math.max(R.max.x,B.max.x),y[2]=$t-B.min.y>R.max.y?B.min.y-$t:R.max.y,y),S=[(R,B)=>x(R,B),(R,B)=>x(B,R),(R,B)=>E(R,B),(R,B)=>E(B,R)],M=(R,B,j,V,U,G,Z)=>{if(!u)return 0;const Q=[[G?j:R,G?R:j,0],[G?j:B,G?B:j,0]],et=Z<0?$t+Z:Z,it=[G?et:(R+B)/2,G?(R+B)/2:et,0];return 0===j&&Z<0||0!==j&&Z>0?u.getForTilePoints(U,[it],!0,V):Q.push(it),u.getForTilePoints(r,Q,!0,p),Math.max(Q[0][2],Q[1][2],it[2])/u.exaggeration()};for(let R=0;R<4;R++){const B=s.borderFeatureIndices[R];if(0===B.length)continue;const j=xv[R](r),V=g(j);if(!(V&&V instanceof Qp)||s.borderDoneWithNeighborZ[R]===V.canonical.z)continue;0===V.centroidVertexArray.length&&V.createCentroidsBuffer();const U=u?u.findDEMTileFor(j):null;if(!(U&&U.dem||c))continue;const G=(R<2?1:5)-R,Z=V.borderDoneWithNeighborZ[G]!==s.canonical.z,Q=V.borderFeatureIndices[G];let et=0;if(s.canonical.z!==V.canonical.z){for(const it of B)s.showCentroid(s.featuresOnBorder[it]);if(Z)for(const it of Q)V.showCentroid(V.featuresOnBorder[it]);s.borderDoneWithNeighborZ[R]=V.canonical.z,V.borderDoneWithNeighborZ[G]=s.canonical.z}for(const it of B){const yt=s.featuresOnBorder[it],xt=s.centroidData[yt.centroidDataIndex],Nt=yt.borders[R];let ft;for(;et<Q.length;){ft=V.featuresOnBorder[Q[et]];const Ut=ft.borders[G];if(Ut[1]>Nt[0]+3||Ut[0]>Nt[0]-3)break;V.showCentroid(ft),et++}if(ft&&et<Q.length){const Ut=et;let Wt=0;for(;!(ft.borders[G][0]>Nt[1]-3)&&(Wt++,++et!==Q.length);)ft=V.featuresOnBorder[Q[et]];if(ft=V.featuresOnBorder[Q[Ut]],Wt>1){const Zt=ft.borders[G];Math.abs(Nt[0]-Zt[0])<3&&Math.abs(Nt[1]-Zt[1])<3&&(Wt=1,et=Ut+1)}else if(0===Wt){s.showCentroid(yt);continue}const le=V.centroidData[ft.centroidDataIndex];c&&1===Wt&&(((P=xt).flags|(O=le).flags)&Na?(P.flags|=Na,O.flags|=Na):(P.flags&=2147483647,O.flags&=2147483647));let Bt=new H(0,0);if(Wt>1)et=Ut;else if(U&&U.dem&&!(yt.intersectsCount()>1||ft.intersectsCount()>1)){const Zt=S[R](xt,le),ge=R%2?$t-1:0;D=M(Zt[0],Math.min($t-1,Zt[1]),ge,U,j,R<2,Zt[2]),Bt=new H(Math.ceil(7*(D+450)),0)}xt.centroidXY=le.centroidXY=Bt,s.writeCentroidToBuffer(xt),V.writeCentroidToBuffer(le)}else s.showCentroid(yt)}s.borderDoneWithNeighborZ[R]=V.canonical.z,V.borderDoneWithNeighborZ[G]=s.canonical.z}var D,P,O;(s.needsCentroidUpdate||!s.centroidVertexBuffer&&0!==s.centroidVertexArray.length)&&s.uploadCentroid(e)}const Gx=[1,0,0],qx=[0,1,0],dS=[0,0,1];function $x(e,t,r){const s=r.transform,a=r.shadowRenderer;if(!a)return!0;const u=e.toUnwrapped(),c=s.tileSize*a._cascades[r.currentShadowCascade].scale;let p=t.maxHeight;if(s.elevation){const P=s.elevation.getMinMaxForTile(e);P&&(p+=P.max)}const g=[...a.shadowDirection];g[2]=-g[2];const y=a.computeSimplifiedTileShadowVolume(u,p,c,g);if(!y)return!1;const x=[Gx,qx,dS,g,[g[0],0,g[2]],[0,g[1],g[2]]],E="globe"===s.projection.name,S=s.scaleZoom(c),M=Lc.fromInvProjectionMatrix(s.invProjMatrix,s.worldSize,S,!E),D=a.getCurrentCascadeFrustum();return 0===M.intersectsPrecise(y.vertices,y.planes,x)||0===D.intersectsPrecise(y.vertices,y.planes,x)}function Hx(e){const t=e._nearZ,r=e.projection.farthestPixelDistance(e),s=r-t,a=.2*e.height,u=t+a;return[t,r,(u-a-t)/s,(u-t)/s]}const fA=new pn(1,0,0,1),dA=new pn(0,1,0,1),pA=new pn(0,0,1,1),mA=new pn(1,0,1,1),pS=new pn(0,1,1,1);function Zx(e,t,r){const s=e.context,a=e.transform,u=s.gl,c="globe"===a.projection.name,p=c?["PROJECTION_GLOBE_VIEW"]:[];let g=r.projMatrix;if(c&&da(a.zoom)>0){const it=W_(lE(r.canonical,a));g=ce.multiply(new Float32Array(16),a.globeMatrix,it),ce.multiply(g,a.projMatrix,g)}const y=e.getOrCreateProgram("debug",{defines:p}),x=t.getTileByID(r.key);e.terrain&&e.terrain.setupElevationDraw(x,y);const E=rr.disabled,S=jr.disabled,M=e.colorModeForRenderPass(),D="$debug";s.activeTexture.set(u.TEXTURE0),e.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),c?x._makeGlobeTileDebugBuffers(e.context,a):x._makeDebugTileBoundsBuffers(e.context,a.projection);const P=x._tileDebugBuffer||e.debugBuffer,O=x._tileDebugIndexBuffer||e.debugIndexBuffer,R=x._tileDebugSegments||e.debugSegments;y.draw(e,u.LINE_STRIP,E,S,M,zr.disabled,oA(g,pn.red),D,P,O,R,null,null,null,[x._globeTileDebugBorderBuffer]);const B=x.latestRawTileData,j=Math.floor((B&&B.byteLength||0)/1024),V=t.getTile(r).tileSize,U=512/Math.min(V,512)*(r.overscaledZ/a.zoom)*.5;let G=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(G+=` => ${r.overscaledZ}`),G+=` ${j}kb`,function(it,yt){it.initDebugOverlayCanvas();const xt=it.debugOverlayCanvas,Nt=it.context.gl,ft=it.debugOverlayCanvas.getContext("2d");ft.clearRect(0,0,xt.width,xt.height),ft.shadowColor="white",ft.shadowBlur=2,ft.lineWidth=1.5,ft.strokeStyle="white",ft.textBaseline="top",ft.font="bold 36px Open Sans, sans-serif",ft.fillText(yt,5,5),ft.strokeText(yt,5,5),it.debugOverlayTexture.update(xt),it.debugOverlayTexture.bind(Nt.LINEAR,Nt.CLAMP_TO_EDGE)}(e,G);const Z=x._tileDebugTextBuffer||e.debugBuffer,Q=x._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,et=x._tileDebugTextSegments||e.debugSegments;y.draw(e,u.TRIANGLES,E,S,vi.alphaBlended,zr.disabled,oA(g,pn.transparent,U),D,Z,Q,et,null,null,null,[x._globeTileDebugTextBuffer])}function mS(e,t,r,s){s0(e,0,t+r/2,e.transform.width,r,s)}function gS(e,t,r,s){s0(e,t-r/2,0,r,e.transform.height,s)}function s0(e,t,r,s,a,u){const c=e.context,p=c.gl;p.enable(p.SCISSOR_TEST),p.scissor(t*or.devicePixelRatio,r*or.devicePixelRatio,s*or.devicePixelRatio,a*or.devicePixelRatio),c.clear({color:u}),p.disable(p.SCISSOR_TEST)}const gA=yr([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:_A}=gA;function Wh(e,t,r,s){e.emplaceBack(t,r,s)}class Wx{constructor(t){this.vertexArray=new Rh,this.indices=new ea,Wh(this.vertexArray,-1,-1,1),Wh(this.vertexArray,1,-1,1),Wh(this.vertexArray,-1,1,1),Wh(this.vertexArray,1,1,1),Wh(this.vertexArray,-1,-1,-1),Wh(this.vertexArray,1,-1,-1),Wh(this.vertexArray,-1,1,-1),Wh(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,_A),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=Ui.simpleSegment(0,0,36,12)}}function dm(e,t,r,s,a,u){const c=e.context.gl,p=t.paint.get("sky-atmosphere-color"),g=t.paint.get("sky-atmosphere-halo-color"),y=t.paint.get("sky-atmosphere-sun-intensity"),x={u_matrix_3f:zl.fromMat4(zl.create(),s),u_sun_direction:a,u_sun_intensity:y,u_color_tint_r:[(D=p).r,D.g,D.b,D.a],u_color_tint_m:[(P=g).r,P.g,P.b,P.a],u_luminance:5e-5};var D,P;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_CUBE_MAP_POSITIVE_X+u,t.skyboxTexture,0),r.draw(e,c.TRIANGLES,rr.disabled,jr.disabled,vi.unblended,zr.frontCW,x,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const _S=yr([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class yA{constructor(t){const r=new Wf;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const s=new ea;s.emplaceBack(0,1,2),s.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(r,_S.members),this.indexBuffer=t.createIndexBuffer(s),this.segments=Ui.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const tu=yr([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class pm{constructor(){this.colorModeAlphaBlendedWriteRGB=new vi([1,771,1,771],pn.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new vi([1,0,1,0],pn.transparent,[!1,!1,!1,!0])}update(t){const r=t.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new yA(r);const s=100,a=200,u=function(x){const E=Ps(30),S=[];for(let M=0;M<16e3;++M){const D=2*Math.PI*E(),P=Math.acos(1-2*E())-.5*Math.PI;S.push(Ot.fromValues(Math.cos(P)*Math.cos(D),Math.cos(P)*Math.sin(D),Math.sin(P)))}return S}(),c=Ps(300),p=new W0,g=new ea;let y=0;for(let x=0;x<u.length;++x){const E=Ot.scale([],u[x],200),S=Math.max(0,1+.01*s*(1*c()-.5)),M=Math.max(0,1+.01*a*(1*c()-.5));p.emplaceBack(E[0],E[1],E[2],-1,-1,S,M),p.emplaceBack(E[0],E[1],E[2],1,-1,S,M),p.emplaceBack(E[0],E[1],E[2],1,1,S,M),p.emplaceBack(E[0],E[1],E[2],-1,1,S,M),g.emplaceBack(y+0,y+1,y+2),g.emplaceBack(y+0,y+2,y+3),y+=4}this.starsVx=r.createVertexBuffer(p,tu.members),this.starsIdx=r.createIndexBuffer(g),this.starsSegments=Ui.simpleSegment(0,0,p.length,g.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,r){const s=t.context,a=s.gl,u=t.transform,c=new rr(a.LEQUAL,rr.ReadOnly,[0,1]),p=da(u.zoom),g=r.properties.get("color").toArray01(),y=r.properties.get("high-color").toArray01(),x=r.properties.get("space-color").toArray01PremultipliedAlpha(),E=5e-4,S=At((r.properties.get("horizon-blend")-0)/1*.2495+E,5e-4,.25),M=mp(t,s,u)&&S===E?u.worldSize/(2*Math.PI*1.025)-1:u.globeRadius,D=t.frameCounter/1e3%1,P=Ot.length(u.globeCenterInViewSpace),O=Math.sqrt(Math.pow(P,2)-Math.pow(M,2)),R=Math.acos(O/P),B=j=>{const V="globe"===u.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];j&&V.push("ALPHA_PASS");const U=t.getOrCreateProgram("globeAtmosphere",{defines:V}),G={u_frustum_tl:u.frustumCorners.TL,u_frustum_tr:u.frustumCorners.TR,u_frustum_br:u.frustumCorners.BR,u_frustum_bl:u.frustumCorners.BL,u_horizon:u.frustumCorners.horizon,u_transition:p,u_fadeout_range:S,u_color:g,u_high_color:y,u_space_color:x,u_temporal_offset:D,u_horizon_angle:R};t.uploadCommonUniforms(s,U);const Z=this.atmosphereBuffer;Z&&U.draw(t,a.TRIANGLES,c,jr.disabled,j?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,zr.backCW,G,j?"atmosphere_glow_alpha":"atmosphere_glow",Z.vertexBuffer,Z.indexBuffer,Z.segments)};B(!1),B(!0)}drawStars(t,r){const s=At(r.properties.get("star-intensity"),0,1);if(0===s)return;const a=t.context,u=a.gl,c=t.transform,p=t.getOrCreateProgram("stars"),g=Ha.identity([]);Ha.rotateX(g,g,-c._pitch),Ha.rotateZ(g,g,-c.angle),Ha.rotateX(g,g,St(c._center.lat)),Ha.rotateY(g,g,-St(c._center.lng));const y=ce.fromQuat(new Float32Array(16),g),x=ce.multiply([],c.starsProjMatrix,y),E=zl.fromMat4([],y),S=zl.invert([],E),M=[0,1,0];Ot.transformMat3(M,M,S),Ot.scale(M,M,.15);const D=[1,0,0];Ot.transformMat3(D,D,S),Ot.scale(D,D,.15);const P=(R=M,B=D,j=s,{u_matrix:Float32Array.from(x),u_up:R,u_right:B,u_intensity_multiplier:j});var R,B,j;t.uploadCommonUniforms(a,p),this.starsVx&&this.starsIdx&&p.draw(t,u.TRIANGLES,rr.disabled,jr.disabled,this.colorModeAlphaBlendedWriteRGB,zr.disabled,P,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function yS(e,t){const r=[...e],s=t.cameraWorldSizeForFog/t.worldSize,a=ce.identity([]);return ce.scale(a,a,[s,s,1]),ce.multiply(r,a,r),ce.multiply(r,t.worldToFogMatrix,r),r}function Xx(e,t,r,s){const a=r.material,u=s.context,{baseColorTexture:c,metallicRoughnessTexture:p}=a.pbrMetallicRoughness,{normalTexture:g,occlusionTexture:y,emissionTexture:x}=a;function E(S,M,D){if(S&&(e.push(M),u.activeTexture.set(u.gl.TEXTURE0+D),S.gfxTexture)){const{minFilter:P,magFilter:O,wrapS:R,wrapT:B}=S.sampler;S.gfxTexture.bindExtraParam(P,O,R,B)}}E(c,"HAS_TEXTURE_u_baseColorTexture",vu.BaseColor),E(p,"HAS_TEXTURE_u_metallicRoughnessTexture",vu.MetallicRoughness),E(g,"HAS_TEXTURE_u_normalTexture",vu.Normal),E(y,"HAS_TEXTURE_u_occlusionTexture",vu.Occlusion),E(x,"HAS_TEXTURE_u_emissionTexture",vu.Emission),r.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(r.texcoordBuffer)),r.colorBuffer&&(e.push(12===r.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(r.colorBuffer)),r.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(r.normalBuffer)),r.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(r.pbrBuffer)),"OPAQUE"!==a.alphaMode&&"MASK"!==a.alphaMode||e.push("UNPREMULT_TEXTURE_IN_SHADER"),a.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function Yx(e,t,r,s,a,u){const c=r.paint.get("model-opacity"),p=t.context,g=new rr(t.context.gl.LEQUAL,rr.ReadWrite,t.depthRangeFor3D),y=t.transform,x=e.mesh,E=x.material,S=E.pbrMetallicRoughness,M=t.style.fog;let D;D="pixels"===t.transform.projection.zAxisUnit?[...e.nodeModelMatrix]:ce.multiply([],s.zScaleMatrix,e.nodeModelMatrix),ce.multiply(D,s.negCameraPosMatrix,D);const P=ce.invert([],D);ce.transpose(P,P);const O=r.paint.get("model-emissive-strength").constantOr(0),R=o0(new Float32Array(e.worldViewProjection),new Float32Array(D),new Float32Array(P),t,c,S.baseColorFactor,E.emissiveFactor,S.metallicFactor,S.roughnessFactor,E,O,r),B={defines:[]},j=[];Xx(B.defines,j,x,t);const V=t.shadowRenderer;V&&(V.useNormalOffset=!1);let U=null;if(M){const Q=yS(e.nodeModelMatrix,t.transform);if(U=new Float32Array(Q),"globe"!==y.projection.name){const et=x.aabb.min,it=x.aabb.max,[yt,xt]=M.getOpacityForBounds(Q,et[0],et[1],it[0],it[1]);B.overrideFog=yt>=Mf||xt>=Mf}}const G=lm(t,r.paint.get("model-cutoff-fade-range"));G.shouldRenderCutoff&&B.defines.push("RENDER_CUTOFF");const Z=t.getOrCreateProgram("model",B);t.uploadCommonUniforms(p,Z,null,U,G),"shadow"!==t.renderPass&&V&&V.setupShadowsFromMatrix(e.nodeModelMatrix,Z),Z.draw(t,p.gl.TRIANGLES,g,a,u,x.material.doubleSided?zr.disabled:zr.backCCW,R,r.id,x.vertexBuffer,x.indexBuffer,x.segments,r.paint,t.transform.zoom,void 0,j)}function vA(e,t,r,s,a,u,c){let p;p="globe"===e.projection.name?B1(r,e):[...r],ce.multiply(p,p,t.matrix);const g=ce.multiply([],s,p);if(t.meshes)for(const y of t.meshes){if("BLEND"!==y.material.alphaMode){c.push({mesh:y,depth:0,modelIndex:a,worldViewProjection:g,nodeModelMatrix:p});continue}const x=Ot.transformMat4([],y.centroid,g);x[2]>0&&u.push({mesh:y,depth:x[2],modelIndex:a,worldViewProjection:g,nodeModelMatrix:p})}if(t.children)for(const y of t.children)vA(e,y,r,s,a,u,c)}function a0(e,t,r,s){const a=r.shadowRenderer;if(!a)return;const u=a.getShadowPassDepthMode(),c=a.getShadowPassColorMode(),p=a.calculateShadowPassMatrixFromMatrix(t),g=aS(p);r.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,u,jr.disabled,c,zr.backCCW,g,s.id,e.vertexBuffer,e.indexBuffer,e.segments,s.paint,r.transform.zoom,void 0,void 0)}function vS(e,t,r){const s=t.updateZoomBasedPaintProperties(),a=function(u,c,p){let g,y,x,E=u.terrain?u.terrain.exaggeration():0;if(u.terrain&&E>0){const S=u.terrain,M=S.findDEMTileFor(p);M&&M.dem?g=gd.create(S,p,M):E=0}if(0===E&&(c.terrainElevationMin=0,c.terrainElevationMax=0),E===c.validForExaggeration&&(0===E||g&&g._demTile&&g._demTile.tileID===c.validForDEMTile.id&&g._dem._timestamp===c.validForDEMTile.timestamp))return!1;for(const S in c.instancesPerModel){const M=c.instancesPerModel[S];for(let D=0;D<M.instancedDataArray.length;++D){const P=(g?E*g.getElevationAt(0|M.instancedDataArray.float32[16*D],0|M.instancedDataArray.float32[16*D+1],!0,!0):0)+M.instancesEvaluatedElevation[D];M.instancedDataArray.float32[16*D+6]=P,y=y?Math.min(c.terrainElevationMin,P):P,x=x?Math.max(c.terrainElevationMax,P):P}}return c.terrainElevationMin=y||0,c.terrainElevationMax=x||0,c.validForExaggeration=E,c.validForDEMTile=g&&g._demTile?{id:g._demTile.tileID,timestamp:g._dem._timestamp}:{id:void 0,timestamp:0},!0}(e,t,r);(s||a)&&(t.uploaded=!1,t.upload(e.context))}const Xh={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new Qi([0,0,0],[$t,$t,0])};function cO(e,t){const r=1<<e.canonical.z,s=t.getFreeCameraOptions().position,a=t.elevation,u=e.canonical.x/r,c=(e.canonical.x+1)/r,p=e.canonical.y/r,g=(e.canonical.y+1)/r;let y=t._centerAltitude;if(a){const M=a.getMinMaxForTile(e);M&&M.max>y&&(y=M.max)}const x=At(s.x,u,c)-s.x,E=At(s.y,p,g)-s.y,S=ji(y,t.center.lat)-s.z;return t._zoomFromMercatorZ(Math.sqrt(x*x+E*E+S*S))}function xA(e,t,r,s,a,u,c){const p=e.context,g="shadow"===e.renderPass,y=e.shadowRenderer,x=g&&y?y.getShadowPassDepthMode():new rr(p.gl.LEQUAL,rr.ReadWrite,e.depthRangeFor3D),E=e.isTileAffectedByFog(u);if(r.meshes)for(const S of r.meshes){const M=["MODEL_POSITION_ON_GPU"],D=[];let P,O,R;s.instancedDataArray.length>20&&M.push("INSTANCED_ARRAYS");const B=lm(e,t.paint.get("model-cutoff-fade-range"));if(B.shouldRenderCutoff&&M.push("RENDER_CUTOFF"),g&&y)P=e.getOrCreateProgram("modelDepth",{defines:M}),O=aS(c.shadowTileMatrix,c.shadowTileMatrix,Float32Array.from(r.matrix)),R=y.getShadowPassColorMode();else{Xx(M,D,S,e),P=e.getOrCreateProgram("model",{defines:M,overrideFog:E});const V=S.material,U=V.pbrMetallicRoughness,G=t.paint.get("model-opacity"),Z=t.paint.get("model-emissive-strength").constantOr(0);O=o0(u.expandedProjMatrix,Float32Array.from(r.matrix),new Float32Array(16),e,G,U.baseColorFactor,V.emissiveFactor,U.metallicFactor,U.roughnessFactor,V,Z,t,a),y&&(c.shadowUniformsInitialized?P.setShadowUniformValues(p,y.getShadowUniformValues()):(y.setupShadows(u.toUnwrapped(),P,"model-tile",u.overscaledZ),c.shadowUniformsInitialized=!0)),R=B.shouldRenderCutoff||G<1||"OPAQUE"!==V.alphaMode?vi.alphaBlended:vi.unblended}e.uploadCommonUniforms(p,P,u.toUnwrapped(),null,B);const j=S.material.doubleSided?zr.disabled:zr.backCCW;if(s.instancedDataArray.length>20)D.push(s.instancedDataBuffer),P.draw(e,p.gl.TRIANGLES,x,jr.disabled,R,j,O,t.id,S.vertexBuffer,S.indexBuffer,S.segments,t.paint,e.transform.zoom,void 0,D,s.instancedDataArray.length);else{const V=g?"u_instance":"u_normal_matrix";for(let U=0;U<s.instancedDataArray.length;++U)O[V]=new Float32Array(s.instancedDataArray.arrayBuffer,64*U,16),P.draw(e,p.gl.TRIANGLES,x,jr.disabled,R,j,O,t.id,S.vertexBuffer,S.indexBuffer,S.segments,t.paint,e.transform.zoom,void 0,D)}}if(r.children)for(const S of r.children)xA(e,t,S,s,a,u,c)}const Jg=[1,-1,1];function bA(e,t,r,s){if(!r.modelManager)return!0;const a=r.modelManager;if(!r.shadowRenderer)return!0;const u=r.shadowRenderer,c=t.aabb;let p=!0,g=e.maxHeight;if(0===g){let x=0;for(const E in e.instancesPerModel){const S=a.getModel(E,s);S?x=Math.max(x,Math.max(Math.max(S.aabb.max[0],S.aabb.max[1]),S.aabb.max[2])):p=!1}g=e.maxScale*x*1.41+e.maxVerticalOffset,p&&(e.maxHeight=g)}c.max[2]=g,c.min[2]+=e.terrainElevationMin,c.max[2]+=e.terrainElevationMax,Ot.transformMat4(c.min,c.min,t.tileMatrix),Ot.transformMat4(c.max,c.max,t.tileMatrix);const y=c.intersects(u.getCurrentCascadeFrustum());return 0===r.currentShadowCascade&&(e.isInsideFirstShadowMapFrustum=2===y),0===y}class Jx{}class wA{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,r,s){{const E=this._storage.get(r.id);if(E)return E.lastUsedFrameIdx=t,E.buf}const a=s.gl,u=a.getBufferParameter(a.ELEMENT_ARRAY_BUFFER,a.BUFFER_SIZE),c=new ArrayBuffer(u),p=new Int16Array(c);a.getBufferSubData(a.ELEMENT_ARRAY_BUFFER,0,new Int16Array(c));const g=new Oh;for(let E=0;E<u/2;E+=3){const S=p[E],M=p[E+1],D=p[E+2];g.emplaceBack(S,M),g.emplaceBack(M,D),g.emplaceBack(D,S)}const y=s.bindVertexArrayOES.current,x=new Jx;return x.buf=new Cd(s,g),x.lastUsedFrameIdx=t,this._storage.set(r.id,x),s.bindVertexArrayOES.set(y),x.buf}update(t){for(const[r,s]of this._storage)t-s.lastUsedFrameIdx>30&&(s.buf.destroy(),this._storage.delete(r))}destroy(){for(const[t,r]of this._storage)r.buf.destroy(),this._storage.delete(t)}}const Kx={symbol:function(e,t,r,s,a){if("translucent"!==e.renderPass)return;const u=jr.disabled,c=e.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(p,g,y,x,E,S,M){const D=g.transform,P="map"===E,O="map"===S;for(const R of p){const B=x.getTile(R),j=B.getBucket(y);if(!j||!j.text||!j.text.segments.get().length)continue;const V=lh(j.textSizeData,D.zoom),U=Jy(R,j.getProjection(),D),G=D.calculatePixelsToTileUnitsMatrix(B),Z=Ag(U,B.tileID.canonical,O,P,D,j.getProjection(),G),Q=j.hasIconTextFit()&&j.hasIconData();if(V){const et=Math.pow(2,D.zoom-B.tileID.overscaledZ);fS(j,P,O,M,GE,D,Z,R,et,V,Q)}}}(s,e,r,t,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),a),0!==r.paint.get("icon-opacity").constantOr(1)&&Ux(e,t,r,s,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),r.paint.get("icon-color-saturation"),u,c),0!==r.paint.get("text-opacity").constantOr(1)&&Ux(e,t,r,s,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),r.paint.get("icon-color-saturation"),u,c),t.map.showCollisionBoxes&&(uS(e,t,r,s,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),uS(e,t,r,s,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(e,t,r,s){if("translucent"!==e.renderPass)return;const a=r.paint.get("circle-opacity"),u=r.paint.get("circle-stroke-width"),c=r.paint.get("circle-stroke-opacity"),p=void 0!==r.layout.get("circle-sort-key").constantOr(1),g=r.paint.get("circle-emissive-strength");if(0===a.constantOr(1)&&(0===u.constantOr(1)||0===c.constantOr(1)))return;const y=e.context,x=y.gl,E=e.transform,S=e.depthModeForSublayer(0,rr.ReadOnly),M=jr.disabled,D=e.colorModeForDrapableLayerRenderPass(g),P="globe"===E.projection.name,O=[zs(E.center.lng),ba(E.center.lat)],R=[];for(let j=0;j<s.length;j++){const V=s[j],U=t.getTile(V),G=U.getBucket(r);if(!G||G.projection.name!==E.projection.name)continue;const Z=G.programConfigurations.get(r.id),Q=vE(r),et=e.isTileAffectedByFog(V);P&&Q.push("PROJECTION_GLOBE_VIEW");const it=e.getOrCreateProgram("circle",{config:Z,defines:Q,overrideFog:et}),yt=G.layoutVertexBuffer,xt=G.globeExtVertexBuffer,Nt=G.indexBuffer,ft=E.projection.createInversionMatrix(E,V.canonical),Ut={programConfiguration:Z,program:it,layoutVertexBuffer:yt,globeExtVertexBuffer:xt,indexBuffer:Nt,uniformValues:_p(e,V,U,ft,O,r),tile:U};if(p){const Wt=G.segments.get();for(const le of Wt)R.push({segments:new Ui([le]),sortKey:le.sortKey,state:Ut})}else R.push({segments:G.segments,sortKey:0,state:Ut})}p&&R.sort((j,V)=>j.sortKey-V.sortKey);const B={useDepthForOcclusion:E.depthOcclusionForSymbolsAndCircles};for(const j of R){const{programConfiguration:V,program:U,layoutVertexBuffer:G,globeExtVertexBuffer:Z,indexBuffer:Q,uniformValues:et,tile:it}=j.state,yt=j.segments;e.terrain&&e.terrain.setupElevationDraw(it,U,B),e.uploadCommonUniforms(y,U,it.tileID.toUnwrapped()),U.draw(e,x.TRIANGLES,S,M,D,zr.disabled,et,r.id,G,Q,yt,r.paint,E.zoom,V,[Z])}},heatmap:function(e,t,r,s){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const a=e.context,u=a.gl,c=jr.disabled,p=new vi([u.ONE,u.ONE,u.ONE,u.ONE],pn.transparent,[!0,!0,!0,!0]);(function(M,D,P,O){const R=M.gl,B=D.width*O,j=D.height*O;M.activeTexture.set(R.TEXTURE1),M.viewport.set([0,0,B,j]);let V=P.heatmapFbo;if(!V||V&&(V.width!==B||V.height!==j)){V&&V.destroy();const U=R.createTexture();R.bindTexture(R.TEXTURE_2D,U),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MIN_FILTER,R.LINEAR),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MAG_FILTER,R.LINEAR),V=P.heatmapFbo=M.createFramebuffer(B,j,!0,null),function(G,Z,Q,et,it,yt){const xt=G.gl;xt.texImage2D(xt.TEXTURE_2D,0,G.extRenderToTextureHalfFloat?xt.RGBA16F:xt.RGBA,it,yt,0,xt.RGBA,G.extRenderToTextureHalfFloat?xt.HALF_FLOAT:xt.UNSIGNED_BYTE,null),et.colorAttachment.set(Q)}(M,0,U,V,B,j)}else R.bindTexture(R.TEXTURE_2D,V.colorAttachment.get()),M.bindFramebuffer.set(V.framebuffer)})(a,e,r,"globe"===e.transform.projection.name?.5:.25),a.clear({color:pn.transparent});const g=e.transform,y="globe"===g.projection.name,x=y?["PROJECTION_GLOBE_VIEW"]:[],E=y?zr.frontCCW:zr.disabled,S=[zs(g.center.lng),ba(g.center.lat)];for(let M=0;M<s.length;M++){const D=s[M];if(t.hasRenderableParent(D))continue;const P=t.getTile(D),O=P.getBucket(r);if(!O||O.projection.name!==g.projection.name)continue;const R=e.isTileAffectedByFog(D),B=O.programConfigurations.get(r.id),j=e.getOrCreateProgram("heatmap",{config:B,defines:x,overrideFog:R}),{zoom:V}=e.transform;e.terrain&&e.terrain.setupElevationDraw(P,j),e.uploadCommonUniforms(a,j,D.toUnwrapped());const U=g.projection.createInversionMatrix(g,D.canonical);j.draw(e,u.TRIANGLES,rr.disabled,c,p,E,uO(e,D,P,U,S,V,r.paint.get("heatmap-intensity")),r.id,O.layoutVertexBuffer,O.indexBuffer,O.segments,r.paint,e.transform.zoom,B,y?[O.globeExtVertexBuffer]:null)}a.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(a,u){const c=a.context,p=c.gl,g=u.heatmapFbo;if(!g)return;c.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,g.colorAttachment.get()),c.activeTexture.set(p.TEXTURE1);let y=u.colorRampTexture;y||(y=u.colorRampTexture=new fs(c,u.colorRamp,p.RGBA)),y.bind(p.LINEAR,p.CLAMP_TO_EDGE),a.getOrCreateProgram("heatmapTexture").draw(a,p.TRIANGLES,rr.disabled,jr.disabled,a.colorModeForRenderPass(),zr.disabled,{u_image:0,u_color_ramp:1,u_opacity:u.paint.get("heatmap-opacity")},u.id,a.viewportBuffer,a.quadTriangleIndexBuffer,a.viewportSegments,u.paint,a.transform.zoom)}(e,r))},line:function(e,t,r,s){if("translucent"!==e.renderPass)return;const a=r.paint.get("line-opacity"),u=r.paint.get("line-width");if(0===a.constantOr(1)||0===u.constantOr(1))return;const c=r.paint.get("line-emissive-strength"),p=e.depthModeForSublayer(0,rr.ReadOnly),g=e.colorModeForDrapableLayerRenderPass(c),y=e.terrain&&e.terrain.renderingToTexture?1:or.devicePixelRatio,x=r.paint.get("line-dasharray"),E=x.constantOr(1),S=r.layout.get("line-cap"),M=r.paint.get("line-pattern"),D=M.constantOr(1),P=r.paint.get("line-pattern").constantOr(1),O=1!==r.paint.get("line-opacity").constantOr(1);let R=!P&&O;const B=r.paint.get("line-gradient"),j=D?"linePattern":"line",V=e.context,U=V.gl,G=lC(r);e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(R=!1);for(const Z of s){const Q=t.getTile(Z);if(D&&!Q.patternsLoaded())continue;const et=Q.getBucket(r);if(!et)continue;e.prepareDrawTile();const it=et.programConfigurations.get(r.id),yt=e.isTileAffectedByFog(Z),xt=e.getOrCreateProgram(j,{config:it,defines:G,overrideFog:yt}),Nt=M.constantOr(null);if(Nt&&Q.imageAtlas){const be=Q.imageAtlas.patternPositions[Nt.toString()];be&&it.setConstantPatternPositions(be)}const ft=x.constantOr(null),Ut=S.constantOr(null);if(!D&&ft&&Ut&&Q.lineAtlas){const be=Q.lineAtlas.getDash(ft,Ut);be&&it.setConstantPatternPositions(be)}let[Wt,le]=r.paint.get("line-trim-offset");("round"===Ut||"square"===Ut)&&Wt!==le&&(0===Wt&&(Wt-=1),1===le&&(le+=1));const Bt=e.terrain?Z.projMatrix:null,Zt=D?sC(e,Q,r,Bt,y):oC(e,Q,r,Bt,et.lineClipsArray.length,y,[Wt,le]);if(B){const be=et.gradients[r.id];let xe=be.texture;if(r.gradientVersion!==be.version){let Re=256;if(r.stepInterpolant){const ze=t.getSource().maxzoom,$e=Z.canonical.z===ze?Math.ceil(1<<e.transform.maxZoom-Z.canonical.z):1;Re=At(Yn(et.maxLineLength/$t*1024*$e),256,V.maxTextureSize)}be.gradient=sy({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:Re,image:be.gradient||void 0,clips:et.lineClipsArray}),be.texture?be.texture.update(be.gradient):be.texture=new fs(V,be.gradient,U.RGBA),be.version=r.gradientVersion,xe=be.texture}V.activeTexture.set(U.TEXTURE1),xe.bind(r.stepInterpolant?U.NEAREST:U.LINEAR,U.CLAMP_TO_EDGE)}E&&(V.activeTexture.set(U.TEXTURE0),Q.lineAtlasTexture&&Q.lineAtlasTexture.bind(U.LINEAR,U.REPEAT),it.updatePaintBuffers()),D&&(V.activeTexture.set(U.TEXTURE0),Q.imageAtlasTexture&&Q.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),it.updatePaintBuffers()),e.uploadCommonUniforms(V,xt,Z.toUnwrapped());const ge=be=>{xt.draw(e,U.TRIANGLES,p,be,g,zr.disabled,Zt,r.id,et.layoutVertexBuffer,et.indexBuffer,et.segments,r.paint,e.transform.zoom,it,[et.layoutVertexBuffer2])};if(R){const be=e.stencilModeForClipping(Z).ref;0===be&&e.terrain&&V.clear({stencil:0});const xe={func:U.EQUAL,mask:255};Zt.u_alpha_discard_threshold=.8,ge(new jr(xe,be,255,U.KEEP,U.KEEP,U.INVERT)),Zt.u_alpha_discard_threshold=0,ge(new jr(xe,be,255,U.KEEP,U.KEEP,U.KEEP))}else ge(e.stencilModeForClipping(Z))}R&&(e.resetStencilClippingMasks(),e.terrain&&V.clear({stencil:0}))},fill:function(e,t,r,s){const a=r.paint.get("fill-color"),u=r.paint.get("fill-opacity");if(0===u.constantOr(1))return;const c=r.paint.get("fill-emissive-strength"),p=e.colorModeForDrapableLayerRenderPass(c),g=r.paint.get("fill-pattern"),y=e.opaquePassEnabledForLayer()&&!g.constantOr(1)&&1===a.constantOr(pn.transparent).a&&1===u.constantOr(0)?"opaque":"translucent";if(e.renderPass===y){const x=e.depthModeForSublayer(1,"opaque"===e.renderPass?rr.ReadWrite:rr.ReadOnly);Vx(e,t,r,s,x,p,!1)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){const x=e.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,rr.ReadOnly);Vx(e,t,r,s,x,p,!0)}},"fill-extrusion":function(e,t,r,s){const a=r.paint.get("fill-extrusion-opacity"),u=e.context,c=u.gl,p=e.terrain,g=p&&p.renderingToTexture,y=r.paint.get("fill-extrusion-cutoff-fade-range");if(0===a)return;const x=e.conflationActive&&e.layerUsedInConflation(r,t.getSource());if(x&&function(E,S,M,D){for(const P of D){const O=S.getTile(P).getBucket(M);O&&(O.updateReplacement(P,E.replacementSource),O.uploadCentroid(E.context))}}(e,t,r,s),p||x)for(const E of s){const S=t.getTile(E).getBucket(r);S&&hA(e.context,t,E,S,r,p,x)}if("shadow"===e.renderPass&&e.shadowRenderer){const E=e.shadowRenderer;if(p&&a<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof Th)return;const S=E.getShadowPassDepthMode(),M=E.getShadowPassColorMode();Yg(e,t,r,s,S,jr.disabled,M,x)}else if("translucent"===e.renderPass){const E=!r.paint.get("fill-extrusion-pattern").constantOr(1);if(!g){const S=new rr(e.context.gl.LEQUAL,rr.ReadWrite,e.depthRangeFor3D);0===y&&1===a&&E?Yg(e,t,r,s,S,jr.disabled,vi.unblended,x):(Yg(e,t,r,s,S,jr.disabled,vi.disabled,x),Yg(e,t,r,s,S,e.stencilModeFor3D(),e.colorModeForRenderPass(),x),e.resetStencilClippingMasks())}if(e.style.enable3dLights()&&E&&(!p&&"globe"!==e.transform.projection.name||g)){const S=r.paint.get("fill-extrusion-opacity"),M=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),D=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),P=r.paint.get("fill-extrusion-flood-light-intensity"),O=r.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),R=M>0&&D>0,B=P>0,j=(U,G,Z)=>(1-Z)*U+Z*G,V=U=>{const G=e.depthModeForSublayer(1,rr.ReadOnly,c.LEQUAL,!0),Z=r.paint.get(U?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Q=j(.1,3,Z),et=e._showOverdrawInspector;if(!et){const it=new jr({func:c.ALWAYS,mask:255},255,255,c.KEEP,c.KEEP,c.REPLACE),yt=new vi([c.ONE,c.ONE,c.ONE,c.ONE],pn.transparent,[!1,!1,!1,!0],c.MIN);fm(e,t,r,s,G,it,yt,zr.disabled,U,"sdf",S,M,D,P,O,Q,x,!1)}{const it=et?jr.disabled:new jr({func:c.EQUAL,mask:255},255,255,c.KEEP,c.DECR,c.DECR),yt=et?e.colorModeForRenderPass():new vi([c.ONE_MINUS_DST_ALPHA,c.DST_ALPHA,c.ONE,c.ONE],pn.transparent,[!0,!0,!0,!0]);fm(e,t,r,s,G,it,yt,zr.disabled,U,"color",S,M,D,P,O,Q,x,!1)}};if(g){const U=(G,Z,Q)=>{const et=e.depthModeForSublayer(1,rr.ReadOnly,c.LEQUAL,!1),it=r.paint.get(G?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),yt=j(.1,3,it);{const xt=new vi([c.ONE,c.ONE,c.ONE,c.ONE],pn.transparent,[!1,!1,!1,!0]);fm(e,t,r,s,et,jr.disabled,xt,zr.disabled,G,"clear",S,M,D,P,O,yt,x,Z)}{const xt=new jr({func:c.ALWAYS,mask:255},255,255,c.KEEP,c.KEEP,c.REPLACE),Nt=new vi([c.ONE,c.ONE,c.ONE,c.ONE],pn.transparent,[!1,!1,!1,!0],c.MIN);fm(e,t,r,s,et,xt,Nt,zr.disabled,G,"sdf",S,M,D,P,O,yt,x,Z)}{const xt=G?c.ZERO:c.ONE_MINUS_DST_ALPHA,Nt=new jr({func:c.EQUAL,mask:255},255,255,c.KEEP,c.DECR,c.DECR),ft=new vi([xt,c.DST_ALPHA,c.ONE_MINUS_DST_ALPHA,c.ZERO],pn.transparent,[!0,!0,!0,!0]);fm(e,t,r,s,et,Nt,ft,zr.disabled,G,"color",S,M,D,P,O,yt,x,Z)}{const xt=new vi([c.ONE,c.ONE,c.ONE,G?c.ZERO:c.ONE],pn.transparent,[!1,!1,!1,!0],G?c.FUNC_ADD:c.MAX);fm(e,t,r,s,et,jr.disabled,xt,zr.disabled,G,"clear",S,M,D,P,O,yt,x,Z,Q)}};if(R||B){let G;if(e.prepareDrawTile(),p){const Z=p.drapeBufferSize[0],Q=p.drapeBufferSize[1];G=p.framebufferCopyTexture,G&&(!G||G.size[0]===Z&&G.size[1]===Q)||(G&&G.destroy(),G=p.framebufferCopyTexture=new fs(u,new Hs({width:Z,height:Q}),c.RGBA)),G.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,Z,Q,0)}R&&U(!0,!1,G),B&&U(!1,!0,G)}}else R&&V(!0),B&&V(!1)}}},hillshade:function(e,t,r,s){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass||e.style.disableElevatedTerrain)return;const a=e.context,u=e.terrain&&e.terrain.renderingToTexture,[c,p]="translucent"!==e.renderPass||u?[{},s]:e.stencilConfigForOverlap(s);for(const g of p){const y=t.getTile(g);if(y.needsHillshadePrepare&&"offscreen"===e.renderPass)W2(e,y,r);else if("translucent"===e.renderPass){const x=e.depthModeForSublayer(0,rr.ReadOnly),E=r.paint.get("hillshade-emissive-strength"),S=e.colorModeForDrapableLayerRenderPass(E),M=u&&e.terrain?e.terrain.stencilModeForRTTOverlap(g):c[g.overscaledZ];lO(e,g,y,r,x,M,S)}}a.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(e,t,r,s,a,u){if("translucent"!==e.renderPass||0===r.paint.get("raster-opacity"))return;const c=e.context,p=c.gl,g=t.getSource(),y=function(Z,Q,et){const it=Z.paint.get("raster-color"),yt=[],xt=Z.paint.get("raster-resampling"),Nt=Z.paint.get("raster-color-mix"),ft=Z.paint.get("raster-color-range"),Ut=[Nt[0],Nt[1],Nt[2],0],Wt=Nt[3],le="nearest"===xt?et.NEAREST:et.LINEAR;if(it&&yt.push("RASTER_COLOR"),it){Q.activeTexture.set(et.TEXTURE2);let Bt=Z.colorRampTexture;Bt||(Bt=Z.colorRampTexture=new fs(Q,Z.colorRamp,et.RGBA)),Bt.bind(et.LINEAR,et.CLAMP_TO_EDGE)}return{mix:Ut,range:ft,offset:Wt,defines:yt,resampling:le}}(r,c,p),x=y.defines,E="globe"===e.transform.projection.name;let S=!1;if(g instanceof dc&&!s.length){if(!E)return;if(g.onNorthPole)S=!0,x.push("GLOBE_POLES");else{if(!g.onSouthPole)return;S=!0,x.push("GLOBE_POLES")}}const M=r.paint.get("raster-emissive-strength"),D=e.colorModeForDrapableLayerRenderPass(M),P=e.terrain&&e.terrain.renderingToTexture,O=g instanceof dc&&0!==r.paint.get("raster-elevation"),R=!e.options.moving,B="nearest"===r.paint.get("raster-resampling")?p.NEAREST:p.LINEAR;if(S){const Z=t.getSource();if(!(Z instanceof dc))return;const Q=Z.texture;if(!Q)return;const et=e.globeSharedBuffers;if(!et)return;const it=new rr(p.LEQUAL,rr.ReadWrite,e.depthRangeFor3D),yt=Float32Array.from(e.transform.expandedFarZProjMatrix);let xt=rh(0,0,e.transform);const Nt=Float32Array.from(id(Gu(new Vu(0,0,0)))),ft={opacity:1,mix:0};e.terrain&&e.terrain.prepareDrawTile(),c.activeTexture.set(p.TEXTURE0),Q.bind(B,p.CLAMP_TO_EDGE),c.activeTexture.set(p.TEXTURE1),Q.bind(B,p.CLAMP_TO_EDGE),Q.useMipmap&&c.extTextureFilterAnisotropic&&e.transform.pitch>20&&p.texParameterf(p.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax);const[Ut,Wt,le,Bt]=et.getPoleBuffers(0,!0);let Zt;Z.onNorthPole?(Zt=Ut,e.renderDefaultNorthPole=!1):(xt=ce.scale(ce.create(),xt,[1,-1,1]),Zt=Wt,e.renderDefaultSouthPole=!1);const ge=(xe=yt,Re=Nt,ze=xt,$e=ft,Ie=r,on=Z.perspectiveTransform||[0,0],vn=r.paint.get("raster-elevation"),Cn=y.mix,Mn=y.offset,hr=y.range,qn=M,gh(xe,Re,ze,new Float32Array(16),new Float32Array(9),[0,0],[0,0,0,0],0,[0,0],[0,0,0,0],1,$e,Ie,on||[0,0],vn,2,Cn,Mn,hr,1,0,qn)),be=e.getOrCreateProgram("raster",{defines:y.defines});return e.uploadCommonUniforms(c,be,null),void be.draw(e,p.TRIANGLES,it,jr.disabled,D,zr.disabled,ge,r.id,Zt,le,Bt)}var xe,Re,ze,$e,Ie,on,vn,Cn,Mn,hr,qn;if(!s.length)return;const[j,V]=g instanceof dc||P?[{},s]:e.stencilConfigForOverlap(s),U=V[V.length-1].overscaledZ,G=O&&E;G&&y.defines.push("PROJECTION_GLOBE_VIEW"),O&&y.defines.push("RENDER_CUTOFF");for(const Z of V){const Q=Z.toUnwrapped(),et=t.getTile(Z);if(P&&(!et||!et.hasData())||!et.texture)continue;let it,yt;P?(it=rr.disabled,yt=Z.projMatrix):O?(it=new rr(p.LEQUAL,rr.ReadWrite,e.depthRangeFor3D),yt=E?Float32Array.from(e.transform.expandedFarZProjMatrix):e.transform.calculateProjMatrix(Q,R)):(it=e.depthModeForSublayer(Z.overscaledZ-U,1===r.paint.get("raster-opacity")?rr.ReadWrite:rr.ReadOnly,p.LESS),yt=e.transform.calculateProjMatrix(Q,R));const xt=e.terrain&&P?e.terrain.stencilModeForRTTOverlap(Z):j[Z.overscaledZ],Nt=u?0:r.paint.get("raster-fade-duration");et.registerFadeDuration(Nt);const ft=t.findLoadedParent(Z,0),Ut=cm(et,ft,t,e.transform,Nt);let Wt,le;e.terrain&&e.terrain.prepareDrawTile(),c.activeTexture.set(p.TEXTURE0),et.texture&&et.texture.bind(B,p.CLAMP_TO_EDGE),c.activeTexture.set(p.TEXTURE1),ft?(ft.texture&&ft.texture.bind(B,p.CLAMP_TO_EDGE),Wt=Math.pow(2,ft.tileID.overscaledZ-et.tileID.overscaledZ),le=[et.tileID.canonical.x*Wt%1,et.tileID.canonical.y*Wt%1]):et.texture&&et.texture.bind(B,p.CLAMP_TO_EDGE),et.texture&&et.texture.useMipmap&&c.extTextureFilterAnisotropic&&e.transform.pitch>20&&p.texParameterf(p.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax);const Bt=e.transform,Zt=g instanceof dc?g.perspectiveTransform:[0,0],ge=O?Hx(Bt):[0,0,0,0];let be,xe,Re,ze,$e,Ie;if(G&&g instanceof dc&&g.coordinates.length>3){be=Float32Array.from(id(Gu(new Vu(0,0,0)))),xe=Float32Array.from(Bt.globeMatrix),Re=Float32Array.from(fE(Bt)),ze=[zs(Bt.center.lng),ba(Bt.center.lat)],Ie=[zs(g.coordinates[1][0]),ba(g.coordinates[1][1]),zs(g.coordinates[3][0]),ba(g.coordinates[3][1])];const Cn=new $a(g.coordinates[1],g.coordinates[3]);$e=Float32Array.from(Av(new Vu(0,0,0),Cn,0,Bt.worldSize/e.transform._pixelsPerMercatorPixel))}else be=new Float32Array(16),xe=new Float32Array(9),Re=new Float32Array(16),ze=[0,0],$e=new Float32Array(16),Ie=[0,0,0,0];const on=gh(yt,be,xe,Re,$e,le||[0,0],Ie,da(e.transform.zoom),ze,ge,Wt||1,Ut,r,Zt,O?r.paint.get("raster-elevation"):0,2,y.mix,y.offset,y.range,1,0,M),vn=e.isTileAffectedByFog(Z),xn=e.getOrCreateProgram("raster",{defines:y.defines,overrideFog:vn});if(e.uploadCommonUniforms(c,xn,Q),g instanceof dc){if(P||!E)g.boundsBuffer&&g.boundsSegments&&xn.draw(e,p.TRIANGLES,it,jr.disabled,D,zr.disabled,on,r.id,g.boundsBuffer,e.quadTriangleIndexBuffer,g.boundsSegments);else if(e.globeSharedBuffers){const[Cn,Mn,hr]=e.globeSharedBuffers.getGridBuffers(0,!1);xn.draw(e,p.TRIANGLES,it,jr.disabled,D,zr.frontCCW,on,r.id,Cn,Mn,hr),xn.draw(e,p.TRIANGLES,it,jr.disabled,D,zr.backCCW,on,r.id,Cn,Mn,hr)}}else{const{tileBoundsBuffer:Cn,tileBoundsIndexBuffer:Mn,tileBoundsSegments:hr}=e.getTileBoundsBuffers(et);xn.draw(e,p.TRIANGLES,it,xt,D,zr.disabled,on,r.id,Cn,Mn,hr)}}e.resetStencilClippingMasks()},background:function(e,t,r,s){const a=r.paint.get("background-color"),u=r.paint.get("background-opacity"),c=r.paint.get("background-emissive-strength");if(0===u)return;const p=e.context,g=p.gl,y=e.transform,x=y.tileSize,E=r.paint.get("background-pattern");if(e.isPatternMissing(E,r.scope))return;const S=!E&&1===a.a&&1===u&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==S)return;const M=jr.disabled,D=e.depthModeForSublayer(0,"opaque"===S?rr.ReadWrite:rr.ReadOnly),P=e.colorModeForDrapableLayerRenderPass(c),O=E?"backgroundPattern":"background";let R,B=s;B||(R=e.getBackgroundTiles(),B=Object.values(R).map(j=>j.tileID)),E&&(p.activeTexture.set(g.TEXTURE0),e.imageManager.bind(e.context,r.scope));for(const j of B){const V=e.isTileAffectedByFog(j),U=e.getOrCreateProgram(O,{overrideFog:V}),G=j.toUnwrapped(),Z=s?j.projMatrix:e.transform.calculateProjMatrix(G);e.prepareDrawTile();const Q=t?t.getTile(j):R?R[j.key]:new fh(j,x,y.zoom,e),et=E?cA(Z,c,u,e,E,r.scope,{tileID:j,tileSize:x}):r0(Z,c,u,a);e.uploadCommonUniforms(p,U,G);const{tileBoundsBuffer:it,tileBoundsIndexBuffer:yt,tileBoundsSegments:xt}=e.getTileBoundsBuffers(Q);U.draw(e,g.TRIANGLES,D,M,P,zr.disabled,et,r.id,it,yt,xt)}},sky:function(e,t,r){const s=e._atmosphere?da(e.transform.zoom):1,a=r.paint.get("sky-opacity")*s;if(0===a)return;const u=e.context,c=r.paint.get("sky-type"),p=new rr(u.gl.LEQUAL,rr.ReadOnly,[0,1]),g=e.frameCounter/1e3%1;"atmosphere"===c?"offscreen"===e.renderPass?r.needsSkyboxCapture(e)&&(function(y,x,E,S){const M=y.context,D=M.gl;let P=x.skyboxFbo;if(!P){P=x.skyboxFbo=M.createFramebuffer(32,32,!0,null),x.skyboxGeometry=new Wx(M),x.skyboxTexture=M.gl.createTexture(),D.bindTexture(D.TEXTURE_CUBE_MAP,x.skyboxTexture),D.texParameteri(D.TEXTURE_CUBE_MAP,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_CUBE_MAP,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_CUBE_MAP,D.TEXTURE_MIN_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_CUBE_MAP,D.TEXTURE_MAG_FILTER,D.LINEAR);for(let j=0;j<6;++j)D.texImage2D(D.TEXTURE_CUBE_MAP_POSITIVE_X+j,0,D.RGBA,32,32,0,D.RGBA,D.UNSIGNED_BYTE,null)}M.bindFramebuffer.set(P.framebuffer),M.viewport.set([0,0,32,32]);const O=x.getCenter(y,!0),R=y.getOrCreateProgram("skyboxCapture"),B=new Float64Array(16);ce.identity(B),ce.rotateY(B,B,.5*-Math.PI),dm(y,x,R,B,O,0),ce.identity(B),ce.rotateY(B,B,.5*Math.PI),dm(y,x,R,B,O,1),ce.identity(B),ce.rotateX(B,B,.5*-Math.PI),dm(y,x,R,B,O,2),ce.identity(B),ce.rotateX(B,B,.5*Math.PI),dm(y,x,R,B,O,3),ce.identity(B),dm(y,x,R,B,O,4),ce.identity(B),ce.rotateY(B,B,Math.PI),dm(y,x,R,B,O,5),M.viewport.set([0,0,y.width,y.height])}(e,r),r.markSkyboxValid(e)):"sky"===e.renderPass&&function(y,x,E,S,M){const D=y.context,P=D.gl,O=y.transform,R=y.getOrCreateProgram("skybox");D.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_CUBE_MAP,x.skyboxTexture);const B={u_matrix:O.skyboxMatrix,u_sun_direction:x.getCenter(y,!1),u_cubemap:0,u_opacity:S,u_temporal_offset:M};y.uploadCommonUniforms(D,R),R.draw(y,P.TRIANGLES,E,jr.disabled,y.colorModeForRenderPass(),zr.backCW,B,"skybox",x.skyboxGeometry.vertexBuffer,x.skyboxGeometry.indexBuffer,x.skyboxGeometry.segment)}(e,r,p,a,g):"gradient"===c&&"sky"===e.renderPass&&function(y,x,E,S,M){const D=y.context,P=D.gl,O=y.transform,R=y.getOrCreateProgram("skyboxGradient");x.skyboxGeometry||(x.skyboxGeometry=new Wx(D)),D.activeTexture.set(P.TEXTURE0);let B=x.colorRampTexture;B||(B=x.colorRampTexture=new fs(D,x.colorRamp,P.RGBA)),B.bind(P.LINEAR,P.CLAMP_TO_EDGE);const j=(Z=S,Q=M,{u_matrix:O.skyboxMatrix,u_color_ramp:0,u_center_direction:x.getCenter(y,!1),u_radius:St(x.paint.get("sky-gradient-radius")),u_opacity:Z,u_temporal_offset:Q});var Z,Q;y.uploadCommonUniforms(D,R),R.draw(y,P.TRIANGLES,E,jr.disabled,y.colorModeForRenderPass(),zr.backCW,j,"skyboxGradient",x.skyboxGeometry.vertexBuffer,x.skyboxGeometry.indexBuffer,x.skyboxGeometry.segment)}(e,r,p,a,g)},debug:function(e,t,r){for(let s=0;s<r.length;s++)Zx(e,t,r[s])},custom:function(e,t,r,s){const a=e.context,u=r.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||"offscreen"===e.renderPass)&&r.isLayerDraped(t)){if("offscreen"===e.renderPass){const c=u.prerender;if(c){if(e.setCustomLayerDefaults(),a.setColorMode(e.colorModeForRenderPass()),"globe"===e.transform.projection.name){const p=e.transform.pointMerc;c.call(u,a.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),da(e.transform.zoom),[p.x,p.y],e.transform.pixelsPerMeterRatio)}else c.call(u,a.gl,e.transform.customLayerMatrix());a.setDirty(),e.setBaseState()}}else if("translucent"===e.renderPass){if(e.terrain&&e.terrain.renderingToTexture){const p=u.renderToTile;if(p){const g=s[0].canonical,y=new ri(g.x+s[0].wrap*(1<<g.z),g.y,g.z);a.setDepthMode(rr.disabled),a.setStencilMode(jr.disabled),a.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),p.call(u,a.gl,y),a.setDirty(),e.setBaseState()}return}e.setCustomLayerDefaults(),a.setColorMode(e.colorModeForRenderPass()),a.setStencilMode(jr.disabled);const c="3d"===u.renderingMode?new rr(e.context.gl.LEQUAL,rr.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,rr.ReadOnly);if(a.setDepthMode(c),"globe"===e.transform.projection.name){const p=e.transform.pointMerc;u.render(a.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),da(e.transform.zoom),[p.x,p.y],e.transform.pixelsPerMeterRatio)}else u.render(a.gl,e.transform.customLayerMatrix());a.setDirty(),e.setBaseState(),a.bindFramebuffer.set(null)}}else Gt("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(e,t,r,s){if("opaque"===e.renderPass)return;const a=r.paint.get("model-opacity");if(0===a)return;const u=r.paint.get("model-cast-shadows");if("shadow"===e.renderPass&&(!u||e.terrain&&a<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof Th))return;const c=e.shadowRenderer,p=r.paint.get("model-receive-shadows");c&&(c.useNormalOffset=!0,p||(c.enabled=!1));const g=()=>{c&&(c.useNormalOffset=!0,p||(c.enabled=!0))},y=t.getSource();if("light-beam"===e.renderPass&&"batched-model"!==y.type)return;if("vector"===y.type||"geojson"===y.type)return function(R,B,j,V){const U=R.transform;if("mercator"!==U.projection.name)return void Gt(`Drawing 3D models for ${U.projection.name} projection is not yet implemented`);const G=U.getFreeCameraOptions().position;if(!R.modelManager)return;const Z=R.modelManager,Q=R.shadowRenderer;if(!j._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const et=j._unevaluatedLayout._values["model-id"],it={...j.layout.get("model-id").parameters};for(const yt of V){const xt=B.getTile(yt).getBucket(j);if(!xt||xt.projection.name!==U.projection.name)continue;const Nt=cO(yt,U);it.zoom=Nt;const ft=et.possiblyEvaluate(it);if(vS(R,xt,yt),Xh.shadowUniformsInitialized=!1,Xh.useSingleShadowCascade=!!Q&&0===Q.getMaxCascadeForTile(yt.toUnwrapped()),"shadow"===R.renderPass&&Q){if(1===R.currentShadowCascade&&xt.isInsideFirstShadowMapFrustum)continue;const le=U.calculatePosMatrix(yt.toUnwrapped(),U.worldSize);if(Xh.tileMatrix.set(le),Xh.shadowTileMatrix=Float32Array.from(Q.calculateShadowPassMatrixFromMatrix(le)),Xh.aabb.min.fill(0),Xh.aabb.max[0]=Xh.aabb.max[1]=$t,Xh.aabb.max[2]=0,bA(xt,Xh,R,j.scope))continue}const Ut=1<<yt.canonical.z,Wt=[((G.x-yt.wrap)*Ut-yt.canonical.x)*$t,(G.y*Ut-yt.canonical.y)*$t,G.z*Ut*$t];for(let le in xt.instancesPerModel){const Bt=xt.instancesPerModel[le];Bt.features.length>0&&(le=ft.evaluate(Bt.features[0].feature,{}));const Zt=Z.getModel(le,j.scope);if(Zt&&Zt.uploaded)for(const ge of Zt.nodes)xA(R,j,ge,Bt,Wt,yt,Xh)}}}(e,t,r,s),void g();if(!y.loaded())return;if("batched-model"===y.type)return function(R,B,j,V){const U=R.context,G=R.transform,Z=R.style.fog,Q=R.shadowRenderer;if("mercator"!==G.projection.name)return void Gt(`Drawing 3D landmark models for ${G.projection.name} projection is not yet implemented`);const et=R.transform.getFreeCameraOptions().position,it=Ot.scale([],[et.x,et.y,et.z],R.transform.worldSize);Ot.negate(it,it);const yt=ce.identity([]),xt=Uh(G.center.lat,G.zoom),Nt=ce.fromScaling([],[1,1,1/xt]);ce.translate(yt,yt,it);const ft=j.paint.get("model-opacity"),Ut=new rr(U.gl.LEQUAL,rr.ReadWrite,R.depthRangeFor3D),Wt=new rr(U.gl.LEQUAL,rr.ReadOnly,R.depthRangeFor3D),le=function(Bt,Zt){for(const ge of V){const be=B.getTile(ge).getBucket(j);if(!be||!be.uploaded)continue;let xe=!1;Q&&(xe=0===Q.getMaxCascadeForTile(ge.toUnwrapped()));const Re=G.calculatePosMatrix(ge.toUnwrapped(),G.worldSize),ze=be.modelTraits;for(const $e of be.getNodesInfo()){if($e.hiddenByReplacement||!$e.node.meshes)continue;const Ie=$e.node,on="light-beam"===R.renderPass,vn=[...Re],xn=$e.evaluatedScale;let Cn=0;R.terrain&&Ie.elevation&&(Cn=Ie.elevation*R.terrain.exaggeration()),ce.translate(vn,vn,[(Ie.anchor?Ie.anchor[0]:0)*(xn[0]-1),(Ie.anchor?Ie.anchor[1]:0)*(xn[1]-1),Cn]),xn!==Cf&&ce.scale(vn,vn,xn),ce.multiply(vn,vn,Ie.matrix);const Mn=ce.multiply([],Nt,vn);ce.multiply(Mn,yt,Mn);const hr=ce.invert([],Mn);ce.transpose(hr,hr),ce.scale(hr,hr,Jg);const qn=ce.multiply([],G.expandedFarZProjMatrix,vn);for(let xi=0;xi<Ie.meshes.length;++xi){const Xr=Ie.meshes[xi],fr=xi===Ie.lightMeshIndex;if(fr){if(!on&&!R.terrain&&R.shadowRenderer){R.currentLayer<R.firstLightBeamLayer&&(R.firstLightBeamLayer=R.currentLayer);continue}}else if(on)continue;const ir={defines:[]},Wn=[];Xx(ir.defines,Wn,Xr,R),4&ze||ir.defines.push("DIFFUSE_SHADED"),xe&&ir.defines.push("SHADOWS_SINGLE_CASCADE");const Yr="shadow"===R.renderPass;if(Yr){a0(Xr,vn,R,j);continue}let ai=null;if(Z){const Us=yS(vn,R.transform);if(ai=new Float32Array(Us),"globe"!==G.projection.name){const Es=Xr.aabb.min,jo=Xr.aabb.max,[Ai,Wa]=Z.getOpacityForBounds(Us,Es[0],Es[1],jo[0],jo[1]);ir.overrideFog=Ai>=Mf||Wa>=Mf}}const Pr=R.getOrCreateProgram("model",ir);!Yr&&Q&&(Q.useNormalOffset=!!Xr.normalBuffer,Q.setupShadowsFromMatrix(vn,Pr,Q.useNormalOffset)),R.uploadCommonUniforms(U,Pr,ge.toUnwrapped(),ai);const Ci=Xr.material,Ds=Ci.pbrMetallicRoughness;Ds.metallicFactor=.9,Ds.roughnessFactor=.5;const ki=0,Ro=o0(new Float32Array(qn),new Float32Array(Mn),new Float32Array(hr),R,ft,Ds.baseColorFactor,Ci.emissiveFactor,Ds.metallicFactor,Ds.roughnessFactor,Ci,ki,j);Pr.draw(R,U.gl.TRIANGLES,Zt&&!fr?Ut:Wt,jr.disabled,Bt?fr||ft<1||$e.hasTranslucentParts?vi.alphaBlended:vi.unblended:vi.disabled,zr.backCCW,Ro,j.id,Xr.vertexBuffer,Xr.indexBuffer,Xr.segments,j.paint,R.transform.zoom,void 0,Wn)}}}};(function(Bt,Zt,ge,be){const xe=Bt.terrain?Bt.terrain.exaggeration():0,Re=Bt.transform.zoom;for(const ze of be){const $e=Zt.getTile(ze).getBucket(ge);$e&&(Bt.conflationActive&&$e.updateReplacement(ze,Bt.replacementSource),$e.evaluateScale(Bt,ge),Bt.terrain&&xe>0&&$e.elevationUpdate(Bt.terrain,xe,ze,ge.source),$e.needsReEvaluation(Bt,Re,ge)&&$e.evaluate(ge))}})(R,B,j,V),1===ft?le(!0,!0):(le(!1,!0),le(!0,!1))}(e,t,r,s),void g();const x=y.getModels(),E=[],S=e.transform.getFreeCameraOptions().position,M=Ot.scale([],[S.x,S.y,S.z],e.transform.worldSize);Ot.negate(M,M);const D=[],P=[];let O=0;for(const R of x){const B=r.paint.get("model-rotation").constantOr(null),j=r.paint.get("model-scale").constantOr(null),V=r.paint.get("model-translation").constantOr(null);R.computeModelMatrix(e,B,j,V,!0,!0,!1);const U=ce.identity([]),G=Uh(R.position.lat,e.transform.zoom),Z=ce.fromScaling([],[1,1,1/G]);ce.translate(U,U,M),E.push({zScaleMatrix:Z,negCameraPosMatrix:U});for(const Q of R.nodes)vA(e.transform,Q,R.matrix,e.transform.expandedFarZProjMatrix,O,D,P);O++}if(D.sort((R,B)=>B.depth-R.depth),"shadow"!==e.renderPass){if(1===a)for(const R of P)Yx(R,e,r,E[R.modelIndex],jr.disabled,e.colorModeForRenderPass());else{for(const R of P)Yx(R,e,r,E[R.modelIndex],jr.disabled,vi.disabled);for(const R of P)Yx(R,e,r,E[R.modelIndex],e.stencilModeFor3D(),e.colorModeForRenderPass());e.resetStencilClippingMasks()}for(const R of D)Yx(R,e,r,E[R.modelIndex],jr.disabled,e.colorModeForRenderPass());g()}else{for(const R of P)a0(R.mesh,R.nodeModelMatrix,e,r);for(const R of D)a0(R.mesh,R.nodeModelMatrix,e,r);g()}}},xS={modelUpload:function(e,t,r){const s=t.getSource();if(!s.loaded())return;if("vector"===s.type||"geojson"===s.type)return void(e.modelManager&&e.modelManager.upload(e,r));if("batched-model"===s.type)return;const a=s.getModels();for(const u of a)u.upload(e.context)}};class EA{constructor(t,r,s){this.context=new qD(t,r),this.transform=s,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=Fc.maxUnderzooming+Fc.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new $I,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new IA(this),this._wireframeDebugCache=new wA,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(t,r){const s=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(s||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new tS(this,t));const a=this._terrain;this.transform.elevation=s?a:null,a.update(t,this.transform,r),this.transform.elevation&&!a.enabled&&(this.transform.elevation=null)}_updateFog(t){const r=t.fog;if(!r||"globe"===this.transform.projection.name||r.getOpacity(this.transform.pitch)<1||r.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[s,a]=r.getFovAdjustedRange(this.transform._fov);if(s>a)return void(this.transform.fogCullDistSq=null);const u=s+.78*(a-s);this.transform.fogCullDistSq=u*u}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,r){if(this.width=t*or.devicePixelRatio,this.height=r*or.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const s of this.style.order)this.style._mergedLayers[s].resize()}setup(){const t=this.context,r=new hu;r.emplaceBack(0,0),r.emplaceBack($t,0),r.emplaceBack(0,$t),r.emplaceBack($t,$t),this.tileExtentBuffer=t.createVertexBuffer(r,zh.members),this.tileExtentSegments=Ui.simpleSegment(0,0,4,2);const s=new hu;s.emplaceBack(0,0),s.emplaceBack($t,0),s.emplaceBack(0,$t),s.emplaceBack($t,$t),this.debugBuffer=t.createVertexBuffer(s,zh.members),this.debugSegments=Ui.simpleSegment(0,0,4,5);const a=new hu;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(-1,1),a.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(a,zh.members),this.viewportSegments=Ui.simpleSegment(0,0,4,2);const u=new $f;u.emplaceBack(0,0,0,0),u.emplaceBack($t,0,$t,0),u.emplaceBack(0,$t,0,$t),u.emplaceBack($t,$t,$t,$t),this.mercatorBoundsBuffer=t.createVertexBuffer(u,Ly.members),this.mercatorBoundsSegments=Ui.simpleSegment(0,0,4,2);const c=new ea;c.emplaceBack(0,1,2),c.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(c);const p=new I_;for(const y of[0,1,3,2,0])p.emplaceBack(y);this.debugIndexBuffer=t.createIndexBuffer(p),this.emptyTexture=new fs(t,new Hs({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=ce.create();const g=this.context.gl;this.stencilClearMode=new jr({func:g.ALWAYS,mask:0},0,255,g.ZERO,g.ZERO,g.ZERO),this.loadTimeStamps.push(rt.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,rr.disabled,this.stencilClearMode,vi.disabled,zr.disabled,Nx(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,r,s){if(!r||this.currentStencilSource===r.id||!t.isTileClipped()||!s||0===s.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let p=!1;for(const g of s)if(void 0===this._tileClippingMaskIDs[g.key]){p=!0;break}if(!p)return}this.currentStencilSource=r.id;const a=this.context,u=a.gl;this.nextStencilID+s.length>256&&this.clearStencil(),a.setColorMode(vi.disabled),a.setDepthMode(rr.disabled);const c=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const p of s){const g=r.getTile(p),y=this._tileClippingMaskIDs[p.key]=this.nextStencilID++,{tileBoundsBuffer:x,tileBoundsIndexBuffer:E,tileBoundsSegments:S}=this.getTileBoundsBuffers(g);c.draw(this,u.TRIANGLES,rr.disabled,new jr({func:u.ALWAYS,mask:0},y,255,u.KEEP,u.KEEP,u.REPLACE),vi.disabled,zr.disabled,Nx(p.projMatrix),"$clipping",x,E,S)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new jr({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const r=this.context.gl;return new jr({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,s=t.sort((c,p)=>p.overscaledZ-c.overscaledZ),a=s[s.length-1].overscaledZ,u=s[0].overscaledZ-a+1;if(u>1){this.currentStencilSource=void 0,this.nextStencilID+u>256&&this.clearStencil();const c={};for(let p=0;p<u;p++)c[p+a]=new jr({func:r.GEQUAL,mask:255},p+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=u,[c,s]}return[{[a]:jr.disabled},s]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new vi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new pn(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?vi.unblended:vi.alphaBlended}colorModeForDrapableLayerRenderPass(t){const r=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new vi([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new pn(0,0,0,void 0===t?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,r,s,a=!1){if(!this.opaquePassEnabledForLayer()&&!a)return rr.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new rr(s||this.context.gl.LEQUAL,r,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,r){this._wireframeDebugCache.update(this.frameCounter),this.style=t,this.options=r;const s=this.style._mergedLayers,a=this.style.order,u=a.map(U=>s[U]),c=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(or.now()),this.imageManager.beginFrame();let p=0,g=!1;for(const U in c){const G=c[U];G.used&&(G.prepare(this.context),G.getSource().usedInConflation&&++p)}const y={},x={},E={},S={},M={};for(const U in c){const G=c[U];y[U]=G.getVisibleCoordinates(),x[U]=y[U].slice().reverse(),E[U]=G.getVisibleCoordinates(!0).reverse(),S[U]=G.getShadowCasterCoordinates(),M[U]=G.sortCoordinatesByDistance(y[U])}const D=U=>{const G=this.style.getLayerSourceCache(U);return G&&G.used?G.getSource():null};if(p){const U=[];for(const G of u)this.layerUsedInConflation(G,D(G))&&U.push(G);if(U&&U.length>1){const G=[];for(const Z of U){const Q=this.style.getLayerSourceCache(Z);Q&&Q.used&&Q.getSource().usedInConflation&&G.push({layer:Z.fqid,cache:Q})}this.replacementSource.setSources(G),g=!0}}g||this.replacementSource.clear(),this.conflationActive=g,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const U of u){const G=U.cutoffRange();if(this.longestCutoffRange=Math.max(G,this.longestCutoffRange),G>0){const Z=D(U);Z&&(this.minCutoffZoom=Math.max(Z.minzoom,this.minCutoffZoom)),U.minzoom&&(this.minCutoffZoom=Math.max(U.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let U=0;U<u.length;U++)if(u[U].is3D()){this.opaquePassCutoff=U;break}const P=this.style&&this.style.fog;P?(this._fogVisible=0!==P.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=P.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(E),this.opaquePassCutoff=0);const O=this._shadowRenderer;if(O){O.updateShadowParameters(this.transform,this.style.directionalLight);for(const U in c)for(const G of y[U]){let Z={min:0,max:0};this.terrain&&(Z=this.terrain.getMinMaxForTile(G)||Z),O.addShadowReceiver(G.toUnwrapped(),Z.min,Z.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new qL(this.context));for(const U of u){if(U.isHidden(this.transform.zoom))continue;const G=t.getLayerSourceCache(U);this.uploadLayer(this,U,G)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new pm),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!jl.has(this.context.gl))return;this.renderPass="offscreen";for(const U of u){const G=t.getLayerSourceCache(U);if(!U.hasOffscreenPass()||U.isHidden(this.transform.zoom))continue;const Z=G?x[G.id]:void 0;("custom"===U.type||"raster"===U.type||U.isSky()||Z&&Z.length)&&this.renderLayer(this,G,U,Z)}this.depthRangeFor3D=[0,1-(u.length+2)*this.numSublayers*this.depthEpsilon];const R=this.terrain;R&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&R.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,S)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const B="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),j=(()=>{if(r.showOverdrawInspector)return pn.black;if(this.style.fog&&this.transform.projection.supportsFog&&!B){const U=this.style.fog.properties.get("color").toArray01();return new pn(...U)}if(this.style.fog&&this.transform.projection.supportsFog&&B){const U=this.style.fog.properties.get("space-color").toArray01();return new pn(...U)}return pn.transparent})();if(this.context.clear({color:j,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&B&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const U=u[this.currentLayer],G=t.getLayerSourceCache(U);if(U.isSky())continue;const Z=G?(U.is3D()?M:x)[G.id]:void 0;this._renderTileClippingMasks(U,G,Z),this.renderLayer(this,G,U,Z)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&B&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||da(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const U=u[this.currentLayer],G=t.getLayerSourceCache(U);U.isSky()&&this.renderLayer(this,G,U,G?x[G.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let V=0;for(O&&(V=O.getShadowCastingLayerCount());this.currentLayer<a.length;){const U=u[this.currentLayer],G=t.getLayerSourceCache(U);if(U.isSky()){++this.currentLayer;continue}if(R&&this.style.isLayerDraped(U)){if(U.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=R.renderBatch(this.currentLayer);continue}let Z;if(G&&(Z=("symbol"===U.type?E:U.is3D()?M:x)[G.id]),this._renderTileClippingMasks(U,G,G?y[G.id]:void 0),this.renderLayer(this,G,U,Z),!R&&O&&V>0&&U.hasShadowPass()&&0==--V&&(O.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Q=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Q;this.currentLayer++){const et=u[this.currentLayer];if(!et.hasLightBeamPass())continue;const it=t.getLayerSourceCache(et);this.renderLayer(this,it,et,it?x[it.id]:void 0)}this.currentLayer=Q,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let U=null;u.forEach(G=>{const Z=t.getLayerSourceCache(G);Z&&!G.isHidden(this.transform.zoom)&&Z.getVisibleCoordinates().length&&(!U||U.getSource().maxzoom<Z.getSource().maxzoom)&&(U=Z)}),U&&this.options.showTileBoundaries&&Kx.debug(this,U,U.getVisibleCoordinates())}this.options.showPadding&&function(U){const G=U.transform.padding;mS(U,U.transform.height-(G.top||0),3,fA),mS(U,G.bottom||0,3,dA),gS(U,G.left||0,3,pA),gS(U,U.transform.width-(G.right||0),3,mA);const Z=U.transform.centerPoint;var Q,et,it,yt;s0(Q=U,(et=Z.x)-1,(it=U.transform.height-Z.y)-10,2,20,yt=pS),s0(Q,et-10,it-1,20,2,yt)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(rt.performance.now()),this.saveCanvasCopy()),g||(this.conflationActive=!1)}uploadLayer(t,r,s){this.gpuTimingStart(r),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(r.type)||t.terrain&&"custom"===r.type)&&xS[`${r.type}Upload`]&&xS[`${r.type}Upload`](t,s,r.scope),this.gpuTimingEnd()}renderLayer(t,r,s,a){s.isHidden(this.transform.zoom)||("background"===s.type||"sky"===s.type||"custom"===s.type||"model"===s.type||"raster"===s.type||a&&a.length)&&(this.id=s.id,this.gpuTimingStart(s),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(s.type)||t.terrain&&"custom"===s.type)&&Kx[s.type](t,r,s,a,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery,s=this.context.gl;let a=this.gpuTimers[t.id];a||(a=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:s.createQuery()}),a.calls++,s.beginQuery(r.TIME_ELAPSED_EXT,a.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,r=this.context.gl,s=r.createQuery();this.deferredRenderGpuTimeQueries.push(s),r.beginQuery(t.TIME_ELAPSED_EXT,s)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const r={};for(const s in t){const a=t[s],u=this.context.extTimerQuery,c=u.getQueryParameter(a.query,this.context.gl.QUERY_RESULT)/1e6;u.deleteQueryEXT(a.query),r[s]=c}return r}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const r=this.context.extTimerQuery,s=this.context.gl;let a=0;for(const u of t)a+=r.getQueryParameter(u,s.QUERY_RESULT)/1e6,r.deleteQueryEXT(u);return a}translatePosMatrix(t,r,s,a,u){if(!s[0]&&!s[1])return t;const c=u?"map"===a?this.transform.angle:0:"viewport"===a?-this.transform.angle:0;if(c){const y=Math.sin(c),x=Math.cos(c);s=[s[0]*x-s[1]*y,s[0]*y+s[1]*x]}const p=[u?s[0]:Pd(r,s[0],this.transform.zoom),u?s[1]:Pd(r,s[1],this.transform.zoom),0],g=new Float32Array(16);return ce.translate(g,t,p),g}saveTileTexture(t){const r=t.size[0],s=this._tileTextures[r];s?s.push(t):this._tileTextures[r]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}isPatternMissing(t,r){return null===t||void 0!==t&&!this.imageManager.getPattern(t.toString(),r)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(t,r,s){const a=void 0===s?this.terrain&&this.terrain.renderingToTexture:s,u=this.terrain&&0===this.terrain.exaggeration(),c=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===t||"terrainRaster"===t?(c.push("LIGHTING_3D_MODE"),c.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):a||c.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||c.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?c.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):c.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(c.push("TERRAIN"),this.linearFloatFilteringSupported()&&c.push("TERRAIN_DEM_FLOAT_FORMAT"),u&&c.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&c.push("GLOBE"),!this._fogVisible||a||void 0!==r&&!r||c.push("FOG","FOG_DITHERING"),a&&c.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&c.push("OVERDRAW_INSPECTOR"),c}getOrCreateProgram(t,r){this.cache=this.cache||{};const s=r&&r.defines||[],a=r&&r.config,u=this.currentGlobalDefines(t,r&&r.overrideFog,r&&r.overrideRtt).concat(s),c=K2.cacheKey(Ox[t],t,u,a);return this.cache[c]||(this.cache[c]=new K2(this.context,t,Ox[t],a,lS[t],u)),this.cache[c]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=rt.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new fs(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,r){if(this.style.enable3dLights()){const s=this.style.directionalLight,a=this.style.ambientLight;if(s&&a){const u=((c,p)=>{const g=c.properties.get("direction"),y=c.properties.get("color").toArray01(),x=c.properties.get("intensity"),E=p.properties.get("color").toArray01(),S=p.properties.get("intensity"),M=[g.x,g.y,g.z],D=Nn(E,S),P=Nn(y,x);return{u_lighting_ambient_color:D,u_lighting_directional_dir:M,u_lighting_directional_color:P,u_ground_radiance:eS(M,P,D)}})(s,a);r.setLightsUniformValues(t,u)}}}uploadCommonUniforms(t,r,s,a,u){if(this.uploadCommonLightUniforms(t,r),this.terrain&&this.terrain.renderingToTexture)return;const c=this.style.fog;if(c){const p=c.getOpacity(this.transform.pitch),g=((y,x,E,S,M,D,P,O,R,B,j,V)=>{const U=y.transform,G=x.properties.get("color").toArray01();G[3]=S;const Z=y.frameCounter/1e3%1,[Q,et]=x.properties.get("vertical-range");return{u_fog_matrix:E?U.calculateFogTileMatrix(E):V||y.identityMat,u_fog_range:x.getFovAdjustedRange(U._fov),u_fog_color:G,u_fog_horizon_blend:x.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Q,et),et],u_fog_temporal_offset:Z,u_frustum_tl:M,u_frustum_tr:D,u_frustum_br:P,u_frustum_bl:O,u_globe_pos:R,u_globe_radius:B,u_viewport:j,u_globe_transition:da(U.zoom),u_is_globe:+("globe"===U.projection.name)}})(this,c,s,p,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*or.devicePixelRatio,this.transform.height*or.devicePixelRatio],a);r.setFogUniformValues(t,g)}u&&r.setCutoffUniformValues(t,u.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),r}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,r=this._backgroundTiles={},s=this.transform.coveringTiles({tileSize:512});for(const a of s)r[a.key]=t[a.key]||new fh(a,512,this.transform.tileZoom,this);return r}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(t,r){return!(!t.is3D()||t.minzoom&&t.minzoom>this.transform.zoom||"building"!==t.sourceLayer&&(!r||"batched-model"!==r.type))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let r=this._cachedTileFogOpacities[t.key];return r||(this._cachedTileFogOpacities[t.key]=r=this.style.fog.getOpacityForTile(t)),r[0]>=Mf||r[1]>=Mf}}const Bd=2048;class Qx{constructor(t,r){this.aabb=t,this.lastCascade=r}}class bS{add(t,r){const s=this.receivers[t.key];void 0!==s?(s.aabb.min[0]=Math.min(s.aabb.min[0],r.min[0]),s.aabb.min[1]=Math.min(s.aabb.min[1],r.min[1]),s.aabb.min[2]=Math.min(s.aabb.min[2],r.min[2]),s.aabb.max[0]=Math.max(s.aabb.max[0],r.max[0]),s.aabb.max[1]=Math.max(s.aabb.max[1],r.max[1]),s.aabb.max[2]=Math.max(s.aabb.max[2],r.max[2])):this.receivers[t.key]=new Qx(r,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,r,s){const a=Qi.fromPoints(t.points);let u=0;for(const c in this.receivers){const p=this.receivers[c];if(!p||!a.intersectsAabb(p.aabb))continue;p.aabb.min=a.closestPoint(p.aabb.min),p.aabb.max=a.closestPoint(p.aabb.max);const g=p.aabb.getCorners();for(let y=0;y<s.length;y++){let x=!0;for(const E of g){const S=[E[0]*r,E[1]*r,E[2]];if(Ot.transformMat4(S,S,s[y].matrix),S[0]<-1||S[0]>1||S[1]<-1||S[1]>1){x=!1;break}}if(p.lastCascade=y,u=Math.max(u,y),x)break}}return u+1}}class IA{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new bS,this._depthMode=new rr(t.context.gl.LEQUAL,rr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,r){const s=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;const a=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||a<=0||(this._shadowLayerCount=s.style.order.reduce((M,D)=>{const P=s.style._mergedLayers[D];return M+(P.hasShadowPass()&&!P.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const u=s.context,c=Bd,p=Bd;if(0===this._cascades.length)for(let M=0;M<2;++M){const D=s._shadowMapDebug,P=u.gl,O=u.createFramebuffer(c,p,D,"texture"),R=new fs(u,{width:c,height:p,data:null},P.DEPTH_COMPONENT);if(O.depthAttachment.set(R.texture),D){const B=new fs(u,{width:c,height:p,data:null},P.RGBA);O.colorAttachment.set(B.texture)}this._cascades.push({framebuffer:O,texture:R,matrix:[],far:0,boundingSphereRadius:0,frustum:new Lc,scale:0})}this.shadowDirection=l0(r);let g=0;if(t.elevation){const M=t.elevation,D=[1e4,-1e4];M.visibleDemTiles.filter(P=>P.dem).forEach(P=>{const O=P.dem.tree;D[0]=Math.min(D[0],O.minimums[0]),D[1]=Math.max(D[1],O.maximums[0])}),1e4!==D[0]&&(g=(D[1]-D[0])*M.exaggeration())}const y=1.5*t.cameraToCenterDistance,x=3*y,E=new Float64Array(16);for(let M=0;M<2;++M){const D=this._cascades[M];let P=t.height/50,O=1;0===M?O=y:(P=y,O=x);const[R,B]=ES(t,this.shadowDirection,P,O,Bd,g);D.scale=t.scale,D.matrix=R,D.boundingSphereRadius=B,ce.invert(E,D.matrix),D.frustum=Lc.fromInvProjectionMatrix(E,1,0,!0),D.far=O}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=a,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Bd,this._uniformValues.u_shadowmap_0=vu.ShadowMap0,this._uniformValues.u_shadowmap_1=vu.ShadowMap0+1,this._groundShadowTiles=s.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const S=s.transform.elevation;for(const M of this._groundShadowTiles){let D={min:0,max:0};if(S){const P=S.getMinMaxForTile(M);P&&(D=P)}this.addShadowReceiver(M.toUnwrapped(),D.min,D.max)}}get enabled(){return this._enabled}set enabled(t){this._enabled=t}drawShadowPass(t,r){if(!this._enabled)return;const s=this.painter,a=s.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(s.transform.getFrustum(0),s.transform.worldSize,this._cascades),a.viewport.set([0,0,Bd,Bd]);for(let u=0;u<this._numCascadesToRender;++u){s.currentShadowCascade=u,a.bindFramebuffer.set(this._cascades[u].framebuffer.framebuffer),a.clear({color:pn.white,depth:1});for(const c of t.order){const p=t._mergedLayers[c];if(!p.hasShadowPass()||p.isHidden(s.transform.zoom))continue;const g=t.getLayerSourceCache(p),y=g?r[g.id]:void 0;("model"===p.type||y&&y.length)&&s.renderLayer(s,g,p,y)}}s.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const t=this.painter,r=t.style,s=t.context,a=r.directionalLight,u=r.ambientLight;if(!a||!u)return;const c=[],p=lm(t,t.longestCutoffRange);p.shouldRenderCutoff&&c.push("RENDER_CUTOFF");const g=wS(a,u),y=new rr(s.gl.LEQUAL,rr.ReadOnly,t.depthRangeFor3D);for(const x of this._groundShadowTiles){const E=x.toUnwrapped(),S=t.isTileAffectedByFog(x),M=t.getOrCreateProgram("groundShadow",{defines:c,overrideFog:S});this.setupShadows(E,M),t.uploadCommonUniforms(s,M,E,null,p);const D={u_matrix:t.transform.calculateProjMatrix(E),u_ground_shadow_factor:g};M.draw(t,s.gl.TRIANGLES,y,jr.disabled,vi.multiply,zr.disabled,D,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?vi.unblended:vi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const r=this.painter.transform,s=r.calculatePosMatrix(t,r.worldSize);return ce.multiply(s,this._cascades[this.painter.currentShadowCascade].matrix,s),Float32Array.from(s)}calculateShadowPassMatrixFromMatrix(t){return ce.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,r,s,a=0){if(!this._enabled)return;const u=this.painter.transform,c=this.painter.context,p=c.gl,g=this._uniformValues,y=new Float64Array(16),x=u.calculatePosMatrix(t,u.worldSize);for(let E=0;E<2;E++)ce.multiply(y,this._cascades[E].matrix,x),g[0===E?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(y),c.activeTexture.set(p.TEXTURE0+vu.ShadowMap0+E),this._cascades[E].texture.bind(p.NEAREST,p.CLAMP_TO_EDGE);if(this.useNormalOffset=!!s,this.useNormalOffset){const E=sg(t.canonical),S=2/u.tileSize*$t/Bd,M=S*this._cascades[0].boundingSphereRadius,D=S*this._cascades[1].boundingSphereRadius,P=("vector-tile"===s?1:3)/Math.pow(2,a-t.canonical.z-(1-u.zoom+Math.floor(u.zoom)));g.u_shadow_normal_offset=[E,M*P,D*P],g.u_shadow_bias=[6e-5,.0012,.012]}else g.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(c,g)}setupShadowsFromMatrix(t,r,s=!1){if(!this._enabled)return;const a=this.painter.context,u=a.gl,c=this._uniformValues,p=new Float64Array(16);for(let g=0;g<2;g++)ce.multiply(p,this._cascades[g].matrix,t),c[0===g?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(p),a.activeTexture.set(u.TEXTURE0+vu.ShadowMap0+g),this._cascades[g].texture.bind(u.NEAREST,u.CLAMP_TO_EDGE);this.useNormalOffset=s,s?(c.u_shadow_normal_offset=[1,5,5],c.u_shadow_bias=[6e-5,.0012,.012]):c.u_shadow_bias=[36e-5,.0012,.012],r.setShadowUniformValues(a,c)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,r,s,a){if(a[2]>=0)return{};const u=function(g,y,x){const E=x/(1<<g.canonical.z);return new Qi([g.canonical.x*E+g.wrap*x,g.canonical.y*E+g.wrap*x,0],[(g.canonical.x+1)*E+g.wrap*x,(g.canonical.y+1)*E+g.wrap*x,y])}(t,r,s).getCorners(),c=r/-a[2];a[0]<0?(Ot.add(u[0],u[0],[a[0]*c,0,0]),Ot.add(u[3],u[3],[a[0]*c,0,0])):a[0]>0&&(Ot.add(u[1],u[1],[a[0]*c,0,0]),Ot.add(u[2],u[2],[a[0]*c,0,0])),a[1]<0?(Ot.add(u[0],u[0],[0,a[1]*c,0]),Ot.add(u[1],u[1],[0,a[1]*c,0])):a[1]>0&&(Ot.add(u[2],u[2],[0,a[1]*c,0]),Ot.add(u[3],u[3],[0,a[1]*c,0]));const p={};return p.vertices=u,p.planes=[Ud(u[1],u[0],u[4]),Ud(u[2],u[1],u[5]),Ud(u[3],u[2],u[6]),Ud(u[0],u[3],u[7])],p}addShadowReceiver(t,r,s){this._receivers.add(t,Qi.fromTileIdAndHeight(t,r,s))}getMaxCascadeForTile(t){const r=this._receivers.get(t);return r&&r.lastCascade?r.lastCascade:0}}function Ud(e,t,r){const s=Ot.sub([],r,t),a=Ot.sub([],e,t),u=Ot.cross([],s,a),c=Ot.length(u);return 0===c?[0,0,1,0]:(Ot.scale(u,u,1/c),[u[0],u[1],u[2],-Ot.dot(u,t)])}function l0(e){const t=e.properties.get("direction"),r=gn(t.x,t.y,t.z);r[2]=At(r[2],0,75);const s=We([r[0],r[1],r[2]]);return Ot.fromValues(s.x,s.y,s.z)}function wS(e,t){const r=e.properties.get("color"),s=e.properties.get("intensity"),a=e.properties.get("direction"),u=[a.x,a.y,a.z],c=t.properties.get("color"),p=t.properties.get("intensity"),g=Math.max(Ot.dot([0,0,1],u),0),y=[0,0,0];Ot.scale(y,c.toArray01Linear().slice(0,3),p);const x=[0,0,0];return Ot.scale(x,r.toArray01Linear().slice(0,3),g*s),Hr([y[0]>0?y[0]/(y[0]+x[0]):0,y[1]>0?y[1]/(y[1]+x[1]):0,y[2]>0?y[2]/(y[2]+x[2]):0])}function ES(e,t,r,s,a,u){const c=e.zoom,p=e.scale,g=e.worldSize,y=1/g,x=e.aspect,E=Math.sqrt(1+x*x)*Math.tan(.5*e.fovX),S=E*E,M=s-r,D=s+r;let P,O;S>M/D?(P=s,O=s*E):(P=.5*D*(1+S),O=.5*Math.sqrt(M*M+2*(s*s+r*r)*S+D*D*S*S));const R=e.projection.pixelsPerMeter(e.center.lat,g),B=e._camera.getCameraToWorldMercator(),j=[0,0,-P*y];Ot.transformMat4(j,j,B);let V=O*y;const U=e._edgeInsets;if(!(0===U.left&&0===U.top&&0===U.right&&0===U.bottom||U.left===U.right&&U.top===U.bottom)){const be=e._camera.getWorldToCamera(e.worldSize,"meters"===e.projection.zAxisUnit?R:1),xe=e._camera.getCameraToClipPerspective(e._fov,e.width/e.height,r,s);xe[8]=2*-e.centerOffset.x/e.width,xe[9]=2*e.centerOffset.y/e.height;const Re=new Float64Array(16);ce.mul(Re,xe,be);const ze=new Float64Array(16);ce.invert(ze,Re);const $e=Lc.fromInvProjectionMatrix(ze,g,c,!0);for(const Ie of $e.points){const on=((G=Ie)[0]/=p,G[1]/=p,G[2]=ji(G[2],e._center.lat),G);V=Math.max(V,Ot.len(Ot.subtract([],j,on)))}}var G;V*=a/(a-1);const Z=Math.acos(t[2]),Q=Math.atan2(-t[0],-t[1]),et=new Fy;et.position=j,et.setPitchBearing(Z,Q);const it=et.getWorldToCamera(g,R),yt=V*g,xt=Math.min(e._mercatorZfromZoom(17)*g*-2,-2*yt),Nt=et.getCameraToClipOrthographic(-yt,yt,-yt,yt,xt,(yt+u*R)/t[2]),ft=new Float64Array(16);ce.multiply(ft,Nt,it);const Ut=Ot.fromValues(Math.floor(1e6*j[0])/1e6*g,Math.floor(1e6*j[1])/1e6*g,0),Wt=.5*a,le=[0,0,0];Ot.transformMat4(le,Ut,ft),Ot.scale(le,le,Wt);const Bt=[Math.floor(le[0]),Math.floor(le[1]),Math.floor(le[2])],Zt=[0,0,0];Ot.sub(Zt,le,Bt),Ot.scale(Zt,Zt,-1/Wt);const ge=new Float64Array(16);return ce.identity(ge),ce.translate(ge,ge,Zt),ce.multiply(ft,ge,ft),[ft,yt]}class CA extends Qn{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,r){return I2(this.requestManager.transformRequest(r,Kt.Model).url).then(s=>{if(!s)return;const a=zd(s),u=new jI(t,void 0,void 0,a);return u.computeBoundsAndApplyParent(),u}).catch(s=>{this.fire(new Oe(new Error(`Could not load model ${t} from ${r}: ${s.message}`)))})}load(t,r){this.models[r]||(this.models[r]={});const s=Object.keys(t);this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+s.length;const a=[];for(const u of s)a.push(this.loadModel(u,t[u]));Promise.allSettled(a).then(u=>{for(let c=0;c<u.length;c++){const{status:p,value:g}=u[c];"fulfilled"===p&&g&&(this.models[r][s[c]]=g)}this.numModelsLoading[r]-=s.length,this.fire(new Se("data",{dataType:"style"}))}).catch(u=>{this.fire(new Oe(new Error(`Could not load models: ${u.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,r){return!!this.getModel(t,r)}getModel(t,r){return this.models[r]||(this.models[r]={}),this.models[r][t]}addModel(t,r,s){this.models[s]||(this.models[s]={}),this.hasModel(t,s)&&this.removeModel(t,s),this.load({[t]:this.requestManager.normalizeModelURL(r)},s)}addModels(t,r){const s={};for(const a in t)s[a]=this.requestManager.normalizeModelURL(t[a]);this.load(s,r)}removeModel(t,r){this.models[r]||(this.models[r]={});const s=this.models[r][t];delete this.models[r][t],s.destroy()}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,r){this.models[r]||(this.models[r]={});for(const s in this.models[r])this.models[r][s].upload(t.context)}}const mm=(e,t)=>Tm(e,t&&t.filter(r=>"source.canvas"!==r.identifier)),gm=Fe(Di,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),SA=Fe(Di,["setCenter","setZoom","setBearing","setPitch"]),tb={version:8,layers:[],sources:{}},u0={duration:300,delay:0},hO=new Set(["fill","line","background","hillshade","raster"]);class Uc extends Qn{constructor(t,r={}){super(),this.map=t,this.scope=r.scope||"",this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=pe({},u0),this._buildingIndex=new P2(this),this.crossTileSymbolIndex=new $2,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=r.styleChanges||new gT,this.dispatcher=r.dispatcher?r.dispatcher:new kg(Hh(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new pC,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new Ap(t._requestManager,r.localFontFamily?2:r.localIdeographFontFamily?1:0,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new CA(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this._config=r.config,this.dispatcher.broadcast("setReferrer",se());const s=this;this._rtlTextPluginCallback=Uc.registerForPluginStateChange(a=>{s.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:a.pluginStatus,pluginURL:a.pluginURL},(u,c)=>{if(m_(u),c&&c.every(p=>p))for(const p in s._sourceCaches){const g=s._sourceCaches[p],y=g.getSource().type;"vector"!==y&&"geojson"!==y||g.reload()}})}),this.on("data",a=>{if("source"!==a.dataType||"metadata"!==a.sourceDataType)return;const u=this.getOwnSource(a.sourceId);if(u&&u.vectorLayerIds)for(const c in this._layers){const p=this._layers[c];p.source===u.id&&this._validateLayer(p)}})}loadURL(t,r={}){this.fire(new Se("dataloading",{dataType:"style"}));const s="boolean"==typeof r.validate?r.validate:!gr(t);t=this.map._requestManager.normalizeStyleURL(t,r.accessToken),this.resolvedImports.add(t);const a=this.importsCache.get(t);if(a)return this._load(a,s);const u=this.map._requestManager.transformRequest(t,Kt.Style);this._request=ye(u,(c,p)=>{if(this._request=null,c)this.fire(new Oe(c));else if(p)return this.importsCache.set(t,p),this._load(p,s)})}loadJSON(t,r={}){this.fire(new Se("dataloading",{dataType:"style"})),this._request=or.frame(()=>{this._request=null,this._load(t,!1!==r.validate)})}loadEmpty(){this.fire(new Se("dataloading",{dataType:"style"})),this._load(tb,!1)}_loadImports(t,r){if(this.importDepth>=4)return Gt("Style doesn't support nesting deeper than 5"),Promise.resolve();const s=[];for(const a of t){const u=this._createFragmentStyle(a),c=new Promise(g=>{u.once("style.import.load",g),u.once("error",g)}).then(()=>this.mergeAll());if(s.push(c),this.resolvedImports.has(a.url)){u.loadEmpty();continue}const p=a.data||this.importsCache.get(a.url);p?u.loadJSON(p,{validate:r}):a.url?u.loadURL(a.url,{validate:r}):u.loadEmpty(),this.fragments.push({style:u,id:a.id,config:a.config})}return Promise.allSettled(s)}_createFragmentStyle(t){const r=this.scope?ul(t.id,this.scope):t.id,s=new Uc(this.map,{scope:r,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:t.config});return s.setEventedParent(this.map,{style:s}),s}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const t=this.isRootStyle();this._shouldPrecompile=t,this.fire(new Se(t?"style.load":"style.import.load"))}_load(t,r){const s=t.schema;if(this.isRootStyle()&&(t.fragment||s&&!1!==t.fragment)){const c=pe({},tb,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(c,r)}if(this.setConfig(this._config,s),r&&mm(this,Ah(t)))return;this._loaded=!0,this.stylesheet=st(t);for(const c in t.sources)this.addSource(c,t.sources[c],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const a=xx(this.stylesheet.layers);if(this._order=a.map(c=>c.id),this.stylesheet.light&&Gt("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const c=this.stylesheet.lights[0];this.light=new Q1(c.properties,c.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Q1(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const c of a){const p=qy(c,this.options);p.setScope(this.scope),p.isConfigDependent&&this._configDependentLayers.add(p.fqid),p.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=p,this._serializedLayers[p.id]=p.serialize();const g=this.getOwnLayerSourceCache(p),y=!!this.directionalLight&&this.directionalLight.shadowsEnabled();g&&p.canCastShadows()&&y&&(g.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const u=this.stylesheet.terrain;u&&(void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=or.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?Gt("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(u,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new Se("data",{dataType:"style"})),t.imports?this._loadImports(t.imports,r).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return 0===this.importDepth}mergeAll(){let t,r,s,a,u,c,p,g;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(y=>{if(y.stylesheet){if(null!=y.light&&(t=y.light),y.stylesheet.lights)for(const x of y.stylesheet.lights)"ambient"===x.type&&null!=y.ambientLight&&(r=y.ambientLight),"directional"===x.type&&null!=y.directionalLight&&(s=y.directionalLight);a=this._prioritizeTerrain(a,y.terrain,y.stylesheet.terrain),y.stylesheet.fog&&null!=y.fog&&(u=y.fog),null!=y.stylesheet.camera&&(g=y.stylesheet.camera),null!=y.stylesheet.projection&&(c=y.stylesheet.projection),null!=y.stylesheet.transition&&(p=y.stylesheet.transition)}}),this.light=t,this.ambientLight=r,this.directionalLight=s,this.fog=u,null===a?delete this.terrain:this.terrain=a,this.camera=g||{"camera-projection":"perspective"},this.projection=c||{name:"mercator"},this.transition=pe({},u0,p),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const r=s=>{for(const a of s.fragments)r(a.style);t(s)};r(this)}_prioritizeTerrain(t,r,s){const a=t&&0===t.drapeRenderMode;return null===s?r&&0===r.drapeRenderMode?r:a?t:null:null!=r&&(!t||a||r&&1===r.drapeRenderMode)?r:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(r=>{t=this._prioritizeTerrain(t,r.terrain,r.stylesheet.terrain)}),null===t?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(r=>{null!=r.stylesheet.projection&&(t=r.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},r={},s={};this.forEachFragmentStyle(a=>{for(const u in a._sourceCaches){const c=ul(u,a.scope);t[c]=a._sourceCaches[u]}for(const u in a._otherSourceCaches){const c=ul(u,a.scope);r[c]=a._otherSourceCaches[u]}for(const u in a._symbolSourceCaches){const c=ul(u,a.scope);s[c]=a._symbolSourceCaches[u]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=s}mergeLayers(){const t={},r=[],s={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(u=>{for(const c of u._order){const p=u._layers[c];if("slot"===p.type){const g=Lm(c);if(t[g])continue;t[g]=[]}p.slot&&t[p.slot]?t[p.slot].push(p):r.push(p)}}),this._mergedOrder=[];const a=(u=[])=>{for(const c of u)if("slot"===c.type){const p=Lm(c.id);t[p]&&a(t[p])}else{const p=ul(c.id,c.scope);this._mergedOrder.push(p),s[p]=c,c.is3D()&&(this._has3DLayers=!0),"circle"===c.type&&(this._hasCircleLayers=!0),"symbol"===c.type&&(this._hasSymbolLayers=!0)}};a(r),this._mergedLayers=s,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=pe({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(r,s,a){let u,c,p;const g=or.devicePixelRatio>1?"@2x":"";let y=ye(s.transformRequest(s.normalizeSpriteURL(r,g,".json"),Kt.SpriteJSON),(S,M)=>{y=null,p||(p=S,u=M,E())}),x=Tn(s.transformRequest(s.normalizeSpriteURL(r,g,".png"),Kt.SpriteImage),(S,M)=>{x=null,p||(p=S,c=M,E())});function E(){if(p)a(p);else if(u&&c){const S=or.getImageData(c),M={};for(const D in u){const{width:P,height:O,x:R,y:B,sdf:j,pixelRatio:V,stretchX:U,stretchY:G,content:Z}=u[D],Q=new Hs({width:P,height:O});Hs.copy(S,Q,{x:R,y:B},{x:0,y:0},{width:P,height:O}),M[D]={data:Q,pixelRatio:V,sdf:j,stretchX:U,stretchY:G,content:Z}}a(null,M)}}return{cancel(){y&&(y.cancel(),y=null),x&&(x.cancel(),x=null)}}}(t,this.map._requestManager,(r,s)=>{if(this._spriteRequest=null,r)this.fire(new Oe(r));else if(s)for(const a in s)this.imageManager.addImage(a,this.scope,s[a]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new Se("data",{dataType:"style"}))})}_validateLayer(t){const r=this.getOwnSource(t.source);if(!r)return;const s=t.sourceLayer;s&&("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(s))&&this.fire(new Oe(new Error(`Source layer "${s}" does not exist on source "${r.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,r)=>{const s=this.fragments[r];return s&&s.style&&(t.data=s.style.serialize()),t})}_serializeSources(){const t={};for(const r in this._sourceCaches){const s=this._sourceCaches[r].getSource();t[s.id]||(t[s.id]=s.serialize())}return t}_serializeLayers(t){const r=[];for(const s of t){const a=this._layers[s];a&&"custom"!==a.type&&r.push(a.serialize())}return r}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&("function"==typeof t.isLayerDraped?t.isLayerDraped(this.getLayerSourceCache(t)):hO.has(t.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const r=this.getOwnLayer(t);if(r)return r;this.fire(new Oe(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const r=this.getOwnSource(t);if(r)return r;this.fire(new Oe(new Error(`The source '${t}' does not exist in the map's style.`)))}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const r=this.calculateLightsBrightness();t.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r));const s=this._changes.isDirty();if(this._changes.isDirty()){const u=this._changes.getLayerUpdatesByScope();for(const c in u){const{updatedIds:p,removedIds:g}=u[c];(p||g)&&this._updateWorkerLayers(c,p,g)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}const a={};for(const u in this._mergedSourceCaches){const c=this._mergedSourceCaches[u];a[u]=c.used,c.used=!1}for(const u of this._mergedOrder){const c=this._mergedLayers[u];if(c.recalculate(t,this._availableImages),!c.isHidden(t.zoom)){const p=this.getLayerSourceCache(c);p&&(p.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let p=c.minzoom||0;p<(c.maxzoom||25.5);p++){const g=this.map.painter;if(g){const y=c.getProgramIds();if(!y)continue;for(const x of y){const E=c.getDefaultProgramParams(x,t.zoom);E&&(g.style=this,this.fog&&(g._fogVisible=!0,E.overrideFog=!0,g.getOrCreateProgram(x,E)),g._fogVisible=!1,E.overrideFog=!1,g.getOrCreateProgram(x,E),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(E.overrideRtt=!0,g.getOrCreateProgram(x,E)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const u in a){const c=this._mergedSourceCaches[u];a[u]!==c.used&&c.getSource().fire(new Se("data",{sourceDataType:"visibility",dataType:"source",sourceId:c.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),s&&this.fire(new Se("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const r in this._sourceCaches)this._sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,r,s){const a=this.getFragmentStyle(t);a&&this.dispatcher.broadcast("updateLayers",{layers:r?a._serializeLayers(r):[],scope:t,removedIds:s||[],options:a.options})}setState(t){if(this._checkLoaded(),mm(this,Ah(t)))return!1;(t=st(t)).layers=xx(t.layers);const r=function(a,u){if(!a)return[{command:Di.setStyle,args:[u]}];let c=[];try{if(!ht(a.version,u.version))return[{command:Di.setStyle,args:[u]}];ht(a.center,u.center)||c.push({command:Di.setCenter,args:[u.center]}),ht(a.zoom,u.zoom)||c.push({command:Di.setZoom,args:[u.zoom]}),ht(a.bearing,u.bearing)||c.push({command:Di.setBearing,args:[u.bearing]}),ht(a.pitch,u.pitch)||c.push({command:Di.setPitch,args:[u.pitch]}),ht(a.sprite,u.sprite)||c.push({command:Di.setSprite,args:[u.sprite]}),ht(a.glyphs,u.glyphs)||c.push({command:Di.setGlyphs,args:[u.glyphs]}),ht(a.imports,u.imports)||function(E=[],S=[],M){S=S||[];const D=(E=E||[]).map(Yy),P=S.map(Yy),O=E.reduce(Gg,{}),R=S.reduce(Gg,{}),B=D.slice();let j,V,U,G;for(j=0,V=0;j<D.length;j++)U=D[j],R.hasOwnProperty(U)?V++:(M.push({command:Di.removeImport,args:[U]}),B.splice(B.indexOf(U,V),1));for(j=0,V=0;j<P.length;j++)U=P[P.length-1-j],B[B.length-1-j]!==U&&(O.hasOwnProperty(U)?(M.push({command:Di.removeImport,args:[U]}),B.splice(B.lastIndexOf(U,B.length-V),1)):V++,G=B[B.length-j],M.push({command:Di.addImport,args:[R[U],G]}),B.splice(B.length-j,0,U));for(const Z of S){const Q=O[Z.id];if(!Q||ht(Q,Z))continue;ht(Q.config,Z.config)||M.push({command:Di.setImportConfig,args:[Z.id,Z.config]}),ht(Q.url,Z.url)||M.push({command:Di.setImportUrl,args:[Z.id,Z.url]});const et=Z.data;ht(Q&&Q.data,et)||M.push({command:Di.setImportData,args:[Z.id,et]})}}(a.imports,u.imports,c),ht(a.transition,u.transition)||c.push({command:Di.setTransition,args:[u.transition]}),ht(a.light,u.light)||c.push({command:Di.setLight,args:[u.light]}),ht(a.fog,u.fog)||c.push({command:Di.setFog,args:[u.fog]}),ht(a.projection,u.projection)||c.push({command:Di.setProjection,args:[u.projection]}),ht(a.lights,u.lights)||c.push({command:Di.setLights,args:[u.lights]}),ht(a.camera,u.camera)||c.push({command:Di.setCamera,args:[u.camera]});const p={},g=[];!function(E,S,M,D){let P;for(P in S=S||{},E=E||{})E.hasOwnProperty(P)&&(S.hasOwnProperty(P)||TC(P,M,D));for(P in S){if(!S.hasOwnProperty(P))continue;const O=S[P];E.hasOwnProperty(P)?ht(E[P],O)||("geojson"===E[P].type&&"geojson"===O.type&&O2(E,S,P)?M.push({command:Di.setGeoJSONSourceData,args:[P,O.data]}):DC(P,S,M,D)):bx(P,S,M)}}(a.sources,u.sources,g,p);const y=[];a.layers&&a.layers.forEach(E=>{E.source&&p[E.source]?c.push({command:Di.removeLayer,args:[E.id]}):y.push(E)});let x=a.terrain;x&&p[x.source]&&(c.push({command:Di.setTerrain,args:[void 0]}),x=void 0),c=c.concat(g),ht(x,u.terrain)||c.push({command:Di.setTerrain,args:[u.terrain]}),function(E,S,M){S=S||[];const D=(E=E||[]).map(Yy),P=S.map(Yy),O=E.reduce(Gg,{}),R=S.reduce(Gg,{}),B=D.slice(),j=Object.create(null);let V,U,G,Z,Q,et,it;for(V=0,U=0;V<D.length;V++)G=D[V],R.hasOwnProperty(G)?U++:(M.push({command:Di.removeLayer,args:[G]}),B.splice(B.indexOf(G,U),1));for(V=0,U=0;V<P.length;V++)G=P[P.length-1-V],B[B.length-1-V]!==G&&(O.hasOwnProperty(G)?(M.push({command:Di.removeLayer,args:[G]}),B.splice(B.lastIndexOf(G,B.length-U),1)):U++,et=B[B.length-V],M.push({command:Di.addLayer,args:[R[G],et]}),B.splice(B.length-V,0,G),j[G]=!0);for(V=0;V<P.length;V++)if(G=P[V],Z=O[G],Q=R[G],!j[G]&&!ht(Z,Q))if(ht(Z.source,Q.source)&&ht(Z["source-layer"],Q["source-layer"])&&ht(Z.type,Q.type)){for(it in sm(Z.layout,Q.layout,M,G,null,Di.setLayoutProperty),sm(Z.paint,Q.paint,M,G,null,Di.setPaintProperty),ht(Z.slot,Q.slot)||M.push({command:Di.setSlot,args:[G,Q.slot]}),ht(Z.filter,Q.filter)||M.push({command:Di.setFilter,args:[G,Q.filter]}),ht(Z.minzoom,Q.minzoom)&&ht(Z.maxzoom,Q.maxzoom)||M.push({command:Di.setLayerZoomRange,args:[G,Q.minzoom,Q.maxzoom]}),Z)Z.hasOwnProperty(it)&&"layout"!==it&&"paint"!==it&&"filter"!==it&&"metadata"!==it&&"minzoom"!==it&&"maxzoom"!==it&&"slot"!==it&&(0===it.indexOf("paint.")?sm(Z[it],Q[it],M,G,it.slice(6),Di.setPaintProperty):ht(Z[it],Q[it])||M.push({command:Di.setLayerProperty,args:[G,it,Q[it]]}));for(it in Q)Q.hasOwnProperty(it)&&!Z.hasOwnProperty(it)&&"layout"!==it&&"paint"!==it&&"filter"!==it&&"metadata"!==it&&"minzoom"!==it&&"maxzoom"!==it&&"slot"!==it&&(0===it.indexOf("paint.")?sm(Z[it],Q[it],M,G,it.slice(6),Di.setPaintProperty):ht(Z[it],Q[it])||M.push({command:Di.setLayerProperty,args:[G,it,Q[it]]}))}else M.push({command:Di.removeLayer,args:[G]}),et=B[B.lastIndexOf(G)+1],M.push({command:Di.addLayer,args:[Q,et]})}(y,u.layers,c)}catch(p){console.warn("Unable to compute style diff:",p),c=[{command:Di.setStyle,args:[u]}]}return c}(this.serialize(),t).filter(a=>!(a.command in SA));if(0===r.length)return!1;const s=r.filter(a=>!(a.command in gm));if(s.length>0)throw new Error(`Unimplemented: ${s.map(a=>a.command).join(", ")}.`);return r.forEach(a=>{this[a.command].apply(this,a.args)}),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,r){return this.getImage(t)?this.fire(new Oe(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,r),this._afterImageUpdated(t),this)}updateImage(t,r){this.imageManager.updateImage(t,this.scope,r)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new Oe(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new Se("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,r,s={}){return this._checkLoaded(),this._validate(nw,`models.${t}`,r,null,s)||(this.modelManager.addModel(t,r,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new Oe(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,r,s={}){if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error(`There is already a source with ID "${t}".`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(cu,`sources.${t}`,r,null,s))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const a=vx(t,r,this.dispatcher,this);a.scope=this.scope,a.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(a.id),source:a.serialize(),sourceId:a.id}));const u=c=>{const p=(c?"symbol:":"other:")+a.id,g=ul(p,this.scope),y=this._sourceCaches[p]=new Fc(g,a,c);(c?this._symbolSourceCaches:this._otherSourceCaches)[a.id]=y,y.onAdd(this.map)};u(!1),"vector"!==r.type&&"geojson"!==r.type||u(!0),a.onAdd&&a.onAdd(this.map),s.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const r=this.getOwnSource(t);if(!r)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===t)return this.fire(new Oe(new Error(`Source "${t}" cannot be removed while layer "${a}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new Oe(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const s=this.getOwnSourceCaches(t);for(const a of s){const u=Lm(a.id);delete this._sourceCaches[u],this._changes.discardSourceCacheUpdate(a.id),a.fire(new Se("data",{sourceDataType:"metadata",dataType:"source",sourceId:a.getSource().id})),a.setEventedParent(null),a.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,r){this._checkLoaded(),this.getOwnSource(t).setData(r),this._changes.setDirty()}getOwnSource(t){const r=this.getOwnSourceCache(t);return r&&r.getSource()}getOwnSources(){const t=[];for(const r in this._otherSourceCaches){const s=this.getOwnSourceCache(r);s&&t.push(s.getSource())}return t}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const r=this._getTransitionParameters();for(const a of t){if(this._validate(ew,"lights",a))return;switch(a.type){case"ambient":if(this.ambientLight){const u=this.ambientLight;u.set(a),u.updateTransitions(r)}else this.ambientLight=new rx(a,oO,this.scope,this.options);break;case"directional":if(this.directionalLight){const u=this.directionalLight;u.set(a),u.updateTransitions(r)}else this.directionalLight=new rx(a,Bs,this.scope,this.options)}}const s=new ss(this.z||0,r);this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,r=this.ambientLight;if(!t||!r)return;const s=E=>.2126*(E[0]<=.03928?E[0]/12.92:Math.pow((E[0]+.055)/1.055,2.4))+.7152*(E[1]<=.03928?E[1]/12.92:Math.pow((E[1]+.055)/1.055,2.4))+.0722*(E[2]<=.03928?E[2]/12.92:Math.pow((E[2]+.055)/1.055,2.4)),a=t.properties.get("color").toArray01(),u=t.properties.get("intensity"),c=t.properties.get("direction"),p=1-gn(c.x,c.y,c.z)[2]/90,g=s(a)*u*p,y=r.properties.get("color").toArray01(),x=r.properties.get("intensity");return(g+s(y)*x)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(H0(t)){const r=function(u){const c=u.indexOf("\x1f");return c>=0?u.slice(c+1):""}(t),s=this.fragments.find(({id:u})=>u===r);if(!s)throw new Error(`Style import not found: ${t}`);const a=Lm(t);return s.style.getFragmentStyle(a)}{const r=this.fragments.find(({id:s})=>s===t);if(!r)throw new Error(`Style import not found: ${t}`);return r.style}}getConfigProperty(t,r){const s=this.getFragmentStyle(t);if(!s)return null;const a=s.options.get(r),u=a?a.value||a.default:null;return u?u.serialize():null}setConfigProperty(t,r,s){const a=Mh(s);if("success"!==a.result)return void mm(this,a.value);const u=a.value.expression,c=this.getFragmentStyle(t);if(!c)return;const p=c.options.get(r);p&&(c.options.set(r,{...p,value:u}),c.updateConfigDependencies())}setConfig(t,r){if(this._config=t,t||r)if(r){this.options.clear();for(const s in r){let a,u;const c=Mh(r[s].default);if("success"===c.result&&(a=c.value.expression),t&&void 0!==t[s]){const S=Mh(t[s]);"success"===S.result&&(u=S.value.expression)}const{minValue:p,maxValue:g,stepValue:y,type:x,values:E}=r[s];a?this.options.set(s,{default:a,value:u,minValue:p,maxValue:g,stepValue:y,type:x,values:E}):this.fire(new Oe(new Error(`No schema defined for config option "${s}".`)))}}else this.fire(new Oe(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const t of this._configDependentLayers){const r=this.getLayer(t);r&&(r.possiblyEvaluateVisibility(),this._updateLayer(r))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(t,r,s={}){this._checkLoaded();const a=t.id;if(this._layers[a])return void this.fire(new Oe(new Error(`Layer with id "${a}" already exists on this map`)));let u;if("custom"===t.type){if(mm(this,function(x){const E=[],S=x.id;return void 0===S&&E.push({message:`layers.${S}: missing required property "id"`}),void 0===x.render&&E.push({message:`layers.${S}: missing required method "render"`}),x.renderingMode&&"2d"!==x.renderingMode&&"3d"!==x.renderingMode&&E.push({message:`layers.${S}: property "renderingMode" must be either "2d" or "3d"`}),E}(t)))return;u=qy(t,this.options)}else{if("object"==typeof t.source&&(this.addSource(a,t.source),t=pe(t=st(t),{source:a})),this._validate(cT,`layers.${a}`,t,{arrayIndex:-1},s))return;u=qy(t,this.options),this._validateLayer(u),u.setEventedParent(this,{layer:{id:a}}),this._serializedLayers[u.id]=u.serialize()}u.isConfigDependent&&this._configDependentLayers.add(u.fqid),u.setScope(this.scope);let c=this._order.length;if(r){const x=this._order.indexOf(r);if(-1===x)return void this.fire(new Oe(new Error(`Layer with id "${r}" does not exist on this map.`)));u.slot===this._layers[r].slot?c=x:Gt(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(c,0,a),this._layerOrderChanged=!0,this._layers[a]=u;const p=this.getOwnLayerSourceCache(u),g=!!this.directionalLight&&this.directionalLight.shadowsEnabled();p&&u.canCastShadows()&&g&&(p.castsShadows=!0);const y=this._changes.getRemovedLayer(u);if(y&&u.source&&p&&"custom"!==u.type){this._changes.discardLayerRemoval(u);const x=ul(u.source,u.scope);y.type!==u.type?this._changes.updateSourceCache(x,"clear"):(this._changes.updateSourceCache(x,"reload"),p.pause())}this._updateLayer(u),u.onAdd&&u.onAdd(this.map),u.scope=this.scope,this.mergeLayers()}moveLayer(t,r){this._checkLoaded();const s=this._checkLayer(t);if(!s||t===r)return;const a=this._order.indexOf(t);this._order.splice(a,1);let u=this._order.length;if(r){const c=this._order.indexOf(r);if(-1===c)return void this.fire(new Oe(new Error(`Layer with id "${r}" does not exist on this map.`)));s.slot===this._layers[r].slot?u=c:Gt(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(u,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const r=this._checkLayer(t);if(!r)return;r.setEventedParent(null);const s=this._order.indexOf(t);this._order.splice(s,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(r.fqid),this._changes.removeLayer(r);const a=this.getOwnLayerSourceCache(r);if(a&&a.castsShadows){let u=!1;for(const c in this._layers)if(this._layers[c].source===r.source&&this._layers[c].canCastShadows()){u=!0;break}a.castsShadows=u}r.onRemove&&r.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const r in this._layers)if(this._layers[r].type===t)return!0;return!1}setLayerZoomRange(t,r,s){this._checkLoaded();const a=this._checkLayer(t);a&&(a.minzoom===r&&a.maxzoom===s||(null!=r&&(a.minzoom=r),null!=s&&(a.maxzoom=s),this._updateLayer(a)))}setSlot(t,r){this._checkLoaded();const s=this._checkLayer(t);s&&s.slot!==r&&(s.slot=r,this._updateLayer(s))}setFilter(t,r,s={}){this._checkLoaded();const a=this._checkLayer(t);if(a&&!ht(a.filter,r))return null==r?(a.filter=void 0,void this._updateLayer(a)):void(this._validate(U0,`layers.${a.id}.filter`,r,{layerType:a.type},s)||(a.filter=st(r),this._updateLayer(a)))}getFilter(t){const r=this._checkLayer(t);if(r)return st(r.filter)}setLayoutProperty(t,r,s,a={}){this._checkLoaded();const u=this._checkLayer(t);u&&(ht(u.getLayoutProperty(r),s)||(u.setLayoutProperty(r,s,a),u.isConfigDependent&&this._configDependentLayers.add(u.fqid),this._updateLayer(u)))}getLayoutProperty(t,r){const s=this._checkLayer(t);if(s)return s.getLayoutProperty(r)}setPaintProperty(t,r,s,a={}){this._checkLoaded();const u=this._checkLayer(t);if(!u||ht(u.getPaintProperty(r),s))return;const c=u.setPaintProperty(r,s,a);u.isConfigDependent&&this._configDependentLayers.add(u.fqid),c&&this._updateLayer(u),this._changes.updatePaintProperties(u)}getPaintProperty(t,r){const s=this._checkLayer(t);if(s)return s.getPaintProperty(r)}setFeatureState(t,r){this._checkLoaded();const s=t.source,a=t.sourceLayer,u=this._checkSource(s);if(!u)return;const c=u.type;if("geojson"===c&&a)return void this.fire(new Oe(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===c&&!a)return void this.fire(new Oe(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new Oe(new Error("The feature id parameter must be provided.")));const p=this.getOwnSourceCaches(s);for(const g of p)g.setFeatureState(a,t.id,r)}removeFeatureState(t,r){this._checkLoaded();const s=t.source,a=this._checkSource(s);if(!a)return;const u=a.type,c="vector"===u?t.sourceLayer:void 0;if("vector"===u&&!c)return void this.fire(new Oe(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new Oe(new Error("A feature id is required to remove its specific state property.")));const p=this.getOwnSourceCaches(s);for(const g of p)g.removeFeatureState(c,t.id,r)}getFeatureState(t){this._checkLoaded();const r=t.source,s=t.sourceLayer,a=this._checkSource(r);if(a){if("vector"!==a.type||s)return void 0===t.id&&this.fire(new Oe(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(s,t.id);this.fire(new Oe(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=pe({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return pe({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),r=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return Te({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},s=>void 0!==s)}_updateLayer(t){this._changes.updateLayer(t);const r=this.getLayerSourceCache(t),s=ul(t.source,t.scope),a=this._changes.getUpdatedSourceCaches();t.source&&!a[s]&&r&&"raster"!==r.getSource().type&&(this._changes.updateSourceCache(s,"reload"),r.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const r=p=>"fill-extrusion"===this._mergedLayers[p].type,s=this.order,a={},u=[];for(let p=s.length-1;p>=0;p--){const g=s[p];if(r(g)){a[g]=p;for(const y of t){const x=y[g];if(x)for(const E of x)u.push(E)}}}u.sort((p,g)=>g.intersectionZ-p.intersectionZ);const c=[];for(let p=s.length-1;p>=0;p--){const g=s[p];if(r(g))for(let y=u.length-1;y>=0;y--){const x=u[y].feature;if(a[x.layer.id]<p)break;c.push(x),u.pop()}else for(const y of t){const x=y[g];if(x)for(const E of x)c.push(E.feature)}}return c}queryRenderedFeatures(t,r,s){r&&r.filter&&this._validate(U0,"queryRenderedFeatures.filter",r.filter,null,r),r.scope=this.scope,r.availableImages=this._availableImages,r.serializedLayers=this._serializedLayers;const a={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new Oe(new Error("parameters.layers must be an Array."))),[];for(const y of r.layers){const x=this._mergedLayers[y];if(!x)return this.fire(new Oe(new Error(`The layer '${y}' does not exist in the map's style and cannot be queried for features.`))),[];a[x.source]=!0}}const u=[],c=r.serializedLayers||{},p=r&&r.layers?r.layers.some(y=>{const x=this.getLayer(y);return x&&x.is3D()}):this.has3DLayers(),g=ix.createFromScreenPoints(t,s);for(const y in this._mergedSourceCaches){const x=this._mergedSourceCaches[y].getSource();if(!x||x.scope!==r.scope)continue;const E=this._mergedSourceCaches[y].getSource().id;r.layers&&!a[E]||u.push(A2(this._mergedSourceCaches[y],this._mergedLayers,c,g,r,s,p,!!this.map._showQueryGeometry))}return this.placement&&u.push(function(y,x,E,S,M,D,P){const O={},R=D.queryRenderedSymbols(S),B=[];for(const j of Object.keys(R).map(Number))B.push(P[j]);B.sort(MC);for(const j of B){const V=j.featureIndex.lookupSymbolFeatures(R[j.bucketInstanceId],x,j.bucketIndex,j.sourceLayerIndex,M.filter,M.layers,M.availableImages,y);for(const U in V){const G=O[U]=O[U]||[],Z=V[U];Z.sort((Q,et)=>{const it=j.featureSortOrder;if(it){const yt=it.indexOf(Q.featureIndex);return it.indexOf(et.featureIndex)-yt}return et.featureIndex-Q.featureIndex});for(const Q of Z)G.push(Q)}}for(const j in O)O[j].forEach(V=>{const U=V.feature,G=E(y[j]);if(!G)return;const Z=G.getFeatureState(U.layer["source-layer"],U.id);U.source=U.layer.source,U.layer["source-layer"]&&(U.sourceLayer=U.layer["source-layer"]),U.state=Z});return O}(this._mergedLayers,c,this.getLayerSourceCache.bind(this),g.screenGeometry,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(u)}querySourceFeatures(t,r){r&&r.filter&&this._validate(U0,"querySourceFeatures.filter",r.filter,null,r);const s=this.getOwnSourceCaches(t);let a=[];for(const u of s)a=a.concat(SC(u,r));return a}addSourceType(t,r,s){return Uc.getSourceType(t)?s(new Error(`A source type called "${t}" already exists.`)):(Uc.setSourceType(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},s):s(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,r,s={}){this._checkLoaded();const a=this.light.getLight();let u=!1;for(const p in t)if(!ht(t[p],a[p])){u=!0;break}if(!u)return;const c=this._getTransitionParameters();this.light.setLight(t,r,s),this.light.updateTransitions(c)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,r=1){if(this._checkLoaded(),!t)return delete this.terrain,null===t?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let s=t;const a=null==t.source;if(1===r){if("object"==typeof s.source){const p="terrain-dem-src";this.addSource(p,s.source),s=st(s),s=pe(s,{source:p})}const u=pe({},s),c={};if(this.terrain&&a){u.source=this.terrain.get().source;const p=this.terrain?this.getFragmentStyle(this.terrain.scope):null;p&&(c.style=p.serialize())}if(this._validate(np,"terrain",u,c))return}if(!this.terrain||this.terrain.scope!==this.scope&&!a||this.terrain&&r!==this.terrain.drapeRenderMode){if(!s)return;this._createTerrain(s,r),this.fire(new Se("data",{dataType:"style"}))}else{const u=this.terrain,c=u.get();for(const p of Object.keys(It.terrain))!s.hasOwnProperty(p)&&It.terrain[p].default&&(s[p]=It.terrain[p].default);for(const p in t)if(!ht(t[p],c[p])){u.set(t,this.options),this.stylesheet.terrain=t;const g=this._getTransitionParameters({duration:0});u.updateTransitions(g),this.fire(new Se("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const r=this.fog=new em(t,this.map.transform);this.stylesheet.fog=r.get();const s=this._getTransitionParameters({duration:0});r.updateTransitions(s)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog;if(!ht(r.get(),t)){r.set(t),this.stylesheet.fog=r.get();const s=this._getTransitionParameters({duration:0});r.updateTransitions(s)}}else this._createFog(t);this._markersNeedUpdate=!0}_getTransitionParameters(t){return{now:or.now(),transition:pe(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],r=[];for(const s in this._mergedLayers)this.isLayerDraped(this._mergedLayers[s])?t.push(s):r.push(s);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...r)}_createTerrain(t,r){const s=this.terrain=new _C(t,r,this.scope,this.options);1===r&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const a=this._getTransitionParameters({duration:0});s.updateTransitions(a)}_force3DLayerUpdate(){for(const t in this._layers){const r=this._layers[t];"fill-extrusion"===r.type&&this._updateLayer(r)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const r=this._layers[t];"symbol"===r.type&&this._updateLayer(r)}}_validate(t,r,s,a,u={}){if(u&&!1===u.validate)return!1;const c=pe({},this.serialize());return mm(this,t.call(Ah,pe({key:r,style:c,value:s,styleSpec:It},a)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),aw.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const r=this.getSourceCaches(t);for(const s of r)s.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const r=this.getSourceCaches(t);for(const s of r)s.resume(),s.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}updateSources(t){let r;this.directionalLight&&(r=l0(this.directionalLight));for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].update(t,void 0,void 0,r)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const r=this._sourceCaches[t];r.resume(),r.reload()}}_updatePlacement(t,r,s,a,u=!1){let c=!1,p=!1;const g={},y={};for(const x of this._mergedOrder){const E=this._mergedLayers[x];if("symbol"!==E.type)continue;const S=ul(E.source,E.scope);let M=g[S];if(!M){const P=this.getLayerSourceCache(E);if(!P)continue;const O=P.getRenderableIds(!0).map(R=>P.getTileByID(R));y[S]=O.slice(),M=g[S]=O.sort((R,B)=>B.tileID.overscaledZ-R.tileID.overscaledZ||(R.tileID.isLessThan(B.tileID)?-1:1))}const D=this.crossTileSymbolIndex.addLayer(E,M,t.center.lng,t.projection);c=c||D}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),u=u||this._layerOrderChanged||0===s,this._layerOrderChanged&&this.fire(new Se("neworder")),(u||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(or.now(),t.zoom))&&(this.pauseablePlacement=new Ix(t,this._mergedOrder,u,r,s,a,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,g,y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(or.now()),p=!0),c&&this.pauseablePlacement.placement.setStale()),p||c)for(const x of this._mergedOrder){const E=this._mergedLayers[x];"symbol"===E.type&&this.placement.updateLayerOpacities(E,g[ul(E.source,E.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(or.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t){this._checkLoaded();const r=this.stylesheet.imports=this.stylesheet.imports||[];return-1!==r.findIndex(({id:a})=>a===t.id)?this.fire(new Oe(new Error(`Import with id '${t.id}' already exists in the map's style.`))):(r.push(t),this._loadImports([t],!0),this)}setImportUrl(t,r){this._checkLoaded();const s=this.stylesheet.imports||[],a=this.getImportIndex(t);if(-1===a)return this;s[a].url=r;const u=this.fragments[a];return u.style=this._createFragmentStyle(s[a]),u.style.on("style.import.load",()=>this.mergeAll()),u.style.loadURL(r),this}setImportData(t,r){this._checkLoaded();const s=this.getImportIndex(t),a=this.stylesheet.imports||[];return-1===s?this:r?(this.fragments[s].style.setState(r),this._reloadImports(),this):(delete a[s].data,this.setImportUrl(t,a[s].url))}setImportConfig(t,r){this._checkLoaded();const s=this.getImportIndex(t),a=this.stylesheet.imports||[];if(-1===s)return this;r?a[s].config=r:delete a[s].config;const u=this.fragments[s],c=u.style.stylesheet&&u.style.stylesheet.schema;return u.config=r,u.style.setConfig(r,c),u.style.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const r=this.stylesheet.imports||[],s=this.getImportIndex(t);return-1===s||(r.splice(s,1),this.fragments[s].style._remove(),this.fragments.splice(s,1),this._reloadImports()),this}getImportIndex(t){const r=(this.stylesheet.imports||[]).findIndex(s=>s.id===t);return-1===r&&this.fire(new Oe(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),r}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const r in this._mergedOtherSourceCaches){const s=this._mergedOtherSourceCaches[r];s&&t.push(s.getSource())}return t}getSource(t,r){const s=this.getSourceCache(t,r);return s&&s.getSource()}getLayerSource(t){const r=this.getLayerSourceCache(t);return r&&r.getSource()}getSourceCache(t,r){const s=ul(t,r);return this._mergedOtherSourceCaches[s]}getLayerSourceCache(t){const r=ul(t.source,t.scope);return"symbol"===t.type?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(t){const r=[];return this._mergedOtherSourceCaches[t]&&r.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&r.push(this._mergedSymbolSourceCaches[t]),r}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const r in t){const s=t[r];"reload"===s?this.reloadSource(r):"clear"===s&&this.clearSource(r)}}updateLayers(t){const r=this._changes.getUpdatedPaintProperties();for(const s of r){const a=this.getLayer(s);a&&a.updateTransitions(t)}}getImages(t,r,s){this.imageManager.getImages(r.icons,r.scope,s),this._updateTilesForChangedImages();const a=u=>{u&&u.setDependencies(r.tileID.key,r.type,r.icons)};a(this._otherSourceCaches[r.source]),a(this._symbolSourceCaches[r.source])}getGlyphs(t,r,s){this.glyphManager.getGlyphs(r.stacks,r.scope,s)}getResource(t,r,s){return ve(r,s)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const r=[];return this._otherSourceCaches[t]&&r.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&r.push(this._symbolSourceCaches[t]),r}_isSourceCacheLoaded(t){const r=this.getOwnSourceCaches(t);return 0===r.length?(this.fire(new Oe(new Error(`There is no source with ID '${t}'`))),!1):r.every(s=>s.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function MA(e,t){let r=!1,s=null;const a=()=>{s=null,r&&(e(),s=setTimeout(a,t),r=!1)};return()=>(r=!0,s||a(),s)}Uc.getSourceType=function(e){return yx[e]},Uc.setSourceType=function(e,t){yx[e]=t},Uc.registerForPluginStateChange=function(e){return e({pluginStatus:fa,pluginURL:Jc}),aw.on("pluginStateChange",e),e};class TA{constructor(t){this._hashName=t&&encodeURIComponent(t),hn(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=MA(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,rt.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),rt.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const r=IS(t);if(this._hashName){const s=this._hashName;let a=!1;const u=rt.location.hash.slice(1).split("&").map(c=>{const p=c.split("=")[0];return p===s?(a=!0,`${p}=${r}`):c}).filter(c=>c);return a||u.push(`${s}=${r}`),`#${u.join("&")}`}return`#${r}`}_getCurrentHash(){const t=rt.location.hash.replace("#","");if(this._hashName){let r;return t.split("&").map(s=>s.split("=")).forEach(s=>{s[0]===this._hashName&&(r=s)}),(r&&r[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const r=this._getCurrentHash();if(r.length>=3&&!r.some(s=>isNaN(s))){const s=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(r[3]||0):t.getBearing();return t.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:s,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=rt.location.href.replace(/(#.+)?$/,this.getHashString());rt.history.replaceState(rt.history.state,null,t)}}function IS(e,t){const r=e.getCenter(),s=Math.round(100*e.getZoom())/100,a=Math.ceil((s*Math.LN2+Math.log(512/360/.5))/Math.LN10),u=Math.pow(10,a),c=Math.round(r.lng*u)/u,p=Math.round(r.lat*u)/u,g=e.getBearing(),y=e.getPitch();let x=t?`/${c}/${p}/${s}`:`${s}/${p}/${c}`;return(g||y)&&(x+="/"+Math.round(10*g)/10),y&&(x+=`/${Math.round(y)}`),x}const c0={linearity:.3,easing:de(0,0,.3,1)},CS=pe({deceleration:2500,maxSpeed:1400},c0),SS=pe({deceleration:20,maxSpeed:1400},c0),DA=pe({deceleration:1e3,maxSpeed:360},c0),MS=pe({deceleration:1e3,maxSpeed:90},c0);class TS{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:or.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=or.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const r={zoom:0,bearing:0,pitch:0,pan:new H(0,0),pinchAround:void 0,around:void 0};for(const{settings:u}of this._inertiaBuffer)r.zoom+=u.zoomDelta||0,r.bearing+=u.bearingDelta||0,r.pitch+=u.pitchDelta||0,u.panDelta&&r.pan._add(u.panDelta),u.around&&(r.around=u.around),u.pinchAround&&(r.pinchAround=u.pinchAround);const s=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,a={};if(r.pan.mag()){const u=f0(r.pan.mag(),s,pe({},CS,t||{}));a.offset=r.pan.mult(u.amount/r.pan.mag()),a.center=this._map.transform.center,h0(a,u)}if(r.zoom){const u=f0(r.zoom,s,SS);a.zoom=this._map.transform.zoom+u.amount,h0(a,u)}if(r.bearing){const u=f0(r.bearing,s,DA);a.bearing=this._map.transform.bearing+At(u.amount,-179,179),h0(a,u)}if(r.pitch){const u=f0(r.pitch,s,MS);a.pitch=this._map.transform.pitch+u.amount,h0(a,u)}if(a.zoom||a.bearing){const u=void 0===r.pinchAround?r.around:r.pinchAround;a.around=u?this._map.unproject(u):this._map.getCenter()}return this.clear(),a.noMoveStart=!0,a}}function h0(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function f0(e,t,r){const{maxSpeed:s,linearity:a,deceleration:u}=r,c=At(e*a/(t/1e3),-s,s),p=Math.abs(c)/(u*a);return{easing:r.easing,duration:1e3*p,amount:c*(p/2)}}class xu extends Se{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,s,a={}){const u=qe(r.getCanvasContainer(),s);super(t,pe({point:u,lngLat:r.unproject(u),originalEvent:s},a)),this._defaultPrevented=!1,this.target=r}}class d0 extends Se{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,s){const a="touchend"===t?s.changedTouches:s.touches,u=_n(r.getCanvasContainer(),a),c=u.map(g=>r.unproject(g)),p=u.reduce((g,y,x,E)=>g.add(y.div(E.length)),new H(0,0));super(t,{points:u,point:p,lngLats:c,lngLat:r.unproject(p),originalEvent:s}),this._defaultPrevented=!1}}class DS extends Se{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,s){super(t,{originalEvent:s}),this._defaultPrevented=!1}}class AS{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new DS(t.type,this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new xu(t.type,this._map,t))}mouseup(t){this._map.fire(new xu(t.type,this._map,t))}preclick(t){const r=pe({},t);r.type="preclick",this._map.fire(new xu(r.type,this._map,r))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||(this.preclick(t),this._map.fire(new xu(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new xu(t.type,this._map,t))}mouseover(t){this._map.fire(new xu(t.type,this._map,t))}mouseout(t){this._map.fire(new xu(t.type,this._map,t))}touchstart(t){return this._firePreventable(new d0(t.type,this._map,t))}touchmove(t){this._map.fire(new d0(t.type,this._map,t))}touchend(t){this._map.fire(new d0(t.type,this._map,t))}touchcancel(t){this._map.fire(new d0(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class PS{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new xu(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xu("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new xu(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class LS{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&0===t.button&&(qt(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const s=r,a=this._startPos,u=this._lastPos;if(!a||!u||u.equals(s)||!this._box&&s.dist(a)<this._clickTolerance)return;this._lastPos=s,this._box||(this._box=Hn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const c=Math.min(a.x,s.x),p=Math.max(a.x,s.x),g=Math.min(a.y,s.y),y=Math.max(a.y,s.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${c}px,${g}px)`,this._box.style.width=p-c+"px",this._box.style.height=y-g+"px")})}mouseupWindow(t,r){if(!this._active)return;const s=this._startPos,a=r;if(s&&0===t.button){if(this.reset(),jt(),s.x!==a.x||s.y!==a.y)return this._map.fire(new Se("boxzoomend",{originalEvent:t})),{cameraAnimation:u=>u.fitScreenCoordinates(s,a,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),he(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new Se(t,{originalEvent:r}))}}function eb(e,t){const r={};for(let s=0;s<e.length;s++)r[e[s].identifier]=t[s];return r}class AA{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,r,s){(this.centroid||s.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),s.length===this.numTouches&&(this.centroid=function(a){const u=new H(0,0);for(const c of a)u._add(c);return u.div(a.length)}(r),this.touches=eb(s,r)))}touchmove(t,r,s){if(this.aborted||!this.centroid)return;const a=eb(s,r);for(const u in this.touches){const c=a[u];(!c||c.dist(this.touches[u])>30)&&(this.aborted=!0)}}touchend(t,r,s){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===s.length){const a=!this.aborted&&this.centroid;if(this.reset(),a)return a}}}class OS{constructor(t){this.singleTap=new AA(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,r,s){this.singleTap.touchstart(t,r,s)}touchmove(t,r,s){this.singleTap.touchmove(t,r,s)}touchend(t,r,s){const a=this.singleTap.touchend(t,r,s);if(a){const u=t.timeStamp-this.lastTime<500,c=!this.lastTap||this.lastTap.dist(a)<30;if(u&&c||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=a,this.count===this.numTaps)return this.reset(),a}}}class RS{constructor(){this._zoomIn=new OS({numTouches:1,numTaps:2}),this._zoomOut=new OS({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,s){this._zoomIn.touchstart(t,r,s),this._zoomOut.touchstart(t,r,s)}touchmove(t,r,s){this._zoomIn.touchmove(t,r,s),this._zoomOut.touchmove(t,r,s)}touchend(t,r,s){const a=this._zoomIn.touchend(t,r,s),u=this._zoomOut.touchend(t,r,s);return a?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:c=>c.easeTo({duration:300,zoom:c.getZoom()+1,around:c.unproject(a)},{originalEvent:t})}):u?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:c=>c.easeTo({duration:300,zoom:c.getZoom()-1,around:c.unproject(u)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const fO={0:1,2:2};class NS{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,r){return!1}_move(t,r){return{}}mousedown(t,r){if(this._lastPoint)return;const s=Dn(t);this._correctButton(t,s)&&(this._lastPoint=r,this._eventButton=s)}mousemoveWindow(t,r){const s=this._lastPoint;if(s)if(t.preventDefault(),null!=this._eventButton&&function(a,u){const c=fO[u];return void 0===a.buttons||(a.buttons&c)!==c}(t,this._eventButton))this.reset();else if(this._moved||!(r.dist(s)<this._clickTolerance))return this._moved=!0,this._lastPoint=r,this._move(s,r)}mouseupWindow(t){this._lastPoint&&Dn(t)===this._eventButton&&(this._moved&&jt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dO extends NS{mousedown(t,r){super.mousedown(t,r),this._lastPoint&&(this._active=!0)}_correctButton(t,r){return 0===r&&!t.ctrlKey}_move(t,r){return{around:r,panDelta:r.sub(t)}}}class PA extends NS{_correctButton(t,r){return 0===r&&t.ctrlKey||2===r}_move(t,r){const s=.8*(r.x-t.x);if(s)return this._active=!0,{bearingDelta:s}}contextmenu(t){t.preventDefault()}}class LA extends NS{_correctButton(t,r){return 0===r&&t.ctrlKey||2===r}_move(t,r){const s=-.5*(r.y-t.y);if(s)return this._active=!0,{pitchDelta:s}}contextmenu(t){t.preventDefault()}}class pO{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),hn(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new H(0,0)}touchstart(t,r,s){return this._calculateTransform(t,r,s)}touchmove(t,r,s){if(this._active&&!(s.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===s.length&&!Sn())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,r,s)}}touchend(t,r,s){this._calculateTransform(t,r,s),this._active&&s.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,s){s.length>0&&(this._active=!0);const a=eb(s,r),u=new H(0,0),c=new H(0,0);let p=0;for(const y in a){const x=a[y],E=this._touches[y];E&&(u._add(x),c._add(x.sub(E)),p++,a[y]=x)}if(this._touches=a,p<this._minTouches||!c.mag())return;const g=c.div(p);return this._sum._add(g),this._sum.mag()<this._clickTolerance?void 0:{around:u.div(p),panDelta:g}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Hn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class FS{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,r,s){return{}}touchstart(t,r,s){this._firstTwoTouches||s.length<2||(this._firstTwoTouches=[s[0].identifier,s[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,s){const a=this._firstTwoTouches;if(!a)return;t.preventDefault();const[u,c]=a,p=nb(s,r,u),g=nb(s,r,c);if(!p||!g)return;const y=this._aroundCenter?null:p.add(g).div(2);return this._move([p,g],y,t)}touchend(t,r,s){if(!this._firstTwoTouches)return;const[a,u]=this._firstTwoTouches,c=nb(s,r,a),p=nb(s,r,u);c&&p||(this._active&&jt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function nb(e,t,r){for(let s=0;s<e.length;s++)if(e[s].identifier===r)return t[s]}function OA(e,t){return Math.log(e/t)/Math.LN2}class RA extends FS{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const s=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(OA(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:OA(this._distance,s),pinchAround:r}}}function p0(e,t){return 180*e.angleWith(t)/Math.PI}class NA extends FS{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const s=this._vector;if(this._vector=t[0].sub(t[1]),s&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:p0(this._vector,s),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,s=this._startVector;if(!s)return!1;const a=p0(t,s);return Math.abs(a)<r}}function rb(e){return Math.abs(e.y)>Math.abs(e.x)}class Yh extends FS{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,rb(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,s){const a=this._lastPoints;if(!a)return;const u=t[0].sub(a[0]),c=t[1].sub(a[1]);return this._map._cooperativeGestures&&!Sn()&&s.touches.length<3||(this._valid=this.gestureBeginsVertically(u,c,s.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(u.y+c.y)/2*-.5})}gestureBeginsVertically(t,r,s){if(void 0!==this._valid)return this._valid;const a=t.mag()>=2,u=r.mag()>=2;if(!a&&!u)return;if(!a||!u)return null==this._firstMove&&(this._firstMove=s),s-this._firstMove<100&&void 0;const c=t.y>0==r.y>0;return rb(t)&&rb(r)&&c}}const FA={panStep:100,bearingStep:15,pitchStep:10};class mO{constructor(){const t=FA;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,s=0,a=0,u=0,c=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?s=-1:(t.preventDefault(),u=-1);break;case 39:t.shiftKey?s=1:(t.preventDefault(),u=1);break;case 38:t.shiftKey?a=1:(t.preventDefault(),c=-1);break;case 40:t.shiftKey?a=-1:(t.preventDefault(),c=1);break;default:return}return this._rotationDisabled&&(s=0,a=0),{cameraAnimation:p=>{const g=p.getZoom();p.easeTo({duration:300,easeId:"keyboardHandler",easing:gO,zoom:r?Math.round(g)+r*(t.shiftKey?2:1):g,bearing:p.getBearing()+s*this._bearingStep,pitch:p.getPitch()+a*this._pitchStep,offset:[-u*this._panStep,-c*this._panStep],center:p.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function gO(e){return e*(2-e)}const kS=4.000244140625;class kA{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,hn(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||Sn()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=t.deltaMode===rt.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const s=or.now(),a=s-(this._lastWheelEventTime||0);this._lastWheelEventTime=s,0!==r&&r%kS==0?this._type="wheel":0!==r&&Math.abs(r)<4?this._type="trackpad":a>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(a*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=qe(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:r,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const r=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const y="wheel"===this._type&&Math.abs(this._delta)>kS?this._wheelZoomRate:this._defaultZoomRate;let x=2/(1+Math.exp(-Math.abs(this._delta*y)));this._delta<0&&0!==x&&(x=1/x);const E=r(),S=Math.pow(2,E),M="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):S;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(M*x))),"wheel"===this._type&&(this._startZoom=E,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const s="number"==typeof this._targetZoom?this._targetZoom:r(),a=this._startZoom,u=this._easing;let c,p=!1;if("wheel"===this._type&&a&&u){const y=Math.min((or.now()-this._lastWheelEventTime)/200,1);c=An(a,s,u(y)),y<1?this._frameId||(this._frameId=!0):p=!0}else c=s,p=!0;this._active=!0,p&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let g=c-r();return g*this._lastDelta<0&&(g=0),{noInertia:!0,needsRenderFrame:!p,zoomDelta:g,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=Vt;if(this._prevEase){const s=this._prevEase,a=(or.now()-s.start)/s.duration,u=s.easing(a+.01)-s.easing(a),c=.27/Math.sqrt(u*u+1e-4)*.01;r=de(c,Math.sqrt(.0729-c*c),.25,1)}return this._prevEase={start:or.now(),duration:t,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Hn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(rt.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class zA{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _O{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,r){return t.preventDefault(),{cameraAnimation:s=>{s.easeTo({duration:300,zoom:s.getZoom()+(t.shiftKey?-1:1),around:s.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class BA{constructor(){this._tap=new OS({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,r,s){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?s.length>0&&(this._swipePoint=r[0],this._swipeTouch=s[0].identifier):this._tap.touchstart(t,r,s))}touchmove(t,r,s){if(this._tapTime){if(this._swipePoint){if(s[0].identifier!==this._swipeTouch)return;const a=r[0],u=a.y-this._swipePoint.y;return this._swipePoint=a,t.preventDefault(),this._active=!0,{zoomDelta:u/128}}}else this._tap.touchmove(t,r,s)}touchend(t,r,s){this._tapTime?this._swipePoint&&0===s.length&&this.reset():this._tap.touchend(t,r,s)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yO{constructor(t,r,s){this._el=t,this._mousePan=r,this._touchPan=s}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class UA{constructor(t,r,s){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=s}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Kg{constructor(t,r,s,a){this._el=t,this._touchZoom=r,this._touchRotate=s,this._tapDragZoom=a,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const jd=e=>e.zoom||e.drag||e.pitch||e.rotate;class jA extends Se{}class VA{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,r){const s=Ot.sub([],r,t);this.radius=Ot.length(s[2]<0?Ot.div([],s,this.constants):[s[0],s[1],0])}projectRay(t){Ot.div(t,t,this.constants),Ot.normalize(t,t),Ot.mul(t,t,this.constants);const r=Ot.scale([],t,this.radius);if(r[2]>0){const s=Ot.scale([],[0,0,1],Ot.dot(r,[0,0,1])),a=Ot.scale([],Ot.normalize([],[r[0],r[1],0]),this.radius),u=Ot.add([],r,Ot.scale([],Ot.sub([],Ot.add([],a,s),r),2));r[0]=u[0],r[1]=u[1]}return r}}function m0(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class GA{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new TS(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new VA,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),hn(["handleEvent","handleWindowEvent"],this);const s=this._el;this._listeners=[[s,"touchstart",{passive:!0}],[s,"touchmove",{passive:!1}],[s,"touchend",void 0],[s,"touchcancel",void 0],[s,"mousedown",void 0],[s,"mousemove",void 0],[s,"mouseup",void 0],[rt.document,"mousemove",{capture:!0}],[rt.document,"mouseup",void 0],[s,"mouseover",void 0],[s,"mouseout",void 0],[s,"dblclick",void 0],[s,"click",void 0],[s,"keydown",{capture:!1}],[s,"keyup",void 0],[s,"wheel",{passive:!1}],[s,"contextmenu",void 0],[rt,"blur",void 0]];for(const[a,u,c]of this._listeners)a.addEventListener(u,a===rt.document?this.handleWindowEvent:this.handleEvent,c)}destroy(){for(const[t,r,s]of this._listeners)t.removeEventListener(r,t===rt.document?this.handleWindowEvent:this.handleEvent,s)}_addDefaultHandlers(t){const r=this._map,s=r.getCanvasContainer();this._add("mapEvent",new AS(r,t));const a=r.boxZoom=new LS(r,t);this._add("boxZoom",a);const u=new RS,c=new _O;r.doubleClickZoom=new zA(c,u),this._add("tapZoom",u),this._add("clickZoom",c);const p=new BA;this._add("tapDragZoom",p);const g=r.touchPitch=new Yh(r);this._add("touchPitch",g);const y=new PA(t),x=new LA(t);r.dragRotate=new UA(t,y,x),this._add("mouseRotate",y,["mousePitch"]),this._add("mousePitch",x,["mouseRotate"]);const E=new dO(t),S=new pO(r,t);r.dragPan=new yO(s,E,S),this._add("mousePan",E),this._add("touchPan",S,["touchZoom","touchRotate"]);const M=new NA,D=new RA;r.touchZoomRotate=new Kg(s,D,M,p),this._add("touchRotate",M,["touchPan","touchZoom"]),this._add("touchZoom",D,["touchPan","touchRotate"]),this._add("blockableMapEvent",new PS(r));const P=r.scrollZoom=new kA(r,this);this._add("scrollZoom",P,["mousePan"]);const O=r.keyboard=new mO;this._add("keyboard",O);for(const R of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[R]&&r[R].enable(t[R])}_add(t,r,s){this._handlers.push({handlerName:t,handler:r,allowed:s}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!jd(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,r,s){for(const a in t)if(a!==s&&(!r||r.indexOf(a)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const r=[];for(const s of t)this._el.contains(s.target)&&r.push(s);return r}handleEvent(t,r){this._updatingCamera=!0;const s="renderFrame"===t.type,a=s?void 0:t,u={needsRenderFrame:!1},c={},p={},g=t.touches?this._getMapTouches(t.touches):void 0,y=g?_n(this._el,g):s?void 0:qe(this._el,t);for(const{handlerName:S,handler:M,allowed:D}of this._handlers){if(!M.isEnabled())continue;let P;this._blockedByActive(p,D,S)?M.reset():M[r||t.type]&&(P=M[r||t.type](t,y,g),this.mergeHandlerResult(u,c,P,S,a),P&&P.needsRenderFrame&&this._triggerRenderFrame()),(P||M.isActive())&&(p[S]=M)}const x={};for(const S in this._previousActiveHandlers)p[S]||(x[S]=a);this._previousActiveHandlers=p,(Object.keys(x).length||m0(u))&&(this._changes.push([u,c,x]),this._triggerRenderFrame()),(Object.keys(p).length||m0(u))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:E}=u;E&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],E(this._map))}mergeHandlerResult(t,r,s,a,u){if(!s)return;pe(t,s);const c={handlerName:a,originalEvent:s.originalEvent||u};void 0!==s.zoomDelta&&(r.zoom=c),void 0!==s.panDelta&&(r.drag=c),void 0!==s.pitchDelta&&(r.pitch=c),void 0!==s.bearingDelta&&(r.rotate=c)}_applyChanges(){const t={},r={},s={};for(const[a,u,c]of this._changes)a.panDelta&&(t.panDelta=(t.panDelta||new H(0,0))._add(a.panDelta)),a.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(t.around=a.around),void 0!==a.aroundCoord&&(t.aroundCoord=a.aroundCoord),void 0!==a.pinchAround&&(t.pinchAround=a.pinchAround),a.noInertia&&(t.noInertia=a.noInertia),pe(r,u),pe(s,c);this._updateMapTransform(t,r,s),this._changes=[]}_updateMapTransform(t,r,s){const a=this._map,u=a.transform,c=B=>[B.x,B.y,B.z];if((B=>{const j=this._eventsInProgress.drag;return j&&!this._handlersById[j.handlerName].isActive()})()&&!m0(t)){const B=u.zoom;u.cameraElevationReference="sea",null!=this._originalZoom&&u._orthographicProjectionAtLowPitch&&"globe"!==u.projection.name&&0===u.pitch?(u.cameraElevationReference="ground",u.zoom=this._originalZoom):(u.recenterOnTerrain(),u.cameraElevationReference="ground"),B!==u.zoom&&this._map._update(!0)}if(u._isCameraConstrained&&a._stop(!0),!m0(t))return void this._fireEvents(r,s,!0);let{panDelta:p,zoomDelta:g,bearingDelta:y,pitchDelta:x,around:E,aroundCoord:S,pinchAround:M}=t;u._isCameraConstrained&&(g>0&&(g=0),u._isCameraConstrained=!1),void 0!==M&&(E=M),(g||(B=>r[B]&&!this._eventsInProgress[B])("drag"))&&E&&(this._dragOrigin=c(u.pointCoordinate3D(E)),this._originalZoom=u.zoom,this._trackingEllipsoid.setup(u._camera.position,this._dragOrigin)),u.cameraElevationReference="sea",a._stop(!0),E=E||a.transform.centerPoint,y&&(u.bearing+=y),x&&(u.pitch+=x),u._updateCameraState();const D=[0,0,0];if(p)if("mercator"===u.projection.name){const B=this._trackingEllipsoid.projectRay(u.screenPointToMercatorRay(E).dir),j=this._trackingEllipsoid.projectRay(u.screenPointToMercatorRay(E.sub(p)).dir);D[0]=j[0]-B[0],D[1]=j[1]-B[1]}else{const B=u.pointCoordinate(E);if("globe"===u.projection.name){p=p.rotate(-u.angle);const j=u._pixelsPerMercatorPixel/u.worldSize;D[0]=-p.x*Fv(ws(B.y))*j,D[1]=-p.y*Fv(u.center.lat)*j}else{const j=u.pointCoordinate(E.sub(p));B&&j&&(D[0]=j.x-B.x,D[1]=j.y-B.y)}}const P=u.zoom,O=[0,0,0];if(g){const B=c(S||u.pointCoordinate3D(E)),j={dir:Ot.normalize([],Ot.sub([],B,u._camera.position))};if(j.dir[2]<0){const V=u.zoomDeltaToMovement(B,g);Ot.scale(O,j.dir,V)}}const R=Ot.add(D,D,O);u._translateCameraConstrained(R),g&&Math.abs(u.zoom-P)>1e-4&&u.recenterOnTerrain(),u.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,s,!0)}_fireEvents(t,r,s){const a=jd(this._eventsInProgress),u=jd(t),c={};for(const x in t){const{originalEvent:E}=t[x];this._eventsInProgress[x]||(c[`${x}start`]=E),this._eventsInProgress[x]=t[x]}!a&&u&&this._fireEvent("movestart",u.originalEvent);for(const x in c)this._fireEvent(x,c[x]);u&&this._fireEvent("move",u.originalEvent);for(const x in t){const{originalEvent:E}=t[x];this._fireEvent(x,E)}const p={};let g;for(const x in this._eventsInProgress){const{handlerName:E,originalEvent:S}=this._eventsInProgress[x];this._handlersById[E].isActive()||(delete this._eventsInProgress[x],g=r[E]||S,p[`${x}end`]=g)}for(const x in p)this._fireEvent(x,p[x]);const y=jd(this._eventsInProgress);if(s&&(a||u)&&!y){this._updatingCamera=!0;const x=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),E=S=>0!==S&&-this._bearingSnap<S&&S<this._bearingSnap;x?(E(x.bearing||this._map.getBearing())&&(x.bearing=0),this._map.easeTo(x,{originalEvent:g})):(this._map.fire(new Se("moveend",{originalEvent:g})),E(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new Se(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new jA("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const zS="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class qA extends Qn{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=!1!==r.respectPrefersReducedMotion,hn(["_renderFrameCallback"],this)}getCenter(){return new pr(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,s){return t=H.convert(t).mult(-1),this.panTo(this.transform.center,pe({offset:t},r),s)}panTo(t,r,s){return this.easeTo(pe({center:t},r),s)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,s){return this.easeTo(pe({zoom:t},r),s)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,s){return this.easeTo(pe({bearing:t},r),s)}resetNorth(t,r){return this.rotateTo(0,pe({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(pe({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=$a.convert(t);const s=r&&r.bearing||0,a=r&&r.pitch||0,u=t.getNorthWest(),c=t.getSouthEast();return this._cameraForBounds(this.transform,u,c,s,a,r)}_extendCameraOptions(t){const r={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=pe({padding:r,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const s=t.padding;t.padding={top:s,bottom:s,right:s,left:s}}return t.padding=pe(r,t.padding),t}_minimumAABBFrustumDistance(t,r){const s=r.max[0]-r.min[0],a=r.max[1]-r.min[1];return s/a>t.aspect?s/(2*Math.tan(.5*t.fovX)*t.aspect):a/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,r,s,a,u,c){const p=t.clone(),g=this._extendCameraOptions(c);p.bearing=a,p.pitch=u;const y=pr.convert(r),x=pr.convert(s),E=.5*(y.lat+x.lat),S=.5*(y.lng+x.lng),M=du(E,S),D=Ot.normalize([],M),P=Ot.normalize([],Ot.cross([],D,[0,1,0])),O=Ot.cross([],P,D),R=[P[0],P[1],P[2],0,O[0],O[1],O[2],0,D[0],D[1],D[2],0,0,0,0,1],B=[M,du(y.lat,y.lng),du(x.lat,y.lng),du(x.lat,x.lng),du(y.lat,x.lng),du(E,y.lng),du(E,x.lng),du(y.lat,S),du(x.lat,S)];let j=Qi.fromPoints(B.map(Zt=>[Ot.dot(P,Zt),Ot.dot(O,Zt),Ot.dot(D,Zt)]));const V=Ot.transformMat4([],j.center,R);0===Ot.squaredLength(V)&&Ot.set(V,0,0,1),Ot.normalize(V,V),Ot.scale(V,V,Xl),p.center=function([Zt,ge,be]){const xe=Math.hypot(Zt,ge,be),Re=Math.atan2(Zt,be),ze=.5*Math.PI-Math.acos(-ge/xe);return new pr(Ht(Re),Ht(ze))}(V);const U=p.getWorldToCameraMatrix(),G=ce.invert(new Float64Array(16),U);j=Qi.applyTransform(j,ce.multiply([],U,R)),Ot.transformMat4(V,V,U);const Z=.5*(j.max[2]-j.min[2]),Q=this._minimumAABBFrustumDistance(p,j),et=Ot.scale([],[0,0,1],Z),it=Ot.add(et,V,et),yt=Q+(0===p.pitch?0:Ot.distance(V,it)),xt=p.globeCenterInViewSpace,Nt=Ot.sub([],V,[xt[0],xt[1],xt[2]]);Ot.normalize(Nt,Nt),Ot.scale(Nt,Nt,yt);const ft=Ot.add([],V,Nt);Ot.transformMat4(ft,ft,G);const Ut=ig/Xl,Wt=Ot.length(ft),le=ji(Math.max(Wt*Ut-ig,Number.EPSILON),0),Bt=Math.min(p.zoomFromMercatorZAdjusted(le),g.maxZoom);return Bt>.5*(ng+df)?(p.setProjection({name:"mercator"}),p.zoom=Bt,this._cameraForBounds(p,r,s,a,u,c)):{center:p.center,zoom:Bt,bearing:a,pitch:u}}queryTerrainElevation(t,r){const s=this.transform.elevation;return s?(r=pe({},{exaggerated:!0},r),s.getAtPoint(ri.fromLngLat(t),null,r.exaggerated)):null}_cameraForBounds(t,r,s,a,u,c){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,r,s,a,u,c);const p=t.clone(),g=this._extendCameraOptions(c),y=p.padding;p.bearing=a,p.pitch=u;const x=pr.convert(r),E=pr.convert(s),S=new pr(x.lng,E.lat),M=new pr(E.lng,x.lat),D=p.project(x),P=p.project(E),O=this.queryTerrainElevation(x),R=this.queryTerrainElevation(E),B=this.queryTerrainElevation(S),j=this.queryTerrainElevation(M),V=[[D.x,D.y,Math.min(O||0,R||0,B||0,j||0)],[P.x,P.y,Math.max(O||0,R||0,B||0,j||0)]];let U=Qi.fromPoints(V);const G=p.getWorldToCameraMatrix(),Z=ce.invert(new Float64Array(16),G);U=Qi.applyTransform(U,G);const Q=Ot.sub([],U.max,U.min),et=y.left||0,it=y.right||0,yt=y.bottom||0,xt=y.top||0,{left:Nt,right:ft,top:Ut,bottom:Wt}=g.padding,le=.5*(et+it),Bt=.5*(xt+yt),Zt=Math.min(p.scaleZoom(p.scale*Math.min((p.width-(et+it+Nt+ft))/Q[0],(p.height-(yt+xt+Wt+Ut))/Q[1])),g.maxZoom),ge=p.scale/p.zoomScale(Zt);U=new Qi([U.min[0]-(Nt+le)*ge,U.min[1]-(Wt+Bt)*ge,U.min[2]],[U.max[0]+(ft+le)*ge,U.max[1]+(Ut+Bt)*ge,U.max[2]]);const be=.5*Q[2],xe=this._minimumAABBFrustumDistance(p,U),Re=[0,0,1,0];Oi.transformMat4(Re,Re,G),Oi.normalize(Re,Re);const ze=Ot.scale([],Re,xe+be),$e=Ot.add([],U.center,ze),Ie=("number"==typeof g.offset.x&&"number"==typeof g.offset.y?new H(g.offset.x,g.offset.y):H.convert(g.offset)).rotate(-St(a));U.center[0]-=Ie.x*ge,U.center[1]+=Ie.y*ge,Ot.transformMat4(U.center,U.center,Z),Ot.transformMat4($e,$e,Z);const on=[U.center[0],U.center[1],$e[2]*p.pixelsPerMeter];Ot.scale(on,on,1/p.worldSize);const vn=pu(on[0]),xn=ws(on[1]),Cn=Math.min(p._zoomFromMercatorZ(on[2]),g.maxZoom),Mn=new pr(vn,xn);return p.mercatorFromTransition&&Cn<.5*(ng+df)?(p.setProjection({name:"globe"}),p.zoom=Cn,this._cameraForBounds(p,r,s,a,u,c)):{center:Mn,zoom:Cn,bearing:a,pitch:u}}fitBounds(t,r,s){const a=this.cameraForBounds(t,r);return this._fitInternal(a,r,s)}fitScreenCoordinates(t,r,s,a,u){const c=H.convert(t),p=H.convert(r),g=new H(Math.min(c.x,p.x),Math.min(c.y,p.y)),y=new H(Math.max(c.x,p.x),Math.max(c.y,p.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(c,p))return this;const x=this.transform.pointLocation3D(g),E=this.transform.pointLocation3D(y),S=this.transform.pointLocation3D(new H(g.x,y.y)),M=this.transform.pointLocation3D(new H(y.x,g.y)),D=[Math.min(x.lng,E.lng,S.lng,M.lng),Math.min(x.lat,E.lat,S.lat,M.lat)],P=[Math.max(x.lng,E.lng,S.lng,M.lng),Math.max(x.lat,E.lat,S.lat,M.lat)],O=a&&a.pitch?a.pitch:this.getPitch(),R=this._cameraForBounds(this.transform,D,P,s,O,a);return this._fitInternal(R,a,u)}_fitInternal(t,r,s){return t?(delete(r=pe(t,r)).padding,r.linear?this.easeTo(r,s):this.flyTo(r,s)):this}jumpTo(t,r){this.stop();const s=t.preloadOnly?this.transform.clone():this.transform;let a=!1,u=!1,c=!1;return"zoom"in t&&s.zoom!==+t.zoom&&(a=!0,s.zoom=+t.zoom),void 0!==t.center&&(s.center=pr.convert(t.center)),"bearing"in t&&s.bearing!==+t.bearing&&(u=!0,s.bearing=+t.bearing),"pitch"in t&&s.pitch!==+t.pitch&&(c=!0,s.pitch=+t.pitch),null==t.padding||s.isPaddingEqual(t.padding)||(s.padding=t.padding),t.preloadOnly?(this._preloadTiles(s),this):(this.fire(new Se("movestart",r)).fire(new Se("move",r)),a&&this.fire(new Se("zoomstart",r)).fire(new Se("zoom",r)).fire(new Se("zoomend",r)),u&&this.fire(new Se("rotatestart",r)).fire(new Se("rotate",r)).fire(new Se("rotateend",r)),c&&this.fire(new Se("pitchstart",r)).fire(new Se("pitch",r)).fire(new Se("pitchend",r)),this.fire(new Se("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||Gt(zS),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,r){const s=this.transform;if(!s.projection.supportsFreeCamera)return Gt(zS),this;this.stop();const a=s.zoom,u=s.pitch,c=s.bearing;s.setFreeCameraOptions(t);const p=a!==s.zoom,g=u!==s.pitch,y=c!==s.bearing;return this.fire(new Se("movestart",r)).fire(new Se("move",r)),p&&this.fire(new Se("zoomstart",r)).fire(new Se("zoom",r)).fire(new Se("zoomend",r)),y&&this.fire(new Se("rotatestart",r)).fire(new Se("rotate",r)).fire(new Se("rotateend",r)),g&&this.fire(new Se("pitchstart",r)).fire(new Se("pitch",r)).fire(new Se("pitchend",r)),this.fire(new Se("moveend",r)),this}easeTo(t,r){this._stop(!1,t.easeId),(!1===(t=pe({offset:[0,0],duration:500,easing:Vt},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const s=this.transform,a=this.getZoom(),u=this.getBearing(),c=this.getPitch(),p=this.getPadding(),g="zoom"in t?+t.zoom:a,y="bearing"in t?this._normalizeBearing(t.bearing,u):u,x="pitch"in t?+t.pitch:c,E="padding"in t?t.padding:s.padding,S=H.convert(t.offset);let M,D,P;if("globe"===s.projection.name){const et=ri.fromLngLat(s.center),it=S.rotate(-s.angle);et.x+=it.x/s.worldSize,et.y+=it.y/s.worldSize;const yt=et.toLngLat(),xt=pr.convert(t.center||yt);this._normalizeCenter(xt),M=s.centerPoint.add(it),D=new H(et.x,et.y).mult(s.worldSize),P=new H(zs(xt.lng),ba(xt.lat)).mult(s.worldSize).sub(D)}else{M=s.centerPoint.add(S);const et=s.pointLocation(M),it=pr.convert(t.center||et);this._normalizeCenter(it),D=s.project(et),P=s.project(it).sub(D)}const O=s.zoomScale(g-a);let R,B;t.around&&(R=pr.convert(t.around),B=s.locationPoint(R));const j=this._zooming||g!==a,V=this._rotating||u!==y,U=this._pitching||x!==c,G=!s.isPaddingEqual(E),Z=et=>it=>{if(j&&(et.zoom=An(a,g,it)),V&&(et.bearing=An(u,y,it)),U&&(et.pitch=An(c,x,it)),G&&(et.interpolatePadding(p,E,it),M=et.centerPoint.add(S)),R)et.setLocationAtPoint(R,B);else{const yt=et.zoomScale(et.zoom-a),xt=g>a?Math.min(2,O):Math.max(.5,O),Nt=Math.pow(xt,1-it),ft=et.unproject(D.add(P.mult(it*Nt)).mult(yt));et.setLocationAtPoint(et.renderWorldCopies?ft.wrap():ft,M)}return t.preloadOnly||this._fireMoveEvents(r),et};if(t.preloadOnly){const et=this._emulate(Z,t.duration,s);return this._preloadTiles(et),this}const Q={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=j,this._rotating=V,this._pitching=U,this._padding=G,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,Q),this._ease(Z(s),et=>{"sea"===s.cameraElevationReference&&s.recenterOnTerrain(),this._afterEase(r,et)},t),this}_prepareEase(t,r,s={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),r||s.moving||this.fire(new Se("movestart",t)),this._zooming&&!s.zooming&&this.fire(new Se("zoomstart",t)),this._rotating&&!s.rotating&&this.fire(new Se("rotatestart",t)),this._pitching&&!s.pitching&&this.fire(new Se("pitchstart",t))}_fireMoveEvents(t){this.fire(new Se("move",t)),this._zooming&&this.fire(new Se("zoom",t)),this._rotating&&this.fire(new Se("rotate",t)),this._pitching&&this.fire(new Se("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const s=this._zooming,a=this._rotating,u=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,s&&this.fire(new Se("zoomend",t)),a&&this.fire(new Se("rotateend",t)),u&&this.fire(new Se("pitchend",t)),this.fire(new Se("moveend",t))}flyTo(t,r){if(this._prefersReducedMotion(t)){const Zt=Fe(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Zt,r)}this.stop(),t=pe({offset:[0,0],speed:1.2,curve:1.42,easing:Vt},t);const s=this.transform,a=this.getZoom(),u=this.getBearing(),c=this.getPitch(),p=this.getPadding(),g="zoom"in t?At(+t.zoom,s.minZoom,s.maxZoom):a,y="bearing"in t?this._normalizeBearing(t.bearing,u):u,x="pitch"in t?+t.pitch:c,E="padding"in t?t.padding:s.padding,S=s.zoomScale(g-a),M=H.convert(t.offset);let D=s.centerPoint.add(M);const P=s.pointLocation(D),O=pr.convert(t.center||P);this._normalizeCenter(O);const R=s.project(P),B=s.project(O).sub(R);let j=t.curve;const V=Math.max(s.width,s.height),U=V/S,G=B.mag();if("minZoom"in t){const Zt=At(Math.min(t.minZoom,a,g),s.minZoom,s.maxZoom),ge=V/s.zoomScale(Zt-a);j=Math.sqrt(ge/G*2)}const Z=j*j;function Q(Zt){const ge=(U*U-V*V+(Zt?-1:1)*Z*Z*G*G)/(2*(Zt?U:V)*Z*G);return Math.log(Math.sqrt(ge*ge+1)-ge)}function et(Zt){return(Math.exp(Zt)-Math.exp(-Zt))/2}function it(Zt){return(Math.exp(Zt)+Math.exp(-Zt))/2}const yt=Q(0);let xt=function(Zt){return it(yt)/it(yt+j*Zt)},Nt=function(Zt){return V*((it(yt)*(et(ge=yt+j*Zt)/it(ge))-et(yt))/Z)/G;var ge},ft=(Q(1)-yt)/j;if(Math.abs(G)<1e-6||!isFinite(ft)){if(Math.abs(V-U)<1e-6)return this.easeTo(t,r);const Zt=U<V?-1:1;ft=Math.abs(Math.log(U/V))/j,Nt=function(){return 0},xt=function(ge){return Math.exp(Zt*j*ge)}}t.duration="duration"in t?+t.duration:1e3*ft/("screenSpeed"in t?+t.screenSpeed/j:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Ut=u!==y,Wt=x!==c,le=!s.isPaddingEqual(E),Bt=Zt=>ge=>{const be=ge*ft,xe=1/xt(be);Zt.zoom=1===ge?g:a+Zt.scaleZoom(xe),Ut&&(Zt.bearing=An(u,y,ge)),Wt&&(Zt.pitch=An(c,x,ge)),le&&(Zt.interpolatePadding(p,E,ge),D=Zt.centerPoint.add(M));const Re=1===ge?O:Zt.unproject(R.add(B.mult(Nt(be))).mult(xe));return Zt.setLocationAtPoint(Zt.renderWorldCopies?Re.wrap():Re,D),Zt._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(r),Zt};if(t.preloadOnly){const Zt=this._emulate(Bt,t.duration,s);return this._preloadTiles(Zt),this}return this._zooming=!0,this._rotating=Ut,this._pitching=Wt,this._padding=le,this._prepareEase(r,!1),this._ease(Bt(s),()=>this._afterEase(r),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const s=this._onEaseEnd;this._onEaseEnd=void 0,s.call(this,r)}if(!t){const s=this.handlers;s&&s.stop(!1)}return this}_ease(t,r,s){!1===s.animate||0===s.duration?(t(1),r()):(this._easeStart=or.now(),this._easeOptions=s,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((or.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=wt(t,-180,180);const s=Math.abs(t-r);return Math.abs(t-360-r)<s&&(t-=360),Math.abs(t+360-r)<s&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(r.maxBounds||"globe"!==r.projection.name&&!r.renderWorldCopies)return;const s=t.lng-r.center.lng;t.lng+=s>180?-360:s<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&or.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,r,s){const a=Math.ceil(15*r/1e3),u=[],c=t(s.clone());for(let p=0;p<=a;p++){const g=c(p/a);u.push(g.clone())}return u}}class g0{constructor(t={}){this.options=t,hn(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const r=this.options&&this.options.compact;return this._map=t,this._container=Hn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Hn("button","mapboxgl-ctrl-attrib-button",this._container),Hn("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Hn("div","mapboxgl-ctrl-attrib-inner",this._container),r&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===r&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,r){const s=this._map._getUIString(`AttributionControl.${r}`);t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",s)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||Yt.ACCESS_TOKEN}];if(t){const s=r.reduce((a,u,c)=>(u.value&&(a+=`${u.key}=${u.value}${c<r.length-1?"&":""}`),a),"?");t.href=`${Yt.FEEDBACK_URL}/${s}#${IS(this._map,!0)}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const a=this._map.style.stylesheet;this.styleOwner=a.owner,this.styleId=a.id}const r=this._map.style._mergedSourceCaches;for(const a in r){const u=r[a];if(u.used){const c=u.getSource();c.attribution&&t.indexOf(c.attribution)<0&&t.push(c.attribution)}}t.sort((a,u)=>a.length-u.length),t=t.filter((a,u)=>{for(let c=u+1;c<t.length;c++)if(t[c].indexOf(a)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const s=t.join(" | ");s!==this._attribHTML&&(this._attribHTML=s,t.length?(this._innerContainer.innerHTML=s,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class BS{constructor(){hn(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Hn("div","mapboxgl-ctrl");const r=Hn("a","mapboxgl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://www.mapbox.com/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const r in t){const s=t[r].getSource();if(s.hasOwnProperty("mapbox_logo")&&!s.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const r=t[0];this._map.getCanvasContainer().offsetWidth<250?r.classList.add("mapboxgl-compact"):r.classList.remove("mapboxgl-compact")}}}class US{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,s=r?this._queue.concat(r):this._queue;for(const a of s)if(a.id===t)return void(a.cancelled=!0)}run(t=0){const r=this._currentlyRunning=this._queue;this._queue=[];for(const s of r)if(!s.cancelled&&(s.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function jS(e,t,r){if(e=new pr(e.lng,e.lat),t){const s=new pr(e.lng-360,e.lat),a=new pr(e.lng+360,e.lat),u=360*Math.ceil(Math.abs(e.lng-r.center.lng)/360),c=r.locationPoint(e).distSqr(t),p=t.x<0||t.y<0||t.x>r.width||t.y>r.height;r.locationPoint(s).distSqr(t)<c&&(p||Math.abs(s.lng-r.center.lng)<u)?e=s:r.locationPoint(a).distSqr(t)<c&&(p||Math.abs(a.lng-r.center.lng)<u)&&(e=a)}for(;Math.abs(e.lng-r.center.lng)>180;){const s=r.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=r.width&&s.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e}const ib={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ob extends Qn{constructor(t,r){if(super(),(t instanceof rt.HTMLElement||r)&&(t=pe({element:t},r)),hn(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=H.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Hn("div");const u=41,c=27,p=gl("svg",{display:"block",height:u*this._scale+"px",width:c*this._scale+"px",viewBox:`0 0 ${c} ${u}`},this._element),g=gl("radialGradient",{id:"shadowGradient"},gl("defs",{},p));gl("stop",{offset:"10%","stop-opacity":.4},g),gl("stop",{offset:"100%","stop-opacity":.05},g),gl("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},p),gl("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},p),gl("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},p),gl("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},p),this._offset=H.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()});const s=this._element.classList;for(const u in ib)s.remove(`mapboxgl-marker-anchor-${u}`);s.add(`mapboxgl-marker-anchor-${this._anchor}`);const a=t&&t.className?t.className.trim().split(/\s+/):[];s.add(...a),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=pr.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const a=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[a,-1*(24.6+a)],"bottom-right":[-a,-1*(24.6+a)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const r=t.code,s=t.charCode||t.keyCode;"Space"!==r&&"Enter"!==r&&32!==s&&13!==s||this.togglePopup()}_onMapClick(t){const r=t.originalEvent.target,s=this._element;this._popup&&(r===s||s.contains(r))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,r=this._pos;if(!t||!r)return!1;const s=t.unproject(r),a=t.getFreeCameraOptions();if(!a.position)return!1;const u=a.position.toLngLat();return u.distanceTo(s)<.9*u.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const r=this._pos;if(!r||r.x<0||r.x>t.transform.width||r.y<0||r.y>t.transform.height)return void this._clearFadeTimer();const s=t.unproject(r);let a;t._showingGlobe()&&Lv(t.transform,this._lngLat)?a=0:(a=1-t._queryFogOpacity(s),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(a*=this._occludedOpacity)),this._element.style.opacity=`${a}`,this._element.style.pointerEvents=a>0?"auto":"none",this._popup&&this._popup._setOpacity(a),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const r=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${t.x}px,${t.y}px)\n            ${ib[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${r.x}px,${r.y}px)\n        `}_calculateXYTransform(){const t=this._pos,r=this._map,s=this.getPitchAlignment();if(!r||!t||"map"!==s)return"";if(!r._showingGlobe()){const g=r.getPitch();return g?`rotateX(${g}deg)`:""}const a=Ht(kT(r.transform,this._lngLat)),u=t.sub(Pv(r.transform)),c=Math.abs(u.x)+Math.abs(u.y);if(0===c)return"";const p=a/c;return`rotateX(${-u.y*p}deg) rotateY(${u.x*p}deg)`}_calculateZTransform(){const t=this._pos,r=this._map;if(!r||!t)return"";let s=0;const a=this.getRotationAlignment();if("map"===a)if(r._showingGlobe()){const u=r.project(new pr(this._lngLat.lng,this._lngLat.lat+.001)),c=r.project(new pr(this._lngLat.lng,this._lngLat.lat-.001)).sub(u);s=Ht(Math.atan2(c.y,c.x))-90}else s=-r.getBearing();else if("horizon"===a){const u=ne(4,6,r.getZoom()),c=Pv(r.transform);c.y+=u*r.transform.height;const p=t.sub(c),g=Ht(Math.atan2(p.y,p.x));s=(g>90?g-270:g+90)*(1-u)}return s+=this._rotation,s?`rotateZ(${s}deg)`:""}_update(t){rt.cancelAnimationFrame(this._updateFrameId);const r=this._map;r&&(r.transform.renderWorldCopies&&(this._lngLat=jS(this._lngLat,this._pos,r.transform)),this._pos=r.project(this._lngLat),!0===t?this._updateFrameId=rt.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),r._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(r._showingGlobe()||r.getTerrain()||r.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=H.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const r=this._map;if(!r)return;const s=this._pointerdownPos,a=this._positionDelta;if(s&&a){if(!this._isDragging){const u=this._clickTolerance||r._clickTolerance;if(t.point.dist(s)<u)return;this._isDragging=!0}this._pos=t.point.sub(a),this._lngLat=r.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new Se("dragstart"))),this.fire(new Se("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new Se("dragend")),this._state="inactive"}_addDragHandler(t){const r=this._map,s=this._pos;r&&s&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(s),this._pointerdownPos=t.point,this._state="pending",r.on("mousemove",this._onMove),r.on("touchmove",this._onMove),r.once("mouseup",this._onUp),r.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const r=this._map;return r&&(t?(r.on("mousedown",this._addDragHandler),r.on("touchstart",this._addDragHandler)):(r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const $A={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},HA=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function VS(e=new H(0,0),t="bottom"){if("number"==typeof e){const r=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(t){case"top":return new H(0,e);case"top-left":return new H(r,r);case"top-right":return new H(-r,r);case"bottom":return new H(0,-e);case"bottom-left":return new H(r,-r);case"bottom-right":return new H(-r,-r);case"left":return new H(e,0);case"right":return new H(-e,0)}return new H(0,0)}return e instanceof H||Array.isArray(e)?H.convert(e):H.convert(e[t]||[0,0])}class ZA{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const r=cn((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,r,s){this._start=this.getValue(r),this._end=t,this._startTime=r,this._endTime=r+s}}const WA={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},XA={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},GS={showCompass:!0,showZoom:!0,visualizePitch:!1};class sb{constructor(t,r,s=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new PA({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,s&&(this.mousePitch=new LA({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),hn(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(t,r){this.mouseRotate.mousedown(t,r),this.mousePitch&&this.mousePitch.mousedown(t,r),qt()}move(t,r){const s=this.map,a=this.mouseRotate.mousemoveWindow(t,r),u=a&&a.bearingDelta;if(u&&s.setBearing(s.getBearing()+u),this.mousePitch){const c=this.mousePitch.mousemoveWindow(t,r),p=c&&c.pitchDelta;p&&s.setPitch(s.getPitch()+p)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){he(),rt.removeEventListener("mousemove",this.mousemove),rt.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(pe({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),qe(this.element,t)),rt.addEventListener("mousemove",this.mousemove),rt.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,qe(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=_n(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=_n(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const YA={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},JA={maxWidth:100,unit:"metric"},qS={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Qg={version:zt,supported:_c,setRTLTextPlugin:function(e,t,r=!1){if(fa===G0||fa===Va||fa===p_)throw new Error("setRTLTextPlugin cannot be called multiple times.");Jc=or.resolveURL(e),fa=G0,Gf=t,q0(),r||Ol()},getRTLTextPluginStatus:g_,Map:class extends qA{constructor(e){ms.mark(Os.create);const t=e;if(null!=(e=pe({},XA,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&function(r){const s=r.navigator?r.navigator.userAgent:null;return!!function(a){if(null==jn){const u=a.navigator?a.navigator.userAgent:null;jn=!!a.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return jn}(r)&&s&&(s.match("Version/15.4")||s.match("Version/15.5")||s.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(rt)&&(e.antialias=!1,Gt("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new zy(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new US,this._domRenderTaskQueue=new US,this._controls=[],this._markers=[],this._popups=[],this._mapId=On(),this._locale=pe({},WA,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ZA(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new En(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,this._contextCreateOptions=e.contextCreateOptions?{...e.contextCreateOptions}:{},"string"==typeof e.container){if(this._container=rt.document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container.toString()}' not found.`)}else{if(!(e.container instanceof rt.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&Gt("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),hn(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==rt&&(this._fullscreenchangeEvent="onfullscreenchange"in rt.document?"fullscreenchange":"webkitfullscreenchange",rt.addEventListener("online",this._onWindowOnline,!1),rt.addEventListener("resize",this._onWindowResize,!1),rt.addEventListener("orientationchange",this._onWindowResize,!1),rt.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),rt.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new GA(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,(e.style||!e.testMode)&&this.setStyle(e.style||Yt.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),e.hash&&(this._hash=new TA("string"==typeof e.hash&&e.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==t.center&&null==t.zoom||(this.transform._unmodified=!1),this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch});const r=e.bounds;r&&(this.resize(),this.fitBounds(r,pe({},e.fitBoundsOptions,{duration:0})))}this.resize(),e.attributionControl&&this.addControl(new g0({customAttribution:e.customAttribution})),this._logoControl=new BS,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update("style"===r.dataType),this.fire(new Se(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new Se(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(e,t){if(void 0===t&&(t=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new Oe(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=e.onAdd(this);this._controls.push(e);const s=this._controlPositions[t];return-1!==t.indexOf("bottom")?s.insertBefore(r,s.firstChild):s.appendChild(r),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new Oe(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(e);return t>-1&&this._controls.splice(t,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new Se("movestart",e)).fire(new Se("move",e)),this.fire(new Se("resize",e)),t&&this.fire(new Se("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds($a.convert(e)),this._update()}setMinZoom(e){if((e=e??-2)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new Se("zoomstart")).fire(new Se("zoom")).fire(new Se("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=e??22)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new Se("zoomstart")).fire(new Se("zoom")).fire(new Se("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=e??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new Se("pitchstart")).fire(new Se("pitch")).fire(new Se("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=e??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new Se("pitchstart")).fire(new Se("pitch")).fire(new Se("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?rt.navigator.language:Array.isArray(e)?0===e.length?void 0:e.map(t=>"auto"===t?rt.navigator.language:t):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const e=this.transform,t=e.projection.name;let r;"globe"===t&&e.zoom>=df?(e.setMercatorFromTransition(),r=!0):"mercator"===t&&e.zoom<df&&(e.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(e){let t;return t="globe"===e.name&&this.transform.zoom>=df?this.transform.setMercatorFromTransition():this.transform.setProjection(e),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(e){return this.transform.locationPoint3D(pr.convert(e))}unproject(e){return this.transform.pointLocation3D(H.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,r){if("mouseenter"===e||"mouseover"===e){let s=!1;const a=c=>{const p=t.filter(y=>this.getLayer(y)),g=p.length?this.queryRenderedFeatures(c.point,{layers:p}):[];g.length?s||(s=!0,r.call(this,new xu(e,this,c.originalEvent,{features:g}))):s=!1},u=()=>{s=!1};return{layers:new Set(t),listener:r,delegates:{mousemove:a,mouseout:u}}}if("mouseleave"===e||"mouseout"===e){let s=!1;const a=c=>{const p=t.filter(g=>this.getLayer(g));(p.length?this.queryRenderedFeatures(c.point,{layers:p}):[]).length?s=!0:s&&(s=!1,r.call(this,new xu(e,this,c.originalEvent)))},u=c=>{s&&(s=!1,r.call(this,new xu(e,this,c.originalEvent)))};return{layers:new Set(t),listener:r,delegates:{mousemove:a,mouseout:u}}}{const s=a=>{const u=t.filter(p=>this.getLayer(p)),c=u.length?this.queryRenderedFeatures(a.point,{layers:u}):[];c.length&&(a.features=c,r.call(this,a),delete a.features)};return{layers:new Set(t),listener:r,delegates:{[e]:s}}}}on(e,t,r){if(void 0===r)return super.on(e,t);if(Array.isArray(t)||(t=[t]),t)for(const a of t)if(!this._isValidId(a))return this;const s=this._createDelegatedListener(e,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(s);for(const a in s.delegates)this.on(a,s.delegates[a]);return this}once(e,t,r){if(void 0===r)return super.once(e,t);if(Array.isArray(t)||(t=[t]),t)for(const a of t)if(!this._isValidId(a))return this;const s=this._createDelegatedListener(e,t,r);for(const a in s.delegates)this.once(a,s.delegates[a]);return this}off(e,t,r){if(void 0===r)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);for(const u of t)if(!this._isValidId(u))return this;const s=(u,c)=>{if(u.size!==c.size)return!1;for(const p of u)if(!c.has(p))return!1;return!0},a=this._delegatedListeners?this._delegatedListeners[e]:void 0;return a&&(u=>{for(let c=0;c<u.length;c++){const p=u[c];if(p.listener===r&&s(p.layers,t)){for(const g in p.delegates)this.off(g,p.delegates[g]);return u.splice(c,1),this}}})(a),this}queryRenderedFeatures(e,t){if(!this.style)return[];if(void 0!==t||void 0===e||e instanceof H||Array.isArray(e)||(t=e,e=void 0),e=e||[[0,0],[this.transform.width,this.transform.height]],(t=t||{}).layers&&Array.isArray(t.layers))for(const r of t.layers)if(!this._isValidId(r))return[];return this.style.queryRenderedFeatures(e,t,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(e){const{name:t}=this.transform.projection;return"globe"!==t&&"mercator"!==t&&Gt(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(H.convert(e))}setStyle(e,t){return!1!==(t=pe({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(e,t))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new Uc(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Uc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,t){if("string"==typeof e){const r=this._requestManager.normalizeStyleURL(e),s=this._requestManager.transformRequest(r,Kt.Style);ye(s,(a,u)=>{a?this.fire(new Oe(a)):u&&this._updateDiff(u,t)})}else"object"==typeof e&&this._updateDiff(e,t)}_updateDiff(e,t){try{this.style.setState(e)&&this._update(!0)}catch(r){Gt(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(e,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(Gt("There is no style added to the map."),!1)}_isValidId(e){return null==e?(this.fire(new Oe(new Error("IDs can't be empty."))),!1):!H0(e)||(this.fire(new Oe(new Error(`IDs can't contain special symbols: "${e}".`))),!1)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const t in e){const r=e[t]._tiles;for(const s in r){const a=r[s];if("loaded"!==a.state&&"errored"!==a.state)return!1}}return!0}addSourceType(e,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,r)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(e,t,{pixelRatio:r=1,sdf:s=!1,stretchX:a,stretchY:u,content:c}={}){if(this._lazyInitEmptyStyle(),t instanceof rt.HTMLImageElement||rt.ImageBitmap&&t instanceof rt.ImageBitmap){const{width:p,height:g,data:y}=or.getImageData(t);this.style.addImage(e,{data:new Hs({width:p,height:g},y),pixelRatio:r,stretchX:a,stretchY:u,content:c,sdf:s,version:0})}else if(void 0===t.width||void 0===t.height)this.fire(new Oe(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:p,height:g}=t,y=t;this.style.addImage(e,{data:new Hs({width:p,height:g},new Uint8Array(y.data)),pixelRatio:r,stretchX:a,stretchY:u,content:c,sdf:s,version:0,userImage:y}),y.onAdd&&y.onAdd(this,e)}}updateImage(e,t){this._lazyInitEmptyStyle();const r=this.style.getImage(e);if(!r)return void this.fire(new Oe(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const s=t instanceof rt.HTMLImageElement||rt.ImageBitmap&&t instanceof rt.ImageBitmap?or.getImageData(t):t,{width:a,height:u}=s;void 0!==a&&void 0!==u?a===r.data.width&&u===r.data.height?(r.data.replace(s.data,!(t instanceof rt.HTMLImageElement||rt.ImageBitmap&&t instanceof rt.ImageBitmap)),this.style.updateImage(e,r)):this.fire(new Oe(new Error(`The width and height of the updated image (${a}, ${u})\n                must be that same as the previous version of the image\n                (${r.data.width}, ${r.data.height})`))):this.fire(new Oe(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(e){return e?!!this.style&&!!this.style.getImage(e):(this.fire(new Oe(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e,t){Tn(this._requestManager.transformRequest(e,Kt.Image),(r,s)=>{t(r,s instanceof rt.HTMLImageElement?or.getImageData(s):s)})}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(e){return e?this.style.hasModel(e):(this.fire(new Oe(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){return this._isValidId(e)?this.style.getOwnLayer(e):null}setLayerZoomRange(e,t,r){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,r),this._update(!0)):this}setFilter(e,t,r={}){return this._isValidId(e)?(this.style.setFilter(e,t,r),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,r,s={}){return this._isValidId(e)?(this.style.setPaintProperty(e,t,r,s),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,r,s={}){return this._isValidId(e)?(this.style.setLayoutProperty(e,t,r,s),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,r){return this.style.setConfigProperty(e,t,r),this._update(!0)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(pr.convert(e),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let r,s,a,u=this._container;for(;u&&(!s||!a);){const c=rt.getComputedStyle(u).transform;c&&"none"!==c&&(r=c.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&"0"!==r[0]&&"1"!==r[0]&&(s=r[0]),r[3]&&"0"!==r[3]&&"1"!==r[3]&&(a=r[3])),u=u.parentElement}this._containerWidth=s?Math.abs(e/s):e,this._containerHeight=a?Math.abs(t/a):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==rt.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&Gt("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=Hn("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Hn("div","mapboxgl-canvas-container",e);this._canvas=Hn("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=Hn("div","mapboxgl-control-container",e),s=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(a=>{s[a]=Hn("div",`mapboxgl-ctrl-${a}`,r)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t){const r=or.devicePixelRatio||1;this._canvas.width=r*Math.ceil(e),this._canvas.height=r*Math.ceil(t),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const e=pe({},_c.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",e);t?(pl(t,!0),this.painter=new EA(t,this._contextCreateOptions,this.transform),this.on("data",r=>{"source"===r.dataType&&this.painter.setTileLoadedFlag(!0)}),Me.testSupport(t)):this.fire(new Oe(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new Se("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new Se("webglcontextrestored",{originalEvent:e}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(e){let t;this.fire(new Se("renderstart"));const r=this.painter.context.extTimerQuery,s=or.now(),a=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=a.createQuery(),a.beginQuery(r.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],rt.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],rt.performance.now())),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjectionTransition();const u=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,y=this.transform.pitch,x=or.now(),E=new ss(g,{now:x,fadeDuration:u,pitch:y,transition:this.style.transition});this.style.update(E)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let c=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),c=this._updateAverageElevation(s),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):c=this._updateAverageElevation(s),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,u,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:u,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new Se("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new Se("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const g=or.now()-s;a.endQuery(r.TIME_ELAPSED_EXT),setTimeout(()=>{const y=a.getQueryParameter(t,a.QUERY_RESULT)/1e6;a.deleteQuery(t),this.fire(new Se("gpu-timing-frame",{cpuTime:g,gpuTime:y})),rt.performance.mark("frame-gpu",{startTime:s,detail:{gpuTime:y}})},50)}if(this.listens("gpu-timing-layer")){const g=this.painter.collectGpuTimers();setTimeout(()=>{const y=this.painter.queryGpuTimers(g);this.fire(new Se("gpu-timing-layer",{layerTimes:y}))},50)}if(this.listens("gpu-timing-deferred-render")){const g=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const y=this.painter.queryGpuTimeDeferredRender(g);this.fire(new Se("gpu-timing-deferred-render",{gpuTime:y}))},50)}const p=this._sourcesDirty||this._styleDirty||this._placementDirty||c;if(p||this._repaint)this.triggerRepaint();else{const g=!this.isMoving()&&this.loaded();if(g&&(c=this._updateAverageElevation(s,!0)),c)this.triggerRepaint();else if(this._triggerFrame(!1),g&&(this.fire(new Se("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const y=this._calculateSpeedIndex();this.fire(new Se("speedindexcompleted",{speedIndex:y})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,ms.mark(Os.fullLoad),this._performanceMetricsCollection&&ga(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e,t=!1){const r=a=>(this.transform.averageElevation=a,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&r(0);const s=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(s||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const a=this.transform.averageElevation;let u=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(u)?u=0:this._averageElevationLastSampledAt=e;const c=Math.abs(a-u);if(c>1){if(this._isInitialLoad||s)return this._averageElevation.jumpTo(u),r(u);this._averageElevation.easeTo(u,e,300)}else if(c>1e-4)return this._averageElevation.jumpTo(u),r(u)}return!!this._averageElevation.isEasing(e)&&r(this._averageElevation.getValue(e))}_authenticate(){wi(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,e=>{if(e&&(e.message===Ir||401===e.status)){const t=this.painter.context.gl;pl(t,!1),this._logoControl instanceof BS&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new Oe(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ps(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,s=r.createFramebuffer();function a(u){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,u,0);const c=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,c),c}return r.bindFramebuffer(r.FRAMEBUFFER,s),this._canvasPixelComparison(a(e),t.canvasCopies.map(a),t.timeStamps)}_canvasPixelComparison(e,t,r){let s=r[1]-r[0];const a=e.length/4;for(let u=0;u<t.length;u++){const c=t[u];let p=0;for(let g=0;g<c.length;g+=4)c[g]===e[g]&&c[g+1]===e[g+1]&&c[g+2]===e[g+2]&&c[g+3]===e[g+3]&&(p+=1);s+=(r[u+2]-r[u+1])*(1-p/a)}return s}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==rt&&(rt.removeEventListener("resize",this._onWindowResize,!1),rt.removeEventListener("orientationchange",this._onWindowResize,!1),rt.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),rt.removeEventListener("online",this._onWindowOnline,!1),rt.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),jl.delete(this.painter.context.gl),this._removed=!0,this.fire(new Se("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=or.frame(t=>{const r=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,r&&this._render(t)}))}_preloadTiles(e){return Le(this.style?Object.values(this.style._sourceCaches):[],(t,r)=>t._preloadTiles(e,r),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===rt.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(e,t){W=e,nt=t}get version(){return zt}},NavigationControl:class{constructor(e){this.options=pe({},GS,e),this._container=Hn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(hn(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Hn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Hn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(hn(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const r=this._map;r&&(this.options.visualizePitch?r.resetNorthPitch({},{originalEvent:t}):r.resetNorth({},{originalEvent:t}))}),this._compassIcon=Hn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),r=t===e.getMaxZoom(),s=t===e.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new sb(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const r=Hn("button",e,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(e,t){if(!this._map)return;const r=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",r),e.firstElementChild&&e.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends Qn{constructor(e){super(),this.options=pe({geolocation:rt.navigator.geolocation},YA,e),hn(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=MA(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=Hn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){const t=(r=!!this.options.geolocation)=>{this._supportsGeolocation=r,e(r)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==rt.navigator.permissions?rt.navigator.permissions.query({name:"geolocation"}).then(r=>t("denied"!==r.state)).catch(()=>t()):t()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),r=e.coords;return!!t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new Se("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new Se("geolocate",e)),this._finish()}}_updateCamera(e){const t=new pr(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,s=pe({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(r),s,{geolocateSource:!0})}_updateMarker(e){if(e){const t=new pr(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map.transform,t=ji(1,e._center.lat)*e.worldSize,r=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new Se("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Hn("button","mapboxgl-ctrl-geolocate",this._container),Hn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){Gt("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Hn("div","mapboxgl-user-location"),this._dotElement.appendChild(Hn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Hn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ob({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Hn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ob({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new Se("trackuserlocationend")))})}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return Gt("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Se("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new Se("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Se("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{rt.addEventListener("ondeviceorientationabsolute"in rt?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==rt.DeviceMotionEvent&&"function"==typeof rt.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&e()}).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),rt.removeEventListener("deviceorientation",this._onDeviceOrientation),rt.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:g0,ScaleControl:class{constructor(e){this.options=pe({},JA,e),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),hn(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,s=t._containerWidth/2-e/2,a=t.unproject([s,r]),u=t.unproject([s+e,r]),c=a.distanceTo(u);if("imperial"===this.options.unit){const p=3.2808*c;p>5280?this._setScale(e,p/5280,"mile"):this._setScale(e,p,"foot")}else"nautical"===this.options.unit?this._setScale(e,c/1852,"nautical-mile"):c>=1e3?this._setScale(e,c/1e3,"kilometer"):this._setScale(e,c,"meter")}_setScale(e,t,r){this._map._requestDomTask(()=>{const s=function(u){const c=Math.pow(10,`${Math.floor(u)}`.length-1);let p=u/c;return p=p>=10?10:p>=5?5:p>=3?3:p>=2?2:p>=1?1:function(g){const y=Math.pow(10,Math.ceil(-Math.log(g)/Math.LN10));return Math.round(g*y)/y}(p),c*p}(t),a=s/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==r?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(s):`${s}&nbsp;${qS[r]}`,this._container.style.width=e*a+"px"})}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=Hn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof rt.HTMLElement?this._container=e.container:Gt("Full screen control 'container' must be a DOM element.")),hn(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in rt.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in rt.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=Hn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",Gt("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,rt.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!rt.document.fullscreenEnabled&&!rt.document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=Hn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Hn("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),rt.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(rt.document.fullscreenElement||rt.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?rt.document.exitFullscreen?rt.document.exitFullscreen():rt.document.webkitCancelFullScreen&&rt.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends Qn{constructor(e){super(),this.options=pe(Object.create($A),e),hn(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new Se("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new Se("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=pr.convert(e),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(rt.document.createTextNode(e))}setHTML(e){const t=rt.document.createDocumentFragment(),r=rt.document.createElement("body");let s;for(r.innerHTML=e;s=r.firstChild,s;)t.appendChild(s);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Hn("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const r=this._closeButton=Hn("button","mapboxgl-popup-close-button",t);r.type="button",r.setAttribute("aria-label","Close popup"),r.setAttribute("aria-hidden","true"),r.innerHTML="&#215;",r.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,r=this._container,s=this._pos;if(!t||!r||!s)return"bottom";const a=r.offsetWidth,u=r.offsetHeight,c=s.x<a/2,p=s.x>t.transform.width-a/2;if(s.y+e<u)return c?"top-left":p?"top-right":"top";if(s.y>t.transform.height-u){if(c)return"bottom-left";if(p)return"bottom-right"}return c?"left":p?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(e){const t=this._map,r=this._content;if(!t||!this._lngLat&&!this._trackPointer||!r)return;let s=this._container;if(s||(s=this._container=Hn("div","mapboxgl-popup",t.getContainer()),this._tip=Hn("div","mapboxgl-popup-tip",s),s.appendChild(r)),this.options.maxWidth&&s.style.maxWidth!==this.options.maxWidth&&(s.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=jS(this._lngLat,this._pos,t.transform)),!this._trackPointer||e){const a=this._pos=this._trackPointer&&e?e:t.project(this._lngLat),u=VS(this.options.offset),c=this._anchor=this._getAnchor(u.y),p=VS(this.options.offset,c),g=a.add(p).round();t._requestDomTask(()=>{this._container&&c&&(this._container.style.transform=`${ib[c]} translate(${g.x}px,${g.y}px)`)})}if(!this._marker&&t._showingGlobe()){const a=Lv(t.transform,this._lngLat)?0:1;this._setOpacity(a)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(HA);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:ob,Style:Uc,LngLat:pr,LngLatBounds:$a,Point:H,MercatorCoordinate:ri,FreeCameraOptions:LI,Evented:Qn,config:Yt,prewarm:function(){Hh().acquire(ux)},clearPrewarmedResources:function(){const e=Ug;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(ux),Ug=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return Yt.ACCESS_TOKEN},set accessToken(e){Yt.ACCESS_TOKEN=e},get baseApiUrl(){return Yt.API_URL},set baseApiUrl(e){Yt.API_URL=e},get workerCount(){return nm.workerCount},set workerCount(e){nm.workerCount=e},get maxParallelImageRequests(){return Yt.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){Yt.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){!function(t){if(!Xt())return;const r=rt.caches.delete(fe);t&&r.catch(t).then(()=>t())}(e)},workerUrl:"",workerClass:null,get dracoUrl(){return hx()},set dracoUrl(e){cx=or.resolveURL(e),rm||(rm=new kg(Hh(),new Qn)),rm.broadcast("setDracoUrl",cx)},setNow:or.setNow,restoreNow:or.restoreNow};Pt.A=v2,Pt.D=wf,Pt.E=$t,Pt.F=my,Pt.K=Qy,Pt.O=si,Pt.P=H,Pt.T=GI,Pt.V=r1,Pt.a=wp,Pt.b=o1,Pt.c=qy,Pt.d=class extends Qn{constructor(e,t,r,s,a,u){super(),this.actor=e,this.layerIndex=t,this.availableImages=r,this.loadVectorData=a||ax,this.loading={},this.loaded={},this.deduped=new xC(e.scheduler),this.isSpriteLoaded=s,this.scheduler=e.scheduler,this.brightness=u}loadTile(e,t){const r=e.uid,s=e&&e.request,a=s&&s.collectResourceTiming,u=this.loading[r]=new vC(e);u.abort=this.loadVectorData(e,(c,p)=>{const g=!this.loading[r];if(delete this.loading[r],g||c||!p)return u.status="done",g||(this.loaded[r]=u),t(c);const y=p.rawData,x={};p.expires&&(x.expires=p.expires),p.cacheControl&&(x.cacheControl=p.cacheControl),u.vectorTile=p.vectorTile||new n1(new dy(y));const E=()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(S,M)=>{if(S||!M)return t(S);const D={};if(a){const P=Ml(s);P.length>0&&(D.resourceTiming=JSON.parse(JSON.stringify(P)))}t(null,pe({rawTileData:y.slice(0)},M,x,D))})};this.isSpriteLoaded?E():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(E,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):E()}),this.loaded=this.loaded||{},this.loaded[r]=u})}reloadTile(e,t){const r=this.loaded,s=e.uid,a=this;if(r&&r[s]){const u=r[s];u.showCollisionBoxes=e.showCollisionBoxes,u.projection=e.projection,u.brightness=e.brightness,u.tileTransform=xd(e.tileID.canonical,e.projection),u.extraShadowCaster=e.extraShadowCaster;const c=(p,g)=>{const y=u.reloadCallback;y&&(delete u.reloadCallback,u.parse(u.vectorTile,a.layerIndex,this.availableImages,a.actor,y)),t(p,g)};"parsing"===u.status?u.reloadCallback=c:"done"===u.status&&(u.vectorTile?u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,c):c())}else t(null,void 0)}abortTile(e,t){const r=e.uid,s=this.loading[r];s&&(s.abort&&s.abort(),delete this.loading[r]),t()}removeTile(e,t){const r=this.loaded,s=e.uid;r&&r[s]&&delete r[s],t()}},Pt.e=Mh,Pt.f=Ml,Pt.g=mt,Pt.h=ye,Pt.i=je,Pt.j=function(e,t){const r=zd(e);for(const s of r){for(const a of s.meshes)T2(a);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(D2(s.lights,t)))}return r},Pt.k=ss,Pt.l=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==px){const r=new Uint32Array(e,0,7),[,,s,a,u,c]=r;t=r.byteLength+a+u+c+u,(s!==e.byteLength||t>=e.byteLength)&&Gt("Invalid b3dm header information.")}return EC(e,t)},Pt.m=Sy,Pt.n=La,Pt.o=Se,Pt.p=kt,Pt.q=function(e){Ue(),Dt&&Dt.then(t=>{t.keys().then(r=>{for(let s=0;s<r.length-e;s++)t.delete(r[s])})})},Pt.r=om,Pt.s=Qg,Pt.t=sg,Pt.v=Pe,Pt.w=rt}),Rt(0,function(Pt){function rt(Te){if("number"==typeof Te||"boolean"==typeof Te||"string"==typeof Te||null==Te)return JSON.stringify(Te);if(Array.isArray(Te)){let vt="[";for(const Gt of Te)vt+=`${rt(Gt)},`;return`${vt}]`}let st="{";for(const vt of Object.keys(Te).sort())st+=`${vt}:${rt(Te[vt])},`;return`${st}}`}function zt(Te){let st="";for(const vt of Pt.r)st+=`/${rt(Te[vt])}`;return st}class ie{constructor(st){this.keyCache={},this._layers={},this._layerConfigs={},st&&this.replace(st)}replace(st,vt){this._layerConfigs={},this._layers={},this.update(st,[],vt)}update(st,vt,Gt){this._options=Gt;for(const sn of st){this._layerConfigs[sn.id]=sn;const We=this._layers[sn.id]=Pt.c(sn,this._options);We.setScope(this.scope),We.compileFilter(),this.keyCache[sn.id]&&delete this.keyCache[sn.id]}for(const sn of vt)delete this.keyCache[sn],delete this._layerConfigs[sn],delete this._layers[sn];this.familiesBySource={};const Ve=function(sn,We){const gn={};for(let Rn=0;Rn<sn.length;Rn++){const jn=We&&We[sn[Rn].id]||zt(sn[Rn]);We&&(We[sn[Rn].id]=jn);let Sn=gn[jn];Sn||(Sn=gn[jn]=[]),Sn.push(sn[Rn])}const rn=[];for(const Rn in gn)rn.push(gn[Rn]);return rn}(Pt.v(this._layerConfigs),this.keyCache);for(const sn of Ve){const We=sn.map(mn=>this._layers[mn.id]),gn=We[0];if("none"===gn.visibility)continue;const rn=gn.source||"";let Rn=this.familiesBySource[rn];Rn||(Rn=this.familiesBySource[rn]={});const jn=gn.sourceLayer||"_geojsonTileLayer";let Sn=Rn[jn];Sn||(Sn=Rn[jn]=[]),Sn.push(We)}}}class Yt{loadTile(st,vt){const{uid:Gt,encoding:Ve,rawImageData:sn,padding:We}=st,gn=Pt.w.ImageBitmap&&sn instanceof Pt.w.ImageBitmap?this.getImageData(sn,We):sn;vt(null,new Pt.D(Gt,gn,Ve,We<1))}getImageData(st,vt){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(st.width,st.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=st.width,this.offscreenCanvas.height=st.height,this.offscreenCanvasContext.drawImage(st,0,0,st.width,st.height);const Gt=this.offscreenCanvasContext.getImageData(-vt,-vt,st.width+2*vt,st.height+2*vt);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Gt}}function Me(Te,st){if(0!==Te.length){Be(Te[0],st);for(var vt=1;vt<Te.length;vt++)Be(Te[vt],!st)}}function Be(Te,st){for(var vt=0,Gt=0,Ve=0,sn=Te.length,We=sn-1;Ve<sn;We=Ve++){var gn=(Te[Ve][0]-Te[We][0])*(Te[We][1]+Te[Ve][1]),rn=vt+gn;Gt+=Math.abs(vt)>=Math.abs(gn)?vt-rn+gn:gn-rn+vt,vt=rn}vt+Gt>=0!=!!st&&Te.reverse()}var Ce=Pt.g(function Te(st,vt){var Gt,Ve=st&&st.type;if("FeatureCollection"===Ve)for(Gt=0;Gt<st.features.length;Gt++)Te(st.features[Gt],vt);else if("GeometryCollection"===Ve)for(Gt=0;Gt<st.geometries.length;Gt++)Te(st.geometries[Gt],vt);else if("Feature"===Ve)Te(st.geometry,vt);else if("Polygon"===Ve)Me(st.coordinates,vt);else if("MultiPolygon"===Ve)for(Gt=0;Gt<st.coordinates.length;Gt++)Me(st.coordinates[Gt],vt);return st});const ee=Pt.V.prototype.toGeoJSON;var _e={exports:{}},an=Pt.p,pt=Pt.a.VectorTileFeature,mt=ot;function ot(Te,st){this.options=st||{},this.features=Te,this.length=Te.length}function gt(Te,st){this.id="number"==typeof Te.id?Te.id:void 0,this.type=Te.type,this.rawGeometry=1===Te.type?[Te.geometry]:Te.geometry,this.properties=Te.tags,this.extent=st||4096}ot.prototype.feature=function(Te){return new gt(this.features[Te],this.options.extent)},gt.prototype.loadGeometry=function(){var Te=this.rawGeometry;this.geometry=[];for(var st=0;st<Te.length;st++){for(var vt=Te[st],Gt=[],Ve=0;Ve<vt.length;Ve++)Gt.push(new an(vt[Ve][0],vt[Ve][1]));this.geometry.push(Gt)}return this.geometry},gt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Te=this.geometry,st=1/0,vt=-1/0,Gt=1/0,Ve=-1/0,sn=0;sn<Te.length;sn++)for(var We=Te[sn],gn=0;gn<We.length;gn++){var rn=We[gn];st=Math.min(st,rn.x),vt=Math.max(vt,rn.x),Gt=Math.min(Gt,rn.y),Ve=Math.max(Ve,rn.y)}return[st,Gt,vt,Ve]},gt.prototype.toGeoJSON=pt.prototype.toGeoJSON;var ct=Pt.b,kt=mt;function ut(Te){var st=new ct;return function(vt,Gt){for(var Ve in vt.layers)Gt.writeMessage(3,H,vt.layers[Ve])}(Te,st),st.finish()}function H(Te,st){var vt;st.writeVarintField(15,Te.version||1),st.writeStringField(1,Te.name||""),st.writeVarintField(5,Te.extent||4096);var Gt={keys:[],values:[],keycache:{},valuecache:{}};for(vt=0;vt<Te.length;vt++)Gt.feature=Te.feature(vt),st.writeMessage(2,ht,Gt);var Ve=Gt.keys;for(vt=0;vt<Ve.length;vt++)st.writeStringField(3,Ve[vt]);var sn=Gt.values;for(vt=0;vt<sn.length;vt++)st.writeMessage(4,Et,sn[vt])}function ht(Te,st){var vt=Te.feature;void 0!==vt.id&&st.writeVarintField(1,vt.id),st.writeMessage(2,J,Te),st.writeVarintField(3,vt.type),st.writeMessage(4,Ht,vt)}function J(Te,st){var vt=Te.feature,Gt=Te.keys,Ve=Te.values,sn=Te.keycache,We=Te.valuecache;for(var gn in vt.properties){var rn=vt.properties[gn],Rn=sn[gn];if(null!==rn){void 0===Rn&&(Gt.push(gn),sn[gn]=Rn=Gt.length-1),st.writeVarint(Rn);var jn=typeof rn;"string"!==jn&&"boolean"!==jn&&"number"!==jn&&(rn=JSON.stringify(rn));var Sn=jn+":"+rn,mn=We[Sn];void 0===mn&&(Ve.push(rn),We[Sn]=mn=Ve.length-1),st.writeVarint(mn)}}}function ue(Te,st){return(st<<3)+(7&Te)}function St(Te){return Te<<1^Te>>31}function Ht(Te,st){for(var vt=Te.loadGeometry(),Gt=Te.type,Ve=0,sn=0,We=vt.length,gn=0;gn<We;gn++){var rn=vt[gn],Rn=1;1===Gt&&(Rn=rn.length),st.writeVarint(ue(1,Rn));for(var jn=3===Gt?rn.length-1:rn.length,Sn=0;Sn<jn;Sn++){1===Sn&&1!==Gt&&st.writeVarint(ue(2,jn-1));var mn=rn[Sn].x-Ve,Ni=rn[Sn].y-sn;st.writeVarint(St(mn)),st.writeVarint(St(Ni)),Ve+=mn,sn+=Ni}3===Gt&&st.writeVarint(ue(7,1))}}function Et(Te,st){var vt=typeof Te;"string"===vt?st.writeStringField(1,Te):"boolean"===vt?st.writeBooleanField(7,Te):"number"===vt&&(Te%1!=0?st.writeDoubleField(3,Te):Te<0?st.writeSVarintField(6,Te):st.writeVarintField(5,Te))}_e.exports=ut,_e.exports.fromVectorTileJs=ut,_e.exports.fromGeojsonVt=function(Te,st){st=st||{};var vt={};for(var Gt in Te)vt[Gt]=new kt(Te[Gt].features,st),vt[Gt].name=Gt,vt[Gt].version=st.version,vt[Gt].extent=st.extent;return ut({layers:vt})},_e.exports.GeoJSONWrapper=kt;var cn=Pt.g(_e.exports);const en={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Te=>Te},Ft=Math.fround||(de=new Float32Array(1),Te=>(de[0]=+Te,de[0]));var de;const Vt=3,At=5,ne=6;class wt{constructor(st){this.options=Object.assign(Object.create(en),st),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(st){const{log:vt,minZoom:Gt,maxZoom:Ve}=this.options;vt&&console.time("total time");const sn=`prepare ${st.length} points`;vt&&console.time(sn),this.points=st;const We=[];for(let rn=0;rn<st.length;rn++){const Rn=st[rn];if(!Rn.geometry)continue;const[jn,Sn]=Rn.geometry.coordinates,mn=Ft(pe(jn)),Ni=Ft(Fe(Sn));We.push(mn,Ni,1/0,rn,-1,1),this.options.reduce&&We.push(0)}let gn=this.trees[Ve+1]=this._createTree(We);vt&&console.timeEnd(sn);for(let rn=Ve;rn>=Gt;rn--){const Rn=+Date.now();gn=this.trees[rn]=this._createTree(this._cluster(gn,rn)),vt&&console.log("z%d: %d clusters in %dms",rn,gn.numItems,+Date.now()-Rn)}return vt&&console.timeEnd("total time"),this}getClusters(st,vt){let Gt=((st[0]+180)%360+360)%360-180;const Ve=Math.max(-90,Math.min(90,st[1]));let sn=180===st[2]?180:((st[2]+180)%360+360)%360-180;const We=Math.max(-90,Math.min(90,st[3]));if(st[2]-st[0]>=360)Gt=-180,sn=180;else if(Gt>sn){const Sn=this.getClusters([Gt,Ve,180,We],vt),mn=this.getClusters([-180,Ve,sn,We],vt);return Sn.concat(mn)}const gn=this.trees[this._limitZoom(vt)],rn=gn.range(pe(Gt),Fe(We),pe(sn),Fe(Ve)),Rn=gn.data,jn=[];for(const Sn of rn){const mn=this.stride*Sn;jn.push(Rn[mn+At]>1?Le(Rn,mn,this.clusterProps):this.points[Rn[mn+Vt]])}return jn}getChildren(st){const vt=this._getOriginId(st),Gt=this._getOriginZoom(st),Ve="No cluster with the specified id.",sn=this.trees[Gt];if(!sn)throw new Error(Ve);const We=sn.data;if(vt*this.stride>=We.length)throw new Error(Ve);const gn=this.options.radius/(this.options.extent*Math.pow(2,Gt-1)),rn=sn.within(We[vt*this.stride],We[vt*this.stride+1],gn),Rn=[];for(const jn of rn){const Sn=jn*this.stride;We[Sn+4]===st&&Rn.push(We[Sn+At]>1?Le(We,Sn,this.clusterProps):this.points[We[Sn+Vt]])}if(0===Rn.length)throw new Error(Ve);return Rn}getLeaves(st,vt,Gt){const Ve=[];return this._appendLeaves(Ve,st,vt=vt||10,Gt=Gt||0,0),Ve}getTile(st,vt,Gt){const Ve=this.trees[this._limitZoom(st)],sn=Math.pow(2,st),{extent:We,radius:gn}=this.options,rn=gn/We,Rn=(Gt-rn)/sn,jn=(Gt+1+rn)/sn,Sn={features:[]};return this._addTileFeatures(Ve.range((vt-rn)/sn,Rn,(vt+1+rn)/sn,jn),Ve.data,vt,Gt,sn,Sn),0===vt&&this._addTileFeatures(Ve.range(1-rn/sn,Rn,1,jn),Ve.data,sn,Gt,sn,Sn),vt===sn-1&&this._addTileFeatures(Ve.range(0,Rn,rn/sn,jn),Ve.data,-1,Gt,sn,Sn),Sn.features.length?Sn:null}getClusterExpansionZoom(st){let vt=this._getOriginZoom(st)-1;for(;vt<=this.options.maxZoom;){const Gt=this.getChildren(st);if(vt++,1!==Gt.length)break;st=Gt[0].properties.cluster_id}return vt}_appendLeaves(st,vt,Gt,Ve,sn){const We=this.getChildren(vt);for(const gn of We){const rn=gn.properties;if(rn&&rn.cluster?sn+rn.point_count<=Ve?sn+=rn.point_count:sn=this._appendLeaves(st,rn.cluster_id,Gt,Ve,sn):sn<Ve?sn++:st.push(gn),st.length===Gt)break}return sn}_createTree(st){const vt=new Pt.K(st.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Gt=0;Gt<st.length;Gt+=this.stride)vt.add(st[Gt],st[Gt+1]);return vt.finish(),vt.data=st,vt}_addTileFeatures(st,vt,Gt,Ve,sn,We){for(const gn of st){const rn=gn*this.stride,Rn=vt[rn+At]>1;let jn,Sn,mn;if(Rn)jn=Pe(vt,rn,this.clusterProps),Sn=vt[rn],mn=vt[rn+1];else{const Nn=this.points[vt[rn+Vt]];jn=Nn.properties;const[Hr,fe]=Nn.geometry.coordinates;Sn=pe(Hr),mn=Fe(fe)}const Ni={type:1,geometry:[[Math.round(this.options.extent*(Sn*sn-Gt)),Math.round(this.options.extent*(mn*sn-Ve))]],tags:jn};let Zi;Zi=Rn||this.options.generateId?vt[rn+Vt]:this.points[vt[rn+Vt]].id,void 0!==Zi&&(Ni.id=Zi),We.features.push(Ni)}}_limitZoom(st){return Math.max(this.options.minZoom,Math.min(Math.floor(+st),this.options.maxZoom+1))}_cluster(st,vt){const{radius:Gt,extent:Ve,reduce:sn,minPoints:We}=this.options,gn=Gt/(Ve*Math.pow(2,vt)),rn=st.data,Rn=[],jn=this.stride;for(let Sn=0;Sn<rn.length;Sn+=jn){if(rn[Sn+2]<=vt)continue;rn[Sn+2]=vt;const mn=rn[Sn],Ni=rn[Sn+1],Zi=st.within(rn[Sn],rn[Sn+1],gn),Nn=rn[Sn+At];let Hr=Nn;for(const fe of Zi){const W=fe*jn;rn[W+2]>vt&&(Hr+=rn[W+At])}if(Hr>Nn&&Hr>=We){let fe,W=mn*Nn,nt=Ni*Nn,Dt=-1;const Jt=((Sn/jn|0)<<5)+(vt+1)+this.points.length;for(const Xt of Zi){const Ue=Xt*jn;if(rn[Ue+2]<=vt)continue;rn[Ue+2]=vt;const ke=rn[Ue+At];W+=rn[Ue]*ke,nt+=rn[Ue+1]*ke,rn[Ue+4]=Jt,sn&&(fe||(fe=this._map(rn,Sn,!0),Dt=this.clusterProps.length,this.clusterProps.push(fe)),sn(fe,this._map(rn,Ue)))}rn[Sn+4]=Jt,Rn.push(W/Hr,nt/Hr,1/0,Jt,-1,Hr),sn&&Rn.push(Dt)}else{for(let fe=0;fe<jn;fe++)Rn.push(rn[Sn+fe]);if(Hr>1)for(const fe of Zi){const W=fe*jn;if(!(rn[W+2]<=vt)){rn[W+2]=vt;for(let nt=0;nt<jn;nt++)Rn.push(rn[W+nt])}}}}return Rn}_getOriginId(st){return st-this.points.length>>5}_getOriginZoom(st){return(st-this.points.length)%32}_map(st,vt,Gt){if(st[vt+At]>1){const We=this.clusterProps[st[vt+ne]];return Gt?Object.assign({},We):We}const Ve=this.points[st[vt+Vt]].properties,sn=this.options.map(Ve);return Gt&&sn===Ve?Object.assign({},sn):sn}}function Le(Te,st,vt){return{type:"Feature",id:Te[st+Vt],properties:Pe(Te,st,vt),geometry:{type:"Point",coordinates:[(Gt=Te[st],360*(Gt-.5)),Ln(Te[st+1])]}};var Gt}function Pe(Te,st,vt){const Gt=Te[st+At],Ve=Gt>=1e4?`${Math.round(Gt/1e3)}k`:Gt>=1e3?Math.round(Gt/100)/10+"k":Gt,sn=Te[st+ne],We=-1===sn?{}:Object.assign({},vt[sn]);return Object.assign(We,{cluster:!0,cluster_id:Te[st+Vt],point_count:Gt,point_count_abbreviated:Ve})}function pe(Te){return Te/360+.5}function Fe(Te){const st=Math.sin(Te*Math.PI/180),vt=.5-.25*Math.log((1+st)/(1-st))/Math.PI;return vt<0?0:vt>1?1:vt}function Ln(Te){const st=(180-360*Te)*Math.PI/180;return 360*Math.atan(Math.exp(st))/Math.PI-90}var On={exports:{}};On.exports=function(){function Te(Kt,lt,se,ve){for(var ye,je=ve,tn=se-lt>>1,Ge=se-lt,dn=Kt[lt],fn=Kt[lt+1],Tn=Kt[se],Ir=Kt[se+1],En=lt+3;En<se;En+=3){var gr=st(Kt[En],Kt[En+1],dn,fn,Tn,Ir);if(gr>je)ye=En,je=gr;else if(gr===je){var mr=Math.abs(En-tn);mr<Ge&&(ye=En,Ge=mr)}}je>ve&&(ye-lt>3&&Te(Kt,lt,ye,ve),Kt[ye+2]=je,se-ye>3&&Te(Kt,ye,se,ve))}function st(Kt,lt,se,ve,ye,je){var tn=ye-se,Ge=je-ve;if(0!==tn||0!==Ge){var dn=((Kt-se)*tn+(lt-ve)*Ge)/(tn*tn+Ge*Ge);dn>1?(se=ye,ve=je):dn>0&&(se+=tn*dn,ve+=Ge*dn)}return(tn=Kt-se)*tn+(Ge=lt-ve)*Ge}function vt(Kt,lt,se,ve){var ye={id:void 0===Kt?null:Kt,type:lt,geometry:se,tags:ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(je){var tn=je.geometry,Ge=je.type;if("Point"===Ge||"MultiPoint"===Ge||"LineString"===Ge)Gt(je,tn);else if("Polygon"===Ge||"MultiLineString"===Ge)for(var dn=0;dn<tn.length;dn++)Gt(je,tn[dn]);else if("MultiPolygon"===Ge)for(dn=0;dn<tn.length;dn++)for(var fn=0;fn<tn[dn].length;fn++)Gt(je,tn[dn][fn])}(ye),ye}function Gt(Kt,lt){for(var se=0;se<lt.length;se+=3)Kt.minX=Math.min(Kt.minX,lt[se]),Kt.minY=Math.min(Kt.minY,lt[se+1]),Kt.maxX=Math.max(Kt.maxX,lt[se]),Kt.maxY=Math.max(Kt.maxY,lt[se+1])}function Ve(Kt,lt,se,ve){if(lt.geometry){var ye=lt.geometry.coordinates,je=lt.geometry.type,tn=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2),Ge=[],dn=lt.id;if(se.promoteId?dn=lt.properties[se.promoteId]:se.generateId&&(dn=ve||0),"Point"===je)sn(ye,Ge);else if("MultiPoint"===je)for(var fn=0;fn<ye.length;fn++)sn(ye[fn],Ge);else if("LineString"===je)We(ye,Ge,tn,!1);else if("MultiLineString"===je){if(se.lineMetrics){for(fn=0;fn<ye.length;fn++)We(ye[fn],Ge=[],tn,!1),Kt.push(vt(dn,"LineString",Ge,lt.properties));return}gn(ye,Ge,tn,!1)}else if("Polygon"===je)gn(ye,Ge,tn,!0);else{if("MultiPolygon"!==je){if("GeometryCollection"===je){for(fn=0;fn<lt.geometry.geometries.length;fn++)Ve(Kt,{id:dn,geometry:lt.geometry.geometries[fn],properties:lt.properties},se,ve);return}throw new Error("Input data is not a valid GeoJSON object.")}for(fn=0;fn<ye.length;fn++){var Tn=[];gn(ye[fn],Tn,tn,!0),Ge.push(Tn)}}Kt.push(vt(dn,je,Ge,lt.properties))}}function sn(Kt,lt){lt.push(rn(Kt[0])),lt.push(Rn(Kt[1])),lt.push(0)}function We(Kt,lt,se,ve){for(var ye,je,tn=0,Ge=0;Ge<Kt.length;Ge++){var dn=rn(Kt[Ge][0]),fn=Rn(Kt[Ge][1]);lt.push(dn),lt.push(fn),lt.push(0),Ge>0&&(tn+=ve?(ye*fn-dn*je)/2:Math.sqrt(Math.pow(dn-ye,2)+Math.pow(fn-je,2))),ye=dn,je=fn}var Tn=lt.length-3;lt[2]=1,Te(lt,0,Tn,se),lt[Tn+2]=1,lt.size=Math.abs(tn),lt.start=0,lt.end=lt.size}function gn(Kt,lt,se,ve){for(var ye=0;ye<Kt.length;ye++){var je=[];We(Kt[ye],je,se,ve),lt.push(je)}}function rn(Kt){return Kt/360+.5}function Rn(Kt){var lt=Math.sin(Kt*Math.PI/180),se=.5-.25*Math.log((1+lt)/(1-lt))/Math.PI;return se<0?0:se>1?1:se}function jn(Kt,lt,se,ve,ye,je,tn,Ge){if(ve/=lt,je>=(se/=lt)&&tn<ve)return Kt;if(tn<se||je>=ve)return null;for(var dn=[],fn=0;fn<Kt.length;fn++){var Tn=Kt[fn],Ir=Tn.geometry,En=Tn.type,gr=0===ye?Tn.minX:Tn.minY,mr=0===ye?Tn.maxX:Tn.maxY;if(gr>=se&&mr<ve)dn.push(Tn);else if(!(mr<se||gr>=ve)){var ei=[];if("Point"===En||"MultiPoint"===En)Sn(Ir,ei,se,ve,ye);else if("LineString"===En)mn(Ir,ei,se,ve,ye,!1,Ge.lineMetrics);else if("MultiLineString"===En)Zi(Ir,ei,se,ve,ye,!1);else if("Polygon"===En)Zi(Ir,ei,se,ve,ye,!0);else if("MultiPolygon"===En)for(var Kn=0;Kn<Ir.length;Kn++){var li=[];Zi(Ir[Kn],li,se,ve,ye,!0),li.length&&ei.push(li)}if(ei.length){if(Ge.lineMetrics&&"LineString"===En){for(Kn=0;Kn<ei.length;Kn++)dn.push(vt(Tn.id,En,ei[Kn],Tn.tags));continue}"LineString"!==En&&"MultiLineString"!==En||(1===ei.length?(En="LineString",ei=ei[0]):En="MultiLineString"),"Point"!==En&&"MultiPoint"!==En||(En=3===ei.length?"Point":"MultiPoint"),dn.push(vt(Tn.id,En,ei,Tn.tags))}}}return dn.length?dn:null}function Sn(Kt,lt,se,ve,ye){for(var je=0;je<Kt.length;je+=3){var tn=Kt[je+ye];tn>=se&&tn<=ve&&(lt.push(Kt[je]),lt.push(Kt[je+1]),lt.push(Kt[je+2]))}}function mn(Kt,lt,se,ve,ye,je,tn){for(var Ge,dn,fn=Ni(Kt),Tn=0===ye?Hr:fe,Ir=Kt.start,En=0;En<Kt.length-3;En+=3){var gr=Kt[En],mr=Kt[En+1],ei=Kt[En+2],Kn=Kt[En+3],li=Kt[En+4],Vi=0===ye?gr:mr,ui=0===ye?Kn:li,Rr=!1;tn&&(Ge=Math.sqrt(Math.pow(gr-Kn,2)+Math.pow(mr-li,2))),Vi<se?ui>se&&(dn=Tn(fn,gr,mr,Kn,li,se),tn&&(fn.start=Ir+Ge*dn)):Vi>ve?ui<ve&&(dn=Tn(fn,gr,mr,Kn,li,ve),tn&&(fn.start=Ir+Ge*dn)):Nn(fn,gr,mr,ei),ui<se&&Vi>=se&&(dn=Tn(fn,gr,mr,Kn,li,se),Rr=!0),ui>ve&&Vi<=ve&&(dn=Tn(fn,gr,mr,Kn,li,ve),Rr=!0),!je&&Rr&&(tn&&(fn.end=Ir+Ge*dn),lt.push(fn),fn=Ni(Kt)),tn&&(Ir+=Ge)}var ls=Kt.length-3;gr=Kt[ls],mr=Kt[ls+1],ei=Kt[ls+2],(Vi=0===ye?gr:mr)>=se&&Vi<=ve&&Nn(fn,gr,mr,ei),ls=fn.length-3,je&&ls>=3&&(fn[ls]!==fn[0]||fn[ls+1]!==fn[1])&&Nn(fn,fn[0],fn[1],fn[2]),fn.length&&lt.push(fn)}function Ni(Kt){var lt=[];return lt.size=Kt.size,lt.start=Kt.start,lt.end=Kt.end,lt}function Zi(Kt,lt,se,ve,ye,je){for(var tn=0;tn<Kt.length;tn++)mn(Kt[tn],lt,se,ve,ye,je,!1)}function Nn(Kt,lt,se,ve){Kt.push(lt),Kt.push(se),Kt.push(ve)}function Hr(Kt,lt,se,ve,ye,je){var tn=(je-lt)/(ve-lt);return Kt.push(je),Kt.push(se+(ye-se)*tn),Kt.push(1),tn}function fe(Kt,lt,se,ve,ye,je){var tn=(je-se)/(ye-se);return Kt.push(lt+(ve-lt)*tn),Kt.push(je),Kt.push(1),tn}function W(Kt,lt){for(var se=[],ve=0;ve<Kt.length;ve++){var ye,je=Kt[ve],tn=je.type;if("Point"===tn||"MultiPoint"===tn||"LineString"===tn)ye=nt(je.geometry,lt);else if("MultiLineString"===tn||"Polygon"===tn){ye=[];for(var Ge=0;Ge<je.geometry.length;Ge++)ye.push(nt(je.geometry[Ge],lt))}else if("MultiPolygon"===tn)for(ye=[],Ge=0;Ge<je.geometry.length;Ge++){for(var dn=[],fn=0;fn<je.geometry[Ge].length;fn++)dn.push(nt(je.geometry[Ge][fn],lt));ye.push(dn)}se.push(vt(je.id,tn,ye,je.tags))}return se}function nt(Kt,lt){var se=[];se.size=Kt.size,void 0!==Kt.start&&(se.start=Kt.start,se.end=Kt.end);for(var ve=0;ve<Kt.length;ve+=3)se.push(Kt[ve]+lt,Kt[ve+1],Kt[ve+2]);return se}function Dt(Kt,lt){if(Kt.transformed)return Kt;var se,ve,ye,je=1<<Kt.z,tn=Kt.x,Ge=Kt.y;for(se=0;se<Kt.features.length;se++){var dn=Kt.features[se],fn=dn.geometry,Tn=dn.type;if(dn.geometry=[],1===Tn)for(ve=0;ve<fn.length;ve+=2)dn.geometry.push(Jt(fn[ve],fn[ve+1],lt,je,tn,Ge));else for(ve=0;ve<fn.length;ve++){var Ir=[];for(ye=0;ye<fn[ve].length;ye+=2)Ir.push(Jt(fn[ve][ye],fn[ve][ye+1],lt,je,tn,Ge));dn.geometry.push(Ir)}}return Kt.transformed=!0,Kt}function Jt(Kt,lt,se,ve,ye,je){return[Math.round(se*(Kt*ve-ye)),Math.round(se*(lt*ve-je))]}function Xt(Kt,lt,se,ve,ye){for(var je=lt===ye.maxZoom?0:ye.tolerance/((1<<lt)*ye.extent),tn={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:se,y:ve,z:lt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ge=0;Ge<Kt.length;Ge++){tn.numFeatures++,Ue(tn,Kt[Ge],je,ye);var dn=Kt[Ge].minX,fn=Kt[Ge].minY,Tn=Kt[Ge].maxX,Ir=Kt[Ge].maxY;dn<tn.minX&&(tn.minX=dn),fn<tn.minY&&(tn.minY=fn),Tn>tn.maxX&&(tn.maxX=Tn),Ir>tn.maxY&&(tn.maxY=Ir)}return tn}function Ue(Kt,lt,se,ve){var ye=lt.geometry,je=lt.type,tn=[];if("Point"===je||"MultiPoint"===je)for(var Ge=0;Ge<ye.length;Ge+=3)tn.push(ye[Ge]),tn.push(ye[Ge+1]),Kt.numPoints++,Kt.numSimplified++;else if("LineString"===je)ke(tn,ye,Kt,se,!1,!1);else if("MultiLineString"===je||"Polygon"===je)for(Ge=0;Ge<ye.length;Ge++)ke(tn,ye[Ge],Kt,se,"Polygon"===je,0===Ge);else if("MultiPolygon"===je)for(var dn=0;dn<ye.length;dn++){var fn=ye[dn];for(Ge=0;Ge<fn.length;Ge++)ke(tn,fn[Ge],Kt,se,!0,0===Ge)}if(tn.length){var Tn=lt.tags||null;if("LineString"===je&&ve.lineMetrics){for(var Ir in Tn={},lt.tags)Tn[Ir]=lt.tags[Ir];Tn.mapbox_clip_start=ye.start/ye.size,Tn.mapbox_clip_end=ye.end/ye.size}var En={geometry:tn,type:"Polygon"===je||"MultiPolygon"===je?3:"LineString"===je||"MultiLineString"===je?2:1,tags:Tn};null!==lt.id&&(En.id=lt.id),Kt.features.push(En)}}function ke(Kt,lt,se,ve,ye,je){var tn=ve*ve;if(ve>0&&lt.size<(ye?tn:ve))se.numPoints+=lt.length/3;else{for(var Ge=[],dn=0;dn<lt.length;dn+=3)(0===ve||lt[dn+2]>tn)&&(se.numSimplified++,Ge.push(lt[dn]),Ge.push(lt[dn+1])),se.numPoints++;ye&&function(fn,Tn){for(var Ir=0,En=0,gr=fn.length,mr=gr-2;En<gr;mr=En,En+=2)Ir+=(fn[En]-fn[mr])*(fn[En+1]+fn[mr+1]);if(Ir>0===Tn)for(En=0,gr=fn.length;En<gr/2;En+=2){var ei=fn[En],Kn=fn[En+1];fn[En]=fn[gr-2-En],fn[En+1]=fn[gr-1-En],fn[gr-2-En]=ei,fn[gr-1-En]=Kn}}(Ge,je),Kt.push(Ge)}}function Ye(Kt,lt){var se=(lt=this.options=function(ye,je){for(var tn in je)ye[tn]=je[tn];return ye}(Object.create(this.options),lt)).debug;if(se&&console.time("preprocess data"),lt.maxZoom<0||lt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(lt.promoteId&&lt.generateId)throw new Error("promoteId and generateId cannot be used together.");var ye,je,tn,Ge,dn,fn,ve=function(ye,je){var tn=[];if("FeatureCollection"===ye.type)for(var Ge=0;Ge<ye.features.length;Ge++)Ve(tn,ye.features[Ge],je,Ge);else Ve(tn,"Feature"===ye.type?ye:{geometry:ye},je);return tn}(Kt,lt);this.tiles={},this.tileCoords=[],se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",lt.indexMaxZoom,lt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ye=ve,je=lt,tn=je.buffer/je.extent,Ge=ye,dn=jn(ye,1,-1-tn,tn,0,-1,2,je),fn=jn(ye,1,1-tn,2+tn,0,-1,2,je),(dn||fn)&&(Ge=jn(ye,1,-tn,1+tn,0,-1,2,je)||[],dn&&(Ge=W(dn,1).concat(Ge)),fn&&(Ge=Ge.concat(W(fn,-1)))),ve=Ge).length&&this.splitTile(ve,0,0,0),se&&(ve.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Je(Kt,lt,se){return 32*((1<<Kt)*se+lt)+Kt}return Ye.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ye.prototype.splitTile=function(Kt,lt,se,ve,ye,je,tn){for(var Ge=[Kt,lt,se,ve],dn=this.options,fn=dn.debug;Ge.length;){ve=Ge.pop(),se=Ge.pop(),lt=Ge.pop(),Kt=Ge.pop();var Tn=1<<lt,Ir=Je(lt,se,ve),En=this.tiles[Ir];if(!En&&(fn>1&&console.time("creation"),En=this.tiles[Ir]=Xt(Kt,lt,se,ve,dn),this.tileCoords.push({z:lt,x:se,y:ve}),fn)){fn>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",lt,se,ve,En.numFeatures,En.numPoints,En.numSimplified),console.timeEnd("creation"));var gr="z"+lt;this.stats[gr]=(this.stats[gr]||0)+1,this.total++}if(En.source=Kt,ye){if(lt===dn.maxZoom||lt===ye)continue;var mr=1<<ye-lt;if(se!==Math.floor(je/mr)||ve!==Math.floor(tn/mr))continue}else if(lt===dn.indexMaxZoom||En.numPoints<=dn.indexMaxPoints)continue;if(En.source=null,0!==Kt.length){fn>1&&console.time("clipping");var ei,Kn,li,Vi,ui,Rr,ls=.5*dn.buffer/dn.extent,Xo=.5-ls,dl=.5+ls,js=1+ls;ei=Kn=li=Vi=null,ui=jn(Kt,Tn,se-ls,se+dl,0,En.minX,En.maxX,dn),Rr=jn(Kt,Tn,se+Xo,se+js,0,En.minX,En.maxX,dn),Kt=null,ui&&(ei=jn(ui,Tn,ve-ls,ve+dl,1,En.minY,En.maxY,dn),Kn=jn(ui,Tn,ve+Xo,ve+js,1,En.minY,En.maxY,dn),ui=null),Rr&&(li=jn(Rr,Tn,ve-ls,ve+dl,1,En.minY,En.maxY,dn),Vi=jn(Rr,Tn,ve+Xo,ve+js,1,En.minY,En.maxY,dn),Rr=null),fn>1&&console.timeEnd("clipping"),Ge.push(ei||[],lt+1,2*se,2*ve),Ge.push(Kn||[],lt+1,2*se,2*ve+1),Ge.push(li||[],lt+1,2*se+1,2*ve),Ge.push(Vi||[],lt+1,2*se+1,2*ve+1)}}},Ye.prototype.getTile=function(Kt,lt,se){var ve=this.options,ye=ve.extent,je=ve.debug;if(Kt<0||Kt>24)return null;var tn=1<<Kt,Ge=Je(Kt,lt=(lt%tn+tn)%tn,se);if(this.tiles[Ge])return Dt(this.tiles[Ge],ye);je>1&&console.log("drilling down to z%d-%d-%d",Kt,lt,se);for(var dn,fn=Kt,Tn=lt,Ir=se;!dn&&fn>0;)fn--,Tn=Math.floor(Tn/2),Ir=Math.floor(Ir/2),dn=this.tiles[Je(fn,Tn,Ir)];return dn&&dn.source?(je>1&&console.log("found parent tile z%d-%d-%d",fn,Tn,Ir),je>1&&console.time("drilling down"),this.splitTile(dn.source,fn,Tn,Ir,Kt,lt,se),je>1&&console.timeEnd("drilling down"),this.tiles[Ge]?Dt(this.tiles[Ge],ye):null):null},function(Kt,lt){return new Ye(Kt,lt)}}();var yn=Pt.g(On.exports);function Yn(Te,st){const vt=Te.tileID.canonical;if(!this._geoJSONIndex)return st(null,null);const Gt=this._geoJSONIndex.getTile(vt.z,vt.x,vt.y);if(!Gt)return st(null,null);const Ve=new class{constructor(We){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=Pt.E,this.length=We.length,this._features=We}feature(We){return new class{constructor(gn){this._feature=gn,this.extent=Pt.E,this.type=gn.type,this.properties=gn.tags,"id"in gn&&!isNaN(gn.id)&&(this.id=parseInt(gn.id,10))}loadGeometry(){if(1===this._feature.type){const gn=[];for(const rn of this._feature.geometry)gn.push([new Pt.P(rn[0],rn[1])]);return gn}{const gn=[];for(const rn of this._feature.geometry){const Rn=[];for(const jn of rn)Rn.push(new Pt.P(jn[0],jn[1]));gn.push(Rn)}return gn}}toGeoJSON(gn,rn,Rn){return ee.call(this,gn,rn,Rn)}}(this._features[We])}}(Gt.features);let sn=cn(Ve);0===sn.byteOffset&&sn.byteLength===sn.buffer.byteLength||(sn=new Uint8Array(sn)),st(null,{vectorTile:Ve,rawData:sn.buffer})}class Gn extends Pt.d{constructor(st,vt,Gt,Ve,sn,We){super(st,vt,Gt,Ve,Yn,We),sn&&(this.loadGeoJSON=sn)}loadData(st,vt){const Gt=st&&st.request,Ve=Gt&&Gt.collectResourceTiming;this.loadGeoJSON(st,(sn,We)=>{if(sn||!We)return vt(sn);if("object"!=typeof We)return vt(new Error(`Input data given to '${st.source}' is not a valid GeoJSON object.`));{Ce(We,!0);try{if(st.filter){const rn=Pt.e(st.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===rn.result)throw new Error(rn.value.map(jn=>`${jn.key}: ${jn.message}`).join(", "));We={type:"FeatureCollection",features:We.features.filter(jn=>rn.value.evaluate({zoom:0},jn))}}this._geoJSONIndex=st.cluster?new wt(function({superclusterOptions:rn,clusterProperties:Rn}){if(!Rn||!rn)return rn;const jn={},Sn={},mn={accumulated:null,zoom:0},Ni={properties:null},Zi=Object.keys(Rn);for(const Nn of Zi){const[Hr,fe]=Rn[Nn],W=Pt.e(fe),nt=Pt.e("string"==typeof Hr?[Hr,["accumulated"],["get",Nn]]:Hr);jn[Nn]=W.value,Sn[Nn]=nt.value}return rn.map=Nn=>{Ni.properties=Nn;const Hr={};for(const fe of Zi)Hr[fe]=jn[fe].evaluate(mn,Ni);return Hr},rn.reduce=(Nn,Hr)=>{Ni.properties=Hr;for(const fe of Zi)mn.accumulated=Nn[fe],Nn[fe]=Sn[fe].evaluate(mn,Ni)},rn}(st)).load(We.features):yn(We,st.geojsonVtOptions)}catch(rn){return vt(rn)}this.loaded={};const gn={};if(Ve){const rn=Pt.f(Gt);rn&&(gn.resourceTiming={},gn.resourceTiming[st.source]=JSON.parse(JSON.stringify(rn)))}vt(null,gn)}})}reloadTile(st,vt){const Gt=this.loaded;return Gt&&Gt[st.uid]?super.reloadTile(st,vt):this.loadTile(st,vt)}loadGeoJSON(st,vt){if(st.request)Pt.h(st.request,vt);else{if("string"!=typeof st.data)return vt(new Error(`Input data given to '${st.source}' is not a valid GeoJSON object.`));try{return vt(null,JSON.parse(st.data))}catch{return vt(new Error(`Input data given to '${st.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(st,vt){try{vt(null,this._geoJSONIndex.getClusterExpansionZoom(st.clusterId))}catch(Gt){vt(Gt)}}getClusterChildren(st,vt){try{vt(null,this._geoJSONIndex.getChildren(st.clusterId))}catch(Gt){vt(Gt)}}getClusterLeaves(st,vt){try{vt(null,this._geoJSONIndex.getLeaves(st.clusterId,st.limit,st.offset))}catch(Gt){vt(Gt)}}}class hn{constructor(st,vt){this.tileID=new Pt.O(st.tileID.overscaledZ,st.tileID.wrap,st.tileID.canonical.z,st.tileID.canonical.x,st.tileID.canonical.y),this.tileZoom=st.tileZoom,this.uid=st.uid,this.zoom=st.zoom,this.canonical=st.tileID.canonical,this.pixelRatio=st.pixelRatio,this.tileSize=st.tileSize,this.source=st.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=st.projection,this.brightness=vt}parse(st,vt,Gt,Ve){this.status="parsing";const sn=new Pt.O(Gt.tileID.overscaledZ,Gt.tileID.wrap,Gt.tileID.canonical.z,Gt.tileID.canonical.x,Gt.tileID.canonical.y),We={},gn=vt.familiesBySource[Gt.source],rn=new Pt.F(sn,Gt.promoteId);return rn.bucketLayerIDs=[],Pt.l(st).then(Rn=>{if(!Rn)return Ve(new Error("Could not parse tile"));const jn=Pt.j(Rn,1/Pt.t(Gt.tileID.canonical)),Sn=Rn.json.extensionsUsed&&Rn.json.extensionsUsed.includes("MAPBOX_mesh_features"),mn=new Pt.k(this.zoom,{brightness:this.brightness});for(const Ni in gn)for(const Zi of gn[Ni]){const Nn=Zi[0],Hr=Rn.json.extensionsUsed;Nn.recalculate(mn,[]);const fe=new Pt.T(jn,sn,Hr&&Hr.includes("MAPBOX_mesh_features"),this.brightness);Sn||(fe.needsUpload=!0),We[Nn.fqid]=fe,fe.evaluate(Nn)}this.status="done",Ve(null,{buckets:We,featureIndex:rn})}).catch(Rn=>Ve(new Error(Rn.message)))}}class Er{constructor(st,vt,Gt,Ve,sn,We){this.actor=st,this.layerIndex=vt,this.brightness=We,this.loading={},this.loaded={}}loadTile(st,vt){const Gt=st.uid,Ve=this.loading[Gt]=new hn(st,this.brightness);Pt.i(st.request,(sn,We)=>{const gn=!this.loading[Gt];return delete this.loading[Gt],gn||sn?(Ve.status="done",gn||(this.loaded[Gt]=Ve),vt(sn)):We&&0!==We.byteLength?void Ve.parse(We,this.layerIndex,st,(rn,Rn)=>{Ve.status="done",this.loaded=this.loaded||{},this.loaded[Gt]=Ve,rn||!Rn?vt(rn):vt(null,Rn)}):(Ve.status="done",this.loaded[Gt]=Ve,vt())})}reloadTile(st,vt){const Gt=this.loaded,Ve=st.uid;if(Gt&&Gt[Ve]){const sn=Gt[Ve];sn.projection=st.projection,sn.brightness=st.brightness;const We=(gn,rn)=>{sn.reloadCallback&&(delete sn.reloadCallback,this.loadTile(st,vt)),vt(gn,rn)};"parsing"===sn.status?sn.reloadCallback=We:"done"===sn.status&&this.loadTile(st,vt)}}abortTile(st,vt){const Gt=st.uid;this.loading[Gt]&&delete this.loading[Gt],vt()}removeTile(st,vt){const Gt=this.loaded,Ve=st.uid;Gt&&Gt[Ve]&&delete Gt[Ve],vt()}}class di{constructor(st){this.self=st,this.actor=new Pt.A(st,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=Pt.m({name:"mercator"}),this.workerSourceTypes={vector:Pt.d,geojson:Gn,"batched-model":Er},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(vt,Gt)=>{if(this.workerSourceTypes[vt])throw new Error(`Worker source with name "${vt}" already registered.`);this.workerSourceTypes[vt]=Gt},this.self.registerRTLTextPlugin=vt=>{if(Pt.n.isParsed())throw new Error("RTL text plugin already registered.");Pt.n.applyArabicShaping=vt.applyArabicShaping,Pt.n.processBidirectionalText=vt.processBidirectionalText,Pt.n.processStyledBidirectionalText=vt.processStyledBidirectionalText}}clearCaches(st,vt,Gt){delete this.layerIndexes[st],delete this.availableImages[st],delete this.workerSources[st],delete this.demWorkerSources[st],Gt()}checkIfReady(st,vt,Gt){Gt()}setReferrer(st,vt){this.referrer=vt}spriteLoaded(st,{scope:vt,isLoaded:Gt}){if(this.isSpriteLoaded[st]||(this.isSpriteLoaded[st]={}),this.isSpriteLoaded[st][vt]=Gt,this.workerSources[st]&&this.workerSources[st][vt])for(const Ve in this.workerSources[st][vt]){const sn=this.workerSources[st][vt][Ve];for(const We in sn)sn[We]instanceof Pt.d&&(sn[We].isSpriteLoaded=Gt,sn[We].fire(new Pt.o("isSpriteLoaded")))}}setImages(st,{scope:vt,images:Gt},Ve){if(this.availableImages[st]||(this.availableImages[st]={}),this.availableImages[st][vt]=Gt,this.workerSources[st]&&this.workerSources[st][vt]){for(const sn in this.workerSources[st][vt]){const We=this.workerSources[st][vt][sn];for(const gn in We)We[gn].availableImages=Gt}Ve()}else Ve()}setProjection(st,vt){this.projections[st]=Pt.m(vt)}setBrightness(st,vt,Gt){this.brightness=vt,Gt()}setLayers(st,vt,Gt){this.getLayerIndex(st,vt.scope).replace(vt.layers,vt.options),Gt()}updateLayers(st,vt,Gt){this.getLayerIndex(st,vt.scope).update(vt.layers,vt.removedIds,vt.options),Gt()}loadTile(st,vt,Gt){vt.projection=this.projections[st]||this.defaultProjection,this.getWorkerSource(st,vt.type,vt.source,vt.scope).loadTile(vt,Gt)}loadDEMTile(st,vt,Gt){this.getDEMWorkerSource(st,vt.source,vt.scope).loadTile(vt,Gt)}reloadTile(st,vt,Gt){vt.projection=this.projections[st]||this.defaultProjection,this.getWorkerSource(st,vt.type,vt.source,vt.scope).reloadTile(vt,Gt)}abortTile(st,vt,Gt){this.getWorkerSource(st,vt.type,vt.source,vt.scope).abortTile(vt,Gt)}removeTile(st,vt,Gt){this.getWorkerSource(st,vt.type,vt.source,vt.scope).removeTile(vt,Gt)}removeSource(st,vt,Gt){if(!(this.workerSources[st]&&this.workerSources[st][vt.scope]&&this.workerSources[st][vt.scope][vt.type]&&this.workerSources[st][vt.scope][vt.type][vt.source]))return;const Ve=this.workerSources[st][vt.scope][vt.type][vt.source];delete this.workerSources[st][vt.scope][vt.type][vt.source],void 0!==Ve.removeSource?Ve.removeSource(vt,Gt):Gt()}loadWorkerSource(st,vt,Gt){try{this.self.importScripts(vt.url),Gt()}catch(Ve){Gt(Ve.toString())}}syncRTLPluginState(st,vt,Gt){try{Pt.n.setState(vt);const Ve=Pt.n.getPluginURL();if(Pt.n.isLoaded()&&!Pt.n.isParsed()&&null!=Ve){this.self.importScripts(Ve);const sn=Pt.n.isParsed();Gt(sn?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ve}`),sn)}}catch(Ve){Gt(Ve.toString())}}setDracoUrl(st,vt){this.dracoUrl=vt}getAvailableImages(st,vt){this.availableImages[st]||(this.availableImages[st]={});let Gt=this.availableImages[st][vt];return Gt||(Gt=[]),Gt}getLayerIndex(st,vt){this.layerIndexes[st]||(this.layerIndexes[st]={});let Gt=this.layerIndexes[st][vt];return Gt||(Gt=this.layerIndexes[st][vt]=new ie,Gt.scope=vt),Gt}getWorkerSource(st,vt,Gt,Ve){return this.workerSources[st]||(this.workerSources[st]={}),this.workerSources[st][Ve]||(this.workerSources[st][Ve]={}),this.workerSources[st][Ve][vt]||(this.workerSources[st][Ve][vt]={}),this.isSpriteLoaded[st]||(this.isSpriteLoaded[st]={}),this.workerSources[st][Ve][vt][Gt]||(this.workerSources[st][Ve][vt][Gt]=new this.workerSourceTypes[vt]({send:(We,gn,rn,Rn,jn,Sn)=>{this.actor.send(We,gn,rn,st,jn,Sn)},scheduler:this.actor.scheduler},this.getLayerIndex(st,Ve),this.getAvailableImages(st,Ve),this.isSpriteLoaded[st][Ve],void 0,this.brightness)),this.workerSources[st][Ve][vt][Gt]}getDEMWorkerSource(st,vt,Gt){return this.demWorkerSources[st]||(this.demWorkerSources[st]={}),this.demWorkerSources[st][Gt]||(this.demWorkerSources[st][Gt]={}),this.demWorkerSources[st][Gt][vt]||(this.demWorkerSources[st][Gt][vt]=new Yt),this.demWorkerSources[st][Gt][vt]}enforceCacheSizeLimit(st,vt){Pt.q(vt)}getWorkerPerformanceMetrics(st,vt,Gt){Gt(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new di(self)),di}),Rt(0,function(Pt){return Pt.s}),Ct}()},4772:nn=>{"use strict";var we=Object.getOwnPropertySymbols,Tt=Object.prototype.hasOwnProperty,Ct=Object.prototype.propertyIsEnumerable;nn.exports=function oe(){try{if(!Object.assign)return!1;var Pt=new String("abc");if(Pt[5]="de","5"===Object.getOwnPropertyNames(Pt)[0])return!1;for(var rt={},zt=0;zt<10;zt++)rt["_"+String.fromCharCode(zt)]=zt;if("0123456789"!==Object.getOwnPropertyNames(rt).map(function(Me){return rt[Me]}).join(""))return!1;var Yt={};return"abcdefghijklmnopqrst".split("").forEach(function(Me){Yt[Me]=Me}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},Yt)).join("")}catch{return!1}}()?Object.assign:function(Pt,rt){for(var zt,Yt,ie=function Rt(Pt){if(null==Pt)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(Pt)}(Pt),Me=1;Me<arguments.length;Me++){for(var Be in zt=Object(arguments[Me]))Tt.call(zt,Be)&&(ie[Be]=zt[Be]);if(we){Yt=we(zt);for(var Ce=0;Ce<Yt.length;Ce++)Ct.call(zt,Yt[Ce])&&(ie[Yt[Ce]]=zt[Yt[Ce]])}}return ie}},4246:nn=>{"use strict";var we=function(Tt){return Tt!=Tt};nn.exports=function(Ct,Rt){return 0===Ct&&0===Rt?1/Ct==1/Rt:!!(Ct===Rt||we(Ct)&&we(Rt))}},314:(nn,we,Tt)=>{"use strict";var Ct=Tt(1648),Rt=Tt(5436),oe=Tt(4246),Pt=Tt(1353),rt=Tt(3090),zt=Rt(Pt(),Object);Ct(zt,{getPolyfill:Pt,implementation:oe,shim:rt}),nn.exports=zt},1353:(nn,we,Tt)=>{"use strict";var Ct=Tt(4246);nn.exports=function(){return"function"==typeof Object.is?Object.is:Ct}},3090:(nn,we,Tt)=>{"use strict";var Ct=Tt(1353),Rt=Tt(1648);nn.exports=function(){var Pt=Ct();return Rt(Object,{is:Pt},{is:function(){return Object.is!==Pt}}),Pt}},7972:(nn,we,Tt)=>{"use strict";var Ct;if(!Object.keys){var Rt=Object.prototype.hasOwnProperty,oe=Object.prototype.toString,Pt=Tt(9637),rt=Object.prototype.propertyIsEnumerable,zt=!rt.call({toString:null},"toString"),ie=rt.call(function(){},"prototype"),Yt=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Me=function(_e){var an=_e.constructor;return an&&an.prototype===_e},Be={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},Ce=function(){if(typeof window>"u")return!1;for(var _e in window)try{if(!Be["$"+_e]&&Rt.call(window,_e)&&null!==window[_e]&&"object"==typeof window[_e])try{Me(window[_e])}catch{return!0}}catch{return!0}return!1}();Ct=function(an){var pt=null!==an&&"object"==typeof an,mt="[object Function]"===oe.call(an),ot=Pt(an),gt=pt&&"[object String]"===oe.call(an),ct=[];if(!pt&&!mt&&!ot)throw new TypeError("Object.keys called on a non-object");var kt=ie&&mt;if(gt&&an.length>0&&!Rt.call(an,0))for(var ut=0;ut<an.length;++ut)ct.push(String(ut));if(ot&&an.length>0)for(var H=0;H<an.length;++H)ct.push(String(H));else for(var ht in an)(!kt||"prototype"!==ht)&&Rt.call(an,ht)&&ct.push(String(ht));if(zt)for(var J=function(_e){if(typeof window>"u"||!Ce)return Me(_e);try{return Me(_e)}catch{return!1}}(an),ue=0;ue<Yt.length;++ue)(!J||"constructor"!==Yt[ue])&&Rt.call(an,Yt[ue])&&ct.push(Yt[ue]);return ct}}nn.exports=Ct},7809:(nn,we,Tt)=>{"use strict";var Ct=Array.prototype.slice,Rt=Tt(9637),oe=Object.keys,Pt=oe?function(ie){return oe(ie)}:Tt(7972),rt=Object.keys;Pt.shim=function(){if(Object.keys){var ie=function(){var Yt=Object.keys(arguments);return Yt&&Yt.length===arguments.length}(1,2);ie||(Object.keys=function(Me){return Rt(Me)?rt(Ct.call(Me)):rt(Me)})}else Object.keys=Pt;return Object.keys||Pt},nn.exports=Pt},9637:nn=>{"use strict";var we=Object.prototype.toString;nn.exports=function(Ct){var Rt=we.call(Ct),oe="[object Arguments]"===Rt;return oe||(oe="[object Array]"!==Rt&&null!==Ct&&"object"==typeof Ct&&"number"==typeof Ct.length&&Ct.length>=0&&"[object Function]"===we.call(Ct.callee)),oe}},4018:nn=>{nn.exports=function(Tt,Ct,Rt,oe){var Pt=Tt[0],rt=Tt[1],zt=!1;void 0===Rt&&(Rt=0),void 0===oe&&(oe=Ct.length);for(var ie=(oe-Rt)/2,Yt=0,Me=ie-1;Yt<ie;Me=Yt++){var Be=Ct[Rt+2*Yt+0],Ce=Ct[Rt+2*Yt+1],_e=Ct[Rt+2*Me+1];Ce>rt!=_e>rt&&Pt<(Ct[Rt+2*Me+0]-Be)*(rt-Ce)/(_e-Ce)+Be&&(zt=!zt)}return zt}},4179:(nn,we,Tt)=>{var Ct=Tt(4018),Rt=Tt(8875);nn.exports=function(Pt,rt,zt,ie){return rt.length>0&&Array.isArray(rt[0])?Rt(Pt,rt,zt,ie):Ct(Pt,rt,zt,ie)},nn.exports.nested=Rt,nn.exports.flat=Ct},8875:nn=>{nn.exports=function(Tt,Ct,Rt,oe){var Pt=Tt[0],rt=Tt[1],zt=!1;void 0===Rt&&(Rt=0),void 0===oe&&(oe=Ct.length);for(var ie=oe-Rt,Yt=0,Me=ie-1;Yt<ie;Me=Yt++){var Be=Ct[Yt+Rt][0],Ce=Ct[Yt+Rt][1],_e=Ct[Me+Rt][1];Ce>rt!=_e>rt&&Pt<(Ct[Me+Rt][0]-Be)*(rt-Ce)/(_e-Ce)+Be&&(zt=!zt)}return zt}},8464:function(nn){nn.exports=function(){"use strict";function we(fe,W){var Dt,Jt,Xt,Ue,nt={label:0,sent:function(){if(1&Xt[0])throw Xt[1];return Xt[1]},trys:[],ops:[]};return Ue={next:ke(0),throw:ke(1),return:ke(2)},"function"==typeof Symbol&&(Ue[Symbol.iterator]=function(){return this}),Ue;function ke(Je){return function(Kt){return function Ye(Je){if(Dt)throw new TypeError("Generator is already executing.");for(;nt;)try{if(Dt=1,Jt&&(Xt=2&Je[0]?Jt.return:Je[0]?Jt.throw||((Xt=Jt.return)&&Xt.call(Jt),0):Jt.next)&&!(Xt=Xt.call(Jt,Je[1])).done)return Xt;switch(Jt=0,Xt&&(Je=[2&Je[0],Xt.value]),Je[0]){case 0:case 1:Xt=Je;break;case 4:return nt.label++,{value:Je[1],done:!1};case 5:nt.label++,Jt=Je[1],Je=[0];continue;case 7:Je=nt.ops.pop(),nt.trys.pop();continue;default:if(!(Xt=(Xt=nt.trys).length>0&&Xt[Xt.length-1])&&(6===Je[0]||2===Je[0])){nt=0;continue}if(3===Je[0]&&(!Xt||Je[1]>Xt[0]&&Je[1]<Xt[3])){nt.label=Je[1];break}if(6===Je[0]&&nt.label<Xt[1]){nt.label=Xt[1],Xt=Je;break}if(Xt&&nt.label<Xt[2]){nt.label=Xt[2],nt.ops.push(Je);break}Xt[2]&&nt.ops.pop(),nt.trys.pop();continue}Je=W.call(fe,nt)}catch(Kt){Je=[6,Kt],Jt=0}finally{Dt=Xt=0}if(5&Je[0])throw Je[1];return{value:Je[0]?Je[1]:void 0,done:!0}}([Je,Kt])}}}var Tt=function fe(W,nt){this.next=null,this.key=W,this.data=nt,this.left=null,this.right=null};function Ct(fe,W){return fe>W?1:fe<W?-1:0}function Rt(fe,W,nt){for(var Dt=new Tt(null,null),Jt=Dt,Xt=Dt;;){var Ue=nt(fe,W.key);if(Ue<0){if(null===W.left)break;if(nt(fe,W.left.key)<0&&(W.left=(ke=W.left).right,ke.right=W,null===(W=ke).left))break;Xt.left=W,Xt=W,W=W.left}else{if(!(Ue>0))break;if(null===W.right)break;var ke;if(nt(fe,W.right.key)>0&&(W.right=(ke=W.right).left,ke.left=W,null===(W=ke).right))break;Jt.right=W,Jt=W,W=W.right}}return Jt.right=W.left,Xt.left=W.right,W.left=Dt.right,W.right=Dt.left,W}function oe(fe,W,nt,Dt){var Jt=new Tt(fe,W);if(null===nt)return Jt.left=Jt.right=null,Jt;var Xt=Dt(fe,(nt=Rt(fe,nt,Dt)).key);return Xt<0?(Jt.left=nt.left,Jt.right=nt,nt.left=null):Xt>=0&&(Jt.right=nt.right,Jt.left=nt,nt.right=null),Jt}function Pt(fe,W,nt){var Dt=null,Jt=null;if(W){var Xt=nt((W=Rt(fe,W,nt)).key,fe);0===Xt?(Dt=W.left,Jt=W.right):Xt<0?(Jt=W.right,W.right=null,Dt=W):(Dt=W.left,W.left=null,Jt=W)}return{left:Dt,right:Jt}}function zt(fe,W,nt,Dt,Jt){if(fe){Dt(W+(nt?"\u2514\u2500\u2500 ":"\u251c\u2500\u2500 ")+Jt(fe)+"\n");var Xt=W+(nt?"    ":"\u2502   ");fe.left&&zt(fe.left,Xt,!1,Dt,Jt),fe.right&&zt(fe.right,Xt,!0,Dt,Jt)}}var ie=function(){function fe(W){void 0===W&&(W=Ct),this._root=null,this._size=0,this._comparator=W}return fe.prototype.insert=function(W,nt){return this._size++,this._root=oe(W,nt,this._root,this._comparator)},fe.prototype.add=function(W,nt){var Dt=new Tt(W,nt);null===this._root&&(Dt.left=Dt.right=null,this._size++,this._root=Dt);var Jt=this._comparator,Xt=Rt(W,this._root,Jt),Ue=Jt(W,Xt.key);return 0===Ue?this._root=Xt:(Ue<0?(Dt.left=Xt.left,Dt.right=Xt,Xt.left=null):Ue>0&&(Dt.right=Xt.right,Dt.left=Xt,Xt.right=null),this._size++,this._root=Dt),this._root},fe.prototype.remove=function(W){this._root=this._remove(W,this._root,this._comparator)},fe.prototype._remove=function(W,nt,Dt){var Jt;return null===nt?null:0===Dt(W,(nt=Rt(W,nt,Dt)).key)?(null===nt.left?Jt=nt.right:(Jt=Rt(W,nt.left,Dt)).right=nt.right,this._size--,Jt):nt},fe.prototype.pop=function(){var W=this._root;if(W){for(;W.left;)W=W.left;return this._root=Rt(W.key,this._root,this._comparator),this._root=this._remove(W.key,this._root,this._comparator),{key:W.key,data:W.data}}return null},fe.prototype.findStatic=function(W){for(var nt=this._root,Dt=this._comparator;nt;){var Jt=Dt(W,nt.key);if(0===Jt)return nt;nt=Jt<0?nt.left:nt.right}return null},fe.prototype.find=function(W){return this._root&&(this._root=Rt(W,this._root,this._comparator),0!==this._comparator(W,this._root.key))?null:this._root},fe.prototype.contains=function(W){for(var nt=this._root,Dt=this._comparator;nt;){var Jt=Dt(W,nt.key);if(0===Jt)return!0;nt=Jt<0?nt.left:nt.right}return!1},fe.prototype.forEach=function(W,nt){for(var Dt=this._root,Jt=[],Xt=!1;!Xt;)null!==Dt?(Jt.push(Dt),Dt=Dt.left):0!==Jt.length?(Dt=Jt.pop(),W.call(nt,Dt),Dt=Dt.right):Xt=!0;return this},fe.prototype.range=function(W,nt,Dt,Jt){for(var Xt=[],Ue=this._comparator,ke=this._root;0!==Xt.length||ke;)if(ke)Xt.push(ke),ke=ke.left;else{if(Ue((ke=Xt.pop()).key,nt)>0)break;if(Ue(ke.key,W)>=0&&Dt.call(Jt,ke))return this;ke=ke.right}return this},fe.prototype.keys=function(){var W=[];return this.forEach(function(nt){return W.push(nt.key)}),W},fe.prototype.values=function(){var W=[];return this.forEach(function(nt){return W.push(nt.data)}),W},fe.prototype.min=function(){return this._root?this.minNode(this._root).key:null},fe.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},fe.prototype.minNode=function(W){if(void 0===W&&(W=this._root),W)for(;W.left;)W=W.left;return W},fe.prototype.maxNode=function(W){if(void 0===W&&(W=this._root),W)for(;W.right;)W=W.right;return W},fe.prototype.at=function(W){for(var nt=this._root,Dt=!1,Jt=0,Xt=[];!Dt;)if(nt)Xt.push(nt),nt=nt.left;else if(Xt.length>0){if(nt=Xt.pop(),Jt===W)return nt;Jt++,nt=nt.right}else Dt=!0;return null},fe.prototype.next=function(W){var nt=this._root,Dt=null;if(W.right){for(Dt=W.right;Dt.left;)Dt=Dt.left;return Dt}for(var Jt=this._comparator;nt;){var Xt=Jt(W.key,nt.key);if(0===Xt)break;Xt<0?(Dt=nt,nt=nt.left):nt=nt.right}return Dt},fe.prototype.prev=function(W){var nt=this._root,Dt=null;if(null!==W.left){for(Dt=W.left;Dt.right;)Dt=Dt.right;return Dt}for(var Jt=this._comparator;nt;){var Xt=Jt(W.key,nt.key);if(0===Xt)break;Xt<0?nt=nt.left:(Dt=nt,nt=nt.right)}return Dt},fe.prototype.clear=function(){return this._root=null,this._size=0,this},fe.prototype.toList=function(){return function Be(fe){for(var W=fe,nt=[],Dt=!1,Jt=new Tt(null,null),Xt=Jt;!Dt;)W?(nt.push(W),W=W.left):nt.length>0?W=(W=Xt=Xt.next=nt.pop()).right:Dt=!0;return Xt.next=null,Jt.next}(this._root)},fe.prototype.load=function(W,nt,Dt){void 0===nt&&(nt=[]),void 0===Dt&&(Dt=!1);var Jt=W.length,Xt=this._comparator;if(Dt&&_e(W,nt,0,Jt-1,Xt),null===this._root)this._root=Yt(W,nt,0,Jt),this._size=Jt;else{var Ue=function ee(fe,W,nt){for(var Dt=new Tt(null,null),Jt=Dt,Xt=fe,Ue=W;null!==Xt&&null!==Ue;)nt(Xt.key,Ue.key)<0?(Jt.next=Xt,Xt=Xt.next):(Jt.next=Ue,Ue=Ue.next),Jt=Jt.next;return null!==Xt?Jt.next=Xt:null!==Ue&&(Jt.next=Ue),Dt.next}(this.toList(),function Me(fe,W){for(var nt=new Tt(null,null),Dt=nt,Jt=0;Jt<fe.length;Jt++)Dt=Dt.next=new Tt(fe[Jt],W[Jt]);return Dt.next=null,nt.next}(W,nt),Xt);this._root=Ce({head:Ue},0,Jt=this._size+Jt)}return this},fe.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(fe.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(fe.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),fe.prototype.toString=function(W){void 0===W&&(W=function(Dt){return String(Dt.key)});var nt=[];return zt(this._root,"",!0,function(Dt){return nt.push(Dt)},W),nt.join("")},fe.prototype.update=function(W,nt,Dt){var Jt=this._comparator,Xt=Pt(W,this._root,Jt),Ue=Xt.left,ke=Xt.right;Jt(W,nt)<0?ke=oe(nt,Dt,ke,Jt):Ue=oe(nt,Dt,Ue,Jt),this._root=function rt(fe,W,nt){return null===W?fe:(null===fe||((W=Rt(fe.key,W,nt)).left=fe),W)}(Ue,ke,Jt)},fe.prototype.split=function(W){return Pt(W,this._root,this._comparator)},fe.prototype[Symbol.iterator]=function(){var W,nt,Dt;return we(this,function(Jt){switch(Jt.label){case 0:W=this._root,nt=[],Dt=!1,Jt.label=1;case 1:return Dt?[3,6]:null===W?[3,2]:(nt.push(W),W=W.left,[3,5]);case 2:return 0===nt.length?[3,4]:[4,W=nt.pop()];case 3:return Jt.sent(),W=W.right,[3,5];case 4:Dt=!0,Jt.label=5;case 5:return[3,1];case 6:return[2]}})},fe}();function Yt(fe,W,nt,Dt){var Jt=Dt-nt;if(Jt>0){var Xt=nt+Math.floor(Jt/2),Ye=new Tt(fe[Xt],W[Xt]);return Ye.left=Yt(fe,W,nt,Xt),Ye.right=Yt(fe,W,Xt+1,Dt),Ye}return null}function Ce(fe,W,nt){var Dt=nt-W;if(Dt>0){var Jt=W+Math.floor(Dt/2),Xt=Ce(fe,W,Jt),Ue=fe.head;return Ue.left=Xt,fe.head=fe.head.next,Ue.right=Ce(fe,Jt+1,nt),Ue}return null}function _e(fe,W,nt,Dt,Jt){if(!(nt>=Dt)){for(var Xt=fe[nt+Dt>>1],Ue=nt-1,ke=Dt+1;;){do{Ue++}while(Jt(fe[Ue],Xt)<0);do{ke--}while(Jt(fe[ke],Xt)>0);if(Ue>=ke)break;var Ye=fe[Ue];fe[Ue]=fe[ke],fe[ke]=Ye,Ye=W[Ue],W[Ue]=W[ke],W[ke]=Ye}_e(fe,W,nt,ke,Jt),_e(fe,W,ke+1,Dt,Jt)}}const an=(fe,W)=>fe.ll.x<=W.x&&W.x<=fe.ur.x&&fe.ll.y<=W.y&&W.y<=fe.ur.y,pt=(fe,W)=>W.ur.x<fe.ll.x||fe.ur.x<W.ll.x||W.ur.y<fe.ll.y||fe.ur.y<W.ll.y?null:{ll:{x:fe.ll.x<W.ll.x?W.ll.x:fe.ll.x,y:fe.ll.y<W.ll.y?W.ll.y:fe.ll.y},ur:{x:fe.ur.x<W.ur.x?fe.ur.x:W.ur.x,y:fe.ur.y<W.ur.y?fe.ur.y:W.ur.y}};let mt=Number.EPSILON;void 0===mt&&(mt=Math.pow(2,-52));const ot=mt*mt,gt=(fe,W)=>{if(-mt<fe&&fe<mt&&-mt<W&&W<mt)return 0;const nt=fe-W;return nt*nt<ot*fe*W?0:fe<W?-1:1};class kt{constructor(){this.tree=new ie,this.round(0)}round(W){const nt=this.tree.add(W),Dt=this.tree.prev(nt);if(null!==Dt&&0===gt(nt.key,Dt.key))return this.tree.remove(W),Dt.key;const Jt=this.tree.next(nt);return null!==Jt&&0===gt(nt.key,Jt.key)?(this.tree.remove(W),Jt.key):W}}const ut=new class ct{constructor(){this.reset()}reset(){this.xRounder=new kt,this.yRounder=new kt}round(W,nt){return{x:this.xRounder.round(W),y:this.yRounder.round(nt)}}},H=11102230246251565e-32,ht=134217729,J=(3+8*H)*H;function ue(fe,W,nt,Dt,Jt){let Xt,Ue,ke,Ye,Je=W[0],Kt=Dt[0],lt=0,se=0;Kt>Je==Kt>-Je?(Xt=Je,Je=W[++lt]):(Xt=Kt,Kt=Dt[++se]);let ve=0;if(lt<fe&&se<nt)for(Kt>Je==Kt>-Je?(Ue=Je+Xt,ke=Xt-(Ue-Je),Je=W[++lt]):(Ue=Kt+Xt,ke=Xt-(Ue-Kt),Kt=Dt[++se]),Xt=Ue,0!==ke&&(Jt[ve++]=ke);lt<fe&&se<nt;)Kt>Je==Kt>-Je?(Ue=Xt+Je,Ye=Ue-Xt,ke=Xt-(Ue-Ye)+(Je-Ye),Je=W[++lt]):(Ue=Xt+Kt,Ye=Ue-Xt,ke=Xt-(Ue-Ye)+(Kt-Ye),Kt=Dt[++se]),Xt=Ue,0!==ke&&(Jt[ve++]=ke);for(;lt<fe;)Ue=Xt+Je,Ye=Ue-Xt,ke=Xt-(Ue-Ye)+(Je-Ye),Je=W[++lt],Xt=Ue,0!==ke&&(Jt[ve++]=ke);for(;se<nt;)Ue=Xt+Kt,Ye=Ue-Xt,ke=Xt-(Ue-Ye)+(Kt-Ye),Kt=Dt[++se],Xt=Ue,0!==ke&&(Jt[ve++]=ke);return(0!==Xt||0===ve)&&(Jt[ve++]=Xt),ve}function Ht(fe){return new Float64Array(fe)}const cn=(2+12*H)*H,en=(9+64*H)*H*H,Ft=Ht(4),de=Ht(8),Vt=Ht(12),At=Ht(16),ne=Ht(4);function Le(fe,W,nt,Dt,Jt,Xt){const Ue=(W-Xt)*(nt-Jt),ke=(fe-Jt)*(Dt-Xt),Ye=Ue-ke,Je=Math.abs(Ue+ke);return Math.abs(Ye)>=33306690738754716e-32*Je?Ye:-function wt(fe,W,nt,Dt,Jt,Xt,Ue){let ke,Ye,Je,Kt,lt,se,ve,ye,je,tn,Ge,dn,fn,Tn,Ir,En,gr,mr;const ei=fe-Jt,Kn=nt-Jt,li=W-Xt,Vi=Dt-Xt;Tn=ei*Vi,se=ht*ei,ve=se-(se-ei),ye=ei-ve,se=ht*Vi,je=se-(se-Vi),tn=Vi-je,Ir=ye*tn-(Tn-ve*je-ye*je-ve*tn),En=li*Kn,se=ht*li,ve=se-(se-li),ye=li-ve,se=ht*Kn,je=se-(se-Kn),tn=Kn-je,gr=ye*tn-(En-ve*je-ye*je-ve*tn),Ge=Ir-gr,lt=Ir-Ge,Ft[0]=Ir-(Ge+lt)+(lt-gr),dn=Tn+Ge,lt=dn-Tn,fn=Tn-(dn-lt)+(Ge-lt),Ge=fn-En,lt=fn-Ge,Ft[1]=fn-(Ge+lt)+(lt-En),mr=dn+Ge,lt=mr-dn,Ft[2]=dn-(mr-lt)+(Ge-lt),Ft[3]=mr;let ui=function St(fe,W){let nt=W[0];for(let Dt=1;Dt<fe;Dt++)nt+=W[Dt];return nt}(4,Ft),Rr=cn*Ue;if(ui>=Rr||-ui>=Rr||(lt=fe-ei,ke=fe-(ei+lt)+(lt-Jt),lt=nt-Kn,Je=nt-(Kn+lt)+(lt-Jt),lt=W-li,Ye=W-(li+lt)+(lt-Xt),lt=Dt-Vi,Kt=Dt-(Vi+lt)+(lt-Xt),0===ke&&0===Ye&&0===Je&&0===Kt)||(Rr=en*Ue+J*Math.abs(ui),ui+=ei*Kt+Vi*ke-(li*Je+Kn*Ye),ui>=Rr||-ui>=Rr))return ui;Tn=ke*Vi,se=ht*ke,ve=se-(se-ke),ye=ke-ve,se=ht*Vi,je=se-(se-Vi),tn=Vi-je,Ir=ye*tn-(Tn-ve*je-ye*je-ve*tn),En=Ye*Kn,se=ht*Ye,ve=se-(se-Ye),ye=Ye-ve,se=ht*Kn,je=se-(se-Kn),tn=Kn-je,gr=ye*tn-(En-ve*je-ye*je-ve*tn),Ge=Ir-gr,lt=Ir-Ge,ne[0]=Ir-(Ge+lt)+(lt-gr),dn=Tn+Ge,lt=dn-Tn,fn=Tn-(dn-lt)+(Ge-lt),Ge=fn-En,lt=fn-Ge,ne[1]=fn-(Ge+lt)+(lt-En),mr=dn+Ge,lt=mr-dn,ne[2]=dn-(mr-lt)+(Ge-lt),ne[3]=mr;const ls=ue(4,Ft,4,ne,de);Tn=ei*Kt,se=ht*ei,ve=se-(se-ei),ye=ei-ve,se=ht*Kt,je=se-(se-Kt),tn=Kt-je,Ir=ye*tn-(Tn-ve*je-ye*je-ve*tn),En=li*Je,se=ht*li,ve=se-(se-li),ye=li-ve,se=ht*Je,je=se-(se-Je),tn=Je-je,gr=ye*tn-(En-ve*je-ye*je-ve*tn),Ge=Ir-gr,lt=Ir-Ge,ne[0]=Ir-(Ge+lt)+(lt-gr),dn=Tn+Ge,lt=dn-Tn,fn=Tn-(dn-lt)+(Ge-lt),Ge=fn-En,lt=fn-Ge,ne[1]=fn-(Ge+lt)+(lt-En),mr=dn+Ge,lt=mr-dn,ne[2]=dn-(mr-lt)+(Ge-lt),ne[3]=mr;const Xo=ue(ls,de,4,ne,Vt);Tn=ke*Kt,se=ht*ke,ve=se-(se-ke),ye=ke-ve,se=ht*Kt,je=se-(se-Kt),tn=Kt-je,Ir=ye*tn-(Tn-ve*je-ye*je-ve*tn),En=Ye*Je,se=ht*Ye,ve=se-(se-Ye),ye=Ye-ve,se=ht*Je,je=se-(se-Je),tn=Je-je,gr=ye*tn-(En-ve*je-ye*je-ve*tn),Ge=Ir-gr,lt=Ir-Ge,ne[0]=Ir-(Ge+lt)+(lt-gr),dn=Tn+Ge,lt=dn-Tn,fn=Tn-(dn-lt)+(Ge-lt),Ge=fn-En,lt=fn-Ge,ne[1]=fn-(Ge+lt)+(lt-En),mr=dn+Ge,lt=mr-dn,ne[2]=dn-(mr-lt)+(Ge-lt),ne[3]=mr;const dl=ue(Xo,Vt,4,ne,At);return At[dl-1]}(fe,W,nt,Dt,Jt,Xt,Je)}const Pe=(fe,W)=>fe.x*W.y-fe.y*W.x,pe=(fe,W)=>fe.x*W.x+fe.y*W.y,Fe=(fe,W,nt)=>{const Dt=Le(fe.x,fe.y,W.x,W.y,nt.x,nt.y);return Dt>0?-1:Dt<0?1:0},Ln=fe=>Math.sqrt(pe(fe,fe)),On=(fe,W,nt)=>{const Dt={x:W.x-fe.x,y:W.y-fe.y},Jt={x:nt.x-fe.x,y:nt.y-fe.y};return Pe(Jt,Dt)/Ln(Jt)/Ln(Dt)},yn=(fe,W,nt)=>{const Dt={x:W.x-fe.x,y:W.y-fe.y},Jt={x:nt.x-fe.x,y:nt.y-fe.y};return pe(Jt,Dt)/Ln(Jt)/Ln(Dt)},Yn=(fe,W,nt)=>0===W.y?null:{x:fe.x+W.x/W.y*(nt-fe.y),y:nt},Gn=(fe,W,nt)=>0===W.x?null:{x:nt,y:fe.y+W.y/W.x*(nt-fe.x)};class Er{static compare(W,nt){const Dt=Er.comparePoints(W.point,nt.point);return 0!==Dt?Dt:(W.point!==nt.point&&W.link(nt),W.isLeft!==nt.isLeft?W.isLeft?1:-1:Te.compare(W.segment,nt.segment))}static comparePoints(W,nt){return W.x<nt.x?-1:W.x>nt.x?1:W.y<nt.y?-1:W.y>nt.y?1:0}constructor(W,nt){void 0===W.events?W.events=[this]:W.events.push(this),this.point=W,this.isLeft=nt}link(W){if(W.point===this.point)throw new Error("Tried to link already linked events");const nt=W.point.events;for(let Dt=0,Jt=nt.length;Dt<Jt;Dt++){const Xt=nt[Dt];this.point.events.push(Xt),Xt.point=this.point}this.checkForConsuming()}checkForConsuming(){const W=this.point.events.length;for(let nt=0;nt<W;nt++){const Dt=this.point.events[nt];if(void 0===Dt.segment.consumedBy)for(let Jt=nt+1;Jt<W;Jt++){const Xt=this.point.events[Jt];void 0===Xt.consumedBy&&Dt.otherSE.point.events===Xt.otherSE.point.events&&Dt.segment.consume(Xt.segment)}}}getAvailableLinkedEvents(){const W=[];for(let nt=0,Dt=this.point.events.length;nt<Dt;nt++){const Jt=this.point.events[nt];Jt!==this&&!Jt.segment.ringOut&&Jt.segment.isInResult()&&W.push(Jt)}return W}getLeftmostComparator(W){const nt=new Map,Dt=Jt=>{const Xt=Jt.otherSE;nt.set(Jt,{sine:On(this.point,W.point,Xt.point),cosine:yn(this.point,W.point,Xt.point)})};return(Jt,Xt)=>{nt.has(Jt)||Dt(Jt),nt.has(Xt)||Dt(Xt);const{sine:Ue,cosine:ke}=nt.get(Jt),{sine:Ye,cosine:Je}=nt.get(Xt);return Ue>=0&&Ye>=0?ke<Je?1:ke>Je?-1:0:Ue<0&&Ye<0?ke<Je?-1:ke>Je?1:0:Ye<Ue?-1:Ye>Ue?1:0}}}let di=0;class Te{static compare(W,nt){const Dt=W.leftSE.point.x,Jt=nt.leftSE.point.x,Xt=W.rightSE.point.x,Ue=nt.rightSE.point.x;if(Ue<Dt)return 1;if(Xt<Jt)return-1;const ke=W.leftSE.point.y,Ye=nt.leftSE.point.y,Je=W.rightSE.point.y,Kt=nt.rightSE.point.y;if(Dt<Jt){if(Ye<ke&&Ye<Je)return 1;if(Ye>ke&&Ye>Je)return-1;const lt=W.comparePoint(nt.leftSE.point);if(lt<0)return 1;if(lt>0)return-1;const se=nt.comparePoint(W.rightSE.point);return 0!==se?se:-1}if(Dt>Jt){if(ke<Ye&&ke<Kt)return-1;if(ke>Ye&&ke>Kt)return 1;const lt=nt.comparePoint(W.leftSE.point);if(0!==lt)return lt;const se=W.comparePoint(nt.rightSE.point);return se<0?1:se>0?-1:1}if(ke<Ye)return-1;if(ke>Ye)return 1;if(Xt<Ue){const lt=nt.comparePoint(W.rightSE.point);if(0!==lt)return lt}if(Xt>Ue){const lt=W.comparePoint(nt.rightSE.point);if(lt<0)return 1;if(lt>0)return-1}if(Xt!==Ue){const lt=Je-ke,se=Xt-Dt,ve=Kt-Ye,ye=Ue-Jt;if(lt>se&&ve<ye)return 1;if(lt<se&&ve>ye)return-1}return Xt>Ue?1:Xt<Ue||Je<Kt?-1:Je>Kt?1:W.id<nt.id?-1:W.id>nt.id?1:0}constructor(W,nt,Dt,Jt){this.id=++di,this.leftSE=W,W.segment=this,W.otherSE=nt,this.rightSE=nt,nt.segment=this,nt.otherSE=W,this.rings=Dt,this.windings=Jt}static fromRing(W,nt,Dt){let Jt,Xt,Ue;const ke=Er.comparePoints(W,nt);if(ke<0)Jt=W,Xt=nt,Ue=1;else{if(!(ke>0))throw new Error(`Tried to create degenerate segment at [${W.x}, ${W.y}]`);Jt=nt,Xt=W,Ue=-1}const Ye=new Er(Jt,!0),Je=new Er(Xt,!1);return new Te(Ye,Je,[Dt],[Ue])}replaceRightSE(W){this.rightSE=W,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const W=this.leftSE.point.y,nt=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:W<nt?W:nt},ur:{x:this.rightSE.point.x,y:W>nt?W:nt}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(W){return W.x===this.leftSE.point.x&&W.y===this.leftSE.point.y||W.x===this.rightSE.point.x&&W.y===this.rightSE.point.y}comparePoint(W){if(this.isAnEndpoint(W))return 0;const nt=this.leftSE.point,Dt=this.rightSE.point,Jt=this.vector();if(nt.x===Dt.x)return W.x===nt.x?0:W.x<nt.x?1:-1;if(W.x===nt.x+(W.y-nt.y)/Jt.y*Jt.x)return 0;const Ye=nt.y+(W.x-nt.x)/Jt.x*Jt.y;return W.y===Ye?0:W.y<Ye?-1:1}getIntersection(W){const nt=this.bbox(),Dt=W.bbox(),Jt=pt(nt,Dt);if(null===Jt)return null;const Xt=this.leftSE.point,Ue=this.rightSE.point,ke=W.leftSE.point,Ye=W.rightSE.point,Je=an(nt,ke)&&0===this.comparePoint(ke),Kt=an(Dt,Xt)&&0===W.comparePoint(Xt),lt=an(nt,Ye)&&0===this.comparePoint(Ye),se=an(Dt,Ue)&&0===W.comparePoint(Ue);if(Kt&&Je)return se&&!lt?Ue:!se&&lt?Ye:null;if(Kt)return lt&&Xt.x===Ye.x&&Xt.y===Ye.y?null:Xt;if(Je)return se&&Ue.x===ke.x&&Ue.y===ke.y?null:ke;if(se&&lt)return null;if(se)return Ue;if(lt)return Ye;const ve=((fe,W,nt,Dt)=>{if(0===W.x)return Gn(nt,Dt,fe.x);if(0===Dt.x)return Gn(fe,W,nt.x);if(0===W.y)return Yn(nt,Dt,fe.y);if(0===Dt.y)return Yn(fe,W,nt.y);const Jt=Pe(W,Dt);if(0==Jt)return null;const Xt={x:nt.x-fe.x,y:nt.y-fe.y},Ue=Pe(Xt,W)/Jt,ke=Pe(Xt,Dt)/Jt;return{x:(fe.x+ke*W.x+(nt.x+Ue*Dt.x))/2,y:(fe.y+ke*W.y+(nt.y+Ue*Dt.y))/2}})(Xt,this.vector(),ke,W.vector());return null!==ve&&an(Jt,ve)?ut.round(ve.x,ve.y):null}split(W){const nt=[],Dt=void 0!==W.events,Jt=new Er(W,!0),Xt=new Er(W,!1),Ue=this.rightSE;this.replaceRightSE(Xt),nt.push(Xt),nt.push(Jt);const ke=new Te(Jt,Ue,this.rings.slice(),this.windings.slice());return Er.comparePoints(ke.leftSE.point,ke.rightSE.point)>0&&ke.swapEvents(),Er.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Dt&&(Jt.checkForConsuming(),Xt.checkForConsuming()),nt}swapEvents(){const W=this.rightSE;this.rightSE=this.leftSE,this.leftSE=W,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let nt=0,Dt=this.windings.length;nt<Dt;nt++)this.windings[nt]*=-1}consume(W){let nt=this,Dt=W;for(;nt.consumedBy;)nt=nt.consumedBy;for(;Dt.consumedBy;)Dt=Dt.consumedBy;const Jt=Te.compare(nt,Dt);if(0!==Jt){if(Jt>0){const Xt=nt;nt=Dt,Dt=Xt}if(nt.prev===Dt){const Xt=nt;nt=Dt,Dt=Xt}for(let Xt=0,Ue=Dt.rings.length;Xt<Ue;Xt++){const ke=Dt.rings[Xt],Ye=Dt.windings[Xt],Je=nt.rings.indexOf(ke);-1===Je?(nt.rings.push(ke),nt.windings.push(Ye)):nt.windings[Je]+=Ye}Dt.rings=null,Dt.windings=null,Dt.consumedBy=nt,Dt.leftSE.consumedBy=nt.leftSE,Dt.rightSE.consumedBy=nt.rightSE}}prevInResult(){return void 0!==this._prevInResult||(this._prevInResult=this.prev?this.prev.isInResult()?this.prev:this.prev.prevInResult():null),this._prevInResult}beforeState(){return void 0!==this._beforeState||(this._beforeState=this.prev?(this.prev.consumedBy||this.prev).afterState():{rings:[],windings:[],multiPolys:[]}),this._beforeState}afterState(){if(void 0!==this._afterState)return this._afterState;const W=this.beforeState();this._afterState={rings:W.rings.slice(0),windings:W.windings.slice(0),multiPolys:[]};const nt=this._afterState.rings,Dt=this._afterState.windings,Jt=this._afterState.multiPolys;for(let ke=0,Ye=this.rings.length;ke<Ye;ke++){const Je=this.rings[ke],Kt=this.windings[ke],lt=nt.indexOf(Je);-1===lt?(nt.push(Je),Dt.push(Kt)):Dt[lt]+=Kt}const Xt=[],Ue=[];for(let ke=0,Ye=nt.length;ke<Ye;ke++){if(0===Dt[ke])continue;const Je=nt[ke],Kt=Je.poly;if(-1===Ue.indexOf(Kt))if(Je.isExterior)Xt.push(Kt);else{-1===Ue.indexOf(Kt)&&Ue.push(Kt);const lt=Xt.indexOf(Je.poly);-1!==lt&&Xt.splice(lt,1)}}for(let ke=0,Ye=Xt.length;ke<Ye;ke++){const Je=Xt[ke].multiPoly;-1===Jt.indexOf(Je)&&Jt.push(Je)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;const W=this.beforeState().multiPolys,nt=this.afterState().multiPolys;switch(Sn.type){case"union":this._isInResult=0===W.length!=(0===nt.length);break;case"intersection":{let Dt,Jt;W.length<nt.length?(Dt=W.length,Jt=nt.length):(Dt=nt.length,Jt=W.length),this._isInResult=Jt===Sn.numMultiPolys&&Dt<Jt;break}case"xor":{const Dt=Math.abs(W.length-nt.length);this._isInResult=Dt%2==1;break}case"difference":{const Dt=Jt=>1===Jt.length&&Jt[0].isSubject;this._isInResult=Dt(W)!==Dt(nt);break}default:throw new Error(`Unrecognized operation type found ${Sn.type}`)}return this._isInResult}}class st{constructor(W,nt,Dt){if(!Array.isArray(W)||0===W.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=nt,this.isExterior=Dt,this.segments=[],"number"!=typeof W[0][0]||"number"!=typeof W[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const Jt=ut.round(W[0][0],W[0][1]);this.bbox={ll:{x:Jt.x,y:Jt.y},ur:{x:Jt.x,y:Jt.y}};let Xt=Jt;for(let Ue=1,ke=W.length;Ue<ke;Ue++){if("number"!=typeof W[Ue][0]||"number"!=typeof W[Ue][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let Ye=ut.round(W[Ue][0],W[Ue][1]);Ye.x===Xt.x&&Ye.y===Xt.y||(this.segments.push(Te.fromRing(Xt,Ye,this)),Ye.x<this.bbox.ll.x&&(this.bbox.ll.x=Ye.x),Ye.y<this.bbox.ll.y&&(this.bbox.ll.y=Ye.y),Ye.x>this.bbox.ur.x&&(this.bbox.ur.x=Ye.x),Ye.y>this.bbox.ur.y&&(this.bbox.ur.y=Ye.y),Xt=Ye)}(Jt.x!==Xt.x||Jt.y!==Xt.y)&&this.segments.push(Te.fromRing(Xt,Jt,this))}getSweepEvents(){const W=[];for(let nt=0,Dt=this.segments.length;nt<Dt;nt++){const Jt=this.segments[nt];W.push(Jt.leftSE),W.push(Jt.rightSE)}return W}}class vt{constructor(W,nt){if(!Array.isArray(W))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new st(W[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let Dt=1,Jt=W.length;Dt<Jt;Dt++){const Xt=new st(W[Dt],this,!1);Xt.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Xt.bbox.ll.x),Xt.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Xt.bbox.ll.y),Xt.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Xt.bbox.ur.x),Xt.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Xt.bbox.ur.y),this.interiorRings.push(Xt)}this.multiPoly=nt}getSweepEvents(){const W=this.exteriorRing.getSweepEvents();for(let nt=0,Dt=this.interiorRings.length;nt<Dt;nt++){const Jt=this.interiorRings[nt].getSweepEvents();for(let Xt=0,Ue=Jt.length;Xt<Ue;Xt++)W.push(Jt[Xt])}return W}}class Gt{constructor(W,nt){if(!Array.isArray(W))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof W[0][0][0]&&(W=[W])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let Dt=0,Jt=W.length;Dt<Jt;Dt++){const Xt=new vt(W[Dt],this);Xt.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Xt.bbox.ll.x),Xt.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Xt.bbox.ll.y),Xt.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Xt.bbox.ur.x),Xt.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Xt.bbox.ur.y),this.polys.push(Xt)}this.isSubject=nt}getSweepEvents(){const W=[];for(let nt=0,Dt=this.polys.length;nt<Dt;nt++){const Jt=this.polys[nt].getSweepEvents();for(let Xt=0,Ue=Jt.length;Xt<Ue;Xt++)W.push(Jt[Xt])}return W}}class Ve{static factory(W){const nt=[];for(let Dt=0,Jt=W.length;Dt<Jt;Dt++){const Xt=W[Dt];if(!Xt.isInResult()||Xt.ringOut)continue;let Ue=null,ke=Xt.leftSE,Ye=Xt.rightSE;const Je=[ke],Kt=ke.point,lt=[];for(;Ue=ke,ke=Ye,Je.push(ke),ke.point!==Kt;)for(;;){const se=ke.getAvailableLinkedEvents();if(0===se.length){const je=Je[0].point,tn=Je[Je.length-1].point;throw new Error(`Unable to complete output ring starting at [${je.x}, ${je.y}]. Last matching segment found ends at [${tn.x}, ${tn.y}].`)}if(1===se.length){Ye=se[0].otherSE;break}let ve=null;for(let je=0,tn=lt.length;je<tn;je++)if(lt[je].point===ke.point){ve=je;break}if(null!==ve){const je=lt.splice(ve)[0],tn=Je.splice(je.index);tn.unshift(tn[0].otherSE),nt.push(new Ve(tn.reverse()));continue}lt.push({index:Je.length,point:ke.point});const ye=ke.getLeftmostComparator(Ue);Ye=se.sort(ye)[0].otherSE;break}nt.push(new Ve(Je))}return nt}constructor(W){this.events=W;for(let nt=0,Dt=W.length;nt<Dt;nt++)W[nt].segment.ringOut=this;this.poly=null}getGeom(){let W=this.events[0].point;const nt=[W];for(let Je=1,Kt=this.events.length-1;Je<Kt;Je++){const lt=this.events[Je].point;0!==Fe(lt,W,this.events[Je+1].point)&&(nt.push(lt),W=lt)}if(1===nt.length)return null;0===Fe(nt[0],W,nt[1])&&nt.shift(),nt.push(nt[0]);const Xt=this.isExteriorRing()?1:-1,Ue=this.isExteriorRing()?0:nt.length-1,ke=this.isExteriorRing()?nt.length:-1,Ye=[];for(let Je=Ue;Je!=ke;Je+=Xt)Ye.push([nt[Je].x,nt[Je].y]);return Ye}isExteriorRing(){if(void 0===this._isExteriorRing){const W=this.enclosingRing();this._isExteriorRing=!W||!W.isExteriorRing()}return this._isExteriorRing}enclosingRing(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let W=this.events[0];for(let Jt=1,Xt=this.events.length;Jt<Xt;Jt++){const Ue=this.events[Jt];Er.compare(W,Ue)>0&&(W=Ue)}let nt=W.segment.prevInResult(),Dt=nt?nt.prevInResult():null;for(;;){if(!nt)return null;if(!Dt)return nt.ringOut;if(Dt.ringOut!==nt.ringOut)return Dt.ringOut.enclosingRing()!==nt.ringOut?nt.ringOut:nt.ringOut.enclosingRing();nt=Dt.prevInResult(),Dt=nt?nt.prevInResult():null}}}class sn{constructor(W){this.exteriorRing=W,W.poly=this,this.interiorRings=[]}addInterior(W){this.interiorRings.push(W),W.poly=this}getGeom(){const W=[this.exteriorRing.getGeom()];if(null===W[0])return null;for(let nt=0,Dt=this.interiorRings.length;nt<Dt;nt++){const Jt=this.interiorRings[nt].getGeom();null!==Jt&&W.push(Jt)}return W}}class We{constructor(W){this.rings=W,this.polys=this._composePolys(W)}getGeom(){const W=[];for(let nt=0,Dt=this.polys.length;nt<Dt;nt++){const Jt=this.polys[nt].getGeom();null!==Jt&&W.push(Jt)}return W}_composePolys(W){const nt=[];for(let Dt=0,Jt=W.length;Dt<Jt;Dt++){const Xt=W[Dt];if(!Xt.poly)if(Xt.isExteriorRing())nt.push(new sn(Xt));else{const Ue=Xt.enclosingRing();Ue.poly||nt.push(new sn(Ue)),Ue.poly.addInterior(Xt)}}return nt}}class gn{constructor(W){let nt=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Te.compare;this.queue=W,this.tree=new ie(nt),this.segments=[]}process(W){const nt=W.segment,Dt=[];if(W.consumedBy)return W.isLeft?this.queue.remove(W.otherSE):this.tree.remove(nt),Dt;const Jt=W.isLeft?this.tree.add(nt):this.tree.find(nt);if(!Jt)throw new Error(`Unable to find segment #${nt.id} [${nt.leftSE.point.x}, ${nt.leftSE.point.y}] -> [${nt.rightSE.point.x}, ${nt.rightSE.point.y}] in SweepLine tree.`);let ke,Ye,Xt=Jt,Ue=Jt;for(;void 0===ke;)Xt=this.tree.prev(Xt),null===Xt?ke=null:void 0===Xt.key.consumedBy&&(ke=Xt.key);for(;void 0===Ye;)Ue=this.tree.next(Ue),null===Ue?Ye=null:void 0===Ue.key.consumedBy&&(Ye=Ue.key);if(W.isLeft){let Je=null;if(ke){const lt=ke.getIntersection(nt);if(null!==lt&&(nt.isAnEndpoint(lt)||(Je=lt),!ke.isAnEndpoint(lt))){const se=this._splitSafely(ke,lt);for(let ve=0,ye=se.length;ve<ye;ve++)Dt.push(se[ve])}}let Kt=null;if(Ye){const lt=Ye.getIntersection(nt);if(null!==lt&&(nt.isAnEndpoint(lt)||(Kt=lt),!Ye.isAnEndpoint(lt))){const se=this._splitSafely(Ye,lt);for(let ve=0,ye=se.length;ve<ye;ve++)Dt.push(se[ve])}}if(null!==Je||null!==Kt){let lt=null;lt=null===Je?Kt:null===Kt||Er.comparePoints(Je,Kt)<=0?Je:Kt,this.queue.remove(nt.rightSE),Dt.push(nt.rightSE);const se=nt.split(lt);for(let ve=0,ye=se.length;ve<ye;ve++)Dt.push(se[ve])}Dt.length>0?(this.tree.remove(nt),Dt.push(W)):(this.segments.push(nt),nt.prev=ke)}else{if(ke&&Ye){const Je=ke.getIntersection(Ye);if(null!==Je){if(!ke.isAnEndpoint(Je)){const Kt=this._splitSafely(ke,Je);for(let lt=0,se=Kt.length;lt<se;lt++)Dt.push(Kt[lt])}if(!Ye.isAnEndpoint(Je)){const Kt=this._splitSafely(Ye,Je);for(let lt=0,se=Kt.length;lt<se;lt++)Dt.push(Kt[lt])}}}this.tree.remove(nt)}return Dt}_splitSafely(W,nt){this.tree.remove(W);const Dt=W.rightSE;this.queue.remove(Dt);const Jt=W.split(nt);return Jt.push(Dt),void 0===W.consumedBy&&this.tree.add(W),Jt}}const rn=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Rn=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;const Sn=new class jn{run(W,nt,Dt){Sn.type=W,ut.reset();const Jt=[new Gt(nt,!0)];for(let lt=0,se=Dt.length;lt<se;lt++)Jt.push(new Gt(Dt[lt],!1));if(Sn.numMultiPolys=Jt.length,"difference"===Sn.type){const lt=Jt[0];let se=1;for(;se<Jt.length;)null!==pt(Jt[se].bbox,lt.bbox)?se++:Jt.splice(se,1)}if("intersection"===Sn.type)for(let lt=0,se=Jt.length;lt<se;lt++){const ve=Jt[lt];for(let ye=lt+1,je=Jt.length;ye<je;ye++)if(null===pt(ve.bbox,Jt[ye].bbox))return[]}const Xt=new ie(Er.compare);for(let lt=0,se=Jt.length;lt<se;lt++){const ve=Jt[lt].getSweepEvents();for(let ye=0,je=ve.length;ye<je;ye++)if(Xt.insert(ve[ye]),Xt.size>rn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const Ue=new gn(Xt);let ke=Xt.size,Ye=Xt.pop();for(;Ye;){const lt=Ye.key;if(Xt.size===ke){const ve=lt.segment;throw new Error(`Unable to pop() ${lt.isLeft?"left":"right"} SweepEvent [${lt.point.x}, ${lt.point.y}] from segment #${ve.id} [${ve.leftSE.point.x}, ${ve.leftSE.point.y}] -> [${ve.rightSE.point.x}, ${ve.rightSE.point.y}] from queue.`)}if(Xt.size>rn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(Ue.segments.length>Rn)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const se=Ue.process(lt);for(let ve=0,ye=se.length;ve<ye;ve++){const je=se[ve];void 0===je.consumedBy&&Xt.insert(je)}ke=Xt.size,Ye=Xt.pop()}ut.reset();const Je=Ve.factory(Ue.segments);return new We(Je).getGeom()}};var Hr={union:function(fe){for(var W=arguments.length,nt=new Array(W>1?W-1:0),Dt=1;Dt<W;Dt++)nt[Dt-1]=arguments[Dt];return Sn.run("union",fe,nt)},intersection:function(fe){for(var W=arguments.length,nt=new Array(W>1?W-1:0),Dt=1;Dt<W;Dt++)nt[Dt-1]=arguments[Dt];return Sn.run("intersection",fe,nt)},xor:function(fe){for(var W=arguments.length,nt=new Array(W>1?W-1:0),Dt=1;Dt<W;Dt++)nt[Dt-1]=arguments[Dt];return Sn.run("xor",fe,nt)},difference:function(fe){for(var W=arguments.length,nt=new Array(W>1?W-1:0),Dt=1;Dt<W;Dt++)nt[Dt-1]=arguments[Dt];return Sn.run("difference",fe,nt)}};return Hr}()},7861:(nn,we,Tt)=>{"use strict";nn.exports=Rt,nn.exports.default=Rt;var Ct=Tt(2136);function Rt(ot,gt){if(!(this instanceof Rt))return new Rt(ot,gt);this._maxEntries=Math.max(4,ot||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),gt&&this._initFormat(gt),this.clear()}function oe(ot,gt,ct){if(!ct)return gt.indexOf(ot);for(var kt=0;kt<gt.length;kt++)if(ct(ot,gt[kt]))return kt;return-1}function Pt(ot,gt){rt(ot,0,ot.children.length,gt,ot)}function rt(ot,gt,ct,kt,ut){ut||(ut=pt(null)),ut.minX=1/0,ut.minY=1/0,ut.maxX=-1/0,ut.maxY=-1/0;for(var ht,H=gt;H<ct;H++)ht=ot.children[H],zt(ut,ot.leaf?kt(ht):ht);return ut}function zt(ot,gt){return ot.minX=Math.min(ot.minX,gt.minX),ot.minY=Math.min(ot.minY,gt.minY),ot.maxX=Math.max(ot.maxX,gt.maxX),ot.maxY=Math.max(ot.maxY,gt.maxY),ot}function ie(ot,gt){return ot.minX-gt.minX}function Yt(ot,gt){return ot.minY-gt.minY}function Me(ot){return(ot.maxX-ot.minX)*(ot.maxY-ot.minY)}function Be(ot){return ot.maxX-ot.minX+(ot.maxY-ot.minY)}function Ce(ot,gt){return(Math.max(gt.maxX,ot.maxX)-Math.min(gt.minX,ot.minX))*(Math.max(gt.maxY,ot.maxY)-Math.min(gt.minY,ot.minY))}function ee(ot,gt){var ct=Math.max(ot.minX,gt.minX),kt=Math.max(ot.minY,gt.minY),ut=Math.min(ot.maxX,gt.maxX),H=Math.min(ot.maxY,gt.maxY);return Math.max(0,ut-ct)*Math.max(0,H-kt)}function _e(ot,gt){return ot.minX<=gt.minX&&ot.minY<=gt.minY&&gt.maxX<=ot.maxX&&gt.maxY<=ot.maxY}function an(ot,gt){return gt.minX<=ot.maxX&&gt.minY<=ot.maxY&&gt.maxX>=ot.minX&&gt.maxY>=ot.minY}function pt(ot){return{children:ot,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function mt(ot,gt,ct,kt,ut){for(var ht,H=[gt,ct];H.length;)!((ct=H.pop())-(gt=H.pop())<=kt)&&(ht=gt+Math.ceil((ct-gt)/kt/2)*kt,Ct(ot,ht,gt,ct,ut),H.push(gt,ht,ht,ct))}Rt.prototype={all:function(){return this._all(this.data,[])},search:function(ot){var gt=this.data,ct=[],kt=this.toBBox;if(!an(ot,gt))return ct;for(var H,ht,J,ue,ut=[];gt;){for(H=0,ht=gt.children.length;H<ht;H++)J=gt.children[H],an(ot,ue=gt.leaf?kt(J):J)&&(gt.leaf?ct.push(J):_e(ot,ue)?this._all(J,ct):ut.push(J));gt=ut.pop()}return ct},collides:function(ot){var gt=this.data,ct=this.toBBox;if(!an(ot,gt))return!1;for(var ut,H,ht,J,kt=[];gt;){for(ut=0,H=gt.children.length;ut<H;ut++)if(ht=gt.children[ut],an(ot,J=gt.leaf?ct(ht):ht)){if(gt.leaf||_e(ot,J))return!0;kt.push(ht)}gt=kt.pop()}return!1},load:function(ot){if(!ot||!ot.length)return this;if(ot.length<this._minEntries){for(var gt=0,ct=ot.length;gt<ct;gt++)this.insert(ot[gt]);return this}var kt=this._build(ot.slice(),0,ot.length-1,0);if(this.data.children.length)if(this.data.height===kt.height)this._splitRoot(this.data,kt);else{if(this.data.height<kt.height){var ut=this.data;this.data=kt,kt=ut}this._insert(kt,this.data.height-kt.height-1,!0)}else this.data=kt;return this},insert:function(ot){return ot&&this._insert(ot,this.data.height-1),this},clear:function(){return this.data=pt([]),this},remove:function(ot,gt){if(!ot)return this;for(var ht,J,ue,St,ct=this.data,kt=this.toBBox(ot),ut=[],H=[];ct||ut.length;){if(ct||(ct=ut.pop(),J=ut[ut.length-1],ht=H.pop(),St=!0),ct.leaf&&-1!==(ue=oe(ot,ct.children,gt)))return ct.children.splice(ue,1),ut.push(ct),this._condense(ut),this;St||ct.leaf||!_e(ct,kt)?J?(ht++,ct=J.children[ht],St=!1):ct=null:(ut.push(ct),H.push(ht),ht=0,J=ct,ct=ct.children[0])}return this},toBBox:function(ot){return ot},compareMinX:ie,compareMinY:Yt,toJSON:function(){return this.data},fromJSON:function(ot){return this.data=ot,this},_all:function(ot,gt){for(var ct=[];ot;)ot.leaf?gt.push.apply(gt,ot.children):ct.push.apply(ct,ot.children),ot=ct.pop();return gt},_build:function(ot,gt,ct,kt){var ht,ut=ct-gt+1,H=this._maxEntries;if(ut<=H)return Pt(ht=pt(ot.slice(gt,ct+1)),this.toBBox),ht;kt||(kt=Math.ceil(Math.log(ut)/Math.log(H)),H=Math.ceil(ut/Math.pow(H,kt-1))),(ht=pt([])).leaf=!1,ht.height=kt;var St,Ht,Et,cn,J=Math.ceil(ut/H),ue=J*Math.ceil(Math.sqrt(H));for(mt(ot,gt,ct,ue,this.compareMinX),St=gt;St<=ct;St+=ue)for(mt(ot,St,Et=Math.min(St+ue-1,ct),J,this.compareMinY),Ht=St;Ht<=Et;Ht+=J)cn=Math.min(Ht+J-1,Et),ht.children.push(this._build(ot,Ht,cn,kt-1));return Pt(ht,this.toBBox),ht},_chooseSubtree:function(ot,gt,ct,kt){for(var ut,H,ht,J,ue,St,Ht,Et;kt.push(gt),!gt.leaf&&kt.length-1!==ct;){for(Ht=Et=1/0,ut=0,H=gt.children.length;ut<H;ut++)ue=Me(ht=gt.children[ut]),(St=Ce(ot,ht)-ue)<Et?(Et=St,Ht=ue<Ht?ue:Ht,J=ht):St===Et&&ue<Ht&&(Ht=ue,J=ht);gt=J||gt.children[0]}return gt},_insert:function(ot,gt,ct){var ut=ct?ot:(0,this.toBBox)(ot),H=[],ht=this._chooseSubtree(ut,this.data,gt,H);for(ht.children.push(ot),zt(ht,ut);gt>=0&&H[gt].children.length>this._maxEntries;)this._split(H,gt),gt--;this._adjustParentBBoxes(ut,H,gt)},_split:function(ot,gt){var ct=ot[gt],kt=ct.children.length,ut=this._minEntries;this._chooseSplitAxis(ct,ut,kt);var H=this._chooseSplitIndex(ct,ut,kt),ht=pt(ct.children.splice(H,ct.children.length-H));ht.height=ct.height,ht.leaf=ct.leaf,Pt(ct,this.toBBox),Pt(ht,this.toBBox),gt?ot[gt-1].children.push(ht):this._splitRoot(ct,ht)},_splitRoot:function(ot,gt){this.data=pt([ot,gt]),this.data.height=ot.height+1,this.data.leaf=!1,Pt(this.data,this.toBBox)},_chooseSplitIndex:function(ot,gt,ct){var kt,ut,H,ht,J,ue,St,Ht;for(ue=St=1/0,kt=gt;kt<=ct-gt;kt++)ht=ee(ut=rt(ot,0,kt,this.toBBox),H=rt(ot,kt,ct,this.toBBox)),J=Me(ut)+Me(H),ht<ue?(ue=ht,Ht=kt,St=J<St?J:St):ht===ue&&J<St&&(St=J,Ht=kt);return Ht},_chooseSplitAxis:function(ot,gt,ct){var kt=ot.leaf?this.compareMinX:ie,ut=ot.leaf?this.compareMinY:Yt;this._allDistMargin(ot,gt,ct,kt)<this._allDistMargin(ot,gt,ct,ut)&&ot.children.sort(kt)},_allDistMargin:function(ot,gt,ct,kt){ot.children.sort(kt);var ue,St,ut=this.toBBox,H=rt(ot,0,gt,ut),ht=rt(ot,ct-gt,ct,ut),J=Be(H)+Be(ht);for(ue=gt;ue<ct-gt;ue++)St=ot.children[ue],zt(H,ot.leaf?ut(St):St),J+=Be(H);for(ue=ct-gt-1;ue>=gt;ue--)St=ot.children[ue],zt(ht,ot.leaf?ut(St):St),J+=Be(ht);return J},_adjustParentBBoxes:function(ot,gt,ct){for(var kt=ct;kt>=0;kt--)zt(gt[kt],ot)},_condense:function(ot){for(var ct,gt=ot.length-1;gt>=0;gt--)0===ot[gt].children.length?gt>0?(ct=ot[gt-1].children).splice(ct.indexOf(ot[gt]),1):this.clear():Pt(ot[gt],this.toBBox)},_initFormat:function(ot){var gt=["return a"," - b",";"];this.compareMinX=new Function("a","b",gt.join(ot[0])),this.compareMinY=new Function("a","b",gt.join(ot[1])),this.toBBox=new Function("a","return {minX: a"+ot[0]+", minY: a"+ot[1]+", maxX: a"+ot[2]+", maxY: a"+ot[3]+"};")}}},2136:function(nn){nn.exports=function(){"use strict";function Tt(oe,Pt,rt,zt,ie){for(;zt>rt;){if(zt-rt>600){var Yt=zt-rt+1,Me=Pt-rt+1,Be=Math.log(Yt),Ce=.5*Math.exp(2*Be/3),ee=.5*Math.sqrt(Be*Ce*(Yt-Ce)/Yt)*(Me-Yt/2<0?-1:1);Tt(oe,Pt,Math.max(rt,Math.floor(Pt-Me*Ce/Yt+ee)),Math.min(zt,Math.floor(Pt+(Yt-Me)*Ce/Yt+ee)),ie)}var pt=oe[Pt],mt=rt,ot=zt;for(Ct(oe,rt,Pt),ie(oe[zt],pt)>0&&Ct(oe,rt,zt);mt<ot;){for(Ct(oe,mt,ot),mt++,ot--;ie(oe[mt],pt)<0;)mt++;for(;ie(oe[ot],pt)>0;)ot--}0===ie(oe[rt],pt)?Ct(oe,rt,ot):Ct(oe,++ot,zt),ot<=Pt&&(rt=ot+1),Pt<=ot&&(zt=ot-1)}}function Ct(oe,Pt,rt){var zt=oe[Pt];oe[Pt]=oe[rt],oe[rt]=zt}function Rt(oe,Pt){return oe<Pt?-1:oe>Pt?1:0}return function we(oe,Pt,rt,zt,ie){Tt(oe,Pt,rt||0,zt||oe.length-1,ie||Rt)}}()},3817:(nn,we,Tt)=>{"use strict";var Ct=Tt(9789),Rt=Tt(5223),oe=Object;nn.exports=Ct(function(){if(null==this||this!==oe(this))throw new Rt("RegExp.prototype.flags getter called on non-object");var rt="";return this.hasIndices&&(rt+="d"),this.global&&(rt+="g"),this.ignoreCase&&(rt+="i"),this.multiline&&(rt+="m"),this.dotAll&&(rt+="s"),this.unicode&&(rt+="u"),this.unicodeSets&&(rt+="v"),this.sticky&&(rt+="y"),rt},"get flags",!0)},1139:(nn,we,Tt)=>{"use strict";var Ct=Tt(1648),Rt=Tt(5436),oe=Tt(3817),Pt=Tt(4861),rt=Tt(6002),zt=Rt(Pt());Ct(zt,{getPolyfill:Pt,implementation:oe,shim:rt}),nn.exports=zt},4861:(nn,we,Tt)=>{"use strict";var Ct=Tt(3817),Rt=Tt(1648).supportsDescriptors,oe=Object.getOwnPropertyDescriptor;nn.exports=function(){if(Rt&&"gim"===/a/gim.flags){var rt=oe(RegExp.prototype,"flags");if(rt&&"function"==typeof rt.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var zt="",ie={};if(Object.defineProperty(ie,"hasIndices",{get:function(){zt+="d"}}),Object.defineProperty(ie,"sticky",{get:function(){zt+="y"}}),"dy"===zt)return rt.get}}return Ct}},6002:(nn,we,Tt)=>{"use strict";var Ct=Tt(1648).supportsDescriptors,Rt=Tt(4861),oe=Object.getOwnPropertyDescriptor,Pt=Object.defineProperty,rt=TypeError,zt=Object.getPrototypeOf,ie=/a/;nn.exports=function(){if(!Ct||!zt)throw new rt("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var Me=Rt(),Be=zt(ie),Ce=oe(Be,"flags");return(!Ce||Ce.get!==Me)&&Pt(Be,"flags",{configurable:!0,enumerable:!1,get:Me}),Me}},6138:function(nn,we){!function(Tt){"use strict";function oe(_e,an,pt,mt,ot){let gt,ct,kt,ut,H=an[0],ht=mt[0],J=0,ue=0;ht>H==ht>-H?(gt=H,H=an[++J]):(gt=ht,ht=mt[++ue]);let St=0;if(J<_e&&ue<pt)for(ht>H==ht>-H?(kt=gt-((ct=H+gt)-H),H=an[++J]):(kt=gt-((ct=ht+gt)-ht),ht=mt[++ue]),gt=ct,0!==kt&&(ot[St++]=kt);J<_e&&ue<pt;)ht>H==ht>-H?(kt=gt-((ct=gt+H)-(ut=ct-gt))+(H-ut),H=an[++J]):(kt=gt-((ct=gt+ht)-(ut=ct-gt))+(ht-ut),ht=mt[++ue]),gt=ct,0!==kt&&(ot[St++]=kt);for(;J<_e;)kt=gt-((ct=gt+H)-(ut=ct-gt))+(H-ut),H=an[++J],gt=ct,0!==kt&&(ot[St++]=kt);for(;ue<pt;)kt=gt-((ct=gt+ht)-(ut=ct-gt))+(ht-ut),ht=mt[++ue],gt=ct,0!==kt&&(ot[St++]=kt);return 0===gt&&0!==St||(ot[St++]=gt),St}function Pt(_e){return new Float64Array(_e)}const Yt=Pt(4),Me=Pt(8),Be=Pt(12),Ce=Pt(16),ee=Pt(4);Tt.orient2d=function(_e,an,pt,mt,ot,gt){const ct=(an-gt)*(pt-ot),kt=(_e-ot)*(mt-gt),ut=ct-kt;if(0===ct||0===kt||ct>0!=kt>0)return ut;const H=Math.abs(ct+kt);return Math.abs(ut)>=33306690738754716e-32*H?ut:-function(ht,J,ue,St,Ht,Et,cn){let en,Ft,de,Vt,At,ne,wt,Le,Pe,pe,Fe,Ln,On,yn,Yn,Gn,hn,Er;const di=ht-Ht,Te=ue-Ht,st=J-Et,vt=St-Et;At=(Yn=(Le=di-(wt=(ne=134217729*di)-(ne-di)))*(pe=vt-(Pe=(ne=134217729*vt)-(ne-vt)))-((yn=di*vt)-wt*Pe-Le*Pe-wt*pe))-(Fe=Yn-(hn=(Le=st-(wt=(ne=134217729*st)-(ne-st)))*(pe=Te-(Pe=(ne=134217729*Te)-(ne-Te)))-((Gn=st*Te)-wt*Pe-Le*Pe-wt*pe))),Yt[0]=Yn-(Fe+At)+(At-hn),At=(On=yn-((Ln=yn+Fe)-(At=Ln-yn))+(Fe-At))-(Fe=On-Gn),Yt[1]=On-(Fe+At)+(At-Gn),At=(Er=Ln+Fe)-Ln,Yt[2]=Ln-(Er-At)+(Fe-At),Yt[3]=Er;let Gt=function(rn,Rn){let jn=Rn[0];for(let Sn=1;Sn<4;Sn++)jn+=Rn[Sn];return jn}(0,Yt),Ve=22204460492503146e-32*cn;if(Gt>=Ve||-Gt>=Ve||(en=ht-(di+(At=ht-di))+(At-Ht),de=ue-(Te+(At=ue-Te))+(At-Ht),Ft=J-(st+(At=J-st))+(At-Et),Vt=St-(vt+(At=St-vt))+(At-Et),0===en&&0===Ft&&0===de&&0===Vt)||(Ve=11093356479670487e-47*cn+33306690738754706e-32*Math.abs(Gt),(Gt+=di*Vt+vt*en-(st*de+Te*Ft))>=Ve||-Gt>=Ve))return Gt;At=(Yn=(Le=en-(wt=(ne=134217729*en)-(ne-en)))*(pe=vt-(Pe=(ne=134217729*vt)-(ne-vt)))-((yn=en*vt)-wt*Pe-Le*Pe-wt*pe))-(Fe=Yn-(hn=(Le=Ft-(wt=(ne=134217729*Ft)-(ne-Ft)))*(pe=Te-(Pe=(ne=134217729*Te)-(ne-Te)))-((Gn=Ft*Te)-wt*Pe-Le*Pe-wt*pe))),ee[0]=Yn-(Fe+At)+(At-hn),At=(On=yn-((Ln=yn+Fe)-(At=Ln-yn))+(Fe-At))-(Fe=On-Gn),ee[1]=On-(Fe+At)+(At-Gn),At=(Er=Ln+Fe)-Ln,ee[2]=Ln-(Er-At)+(Fe-At),ee[3]=Er;const sn=oe(4,Yt,4,ee,Me);At=(Yn=(Le=di-(wt=(ne=134217729*di)-(ne-di)))*(pe=Vt-(Pe=(ne=134217729*Vt)-(ne-Vt)))-((yn=di*Vt)-wt*Pe-Le*Pe-wt*pe))-(Fe=Yn-(hn=(Le=st-(wt=(ne=134217729*st)-(ne-st)))*(pe=de-(Pe=(ne=134217729*de)-(ne-de)))-((Gn=st*de)-wt*Pe-Le*Pe-wt*pe))),ee[0]=Yn-(Fe+At)+(At-hn),At=(On=yn-((Ln=yn+Fe)-(At=Ln-yn))+(Fe-At))-(Fe=On-Gn),ee[1]=On-(Fe+At)+(At-Gn),At=(Er=Ln+Fe)-Ln,ee[2]=Ln-(Er-At)+(Fe-At),ee[3]=Er;const We=oe(sn,Me,4,ee,Be);At=(Yn=(Le=en-(wt=(ne=134217729*en)-(ne-en)))*(pe=Vt-(Pe=(ne=134217729*Vt)-(ne-Vt)))-((yn=en*Vt)-wt*Pe-Le*Pe-wt*pe))-(Fe=Yn-(hn=(Le=Ft-(wt=(ne=134217729*Ft)-(ne-Ft)))*(pe=de-(Pe=(ne=134217729*de)-(ne-de)))-((Gn=Ft*de)-wt*Pe-Le*Pe-wt*pe))),ee[0]=Yn-(Fe+At)+(At-hn),At=(On=yn-((Ln=yn+Fe)-(At=Ln-yn))+(Fe-At))-(Fe=On-Gn),ee[1]=On-(Fe+At)+(At-Gn),At=(Er=Ln+Fe)-Ln,ee[2]=Ln-(Er-At)+(Fe-At),ee[3]=Er;const gn=oe(We,Be,4,ee,Ce);return Ce[gn-1]}(_e,an,pt,mt,ot,gt,H)},Tt.orient2dfast=function(_e,an,pt,mt,ot,gt){return(an-gt)*(pt-ot)-(_e-ot)*(mt-gt)},Object.defineProperty(Tt,"__esModule",{value:!0})}(we)},2245:(nn,we,Tt)=>{"use strict";var Ct=Tt(491),Rt=Tt(9224),oe=Tt(2486)(),Pt=Tt(9262),rt=Tt(5223),zt=Ct("%Math.floor%");nn.exports=function(Yt,Me){if("function"!=typeof Yt)throw new rt("`fn` is not a function");if("number"!=typeof Me||Me<0||Me>4294967295||zt(Me)!==Me)throw new rt("`length` must be a positive 32-bit integer");var Be=arguments.length>2&&!!arguments[2],Ce=!0,ee=!0;if("length"in Yt&&Pt){var _e=Pt(Yt,"length");_e&&!_e.configurable&&(Ce=!1),_e&&!_e.writable&&(ee=!1)}return(Ce||ee||!Be)&&(oe?Rt(Yt,"length",Me,!0,!0):Rt(Yt,"length",Me)),Yt}},9789:(nn,we,Tt)=>{"use strict";var Ct=Tt(9224),Rt=Tt(2486)(),oe=Tt(1552).functionsHaveConfigurableNames(),Pt=Tt(5223);nn.exports=function(zt,ie){if("function"!=typeof zt)throw new Pt("`fn` is not a function");return(!(arguments.length>2&&arguments[2])||oe)&&(Rt?Ct(zt,"name",ie,!0,!0):Ct(zt,"name",ie)),zt}},9579:nn=>{"use strict";nn.exports={eudist:function(Tt,Ct,Rt){for(var oe=Tt.length,Pt=0,rt=0;rt<oe;rt++){var zt=(Tt[rt]||0)-(Ct[rt]||0);Pt+=zt*zt}return Rt?Math.sqrt(Pt):Pt},mandist:function(Tt,Ct,Rt){for(var oe=Tt.length,Pt=0,rt=0;rt<oe;rt++)Pt+=Math.abs((Tt[rt]||0)-(Ct[rt]||0));return Rt?Math.sqrt(Pt):Pt},dist:function(Tt,Ct,Rt){var oe=Math.abs(Tt-Ct);return Rt?oe:oe*oe}}},7180:(nn,we,Tt)=>{"use strict";var Ct=Tt(9579),Rt=Ct.eudist,oe=Ct.dist;nn.exports={kmrand:function(rt,zt){for(var ie={},Yt=[],Me=zt<<2,Be=rt.length,Ce=rt[0].length>0;Yt.length<zt&&Me-- >0;){var ee=rt[Math.floor(Math.random()*Be)],_e=Ce?ee.join("_"):""+ee;ie[_e]||(ie[_e]=!0,Yt.push(ee))}if(Yt.length<zt)throw new Error("Error initializating clusters");return Yt},kmpp:function(rt,zt){var ie=rt[0].length?Rt:oe,Yt=[],Me=rt.length,Be=rt[0].length>0,ee=rt[Math.floor(Math.random()*Me)];for(Be&&ee.join("_"),Yt.push(ee);Yt.length<zt;){for(var an=[],pt=Yt.length,mt=0,ot=[],gt=0;gt<Me;gt++){for(var ct=1/0,kt=0;kt<pt;kt++){var ut=ie(rt[gt],Yt[kt]);ut<=ct&&(ct=ut)}an[gt]=ct}for(var H=0;H<Me;H++)mt+=an[H];for(var ht=0;ht<Me;ht++)ot[ht]={i:ht,v:rt[ht],pr:an[ht]/mt,cs:0};ot.sort(function(Ht,Et){return Ht.pr-Et.pr}),ot[0].cs=ot[0].pr;for(var J=1;J<Me;J++)ot[J].cs=ot[J-1].cs+ot[J].pr;for(var ue=Math.random(),St=0;St<Me-1&&ot[St++].cs<ue;);Yt.push(ot[St-1].v)}return Yt}}},3282:(nn,we,Tt)=>{"use strict";var Ct=Tt(9579),Rt=Tt(7180),oe=Ct.eudist,zt=Rt.kmrand,ie=Rt.kmpp;function Me(Ce,ee,_e){_e=_e||[];for(var an=0;an<Ce;an++)_e[an]=ee;return _e}nn.exports=function Be(Ce,ee,_e,an){var pt=[],mt=[],ot=[],gt=[],ct=!1,kt=an||1e4,ut=Ce.length,H=Ce[0].length,ht=H>0,J=[];if(_e)pt="kmrand"==_e?zt(Ce,ee):"kmpp"==_e?ie(Ce,ee):_e;else for(var ue={};pt.length<ee;){var St=Math.floor(Math.random()*ut);ue[St]||(ue[St]=!0,pt.push(Ce[St]))}do{Me(ee,0,J);for(var Ht=0;Ht<ut;Ht++){for(var Et=1/0,cn=0,en=0;en<ee;en++)(gt=ht?oe(Ce[Ht],pt[en]):Math.abs(Ce[Ht]-pt[en]))<=Et&&(Et=gt,cn=en);ot[Ht]=cn,J[cn]++}for(var Ft=[],Vt=(mt=[],0);Vt<ee;Vt++)Ft[Vt]=ht?Me(H,0,Ft[Vt]):0,mt[Vt]=pt[Vt];if(ht){for(var At=0;At<ee;At++)pt[At]=[];for(var ne=0;ne<ut;ne++)for(var Le=Ft[ot[ne]],Pe=Ce[ne],pe=0;pe<H;pe++)Le[pe]+=Pe[pe];ct=!0;for(var Fe=0;Fe<ee;Fe++){for(var Ln=pt[Fe],On=Ft[Fe],yn=mt[Fe],Yn=J[Fe],Gn=0;Gn<H;Gn++)Ln[Gn]=On[Gn]/Yn||0;if(ct)for(var hn=0;hn<H;hn++)if(yn[hn]!=Ln[hn]){ct=!1;break}}}else{for(var Er=0;Er<ut;Er++)Ft[ot[Er]]+=Ce[Er];for(var Te=0;Te<ee;Te++)pt[Te]=Ft[Te]/J[Te]||0;ct=!0;for(var st=0;st<ee;st++)if(mt[st]!=pt[st]){ct=!1;break}}ct=ct||--kt<=0}while(!ct);return{it:1e4-kt,k:ee,idxs:ot,centroids:pt}}},7935:(nn,we,Tt)=>{"use strict";Tt.r(we),Tt.d(we,{default:()=>Ct});class Ct{constructor(Pt=[],rt=Rt){if(this.data=Pt,this.length=this.data.length,this.compare=rt,this.length>0)for(let zt=(this.length>>1)-1;zt>=0;zt--)this._down(zt)}push(Pt){this.data.push(Pt),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const Pt=this.data[0],rt=this.data.pop();return this.length--,this.length>0&&(this.data[0]=rt,this._down(0)),Pt}peek(){return this.data[0]}_up(Pt){const{data:rt,compare:zt}=this,ie=rt[Pt];for(;Pt>0;){const Yt=Pt-1>>1,Me=rt[Yt];if(zt(ie,Me)>=0)break;rt[Pt]=Me,Pt=Yt}rt[Pt]=ie}_down(Pt){const{data:rt,compare:zt}=this,ie=this.length>>1,Yt=rt[Pt];for(;Pt<ie;){let Me=1+(Pt<<1),Be=rt[Me];const Ce=Me+1;if(Ce<this.length&&zt(rt[Ce],Be)<0&&(Me=Ce,Be=rt[Ce]),zt(Be,Yt)>=0)break;rt[Pt]=Be,Pt=Me}rt[Pt]=Yt}}function Rt(oe,Pt){return oe<Pt?-1:oe>Pt?1:0}},4855:function(nn,we){!function(Tt){"use strict";function Ct(){}function Rt(f){this.message=f||""}function oe(f){this.message=f||""}function Pt(f){this.message=f||""}function rt(){}function zt(f){return null===f?En:f.color}function ie(f){return null===f?null:f.parent}function Yt(f,d){null!==f&&(f.color=d)}function Me(f){return null===f?null:f.left}function Be(f){return null===f?null:f.right}function Ce(){this.root_=null,this.size_=0}function ee(){}function _e(){this.array_=[],arguments[0]instanceof Ye&&this.addAll(arguments[0])}function an(){}function pt(f){this.message=f||""}function mt(){this.array_=[]}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(f){if(null==this)throw new TypeError(this+" is not an object");var d=Object(this),v=Math.max(Math.min(d.length,9007199254740991),0)||0,w=1 in arguments&&parseInt(Number(arguments[1]),10)||0;w=w<0?Math.max(v+w,0):Math.min(w,v);var T=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:v;for(T=T<0?Math.max(v+arguments[2],0):Math.min(T,v);w<T;)d[w]=f,++w;return d},writable:!0}),Number.isFinite=Number.isFinite||function(f){return"number"==typeof f&&isFinite(f)},Number.isInteger=Number.isInteger||function(f){return"number"==typeof f&&isFinite(f)&&Math.floor(f)===f},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(f){return f!=f},Math.trunc=Math.trunc||function(f){return f<0?Math.ceil(f):Math.floor(f)};var ot=function(){};ot.prototype.interfaces_=function(){return[]},ot.prototype.getClass=function(){return ot},ot.prototype.equalsWithTolerance=function(f,d,v){return Math.abs(f-d)<=v};var gt=function(f){function d(v){f.call(this,v),this.name="IllegalArgumentException",this.message=v,this.stack=(new f).stack}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d}(Error),ct=function(){},kt={MAX_VALUE:{configurable:!0}};ct.isNaN=function(f){return Number.isNaN(f)},ct.doubleToLongBits=function(f){return f},ct.longBitsToDouble=function(f){return f},ct.isInfinite=function(f){return!Number.isFinite(f)},kt.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(ct,kt);var ut=function(){},H=function(){},ht=function(){},J=function f(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=f.NULL_ORDINATE;else if(1===arguments.length){var d=arguments[0];this.x=d.x,this.y=d.y,this.z=d.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=f.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},ue={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};J.prototype.setOrdinate=function(f,d){switch(f){case J.X:this.x=d;break;case J.Y:this.y=d;break;case J.Z:this.z=d;break;default:throw new gt("Invalid ordinate index: "+f)}},J.prototype.equals2D=function(){if(1===arguments.length){var f=arguments[0];return this.x===f.x&&this.y===f.y}if(2===arguments.length){var d=arguments[0],v=arguments[1];return!!ot.equalsWithTolerance(this.x,d.x,v)&&!!ot.equalsWithTolerance(this.y,d.y,v)}},J.prototype.getOrdinate=function(f){switch(f){case J.X:return this.x;case J.Y:return this.y;case J.Z:return this.z}throw new gt("Invalid ordinate index: "+f)},J.prototype.equals3D=function(f){return this.x===f.x&&this.y===f.y&&(this.z===f.z||ct.isNaN(this.z))&&ct.isNaN(f.z)},J.prototype.equals=function(f){return f instanceof J&&this.equals2D(f)},J.prototype.equalInZ=function(f,d){return ot.equalsWithTolerance(this.z,f.z,d)},J.prototype.compareTo=function(f){return this.x<f.x?-1:this.x>f.x?1:this.y<f.y?-1:this.y>f.y?1:0},J.prototype.clone=function(){},J.prototype.copy=function(){return new J(this)},J.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},J.prototype.distance3D=function(f){var d=this.x-f.x,v=this.y-f.y,w=this.z-f.z;return Math.sqrt(d*d+v*v+w*w)},J.prototype.distance=function(f){var d=this.x-f.x,v=this.y-f.y;return Math.sqrt(d*d+v*v)},J.prototype.hashCode=function(){var f=17;return 37*(f=37*f+J.hashCode(this.x))+J.hashCode(this.y)},J.prototype.setCoordinate=function(f){this.x=f.x,this.y=f.y,this.z=f.z},J.prototype.interfaces_=function(){return[ut,H,Ct]},J.prototype.getClass=function(){return J},J.hashCode=function(){if(1===arguments.length){var d=ct.doubleToLongBits(arguments[0]);return Math.trunc((d^d)>>>32)}},ue.DimensionalComparator.get=function(){return St},ue.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},ue.NULL_ORDINATE.get=function(){return ct.NaN},ue.X.get=function(){return 0},ue.Y.get=function(){return 1},ue.Z.get=function(){return 2},Object.defineProperties(J,ue);var St=function(f){if(this._dimensionsToTest=2,0!==arguments.length&&1===arguments.length){var d=arguments[0];if(2!==d&&3!==d)throw new gt("only 2 or 3 dimensions may be specified");this._dimensionsToTest=d}};St.prototype.compare=function(f,d){var v=f,w=d,T=St.compare(v.x,w.x);if(0!==T)return T;var k=St.compare(v.y,w.y);return 0!==k?k:this._dimensionsToTest<=2?0:St.compare(v.z,w.z)},St.prototype.interfaces_=function(){return[ht]},St.prototype.getClass=function(){return St},St.compare=function(f,d){return f<d?-1:f>d?1:ct.isNaN(f)?ct.isNaN(d)?0:-1:ct.isNaN(d)?1:0};var Ht=function(){};Ht.prototype.create=function(){},Ht.prototype.interfaces_=function(){return[]},Ht.prototype.getClass=function(){return Ht};var Et=function(){},cn={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Et.prototype.interfaces_=function(){return[]},Et.prototype.getClass=function(){return Et},Et.toLocationSymbol=function(f){switch(f){case Et.EXTERIOR:return"e";case Et.BOUNDARY:return"b";case Et.INTERIOR:return"i";case Et.NONE:return"-"}throw new gt("Unknown location value: "+f)},cn.INTERIOR.get=function(){return 0},cn.BOUNDARY.get=function(){return 1},cn.EXTERIOR.get=function(){return 2},cn.NONE.get=function(){return-1},Object.defineProperties(Et,cn);var en=function(f,d){return f.interfaces_&&f.interfaces_().indexOf(d)>-1},Ft=function(){},de={LOG_10:{configurable:!0}};Ft.prototype.interfaces_=function(){return[]},Ft.prototype.getClass=function(){return Ft},Ft.log10=function(f){var d=Math.log(f);return ct.isInfinite(d)||ct.isNaN(d)?d:d/Ft.LOG_10},Ft.min=function(f,d,v,w){var T=f;return d<T&&(T=d),v<T&&(T=v),w<T&&(T=w),T},Ft.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var f=arguments[0],d=arguments[1],v=arguments[2];return f<d?d:f>v?v:f}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var w=arguments[0],T=arguments[1],k=arguments[2];return w<T?T:w>k?k:w}},Ft.wrap=function(f,d){return f<0?d- -f%d:f%d},Ft.max=function(){if(3===arguments.length){var d=arguments[1],v=arguments[2],w=arguments[0];return d>w&&(w=d),v>w&&(w=v),w}if(4===arguments.length){var k=arguments[1],q=arguments[2],K=arguments[3],Mt=arguments[0];return k>Mt&&(Mt=k),q>Mt&&(Mt=q),K>Mt&&(Mt=K),Mt}},Ft.average=function(f,d){return(f+d)/2},de.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(Ft,de);var Vt=function(f){this.str=f};Vt.prototype.append=function(f){this.str+=f},Vt.prototype.setCharAt=function(f,d){this.str=this.str.substr(0,f)+d+this.str.substr(f+1)},Vt.prototype.toString=function(f){return this.str};var At=function(f){this.value=f};At.prototype.intValue=function(){return this.value},At.prototype.compareTo=function(f){return this.value<f?-1:this.value>f?1:0},At.isNaN=function(f){return Number.isNaN(f)};var ne=function(){};ne.isWhitespace=function(f){return f<=32&&f>=0||127===f},ne.toUpperCase=function(f){return f.toUpperCase()};var wt=function f(){this._hi=0,this._lo=0,0===arguments.length?this.init(0):1===arguments.length?"number"==typeof arguments[0]||arguments[0]instanceof f?this.init(arguments[0]):"string"==typeof arguments[0]&&f.call(this,f.parse(arguments[0])):2===arguments.length&&this.init(arguments[0],arguments[1])},Le={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};wt.prototype.le=function(f){return(this._hi<f._hi||this._hi===f._hi)&&this._lo<=f._lo},wt.prototype.extractSignificantDigits=function(f,d){var v=this.abs(),w=wt.magnitude(v._hi),T=wt.TEN.pow(w);(v=v.divide(T)).gt(wt.TEN)?(v=v.divide(wt.TEN),w+=1):v.lt(wt.ONE)&&(v=v.multiply(wt.TEN),w-=1);for(var k=w+1,q=new Vt,K=wt.MAX_PRINT_DIGITS-1,Mt=0;Mt<=K;Mt++){f&&Mt===k&&q.append(".");var ae=Math.trunc(v._hi);if(ae<0)break;var Ze=!1,Qe=0;ae>9?(Ze=!0,Qe="9"):Qe="0"+ae,q.append(Qe),v=v.subtract(wt.valueOf(ae)).multiply(wt.TEN),Ze&&v.selfAdd(wt.TEN);var Pn=!0,Bn=wt.magnitude(v._hi);if(Bn<0&&Math.abs(Bn)>=K-Mt&&(Pn=!1),!Pn)break}return d[0]=w,q.toString()},wt.prototype.sqr=function(){return this.multiply(this)},wt.prototype.doubleValue=function(){return this._hi+this._lo},wt.prototype.subtract=function(){return arguments[0]instanceof wt?this.add(arguments[0].negate()):"number"==typeof arguments[0]?this.add(-arguments[0]):void 0},wt.prototype.equals=function(){if(1===arguments.length){var f=arguments[0];return this._hi===f._hi&&this._lo===f._lo}},wt.prototype.isZero=function(){return 0===this._hi&&0===this._lo},wt.prototype.selfSubtract=function(){if(arguments[0]instanceof wt){var f=arguments[0];return this.isNaN()?this:this.selfAdd(-f._hi,-f._lo)}if("number"==typeof arguments[0]){var d=arguments[0];return this.isNaN()?this:this.selfAdd(-d,0)}},wt.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},wt.prototype.min=function(f){return this.le(f)?this:f},wt.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof wt){var f=arguments[0];return this.selfDivide(f._hi,f._lo)}if("number"==typeof arguments[0])return this.selfDivide(arguments[0],0)}else if(2===arguments.length){var k,K,Mt,Ze,v=arguments[0],T=null,q=null,ae=null,Qe=null;return this._hi=Qe=(Mt=this._hi/v)+(ae=(this._hi-(Ze=Mt*v)-(Qe=(T=(ae=wt.SPLIT*Mt)-(T=ae-Mt))*(q=(Qe=wt.SPLIT*v)-(q=Qe-v))-Ze+T*(K=v-q)+(k=Mt-T)*q+k*K)+this._lo-Mt*arguments[1])/v),this._lo=Mt-Qe+ae,this}},wt.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},wt.prototype.divide=function(){if(arguments[0]instanceof wt){var v,T,k,K,f=arguments[0],d=null,w=null,q=null,Mt=null;return v=(k=this._hi/f._hi)-(d=(q=wt.SPLIT*k)-(d=q-k)),Mt=d*(w=(Mt=wt.SPLIT*f._hi)-(w=Mt-f._hi))-(K=k*f._hi)+d*(T=f._hi-w)+v*w+v*T,new wt(Mt=k+(q=(this._hi-K-Mt+this._lo-k*f._lo)/f._hi),k-Mt+q)}if("number"==typeof arguments[0]){var ae=arguments[0];return ct.isNaN(ae)?wt.createNaN():wt.copy(this).selfDivide(ae,0)}},wt.prototype.ge=function(f){return(this._hi>f._hi||this._hi===f._hi)&&this._lo>=f._lo},wt.prototype.pow=function(f){if(0===f)return wt.valueOf(1);var d=new wt(this),v=wt.valueOf(1),w=Math.abs(f);if(w>1)for(;w>0;)w%2==1&&v.selfMultiply(d),(w/=2)>0&&(d=d.sqr());else v=d;return f<0?v.reciprocal():v},wt.prototype.ceil=function(){if(this.isNaN())return wt.NaN;var f=Math.ceil(this._hi),d=0;return f===this._hi&&(d=Math.ceil(this._lo)),new wt(f,d)},wt.prototype.compareTo=function(f){return this._hi<f._hi?-1:this._hi>f._hi?1:this._lo<f._lo?-1:this._lo>f._lo?1:0},wt.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},wt.prototype.setValue=function(){return arguments[0]instanceof wt||"number"==typeof arguments[0]?(this.init(arguments[0]),this):void 0},wt.prototype.max=function(f){return this.ge(f)?this:f},wt.prototype.sqrt=function(){if(this.isZero())return wt.valueOf(0);if(this.isNegative())return wt.NaN;var f=1/Math.sqrt(this._hi),v=wt.valueOf(this._hi*f),w=this.subtract(v.sqr())._hi*(.5*f);return v.add(w)},wt.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof wt){var f=arguments[0];return this.selfAdd(f._hi,f._lo)}if("number"==typeof arguments[0]){var v,w,T,q,K,d=arguments[0];return this._hi=(v=(T=this._hi+d)+(K=d-(q=T-this._hi)+(this._hi-(T-q))+this._lo))+(w=K+(T-v)),this._lo=w+(v-this._hi),this}}else if(2===arguments.length){var Ze,Qe,Bn,Ki,Mt=arguments[0],ae=arguments[1],Pn=null,tr=null,_r=null;tr=(Bn=this._hi+Mt)-(_r=Bn-this._hi),Pn=(Qe=this._lo+ae)-(Ki=Qe-this._lo);var Ps=(Ze=Bn+(_r=(tr=Mt-_r+(this._hi-tr))+Qe))+(_r=(Pn=ae-Ki+(this._lo-Pn))+(_r+(Bn-Ze))),Aa=_r+(Ze-Ps);return this._hi=Ps,this._lo=Aa,this}},wt.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof wt){var f=arguments[0];return this.selfMultiply(f._hi,f._lo)}if("number"==typeof arguments[0])return this.selfMultiply(arguments[0],0)}else if(2===arguments.length){var k,K,v=arguments[0],T=null,q=null,Mt=null,ae=null;T=(Mt=wt.SPLIT*this._hi)-this._hi,T=Mt-T;var Ze=(Mt=this._hi*v)+(ae=T*(q=(ae=wt.SPLIT*v)-(q=ae-v))-Mt+T*(K=v-q)+(k=this._hi-T)*q+k*K+(this._hi*arguments[1]+this._lo*v)),Qe=ae+(T=Mt-Ze);return this._hi=Ze,this._lo=Qe,this}},wt.prototype.selfSqr=function(){return this.selfMultiply(this)},wt.prototype.floor=function(){if(this.isNaN())return wt.NaN;var f=Math.floor(this._hi),d=0;return f===this._hi&&(d=Math.floor(this._lo)),new wt(f,d)},wt.prototype.negate=function(){return this.isNaN()?this:new wt(-this._hi,-this._lo)},wt.prototype.clone=function(){},wt.prototype.multiply=function(){if(arguments[0]instanceof wt){var f=arguments[0];return f.isNaN()?wt.createNaN():wt.copy(this).selfMultiply(f)}if("number"==typeof arguments[0]){var d=arguments[0];return ct.isNaN(d)?wt.createNaN():wt.copy(this).selfMultiply(d,0)}},wt.prototype.isNaN=function(){return ct.isNaN(this._hi)},wt.prototype.intValue=function(){return Math.trunc(this._hi)},wt.prototype.toString=function(){var f=wt.magnitude(this._hi);return f>=-3&&f<=20?this.toStandardNotation():this.toSciNotation()},wt.prototype.toStandardNotation=function(){var f=this.getSpecialNumberString();if(null!==f)return f;var d=new Array(1).fill(null),v=this.extractSignificantDigits(!0,d),w=d[0]+1,T=v;return"."===v.charAt(0)?T="0"+v:w<0?T="0."+wt.stringOfChar("0",-w)+v:-1===v.indexOf(".")&&(T=v+wt.stringOfChar("0",w-v.length)+".0"),this.isNegative()?"-"+T:T},wt.prototype.reciprocal=function(){var d,w,T,q,f=null,v=null,k=null,K=null;d=(T=1/this._hi)-(f=(k=wt.SPLIT*T)-(f=k-T)),v=(K=wt.SPLIT*this._hi)-this._hi;var Mt=T+(k=(1-(q=T*this._hi)-(K=f*(v=K-v)-q+f*(w=this._hi-v)+d*v+d*w)-T*this._lo)/this._hi);return new wt(Mt,T-Mt+k)},wt.prototype.toSciNotation=function(){if(this.isZero())return wt.SCI_NOT_ZERO;var f=this.getSpecialNumberString();if(null!==f)return f;var d=new Array(1).fill(null),v=this.extractSignificantDigits(!1,d),w=wt.SCI_NOT_EXPONENT_CHAR+d[0];if("0"===v.charAt(0))throw new Error("Found leading zero: "+v);var T="";v.length>1&&(T=v.substring(1));var k=v.charAt(0)+"."+T;return this.isNegative()?"-"+k+w:k+w},wt.prototype.abs=function(){return this.isNaN()?wt.NaN:this.isNegative()?this.negate():new wt(this)},wt.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},wt.prototype.lt=function(f){return(this._hi<f._hi||this._hi===f._hi)&&this._lo<f._lo},wt.prototype.add=function(){if(arguments[0]instanceof wt){var f=arguments[0];return wt.copy(this).selfAdd(f)}if("number"==typeof arguments[0]){var d=arguments[0];return wt.copy(this).selfAdd(d)}},wt.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0])this._hi=arguments[0],this._lo=0;else if(arguments[0]instanceof wt){var d=arguments[0];this._hi=d._hi,this._lo=d._lo}}else if(2===arguments.length){var w=arguments[1];this._hi=arguments[0],this._lo=w}},wt.prototype.gt=function(f){return(this._hi>f._hi||this._hi===f._hi)&&this._lo>f._lo},wt.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},wt.prototype.trunc=function(){return this.isNaN()?wt.NaN:this.isPositive()?this.floor():this.ceil()},wt.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},wt.prototype.interfaces_=function(){return[Ct,ut,H]},wt.prototype.getClass=function(){return wt},wt.sqr=function(f){return wt.valueOf(f).selfMultiply(f)},wt.valueOf=function(){return"string"==typeof arguments[0]?wt.parse(arguments[0]):"number"==typeof arguments[0]?new wt(arguments[0]):void 0},wt.sqrt=function(f){return wt.valueOf(f).sqrt()},wt.parse=function(f){for(var d=0,v=f.length;ne.isWhitespace(f.charAt(d));)d++;var w=!1;if(d<v){var T=f.charAt(d);"-"!==T&&"+"!==T||(d++,"-"===T&&(w=!0))}for(var k=new wt,q=0,K=0,Mt=0;!(d>=v);){var ae=f.charAt(d);if(d++,ne.isDigit(ae)){var Ze=ae-"0";k.selfMultiply(wt.TEN),k.selfAdd(Ze),q++}else{if("."!==ae){if("e"===ae||"E"===ae){var Qe=f.substring(d);try{Mt=At.parseInt(Qe)}catch(Ki){throw Ki instanceof Error?new Error("Invalid exponent "+Qe+" in string "+f):Ki}break}throw new Error("Unexpected character '"+ae+"' at position "+d+" in string "+f)}K=q}}var Pn=k,Bn=q-K-Mt;if(0===Bn)Pn=k;else if(Bn>0){var tr=wt.TEN.pow(Bn);Pn=k.divide(tr)}else if(Bn<0){var _r=wt.TEN.pow(-Bn);Pn=k.multiply(_r)}return w?Pn.negate():Pn},wt.createNaN=function(){return new wt(ct.NaN,ct.NaN)},wt.copy=function(f){return new wt(f)},wt.magnitude=function(f){var d=Math.abs(f),v=Math.log(d)/Math.log(10),w=Math.trunc(Math.floor(v));return 10*Math.pow(10,w)<=d&&(w+=1),w},wt.stringOfChar=function(f,d){for(var v=new Vt,w=0;w<d;w++)v.append(f);return v.toString()},Le.PI.get=function(){return new wt(3.141592653589793,12246467991473532e-32)},Le.TWO_PI.get=function(){return new wt(6.283185307179586,24492935982947064e-32)},Le.PI_2.get=function(){return new wt(1.5707963267948966,6123233995736766e-32)},Le.E.get=function(){return new wt(2.718281828459045,14456468917292502e-32)},Le.NaN.get=function(){return new wt(ct.NaN,ct.NaN)},Le.EPS.get=function(){return 123259516440783e-46},Le.SPLIT.get=function(){return 134217729},Le.MAX_PRINT_DIGITS.get=function(){return 32},Le.TEN.get=function(){return wt.valueOf(10)},Le.ONE.get=function(){return wt.valueOf(1)},Le.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},Le.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(wt,Le);var Pe=function(){},pe={DP_SAFE_EPSILON:{configurable:!0}};Pe.prototype.interfaces_=function(){return[]},Pe.prototype.getClass=function(){return Pe},Pe.orientationIndex=function(f,d,v){var w=Pe.orientationIndexFilter(f,d,v);if(w<=1)return w;var T=wt.valueOf(d.x).selfAdd(-f.x),k=wt.valueOf(d.y).selfAdd(-f.y),q=wt.valueOf(v.x).selfAdd(-d.x),K=wt.valueOf(v.y).selfAdd(-d.y);return T.selfMultiply(K).selfSubtract(k.selfMultiply(q)).signum()},Pe.signOfDet2x2=function(f,d,v,w){return f.multiply(w).selfSubtract(d.multiply(v)).signum()},Pe.intersection=function(f,d,v,w){var T=wt.valueOf(w.y).selfSubtract(v.y).selfMultiply(wt.valueOf(d.x).selfSubtract(f.x)),k=wt.valueOf(w.x).selfSubtract(v.x).selfMultiply(wt.valueOf(d.y).selfSubtract(f.y)),q=T.subtract(k),K=wt.valueOf(w.x).selfSubtract(v.x).selfMultiply(wt.valueOf(f.y).selfSubtract(v.y)),Mt=wt.valueOf(w.y).selfSubtract(v.y).selfMultiply(wt.valueOf(f.x).selfSubtract(v.x)),ae=K.subtract(Mt).selfDivide(q).doubleValue(),Ze=wt.valueOf(f.x).selfAdd(wt.valueOf(d.x).selfSubtract(f.x).selfMultiply(ae)).doubleValue(),Qe=wt.valueOf(d.x).selfSubtract(f.x).selfMultiply(wt.valueOf(f.y).selfSubtract(v.y)),Pn=wt.valueOf(d.y).selfSubtract(f.y).selfMultiply(wt.valueOf(f.x).selfSubtract(v.x)),Bn=Qe.subtract(Pn).selfDivide(q).doubleValue(),tr=wt.valueOf(v.y).selfAdd(wt.valueOf(w.y).selfSubtract(v.y).selfMultiply(Bn)).doubleValue();return new J(Ze,tr)},Pe.orientationIndexFilter=function(f,d,v){var w=null,T=(f.x-v.x)*(d.y-v.y),k=(f.y-v.y)*(d.x-v.x),q=T-k;if(T>0){if(k<=0)return Pe.signum(q);w=T+k}else{if(!(T<0)||k>=0)return Pe.signum(q);w=-T-k}var K=Pe.DP_SAFE_EPSILON*w;return q>=K||-q>=K?Pe.signum(q):2},Pe.signum=function(f){return f>0?1:f<0?-1:0},pe.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(Pe,pe);var Fe=function(){},Ln={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Ln.X.get=function(){return 0},Ln.Y.get=function(){return 1},Ln.Z.get=function(){return 2},Ln.M.get=function(){return 3},Fe.prototype.setOrdinate=function(f,d,v){},Fe.prototype.size=function(){},Fe.prototype.getOrdinate=function(f,d){},Fe.prototype.getCoordinate=function(){},Fe.prototype.getCoordinateCopy=function(f){},Fe.prototype.getDimension=function(){},Fe.prototype.getX=function(f){},Fe.prototype.clone=function(){},Fe.prototype.expandEnvelope=function(f){},Fe.prototype.copy=function(){},Fe.prototype.getY=function(f){},Fe.prototype.toCoordinateArray=function(){},Fe.prototype.interfaces_=function(){return[H]},Fe.prototype.getClass=function(){return Fe},Object.defineProperties(Fe,Ln);var On=function(){},yn=function(f){function d(){f.call(this,"Projective point not representable on the Cartesian plane.")}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d}(On),Yn=function(){};Yn.arraycopy=function(f,d,v,w,T){for(var k=0,q=d;q<d+T;q++)v[w+k]=f[q],k++},Yn.getProperty=function(f){return{"line.separator":"\n"}[f]};var Gn=function f(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var d=arguments[0];this.x=d.x,this.y=d.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var w=arguments[1];this.x=arguments[0],this.y=w,this.w=1}else if(arguments[0]instanceof f&&arguments[1]instanceof f){var T=arguments[0],k=arguments[1];this.x=T.y*k.w-k.y*T.w,this.y=k.x*T.w-T.x*k.w,this.w=T.x*k.y-k.x*T.y}else if(arguments[0]instanceof J&&arguments[1]instanceof J){var q=arguments[0],K=arguments[1];this.x=q.y-K.y,this.y=K.x-q.x,this.w=q.x*K.y-K.x*q.y}}else if(3===arguments.length){var ae=arguments[1],Ze=arguments[2];this.x=arguments[0],this.y=ae,this.w=Ze}else if(4===arguments.length){var Qe=arguments[0],Pn=arguments[1],Bn=arguments[2],tr=arguments[3],_r=Qe.y-Pn.y,Ki=Pn.x-Qe.x,Ps=Qe.x*Pn.y-Pn.x*Qe.y,Aa=Bn.y-tr.y,Nu=tr.x-Bn.x,Ec=Bn.x*tr.y-tr.x*Bn.y;this.x=Ki*Ec-Nu*Ps,this.y=Aa*Ps-_r*Ec,this.w=_r*Nu-Aa*Ki}};Gn.prototype.getY=function(){var f=this.y/this.w;if(ct.isNaN(f)||ct.isInfinite(f))throw new yn;return f},Gn.prototype.getX=function(){var f=this.x/this.w;if(ct.isNaN(f)||ct.isInfinite(f))throw new yn;return f},Gn.prototype.getCoordinate=function(){var f=new J;return f.x=this.getX(),f.y=this.getY(),f},Gn.prototype.interfaces_=function(){return[]},Gn.prototype.getClass=function(){return Gn},Gn.intersection=function(f,d,v,w){var T=f.y-d.y,k=d.x-f.x,q=f.x*d.y-d.x*f.y,K=v.y-w.y,Mt=w.x-v.x,ae=v.x*w.y-w.x*v.y,Ze=T*Mt-K*k,Qe=(k*ae-Mt*q)/Ze,Pn=(K*q-T*ae)/Ze;if(ct.isNaN(Qe)||ct.isInfinite(Qe)||ct.isNaN(Pn)||ct.isInfinite(Pn))throw new yn;return new J(Qe,Pn)};var hn=function f(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length)if(arguments[0]instanceof J){var d=arguments[0];this.init(d.x,d.x,d.y,d.y)}else arguments[0]instanceof f&&this.init(arguments[0]);else if(2===arguments.length){var w=arguments[0],T=arguments[1];this.init(w.x,T.x,w.y,T.y)}else 4===arguments.length&&this.init(arguments[0],arguments[1],arguments[2],arguments[3])},Er={serialVersionUID:{configurable:!0}};hn.prototype.getArea=function(){return this.getWidth()*this.getHeight()},hn.prototype.equals=function(f){if(!(f instanceof hn))return!1;var d=f;return this.isNull()?d.isNull():this._maxx===d.getMaxX()&&this._maxy===d.getMaxY()&&this._minx===d.getMinX()&&this._miny===d.getMinY()},hn.prototype.intersection=function(f){return this.isNull()||f.isNull()||!this.intersects(f)?new hn:new hn(this._minx>f._minx?this._minx:f._minx,this._maxx<f._maxx?this._maxx:f._maxx,this._miny>f._miny?this._miny:f._miny,this._maxy<f._maxy?this._maxy:f._maxy)},hn.prototype.isNull=function(){return this._maxx<this._minx},hn.prototype.getMaxX=function(){return this._maxx},hn.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof J){var f=arguments[0];return this.covers(f.x,f.y)}if(arguments[0]instanceof hn){var d=arguments[0];return!this.isNull()&&!d.isNull()&&d.getMinX()>=this._minx&&d.getMaxX()<=this._maxx&&d.getMinY()>=this._miny&&d.getMaxY()<=this._maxy}}else if(2===arguments.length){var v=arguments[0],w=arguments[1];return!this.isNull()&&v>=this._minx&&v<=this._maxx&&w>=this._miny&&w<=this._maxy}},hn.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof hn){var f=arguments[0];return!this.isNull()&&!f.isNull()&&!(f._minx>this._maxx||f._maxx<this._minx||f._miny>this._maxy||f._maxy<this._miny)}if(arguments[0]instanceof J){var d=arguments[0];return this.intersects(d.x,d.y)}}else if(2===arguments.length){var v=arguments[0],w=arguments[1];return!this.isNull()&&!(v>this._maxx||v<this._minx||w>this._maxy||w<this._miny)}},hn.prototype.getMinY=function(){return this._miny},hn.prototype.getMinX=function(){return this._minx},hn.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof J){var f=arguments[0];this.expandToInclude(f.x,f.y)}else if(arguments[0]instanceof hn){var d=arguments[0];if(d.isNull())return null;this.isNull()?(this._minx=d.getMinX(),this._maxx=d.getMaxX(),this._miny=d.getMinY(),this._maxy=d.getMaxY()):(d._minx<this._minx&&(this._minx=d._minx),d._maxx>this._maxx&&(this._maxx=d._maxx),d._miny<this._miny&&(this._miny=d._miny),d._maxy>this._maxy&&(this._maxy=d._maxy))}}else if(2===arguments.length){var v=arguments[0],w=arguments[1];this.isNull()?(this._minx=v,this._maxx=v,this._miny=w,this._maxy=w):(v<this._minx&&(this._minx=v),v>this._maxx&&(this._maxx=v),w<this._miny&&(this._miny=w),w>this._maxy&&(this._maxy=w))}},hn.prototype.minExtent=function(){if(this.isNull())return 0;var f=this.getWidth(),d=this.getHeight();return f<d?f:d},hn.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},hn.prototype.compareTo=function(f){var d=f;return this.isNull()?d.isNull()?0:-1:d.isNull()?1:this._minx<d._minx?-1:this._minx>d._minx?1:this._miny<d._miny?-1:this._miny>d._miny?1:this._maxx<d._maxx?-1:this._maxx>d._maxx?1:this._maxy<d._maxy?-1:this._maxy>d._maxy?1:0},hn.prototype.translate=function(f,d){if(this.isNull())return null;this.init(this.getMinX()+f,this.getMaxX()+f,this.getMinY()+d,this.getMaxY()+d)},hn.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},hn.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},hn.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},hn.prototype.maxExtent=function(){if(this.isNull())return 0;var f=this.getWidth(),d=this.getHeight();return f>d?f:d},hn.prototype.expandBy=function(){if(1===arguments.length){var f=arguments[0];this.expandBy(f,f)}else if(2===arguments.length){var d=arguments[0],v=arguments[1];if(this.isNull())return null;this._minx-=d,this._maxx+=d,this._miny-=v,this._maxy+=v,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},hn.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof hn)return this.covers(arguments[0]);if(arguments[0]instanceof J)return this.covers(arguments[0])}else if(2===arguments.length)return this.covers(arguments[0],arguments[1])},hn.prototype.centre=function(){return this.isNull()?null:new J((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},hn.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof J){var f=arguments[0];this.init(f.x,f.x,f.y,f.y)}else if(arguments[0]instanceof hn){var d=arguments[0];this._minx=d._minx,this._maxx=d._maxx,this._miny=d._miny,this._maxy=d._maxy}}else if(2===arguments.length){var v=arguments[0],w=arguments[1];this.init(v.x,w.x,v.y,w.y)}else if(4===arguments.length){var T=arguments[0],k=arguments[1],q=arguments[2],K=arguments[3];T<k?(this._minx=T,this._maxx=k):(this._minx=k,this._maxx=T),q<K?(this._miny=q,this._maxy=K):(this._miny=K,this._maxy=q)}},hn.prototype.getMaxY=function(){return this._maxy},hn.prototype.distance=function(f){if(this.intersects(f))return 0;var d=0;this._maxx<f._minx?d=f._minx-this._maxx:this._minx>f._maxx&&(d=this._minx-f._maxx);var v=0;return this._maxy<f._miny?v=f._miny-this._maxy:this._miny>f._maxy&&(v=this._miny-f._maxy),0===d?v:0===v?d:Math.sqrt(d*d+v*v)},hn.prototype.hashCode=function(){var f=17;return 37*(f=37*(f=37*(f=37*f+J.hashCode(this._minx))+J.hashCode(this._maxx))+J.hashCode(this._miny))+J.hashCode(this._maxy)},hn.prototype.interfaces_=function(){return[ut,Ct]},hn.prototype.getClass=function(){return hn},hn.intersects=function(){if(3===arguments.length){var f=arguments[0],d=arguments[1],v=arguments[2];return v.x>=(f.x<d.x?f.x:d.x)&&v.x<=(f.x>d.x?f.x:d.x)&&v.y>=(f.y<d.y?f.y:d.y)&&v.y<=(f.y>d.y?f.y:d.y)}if(4===arguments.length){var w=arguments[0],T=arguments[1],k=arguments[2],q=arguments[3],K=Math.min(k.x,q.x),Mt=Math.max(k.x,q.x),ae=Math.min(w.x,T.x),Ze=Math.max(w.x,T.x);return!(ae>Mt||Ze<K||(K=Math.min(k.y,q.y),Mt=Math.max(k.y,q.y),ae=Math.min(w.y,T.y),Ze=Math.max(w.y,T.y),ae>Mt||Ze<K))}},Er.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(hn,Er);var di={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Te=function(f){this.geometryFactory=f||new Hn};Te.prototype.read=function(f){var d,v;f=f.replace(/[\n\r]/g," ");var T=di.typeStr.exec(f);if(-1!==f.search("EMPTY")&&((T=di.emptyTypeStr.exec(f))[2]=void 0),T&&(v=T[1].toLowerCase(),vt[v]&&(d=vt[v].apply(this,[T[2]]))),void 0===d)throw new Error("Could not parse WKT "+f);return d},Te.prototype.write=function(f){return this.extractGeometry(f)},Te.prototype.extractGeometry=function(f){var d=f.getGeometryType().toLowerCase();if(!st[d])return null;var v=d.toUpperCase();return f.isEmpty()?v+" EMPTY":v+"("+st[d].apply(this,[f])+")"};var st={coordinate:function(f){return f.x+" "+f.y},point:function(f){return st.coordinate.call(this,f._coordinates._coordinates[0])},multipoint:function(f){for(var d=[],v=0,w=f._geometries.length;v<w;++v)d.push("("+st.point.apply(this,[f._geometries[v]])+")");return d.join(",")},linestring:function(f){for(var d=[],v=0,w=f._points._coordinates.length;v<w;++v)d.push(st.coordinate.apply(this,[f._points._coordinates[v]]));return d.join(",")},linearring:function(f){for(var d=[],v=0,w=f._points._coordinates.length;v<w;++v)d.push(st.coordinate.apply(this,[f._points._coordinates[v]]));return d.join(",")},multilinestring:function(f){for(var d=[],v=0,w=f._geometries.length;v<w;++v)d.push("("+st.linestring.apply(this,[f._geometries[v]])+")");return d.join(",")},polygon:function(f){var d=[];d.push("("+st.linestring.apply(this,[f._shell])+")");for(var v=0,w=f._holes.length;v<w;++v)d.push("("+st.linestring.apply(this,[f._holes[v]])+")");return d.join(",")},multipolygon:function(f){for(var d=[],v=0,w=f._geometries.length;v<w;++v)d.push("("+st.polygon.apply(this,[f._geometries[v]])+")");return d.join(",")},geometrycollection:function(f){for(var d=[],v=0,w=f._geometries.length;v<w;++v)d.push(this.extractGeometry(f._geometries[v]));return d.join(",")}},vt={point:function(f){if(void 0===f)return this.geometryFactory.createPoint();var d=f.trim().split(di.spaces);return this.geometryFactory.createPoint(new J(Number.parseFloat(d[0]),Number.parseFloat(d[1])))},multipoint:function(f){if(void 0===f)return this.geometryFactory.createMultiPoint();for(var d,v=f.trim().split(","),w=[],T=0,k=v.length;T<k;++T)d=v[T].replace(di.trimParens,"$1"),w.push(vt.point.apply(this,[d]));return this.geometryFactory.createMultiPoint(w)},linestring:function(f){if(void 0===f)return this.geometryFactory.createLineString();for(var d,v=f.trim().split(","),w=[],T=0,k=v.length;T<k;++T)d=v[T].trim().split(di.spaces),w.push(new J(Number.parseFloat(d[0]),Number.parseFloat(d[1])));return this.geometryFactory.createLineString(w)},linearring:function(f){if(void 0===f)return this.geometryFactory.createLinearRing();for(var d,v=f.trim().split(","),w=[],T=0,k=v.length;T<k;++T)d=v[T].trim().split(di.spaces),w.push(new J(Number.parseFloat(d[0]),Number.parseFloat(d[1])));return this.geometryFactory.createLinearRing(w)},multilinestring:function(f){if(void 0===f)return this.geometryFactory.createMultiLineString();for(var d,v=f.trim().split(di.parenComma),w=[],T=0,k=v.length;T<k;++T)d=v[T].replace(di.trimParens,"$1"),w.push(vt.linestring.apply(this,[d]));return this.geometryFactory.createMultiLineString(w)},polygon:function(f){if(void 0===f)return this.geometryFactory.createPolygon();for(var d,v,w,T,k=f.trim().split(di.parenComma),q=[],K=0,Mt=k.length;K<Mt;++K)d=k[K].replace(di.trimParens,"$1"),v=vt.linestring.apply(this,[d]),w=this.geometryFactory.createLinearRing(v._points),0===K?T=w:q.push(w);return this.geometryFactory.createPolygon(T,q)},multipolygon:function(f){if(void 0===f)return this.geometryFactory.createMultiPolygon();for(var d,v=f.trim().split(di.doubleParenComma),w=[],T=0,k=v.length;T<k;++T)d=v[T].replace(di.trimParens,"$1"),w.push(vt.polygon.apply(this,[d]));return this.geometryFactory.createMultiPolygon(w)},geometrycollection:function(f){if(void 0===f)return this.geometryFactory.createGeometryCollection();for(var d=(f=f.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),v=[],w=0,T=d.length;w<T;++w)v.push(this.read(d[w]));return this.geometryFactory.createGeometryCollection(v)}},Gt=function(f){this.parser=new Te(f)};Gt.prototype.write=function(f){return this.parser.write(f)},Gt.toLineString=function(f,d){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+f.x+" "+f.y+", "+d.x+" "+d.y+" )"};var Ve=function(f){function d(v){f.call(this,v),this.name="RuntimeException",this.message=v,this.stack=(new f).stack}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d}(Error),sn=function(f){function d(){f.call(this),0===arguments.length?f.call(this):1===arguments.length&&f.call(this,arguments[0])}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d}(Ve),We=function(){};We.prototype.interfaces_=function(){return[]},We.prototype.getClass=function(){return We},We.shouldNeverReachHere=function(){if(0===arguments.length)We.shouldNeverReachHere(null);else if(1===arguments.length){var f=arguments[0];throw new sn("Should never reach here"+(null!==f?": "+f:""))}},We.isTrue=function(){var d;if(1===arguments.length)We.isTrue(arguments[0],null);else if(2===arguments.length&&(d=arguments[1],!arguments[0]))throw null===d?new sn:new sn(d)},We.equals=function(){var f,d,v;if(2===arguments.length)We.equals(f=arguments[0],d=arguments[1],null);else if(3===arguments.length&&(v=arguments[2],!(d=arguments[1]).equals(f=arguments[0])))throw new sn("Expected "+f+" but encountered "+d+(null!==v?": "+v:""))};var gn=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new J,this._intPt[1]=new J,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},rn={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};gn.prototype.getIndexAlongSegment=function(f,d){return this.computeIntLineIndex(),this._intLineIndex[f][d]},gn.prototype.getTopologySummary=function(){var f=new Vt;return this.isEndPoint()&&f.append(" endpoint"),this._isProper&&f.append(" proper"),this.isCollinear()&&f.append(" collinear"),f.toString()},gn.prototype.computeIntersection=function(f,d,v,w){this._inputLines[0][0]=f,this._inputLines[0][1]=d,this._inputLines[1][0]=v,this._inputLines[1][1]=w,this._result=this.computeIntersect(f,d,v,w)},gn.prototype.getIntersectionNum=function(){return this._result},gn.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var f=arguments[0];this.getEdgeDistance(f,0)>this.getEdgeDistance(f,1)?(this._intLineIndex[f][0]=0,this._intLineIndex[f][1]=1):(this._intLineIndex[f][0]=1,this._intLineIndex[f][1]=0)}},gn.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},gn.prototype.setPrecisionModel=function(f){this._precisionModel=f},gn.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var f=arguments[0],d=0;d<this._result;d++)if(!this._intPt[d].equals2D(this._inputLines[f][0])&&!this._intPt[d].equals2D(this._inputLines[f][1]))return!0;return!1}},gn.prototype.getIntersection=function(f){return this._intPt[f]},gn.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},gn.prototype.hasIntersection=function(){return this._result!==gn.NO_INTERSECTION},gn.prototype.getEdgeDistance=function(f,d){return gn.computeEdgeDistance(this._intPt[d],this._inputLines[f][0],this._inputLines[f][1])},gn.prototype.isCollinear=function(){return this._result===gn.COLLINEAR_INTERSECTION},gn.prototype.toString=function(){return Gt.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Gt.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},gn.prototype.getEndpoint=function(f,d){return this._inputLines[f][d]},gn.prototype.isIntersection=function(f){for(var d=0;d<this._result;d++)if(this._intPt[d].equals2D(f))return!0;return!1},gn.prototype.getIntersectionAlongSegment=function(f,d){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[f][d]]},gn.prototype.interfaces_=function(){return[]},gn.prototype.getClass=function(){return gn},gn.computeEdgeDistance=function(f,d,v){var w=Math.abs(v.x-d.x),T=Math.abs(v.y-d.y),k=-1;if(f.equals(d))k=0;else if(f.equals(v))k=w>T?w:T;else{var q=Math.abs(f.x-d.x),K=Math.abs(f.y-d.y);0!==(k=w>T?q:K)||f.equals(d)||(k=Math.max(q,K))}return We.isTrue(!(0===k&&!f.equals(d)),"Bad distance calculation"),k},gn.nonRobustComputeEdgeDistance=function(f,d,v){var w=f.x-d.x,T=f.y-d.y,k=Math.sqrt(w*w+T*T);return We.isTrue(!(0===k&&!f.equals(d)),"Invalid distance calculation"),k},rn.DONT_INTERSECT.get=function(){return 0},rn.DO_INTERSECT.get=function(){return 1},rn.COLLINEAR.get=function(){return 2},rn.NO_INTERSECTION.get=function(){return 0},rn.POINT_INTERSECTION.get=function(){return 1},rn.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(gn,rn);var Rn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.isInSegmentEnvelopes=function(v){var w=new hn(this._inputLines[0][0],this._inputLines[0][1]),T=new hn(this._inputLines[1][0],this._inputLines[1][1]);return w.contains(v)&&T.contains(v)},d.prototype.computeIntersection=function(){if(3!==arguments.length)return f.prototype.computeIntersection.apply(this,arguments);var v=arguments[0],w=arguments[1],T=arguments[2];if(this._isProper=!1,hn.intersects(w,T,v)&&0===mn.orientationIndex(w,T,v)&&0===mn.orientationIndex(T,w,v))return this._isProper=!0,(v.equals(w)||v.equals(T))&&(this._isProper=!1),this._result=f.POINT_INTERSECTION,null;this._result=f.NO_INTERSECTION},d.prototype.normalizeToMinimum=function(v,w,T,k,q){q.x=this.smallestInAbsValue(v.x,w.x,T.x,k.x),q.y=this.smallestInAbsValue(v.y,w.y,T.y,k.y),v.x-=q.x,v.y-=q.y,w.x-=q.x,w.y-=q.y,T.x-=q.x,T.y-=q.y,k.x-=q.x,k.y-=q.y},d.prototype.safeHCoordinateIntersection=function(v,w,T,k){var q=null;try{q=Gn.intersection(v,w,T,k)}catch(K){if(!(K instanceof yn))throw K;q=d.nearestEndpoint(v,w,T,k)}return q},d.prototype.intersection=function(v,w,T,k){var q=this.intersectionWithNormalization(v,w,T,k);return this.isInSegmentEnvelopes(q)||(q=new J(d.nearestEndpoint(v,w,T,k))),null!==this._precisionModel&&this._precisionModel.makePrecise(q),q},d.prototype.smallestInAbsValue=function(v,w,T,k){var q=v,K=Math.abs(q);return Math.abs(w)<K&&(q=w,K=Math.abs(w)),Math.abs(T)<K&&(q=T,K=Math.abs(T)),Math.abs(k)<K&&(q=k),q},d.prototype.checkDD=function(v,w,T,k,q){var K=Pe.intersection(v,w,T,k),Mt=this.isInSegmentEnvelopes(K);Yn.out.println("DD in env = "+Mt+"  --------------------- "+K),q.distance(K)>1e-4&&Yn.out.println("Distance = "+q.distance(K))},d.prototype.intersectionWithNormalization=function(v,w,T,k){var q=new J(v),K=new J(w),Mt=new J(T),ae=new J(k),Ze=new J;this.normalizeToEnvCentre(q,K,Mt,ae,Ze);var Qe=this.safeHCoordinateIntersection(q,K,Mt,ae);return Qe.x+=Ze.x,Qe.y+=Ze.y,Qe},d.prototype.computeCollinearIntersection=function(v,w,T,k){var q=hn.intersects(v,w,T),K=hn.intersects(v,w,k),Mt=hn.intersects(T,k,v),ae=hn.intersects(T,k,w);return q&&K?(this._intPt[0]=T,this._intPt[1]=k,f.COLLINEAR_INTERSECTION):Mt&&ae?(this._intPt[0]=v,this._intPt[1]=w,f.COLLINEAR_INTERSECTION):q&&Mt?(this._intPt[0]=T,this._intPt[1]=v,!T.equals(v)||K||ae?f.COLLINEAR_INTERSECTION:f.POINT_INTERSECTION):q&&ae?(this._intPt[0]=T,this._intPt[1]=w,!T.equals(w)||K||Mt?f.COLLINEAR_INTERSECTION:f.POINT_INTERSECTION):K&&Mt?(this._intPt[0]=k,this._intPt[1]=v,!k.equals(v)||q||ae?f.COLLINEAR_INTERSECTION:f.POINT_INTERSECTION):K&&ae?(this._intPt[0]=k,this._intPt[1]=w,!k.equals(w)||q||Mt?f.COLLINEAR_INTERSECTION:f.POINT_INTERSECTION):f.NO_INTERSECTION},d.prototype.normalizeToEnvCentre=function(v,w,T,k,q){var K=v.x<w.x?v.x:w.x,Mt=v.y<w.y?v.y:w.y,ae=v.x>w.x?v.x:w.x,Ze=v.y>w.y?v.y:w.y,Qe=T.x<k.x?T.x:k.x,Pn=T.y<k.y?T.y:k.y,Bn=T.x>k.x?T.x:k.x,tr=T.y>k.y?T.y:k.y,Ki=((Mt>Pn?Mt:Pn)+(Ze<tr?Ze:tr))/2;q.x=((K>Qe?K:Qe)+(ae<Bn?ae:Bn))/2,q.y=Ki,v.x-=q.x,v.y-=q.y,w.x-=q.x,w.y-=q.y,T.x-=q.x,T.y-=q.y,k.x-=q.x,k.y-=q.y},d.prototype.computeIntersect=function(v,w,T,k){if(this._isProper=!1,!hn.intersects(v,w,T,k))return f.NO_INTERSECTION;var q=mn.orientationIndex(v,w,T),K=mn.orientationIndex(v,w,k);if(q>0&&K>0||q<0&&K<0)return f.NO_INTERSECTION;var Mt=mn.orientationIndex(T,k,v),ae=mn.orientationIndex(T,k,w);return Mt>0&&ae>0||Mt<0&&ae<0?f.NO_INTERSECTION:0===q&&0===K&&0===Mt&&0===ae?this.computeCollinearIntersection(v,w,T,k):(0===q||0===K||0===Mt||0===ae?(this._isProper=!1,v.equals2D(T)||v.equals2D(k)?this._intPt[0]=v:w.equals2D(T)||w.equals2D(k)?this._intPt[0]=w:0===q?this._intPt[0]=new J(T):0===K?this._intPt[0]=new J(k):0===Mt?this._intPt[0]=new J(v):0===ae&&(this._intPt[0]=new J(w))):(this._isProper=!0,this._intPt[0]=this.intersection(v,w,T,k)),f.POINT_INTERSECTION)},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d.nearestEndpoint=function(v,w,T,k){var q=v,K=mn.distancePointLine(v,T,k),Mt=mn.distancePointLine(w,T,k);return Mt<K&&(K=Mt,q=w),(Mt=mn.distancePointLine(T,v,w))<K&&(K=Mt,q=T),(Mt=mn.distancePointLine(k,v,w))<K&&(K=Mt,q=k),q},d}(gn),jn=function(){};jn.prototype.interfaces_=function(){return[]},jn.prototype.getClass=function(){return jn},jn.orientationIndex=function(f,d,v){return jn.signOfDet2x2(d.x-f.x,d.y-f.y,v.x-d.x,v.y-d.y)},jn.signOfDet2x2=function(f,d,v,w){var T=null,k=null,q=null;if(T=1,0===f||0===w)return 0===d||0===v?0:d>0?v>0?-T:T:v>0?T:-T;if(0===d||0===v)return w>0?f>0?T:-T:f>0?-T:T;if(d>0?w>0?d<=w||(T=-T,k=f,f=v,v=k,k=d,d=w,w=k):d<=-w?(T=-T,v=-v,w=-w):(k=f,f=-v,v=k,k=d,d=-w,w=k):w>0?-d<=w?(T=-T,f=-f,d=-d):(k=-f,f=v,v=k,k=-d,d=w,w=k):d>=w?(f=-f,d=-d,v=-v,w=-w):(T=-T,k=-f,f=-v,v=k,k=-d,d=-w,w=k),f>0){if(!(v>0&&f<=v))return T}else{if(v>0||!(f>=v))return-T;T=-T,f=-f,v=-v}for(;;){if((w-=(q=Math.floor(v/f))*d)<0)return-T;if(w>d)return T;if(f>(v-=q*f)+v){if(d<w+w)return T}else{if(d>w+w)return-T;v=f-v,w=d-w,T=-T}if(0===w)return 0===v?0:-T;if(0===v||(f-=(q=Math.floor(f/v))*v,(d-=q*w)<0))return T;if(d>w)return-T;if(v>f+f){if(w<d+d)return-T}else{if(w>d+d)return T;f=v-f,d=w-d,T=-T}if(0===d)return 0===f?0:T;if(0===f)return-T}};var Sn=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1,this._p=arguments[0]};Sn.prototype.countSegment=function(f,d){if(f.x<this._p.x&&d.x<this._p.x)return null;if(this._p.x===d.x&&this._p.y===d.y)return this._isPointOnSegment=!0,null;if(f.y===this._p.y&&d.y===this._p.y){var v=f.x,w=d.x;return v>w&&(v=d.x,w=f.x),this._p.x>=v&&this._p.x<=w&&(this._isPointOnSegment=!0),null}if(f.y>this._p.y&&d.y<=this._p.y||d.y>this._p.y&&f.y<=this._p.y){var k=f.y-this._p.y,K=d.y-this._p.y,Mt=jn.signOfDet2x2(f.x-this._p.x,k,d.x-this._p.x,K);if(0===Mt)return this._isPointOnSegment=!0,null;K<k&&(Mt=-Mt),Mt>0&&this._crossingCount++}},Sn.prototype.isPointInPolygon=function(){return this.getLocation()!==Et.EXTERIOR},Sn.prototype.getLocation=function(){return this._isPointOnSegment?Et.BOUNDARY:this._crossingCount%2==1?Et.INTERIOR:Et.EXTERIOR},Sn.prototype.isOnSegment=function(){return this._isPointOnSegment},Sn.prototype.interfaces_=function(){return[]},Sn.prototype.getClass=function(){return Sn},Sn.locatePointInRing=function(){if(arguments[0]instanceof J&&en(arguments[1],Fe)){for(var d=arguments[1],v=new Sn(arguments[0]),w=new J,T=new J,k=1;k<d.size();k++)if(d.getCoordinate(k,w),d.getCoordinate(k-1,T),v.countSegment(w,T),v.isOnSegment())return v.getLocation();return v.getLocation()}if(arguments[0]instanceof J&&arguments[1]instanceof Array){for(var K=arguments[1],Mt=new Sn(arguments[0]),ae=1;ae<K.length;ae++)if(Mt.countSegment(K[ae],K[ae-1]),Mt.isOnSegment())return Mt.getLocation();return Mt.getLocation()}};var mn=function(){},Ni={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};mn.prototype.interfaces_=function(){return[]},mn.prototype.getClass=function(){return mn},mn.orientationIndex=function(f,d,v){return Pe.orientationIndex(f,d,v)},mn.signedArea=function(){if(arguments[0]instanceof Array){var f=arguments[0];if(f.length<3)return 0;for(var d=0,v=f[0].x,w=1;w<f.length-1;w++)d+=(f[w].x-v)*(f[w-1].y-f[w+1].y);return d/2}if(en(arguments[0],Fe)){var q=arguments[0],K=q.size();if(K<3)return 0;var Mt=new J,ae=new J,Ze=new J;q.getCoordinate(0,ae),q.getCoordinate(1,Ze);var Qe=ae.x;Ze.x-=Qe;for(var Pn=0,Bn=1;Bn<K-1;Bn++)Mt.y=ae.y,ae.x=Ze.x,ae.y=Ze.y,q.getCoordinate(Bn+1,Ze),Ze.x-=Qe,Pn+=ae.x*(Mt.y-Ze.y);return Pn/2}},mn.distanceLineLine=function(f,d,v,w){if(f.equals(d))return mn.distancePointLine(f,v,w);if(v.equals(w))return mn.distancePointLine(w,f,d);var T=!1;if(hn.intersects(f,d,v,w)){var k=(d.x-f.x)*(w.y-v.y)-(d.y-f.y)*(w.x-v.x);if(0===k)T=!0;else{var K=((f.y-v.y)*(d.x-f.x)-(f.x-v.x)*(d.y-f.y))/k,Mt=((f.y-v.y)*(w.x-v.x)-(f.x-v.x)*(w.y-v.y))/k;(Mt<0||Mt>1||K<0||K>1)&&(T=!0)}}else T=!0;return T?Ft.min(mn.distancePointLine(f,v,w),mn.distancePointLine(d,v,w),mn.distancePointLine(v,f,d),mn.distancePointLine(w,f,d)):0},mn.isPointInRing=function(f,d){return mn.locatePointInRing(f,d)!==Et.EXTERIOR},mn.computeLength=function(f){var d=f.size();if(d<=1)return 0;var v=0,w=new J;f.getCoordinate(0,w);for(var T=w.x,k=w.y,q=1;q<d;q++){f.getCoordinate(q,w);var K=w.x,Mt=w.y,ae=K-T,Ze=Mt-k;v+=Math.sqrt(ae*ae+Ze*Ze),T=K,k=Mt}return v},mn.isCCW=function(f){var d=f.length-1;if(d<3)throw new gt("Ring has fewer than 4 points, so orientation cannot be determined");for(var v=f[0],w=0,T=1;T<=d;T++){var k=f[T];k.y>v.y&&(v=k,w=T)}var q=w;do{(q-=1)<0&&(q=d)}while(f[q].equals2D(v)&&q!==w);var K=w;do{K=(K+1)%d}while(f[K].equals2D(v)&&K!==w);var Mt=f[q],ae=f[K];if(Mt.equals2D(v)||ae.equals2D(v)||Mt.equals2D(ae))return!1;var Ze=mn.computeOrientation(Mt,v,ae);return 0===Ze?Mt.x>ae.x:Ze>0},mn.locatePointInRing=function(f,d){return Sn.locatePointInRing(f,d)},mn.distancePointLinePerpendicular=function(f,d,v){var w=(v.x-d.x)*(v.x-d.x)+(v.y-d.y)*(v.y-d.y);return Math.abs(((d.y-f.y)*(v.x-d.x)-(d.x-f.x)*(v.y-d.y))/w)*Math.sqrt(w)},mn.computeOrientation=function(f,d,v){return mn.orientationIndex(f,d,v)},mn.distancePointLine=function(){if(2===arguments.length){var f=arguments[0],d=arguments[1];if(0===d.length)throw new gt("Line array must contain at least one vertex");for(var v=f.distance(d[0]),w=0;w<d.length-1;w++){var T=mn.distancePointLine(f,d[w],d[w+1]);T<v&&(v=T)}return v}if(3===arguments.length){var k=arguments[0],q=arguments[1],K=arguments[2];if(q.x===K.x&&q.y===K.y)return k.distance(q);var Mt=(K.x-q.x)*(K.x-q.x)+(K.y-q.y)*(K.y-q.y),ae=((k.x-q.x)*(K.x-q.x)+(k.y-q.y)*(K.y-q.y))/Mt;return ae<=0?k.distance(q):ae>=1?k.distance(K):Math.abs(((q.y-k.y)*(K.x-q.x)-(q.x-k.x)*(K.y-q.y))/Mt)*Math.sqrt(Mt)}},mn.isOnLine=function(f,d){for(var v=new Rn,w=1;w<d.length;w++)if(v.computeIntersection(f,d[w-1],d[w]),v.hasIntersection())return!0;return!1},Ni.CLOCKWISE.get=function(){return-1},Ni.RIGHT.get=function(){return mn.CLOCKWISE},Ni.COUNTERCLOCKWISE.get=function(){return 1},Ni.LEFT.get=function(){return mn.COUNTERCLOCKWISE},Ni.COLLINEAR.get=function(){return 0},Ni.STRAIGHT.get=function(){return mn.COLLINEAR},Object.defineProperties(mn,Ni);var Zi=function(){};Zi.prototype.filter=function(f){},Zi.prototype.interfaces_=function(){return[]},Zi.prototype.getClass=function(){return Zi};var Nn=function(){var f=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=f,this._SRID=f.getSRID()},Hr={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Nn.prototype.isGeometryCollection=function(){return this.getSortIndex()===Nn.SORTINDEX_GEOMETRYCOLLECTION},Nn.prototype.getFactory=function(){return this._factory},Nn.prototype.getGeometryN=function(f){return this},Nn.prototype.getArea=function(){return 0},Nn.prototype.isRectangle=function(){return!1},Nn.prototype.equals=function(){if(arguments[0]instanceof Nn){var f=arguments[0];return null!==f&&this.equalsTopo(f)}if(arguments[0]instanceof Object){var d=arguments[0];return d instanceof Nn&&this.equalsExact(d)}},Nn.prototype.equalsExact=function(f){return this===f||this.equalsExact(f,0)},Nn.prototype.geometryChanged=function(){this.apply(Nn.geometryChangedFilter)},Nn.prototype.geometryChangedAction=function(){this._envelope=null},Nn.prototype.equalsNorm=function(f){return null!==f&&this.norm().equalsExact(f.norm())},Nn.prototype.getLength=function(){return 0},Nn.prototype.getNumGeometries=function(){return 1},Nn.prototype.compareTo=function(){if(1===arguments.length){var f=arguments[0],d=f;return this.getSortIndex()!==d.getSortIndex()?this.getSortIndex()-d.getSortIndex():this.isEmpty()&&d.isEmpty()?0:this.isEmpty()?-1:d.isEmpty()?1:this.compareToSameClass(f)}if(2===arguments.length){var v=arguments[0],w=arguments[1];return this.getSortIndex()!==v.getSortIndex()?this.getSortIndex()-v.getSortIndex():this.isEmpty()&&v.isEmpty()?0:this.isEmpty()?-1:v.isEmpty()?1:this.compareToSameClass(v,w)}},Nn.prototype.getUserData=function(){return this._userData},Nn.prototype.getSRID=function(){return this._SRID},Nn.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},Nn.prototype.checkNotGeometryCollection=function(f){if(f.getSortIndex()===Nn.SORTINDEX_GEOMETRYCOLLECTION)throw new gt("This method does not support GeometryCollection arguments")},Nn.prototype.equal=function(f,d,v){return 0===v?f.equals(d):f.distance(d)<=v},Nn.prototype.norm=function(){var f=this.copy();return f.normalize(),f},Nn.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},Nn.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new hn(this._envelope)},Nn.prototype.setSRID=function(f){this._SRID=f},Nn.prototype.setUserData=function(f){this._userData=f},Nn.prototype.compare=function(f,d){for(var v=f.iterator(),w=d.iterator();v.hasNext()&&w.hasNext();){var T=v.next(),k=w.next(),q=T.compareTo(k);if(0!==q)return q}return v.hasNext()?1:w.hasNext()?-1:0},Nn.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},Nn.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Nn.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Nn.SORTINDEX_MULTIPOINT||this.getSortIndex()===Nn.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Nn.SORTINDEX_MULTIPOLYGON},Nn.prototype.interfaces_=function(){return[H,ut,Ct]},Nn.prototype.getClass=function(){return Nn},Nn.hasNonEmptyElements=function(f){for(var d=0;d<f.length;d++)if(!f[d].isEmpty())return!0;return!1},Nn.hasNullElements=function(f){for(var d=0;d<f.length;d++)if(null===f[d])return!0;return!1},Hr.serialVersionUID.get=function(){return 0x799ea46522854c00},Hr.SORTINDEX_POINT.get=function(){return 0},Hr.SORTINDEX_MULTIPOINT.get=function(){return 1},Hr.SORTINDEX_LINESTRING.get=function(){return 2},Hr.SORTINDEX_LINEARRING.get=function(){return 3},Hr.SORTINDEX_MULTILINESTRING.get=function(){return 4},Hr.SORTINDEX_POLYGON.get=function(){return 5},Hr.SORTINDEX_MULTIPOLYGON.get=function(){return 6},Hr.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},Hr.geometryChangedFilter.get=function(){return fe},Object.defineProperties(Nn,Hr);var fe=function(){};fe.interfaces_=function(){return[Zi]},fe.filter=function(f){f.geometryChangedAction()};var W=function(){};W.prototype.filter=function(f){},W.prototype.interfaces_=function(){return[]},W.prototype.getClass=function(){return W};var nt=function(){},Dt={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};nt.prototype.isInBoundary=function(f){},nt.prototype.interfaces_=function(){return[]},nt.prototype.getClass=function(){return nt},Dt.Mod2BoundaryNodeRule.get=function(){return Jt},Dt.EndPointBoundaryNodeRule.get=function(){return Xt},Dt.MultiValentEndPointBoundaryNodeRule.get=function(){return Ue},Dt.MonoValentEndPointBoundaryNodeRule.get=function(){return ke},Dt.MOD2_BOUNDARY_RULE.get=function(){return new Jt},Dt.ENDPOINT_BOUNDARY_RULE.get=function(){return new Xt},Dt.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Ue},Dt.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new ke},Dt.OGC_SFS_BOUNDARY_RULE.get=function(){return nt.MOD2_BOUNDARY_RULE},Object.defineProperties(nt,Dt);var Jt=function(){};Jt.prototype.isInBoundary=function(f){return f%2==1},Jt.prototype.interfaces_=function(){return[nt]},Jt.prototype.getClass=function(){return Jt};var Xt=function(){};Xt.prototype.isInBoundary=function(f){return f>0},Xt.prototype.interfaces_=function(){return[nt]},Xt.prototype.getClass=function(){return Xt};var Ue=function(){};Ue.prototype.isInBoundary=function(f){return f>1},Ue.prototype.interfaces_=function(){return[nt]},Ue.prototype.getClass=function(){return Ue};var ke=function(){};ke.prototype.isInBoundary=function(f){return 1===f},ke.prototype.interfaces_=function(){return[nt]},ke.prototype.getClass=function(){return ke};var Ye=function(){};Ye.prototype.add=function(){},Ye.prototype.addAll=function(){},Ye.prototype.isEmpty=function(){},Ye.prototype.iterator=function(){},Ye.prototype.size=function(){},Ye.prototype.toArray=function(){},Ye.prototype.remove=function(){},(Rt.prototype=new Error).name="IndexOutOfBoundsException";var Je=function(){};Je.prototype.hasNext=function(){},Je.prototype.next=function(){},Je.prototype.remove=function(){};var Kt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.get=function(){},d.prototype.set=function(){},d.prototype.isEmpty=function(){},d}(Ye);(oe.prototype=new Error).name="NoSuchElementException";var lt=function(f){function d(){f.call(this),this.array_=[],arguments[0]instanceof Ye&&this.addAll(arguments[0])}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.ensureCapacity=function(){},d.prototype.interfaces_=function(){return[f,Ye]},d.prototype.add=function(v){return 1===arguments.length?this.array_.push(v):this.array_.splice(arguments[0],arguments[1]),!0},d.prototype.clear=function(){this.array_=[]},d.prototype.addAll=function(v){for(var w=v.iterator();w.hasNext();)this.add(w.next());return!0},d.prototype.set=function(v,w){var T=this.array_[v];return this.array_[v]=w,T},d.prototype.iterator=function(){return new se(this)},d.prototype.get=function(v){if(v<0||v>=this.size())throw new Rt;return this.array_[v]},d.prototype.isEmpty=function(){return 0===this.array_.length},d.prototype.size=function(){return this.array_.length},d.prototype.toArray=function(){for(var v=[],w=0,T=this.array_.length;w<T;w++)v.push(this.array_[w]);return v},d.prototype.remove=function(v){for(var w=!1,T=0,k=this.array_.length;T<k;T++)if(this.array_[T]===v){this.array_.splice(T,1),w=!0;break}return w},d}(Kt),se=function(f){function d(v){f.call(this),this.arrayList_=v,this.position_=0}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new oe;return this.arrayList_.get(this.position_++)},d.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},d.prototype.set=function(v){return this.arrayList_.set(this.position_-1,v)},d.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},d}(Je),ve=function(f){function d(){if(f.call(this),0!==arguments.length)if(1===arguments.length){var w=arguments[0];this.ensureCapacity(w.length),this.add(w,!0)}else if(2===arguments.length){var T=arguments[0],k=arguments[1];this.ensureCapacity(T.length),this.add(T,k)}}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var v={coordArrayType:{configurable:!0}};return v.coordArrayType.get=function(){return new Array(0).fill(null)},d.prototype.getCoordinate=function(w){return this.get(w)},d.prototype.addAll=function(){if(2===arguments.length){for(var T=arguments[1],k=!1,q=arguments[0].iterator();q.hasNext();)this.add(q.next(),T),k=!0;return k}return f.prototype.addAll.apply(this,arguments)},d.prototype.clone=function(){for(var w=f.prototype.clone.call(this),T=0;T<this.size();T++)w.add(T,this.get(T).copy());return w},d.prototype.toCoordinateArray=function(){return this.toArray(d.coordArrayType)},d.prototype.add=function(){if(1===arguments.length)f.prototype.add.call(this,arguments[0]);else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1],!0),!0;if(arguments[0]instanceof J&&"boolean"==typeof arguments[1]){var q=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(q))return null;f.prototype.add.call(this,q)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1]),!0}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var ae=arguments[0],Ze=arguments[1];if(arguments[2])for(var Qe=0;Qe<ae.length;Qe++)this.add(ae[Qe],Ze);else for(var Pn=ae.length-1;Pn>=0;Pn--)this.add(ae[Pn],Ze);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof J){var Bn=arguments[0],tr=arguments[1];if(!arguments[2]){var _r=this.size();if(_r>0&&(Bn>0&&this.get(Bn-1).equals2D(tr)||Bn<_r&&this.get(Bn).equals2D(tr)))return null}f.prototype.add.call(this,Bn,tr)}}else if(4===arguments.length){var Ki=arguments[0],Ps=arguments[1],Aa=arguments[2],Nu=arguments[3],Ec=1;Aa>Nu&&(Ec=-1);for(var wm=Aa;wm!==Nu;wm+=Ec)this.add(Ki[wm],Ps);return!0}},d.prototype.closeRing=function(){this.size()>0&&this.add(new J(this.get(0)),!1)},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},Object.defineProperties(d,v),d}(lt),ye=function(){},je={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};je.ForwardComparator.get=function(){return tn},je.BidirectionalComparator.get=function(){return Ge},je.coordArrayType.get=function(){return new Array(0).fill(null)},ye.prototype.interfaces_=function(){return[]},ye.prototype.getClass=function(){return ye},ye.isRing=function(f){return!(f.length<4||!f[0].equals2D(f[f.length-1]))},ye.ptNotInList=function(f,d){for(var v=0;v<f.length;v++){var w=f[v];if(ye.indexOf(w,d)<0)return w}return null},ye.scroll=function(f,d){var v=ye.indexOf(d,f);if(v<0)return null;var w=new Array(f.length).fill(null);Yn.arraycopy(f,v,w,0,f.length-v),Yn.arraycopy(f,0,w,f.length-v,v),Yn.arraycopy(w,0,f,0,f.length)},ye.equals=function(){if(2===arguments.length){var f=arguments[0],d=arguments[1];if(f===d)return!0;if(null===f||null===d||f.length!==d.length)return!1;for(var v=0;v<f.length;v++)if(!f[v].equals(d[v]))return!1;return!0}if(3===arguments.length){var w=arguments[0],T=arguments[1],k=arguments[2];if(w===T)return!0;if(null===w||null===T||w.length!==T.length)return!1;for(var q=0;q<w.length;q++)if(0!==k.compare(w[q],T[q]))return!1;return!0}},ye.intersection=function(f,d){for(var v=new ve,w=0;w<f.length;w++)d.intersects(f[w])&&v.add(f[w],!0);return v.toCoordinateArray()},ye.hasRepeatedPoints=function(f){for(var d=1;d<f.length;d++)if(f[d-1].equals(f[d]))return!0;return!1},ye.removeRepeatedPoints=function(f){return ye.hasRepeatedPoints(f)?new ve(f,!1).toCoordinateArray():f},ye.reverse=function(f){for(var d=f.length-1,v=Math.trunc(d/2),w=0;w<=v;w++){var T=f[w];f[w]=f[d-w],f[d-w]=T}},ye.removeNull=function(f){for(var d=0,v=0;v<f.length;v++)null!==f[v]&&d++;var w=new Array(d).fill(null);if(0===d)return w;for(var T=0,k=0;k<f.length;k++)null!==f[k]&&(w[T++]=f[k]);return w},ye.copyDeep=function(){if(1===arguments.length){for(var f=arguments[0],d=new Array(f.length).fill(null),v=0;v<f.length;v++)d[v]=new J(f[v]);return d}if(5===arguments.length)for(var w=arguments[0],T=arguments[1],k=arguments[2],q=arguments[3],K=arguments[4],Mt=0;Mt<K;Mt++)k[q+Mt]=new J(w[T+Mt])},ye.isEqualReversed=function(f,d){for(var v=0;v<f.length;v++)if(0!==f[v].compareTo(d[f.length-v-1]))return!1;return!0},ye.envelope=function(f){for(var d=new hn,v=0;v<f.length;v++)d.expandToInclude(f[v]);return d},ye.toCoordinateArray=function(f){return f.toArray(ye.coordArrayType)},ye.atLeastNCoordinatesOrNothing=function(f,d){return d.length>=f?d:[]},ye.indexOf=function(f,d){for(var v=0;v<d.length;v++)if(f.equals(d[v]))return v;return-1},ye.increasingDirection=function(f){for(var d=0;d<Math.trunc(f.length/2);d++){var w=f[d].compareTo(f[f.length-1-d]);if(0!==w)return w}return 1},ye.compare=function(f,d){for(var v=0;v<f.length&&v<d.length;){var w=f[v].compareTo(d[v]);if(0!==w)return w;v++}return v<d.length?-1:v<f.length?1:0},ye.minCoordinate=function(f){for(var d=null,v=0;v<f.length;v++)(null===d||d.compareTo(f[v])>0)&&(d=f[v]);return d},ye.extract=function(f,d,v){d=Ft.clamp(d,0,f.length);var w=(v=Ft.clamp(v,-1,f.length))-d+1;v<0&&(w=0),d>=f.length&&(w=0),v<d&&(w=0);var T=new Array(w).fill(null);if(0===w)return T;for(var k=0,q=d;q<=v;q++)T[k++]=f[q];return T},Object.defineProperties(ye,je);var tn=function(){};tn.prototype.compare=function(f,d){return ye.compare(f,d)},tn.prototype.interfaces_=function(){return[ht]},tn.prototype.getClass=function(){return tn};var Ge=function(){};Ge.prototype.compare=function(f,d){var v=f,w=d;if(v.length<w.length)return-1;if(v.length>w.length)return 1;if(0===v.length)return 0;var T=ye.compare(v,w);return ye.isEqualReversed(v,w)?0:T},Ge.prototype.OLDcompare=function(f,d){var v=f,w=d;if(v.length<w.length)return-1;if(v.length>w.length)return 1;if(0===v.length)return 0;for(var T=ye.increasingDirection(v),k=ye.increasingDirection(w),q=T>0?0:v.length-1,K=k>0?0:v.length-1,Mt=0;Mt<v.length;Mt++){var ae=v[q].compareTo(w[K]);if(0!==ae)return ae;q+=T,K+=k}return 0},Ge.prototype.interfaces_=function(){return[ht]},Ge.prototype.getClass=function(){return Ge};var dn=function(){};dn.prototype.get=function(){},dn.prototype.put=function(){},dn.prototype.size=function(){},dn.prototype.values=function(){},dn.prototype.entrySet=function(){};var fn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d}(dn);(Pt.prototype=new Error).name="OperationNotSupported",(rt.prototype=new Ye).contains=function(){};var Tn=function(f){function d(){f.call(this),this.array_=[],arguments[0]instanceof Ye&&this.addAll(arguments[0])}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.contains=function(v){for(var w=0,T=this.array_.length;w<T;w++)if(this.array_[w]===v)return!0;return!1},d.prototype.add=function(v){return!this.contains(v)&&(this.array_.push(v),!0)},d.prototype.addAll=function(v){for(var w=v.iterator();w.hasNext();)this.add(w.next());return!0},d.prototype.remove=function(v){throw new Error},d.prototype.size=function(){return this.array_.length},d.prototype.isEmpty=function(){return 0===this.array_.length},d.prototype.toArray=function(){for(var v=[],w=0,T=this.array_.length;w<T;w++)v.push(this.array_[w]);return v},d.prototype.iterator=function(){return new Ir(this)},d}(rt),Ir=function(f){function d(v){f.call(this),this.hashSet_=v,this.position_=0}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new oe;return this.hashSet_.array_[this.position_++]},d.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},d.prototype.remove=function(){throw new Pt},d}(Je),En=0;(Ce.prototype=new fn).get=function(f){for(var d=this.root_;null!==d;){var v=f.compareTo(d.key);if(v<0)d=d.left;else{if(!(v>0))return d.value;d=d.right}}return null},Ce.prototype.put=function(f,d){if(null===this.root_)return this.root_={key:f,value:d,left:null,right:null,parent:null,color:En,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var v,w,T=this.root_;do{if(v=T,(w=f.compareTo(T.key))<0)T=T.left;else{if(!(w>0)){var k=T.value;return T.value=d,k}T=T.right}}while(null!==T);var q={key:f,left:null,right:null,value:d,parent:v,color:En,getValue:function(){return this.value},getKey:function(){return this.key}};return w<0?v.left=q:v.right=q,this.fixAfterInsertion(q),this.size_++,null},Ce.prototype.fixAfterInsertion=function(f){for(f.color=1;null!=f&&f!==this.root_&&1===f.parent.color;)if(ie(f)===Me(ie(ie(f)))){var d=Be(ie(ie(f)));1===zt(d)?(Yt(ie(f),En),Yt(d,En),Yt(ie(ie(f)),1),f=ie(ie(f))):(f===Be(ie(f))&&(f=ie(f),this.rotateLeft(f)),Yt(ie(f),En),Yt(ie(ie(f)),1),this.rotateRight(ie(ie(f))))}else{var v=Me(ie(ie(f)));1===zt(v)?(Yt(ie(f),En),Yt(v,En),Yt(ie(ie(f)),1),f=ie(ie(f))):(f===Me(ie(f))&&(f=ie(f),this.rotateRight(f)),Yt(ie(f),En),Yt(ie(ie(f)),1),this.rotateLeft(ie(ie(f))))}this.root_.color=En},Ce.prototype.values=function(){var f=new lt,d=this.getFirstEntry();if(null!==d)for(f.add(d.value);null!==(d=Ce.successor(d));)f.add(d.value);return f},Ce.prototype.entrySet=function(){var f=new Tn,d=this.getFirstEntry();if(null!==d)for(f.add(d);null!==(d=Ce.successor(d));)f.add(d);return f},Ce.prototype.rotateLeft=function(f){if(null!=f){var d=f.right;f.right=d.left,null!=d.left&&(d.left.parent=f),d.parent=f.parent,null===f.parent?this.root_=d:f.parent.left===f?f.parent.left=d:f.parent.right=d,d.left=f,f.parent=d}},Ce.prototype.rotateRight=function(f){if(null!=f){var d=f.left;f.left=d.right,null!=d.right&&(d.right.parent=f),d.parent=f.parent,null===f.parent?this.root_=d:f.parent.right===f?f.parent.right=d:f.parent.left=d,d.right=f,f.parent=d}},Ce.prototype.getFirstEntry=function(){var f=this.root_;if(null!=f)for(;null!=f.left;)f=f.left;return f},Ce.successor=function(f){if(null===f)return null;if(null!==f.right){for(var d=f.right;null!==d.left;)d=d.left;return d}for(var v=f.parent,w=f;null!==v&&w===v.right;)w=v,v=v.parent;return v},Ce.prototype.size=function(){return this.size_};var gr=function(){};gr.prototype.interfaces_=function(){return[]},gr.prototype.getClass=function(){return gr},ee.prototype=new rt,(_e.prototype=new ee).contains=function(f){for(var d=0,v=this.array_.length;d<v;d++)if(0===this.array_[d].compareTo(f))return!0;return!1},_e.prototype.add=function(f){if(this.contains(f))return!1;for(var d=0,v=this.array_.length;d<v;d++)if(1===this.array_[d].compareTo(f))return this.array_.splice(d,0,f),!0;return this.array_.push(f),!0},_e.prototype.addAll=function(f){for(var d=f.iterator();d.hasNext();)this.add(d.next());return!0},_e.prototype.remove=function(f){throw new Pt},_e.prototype.size=function(){return this.array_.length},_e.prototype.isEmpty=function(){return 0===this.array_.length},_e.prototype.toArray=function(){for(var f=[],d=0,v=this.array_.length;d<v;d++)f.push(this.array_[d]);return f},_e.prototype.iterator=function(){return new mr(this)};var mr=function(f){this.treeSet_=f,this.position_=0};mr.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new oe;return this.treeSet_.array_[this.position_++]},mr.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},mr.prototype.remove=function(){throw new Pt};var ei=function(){};ei.sort=function(){var f,d,v,T=arguments[0];if(1===arguments.length)T.sort(function(q,K){return q.compareTo(K)});else if(2===arguments.length)v=arguments[1],T.sort(function(q,K){return v.compare(q,K)});else if(3===arguments.length){(d=T.slice(arguments[1],arguments[2])).sort();var k=T.slice(0,arguments[1]).concat(d,T.slice(arguments[2],T.length));for(T.splice(0,T.length),f=0;f<k.length;f++)T.push(k[f])}else if(4===arguments.length)for(d=T.slice(arguments[1],arguments[2]),v=arguments[3],d.sort(function(q,K){return v.compare(q,K)}),k=T.slice(0,arguments[1]).concat(d,T.slice(arguments[2],T.length)),T.splice(0,T.length),f=0;f<k.length;f++)T.push(k[f])},ei.asList=function(f){for(var d=new lt,v=0,w=f.length;v<w;v++)d.add(f[v]);return d};var Kn=function(){},li={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};li.P.get=function(){return 0},li.L.get=function(){return 1},li.A.get=function(){return 2},li.FALSE.get=function(){return-1},li.TRUE.get=function(){return-2},li.DONTCARE.get=function(){return-3},li.SYM_FALSE.get=function(){return"F"},li.SYM_TRUE.get=function(){return"T"},li.SYM_DONTCARE.get=function(){return"*"},li.SYM_P.get=function(){return"0"},li.SYM_L.get=function(){return"1"},li.SYM_A.get=function(){return"2"},Kn.prototype.interfaces_=function(){return[]},Kn.prototype.getClass=function(){return Kn},Kn.toDimensionSymbol=function(f){switch(f){case Kn.FALSE:return Kn.SYM_FALSE;case Kn.TRUE:return Kn.SYM_TRUE;case Kn.DONTCARE:return Kn.SYM_DONTCARE;case Kn.P:return Kn.SYM_P;case Kn.L:return Kn.SYM_L;case Kn.A:return Kn.SYM_A}throw new gt("Unknown dimension value: "+f)},Kn.toDimensionValue=function(f){switch(ne.toUpperCase(f)){case Kn.SYM_FALSE:return Kn.FALSE;case Kn.SYM_TRUE:return Kn.TRUE;case Kn.SYM_DONTCARE:return Kn.DONTCARE;case Kn.SYM_P:return Kn.P;case Kn.SYM_L:return Kn.L;case Kn.SYM_A:return Kn.A}throw new gt("Unknown dimension symbol: "+f)},Object.defineProperties(Kn,li);var Vi=function(){};Vi.prototype.filter=function(f){},Vi.prototype.interfaces_=function(){return[]},Vi.prototype.getClass=function(){return Vi};var ui=function(){};ui.prototype.filter=function(f,d){},ui.prototype.isDone=function(){},ui.prototype.isGeometryChanged=function(){},ui.prototype.interfaces_=function(){return[]},ui.prototype.getClass=function(){return ui};var Rr=function(f){function d(w,T){if(f.call(this,T),this._geometries=w||[],f.hasNullElements(this._geometries))throw new gt("geometries must not contain null elements")}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var v={serialVersionUID:{configurable:!0}};return d.prototype.computeEnvelopeInternal=function(){for(var w=new hn,T=0;T<this._geometries.length;T++)w.expandToInclude(this._geometries[T].getEnvelopeInternal());return w},d.prototype.getGeometryN=function(w){return this._geometries[w]},d.prototype.getSortIndex=function(){return f.SORTINDEX_GEOMETRYCOLLECTION},d.prototype.getCoordinates=function(){for(var w=new Array(this.getNumPoints()).fill(null),T=-1,k=0;k<this._geometries.length;k++)for(var q=this._geometries[k].getCoordinates(),K=0;K<q.length;K++)w[++T]=q[K];return w},d.prototype.getArea=function(){for(var w=0,T=0;T<this._geometries.length;T++)w+=this._geometries[T].getArea();return w},d.prototype.equalsExact=function(){if(2===arguments.length){var w=arguments[0],T=arguments[1];if(!this.isEquivalentClass(w))return!1;var k=w;if(this._geometries.length!==k._geometries.length)return!1;for(var q=0;q<this._geometries.length;q++)if(!this._geometries[q].equalsExact(k._geometries[q],T))return!1;return!0}return f.prototype.equalsExact.apply(this,arguments)},d.prototype.normalize=function(){for(var w=0;w<this._geometries.length;w++)this._geometries[w].normalize();ei.sort(this._geometries)},d.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},d.prototype.getBoundaryDimension=function(){for(var w=Kn.FALSE,T=0;T<this._geometries.length;T++)w=Math.max(w,this._geometries[T].getBoundaryDimension());return w},d.prototype.getDimension=function(){for(var w=Kn.FALSE,T=0;T<this._geometries.length;T++)w=Math.max(w,this._geometries[T].getDimension());return w},d.prototype.getLength=function(){for(var w=0,T=0;T<this._geometries.length;T++)w+=this._geometries[T].getLength();return w},d.prototype.getNumPoints=function(){for(var w=0,T=0;T<this._geometries.length;T++)w+=this._geometries[T].getNumPoints();return w},d.prototype.getNumGeometries=function(){return this._geometries.length},d.prototype.reverse=function(){for(var T=new Array(this._geometries.length).fill(null),k=0;k<this._geometries.length;k++)T[k]=this._geometries[k].reverse();return this.getFactory().createGeometryCollection(T)},d.prototype.compareToSameClass=function(){if(1===arguments.length){var w=arguments[0],T=new _e(ei.asList(this._geometries)),k=new _e(ei.asList(w._geometries));return this.compare(T,k)}if(2===arguments.length){for(var K=arguments[1],Mt=arguments[0],ae=this.getNumGeometries(),Ze=Mt.getNumGeometries(),Qe=0;Qe<ae&&Qe<Ze;){var Pn=this.getGeometryN(Qe),Bn=Mt.getGeometryN(Qe),tr=Pn.compareToSameClass(Bn,K);if(0!==tr)return tr;Qe++}return Qe<ae?1:Qe<Ze?-1:0}},d.prototype.apply=function(){if(en(arguments[0],W))for(var w=arguments[0],T=0;T<this._geometries.length;T++)this._geometries[T].apply(w);else if(en(arguments[0],ui)){var k=arguments[0];if(0===this._geometries.length)return null;for(var q=0;q<this._geometries.length&&(this._geometries[q].apply(k),!k.isDone());q++);k.isGeometryChanged()&&this.geometryChanged()}else if(en(arguments[0],Vi)){var K=arguments[0];K.filter(this);for(var Mt=0;Mt<this._geometries.length;Mt++)this._geometries[Mt].apply(K)}else if(en(arguments[0],Zi)){var ae=arguments[0];ae.filter(this);for(var Ze=0;Ze<this._geometries.length;Ze++)this._geometries[Ze].apply(ae)}},d.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),We.shouldNeverReachHere(),null},d.prototype.clone=function(){var w=f.prototype.clone.call(this);w._geometries=new Array(this._geometries.length).fill(null);for(var T=0;T<this._geometries.length;T++)w._geometries[T]=this._geometries[T].clone();return w},d.prototype.getGeometryType=function(){return"GeometryCollection"},d.prototype.copy=function(){for(var w=new Array(this._geometries.length).fill(null),T=0;T<w.length;T++)w[T]=this._geometries[T].copy();return new d(w,this._factory)},d.prototype.isEmpty=function(){for(var w=0;w<this._geometries.length;w++)if(!this._geometries[w].isEmpty())return!1;return!0},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},v.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(d,v),d}(Nn),ls=function(f){function d(){f.apply(this,arguments)}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var v={serialVersionUID:{configurable:!0}};return d.prototype.getSortIndex=function(){return Nn.SORTINDEX_MULTILINESTRING},d.prototype.equalsExact=function(){if(2===arguments.length){var w=arguments[0],T=arguments[1];return!!this.isEquivalentClass(w)&&f.prototype.equalsExact.call(this,w,T)}return f.prototype.equalsExact.apply(this,arguments)},d.prototype.getBoundaryDimension=function(){return this.isClosed()?Kn.FALSE:0},d.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var w=0;w<this._geometries.length;w++)if(!this._geometries[w].isClosed())return!1;return!0},d.prototype.getDimension=function(){return 1},d.prototype.reverse=function(){for(var w=this._geometries.length,T=new Array(w).fill(null),k=0;k<this._geometries.length;k++)T[w-1-k]=this._geometries[k].reverse();return this.getFactory().createMultiLineString(T)},d.prototype.getBoundary=function(){return new Xo(this).getBoundary()},d.prototype.getGeometryType=function(){return"MultiLineString"},d.prototype.copy=function(){for(var w=new Array(this._geometries.length).fill(null),T=0;T<w.length;T++)w[T]=this._geometries[T].copy();return new d(w,this._factory)},d.prototype.interfaces_=function(){return[gr]},d.prototype.getClass=function(){return d},v.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(d,v),d}(Rr),Xo=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var f=arguments[0],d=nt.MOD2_BOUNDARY_RULE;this._geom=f,this._geomFact=f.getFactory(),this._bnRule=d}else if(2===arguments.length){var v=arguments[0],w=arguments[1];this._geom=v,this._geomFact=v.getFactory(),this._bnRule=w}};Xo.prototype.boundaryMultiLineString=function(f){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var d=this.computeBoundaryCoordinates(f);return 1===d.length?this._geomFact.createPoint(d[0]):this._geomFact.createMultiPointFromCoords(d)},Xo.prototype.getBoundary=function(){return this._geom instanceof ps?this.boundaryLineString(this._geom):this._geom instanceof ls?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},Xo.prototype.boundaryLineString=function(f){return this._geom.isEmpty()?this.getEmptyMultiPoint():f.isClosed()?this._bnRule.isInBoundary(2)?f.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([f.getStartPoint(),f.getEndPoint()])},Xo.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},Xo.prototype.computeBoundaryCoordinates=function(f){var d=new lt;this._endpointMap=new Ce;for(var v=0;v<f.getNumGeometries();v++){var w=f.getGeometryN(v);0!==w.getNumPoints()&&(this.addEndpoint(w.getCoordinateN(0)),this.addEndpoint(w.getCoordinateN(w.getNumPoints()-1)))}for(var T=this._endpointMap.entrySet().iterator();T.hasNext();){var k=T.next(),q=k.getValue().count;this._bnRule.isInBoundary(q)&&d.add(k.getKey())}return ye.toCoordinateArray(d)},Xo.prototype.addEndpoint=function(f){var d=this._endpointMap.get(f);null===d&&(d=new dl,this._endpointMap.put(f,d)),d.count++},Xo.prototype.interfaces_=function(){return[]},Xo.prototype.getClass=function(){return Xo},Xo.getBoundary=function(){return 1===arguments.length?new Xo(arguments[0]).getBoundary():2===arguments.length?new Xo(arguments[0],arguments[1]).getBoundary():void 0};var dl=function(){this.count=null};dl.prototype.interfaces_=function(){return[]},dl.prototype.getClass=function(){return dl};var js=function(){},wh={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};js.prototype.interfaces_=function(){return[]},js.prototype.getClass=function(){return js},js.chars=function(f,d){for(var v=new Array(d).fill(null),w=0;w<d;w++)v[w]=f;return String(v)},js.getStackTrace=function(){if(1===arguments.length){var f=arguments[0],d=new function(){},v=new function(){}(d);return f.printStackTrace(v),d.toString()}if(2===arguments.length){for(var T=arguments[1],k="",q=new function(){}(new function(){}(js.getStackTrace(arguments[0]))),K=0;K<T;K++)try{k+=q.readLine()+js.NEWLINE}catch(Mt){if(!(Mt instanceof an))throw Mt;We.shouldNeverReachHere()}return k}},js.split=function(f,d){for(var v=d.length,w=new lt,T=""+f,k=T.indexOf(d);k>=0;){var q=T.substring(0,k);w.add(q),k=(T=T.substring(k+v)).indexOf(d)}T.length>0&&w.add(T);for(var K=new Array(w.size()).fill(null),Mt=0;Mt<K.length;Mt++)K[Mt]=w.get(Mt);return K},js.toString=function(){if(1===arguments.length)return js.SIMPLE_ORDINATE_FORMAT.format(arguments[0])},js.spaces=function(f){return js.chars(" ",f)},wh.NEWLINE.get=function(){return Yn.getProperty("line.separator")},wh.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}("0.#")},Object.defineProperties(js,wh);var Vo=function(){};Vo.prototype.interfaces_=function(){return[]},Vo.prototype.getClass=function(){return Vo},Vo.copyCoord=function(f,d,v,w){for(var T=Math.min(f.getDimension(),v.getDimension()),k=0;k<T;k++)v.setOrdinate(w,k,f.getOrdinate(d,k))},Vo.isRing=function(f){var d=f.size();return 0===d||!(d<=3)&&f.getOrdinate(0,Fe.X)===f.getOrdinate(d-1,Fe.X)&&f.getOrdinate(0,Fe.Y)===f.getOrdinate(d-1,Fe.Y)},Vo.isEqual=function(f,d){var v=f.size();if(v!==d.size())return!1;for(var w=Math.min(f.getDimension(),d.getDimension()),T=0;T<v;T++)for(var k=0;k<w;k++){var q=f.getOrdinate(T,k),K=d.getOrdinate(T,k);if(!(f.getOrdinate(T,k)===d.getOrdinate(T,k)||ct.isNaN(q)&&ct.isNaN(K)))return!1}return!0},Vo.extend=function(f,d,v){var w=f.create(v,d.getDimension()),T=d.size();if(Vo.copy(d,0,w,0,T),T>0)for(var k=T;k<v;k++)Vo.copy(d,T-1,w,k,1);return w},Vo.reverse=function(f){for(var d=f.size()-1,v=Math.trunc(d/2),w=0;w<=v;w++)Vo.swap(f,w,d-w)},Vo.swap=function(f,d,v){if(d===v)return null;for(var w=0;w<f.getDimension();w++){var T=f.getOrdinate(d,w);f.setOrdinate(d,w,f.getOrdinate(v,w)),f.setOrdinate(v,w,T)}},Vo.copy=function(f,d,v,w,T){for(var k=0;k<T;k++)Vo.copyCoord(f,d+k,v,w+k)},Vo.toString=function(){if(1===arguments.length){var f=arguments[0],d=f.size();if(0===d)return"()";var v=f.getDimension(),w=new Vt;w.append("(");for(var T=0;T<d;T++){T>0&&w.append(" ");for(var k=0;k<v;k++)k>0&&w.append(","),w.append(js.toString(f.getOrdinate(T,k)))}return w.append(")"),w.toString()}},Vo.ensureValidRing=function(f,d){var v=d.size();return 0===v?d:v<=3?Vo.createClosedRing(f,d,4):d.getOrdinate(0,Fe.X)===d.getOrdinate(v-1,Fe.X)&&d.getOrdinate(0,Fe.Y)===d.getOrdinate(v-1,Fe.Y)?d:Vo.createClosedRing(f,d,v+1)},Vo.createClosedRing=function(f,d,v){var w=f.create(v,d.getDimension()),T=d.size();Vo.copy(d,0,w,0,T);for(var k=T;k<v;k++)Vo.copy(d,0,w,k,1);return w};var ps=function(f){function d(w,T){f.call(this,T),this._points=null,this.init(w)}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var v={serialVersionUID:{configurable:!0}};return d.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new hn:this._points.expandEnvelope(new hn)},d.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},d.prototype.getSortIndex=function(){return f.SORTINDEX_LINESTRING},d.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},d.prototype.equalsExact=function(){if(2===arguments.length){var w=arguments[0],T=arguments[1];if(!this.isEquivalentClass(w))return!1;var k=w;if(this._points.size()!==k._points.size())return!1;for(var q=0;q<this._points.size();q++)if(!this.equal(this._points.getCoordinate(q),k._points.getCoordinate(q),T))return!1;return!0}return f.prototype.equalsExact.apply(this,arguments)},d.prototype.normalize=function(){for(var w=0;w<Math.trunc(this._points.size()/2);w++){var T=this._points.size()-1-w;if(!this._points.getCoordinate(w).equals(this._points.getCoordinate(T)))return this._points.getCoordinate(w).compareTo(this._points.getCoordinate(T))>0&&Vo.reverse(this._points),null}},d.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},d.prototype.getBoundaryDimension=function(){return this.isClosed()?Kn.FALSE:0},d.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},d.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},d.prototype.getDimension=function(){return 1},d.prototype.getLength=function(){return mn.computeLength(this._points)},d.prototype.getNumPoints=function(){return this._points.size()},d.prototype.reverse=function(){var w=this._points.copy();return Vo.reverse(w),this.getFactory().createLineString(w)},d.prototype.compareToSameClass=function(){if(1===arguments.length){for(var w=arguments[0],T=0,k=0;T<this._points.size()&&k<w._points.size();){var q=this._points.getCoordinate(T).compareTo(w._points.getCoordinate(k));if(0!==q)return q;T++,k++}return T<this._points.size()?1:k<w._points.size()?-1:0}if(2===arguments.length)return arguments[1].compare(this._points,arguments[0]._points)},d.prototype.apply=function(){if(en(arguments[0],W))for(var w=arguments[0],T=0;T<this._points.size();T++)w.filter(this._points.getCoordinate(T));else if(en(arguments[0],ui)){var k=arguments[0];if(0===this._points.size())return null;for(var q=0;q<this._points.size()&&(k.filter(this._points,q),!k.isDone());q++);k.isGeometryChanged()&&this.geometryChanged()}else(en(arguments[0],Vi)||en(arguments[0],Zi))&&arguments[0].filter(this)},d.prototype.getBoundary=function(){return new Xo(this).getBoundary()},d.prototype.isEquivalentClass=function(w){return w instanceof d},d.prototype.clone=function(){var w=f.prototype.clone.call(this);return w._points=this._points.clone(),w},d.prototype.getCoordinateN=function(w){return this._points.getCoordinate(w)},d.prototype.getGeometryType=function(){return"LineString"},d.prototype.copy=function(){return new d(this._points.copy(),this._factory)},d.prototype.getCoordinateSequence=function(){return this._points},d.prototype.isEmpty=function(){return 0===this._points.size()},d.prototype.init=function(w){if(null===w&&(w=this.getFactory().getCoordinateSequenceFactory().create([])),1===w.size())throw new gt("Invalid number of points in LineString (found "+w.size()+" - must be 0 or >= 2)");this._points=w},d.prototype.isCoordinate=function(w){for(var T=0;T<this._points.size();T++)if(this._points.getCoordinate(T).equals(w))return!0;return!1},d.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},d.prototype.getPointN=function(w){return this.getFactory().createPoint(this._points.getCoordinate(w))},d.prototype.interfaces_=function(){return[gr]},d.prototype.getClass=function(){return d},v.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(d,v),d}(Nn),Iu=function(){};Iu.prototype.interfaces_=function(){return[]},Iu.prototype.getClass=function(){return Iu};var ga=function(f){function d(w,T){f.call(this,T),this._coordinates=w||null,this.init(this._coordinates)}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var v={serialVersionUID:{configurable:!0}};return d.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new hn;var w=new hn;return w.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),w},d.prototype.getSortIndex=function(){return f.SORTINDEX_POINT},d.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},d.prototype.equalsExact=function(){if(2===arguments.length){var w=arguments[0],T=arguments[1];return!!this.isEquivalentClass(w)&&(!(!this.isEmpty()||!w.isEmpty())||this.isEmpty()===w.isEmpty()&&this.equal(w.getCoordinate(),this.getCoordinate(),T))}return f.prototype.equalsExact.apply(this,arguments)},d.prototype.normalize=function(){},d.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},d.prototype.getBoundaryDimension=function(){return Kn.FALSE},d.prototype.getDimension=function(){return 0},d.prototype.getNumPoints=function(){return this.isEmpty()?0:1},d.prototype.reverse=function(){return this.copy()},d.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},d.prototype.compareToSameClass=function(){if(1===arguments.length){var w=arguments[0];return this.getCoordinate().compareTo(w.getCoordinate())}if(2===arguments.length)return arguments[1].compare(this._coordinates,arguments[0]._coordinates)},d.prototype.apply=function(){if(en(arguments[0],W)){var w=arguments[0];if(this.isEmpty())return null;w.filter(this.getCoordinate())}else if(en(arguments[0],ui)){var T=arguments[0];if(this.isEmpty())return null;T.filter(this._coordinates,0),T.isGeometryChanged()&&this.geometryChanged()}else(en(arguments[0],Vi)||en(arguments[0],Zi))&&arguments[0].filter(this)},d.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},d.prototype.clone=function(){var w=f.prototype.clone.call(this);return w._coordinates=this._coordinates.clone(),w},d.prototype.getGeometryType=function(){return"Point"},d.prototype.copy=function(){return new d(this._coordinates.copy(),this._factory)},d.prototype.getCoordinateSequence=function(){return this._coordinates},d.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},d.prototype.isEmpty=function(){return 0===this._coordinates.size()},d.prototype.init=function(w){null===w&&(w=this.getFactory().getCoordinateSequenceFactory().create([])),We.isTrue(w.size()<=1),this._coordinates=w},d.prototype.isSimple=function(){return!0},d.prototype.interfaces_=function(){return[Iu]},d.prototype.getClass=function(){return d},v.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(d,v),d}(Nn),Ja=function(){};Ja.prototype.interfaces_=function(){return[]},Ja.prototype.getClass=function(){return Ja};var wi=function(f){function d(w,T,k){if(f.call(this,k),this._shell=null,this._holes=null,null===w&&(w=this.getFactory().createLinearRing()),null===T&&(T=[]),f.hasNullElements(T))throw new gt("holes must not contain null elements");if(w.isEmpty()&&f.hasNonEmptyElements(T))throw new gt("shell is empty but holes are not");this._shell=w,this._holes=T}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var v={serialVersionUID:{configurable:!0}};return d.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},d.prototype.getSortIndex=function(){return f.SORTINDEX_POLYGON},d.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var w=new Array(this.getNumPoints()).fill(null),T=-1,k=this._shell.getCoordinates(),q=0;q<k.length;q++)w[++T]=k[q];for(var K=0;K<this._holes.length;K++)for(var Mt=this._holes[K].getCoordinates(),ae=0;ae<Mt.length;ae++)w[++T]=Mt[ae];return w},d.prototype.getArea=function(){var w=0;w+=Math.abs(mn.signedArea(this._shell.getCoordinateSequence()));for(var T=0;T<this._holes.length;T++)w-=Math.abs(mn.signedArea(this._holes[T].getCoordinateSequence()));return w},d.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing()||null===this._shell||5!==this._shell.getNumPoints())return!1;for(var w=this._shell.getCoordinateSequence(),T=this.getEnvelopeInternal(),k=0;k<5;k++){var q=w.getX(k);if(q!==T.getMinX()&&q!==T.getMaxX())return!1;var K=w.getY(k);if(K!==T.getMinY()&&K!==T.getMaxY())return!1}for(var Mt=w.getX(0),ae=w.getY(0),Ze=1;Ze<=4;Ze++){var Qe=w.getX(Ze),Pn=w.getY(Ze);if(Qe!==Mt==(Pn!==ae))return!1;Mt=Qe,ae=Pn}return!0},d.prototype.equalsExact=function(){if(2===arguments.length){var w=arguments[0],T=arguments[1];if(!this.isEquivalentClass(w))return!1;var k=w;if(!this._shell.equalsExact(k._shell,T)||this._holes.length!==k._holes.length)return!1;for(var Mt=0;Mt<this._holes.length;Mt++)if(!this._holes[Mt].equalsExact(k._holes[Mt],T))return!1;return!0}return f.prototype.equalsExact.apply(this,arguments)},d.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var w=0;w<this._holes.length;w++)this.normalize(this._holes[w],!1);ei.sort(this._holes)}else if(2===arguments.length){var T=arguments[0],k=arguments[1];if(T.isEmpty())return null;var q=new Array(T.getCoordinates().length-1).fill(null);Yn.arraycopy(T.getCoordinates(),0,q,0,q.length);var K=ye.minCoordinate(T.getCoordinates());ye.scroll(q,K),Yn.arraycopy(q,0,T.getCoordinates(),0,q.length),T.getCoordinates()[q.length]=q[0],mn.isCCW(T.getCoordinates())===k&&ye.reverse(T.getCoordinates())}},d.prototype.getCoordinate=function(){return this._shell.getCoordinate()},d.prototype.getNumInteriorRing=function(){return this._holes.length},d.prototype.getBoundaryDimension=function(){return 1},d.prototype.getDimension=function(){return 2},d.prototype.getLength=function(){var w=0;w+=this._shell.getLength();for(var T=0;T<this._holes.length;T++)w+=this._holes[T].getLength();return w},d.prototype.getNumPoints=function(){for(var w=this._shell.getNumPoints(),T=0;T<this._holes.length;T++)w+=this._holes[T].getNumPoints();return w},d.prototype.reverse=function(){var w=this.copy();w._shell=this._shell.copy().reverse(),w._holes=new Array(this._holes.length).fill(null);for(var T=0;T<this._holes.length;T++)w._holes[T]=this._holes[T].copy().reverse();return w},d.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},d.prototype.compareToSameClass=function(){if(1===arguments.length)return this._shell.compareToSameClass(arguments[0]._shell);if(2===arguments.length){var K=arguments[1],Mt=arguments[0],Qe=this._shell.compareToSameClass(Mt._shell,K);if(0!==Qe)return Qe;for(var Pn=this.getNumInteriorRing(),Bn=Mt.getNumInteriorRing(),tr=0;tr<Pn&&tr<Bn;){var _r=this.getInteriorRingN(tr),Ki=Mt.getInteriorRingN(tr),Ps=_r.compareToSameClass(Ki,K);if(0!==Ps)return Ps;tr++}return tr<Pn?1:tr<Bn?-1:0}},d.prototype.apply=function(w){if(en(w,W)){this._shell.apply(w);for(var T=0;T<this._holes.length;T++)this._holes[T].apply(w)}else if(en(w,ui)){if(this._shell.apply(w),!w.isDone())for(var k=0;k<this._holes.length&&(this._holes[k].apply(w),!w.isDone());k++);w.isGeometryChanged()&&this.geometryChanged()}else if(en(w,Vi))w.filter(this);else if(en(w,Zi)){w.filter(this),this._shell.apply(w);for(var q=0;q<this._holes.length;q++)this._holes[q].apply(w)}},d.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var w=new Array(this._holes.length+1).fill(null);w[0]=this._shell;for(var T=0;T<this._holes.length;T++)w[T+1]=this._holes[T];return w.length<=1?this.getFactory().createLinearRing(w[0].getCoordinateSequence()):this.getFactory().createMultiLineString(w)},d.prototype.clone=function(){var w=f.prototype.clone.call(this);w._shell=this._shell.clone(),w._holes=new Array(this._holes.length).fill(null);for(var T=0;T<this._holes.length;T++)w._holes[T]=this._holes[T].clone();return w},d.prototype.getGeometryType=function(){return"Polygon"},d.prototype.copy=function(){for(var w=this._shell.copy(),T=new Array(this._holes.length).fill(null),k=0;k<T.length;k++)T[k]=this._holes[k].copy();return new d(w,T,this._factory)},d.prototype.getExteriorRing=function(){return this._shell},d.prototype.isEmpty=function(){return this._shell.isEmpty()},d.prototype.getInteriorRingN=function(w){return this._holes[w]},d.prototype.interfaces_=function(){return[Ja]},d.prototype.getClass=function(){return d},v.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(d,v),d}(Nn),jl=function(f){function d(){f.apply(this,arguments)}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var v={serialVersionUID:{configurable:!0}};return d.prototype.getSortIndex=function(){return Nn.SORTINDEX_MULTIPOINT},d.prototype.isValid=function(){return!0},d.prototype.equalsExact=function(){if(2===arguments.length){var w=arguments[0],T=arguments[1];return!!this.isEquivalentClass(w)&&f.prototype.equalsExact.call(this,w,T)}return f.prototype.equalsExact.apply(this,arguments)},d.prototype.getCoordinate=function(){return 1===arguments.length?this._geometries[arguments[0]].getCoordinate():f.prototype.getCoordinate.apply(this,arguments)},d.prototype.getBoundaryDimension=function(){return Kn.FALSE},d.prototype.getDimension=function(){return 0},d.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},d.prototype.getGeometryType=function(){return"MultiPoint"},d.prototype.copy=function(){for(var w=new Array(this._geometries.length).fill(null),T=0;T<w.length;T++)w[T]=this._geometries[T].copy();return new d(w,this._factory)},d.prototype.interfaces_=function(){return[Iu]},d.prototype.getClass=function(){return d},v.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(d,v),d}(Rr),pl=function(f){function d(w,T){w instanceof J&&T instanceof Hn&&(w=T.getCoordinateSequenceFactory().create(w)),f.call(this,w,T),this.validateConstruction()}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var v={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return d.prototype.getSortIndex=function(){return Nn.SORTINDEX_LINEARRING},d.prototype.getBoundaryDimension=function(){return Kn.FALSE},d.prototype.isClosed=function(){return!!this.isEmpty()||f.prototype.isClosed.call(this)},d.prototype.reverse=function(){var w=this._points.copy();return Vo.reverse(w),this.getFactory().createLinearRing(w)},d.prototype.validateConstruction=function(){if(!this.isEmpty()&&!f.prototype.isClosed.call(this))throw new gt("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<d.MINIMUM_VALID_SIZE)throw new gt("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},d.prototype.getGeometryType=function(){return"LinearRing"},d.prototype.copy=function(){return new d(this._points.copy(),this._factory)},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},v.MINIMUM_VALID_SIZE.get=function(){return 4},v.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(d,v),d}(ps),Os=function(f){function d(){f.apply(this,arguments)}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var v={serialVersionUID:{configurable:!0}};return d.prototype.getSortIndex=function(){return Nn.SORTINDEX_MULTIPOLYGON},d.prototype.equalsExact=function(){if(2===arguments.length){var w=arguments[0],T=arguments[1];return!!this.isEquivalentClass(w)&&f.prototype.equalsExact.call(this,w,T)}return f.prototype.equalsExact.apply(this,arguments)},d.prototype.getBoundaryDimension=function(){return 1},d.prototype.getDimension=function(){return 2},d.prototype.reverse=function(){for(var T=new Array(this._geometries.length).fill(null),k=0;k<this._geometries.length;k++)T[k]=this._geometries[k].reverse();return this.getFactory().createMultiPolygon(T)},d.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var w=new lt,T=0;T<this._geometries.length;T++)for(var k=this._geometries[T].getBoundary(),q=0;q<k.getNumGeometries();q++)w.add(k.getGeometryN(q));var K=new Array(w.size()).fill(null);return this.getFactory().createMultiLineString(w.toArray(K))},d.prototype.getGeometryType=function(){return"MultiPolygon"},d.prototype.copy=function(){for(var w=new Array(this._geometries.length).fill(null),T=0;T<w.length;T++)w[T]=this._geometries[T].copy();return new d(w,this._factory)},d.prototype.interfaces_=function(){return[Ja]},d.prototype.getClass=function(){return d},v.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(d,v),d}(Rr),ms=function(f){this._factory=f||null,this._isUserDataCopied=!1},gc={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};ms.prototype.setCopyUserData=function(f){this._isUserDataCopied=f},ms.prototype.edit=function(f,d){if(null===f)return null;var v=this.editInternal(f,d);return this._isUserDataCopied&&v.setUserData(f.getUserData()),v},ms.prototype.editInternal=function(f,d){return null===this._factory&&(this._factory=f.getFactory()),f instanceof Rr?this.editGeometryCollection(f,d):f instanceof wi?this.editPolygon(f,d):f instanceof ga||f instanceof ps?d.edit(f,this._factory):(We.shouldNeverReachHere("Unsupported Geometry class: "+f.getClass().getName()),null)},ms.prototype.editGeometryCollection=function(f,d){for(var v=d.edit(f,this._factory),w=new lt,T=0;T<v.getNumGeometries();T++){var k=this.edit(v.getGeometryN(T),d);null===k||k.isEmpty()||w.add(k)}return v.getClass()===jl?this._factory.createMultiPoint(w.toArray([])):v.getClass()===ls?this._factory.createMultiLineString(w.toArray([])):v.getClass()===Os?this._factory.createMultiPolygon(w.toArray([])):this._factory.createGeometryCollection(w.toArray([]))},ms.prototype.editPolygon=function(f,d){var v=d.edit(f,this._factory);if(null===v&&(v=this._factory.createPolygon(null)),v.isEmpty())return v;var w=this.edit(v.getExteriorRing(),d);if(null===w||w.isEmpty())return this._factory.createPolygon();for(var T=new lt,k=0;k<v.getNumInteriorRing();k++){var q=this.edit(v.getInteriorRingN(k),d);null===q||q.isEmpty()||T.add(q)}return this._factory.createPolygon(w,T.toArray([]))},ms.prototype.interfaces_=function(){return[]},ms.prototype.getClass=function(){return ms},ms.GeometryEditorOperation=function(){},gc.NoOpGeometryOperation.get=function(){return Vl},gc.CoordinateOperation.get=function(){return Ml},gc.CoordinateSequenceOperation.get=function(){return _c},Object.defineProperties(ms,gc);var Vl=function(){};Vl.prototype.edit=function(f,d){return f},Vl.prototype.interfaces_=function(){return[ms.GeometryEditorOperation]},Vl.prototype.getClass=function(){return Vl};var Ml=function(){};Ml.prototype.edit=function(f,d){var v=this.editCoordinates(f.getCoordinates(),f);return null===v?f:f instanceof pl?d.createLinearRing(v):f instanceof ps?d.createLineString(v):f instanceof ga?v.length>0?d.createPoint(v[0]):d.createPoint():f},Ml.prototype.interfaces_=function(){return[ms.GeometryEditorOperation]},Ml.prototype.getClass=function(){return Ml};var _c=function(){};_c.prototype.edit=function(f,d){return f instanceof pl?d.createLinearRing(this.edit(f.getCoordinateSequence(),f)):f instanceof ps?d.createLineString(this.edit(f.getCoordinateSequence(),f)):f instanceof ga?d.createPoint(this.edit(f.getCoordinateSequence(),f)):f},_c.prototype.interfaces_=function(){return[ms.GeometryEditorOperation]},_c.prototype.getClass=function(){return _c};var Yo=function(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var f=arguments[0];this._coordinates=new Array(f).fill(null);for(var d=0;d<f;d++)this._coordinates[d]=new J}else if(en(arguments[0],Fe)){var v=arguments[0];if(null===v)return this._coordinates=new Array(0).fill(null),null;this._dimension=v.getDimension(),this._coordinates=new Array(v.size()).fill(null);for(var w=0;w<this._coordinates.length;w++)this._coordinates[w]=v.getCoordinateCopy(w)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var T=arguments[0],k=arguments[1];this._coordinates=T,this._dimension=k,null===T&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var q=arguments[0],K=arguments[1];this._coordinates=new Array(q).fill(null),this._dimension=K;for(var Mt=0;Mt<q;Mt++)this._coordinates[Mt]=new J}},ef={serialVersionUID:{configurable:!0}};Yo.prototype.setOrdinate=function(f,d,v){switch(d){case Fe.X:this._coordinates[f].x=v;break;case Fe.Y:this._coordinates[f].y=v;break;case Fe.Z:this._coordinates[f].z=v;break;default:throw new gt("invalid ordinateIndex")}},Yo.prototype.size=function(){return this._coordinates.length},Yo.prototype.getOrdinate=function(f,d){switch(d){case Fe.X:return this._coordinates[f].x;case Fe.Y:return this._coordinates[f].y;case Fe.Z:return this._coordinates[f].z}return ct.NaN},Yo.prototype.getCoordinate=function(){if(1===arguments.length)return this._coordinates[arguments[0]];if(2===arguments.length){var d=arguments[0],v=arguments[1];v.x=this._coordinates[d].x,v.y=this._coordinates[d].y,v.z=this._coordinates[d].z}},Yo.prototype.getCoordinateCopy=function(f){return new J(this._coordinates[f])},Yo.prototype.getDimension=function(){return this._dimension},Yo.prototype.getX=function(f){return this._coordinates[f].x},Yo.prototype.clone=function(){for(var f=new Array(this.size()).fill(null),d=0;d<this._coordinates.length;d++)f[d]=this._coordinates[d].clone();return new Yo(f,this._dimension)},Yo.prototype.expandEnvelope=function(f){for(var d=0;d<this._coordinates.length;d++)f.expandToInclude(this._coordinates[d]);return f},Yo.prototype.copy=function(){for(var f=new Array(this.size()).fill(null),d=0;d<this._coordinates.length;d++)f[d]=this._coordinates[d].copy();return new Yo(f,this._dimension)},Yo.prototype.toString=function(){if(this._coordinates.length>0){var f=new Vt(17*this._coordinates.length);f.append("("),f.append(this._coordinates[0]);for(var d=1;d<this._coordinates.length;d++)f.append(", "),f.append(this._coordinates[d]);return f.append(")"),f.toString()}return"()"},Yo.prototype.getY=function(f){return this._coordinates[f].y},Yo.prototype.toCoordinateArray=function(){return this._coordinates},Yo.prototype.interfaces_=function(){return[Fe,Ct]},Yo.prototype.getClass=function(){return Yo},ef.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(Yo,ef);var ml=function(){},Qu={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};ml.prototype.readResolve=function(){return ml.instance()},ml.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new Yo(arguments[0]);if(en(arguments[0],Fe))return new Yo(arguments[0])}else if(2===arguments.length){var v=arguments[0],w=arguments[1];return w>3&&(w=3),w<2?new Yo(v):new Yo(v,w)}},ml.prototype.interfaces_=function(){return[Ht,Ct]},ml.prototype.getClass=function(){return ml},ml.instance=function(){return ml.instanceObject},Qu.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},Qu.instanceObject.get=function(){return new ml},Object.defineProperties(ml,Qu);var Hc=function(f){function d(){f.call(this),this.map_=new Map}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.get=function(v){return this.map_.get(v)||null},d.prototype.put=function(v,w){return this.map_.set(v,w),w},d.prototype.values=function(){for(var v=new lt,w=this.map_.values(),T=w.next();!T.done;)v.add(T.value),T=w.next();return v},d.prototype.entrySet=function(){var v=new Tn;return this.map_.entries().forEach(function(w){return v.add(w)}),v},d.prototype.size=function(){return this.map_.size()},d}(dn),bi=function f(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=f.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof Ka){var d=arguments[0];this._modelType=d,d===f.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var v=arguments[0];this._modelType=f.FIXED,this.setScale(v)}else if(arguments[0]instanceof f){var w=arguments[0];this._modelType=w._modelType,this._scale=w._scale}},ru={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};bi.prototype.equals=function(f){return f instanceof bi&&this._modelType===f._modelType&&this._scale===f._scale},bi.prototype.compareTo=function(f){var d=f,v=this.getMaximumSignificantDigits(),w=d.getMaximumSignificantDigits();return new At(v).compareTo(new At(w))},bi.prototype.getScale=function(){return this._scale},bi.prototype.isFloating=function(){return this._modelType===bi.FLOATING||this._modelType===bi.FLOATING_SINGLE},bi.prototype.getType=function(){return this._modelType},bi.prototype.toString=function(){var f="UNKNOWN";return this._modelType===bi.FLOATING?f="Floating":this._modelType===bi.FLOATING_SINGLE?f="Floating-Single":this._modelType===bi.FIXED&&(f="Fixed (Scale="+this.getScale()+")"),f},bi.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var f=arguments[0];return ct.isNaN(f)||this._modelType===bi.FLOATING_SINGLE?f:this._modelType===bi.FIXED?Math.round(f*this._scale)/this._scale:f}if(arguments[0]instanceof J){var d=arguments[0];if(this._modelType===bi.FLOATING)return null;d.x=this.makePrecise(d.x),d.y=this.makePrecise(d.y)}},bi.prototype.getMaximumSignificantDigits=function(){var f=16;return this._modelType===bi.FLOATING?f=16:this._modelType===bi.FLOATING_SINGLE?f=6:this._modelType===bi.FIXED&&(f=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),f},bi.prototype.setScale=function(f){this._scale=Math.abs(f)},bi.prototype.interfaces_=function(){return[Ct,ut]},bi.prototype.getClass=function(){return bi},bi.mostPrecise=function(f,d){return f.compareTo(d)>=0?f:d},ru.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},ru.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(bi,ru);var Ka=function f(d){this._name=d||null,f.nameToTypeMap.put(d,this)},or={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};Ka.prototype.readResolve=function(){return Ka.nameToTypeMap.get(this._name)},Ka.prototype.toString=function(){return this._name},Ka.prototype.interfaces_=function(){return[Ct]},Ka.prototype.getClass=function(){return Ka},or.serialVersionUID.get=function(){return-552860263173159e4},or.nameToTypeMap.get=function(){return new Hc},Object.defineProperties(Ka,or),bi.Type=Ka,bi.FIXED=new Ka("FIXED"),bi.FLOATING=new Ka("FLOATING"),bi.FLOATING_SINGLE=new Ka("FLOATING SINGLE");var Hn=function f(){this._precisionModel=new bi,this._SRID=0,this._coordinateSequenceFactory=f.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?en(arguments[0],Ht)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof bi&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},gl={serialVersionUID:{configurable:!0}};Hn.prototype.toGeometry=function(f){return f.isNull()?this.createPoint(null):f.getMinX()===f.getMaxX()&&f.getMinY()===f.getMaxY()?this.createPoint(new J(f.getMinX(),f.getMinY())):f.getMinX()===f.getMaxX()||f.getMinY()===f.getMaxY()?this.createLineString([new J(f.getMinX(),f.getMinY()),new J(f.getMaxX(),f.getMaxY())]):this.createPolygon(this.createLinearRing([new J(f.getMinX(),f.getMinY()),new J(f.getMinX(),f.getMaxY()),new J(f.getMaxX(),f.getMaxY()),new J(f.getMaxX(),f.getMinY()),new J(f.getMinX(),f.getMinY())]),null)},Hn.prototype.createLineString=function(f){return f?f instanceof Array?new ps(this.getCoordinateSequenceFactory().create(f),this):en(f,Fe)?new ps(f,this):void 0:new ps(this.getCoordinateSequenceFactory().create([]),this)},Hn.prototype.createMultiLineString=function(){return 0===arguments.length?new ls(null,this):1===arguments.length?new ls(arguments[0],this):void 0},Hn.prototype.buildGeometry=function(f){for(var d=null,v=!1,w=!1,T=f.iterator();T.hasNext();){var k=T.next(),q=k.getClass();null===d&&(d=q),q!==d&&(v=!0),k.isGeometryCollectionOrDerived()&&(w=!0)}if(null===d)return this.createGeometryCollection();if(v||w)return this.createGeometryCollection(Hn.toGeometryArray(f));var K=f.iterator().next();if(f.size()>1){if(K instanceof wi)return this.createMultiPolygon(Hn.toPolygonArray(f));if(K instanceof ps)return this.createMultiLineString(Hn.toLineStringArray(f));if(K instanceof ga)return this.createMultiPoint(Hn.toPointArray(f));We.shouldNeverReachHere("Unhandled class: "+K.getClass().getName())}return K},Hn.prototype.createMultiPointFromCoords=function(f){return this.createMultiPoint(null!==f?this.getCoordinateSequenceFactory().create(f):null)},Hn.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof J){var f=arguments[0];return this.createPoint(null!==f?this.getCoordinateSequenceFactory().create([f]):null)}if(en(arguments[0],Fe))return new ga(arguments[0],this)}},Hn.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},Hn.prototype.createPolygon=function(){if(0===arguments.length)return new wi(null,null,this);if(1===arguments.length){if(en(arguments[0],Fe))return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof Array)return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof pl)return this.createPolygon(arguments[0],null)}else if(2===arguments.length)return new wi(arguments[0],arguments[1],this)},Hn.prototype.getSRID=function(){return this._SRID},Hn.prototype.createGeometryCollection=function(){return 0===arguments.length?new Rr(null,this):1===arguments.length?new Rr(arguments[0],this):void 0},Hn.prototype.createGeometry=function(f){return new ms(this).edit(f,{edit:function(){if(2===arguments.length)return this._coordinateSequenceFactory.create(arguments[0])}})},Hn.prototype.getPrecisionModel=function(){return this._precisionModel},Hn.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var f=arguments[0];return this.createLinearRing(null!==f?this.getCoordinateSequenceFactory().create(f):null)}if(en(arguments[0],Fe))return new pl(arguments[0],this)}},Hn.prototype.createMultiPolygon=function(){return 0===arguments.length?new Os(null,this):1===arguments.length?new Os(arguments[0],this):void 0},Hn.prototype.createMultiPoint=function(){if(0===arguments.length)return new jl(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new jl(arguments[0],this);if(arguments[0]instanceof Array){var d=arguments[0];return this.createMultiPoint(null!==d?this.getCoordinateSequenceFactory().create(d):null)}if(en(arguments[0],Fe)){var v=arguments[0];if(null===v)return this.createMultiPoint(new Array(0).fill(null));for(var w=new Array(v.size()).fill(null),T=0;T<v.size();T++){var k=this.getCoordinateSequenceFactory().create(1,v.getDimension());Vo.copy(v,T,k,0,1),w[T]=this.createPoint(k)}return this.createMultiPoint(w)}}},Hn.prototype.interfaces_=function(){return[Ct]},Hn.prototype.getClass=function(){return Hn},Hn.toMultiPolygonArray=function(f){var d=new Array(f.size()).fill(null);return f.toArray(d)},Hn.toGeometryArray=function(f){if(null===f)return null;var d=new Array(f.size()).fill(null);return f.toArray(d)},Hn.getDefaultCoordinateSequenceFactory=function(){return ml.instance()},Hn.toMultiLineStringArray=function(f){var d=new Array(f.size()).fill(null);return f.toArray(d)},Hn.toLineStringArray=function(f){var d=new Array(f.size()).fill(null);return f.toArray(d)},Hn.toMultiPointArray=function(f){var d=new Array(f.size()).fill(null);return f.toArray(d)},Hn.toLinearRingArray=function(f){var d=new Array(f.size()).fill(null);return f.toArray(d)},Hn.toPointArray=function(f){var d=new Array(f.size()).fill(null);return f.toArray(d)},Hn.toPolygonArray=function(f){var d=new Array(f.size()).fill(null);return f.toArray(d)},Hn.createPointFromInternalCoord=function(f,d){return d.getPrecisionModel().makePrecise(f),d.getFactory().createPoint(f)},gl.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(Hn,gl);var N=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],$=function(f){this.geometryFactory=f||new Hn};$.prototype.read=function(f){var d,v=(d="string"==typeof f?JSON.parse(f):f).type;if(!at[v])throw new Error("Unknown GeoJSON type: "+d.type);return-1!==N.indexOf(v)?at[v].apply(this,[d.coordinates]):at[v].apply(this,"GeometryCollection"===v?[d.geometries]:[d])},$.prototype.write=function(f){var d=f.getGeometryType();if(!qt[d])throw new Error("Geometry is not supported");return qt[d].apply(this,[f])};var at={Feature:function(f){var d={};for(var v in f)d[v]=f[v];if(f.geometry){if(!at[f.geometry.type])throw new Error("Unknown GeoJSON type: "+f.type);d.geometry=this.read(f.geometry)}return f.bbox&&(d.bbox=at.bbox.apply(this,[f.bbox])),d},FeatureCollection:function(f){var d={};if(f.features){d.features=[];for(var v=0;v<f.features.length;++v)d.features.push(this.read(f.features[v]))}return f.bbox&&(d.bbox=this.parse.bbox.apply(this,[f.bbox])),d},coordinates:function(f){for(var d=[],v=0;v<f.length;++v){var w=f[v];d.push(new J(w[0],w[1]))}return d},bbox:function(f){return this.geometryFactory.createLinearRing([new J(f[0],f[1]),new J(f[2],f[1]),new J(f[2],f[3]),new J(f[0],f[3]),new J(f[0],f[1])])},Point:function(f){var d=new J(f[0],f[1]);return this.geometryFactory.createPoint(d)},MultiPoint:function(f){for(var d=[],v=0;v<f.length;++v)d.push(at.Point.apply(this,[f[v]]));return this.geometryFactory.createMultiPoint(d)},LineString:function(f){var d=at.coordinates.apply(this,[f]);return this.geometryFactory.createLineString(d)},MultiLineString:function(f){for(var d=[],v=0;v<f.length;++v)d.push(at.LineString.apply(this,[f[v]]));return this.geometryFactory.createMultiLineString(d)},Polygon:function(f){for(var d=at.coordinates.apply(this,[f[0]]),v=this.geometryFactory.createLinearRing(d),w=[],T=1;T<f.length;++T){var q=at.coordinates.apply(this,[f[T]]),K=this.geometryFactory.createLinearRing(q);w.push(K)}return this.geometryFactory.createPolygon(v,w)},MultiPolygon:function(f){for(var d=[],v=0;v<f.length;++v)d.push(at.Polygon.apply(this,[f[v]]));return this.geometryFactory.createMultiPolygon(d)},GeometryCollection:function(f){for(var d=[],v=0;v<f.length;++v)d.push(this.read(f[v]));return this.geometryFactory.createGeometryCollection(d)}},qt={coordinate:function(f){return[f.x,f.y]},Point:function(f){return{type:"Point",coordinates:qt.coordinate.apply(this,[f.getCoordinate()])}},MultiPoint:function(f){for(var d=[],v=0;v<f._geometries.length;++v){var T=qt.Point.apply(this,[f._geometries[v]]);d.push(T.coordinates)}return{type:"MultiPoint",coordinates:d}},LineString:function(f){for(var d=[],v=f.getCoordinates(),w=0;w<v.length;++w)d.push(qt.coordinate.apply(this,[v[w]]));return{type:"LineString",coordinates:d}},MultiLineString:function(f){for(var d=[],v=0;v<f._geometries.length;++v){var T=qt.LineString.apply(this,[f._geometries[v]]);d.push(T.coordinates)}return{type:"MultiLineString",coordinates:d}},Polygon:function(f){var d=[],v=qt.LineString.apply(this,[f._shell]);d.push(v.coordinates);for(var w=0;w<f._holes.length;++w){var k=qt.LineString.apply(this,[f._holes[w]]);d.push(k.coordinates)}return{type:"Polygon",coordinates:d}},MultiPolygon:function(f){for(var d=[],v=0;v<f._geometries.length;++v){var T=qt.Polygon.apply(this,[f._geometries[v]]);d.push(T.coordinates)}return{type:"MultiPolygon",coordinates:d}},GeometryCollection:function(f){for(var d=[],v=0;v<f._geometries.length;++v){var w=f._geometries[v],T=w.getGeometryType();d.push(qt[T].apply(this,[w]))}return{type:"GeometryCollection",geometries:d}}},he=function(f){this.geometryFactory=f||new Hn,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new $(this.geometryFactory)};he.prototype.read=function(f){var d=this.parser.read(f);return this.precisionModel.getType()===bi.FIXED&&this.reducePrecision(d),d},he.prototype.reducePrecision=function(f){var d,v;if(f.coordinate)this.precisionModel.makePrecise(f.coordinate);else if(f.points)for(d=0,v=f.points.length;d<v;d++)this.precisionModel.makePrecise(f.points[d]);else if(f.geometries)for(d=0,v=f.geometries.length;d<v;d++)this.reducePrecision(f.geometries[d])};var me=function(){this.parser=new $(this.geometryFactory)};me.prototype.write=function(f){return this.parser.write(f)};var jt=function(){},qe={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};jt.prototype.interfaces_=function(){return[]},jt.prototype.getClass=function(){return jt},jt.opposite=function(f){return f===jt.LEFT?jt.RIGHT:f===jt.RIGHT?jt.LEFT:f},qe.ON.get=function(){return 0},qe.LEFT.get=function(){return 1},qe.RIGHT.get=function(){return 2},Object.defineProperties(jt,qe),(pt.prototype=new Error).name="EmptyStackException",(mt.prototype=new Kt).add=function(f){return this.array_.push(f),!0},mt.prototype.get=function(f){if(f<0||f>=this.size())throw new Error;return this.array_[f]},mt.prototype.push=function(f){return this.array_.push(f),f},mt.prototype.pop=function(f){if(0===this.array_.length)throw new pt;return this.array_.pop()},mt.prototype.peek=function(){if(0===this.array_.length)throw new pt;return this.array_[this.array_.length-1]},mt.prototype.empty=function(){return 0===this.array_.length},mt.prototype.isEmpty=function(){return this.empty()},mt.prototype.search=function(f){return this.array_.indexOf(f)},mt.prototype.size=function(){return this.array_.length},mt.prototype.toArray=function(){for(var f=[],d=0,v=this.array_.length;d<v;d++)f.push(this.array_[d]);return f};var _n=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};_n.prototype.getCoordinate=function(){return this._minCoord},_n.prototype.getRightmostSide=function(f,d){var v=this.getRightmostSideOfSegment(f,d);return v<0&&(v=this.getRightmostSideOfSegment(f,d-1)),v<0&&(this._minCoord=null,this.checkForRightmostCoordinate(f)),v},_n.prototype.findRightmostEdgeAtVertex=function(){var f=this._minDe.getEdge().getCoordinates();We.isTrue(this._minIndex>0&&this._minIndex<f.length,"rightmost point expected to be interior vertex of edge");var d=f[this._minIndex-1],v=f[this._minIndex+1],w=mn.computeOrientation(this._minCoord,v,d),T=!1;(d.y<this._minCoord.y&&v.y<this._minCoord.y&&w===mn.COUNTERCLOCKWISE||d.y>this._minCoord.y&&v.y>this._minCoord.y&&w===mn.CLOCKWISE)&&(T=!0),T&&(this._minIndex=this._minIndex-1)},_n.prototype.getRightmostSideOfSegment=function(f,d){var v=f.getEdge().getCoordinates();if(d<0||d+1>=v.length||v[d].y===v[d+1].y)return-1;var w=jt.LEFT;return v[d].y<v[d+1].y&&(w=jt.RIGHT),w},_n.prototype.getEdge=function(){return this._orientedDe},_n.prototype.checkForRightmostCoordinate=function(f){for(var d=f.getEdge().getCoordinates(),v=0;v<d.length-1;v++)(null===this._minCoord||d[v].x>this._minCoord.x)&&(this._minDe=f,this._minIndex=v,this._minCoord=d[v])},_n.prototype.findRightmostEdgeAtNode=function(){var f=this._minDe.getNode().getEdges();this._minDe=f.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},_n.prototype.findEdge=function(f){for(var d=f.iterator();d.hasNext();){var v=d.next();v.isForward()&&this.checkForRightmostCoordinate(v)}We.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===jt.LEFT&&(this._orientedDe=this._minDe.getSym())},_n.prototype.interfaces_=function(){return[]},_n.prototype.getClass=function(){return _n};var Dn=function(f){function d(v,w){f.call(this,d.msgWithCoord(v,w)),this.pt=w?new J(w):null,this.name="TopologyException"}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getCoordinate=function(){return this.pt},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d.msgWithCoord=function(v,w){return w?v:v+" [ "+w+" ]"},d}(Ve),Vn=function(){this.array_=[]};Vn.prototype.addLast=function(f){this.array_.push(f)},Vn.prototype.removeFirst=function(){return this.array_.shift()},Vn.prototype.isEmpty=function(){return 0===this.array_.length};var bn=function(){this._finder=null,this._dirEdgeList=new lt,this._nodes=new lt,this._rightMostCoord=null,this._env=null,this._finder=new _n};bn.prototype.clearVisitedEdges=function(){for(var f=this._dirEdgeList.iterator();f.hasNext();)f.next().setVisited(!1)},bn.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},bn.prototype.computeNodeDepth=function(f){for(var d=null,v=f.getEdges().iterator();v.hasNext();){var w=v.next();if(w.isVisited()||w.getSym().isVisited()){d=w;break}}if(null===d)throw new Dn("unable to find edge to compute depths at "+f.getCoordinate());f.getEdges().computeDepths(d);for(var T=f.getEdges().iterator();T.hasNext();){var k=T.next();k.setVisited(!0),this.copySymDepths(k)}},bn.prototype.computeDepth=function(f){this.clearVisitedEdges();var d=this._finder.getEdge();d.setEdgeDepths(jt.RIGHT,f),this.copySymDepths(d),this.computeDepths(d)},bn.prototype.create=function(f){this.addReachable(f),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},bn.prototype.findResultEdges=function(){for(var f=this._dirEdgeList.iterator();f.hasNext();){var d=f.next();d.getDepth(jt.RIGHT)>=1&&d.getDepth(jt.LEFT)<=0&&!d.isInteriorAreaEdge()&&d.setInResult(!0)}},bn.prototype.computeDepths=function(f){var d=new Tn,v=new Vn,w=f.getNode();for(v.addLast(w),d.add(w),f.setVisited(!0);!v.isEmpty();){var T=v.removeFirst();d.add(T),this.computeNodeDepth(T);for(var k=T.getEdges().iterator();k.hasNext();){var q=k.next().getSym();if(!q.isVisited()){var K=q.getNode();d.contains(K)||(v.addLast(K),d.add(K))}}}},bn.prototype.compareTo=function(f){return this._rightMostCoord.x<f._rightMostCoord.x?-1:this._rightMostCoord.x>f._rightMostCoord.x?1:0},bn.prototype.getEnvelope=function(){if(null===this._env){for(var f=new hn,d=this._dirEdgeList.iterator();d.hasNext();)for(var v=d.next().getEdge().getCoordinates(),w=0;w<v.length-1;w++)f.expandToInclude(v[w]);this._env=f}return this._env},bn.prototype.addReachable=function(f){var d=new mt;for(d.add(f);!d.empty();){var v=d.pop();this.add(v,d)}},bn.prototype.copySymDepths=function(f){var d=f.getSym();d.setDepth(jt.LEFT,f.getDepth(jt.RIGHT)),d.setDepth(jt.RIGHT,f.getDepth(jt.LEFT))},bn.prototype.add=function(f,d){f.setVisited(!0),this._nodes.add(f);for(var v=f.getEdges().iterator();v.hasNext();){var w=v.next();this._dirEdgeList.add(w);var T=w.getSym().getNode();T.isVisited()||d.push(T)}},bn.prototype.getNodes=function(){return this._nodes},bn.prototype.getDirectedEdges=function(){return this._dirEdgeList},bn.prototype.interfaces_=function(){return[ut]},bn.prototype.getClass=function(){return bn};var Ke=function f(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array)this.init(arguments[0].length);else if(Number.isInteger(arguments[0])){var v=arguments[0];this.init(1),this.location[jt.ON]=v}else if(arguments[0]instanceof f){var w=arguments[0];if(this.init(w.location.length),null!==w)for(var T=0;T<this.location.length;T++)this.location[T]=w.location[T]}}else if(3===arguments.length){var k=arguments[0],q=arguments[1],K=arguments[2];this.init(3),this.location[jt.ON]=k,this.location[jt.LEFT]=q,this.location[jt.RIGHT]=K}};Ke.prototype.setAllLocations=function(f){for(var d=0;d<this.location.length;d++)this.location[d]=f},Ke.prototype.isNull=function(){for(var f=0;f<this.location.length;f++)if(this.location[f]!==Et.NONE)return!1;return!0},Ke.prototype.setAllLocationsIfNull=function(f){for(var d=0;d<this.location.length;d++)this.location[d]===Et.NONE&&(this.location[d]=f)},Ke.prototype.isLine=function(){return 1===this.location.length},Ke.prototype.merge=function(f){if(f.location.length>this.location.length){var d=new Array(3).fill(null);d[jt.ON]=this.location[jt.ON],d[jt.LEFT]=Et.NONE,d[jt.RIGHT]=Et.NONE,this.location=d}for(var v=0;v<this.location.length;v++)this.location[v]===Et.NONE&&v<f.location.length&&(this.location[v]=f.location[v])},Ke.prototype.getLocations=function(){return this.location},Ke.prototype.flip=function(){if(this.location.length<=1)return null;var f=this.location[jt.LEFT];this.location[jt.LEFT]=this.location[jt.RIGHT],this.location[jt.RIGHT]=f},Ke.prototype.toString=function(){var f=new Vt;return this.location.length>1&&f.append(Et.toLocationSymbol(this.location[jt.LEFT])),f.append(Et.toLocationSymbol(this.location[jt.ON])),this.location.length>1&&f.append(Et.toLocationSymbol(this.location[jt.RIGHT])),f.toString()},Ke.prototype.setLocations=function(f,d,v){this.location[jt.ON]=f,this.location[jt.LEFT]=d,this.location[jt.RIGHT]=v},Ke.prototype.get=function(f){return f<this.location.length?this.location[f]:Et.NONE},Ke.prototype.isArea=function(){return this.location.length>1},Ke.prototype.isAnyNull=function(){for(var f=0;f<this.location.length;f++)if(this.location[f]===Et.NONE)return!0;return!1},Ke.prototype.setLocation=function(){1===arguments.length?this.setLocation(jt.ON,arguments[0]):2===arguments.length&&(this.location[arguments[0]]=arguments[1])},Ke.prototype.init=function(f){this.location=new Array(f).fill(null),this.setAllLocations(Et.NONE)},Ke.prototype.isEqualOnSide=function(f,d){return this.location[d]===f.location[d]},Ke.prototype.allPositionsEqual=function(f){for(var d=0;d<this.location.length;d++)if(this.location[d]!==f)return!1;return!0},Ke.prototype.interfaces_=function(){return[]},Ke.prototype.getClass=function(){return Ke};var Se=function f(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var d=arguments[0];this.elt[0]=new Ke(d),this.elt[1]=new Ke(d)}else if(arguments[0]instanceof f){var v=arguments[0];this.elt[0]=new Ke(v.elt[0]),this.elt[1]=new Ke(v.elt[1])}}else if(2===arguments.length){var w=arguments[0],T=arguments[1];this.elt[0]=new Ke(Et.NONE),this.elt[1]=new Ke(Et.NONE),this.elt[w].setLocation(T)}else if(3===arguments.length){var k=arguments[0],q=arguments[1],K=arguments[2];this.elt[0]=new Ke(k,q,K),this.elt[1]=new Ke(k,q,K)}else if(4===arguments.length){var Mt=arguments[0],ae=arguments[1],Ze=arguments[2],Qe=arguments[3];this.elt[0]=new Ke(Et.NONE,Et.NONE,Et.NONE),this.elt[1]=new Ke(Et.NONE,Et.NONE,Et.NONE),this.elt[Mt].setLocations(ae,Ze,Qe)}};Se.prototype.getGeometryCount=function(){var f=0;return this.elt[0].isNull()||f++,this.elt[1].isNull()||f++,f},Se.prototype.setAllLocations=function(f,d){this.elt[f].setAllLocations(d)},Se.prototype.isNull=function(f){return this.elt[f].isNull()},Se.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var f=arguments[0];this.setAllLocationsIfNull(0,f),this.setAllLocationsIfNull(1,f)}else 2===arguments.length&&this.elt[arguments[0]].setAllLocationsIfNull(arguments[1])},Se.prototype.isLine=function(f){return this.elt[f].isLine()},Se.prototype.merge=function(f){for(var d=0;d<2;d++)null===this.elt[d]&&null!==f.elt[d]?this.elt[d]=new Ke(f.elt[d]):this.elt[d].merge(f.elt[d])},Se.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},Se.prototype.getLocation=function(){return 1===arguments.length?this.elt[arguments[0]].get(jt.ON):2===arguments.length?this.elt[arguments[0]].get(arguments[1]):void 0},Se.prototype.toString=function(){var f=new Vt;return null!==this.elt[0]&&(f.append("A:"),f.append(this.elt[0].toString())),null!==this.elt[1]&&(f.append(" B:"),f.append(this.elt[1].toString())),f.toString()},Se.prototype.isArea=function(){return 0===arguments.length?this.elt[0].isArea()||this.elt[1].isArea():1===arguments.length?this.elt[arguments[0]].isArea():void 0},Se.prototype.isAnyNull=function(f){return this.elt[f].isAnyNull()},Se.prototype.setLocation=function(){2===arguments.length?this.elt[arguments[0]].setLocation(jt.ON,arguments[1]):3===arguments.length&&this.elt[arguments[0]].setLocation(arguments[1],arguments[2])},Se.prototype.isEqualOnSide=function(f,d){return this.elt[0].isEqualOnSide(f.elt[0],d)&&this.elt[1].isEqualOnSide(f.elt[1],d)},Se.prototype.allPositionsEqual=function(f,d){return this.elt[f].allPositionsEqual(d)},Se.prototype.toLine=function(f){this.elt[f].isArea()&&(this.elt[f]=new Ke(this.elt[f].location[0]))},Se.prototype.interfaces_=function(){return[]},Se.prototype.getClass=function(){return Se},Se.toLineLabel=function(f){for(var d=new Se(Et.NONE),v=0;v<2;v++)d.setLocation(v,f.getLocation(v));return d};var Oe=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new lt,this._pts=new lt,this._label=new Se(Et.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new lt,this._geometryFactory=null;var f=arguments[0];this._geometryFactory=arguments[1],this.computePoints(f),this.computeRing()};Oe.prototype.computeRing=function(){if(null!==this._ring)return null;for(var f=new Array(this._pts.size()).fill(null),d=0;d<this._pts.size();d++)f[d]=this._pts.get(d);this._ring=this._geometryFactory.createLinearRing(f),this._isHole=mn.isCCW(this._ring.getCoordinates())},Oe.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},Oe.prototype.computePoints=function(f){this._startDe=f;var d=f,v=!0;do{if(null===d)throw new Dn("Found null DirectedEdge");if(d.getEdgeRing()===this)throw new Dn("Directed Edge visited twice during ring-building at "+d.getCoordinate());this._edges.add(d);var w=d.getLabel();We.isTrue(w.isArea()),this.mergeLabel(w),this.addPoints(d.getEdge(),d.isForward(),v),v=!1,this.setEdgeRing(d,this),d=this.getNext(d)}while(d!==this._startDe)},Oe.prototype.getLinearRing=function(){return this._ring},Oe.prototype.getCoordinate=function(f){return this._pts.get(f)},Oe.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var f=this._startDe;do{var d=f.getNode().getEdges().getOutgoingDegree(this);d>this._maxNodeDegree&&(this._maxNodeDegree=d),f=this.getNext(f)}while(f!==this._startDe);this._maxNodeDegree*=2},Oe.prototype.addPoints=function(f,d,v){var w=f.getCoordinates();if(d){var T=1;v&&(T=0);for(var k=T;k<w.length;k++)this._pts.add(w[k])}else{var q=w.length-2;v&&(q=w.length-1);for(var K=q;K>=0;K--)this._pts.add(w[K])}},Oe.prototype.isHole=function(){return this._isHole},Oe.prototype.setInResult=function(){var f=this._startDe;do{f.getEdge().setInResult(!0),f=f.getNext()}while(f!==this._startDe)},Oe.prototype.containsPoint=function(f){var d=this.getLinearRing();if(!d.getEnvelopeInternal().contains(f)||!mn.isPointInRing(f,d.getCoordinates()))return!1;for(var v=this._holes.iterator();v.hasNext();)if(v.next().containsPoint(f))return!1;return!0},Oe.prototype.addHole=function(f){this._holes.add(f)},Oe.prototype.isShell=function(){return null===this._shell},Oe.prototype.getLabel=function(){return this._label},Oe.prototype.getEdges=function(){return this._edges},Oe.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},Oe.prototype.getShell=function(){return this._shell},Oe.prototype.mergeLabel=function(){if(1===arguments.length){var f=arguments[0];this.mergeLabel(f,0),this.mergeLabel(f,1)}else if(2===arguments.length){var v=arguments[1],w=arguments[0].getLocation(v,jt.RIGHT);if(w===Et.NONE)return null;if(this._label.getLocation(v)===Et.NONE)return this._label.setLocation(v,w),null}},Oe.prototype.setShell=function(f){this._shell=f,null!==f&&f.addHole(this)},Oe.prototype.toPolygon=function(f){for(var d=new Array(this._holes.size()).fill(null),v=0;v<this._holes.size();v++)d[v]=this._holes.get(v).getLinearRing();return f.createPolygon(this.getLinearRing(),d)},Oe.prototype.interfaces_=function(){return[]},Oe.prototype.getClass=function(){return Oe};var Qn=function(f){function d(){f.call(this,arguments[0],arguments[1])}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.setEdgeRing=function(v,w){v.setMinEdgeRing(w)},d.prototype.getNext=function(v){return v.getNextMin()},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d}(Oe),It=function(f){function d(){f.call(this,arguments[0],arguments[1])}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.buildMinimalRings=function(){var v=new lt,w=this._startDe;do{if(null===w.getMinEdgeRing()){var T=new Qn(w,this._geometryFactory);v.add(T)}w=w.getNext()}while(w!==this._startDe);return v},d.prototype.setEdgeRing=function(v,w){v.setEdgeRing(w)},d.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var v=this._startDe;do{v.getNode().getEdges().linkMinimalDirectedEdges(this),v=v.getNext()}while(v!==this._startDe)},d.prototype.getNext=function(v){return v.getNext()},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d}(Oe),Ne=function(){this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0!==arguments.length&&1===arguments.length&&(this._label=arguments[0])};Ne.prototype.setVisited=function(f){this._isVisited=f},Ne.prototype.setInResult=function(f){this._isInResult=f},Ne.prototype.isCovered=function(){return this._isCovered},Ne.prototype.isCoveredSet=function(){return this._isCoveredSet},Ne.prototype.setLabel=function(f){this._label=f},Ne.prototype.getLabel=function(){return this._label},Ne.prototype.setCovered=function(f){this._isCovered=f,this._isCoveredSet=!0},Ne.prototype.updateIM=function(f){We.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(f)},Ne.prototype.isInResult=function(){return this._isInResult},Ne.prototype.isVisited=function(){return this._isVisited},Ne.prototype.interfaces_=function(){return[]},Ne.prototype.getClass=function(){return Ne};var Pi=function(f){function d(){f.call(this),this._coord=null,this._edges=null;var w=arguments[1];this._coord=arguments[0],this._edges=w,this._label=new Se(0,Et.NONE)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.isIncidentEdgeInResult=function(){for(var v=this.getEdges().getEdges().iterator();v.hasNext();)if(v.next().getEdge().isInResult())return!0;return!1},d.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},d.prototype.getCoordinate=function(){return this._coord},d.prototype.print=function(v){v.println("node "+this._coord+" lbl: "+this._label)},d.prototype.computeIM=function(v){},d.prototype.computeMergedLocation=function(v,w){var T=Et.NONE;if(T=this._label.getLocation(w),!v.isNull(w)){var k=v.getLocation(w);T!==Et.BOUNDARY&&(T=k)}return T},d.prototype.setLabel=function(){if(2!==arguments.length)return f.prototype.setLabel.apply(this,arguments);var v=arguments[0],w=arguments[1];null===this._label?this._label=new Se(v,w):this._label.setLocation(v,w)},d.prototype.getEdges=function(){return this._edges},d.prototype.mergeLabel=function(){if(arguments[0]instanceof d)this.mergeLabel(arguments[0]._label);else if(arguments[0]instanceof Se)for(var w=arguments[0],T=0;T<2;T++){var k=this.computeMergedLocation(w,T);this._label.getLocation(T)===Et.NONE&&this._label.setLocation(T,k)}},d.prototype.add=function(v){this._edges.insert(v),v.setNode(this)},d.prototype.setLabelBoundary=function(v){if(null===this._label)return null;var w=Et.NONE;null!==this._label&&(w=this._label.getLocation(v)),this._label.setLocation(v,w===Et.BOUNDARY?Et.INTERIOR:Et.BOUNDARY)},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d}(Ne),Mi=function(){this.nodeMap=new Ce,this.nodeFact=null,this.nodeFact=arguments[0]};Mi.prototype.find=function(f){return this.nodeMap.get(f)},Mi.prototype.addNode=function(){if(arguments[0]instanceof J){var f=arguments[0],d=this.nodeMap.get(f);return null===d&&(d=this.nodeFact.createNode(f),this.nodeMap.put(f,d)),d}if(arguments[0]instanceof Pi){var v=arguments[0],w=this.nodeMap.get(v.getCoordinate());return null===w?(this.nodeMap.put(v.getCoordinate(),v),v):(w.mergeLabel(v),w)}},Mi.prototype.print=function(f){for(var d=this.iterator();d.hasNext();)d.next().print(f)},Mi.prototype.iterator=function(){return this.nodeMap.values().iterator()},Mi.prototype.values=function(){return this.nodeMap.values()},Mi.prototype.getBoundaryNodes=function(f){for(var d=new lt,v=this.iterator();v.hasNext();){var w=v.next();w.getLabel().getLocation(f)===Et.BOUNDARY&&d.add(w)}return d},Mi.prototype.add=function(f){var d=f.getCoordinate();this.addNode(d).add(f)},Mi.prototype.interfaces_=function(){return[]},Mi.prototype.getClass=function(){return Mi};var zn=function(){},Qa={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};zn.prototype.interfaces_=function(){return[]},zn.prototype.getClass=function(){return zn},zn.isNorthern=function(f){return f===zn.NE||f===zn.NW},zn.isOpposite=function(f,d){return f!==d&&(f-d+4)%4==2},zn.commonHalfPlane=function(f,d){if(f===d)return f;if((f-d+4)%4==2)return-1;var v=f<d?f:d;return 0===v&&3===(f>d?f:d)?3:v},zn.isInHalfPlane=function(f,d){return d===zn.SE?f===zn.SE||f===zn.SW:f===d||f===d+1},zn.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var f=arguments[0],d=arguments[1];if(0===f&&0===d)throw new gt("Cannot compute the quadrant for point ( "+f+", "+d+" )");return f>=0?d>=0?zn.NE:zn.SE:d>=0?zn.NW:zn.SW}if(arguments[0]instanceof J&&arguments[1]instanceof J){var v=arguments[0],w=arguments[1];if(w.x===v.x&&w.y===v.y)throw new gt("Cannot compute the quadrant for two identical points "+v);return w.x>=v.x?w.y>=v.y?zn.NE:zn.SE:w.y>=v.y?zn.NW:zn.SW}},Qa.NE.get=function(){return 0},Qa.NW.get=function(){return 1},Qa.SW.get=function(){return 2},Qa.SE.get=function(){return 3},Object.defineProperties(zn,Qa);var ia=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length)this._edge=arguments[0];else if(3===arguments.length){var v=arguments[1],w=arguments[2];this._edge=arguments[0],this.init(v,w),this._label=null}else if(4===arguments.length){var k=arguments[1],q=arguments[2],K=arguments[3];this._edge=arguments[0],this.init(k,q),this._label=K}};ia.prototype.compareDirection=function(f){return this._dx===f._dx&&this._dy===f._dy?0:this._quadrant>f._quadrant?1:this._quadrant<f._quadrant?-1:mn.computeOrientation(f._p0,f._p1,this._p1)},ia.prototype.getDy=function(){return this._dy},ia.prototype.getCoordinate=function(){return this._p0},ia.prototype.setNode=function(f){this._node=f},ia.prototype.print=function(f){var d=Math.atan2(this._dy,this._dx),v=this.getClass().getName(),w=v.lastIndexOf("."),T=v.substring(w+1);f.print("  "+T+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+d+"   "+this._label)},ia.prototype.compareTo=function(f){return this.compareDirection(f)},ia.prototype.getDirectedCoordinate=function(){return this._p1},ia.prototype.getDx=function(){return this._dx},ia.prototype.getLabel=function(){return this._label},ia.prototype.getEdge=function(){return this._edge},ia.prototype.getQuadrant=function(){return this._quadrant},ia.prototype.getNode=function(){return this._node},ia.prototype.toString=function(){var f=Math.atan2(this._dy,this._dx),d=this.getClass().getName(),v=d.lastIndexOf(".");return"  "+d.substring(v+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+f+"   "+this._label},ia.prototype.computeLabel=function(f){},ia.prototype.init=function(f,d){this._p0=f,this._p1=d,this._dx=d.x-f.x,this._dy=d.y-f.y,this._quadrant=zn.quadrant(this._dx,this._dy),We.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},ia.prototype.interfaces_=function(){return[ut]},ia.prototype.getClass=function(){return ia};var Gi=function(f){function d(){var v=arguments[0],w=arguments[1];if(f.call(this,v),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=w,w)this.init(v.getCoordinate(0),v.getCoordinate(1));else{var T=v.getNumPoints()-1;this.init(v.getCoordinate(T),v.getCoordinate(T-1))}this.computeDirectedLabel()}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getNextMin=function(){return this._nextMin},d.prototype.getDepth=function(v){return this._depth[v]},d.prototype.setVisited=function(v){this._isVisited=v},d.prototype.computeDirectedLabel=function(){this._label=new Se(this._edge.getLabel()),this._isForward||this._label.flip()},d.prototype.getNext=function(){return this._next},d.prototype.setDepth=function(v,w){if(-999!==this._depth[v]&&this._depth[v]!==w)throw new Dn("assigned depths do not match",this.getCoordinate());this._depth[v]=w},d.prototype.isInteriorAreaEdge=function(){for(var v=!0,w=0;w<2;w++)this._label.isArea(w)&&this._label.getLocation(w,jt.LEFT)===Et.INTERIOR&&this._label.getLocation(w,jt.RIGHT)===Et.INTERIOR||(v=!1);return v},d.prototype.setNextMin=function(v){this._nextMin=v},d.prototype.print=function(v){f.prototype.print.call(this,v),v.print(" "+this._depth[jt.LEFT]+"/"+this._depth[jt.RIGHT]),v.print(" ("+this.getDepthDelta()+")"),this._isInResult&&v.print(" inResult")},d.prototype.setMinEdgeRing=function(v){this._minEdgeRing=v},d.prototype.isLineEdge=function(){var v=this._label.isLine(0)||this._label.isLine(1),w=!this._label.isArea(0)||this._label.allPositionsEqual(0,Et.EXTERIOR),T=!this._label.isArea(1)||this._label.allPositionsEqual(1,Et.EXTERIOR);return v&&w&&T},d.prototype.setEdgeRing=function(v){this._edgeRing=v},d.prototype.getMinEdgeRing=function(){return this._minEdgeRing},d.prototype.getDepthDelta=function(){var v=this._edge.getDepthDelta();return this._isForward||(v=-v),v},d.prototype.setInResult=function(v){this._isInResult=v},d.prototype.getSym=function(){return this._sym},d.prototype.isForward=function(){return this._isForward},d.prototype.getEdge=function(){return this._edge},d.prototype.printEdge=function(v){this.print(v),v.print(" "),this._isForward?this._edge.print(v):this._edge.printReverse(v)},d.prototype.setSym=function(v){this._sym=v},d.prototype.setVisitedEdge=function(v){this.setVisited(v),this._sym.setVisited(v)},d.prototype.setEdgeDepths=function(v,w){var T=this.getEdge().getDepthDelta();this._isForward||(T=-T);var k=1;v===jt.LEFT&&(k=-1);var q=jt.opposite(v),K=w+T*k;this.setDepth(v,w),this.setDepth(q,K)},d.prototype.getEdgeRing=function(){return this._edgeRing},d.prototype.isInResult=function(){return this._isInResult},d.prototype.setNext=function(v){this._next=v},d.prototype.isVisited=function(){return this._isVisited},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d.depthFactor=function(v,w){return v===Et.EXTERIOR&&w===Et.INTERIOR?1:v===Et.INTERIOR&&w===Et.EXTERIOR?-1:0},d}(ia),za=function(){};za.prototype.createNode=function(f){return new Pi(f,null)},za.prototype.interfaces_=function(){return[]},za.prototype.getClass=function(){return za};var us=function(){this._edges=new lt,this._nodes=null,this._edgeEndList=new lt,0===arguments.length?this._nodes=new Mi(new za):1===arguments.length&&(this._nodes=new Mi(arguments[0]))};us.prototype.printEdges=function(f){f.println("Edges:");for(var d=0;d<this._edges.size();d++){f.println("edge "+d+":");var v=this._edges.get(d);v.print(f),v.eiList.print(f)}},us.prototype.find=function(f){return this._nodes.find(f)},us.prototype.addNode=function(){return arguments[0]instanceof Pi||arguments[0]instanceof J?this._nodes.addNode(arguments[0]):void 0},us.prototype.getNodeIterator=function(){return this._nodes.iterator()},us.prototype.linkResultDirectedEdges=function(){for(var f=this._nodes.iterator();f.hasNext();)f.next().getEdges().linkResultDirectedEdges()},us.prototype.debugPrintln=function(f){Yn.out.println(f)},us.prototype.isBoundaryNode=function(f,d){var v=this._nodes.find(d);if(null===v)return!1;var w=v.getLabel();return null!==w&&w.getLocation(f)===Et.BOUNDARY},us.prototype.linkAllDirectedEdges=function(){for(var f=this._nodes.iterator();f.hasNext();)f.next().getEdges().linkAllDirectedEdges()},us.prototype.matchInSameDirection=function(f,d,v,w){return!!f.equals(v)&&mn.computeOrientation(f,d,w)===mn.COLLINEAR&&zn.quadrant(f,d)===zn.quadrant(v,w)},us.prototype.getEdgeEnds=function(){return this._edgeEndList},us.prototype.debugPrint=function(f){Yn.out.print(f)},us.prototype.getEdgeIterator=function(){return this._edges.iterator()},us.prototype.findEdgeInSameDirection=function(f,d){for(var v=0;v<this._edges.size();v++){var w=this._edges.get(v),T=w.getCoordinates();if(this.matchInSameDirection(f,d,T[0],T[1])||this.matchInSameDirection(f,d,T[T.length-1],T[T.length-2]))return w}return null},us.prototype.insertEdge=function(f){this._edges.add(f)},us.prototype.findEdgeEnd=function(f){for(var d=this.getEdgeEnds().iterator();d.hasNext();){var v=d.next();if(v.getEdge()===f)return v}return null},us.prototype.addEdges=function(f){for(var d=f.iterator();d.hasNext();){var v=d.next();this._edges.add(v);var w=new Gi(v,!0),T=new Gi(v,!1);w.setSym(T),T.setSym(w),this.add(w),this.add(T)}},us.prototype.add=function(f){this._nodes.add(f),this._edgeEndList.add(f)},us.prototype.getNodes=function(){return this._nodes.values()},us.prototype.findEdge=function(f,d){for(var v=0;v<this._edges.size();v++){var w=this._edges.get(v),T=w.getCoordinates();if(f.equals(T[0])&&d.equals(T[1]))return w}return null},us.prototype.interfaces_=function(){return[]},us.prototype.getClass=function(){return us},us.linkResultDirectedEdges=function(f){for(var d=f.iterator();d.hasNext();)d.next().getEdges().linkResultDirectedEdges()};var Jo=function(){this._geometryFactory=null,this._shellList=new lt,this._geometryFactory=arguments[0]};Jo.prototype.sortShellsAndHoles=function(f,d,v){for(var w=f.iterator();w.hasNext();){var T=w.next();T.isHole()?v.add(T):d.add(T)}},Jo.prototype.computePolygons=function(f){for(var d=new lt,v=f.iterator();v.hasNext();){var w=v.next().toPolygon(this._geometryFactory);d.add(w)}return d},Jo.prototype.placeFreeHoles=function(f,d){for(var v=d.iterator();v.hasNext();){var w=v.next();if(null===w.getShell()){var T=this.findEdgeRingContaining(w,f);if(null===T)throw new Dn("unable to assign hole to a shell",w.getCoordinate(0));w.setShell(T)}}},Jo.prototype.buildMinimalEdgeRings=function(f,d,v){for(var w=new lt,T=f.iterator();T.hasNext();){var k=T.next();if(k.getMaxNodeDegree()>2){k.linkDirectedEdgesForMinimalEdgeRings();var q=k.buildMinimalRings(),K=this.findShell(q);null!==K?(this.placePolygonHoles(K,q),d.add(K)):v.addAll(q)}else w.add(k)}return w},Jo.prototype.containsPoint=function(f){for(var d=this._shellList.iterator();d.hasNext();)if(d.next().containsPoint(f))return!0;return!1},Jo.prototype.buildMaximalEdgeRings=function(f){for(var d=new lt,v=f.iterator();v.hasNext();){var w=v.next();if(w.isInResult()&&w.getLabel().isArea()&&null===w.getEdgeRing()){var T=new It(w,this._geometryFactory);d.add(T),T.setInResult()}}return d},Jo.prototype.placePolygonHoles=function(f,d){for(var v=d.iterator();v.hasNext();){var w=v.next();w.isHole()&&w.setShell(f)}},Jo.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},Jo.prototype.findEdgeRingContaining=function(f,d){for(var v=f.getLinearRing(),w=v.getEnvelopeInternal(),T=v.getCoordinateN(0),k=null,q=null,K=d.iterator();K.hasNext();){var Mt=K.next(),ae=Mt.getLinearRing(),Ze=ae.getEnvelopeInternal();null!==k&&(q=k.getLinearRing().getEnvelopeInternal());var Qe=!1;Ze.contains(w)&&mn.isPointInRing(T,ae.getCoordinates())&&(Qe=!0),Qe&&(null===k||q.contains(Ze))&&(k=Mt)}return k},Jo.prototype.findShell=function(f){for(var d=0,v=null,w=f.iterator();w.hasNext();){var T=w.next();T.isHole()||(v=T,d++)}return We.isTrue(d<=1,"found two shells in MinimalEdgeRing list"),v},Jo.prototype.add=function(){if(1===arguments.length){var f=arguments[0];this.add(f.getEdgeEnds(),f.getNodes())}else if(2===arguments.length){var d=arguments[0];us.linkResultDirectedEdges(arguments[1]);var w=this.buildMaximalEdgeRings(d),T=new lt,k=this.buildMinimalEdgeRings(w,this._shellList,T);this.sortShellsAndHoles(k,this._shellList,T),this.placeFreeHoles(this._shellList,T)}},Jo.prototype.interfaces_=function(){return[]},Jo.prototype.getClass=function(){return Jo};var In=function(){};In.prototype.getBounds=function(){},In.prototype.interfaces_=function(){return[]},In.prototype.getClass=function(){return In};var Cr=function(){this._bounds=null,this._item=null;var d=arguments[1];this._bounds=arguments[0],this._item=d};Cr.prototype.getItem=function(){return this._item},Cr.prototype.getBounds=function(){return this._bounds},Cr.prototype.interfaces_=function(){return[In,Ct]},Cr.prototype.getClass=function(){return Cr};var Nr=function(){this._size=null,this._items=null,this._size=0,this._items=new lt,this._items.add(null)};Nr.prototype.poll=function(){if(this.isEmpty())return null;var f=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),f},Nr.prototype.size=function(){return this._size},Nr.prototype.reorder=function(f){for(var d=null,v=this._items.get(f);2*f<=this._size&&((d=2*f)!==this._size&&this._items.get(d+1).compareTo(this._items.get(d))<0&&d++,this._items.get(d).compareTo(v)<0);f=d)this._items.set(f,this._items.get(d));this._items.set(f,v)},Nr.prototype.clear=function(){this._size=0,this._items.clear()},Nr.prototype.isEmpty=function(){return 0===this._size},Nr.prototype.add=function(f){this._items.add(null),this._size+=1;var d=this._size;for(this._items.set(0,f);f.compareTo(this._items.get(Math.trunc(d/2)))<0;d/=2)this._items.set(d,this._items.get(Math.trunc(d/2)));this._items.set(d,f)},Nr.prototype.interfaces_=function(){return[]},Nr.prototype.getClass=function(){return Nr};var Vs=function(){};Vs.prototype.visitItem=function(f){},Vs.prototype.interfaces_=function(){return[]},Vs.prototype.getClass=function(){return Vs};var _l=function(){};_l.prototype.insert=function(f,d){},_l.prototype.remove=function(f,d){},_l.prototype.query=function(){},_l.prototype.interfaces_=function(){return[]},_l.prototype.getClass=function(){return _l};var sr=function(){this._childBoundables=new lt,this._bounds=null,this._level=null,0!==arguments.length&&1===arguments.length&&(this._level=arguments[0])},Ma={serialVersionUID:{configurable:!0}};sr.prototype.getLevel=function(){return this._level},sr.prototype.size=function(){return this._childBoundables.size()},sr.prototype.getChildBoundables=function(){return this._childBoundables},sr.prototype.addChildBoundable=function(f){We.isTrue(null===this._bounds),this._childBoundables.add(f)},sr.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},sr.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},sr.prototype.interfaces_=function(){return[In,Ct]},sr.prototype.getClass=function(){return sr},Ma.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(sr,Ma);var ur=function(){};ur.reverseOrder=function(){return{compare:function(f,d){return d.compareTo(f)}}},ur.min=function(f){return ur.sort(f),f.get(0)},ur.sort=function(f,d){var v=f.toArray();d?ei.sort(v,d):ei.sort(v);for(var w=f.iterator(),T=0,k=v.length;T<k;T++)w.next(),w.set(v[T])},ur.singletonList=function(f){var d=new lt;return d.add(f),d};var ns=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var d=arguments[1],v=arguments[2];this._boundable1=arguments[0],this._boundable2=d,this._itemDistance=v,this._distance=this.distance()};ns.prototype.expandToQueue=function(f,d){var v=ns.isComposite(this._boundable1),w=ns.isComposite(this._boundable2);if(v&&w)return ns.area(this._boundable1)>ns.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,f,d),null):(this.expand(this._boundable2,this._boundable1,f,d),null);if(v)return this.expand(this._boundable1,this._boundable2,f,d),null;if(w)return this.expand(this._boundable2,this._boundable1,f,d),null;throw new gt("neither boundable is composite")},ns.prototype.isLeaves=function(){return!(ns.isComposite(this._boundable1)||ns.isComposite(this._boundable2))},ns.prototype.compareTo=function(f){return this._distance<f._distance?-1:this._distance>f._distance?1:0},ns.prototype.expand=function(f,d,v,w){for(var T=f.getChildBoundables().iterator();T.hasNext();){var k=T.next(),q=new ns(k,d,this._itemDistance);q.getDistance()<w&&v.add(q)}},ns.prototype.getBoundable=function(f){return 0===f?this._boundable1:this._boundable2},ns.prototype.getDistance=function(){return this._distance},ns.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},ns.prototype.interfaces_=function(){return[ut]},ns.prototype.getClass=function(){return ns},ns.area=function(f){return f.getBounds().getArea()},ns.isComposite=function(f){return f instanceof sr};var Wi=function f(){if(this._root=null,this._built=!1,this._itemBoundables=new lt,this._nodeCapacity=null,0===arguments.length)this._nodeCapacity=f.DEFAULT_NODE_CAPACITY;else if(1===arguments.length){var v=arguments[0];We.isTrue(v>1,"Node capacity must be greater than 1"),this._nodeCapacity=v}},rs={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Wi.prototype.getNodeCapacity=function(){return this._nodeCapacity},Wi.prototype.lastNode=function(f){return f.get(f.size()-1)},Wi.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var f=0,d=arguments[0].getChildBoundables().iterator();d.hasNext();){var v=d.next();v instanceof sr?f+=this.size(v):v instanceof Cr&&(f+=1)}return f}},Wi.prototype.removeItem=function(f,d){for(var v=null,w=f.getChildBoundables().iterator();w.hasNext();){var T=w.next();T instanceof Cr&&T.getItem()===d&&(v=T)}return null!==v&&(f.getChildBoundables().remove(v),!0)},Wi.prototype.itemsTree=function(){if(0===arguments.length){this.build();var f=this.itemsTree(this._root);return null===f?new lt:f}if(1===arguments.length){for(var d=arguments[0],v=new lt,w=d.getChildBoundables().iterator();w.hasNext();){var T=w.next();if(T instanceof sr){var k=this.itemsTree(T);null!==k&&v.add(k)}else T instanceof Cr?v.add(T.getItem()):We.shouldNeverReachHere()}return v.size()<=0?null:v}},Wi.prototype.insert=function(f,d){We.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Cr(f,d))},Wi.prototype.boundablesAtLevel=function(){if(1===arguments.length){var f=arguments[0],d=new lt;return this.boundablesAtLevel(f,this._root,d),d}if(3===arguments.length){var v=arguments[0],w=arguments[1],T=arguments[2];if(We.isTrue(v>-2),w.getLevel()===v)return T.add(w),null;for(var k=w.getChildBoundables().iterator();k.hasNext();){var q=k.next();q instanceof sr?this.boundablesAtLevel(v,q,T):(We.isTrue(q instanceof Cr),-1===v&&T.add(q))}return null}},Wi.prototype.query=function(){if(1===arguments.length){var f=arguments[0];this.build();var d=new lt;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),f)&&this.query(f,this._root,d),d}if(2===arguments.length){var v=arguments[0],w=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),v)&&this.query(v,this._root,w)}else if(3===arguments.length)if(en(arguments[2],Vs)&&arguments[0]instanceof Object&&arguments[1]instanceof sr)for(var T=arguments[0],q=arguments[2],K=arguments[1].getChildBoundables(),Mt=0;Mt<K.size();Mt++){var ae=K.get(Mt);this.getIntersectsOp().intersects(ae.getBounds(),T)&&(ae instanceof sr?this.query(T,ae,q):ae instanceof Cr?q.visitItem(ae.getItem()):We.shouldNeverReachHere())}else if(en(arguments[2],Kt)&&arguments[0]instanceof Object&&arguments[1]instanceof sr)for(var Ze=arguments[0],Pn=arguments[2],Bn=arguments[1].getChildBoundables(),tr=0;tr<Bn.size();tr++){var _r=Bn.get(tr);this.getIntersectsOp().intersects(_r.getBounds(),Ze)&&(_r instanceof sr?this.query(Ze,_r,Pn):_r instanceof Cr?Pn.add(_r.getItem()):We.shouldNeverReachHere())}},Wi.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},Wi.prototype.getRoot=function(){return this.build(),this._root},Wi.prototype.remove=function(){if(2===arguments.length){var f=arguments[0],d=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),f)&&this.remove(f,this._root,d)}if(3===arguments.length){var v=arguments[0],w=arguments[1],T=arguments[2],k=this.removeItem(w,T);if(k)return!0;for(var q=null,K=w.getChildBoundables().iterator();K.hasNext();){var Mt=K.next();if(this.getIntersectsOp().intersects(Mt.getBounds(),v)&&Mt instanceof sr&&(k=this.remove(v,Mt,T))){q=Mt;break}}return null!==q&&q.getChildBoundables().isEmpty()&&w.getChildBoundables().remove(q),k}},Wi.prototype.createHigherLevels=function(f,d){We.isTrue(!f.isEmpty());var v=this.createParentBoundables(f,d+1);return 1===v.size()?v.get(0):this.createHigherLevels(v,d+1)},Wi.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var f=0,d=arguments[0].getChildBoundables().iterator();d.hasNext();){var v=d.next();if(v instanceof sr){var w=this.depth(v);w>f&&(f=w)}}return f+1}},Wi.prototype.createParentBoundables=function(f,d){We.isTrue(!f.isEmpty());var v=new lt;v.add(this.createNode(d));var w=new lt(f);ur.sort(w,this.getComparator());for(var T=w.iterator();T.hasNext();){var k=T.next();this.lastNode(v).getChildBoundables().size()===this.getNodeCapacity()&&v.add(this.createNode(d)),this.lastNode(v).addChildBoundable(k)}return v},Wi.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},Wi.prototype.interfaces_=function(){return[Ct]},Wi.prototype.getClass=function(){return Wi},Wi.compareDoubles=function(f,d){return f>d?1:f<d?-1:0},rs.IntersectsOp.get=function(){return Ko},rs.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},rs.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(Wi,rs);var Ko=function(){},Cu=function(){};Cu.prototype.distance=function(f,d){},Cu.prototype.interfaces_=function(){return[]},Cu.prototype.getClass=function(){return Cu};var iu=function(f){function d(w){f.call(this,w=w||d.DEFAULT_NODE_CAPACITY)}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var v={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return d.prototype.createParentBoundablesFromVerticalSlices=function(w,T){We.isTrue(w.length>0);for(var k=new lt,q=0;q<w.length;q++)k.addAll(this.createParentBoundablesFromVerticalSlice(w[q],T));return k},d.prototype.createNode=function(w){return new Tl(w)},d.prototype.size=function(){return 0===arguments.length?f.prototype.size.call(this):f.prototype.size.apply(this,arguments)},d.prototype.insert=function(){if(2!==arguments.length)return f.prototype.insert.apply(this,arguments);var w=arguments[0],T=arguments[1];if(w.isNull())return null;f.prototype.insert.call(this,w,T)},d.prototype.getIntersectsOp=function(){return d.intersectsOp},d.prototype.verticalSlices=function(w,T){for(var k=Math.trunc(Math.ceil(w.size()/T)),q=new Array(T).fill(null),K=w.iterator(),Mt=0;Mt<T;Mt++){q[Mt]=new lt;for(var ae=0;K.hasNext()&&ae<k;){var Ze=K.next();q[Mt].add(Ze),ae++}}return q},d.prototype.query=function(){if(1===arguments.length)return f.prototype.query.call(this,arguments[0]);2===arguments.length?f.prototype.query.call(this,arguments[0],arguments[1]):3===arguments.length&&(en(arguments[2],Vs)&&arguments[0]instanceof Object&&arguments[1]instanceof sr||en(arguments[2],Kt)&&arguments[0]instanceof Object&&arguments[1]instanceof sr)&&f.prototype.query.call(this,arguments[0],arguments[1],arguments[2])},d.prototype.getComparator=function(){return d.yComparator},d.prototype.createParentBoundablesFromVerticalSlice=function(w,T){return f.prototype.createParentBoundables.call(this,w,T)},d.prototype.remove=function(){return 2===arguments.length?f.prototype.remove.call(this,arguments[0],arguments[1]):f.prototype.remove.apply(this,arguments)},d.prototype.depth=function(){return 0===arguments.length?f.prototype.depth.call(this):f.prototype.depth.apply(this,arguments)},d.prototype.createParentBoundables=function(w,T){We.isTrue(!w.isEmpty());var k=Math.trunc(Math.ceil(w.size()/this.getNodeCapacity())),q=new lt(w);ur.sort(q,d.xComparator);var K=this.verticalSlices(q,Math.trunc(Math.ceil(Math.sqrt(k))));return this.createParentBoundablesFromVerticalSlices(K,T)},d.prototype.nearestNeighbour=function(){if(1===arguments.length){if(en(arguments[0],Cu)){var w=arguments[0],T=new ns(this.getRoot(),this.getRoot(),w);return this.nearestNeighbour(T)}if(arguments[0]instanceof ns)return this.nearestNeighbour(arguments[0],ct.POSITIVE_INFINITY)}else if(2===arguments.length){if(arguments[0]instanceof d&&en(arguments[1],Cu)){var q=arguments[0],K=arguments[1],Mt=new ns(this.getRoot(),q.getRoot(),K);return this.nearestNeighbour(Mt)}if(arguments[0]instanceof ns&&"number"==typeof arguments[1]){var ae=arguments[0],Ze=arguments[1],Qe=null,Pn=new Nr;for(Pn.add(ae);!Pn.isEmpty()&&Ze>0;){var Bn=Pn.poll(),tr=Bn.getDistance();if(tr>=Ze)break;Bn.isLeaves()?(Ze=tr,Qe=Bn):Bn.expandToQueue(Pn,Ze)}return[Qe.getBoundable(0).getItem(),Qe.getBoundable(1).getItem()]}}else if(3===arguments.length){var Ps=arguments[2],Aa=new Cr(arguments[0],arguments[1]),Nu=new ns(this.getRoot(),Aa,Ps);return this.nearestNeighbour(Nu)[0]}},d.prototype.interfaces_=function(){return[_l,Ct]},d.prototype.getClass=function(){return d},d.centreX=function(w){return d.avg(w.getMinX(),w.getMaxX())},d.avg=function(w,T){return(w+T)/2},d.centreY=function(w){return d.avg(w.getMinY(),w.getMaxY())},v.STRtreeNode.get=function(){return Tl},v.serialVersionUID.get=function(){return 0x39920f7d5f261e0},v.xComparator.get=function(){return{interfaces_:function(){return[ht]},compare:function(w,T){return f.compareDoubles(d.centreX(w.getBounds()),d.centreX(T.getBounds()))}}},v.yComparator.get=function(){return{interfaces_:function(){return[ht]},compare:function(w,T){return f.compareDoubles(d.centreY(w.getBounds()),d.centreY(T.getBounds()))}}},v.intersectsOp.get=function(){return{interfaces_:function(){return[f.IntersectsOp]},intersects:function(w,T){return w.intersects(T)}}},v.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(d,v),d}(Wi),Tl=function(f){function d(){f.call(this,arguments[0])}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.computeBounds=function(){for(var v=null,w=this.getChildBoundables().iterator();w.hasNext();){var T=w.next();null===v?v=new hn(T.getBounds()):v.expandToInclude(T.getBounds())}return v},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d}(sr),Ys=function(){};Ys.prototype.interfaces_=function(){return[]},Ys.prototype.getClass=function(){return Ys},Ys.relativeSign=function(f,d){return f<d?-1:f>d?1:0},Ys.compare=function(f,d,v){if(d.equals2D(v))return 0;var w=Ys.relativeSign(d.x,v.x),T=Ys.relativeSign(d.y,v.y);switch(f){case 0:return Ys.compareValue(w,T);case 1:return Ys.compareValue(T,w);case 2:return Ys.compareValue(T,-w);case 3:return Ys.compareValue(-w,T);case 4:return Ys.compareValue(-w,-T);case 5:return Ys.compareValue(-T,-w);case 6:return Ys.compareValue(-T,w);case 7:return Ys.compareValue(w,-T)}return We.shouldNeverReachHere("invalid octant value"),0},Ys.compareValue=function(f,d){return f<0?-1:f>0?1:d<0?-1:d>0?1:0};var Dl=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var f=arguments[0],d=arguments[1],v=arguments[2],w=arguments[3];this._segString=f,this.coord=new J(d),this.segmentIndex=v,this._segmentOctant=w,this._isInterior=!d.equals2D(f.getCoordinate(v))};Dl.prototype.getCoordinate=function(){return this.coord},Dl.prototype.print=function(f){f.print(this.coord),f.print(" seg # = "+this.segmentIndex)},Dl.prototype.compareTo=function(f){var d=f;return this.segmentIndex<d.segmentIndex?-1:this.segmentIndex>d.segmentIndex?1:this.coord.equals2D(d.coord)?0:Ys.compare(this._segmentOctant,this.coord,d.coord)},Dl.prototype.isEndPoint=function(f){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===f},Dl.prototype.isInterior=function(){return this._isInterior},Dl.prototype.interfaces_=function(){return[ut]},Dl.prototype.getClass=function(){return Dl};var No=function(){this._nodeMap=new Ce,this._edge=null,this._edge=arguments[0]};No.prototype.getSplitCoordinates=function(){var f=new ve;this.addEndpoints();for(var d=this.iterator(),v=d.next();d.hasNext();){var w=d.next();this.addEdgeCoordinates(v,w,f),v=w}return f.toCoordinateArray()},No.prototype.addCollapsedNodes=function(){var f=new lt;this.findCollapsesFromInsertedNodes(f),this.findCollapsesFromExistingVertices(f);for(var d=f.iterator();d.hasNext();){var v=d.next().intValue();this.add(this._edge.getCoordinate(v),v)}},No.prototype.print=function(f){f.println("Intersections:");for(var d=this.iterator();d.hasNext();)d.next().print(f)},No.prototype.findCollapsesFromExistingVertices=function(f){for(var d=0;d<this._edge.size()-2;d++){var v=this._edge.getCoordinate(d),w=this._edge.getCoordinate(d+2);v.equals2D(w)&&f.add(new At(d+1))}},No.prototype.addEdgeCoordinates=function(f,d,v){var w=this._edge.getCoordinate(d.segmentIndex),T=d.isInterior()||!d.coord.equals2D(w);v.add(new J(f.coord),!1);for(var k=f.segmentIndex+1;k<=d.segmentIndex;k++)v.add(this._edge.getCoordinate(k));T&&v.add(new J(d.coord))},No.prototype.iterator=function(){return this._nodeMap.values().iterator()},No.prototype.addSplitEdges=function(f){this.addEndpoints(),this.addCollapsedNodes();for(var d=this.iterator(),v=d.next();d.hasNext();){var w=d.next(),T=this.createSplitEdge(v,w);f.add(T),v=w}},No.prototype.findCollapseIndex=function(f,d,v){if(!f.coord.equals2D(d.coord))return!1;var w=d.segmentIndex-f.segmentIndex;return d.isInterior()||w--,1===w&&(v[0]=f.segmentIndex+1,!0)},No.prototype.findCollapsesFromInsertedNodes=function(f){for(var d=new Array(1).fill(null),v=this.iterator(),w=v.next();v.hasNext();){var T=v.next();this.findCollapseIndex(w,T,d)&&f.add(new At(d[0])),w=T}},No.prototype.getEdge=function(){return this._edge},No.prototype.addEndpoints=function(){var f=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(f),f)},No.prototype.createSplitEdge=function(f,d){var v=d.segmentIndex-f.segmentIndex+2,w=this._edge.getCoordinate(d.segmentIndex),T=d.isInterior()||!d.coord.equals2D(w);T||v--;var k=new Array(v).fill(null),q=0;k[q++]=new J(f.coord);for(var K=f.segmentIndex+1;K<=d.segmentIndex;K++)k[q++]=this._edge.getCoordinate(K);return T&&(k[q]=new J(d.coord)),new Ei(k,this._edge.getData())},No.prototype.add=function(f,d){var v=new Dl(this._edge,f,d,this._edge.getSegmentOctant(d)),w=this._nodeMap.get(v);return null!==w?(We.isTrue(w.coord.equals2D(f),"Found equal nodes with different coordinates"),w):(this._nodeMap.put(v,v),v)},No.prototype.checkSplitEdgesCorrectness=function(f){var d=this._edge.getCoordinates(),v=f.get(0).getCoordinate(0);if(!v.equals2D(d[0]))throw new Ve("bad split edge start point at "+v);var w=f.get(f.size()-1).getCoordinates(),T=w[w.length-1];if(!T.equals2D(d[d.length-1]))throw new Ve("bad split edge end point at "+T)},No.prototype.interfaces_=function(){return[]},No.prototype.getClass=function(){return No};var yl=function(){};yl.prototype.interfaces_=function(){return[]},yl.prototype.getClass=function(){return yl},yl.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var f=arguments[0],d=arguments[1];if(0===f&&0===d)throw new gt("Cannot compute the octant for point ( "+f+", "+d+" )");var v=Math.abs(f),w=Math.abs(d);return f>=0?d>=0?v>=w?0:1:v>=w?7:6:d>=0?v>=w?3:2:v>=w?4:5}if(arguments[0]instanceof J&&arguments[1]instanceof J){var T=arguments[0],k=arguments[1],q=k.x-T.x,K=k.y-T.y;if(0===q&&0===K)throw new gt("Cannot compute the octant for two identical points "+T);return yl.octant(q,K)}};var _a=function(){};_a.prototype.getCoordinates=function(){},_a.prototype.size=function(){},_a.prototype.getCoordinate=function(f){},_a.prototype.isClosed=function(){},_a.prototype.setData=function(f){},_a.prototype.getData=function(){},_a.prototype.interfaces_=function(){return[]},_a.prototype.getClass=function(){return _a};var Su=function(){};Su.prototype.addIntersection=function(f,d){},Su.prototype.interfaces_=function(){return[_a]},Su.prototype.getClass=function(){return Su};var Ei=function(){this._nodeList=new No(this),this._pts=null,this._data=null;var d=arguments[1];this._pts=arguments[0],this._data=d};Ei.prototype.getCoordinates=function(){return this._pts},Ei.prototype.size=function(){return this._pts.length},Ei.prototype.getCoordinate=function(f){return this._pts[f]},Ei.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},Ei.prototype.getSegmentOctant=function(f){return f===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(f),this.getCoordinate(f+1))},Ei.prototype.setData=function(f){this._data=f},Ei.prototype.safeOctant=function(f,d){return f.equals2D(d)?0:yl.octant(f,d)},Ei.prototype.getData=function(){return this._data},Ei.prototype.addIntersection=function(){if(2===arguments.length)this.addIntersectionNode(arguments[0],arguments[1]);else if(4===arguments.length){var w=arguments[1],k=new J(arguments[0].getIntersection(arguments[3]));this.addIntersection(k,w)}},Ei.prototype.toString=function(){return Gt.toLineString(new Yo(this._pts))},Ei.prototype.getNodeList=function(){return this._nodeList},Ei.prototype.addIntersectionNode=function(f,d){var v=d,w=v+1;return w<this._pts.length&&f.equals2D(this._pts[w])&&(v=w),this._nodeList.add(f,v)},Ei.prototype.addIntersections=function(f,d,v){for(var w=0;w<f.getIntersectionNum();w++)this.addIntersection(f,d,v,w)},Ei.prototype.interfaces_=function(){return[Su]},Ei.prototype.getClass=function(){return Ei},Ei.getNodedSubstrings=function(){if(1===arguments.length){var f=arguments[0],d=new lt;return Ei.getNodedSubstrings(f,d),d}if(2===arguments.length)for(var w=arguments[1],T=arguments[0].iterator();T.hasNext();)T.next().getNodeList().addSplitEdges(w)};var pn=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new J,this.p1=new J;else if(1===arguments.length){var f=arguments[0];this.p0=new J(f.p0),this.p1=new J(f.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var w=arguments[2],T=arguments[3];this.p0=new J(arguments[0],arguments[1]),this.p1=new J(w,T)}},Ti={serialVersionUID:{configurable:!0}};pn.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},pn.prototype.orientationIndex=function(){if(arguments[0]instanceof pn){var f=arguments[0],d=mn.orientationIndex(this.p0,this.p1,f.p0),v=mn.orientationIndex(this.p0,this.p1,f.p1);return d>=0&&v>=0||d<=0&&v<=0?Math.max(d,v):0}if(arguments[0]instanceof J)return mn.orientationIndex(this.p0,this.p1,arguments[0])},pn.prototype.toGeometry=function(f){return f.createLineString([this.p0,this.p1])},pn.prototype.isVertical=function(){return this.p0.x===this.p1.x},pn.prototype.equals=function(f){if(!(f instanceof pn))return!1;var d=f;return this.p0.equals(d.p0)&&this.p1.equals(d.p1)},pn.prototype.intersection=function(f){var d=new Rn;return d.computeIntersection(this.p0,this.p1,f.p0,f.p1),d.hasIntersection()?d.getIntersection(0):null},pn.prototype.project=function(){if(arguments[0]instanceof J){var f=arguments[0];if(f.equals(this.p0)||f.equals(this.p1))return new J(f);var d=this.projectionFactor(f),v=new J;return v.x=this.p0.x+d*(this.p1.x-this.p0.x),v.y=this.p0.y+d*(this.p1.y-this.p0.y),v}if(arguments[0]instanceof pn){var w=arguments[0],T=this.projectionFactor(w.p0),k=this.projectionFactor(w.p1);if(T>=1&&k>=1||T<=0&&k<=0)return null;var q=this.project(w.p0);T<0&&(q=this.p0),T>1&&(q=this.p1);var K=this.project(w.p1);return k<0&&(K=this.p0),k>1&&(K=this.p1),new pn(q,K)}},pn.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},pn.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},pn.prototype.getCoordinate=function(f){return 0===f?this.p0:this.p1},pn.prototype.distancePerpendicular=function(f){return mn.distancePointLinePerpendicular(f,this.p0,this.p1)},pn.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},pn.prototype.midPoint=function(){return pn.midPoint(this.p0,this.p1)},pn.prototype.projectionFactor=function(f){if(f.equals(this.p0))return 0;if(f.equals(this.p1))return 1;var d=this.p1.x-this.p0.x,v=this.p1.y-this.p0.y,w=d*d+v*v;return w<=0?ct.NaN:((f.x-this.p0.x)*d+(f.y-this.p0.y)*v)/w},pn.prototype.closestPoints=function(f){var d=this.intersection(f);if(null!==d)return[d,d];var v=new Array(2).fill(null),w=ct.MAX_VALUE,T=null,k=this.closestPoint(f.p0);w=k.distance(f.p0),v[0]=k,v[1]=f.p0;var q=this.closestPoint(f.p1);(T=q.distance(f.p1))<w&&(w=T,v[0]=q,v[1]=f.p1);var K=f.closestPoint(this.p0);(T=K.distance(this.p0))<w&&(w=T,v[0]=this.p0,v[1]=K);var Mt=f.closestPoint(this.p1);return(T=Mt.distance(this.p1))<w&&(w=T,v[0]=this.p1,v[1]=Mt),v},pn.prototype.closestPoint=function(f){var d=this.projectionFactor(f);return d>0&&d<1?this.project(f):this.p0.distance(f)<this.p1.distance(f)?this.p0:this.p1},pn.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},pn.prototype.getLength=function(){return this.p0.distance(this.p1)},pn.prototype.compareTo=function(f){var d=f,v=this.p0.compareTo(d.p0);return 0!==v?v:this.p1.compareTo(d.p1)},pn.prototype.reverse=function(){var f=this.p0;this.p0=this.p1,this.p1=f},pn.prototype.equalsTopo=function(f){return this.p0.equals(f.p0)&&(this.p1.equals(f.p1)||this.p0.equals(f.p1))&&this.p1.equals(f.p0)},pn.prototype.lineIntersection=function(f){try{return Gn.intersection(this.p0,this.p1,f.p0,f.p1)}catch(d){if(!(d instanceof yn))throw d}return null},pn.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},pn.prototype.pointAlongOffset=function(f,d){var v=this.p0.x+f*(this.p1.x-this.p0.x),w=this.p0.y+f*(this.p1.y-this.p0.y),T=this.p1.x-this.p0.x,k=this.p1.y-this.p0.y,q=Math.sqrt(T*T+k*k),K=0,Mt=0;if(0!==d){if(q<=0)throw new Error("Cannot compute offset from zero-length line segment");K=d*T/q,Mt=d*k/q}return new J(v-Mt,w+K)},pn.prototype.setCoordinates=function(){if(1===arguments.length){var f=arguments[0];this.setCoordinates(f.p0,f.p1)}else if(2===arguments.length){var d=arguments[0],v=arguments[1];this.p0.x=d.x,this.p0.y=d.y,this.p1.x=v.x,this.p1.y=v.y}},pn.prototype.segmentFraction=function(f){var d=this.projectionFactor(f);return d<0?d=0:(d>1||ct.isNaN(d))&&(d=1),d},pn.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},pn.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},pn.prototype.distance=function(){if(arguments[0]instanceof pn){var f=arguments[0];return mn.distanceLineLine(this.p0,this.p1,f.p0,f.p1)}if(arguments[0]instanceof J)return mn.distancePointLine(arguments[0],this.p0,this.p1)},pn.prototype.pointAlong=function(f){var d=new J;return d.x=this.p0.x+f*(this.p1.x-this.p0.x),d.y=this.p0.y+f*(this.p1.y-this.p0.y),d},pn.prototype.hashCode=function(){var f=ct.doubleToLongBits(this.p0.x);f^=31*ct.doubleToLongBits(this.p0.y);var d=Math.trunc(f)^Math.trunc(f>>32),v=ct.doubleToLongBits(this.p1.x);return v^=31*ct.doubleToLongBits(this.p1.y),d^Math.trunc(v)^Math.trunc(v>>32)},pn.prototype.interfaces_=function(){return[ut,Ct]},pn.prototype.getClass=function(){return pn},pn.midPoint=function(f,d){return new J((f.x+d.x)/2,(f.y+d.y)/2)},Ti.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(pn,Ti);var ou=function(){this.tempEnv1=new hn,this.tempEnv2=new hn,this._overlapSeg1=new pn,this._overlapSeg2=new pn};ou.prototype.overlap=function(){if(2!==arguments.length&&4===arguments.length){var v=arguments[2],w=arguments[3];arguments[0].getLineSegment(arguments[1],this._overlapSeg1),v.getLineSegment(w,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},ou.prototype.interfaces_=function(){return[]},ou.prototype.getClass=function(){return ou};var Fo=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var d=arguments[1],v=arguments[2],w=arguments[3];this._pts=arguments[0],this._start=d,this._end=v,this._context=w};Fo.prototype.getLineSegment=function(f,d){d.p0=this._pts[f],d.p1=this._pts[f+1]},Fo.prototype.computeSelect=function(f,d,v,w){if(w.tempEnv1.init(this._pts[d],this._pts[v]),v-d==1)return w.select(this,d),null;if(!f.intersects(w.tempEnv1))return null;var q=Math.trunc((d+v)/2);d<q&&this.computeSelect(f,d,q,w),q<v&&this.computeSelect(f,q,v,w)},Fo.prototype.getCoordinates=function(){for(var f=new Array(this._end-this._start+1).fill(null),d=0,v=this._start;v<=this._end;v++)f[d++]=this._pts[v];return f},Fo.prototype.computeOverlaps=function(f,d){this.computeOverlapsInternal(this._start,this._end,f,f._start,f._end,d)},Fo.prototype.setId=function(f){this._id=f},Fo.prototype.select=function(f,d){this.computeSelect(f,this._start,this._end,d)},Fo.prototype.getEnvelope=function(){return null===this._env&&(this._env=new hn(this._pts[this._start],this._pts[this._end])),this._env},Fo.prototype.getEndIndex=function(){return this._end},Fo.prototype.getStartIndex=function(){return this._start},Fo.prototype.getContext=function(){return this._context},Fo.prototype.getId=function(){return this._id},Fo.prototype.computeOverlapsInternal=function(f,d,v,w,T,k){var q=this._pts[f],K=this._pts[d],Mt=v._pts[w],ae=v._pts[T];if(d-f==1&&T-w==1)return k.overlap(this,f,v,w),null;if(k.tempEnv1.init(q,K),k.tempEnv2.init(Mt,ae),!k.tempEnv1.intersects(k.tempEnv2))return null;var Ze=Math.trunc((f+d)/2),Qe=Math.trunc((w+T)/2);f<Ze&&(w<Qe&&this.computeOverlapsInternal(f,Ze,v,w,Qe,k),Qe<T&&this.computeOverlapsInternal(f,Ze,v,Qe,T,k)),Ze<d&&(w<Qe&&this.computeOverlapsInternal(Ze,d,v,w,Qe,k),Qe<T&&this.computeOverlapsInternal(Ze,d,v,Qe,T,k))},Fo.prototype.interfaces_=function(){return[]},Fo.prototype.getClass=function(){return Fo};var gi=function(){};gi.prototype.interfaces_=function(){return[]},gi.prototype.getClass=function(){return gi},gi.getChainStartIndices=function(f){var d=0,v=new lt;v.add(new At(d));do{var w=gi.findChainEnd(f,d);v.add(new At(w)),d=w}while(d<f.length-1);return gi.toIntArray(v)},gi.findChainEnd=function(f,d){for(var v=d;v<f.length-1&&f[v].equals2D(f[v+1]);)v++;if(v>=f.length-1)return f.length-1;for(var w=zn.quadrant(f[v],f[v+1]),T=d+1;T<f.length&&(f[T-1].equals2D(f[T])||zn.quadrant(f[T-1],f[T])===w);)T++;return T-1},gi.getChains=function(){if(1===arguments.length)return gi.getChains(arguments[0],null);if(2===arguments.length){for(var d=arguments[0],v=arguments[1],w=new lt,T=gi.getChainStartIndices(d),k=0;k<T.length-1;k++){var q=new Fo(d,T[k],T[k+1],v);w.add(q)}return w}},gi.toIntArray=function(f){for(var d=new Array(f.size()).fill(null),v=0;v<d.length;v++)d[v]=f.get(v).intValue();return d};var Gl=function(){};Gl.prototype.computeNodes=function(f){},Gl.prototype.getNodedSubstrings=function(){},Gl.prototype.interfaces_=function(){return[]},Gl.prototype.getClass=function(){return Gl};var Mu=function(){this._segInt=null,0!==arguments.length&&1===arguments.length&&this.setSegmentIntersector(arguments[0])};Mu.prototype.setSegmentIntersector=function(f){this._segInt=f},Mu.prototype.interfaces_=function(){return[Gl]},Mu.prototype.getClass=function(){return Mu};var Zr=function(f){function d(w){w?f.call(this,w):f.call(this),this._monoChains=new lt,this._index=new iu,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var v={SegmentOverlapAction:{configurable:!0}};return d.prototype.getMonotoneChains=function(){return this._monoChains},d.prototype.getNodedSubstrings=function(){return Ei.getNodedSubstrings(this._nodedSegStrings)},d.prototype.getIndex=function(){return this._index},d.prototype.add=function(w){for(var T=gi.getChains(w.getCoordinates(),w).iterator();T.hasNext();){var k=T.next();k.setId(this._idCounter++),this._index.insert(k.getEnvelope(),k),this._monoChains.add(k)}},d.prototype.computeNodes=function(w){this._nodedSegStrings=w;for(var T=w.iterator();T.hasNext();)this.add(T.next());this.intersectChains()},d.prototype.intersectChains=function(){for(var w=new yc(this._segInt),T=this._monoChains.iterator();T.hasNext();)for(var k=T.next(),q=this._index.query(k.getEnvelope()).iterator();q.hasNext();){var K=q.next();if(K.getId()>k.getId()&&(k.computeOverlaps(K,w),this._nOverlaps++),this._segInt.isDone())return null}},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},v.SegmentOverlapAction.get=function(){return yc},Object.defineProperties(d,v),d}(Mu),yc=function(f){function d(){f.call(this),this._si=null,this._si=arguments[0]}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.overlap=function(){if(4!==arguments.length)return f.prototype.overlap.apply(this,arguments);var w=arguments[1],T=arguments[2],k=arguments[3],q=arguments[0].getContext(),K=T.getContext();this._si.processIntersections(q,w,K,k)},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d}(ou),_i=function f(){if(this._quadrantSegments=f.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=f.CAP_ROUND,this._joinStyle=f.JOIN_ROUND,this._mitreLimit=f.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=f.DEFAULT_SIMPLIFY_FACTOR,0!==arguments.length)if(1===arguments.length)this.setQuadrantSegments(arguments[0]);else if(2===arguments.length){var w=arguments[1];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(w)}else if(4===arguments.length){var k=arguments[1],q=arguments[2],K=arguments[3];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(k),this.setJoinStyle(q),this.setMitreLimit(K)}},dr={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};_i.prototype.getEndCapStyle=function(){return this._endCapStyle},_i.prototype.isSingleSided=function(){return this._isSingleSided},_i.prototype.setQuadrantSegments=function(f){this._quadrantSegments=f,0===this._quadrantSegments&&(this._joinStyle=_i.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=_i.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),f<=0&&(this._quadrantSegments=1),this._joinStyle!==_i.JOIN_ROUND&&(this._quadrantSegments=_i.DEFAULT_QUADRANT_SEGMENTS)},_i.prototype.getJoinStyle=function(){return this._joinStyle},_i.prototype.setJoinStyle=function(f){this._joinStyle=f},_i.prototype.setSimplifyFactor=function(f){this._simplifyFactor=f<0?0:f},_i.prototype.getSimplifyFactor=function(){return this._simplifyFactor},_i.prototype.getQuadrantSegments=function(){return this._quadrantSegments},_i.prototype.setEndCapStyle=function(f){this._endCapStyle=f},_i.prototype.getMitreLimit=function(){return this._mitreLimit},_i.prototype.setMitreLimit=function(f){this._mitreLimit=f},_i.prototype.setSingleSided=function(f){this._isSingleSided=f},_i.prototype.interfaces_=function(){return[]},_i.prototype.getClass=function(){return _i},_i.bufferDistanceError=function(f){var d=Math.PI/2/f;return 1-Math.cos(d/2)},dr.CAP_ROUND.get=function(){return 1},dr.CAP_FLAT.get=function(){return 2},dr.CAP_SQUARE.get=function(){return 3},dr.JOIN_ROUND.get=function(){return 1},dr.JOIN_MITRE.get=function(){return 2},dr.JOIN_BEVEL.get=function(){return 3},dr.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},dr.DEFAULT_MITRE_LIMIT.get=function(){return 5},dr.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(_i,dr);var qr=function(f){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=mn.COUNTERCLOCKWISE,this._inputLine=f||null},ql={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};qr.prototype.isDeletable=function(f,d,v,w){var T=this._inputLine[f],k=this._inputLine[d],q=this._inputLine[v];return!!this.isConcave(T,k,q)&&!!this.isShallow(T,k,q,w)&&this.isShallowSampled(T,k,f,v,w)},qr.prototype.deleteShallowConcavities=function(){for(var f=1,d=this.findNextNonDeletedIndex(f),v=this.findNextNonDeletedIndex(d),w=!1;v<this._inputLine.length;){var T=!1;this.isDeletable(f,d,v,this._distanceTol)&&(this._isDeleted[d]=qr.DELETE,T=!0,w=!0),d=this.findNextNonDeletedIndex(f=T?v:d),v=this.findNextNonDeletedIndex(d)}return w},qr.prototype.isShallowConcavity=function(f,d,v,w){return mn.computeOrientation(f,d,v)===this._angleOrientation&&mn.distancePointLine(d,f,v)<w},qr.prototype.isShallowSampled=function(f,d,v,w,T){var k=Math.trunc((w-v)/qr.NUM_PTS_TO_CHECK);k<=0&&(k=1);for(var q=v;q<w;q+=k)if(!this.isShallow(f,d,this._inputLine[q],T))return!1;return!0},qr.prototype.isConcave=function(f,d,v){return mn.computeOrientation(f,d,v)===this._angleOrientation},qr.prototype.simplify=function(f){this._distanceTol=Math.abs(f),f<0&&(this._angleOrientation=mn.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var d=!1;do{d=this.deleteShallowConcavities()}while(d);return this.collapseLine()},qr.prototype.findNextNonDeletedIndex=function(f){for(var d=f+1;d<this._inputLine.length&&this._isDeleted[d]===qr.DELETE;)d++;return d},qr.prototype.isShallow=function(f,d,v,w){return mn.distancePointLine(d,f,v)<w},qr.prototype.collapseLine=function(){for(var f=new ve,d=0;d<this._inputLine.length;d++)this._isDeleted[d]!==qr.DELETE&&f.add(this._inputLine[d]);return f.toCoordinateArray()},qr.prototype.interfaces_=function(){return[]},qr.prototype.getClass=function(){return qr},qr.simplify=function(f,d){return new qr(f).simplify(d)},ql.INIT.get=function(){return 0},ql.DELETE.get=function(){return 1},ql.KEEP.get=function(){return 1},ql.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(qr,ql);var Rs=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new lt},Al={COORDINATE_ARRAY_TYPE:{configurable:!0}};Rs.prototype.getCoordinates=function(){return this._ptList.toArray(Rs.COORDINATE_ARRAY_TYPE)},Rs.prototype.setPrecisionModel=function(f){this._precisionModel=f},Rs.prototype.addPt=function(f){var d=new J(f);if(this._precisionModel.makePrecise(d),this.isRedundant(d))return null;this._ptList.add(d)},Rs.prototype.revere=function(){},Rs.prototype.addPts=function(f,d){if(d)for(var v=0;v<f.length;v++)this.addPt(f[v]);else for(var w=f.length-1;w>=0;w--)this.addPt(f[w])},Rs.prototype.isRedundant=function(f){if(this._ptList.size()<1)return!1;var d=this._ptList.get(this._ptList.size()-1);return f.distance(d)<this._minimimVertexDistance},Rs.prototype.toString=function(){return(new Hn).createLineString(this.getCoordinates()).toString()},Rs.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var f=new J(this._ptList.get(0)),d=this._ptList.get(this._ptList.size()-1);if(f.equals(d))return null;this._ptList.add(f)},Rs.prototype.setMinimumVertexDistance=function(f){this._minimimVertexDistance=f},Rs.prototype.interfaces_=function(){return[]},Rs.prototype.getClass=function(){return Rs},Al.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Rs,Al);var ii=function(){},vl={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};ii.prototype.interfaces_=function(){return[]},ii.prototype.getClass=function(){return ii},ii.toDegrees=function(f){return 180*f/Math.PI},ii.normalize=function(f){for(;f>Math.PI;)f-=ii.PI_TIMES_2;for(;f<=-Math.PI;)f+=ii.PI_TIMES_2;return f},ii.angle=function(){if(1===arguments.length){var f=arguments[0];return Math.atan2(f.y,f.x)}if(2===arguments.length){var d=arguments[0],v=arguments[1];return Math.atan2(v.y-d.y,v.x-d.x)}},ii.isAcute=function(f,d,v){return(f.x-d.x)*(v.x-d.x)+(f.y-d.y)*(v.y-d.y)>0},ii.isObtuse=function(f,d,v){return(f.x-d.x)*(v.x-d.x)+(f.y-d.y)*(v.y-d.y)<0},ii.interiorAngle=function(f,d,v){var w=ii.angle(d,f),T=ii.angle(d,v);return Math.abs(T-w)},ii.normalizePositive=function(f){if(f<0){for(;f<0;)f+=ii.PI_TIMES_2;f>=ii.PI_TIMES_2&&(f=0)}else{for(;f>=ii.PI_TIMES_2;)f-=ii.PI_TIMES_2;f<0&&(f=0)}return f},ii.angleBetween=function(f,d,v){var w=ii.angle(d,f),T=ii.angle(d,v);return ii.diff(w,T)},ii.diff=function(f,d){var v=null;return(v=f<d?d-f:f-d)>Math.PI&&(v=2*Math.PI-v),v},ii.toRadians=function(f){return f*Math.PI/180},ii.getTurn=function(f,d){var v=Math.sin(d-f);return v>0?ii.COUNTERCLOCKWISE:v<0?ii.CLOCKWISE:ii.NONE},ii.angleBetweenOriented=function(f,d,v){var w=ii.angle(d,f),T=ii.angle(d,v)-w;return T<=-Math.PI?T+ii.PI_TIMES_2:T>Math.PI?T-ii.PI_TIMES_2:T},vl.PI_TIMES_2.get=function(){return 2*Math.PI},vl.PI_OVER_2.get=function(){return Math.PI/2},vl.PI_OVER_4.get=function(){return Math.PI/4},vl.COUNTERCLOCKWISE.get=function(){return mn.COUNTERCLOCKWISE},vl.CLOCKWISE.get=function(){return mn.CLOCKWISE},vl.NONE.get=function(){return mn.COLLINEAR},Object.defineProperties(ii,vl);var ar=function f(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new pn,this._seg1=new pn,this._offset0=new pn,this._offset1=new pn,this._side=0,this._hasNarrowConcaveAngle=!1;var v=arguments[1],w=arguments[2];this._precisionModel=arguments[0],this._bufParams=v,this._li=new Rn,this._filletAngleQuantum=Math.PI/2/v.getQuadrantSegments(),v.getQuadrantSegments()>=8&&v.getJoinStyle()===_i.JOIN_ROUND&&(this._closingSegLengthFactor=f.MAX_CLOSING_SEG_LEN_FACTOR),this.init(w)},nf={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};ar.prototype.addNextSegment=function(f,d){if(this._s0=this._s1,this._s1=this._s2,this._s2=f,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var v=mn.computeOrientation(this._s0,this._s1,this._s2),w=v===mn.CLOCKWISE&&this._side===jt.LEFT||v===mn.COUNTERCLOCKWISE&&this._side===jt.RIGHT;0===v?this.addCollinear(d):w?this.addOutsideTurn(v,d):this.addInsideTurn(v,d)},ar.prototype.addLineEndCap=function(f,d){var v=new pn(f,d),w=new pn;this.computeOffsetSegment(v,jt.LEFT,this._distance,w);var T=new pn;this.computeOffsetSegment(v,jt.RIGHT,this._distance,T);var K=Math.atan2(d.y-f.y,d.x-f.x);switch(this._bufParams.getEndCapStyle()){case _i.CAP_ROUND:this._segList.addPt(w.p1),this.addFilletArc(d,K+Math.PI/2,K-Math.PI/2,mn.CLOCKWISE,this._distance),this._segList.addPt(T.p1);break;case _i.CAP_FLAT:this._segList.addPt(w.p1),this._segList.addPt(T.p1);break;case _i.CAP_SQUARE:var Mt=new J;Mt.x=Math.abs(this._distance)*Math.cos(K),Mt.y=Math.abs(this._distance)*Math.sin(K);var ae=new J(w.p1.x+Mt.x,w.p1.y+Mt.y),Ze=new J(T.p1.x+Mt.x,T.p1.y+Mt.y);this._segList.addPt(ae),this._segList.addPt(Ze)}},ar.prototype.getCoordinates=function(){return this._segList.getCoordinates()},ar.prototype.addMitreJoin=function(f,d,v,w){var T=!0,k=null;try{k=Gn.intersection(d.p0,d.p1,v.p0,v.p1),(w<=0?1:k.distance(f)/Math.abs(w))>this._bufParams.getMitreLimit()&&(T=!1)}catch(q){if(!(q instanceof yn))throw q;k=new J(0,0),T=!1}T?this._segList.addPt(k):this.addLimitedMitreJoin(d,v,w,this._bufParams.getMitreLimit())},ar.prototype.addFilletCorner=function(f,d,v,w,T){var K=Math.atan2(d.y-f.y,d.x-f.x),Ze=Math.atan2(v.y-f.y,v.x-f.x);w===mn.CLOCKWISE?K<=Ze&&(K+=2*Math.PI):K>=Ze&&(K-=2*Math.PI),this._segList.addPt(d),this.addFilletArc(f,K,Ze,w,T),this._segList.addPt(v)},ar.prototype.addOutsideTurn=function(f,d){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*ar.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===_i.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===_i.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(d&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,f,this._distance),this._segList.addPt(this._offset1.p0))},ar.prototype.createSquare=function(f){this._segList.addPt(new J(f.x+this._distance,f.y+this._distance)),this._segList.addPt(new J(f.x+this._distance,f.y-this._distance)),this._segList.addPt(new J(f.x-this._distance,f.y-this._distance)),this._segList.addPt(new J(f.x-this._distance,f.y+this._distance)),this._segList.closeRing()},ar.prototype.addSegments=function(f,d){this._segList.addPts(f,d)},ar.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},ar.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},ar.prototype.initSideSegments=function(f,d,v){this._s1=f,this._s2=d,this._side=v,this._seg1.setCoordinates(f,d),this.computeOffsetSegment(this._seg1,v,this._distance,this._offset1)},ar.prototype.addLimitedMitreJoin=function(f,d,v,w){var T=this._seg0.p1,k=ii.angle(T,this._seg0.p0),q=ii.angleBetweenOriented(this._seg0.p0,T,this._seg1.p1)/2,K=ii.normalize(k+q),Mt=ii.normalize(K+Math.PI),ae=w*v,Ze=v-ae*Math.abs(Math.sin(q)),Qe=T.x+ae*Math.cos(Mt),Pn=T.y+ae*Math.sin(Mt),Bn=new J(Qe,Pn),tr=new pn(T,Bn),_r=tr.pointAlongOffset(1,Ze),Ki=tr.pointAlongOffset(1,-Ze);this._side===jt.LEFT?(this._segList.addPt(_r),this._segList.addPt(Ki)):(this._segList.addPt(Ki),this._segList.addPt(_r))},ar.prototype.computeOffsetSegment=function(f,d,v,w){var T=d===jt.LEFT?1:-1,k=f.p1.x-f.p0.x,q=f.p1.y-f.p0.y,K=Math.sqrt(k*k+q*q),Mt=T*v*k/K,ae=T*v*q/K;w.p0.x=f.p0.x-ae,w.p0.y=f.p0.y+Mt,w.p1.x=f.p1.x-ae,w.p1.y=f.p1.y+Mt},ar.prototype.addFilletArc=function(f,d,v,w,T){var k=w===mn.CLOCKWISE?-1:1,q=Math.abs(d-v),K=Math.trunc(q/this._filletAngleQuantum+.5);if(K<1)return null;for(var Mt=q/K,ae=0,Ze=new J;ae<q;){var Qe=d+k*ae;Ze.x=f.x+T*Math.cos(Qe),Ze.y=f.y+T*Math.sin(Qe),this._segList.addPt(Ze),ae+=Mt}},ar.prototype.addInsideTurn=function(f,d){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*ar.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var v=new J((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(v);var w=new J((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(w)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},ar.prototype.createCircle=function(f){var d=new J(f.x+this._distance,f.y);this._segList.addPt(d),this.addFilletArc(f,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},ar.prototype.addBevelJoin=function(f,d){this._segList.addPt(f.p1),this._segList.addPt(d.p0)},ar.prototype.init=function(f){this._distance=f,this._maxCurveSegmentError=f*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Rs,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(f*ar.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},ar.prototype.addCollinear=function(f){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===_i.JOIN_BEVEL||this._bufParams.getJoinStyle()===_i.JOIN_MITRE?(f&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,mn.CLOCKWISE,this._distance))},ar.prototype.closeRing=function(){this._segList.closeRing()},ar.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},ar.prototype.interfaces_=function(){return[]},ar.prototype.getClass=function(){return ar},nf.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},nf.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},nf.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},nf.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(ar,nf);var oa=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var d=arguments[1];this._precisionModel=arguments[0],this._bufParams=d};oa.prototype.getOffsetCurve=function(f,d){if(this._distance=d,0===d)return null;var v=d<0,w=Math.abs(d),T=this.getSegGen(w);f.length<=1?this.computePointCurve(f[0],T):this.computeOffsetCurve(f,v,T);var k=T.getCoordinates();return v&&ye.reverse(k),k},oa.prototype.computeSingleSidedBufferCurve=function(f,d,v){var w=this.simplifyTolerance(this._distance);if(d){v.addSegments(f,!0);var T=qr.simplify(f,-w),k=T.length-1;v.initSideSegments(T[k],T[k-1],jt.LEFT),v.addFirstSegment();for(var q=k-2;q>=0;q--)v.addNextSegment(T[q],!0)}else{v.addSegments(f,!1);var K=qr.simplify(f,w),Mt=K.length-1;v.initSideSegments(K[0],K[1],jt.LEFT),v.addFirstSegment();for(var ae=2;ae<=Mt;ae++)v.addNextSegment(K[ae],!0)}v.addLastSegment(),v.closeRing()},oa.prototype.computeRingBufferCurve=function(f,d,v){var w=this.simplifyTolerance(this._distance);d===jt.RIGHT&&(w=-w);var T=qr.simplify(f,w),k=T.length-1;v.initSideSegments(T[k-1],T[0],d);for(var q=1;q<=k;q++)v.addNextSegment(T[q],1!==q);v.closeRing()},oa.prototype.computeLineBufferCurve=function(f,d){var v=this.simplifyTolerance(this._distance),w=qr.simplify(f,v),T=w.length-1;d.initSideSegments(w[0],w[1],jt.LEFT);for(var k=2;k<=T;k++)d.addNextSegment(w[k],!0);d.addLastSegment(),d.addLineEndCap(w[T-1],w[T]);var q=qr.simplify(f,-v),K=q.length-1;d.initSideSegments(q[K],q[K-1],jt.LEFT);for(var Mt=K-2;Mt>=0;Mt--)d.addNextSegment(q[Mt],!0);d.addLastSegment(),d.addLineEndCap(q[1],q[0]),d.closeRing()},oa.prototype.computePointCurve=function(f,d){switch(this._bufParams.getEndCapStyle()){case _i.CAP_ROUND:d.createCircle(f);break;case _i.CAP_SQUARE:d.createSquare(f)}},oa.prototype.getLineCurve=function(f,d){if(this._distance=d,d<0&&!this._bufParams.isSingleSided()||0===d)return null;var v=Math.abs(d),w=this.getSegGen(v);return f.length<=1?this.computePointCurve(f[0],w):this._bufParams.isSingleSided()?this.computeSingleSidedBufferCurve(f,d<0,w):this.computeLineBufferCurve(f,w),w.getCoordinates()},oa.prototype.getBufferParameters=function(){return this._bufParams},oa.prototype.simplifyTolerance=function(f){return f*this._bufParams.getSimplifyFactor()},oa.prototype.getRingCurve=function(f,d,v){if(this._distance=v,f.length<=2)return this.getLineCurve(f,v);if(0===v)return oa.copyCoordinates(f);var w=this.getSegGen(v);return this.computeRingBufferCurve(f,d,w),w.getCoordinates()},oa.prototype.computeOffsetCurve=function(f,d,v){var w=this.simplifyTolerance(this._distance);if(d){var T=qr.simplify(f,-w),k=T.length-1;v.initSideSegments(T[k],T[k-1],jt.LEFT),v.addFirstSegment();for(var q=k-2;q>=0;q--)v.addNextSegment(T[q],!0)}else{var K=qr.simplify(f,w),Mt=K.length-1;v.initSideSegments(K[0],K[1],jt.LEFT),v.addFirstSegment();for(var ae=2;ae<=Mt;ae++)v.addNextSegment(K[ae],!0)}v.addLastSegment()},oa.prototype.getSegGen=function(f){return new ar(this._precisionModel,this._bufParams,f)},oa.prototype.interfaces_=function(){return[]},oa.prototype.getClass=function(){return oa},oa.copyCoordinates=function(f){for(var d=new Array(f.length).fill(null),v=0;v<d.length;v++)d[v]=new J(f[v]);return d};var tl=function(){this._subgraphs=null,this._seg=new pn,this._cga=new mn,this._subgraphs=arguments[0]},vc={DepthSegment:{configurable:!0}};tl.prototype.findStabbedSegments=function(){if(1===arguments.length){for(var f=arguments[0],d=new lt,v=this._subgraphs.iterator();v.hasNext();){var w=v.next(),T=w.getEnvelope();f.y<T.getMinY()||f.y>T.getMaxY()||this.findStabbedSegments(f,w.getDirectedEdges(),d)}return d}if(3===arguments.length)if(en(arguments[2],Kt)&&arguments[0]instanceof J&&arguments[1]instanceof Gi){for(var k=arguments[0],q=arguments[1],K=arguments[2],Mt=q.getEdge().getCoordinates(),ae=0;ae<Mt.length-1;ae++)if(this._seg.p0=Mt[ae],this._seg.p1=Mt[ae+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<k.x||this._seg.isHorizontal()||k.y<this._seg.p0.y||k.y>this._seg.p1.y||mn.computeOrientation(this._seg.p0,this._seg.p1,k)===mn.RIGHT)){var Ze=q.getDepth(jt.LEFT);this._seg.p0.equals(Mt[ae])||(Ze=q.getDepth(jt.RIGHT));var Qe=new Gs(this._seg,Ze);K.add(Qe)}}else if(en(arguments[2],Kt)&&arguments[0]instanceof J&&en(arguments[1],Kt))for(var Pn=arguments[0],tr=arguments[2],_r=arguments[1].iterator();_r.hasNext();){var Ki=_r.next();Ki.isForward()&&this.findStabbedSegments(Pn,Ki,tr)}},tl.prototype.getDepth=function(f){var d=this.findStabbedSegments(f);return 0===d.size()?0:ur.min(d)._leftDepth},tl.prototype.interfaces_=function(){return[]},tl.prototype.getClass=function(){return tl},vc.DepthSegment.get=function(){return Gs},Object.defineProperties(tl,vc);var Gs=function(){this._upwardSeg=null,this._leftDepth=null;var d=arguments[1];this._upwardSeg=new pn(arguments[0]),this._leftDepth=d};Gs.prototype.compareTo=function(f){var d=f;if(this._upwardSeg.minX()>=d._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=d._upwardSeg.minX())return-1;var v=this._upwardSeg.orientationIndex(d._upwardSeg);return 0!==v||0!=(v=-1*d._upwardSeg.orientationIndex(this._upwardSeg))?v:this._upwardSeg.compareTo(d._upwardSeg)},Gs.prototype.compareX=function(f,d){var v=f.p0.compareTo(d.p0);return 0!==v?v:f.p1.compareTo(d.p1)},Gs.prototype.toString=function(){return this._upwardSeg.toString()},Gs.prototype.interfaces_=function(){return[ut]},Gs.prototype.getClass=function(){return Gs};var Ur=function(f,d,v){this.p0=f||null,this.p1=d||null,this.p2=v||null};Ur.prototype.area=function(){return Ur.area(this.p0,this.p1,this.p2)},Ur.prototype.signedArea=function(){return Ur.signedArea(this.p0,this.p1,this.p2)},Ur.prototype.interpolateZ=function(f){if(null===f)throw new gt("Supplied point is null.");return Ur.interpolateZ(f,this.p0,this.p1,this.p2)},Ur.prototype.longestSideLength=function(){return Ur.longestSideLength(this.p0,this.p1,this.p2)},Ur.prototype.isAcute=function(){return Ur.isAcute(this.p0,this.p1,this.p2)},Ur.prototype.circumcentre=function(){return Ur.circumcentre(this.p0,this.p1,this.p2)},Ur.prototype.area3D=function(){return Ur.area3D(this.p0,this.p1,this.p2)},Ur.prototype.centroid=function(){return Ur.centroid(this.p0,this.p1,this.p2)},Ur.prototype.inCentre=function(){return Ur.inCentre(this.p0,this.p1,this.p2)},Ur.prototype.interfaces_=function(){return[]},Ur.prototype.getClass=function(){return Ur},Ur.area=function(f,d,v){return Math.abs(((v.x-f.x)*(d.y-f.y)-(d.x-f.x)*(v.y-f.y))/2)},Ur.signedArea=function(f,d,v){return((v.x-f.x)*(d.y-f.y)-(d.x-f.x)*(v.y-f.y))/2},Ur.det=function(f,d,v,w){return f*w-d*v},Ur.interpolateZ=function(f,d,v,w){var T=d.x,k=d.y,q=v.x-T,K=w.x-T,Mt=v.y-k,ae=w.y-k,Ze=q*ae-K*Mt,Qe=f.x-T,Pn=f.y-k;return d.z+(ae*Qe-K*Pn)/Ze*(v.z-d.z)+(-Mt*Qe+q*Pn)/Ze*(w.z-d.z)},Ur.longestSideLength=function(f,d,v){var w=f.distance(d),T=d.distance(v),k=v.distance(f),q=w;return T>q&&(q=T),k>q&&(q=k),q},Ur.isAcute=function(f,d,v){return!!ii.isAcute(f,d,v)&&!!ii.isAcute(d,v,f)&&!!ii.isAcute(v,f,d)},Ur.circumcentre=function(f,d,v){var w=v.x,T=v.y,k=f.x-w,q=f.y-T,K=d.x-w,Mt=d.y-T,ae=2*Ur.det(k,q,K,Mt),Ze=Ur.det(q,k*k+q*q,Mt,K*K+Mt*Mt),Qe=Ur.det(k,k*k+q*q,K,K*K+Mt*Mt);return new J(w-Ze/ae,T+Qe/ae)},Ur.perpendicularBisector=function(f,d){var v=d.x-f.x,w=d.y-f.y,T=new Gn(f.x+v/2,f.y+w/2,1),k=new Gn(f.x-w+v/2,f.y+v+w/2,1);return new Gn(T,k)},Ur.angleBisector=function(f,d,v){var w=d.distance(f),T=w/(w+d.distance(v));return new J(f.x+T*(v.x-f.x),f.y+T*(v.y-f.y))},Ur.area3D=function(f,d,v){var w=d.x-f.x,T=d.y-f.y,k=d.z-f.z,q=v.x-f.x,K=v.y-f.y,Mt=v.z-f.z,ae=T*Mt-k*K,Ze=k*q-w*Mt,Qe=w*K-T*q;return Math.sqrt(ae*ae+Ze*Ze+Qe*Qe)/2},Ur.centroid=function(f,d,v){return new J((f.x+d.x+v.x)/3,(f.y+d.y+v.y)/3)},Ur.inCentre=function(f,d,v){var w=d.distance(v),T=f.distance(v),k=f.distance(d),q=w+T+k;return new J((w*f.x+T*d.x+k*v.x)/q,(w*f.y+T*d.y+k*v.y)/q)};var Js=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new lt;var d=arguments[1],v=arguments[2];this._inputGeom=arguments[0],this._distance=d,this._curveBuilder=v};Js.prototype.addPoint=function(f){if(this._distance<=0)return null;var d=f.getCoordinates(),v=this._curveBuilder.getLineCurve(d,this._distance);this.addCurve(v,Et.EXTERIOR,Et.INTERIOR)},Js.prototype.addPolygon=function(f){var d=this._distance,v=jt.LEFT;this._distance<0&&(d=-this._distance,v=jt.RIGHT);var w=f.getExteriorRing(),T=ye.removeRepeatedPoints(w.getCoordinates());if(this._distance<0&&this.isErodedCompletely(w,this._distance)||this._distance<=0&&T.length<3)return null;this.addPolygonRing(T,d,v,Et.EXTERIOR,Et.INTERIOR);for(var k=0;k<f.getNumInteriorRing();k++){var q=f.getInteriorRingN(k),K=ye.removeRepeatedPoints(q.getCoordinates());this._distance>0&&this.isErodedCompletely(q,-this._distance)||this.addPolygonRing(K,d,jt.opposite(v),Et.INTERIOR,Et.EXTERIOR)}},Js.prototype.isTriangleErodedCompletely=function(f,d){var v=new Ur(f[0],f[1],f[2]),w=v.inCentre();return mn.distancePointLine(w,v.p0,v.p1)<Math.abs(d)},Js.prototype.addLineString=function(f){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var d=ye.removeRepeatedPoints(f.getCoordinates()),v=this._curveBuilder.getLineCurve(d,this._distance);this.addCurve(v,Et.EXTERIOR,Et.INTERIOR)},Js.prototype.addCurve=function(f,d,v){if(null===f||f.length<2)return null;var w=new Ei(f,new Se(0,Et.BOUNDARY,d,v));this._curveList.add(w)},Js.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},Js.prototype.addPolygonRing=function(f,d,v,w,T){if(0===d&&f.length<pl.MINIMUM_VALID_SIZE)return null;var k=w,q=T;f.length>=pl.MINIMUM_VALID_SIZE&&mn.isCCW(f)&&(k=T,q=w,v=jt.opposite(v));var K=this._curveBuilder.getRingCurve(f,v,d);this.addCurve(K,k,q)},Js.prototype.add=function(f){if(f.isEmpty())return null;f instanceof wi?this.addPolygon(f):f instanceof ps?this.addLineString(f):f instanceof ga?this.addPoint(f):(f instanceof jl||f instanceof ls||f instanceof Os||f instanceof Rr)&&this.addCollection(f)},Js.prototype.isErodedCompletely=function(f,d){var v=f.getCoordinates();if(v.length<4)return d<0;if(4===v.length)return this.isTriangleErodedCompletely(v,d);var w=f.getEnvelopeInternal(),T=Math.min(w.getHeight(),w.getWidth());return d<0&&2*Math.abs(d)>T},Js.prototype.addCollection=function(f){for(var d=0;d<f.getNumGeometries();d++){var v=f.getGeometryN(d);this.add(v)}},Js.prototype.interfaces_=function(){return[]},Js.prototype.getClass=function(){return Js};var Ns=function(){};Ns.prototype.locate=function(f){},Ns.prototype.interfaces_=function(){return[]},Ns.prototype.getClass=function(){return Ns};var el=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var f=arguments[0];this._parent=f,this._atStart=!0,this._index=0,this._max=f.getNumGeometries()};el.prototype.next=function(){if(this._atStart)return this._atStart=!1,el.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new oe;var f=this._parent.getGeometryN(this._index++);return f instanceof Rr?(this._subcollectionIterator=new el(f),this._subcollectionIterator.next()):f},el.prototype.remove=function(){throw new Error(this.getClass().getName())},el.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},el.prototype.interfaces_=function(){return[Je]},el.prototype.getClass=function(){return el},el.isAtomic=function(f){return!(f instanceof Rr)};var sa=function(){this._geom=null,this._geom=arguments[0]};sa.prototype.locate=function(f){return sa.locate(f,this._geom)},sa.prototype.interfaces_=function(){return[Ns]},sa.prototype.getClass=function(){return sa},sa.isPointInRing=function(f,d){return!!d.getEnvelopeInternal().intersects(f)&&mn.isPointInRing(f,d.getCoordinates())},sa.containsPointInPolygon=function(f,d){if(d.isEmpty())return!1;var v=d.getExteriorRing();if(!sa.isPointInRing(f,v))return!1;for(var w=0;w<d.getNumInteriorRing();w++){var T=d.getInteriorRingN(w);if(sa.isPointInRing(f,T))return!1}return!0},sa.containsPoint=function(f,d){if(d instanceof wi)return sa.containsPointInPolygon(f,d);if(d instanceof Rr)for(var v=new el(d);v.hasNext();){var w=v.next();if(w!==d&&sa.containsPoint(f,w))return!0}return!1},sa.locate=function(f,d){return d.isEmpty()?Et.EXTERIOR:sa.containsPoint(f,d)?Et.INTERIOR:Et.EXTERIOR};var Ms=function(){this._edgeMap=new Ce,this._edgeList=null,this._ptInAreaLocation=[Et.NONE,Et.NONE]};Ms.prototype.getNextCW=function(f){this.getEdges();var d=this._edgeList.indexOf(f),v=d-1;return 0===d&&(v=this._edgeList.size()-1),this._edgeList.get(v)},Ms.prototype.propagateSideLabels=function(f){for(var d=Et.NONE,v=this.iterator();v.hasNext();){var w=v.next().getLabel();w.isArea(f)&&w.getLocation(f,jt.LEFT)!==Et.NONE&&(d=w.getLocation(f,jt.LEFT))}if(d===Et.NONE)return null;for(var T=d,k=this.iterator();k.hasNext();){var q=k.next(),K=q.getLabel();if(K.getLocation(f,jt.ON)===Et.NONE&&K.setLocation(f,jt.ON,T),K.isArea(f)){var Mt=K.getLocation(f,jt.LEFT),ae=K.getLocation(f,jt.RIGHT);if(ae!==Et.NONE){if(ae!==T)throw new Dn("side location conflict",q.getCoordinate());Mt===Et.NONE&&We.shouldNeverReachHere("found single null side (at "+q.getCoordinate()+")"),T=Mt}else We.isTrue(K.getLocation(f,jt.LEFT)===Et.NONE,"found single null side"),K.setLocation(f,jt.RIGHT,T),K.setLocation(f,jt.LEFT,T)}}},Ms.prototype.getCoordinate=function(){var f=this.iterator();return f.hasNext()?f.next().getCoordinate():null},Ms.prototype.print=function(f){Yn.out.println("EdgeEndStar:   "+this.getCoordinate());for(var d=this.iterator();d.hasNext();)d.next().print(f)},Ms.prototype.isAreaLabelsConsistent=function(f){return this.computeEdgeEndLabels(f.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},Ms.prototype.checkAreaLabelsConsistent=function(f){var d=this.getEdges();if(d.size()<=0)return!0;var v=d.size()-1,w=d.get(v).getLabel().getLocation(f,jt.LEFT);We.isTrue(w!==Et.NONE,"Found unlabelled area edge");for(var T=w,k=this.iterator();k.hasNext();){var q=k.next().getLabel();We.isTrue(q.isArea(f),"Found non-area edge");var K=q.getLocation(f,jt.LEFT),Mt=q.getLocation(f,jt.RIGHT);if(K===Mt||Mt!==T)return!1;T=K}return!0},Ms.prototype.findIndex=function(f){this.iterator();for(var d=0;d<this._edgeList.size();d++)if(this._edgeList.get(d)===f)return d;return-1},Ms.prototype.iterator=function(){return this.getEdges().iterator()},Ms.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new lt(this._edgeMap.values())),this._edgeList},Ms.prototype.getLocation=function(f,d,v){return this._ptInAreaLocation[f]===Et.NONE&&(this._ptInAreaLocation[f]=sa.locate(d,v[f].getGeometry())),this._ptInAreaLocation[f]},Ms.prototype.toString=function(){var f=new Vt;f.append("EdgeEndStar:   "+this.getCoordinate()),f.append("\n");for(var d=this.iterator();d.hasNext();){var v=d.next();f.append(v),f.append("\n")}return f.toString()},Ms.prototype.computeEdgeEndLabels=function(f){for(var d=this.iterator();d.hasNext();)d.next().computeLabel(f)},Ms.prototype.computeLabelling=function(f){this.computeEdgeEndLabels(f[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var d=[!1,!1],v=this.iterator();v.hasNext();)for(var w=v.next().getLabel(),T=0;T<2;T++)w.isLine(T)&&w.getLocation(T)===Et.BOUNDARY&&(d[T]=!0);for(var k=this.iterator();k.hasNext();)for(var q=k.next(),K=q.getLabel(),Mt=0;Mt<2;Mt++)if(K.isAnyNull(Mt)){var ae=Et.NONE;if(d[Mt])ae=Et.EXTERIOR;else{var Ze=q.getCoordinate();ae=this.getLocation(Mt,Ze,f)}K.setAllLocationsIfNull(Mt,ae)}},Ms.prototype.getDegree=function(){return this._edgeMap.size()},Ms.prototype.insertEdgeEnd=function(f,d){this._edgeMap.put(f,d),this._edgeList=null},Ms.prototype.interfaces_=function(){return[]},Ms.prototype.getClass=function(){return Ms};var xc=function(f){function d(){f.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var v=null,w=null,T=this._SCANNING_FOR_INCOMING,k=0;k<this._resultAreaEdgeList.size();k++){var q=this._resultAreaEdgeList.get(k),K=q.getSym();if(q.getLabel().isArea())switch(null===v&&q.isInResult()&&(v=q),T){case this._SCANNING_FOR_INCOMING:if(!K.isInResult())continue;w=K,T=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!q.isInResult())continue;w.setNext(q),T=this._SCANNING_FOR_INCOMING}}if(T===this._LINKING_TO_OUTGOING){if(null===v)throw new Dn("no outgoing dirEdge found",this.getCoordinate());We.isTrue(v.isInResult(),"unable to link last incoming dirEdge"),w.setNext(v)}},d.prototype.insert=function(v){this.insertEdgeEnd(v,v)},d.prototype.getRightmostEdge=function(){var v=this.getEdges(),w=v.size();if(w<1)return null;var T=v.get(0);if(1===w)return T;var k=v.get(w-1),q=T.getQuadrant(),K=k.getQuadrant();return zn.isNorthern(q)&&zn.isNorthern(K)?T:zn.isNorthern(q)||zn.isNorthern(K)?0!==T.getDy()?T:0!==k.getDy()?k:(We.shouldNeverReachHere("found two horizontal edges incident on node"),null):k},d.prototype.print=function(v){Yn.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var w=this.iterator();w.hasNext();){var T=w.next();v.print("out "),T.print(v),v.println(),v.print("in "),T.getSym().print(v),v.println()}},d.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new lt;for(var v=this.iterator();v.hasNext();){var w=v.next();(w.isInResult()||w.getSym().isInResult())&&this._resultAreaEdgeList.add(w)}return this._resultAreaEdgeList},d.prototype.updateLabelling=function(v){for(var w=this.iterator();w.hasNext();){var T=w.next().getLabel();T.setAllLocationsIfNull(0,v.getLocation(0)),T.setAllLocationsIfNull(1,v.getLocation(1))}},d.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var v=null,w=null,T=this._edgeList.size()-1;T>=0;T--){var k=this._edgeList.get(T),q=k.getSym();null===w&&(w=q),null!==v&&q.setNext(v),v=k}w.setNext(v)},d.prototype.computeDepths=function(){if(1===arguments.length){var v=arguments[0],w=this.findIndex(v),T=v.getDepth(jt.LEFT),k=v.getDepth(jt.RIGHT),q=this.computeDepths(w+1,this._edgeList.size(),T);if(this.computeDepths(0,w,q)!==k)throw new Dn("depth mismatch at "+v.getCoordinate())}else if(3===arguments.length){for(var Mt=arguments[1],ae=arguments[2],Ze=arguments[0];Ze<Mt;Ze++){var Qe=this._edgeList.get(Ze);Qe.setEdgeDepths(jt.RIGHT,ae),ae=Qe.getDepth(jt.LEFT)}return ae}},d.prototype.mergeSymLabels=function(){for(var v=this.iterator();v.hasNext();){var w=v.next();w.getLabel().merge(w.getSym().getLabel())}},d.prototype.linkMinimalDirectedEdges=function(v){for(var w=null,T=null,k=this._SCANNING_FOR_INCOMING,q=this._resultAreaEdgeList.size()-1;q>=0;q--){var K=this._resultAreaEdgeList.get(q),Mt=K.getSym();switch(null===w&&K.getEdgeRing()===v&&(w=K),k){case this._SCANNING_FOR_INCOMING:if(Mt.getEdgeRing()!==v)continue;T=Mt,k=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(K.getEdgeRing()!==v)continue;T.setNextMin(K),k=this._SCANNING_FOR_INCOMING}}k===this._LINKING_TO_OUTGOING&&(We.isTrue(null!==w,"found null for first outgoing dirEdge"),We.isTrue(w.getEdgeRing()===v,"unable to link last incoming dirEdge"),T.setNextMin(w))},d.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var v=0,w=this.iterator();w.hasNext();)w.next().isInResult()&&v++;return v}if(1===arguments.length){for(var T=arguments[0],k=0,q=this.iterator();q.hasNext();)q.next().getEdgeRing()===T&&k++;return k}},d.prototype.getLabel=function(){return this._label},d.prototype.findCoveredLineEdges=function(){for(var v=Et.NONE,w=this.iterator();w.hasNext();){var T=w.next(),k=T.getSym();if(!T.isLineEdge()){if(T.isInResult()){v=Et.INTERIOR;break}if(k.isInResult()){v=Et.EXTERIOR;break}}}if(v===Et.NONE)return null;for(var q=v,K=this.iterator();K.hasNext();){var Mt=K.next(),ae=Mt.getSym();Mt.isLineEdge()?Mt.getEdge().setCovered(q===Et.INTERIOR):(Mt.isInResult()&&(q=Et.EXTERIOR),ae.isInResult()&&(q=Et.INTERIOR))}},d.prototype.computeLabelling=function(v){f.prototype.computeLabelling.call(this,v),this._label=new Se(Et.NONE);for(var w=this.iterator();w.hasNext();)for(var T=w.next().getEdge().getLabel(),k=0;k<2;k++){var q=T.getLocation(k);q!==Et.INTERIOR&&q!==Et.BOUNDARY||this._label.setLocation(k,Et.INTERIOR)}},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d}(Ms),bc=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.createNode=function(v){return new Pi(v,new xc)},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d}(za),Ks=function f(){this._pts=null,this._orientation=null;var d=arguments[0];this._pts=d,this._orientation=f.orientation(d)};Ks.prototype.compareTo=function(f){return Ks.compareOriented(this._pts,this._orientation,f._pts,f._orientation)},Ks.prototype.interfaces_=function(){return[ut]},Ks.prototype.getClass=function(){return Ks},Ks.orientation=function(f){return 1===ye.increasingDirection(f)},Ks.compareOriented=function(f,d,v,w){for(var T=d?1:-1,k=w?1:-1,q=d?f.length:-1,K=w?v.length:-1,Mt=d?0:f.length-1,ae=w?0:v.length-1;;){var Ze=f[Mt].compareTo(v[ae]);if(0!==Ze)return Ze;var Qe=(Mt+=T)===q,Pn=(ae+=k)===K;if(Qe&&!Pn)return-1;if(!Qe&&Pn)return 1;if(Qe&&Pn)return 0}};var xl=function(){this._edges=new lt,this._ocaMap=new Ce};xl.prototype.print=function(f){f.print("MULTILINESTRING ( ");for(var d=0;d<this._edges.size();d++){var v=this._edges.get(d);d>0&&f.print(","),f.print("(");for(var w=v.getCoordinates(),T=0;T<w.length;T++)T>0&&f.print(","),f.print(w[T].x+" "+w[T].y);f.println(")")}f.print(")  ")},xl.prototype.addAll=function(f){for(var d=f.iterator();d.hasNext();)this.add(d.next())},xl.prototype.findEdgeIndex=function(f){for(var d=0;d<this._edges.size();d++)if(this._edges.get(d).equals(f))return d;return-1},xl.prototype.iterator=function(){return this._edges.iterator()},xl.prototype.getEdges=function(){return this._edges},xl.prototype.get=function(f){return this._edges.get(f)},xl.prototype.findEqualEdge=function(f){var d=new Ks(f.getCoordinates());return this._ocaMap.get(d)},xl.prototype.add=function(f){this._edges.add(f);var d=new Ks(f.getCoordinates());this._ocaMap.put(d,f)},xl.prototype.interfaces_=function(){return[]},xl.prototype.getClass=function(){return xl};var Kr=function(){};Kr.prototype.processIntersections=function(f,d,v,w){},Kr.prototype.isDone=function(){},Kr.prototype.interfaces_=function(){return[]},Kr.prototype.getClass=function(){return Kr};var ya=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0,this._li=arguments[0]};ya.prototype.isTrivialIntersection=function(f,d,v,w){if(f===v&&1===this._li.getIntersectionNum()){if(ya.isAdjacentSegments(d,w))return!0;if(f.isClosed()){var T=f.size()-1;if(0===d&&w===T||0===w&&d===T)return!0}}return!1},ya.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},ya.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},ya.prototype.getLineIntersector=function(){return this._li},ya.prototype.hasProperIntersection=function(){return this._hasProper},ya.prototype.processIntersections=function(f,d,v,w){if(f===v&&d===w)return null;this.numTests++;var T=f.getCoordinates()[d],k=f.getCoordinates()[d+1],q=v.getCoordinates()[w],K=v.getCoordinates()[w+1];this._li.computeIntersection(T,k,q,K),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(f,d,v,w)||(this._hasIntersection=!0,f.addIntersections(this._li,d,0),v.addIntersections(this._li,w,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},ya.prototype.hasIntersection=function(){return this._hasIntersection},ya.prototype.isDone=function(){return!1},ya.prototype.hasInteriorIntersection=function(){return this._hasInterior},ya.prototype.interfaces_=function(){return[Kr]},ya.prototype.getClass=function(){return ya},ya.isAdjacentSegments=function(f,d){return 1===Math.abs(f-d)};var mi=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var d=arguments[1],v=arguments[2];this.coord=new J(arguments[0]),this.segmentIndex=d,this.dist=v};mi.prototype.getSegmentIndex=function(){return this.segmentIndex},mi.prototype.getCoordinate=function(){return this.coord},mi.prototype.print=function(f){f.print(this.coord),f.print(" seg # = "+this.segmentIndex),f.println(" dist = "+this.dist)},mi.prototype.compareTo=function(f){return this.compare(f.segmentIndex,f.dist)},mi.prototype.isEndPoint=function(f){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===f},mi.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},mi.prototype.getDistance=function(){return this.dist},mi.prototype.compare=function(f,d){return this.segmentIndex<f?-1:this.segmentIndex>f?1:this.dist<d?-1:this.dist>d?1:0},mi.prototype.interfaces_=function(){return[ut]},mi.prototype.getClass=function(){return mi};var cs=function(){this._nodeMap=new Ce,this.edge=null,this.edge=arguments[0]};cs.prototype.print=function(f){f.println("Intersections:");for(var d=this.iterator();d.hasNext();)d.next().print(f)},cs.prototype.iterator=function(){return this._nodeMap.values().iterator()},cs.prototype.addSplitEdges=function(f){this.addEndpoints();for(var d=this.iterator(),v=d.next();d.hasNext();){var w=d.next(),T=this.createSplitEdge(v,w);f.add(T),v=w}},cs.prototype.addEndpoints=function(){var f=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[f],f,0)},cs.prototype.createSplitEdge=function(f,d){var v=d.segmentIndex-f.segmentIndex+2,T=d.dist>0||!d.coord.equals2D(this.edge.pts[d.segmentIndex]);T||v--;var k=new Array(v).fill(null),q=0;k[q++]=new J(f.coord);for(var K=f.segmentIndex+1;K<=d.segmentIndex;K++)k[q++]=this.edge.pts[K];return T&&(k[q]=d.coord),new Eh(k,new Se(this.edge._label))},cs.prototype.add=function(f,d,v){var w=new mi(f,d,v),T=this._nodeMap.get(w);return null!==T?T:(this._nodeMap.put(w,w),w)},cs.prototype.isIntersection=function(f){for(var d=this.iterator();d.hasNext();)if(d.next().coord.equals(f))return!0;return!1},cs.prototype.interfaces_=function(){return[]},cs.prototype.getClass=function(){return cs};var su=function(){};su.prototype.getChainStartIndices=function(f){var d=0,v=new lt;v.add(new At(d));do{var w=this.findChainEnd(f,d);v.add(new At(w)),d=w}while(d<f.length-1);return su.toIntArray(v)},su.prototype.findChainEnd=function(f,d){for(var v=zn.quadrant(f[d],f[d+1]),w=d+1;w<f.length&&zn.quadrant(f[w-1],f[w])===v;)w++;return w-1},su.prototype.interfaces_=function(){return[]},su.prototype.getClass=function(){return su},su.toIntArray=function(f){for(var d=new Array(f.size()).fill(null),v=0;v<d.length;v++)d[v]=f.get(v).intValue();return d};var qs=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new hn,this.env2=new hn;var f=arguments[0];this.e=f,this.pts=f.getCoordinates();var d=new su;this.startIndex=d.getChainStartIndices(this.pts)};qs.prototype.getCoordinates=function(){return this.pts},qs.prototype.getMaxX=function(f){var d=this.pts[this.startIndex[f]].x,v=this.pts[this.startIndex[f+1]].x;return d>v?d:v},qs.prototype.getMinX=function(f){var d=this.pts[this.startIndex[f]].x,v=this.pts[this.startIndex[f+1]].x;return d<v?d:v},qs.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var f=arguments[0],d=arguments[1],v=arguments[2];this.computeIntersectsForChain(this.startIndex[f],this.startIndex[f+1],d,d.startIndex[v],d.startIndex[v+1],arguments[3])}else if(6===arguments.length){var T=arguments[0],k=arguments[1],q=arguments[2],K=arguments[3],Mt=arguments[4],ae=arguments[5],Ze=this.pts[T],Qe=this.pts[k],Pn=q.pts[K],Bn=q.pts[Mt];if(k-T==1&&Mt-K==1)return ae.addIntersections(this.e,T,q.e,K),null;if(this.env1.init(Ze,Qe),this.env2.init(Pn,Bn),!this.env1.intersects(this.env2))return null;var tr=Math.trunc((T+k)/2),_r=Math.trunc((K+Mt)/2);T<tr&&(K<_r&&this.computeIntersectsForChain(T,tr,q,K,_r,ae),_r<Mt&&this.computeIntersectsForChain(T,tr,q,_r,Mt,ae)),tr<k&&(K<_r&&this.computeIntersectsForChain(tr,k,q,K,_r,ae),_r<Mt&&this.computeIntersectsForChain(tr,k,q,_r,Mt,ae))}},qs.prototype.getStartIndexes=function(){return this.startIndex},qs.prototype.computeIntersects=function(f,d){for(var v=0;v<this.startIndex.length-1;v++)for(var w=0;w<f.startIndex.length-1;w++)this.computeIntersectsForChain(v,f,w,d)},qs.prototype.interfaces_=function(){return[]},qs.prototype.getClass=function(){return qs};var Qs=function f(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var d=0;d<2;d++)for(var v=0;v<3;v++)this._depth[d][v]=f.NULL_VALUE},Tu={NULL_VALUE:{configurable:!0}};Qs.prototype.getDepth=function(f,d){return this._depth[f][d]},Qs.prototype.setDepth=function(f,d,v){this._depth[f][d]=v},Qs.prototype.isNull=function(){if(0===arguments.length){for(var f=0;f<2;f++)for(var d=0;d<3;d++)if(this._depth[f][d]!==Qs.NULL_VALUE)return!1;return!0}return 1===arguments.length?this._depth[arguments[0]][1]===Qs.NULL_VALUE:2===arguments.length?this._depth[arguments[0]][arguments[1]]===Qs.NULL_VALUE:void 0},Qs.prototype.normalize=function(){for(var f=0;f<2;f++)if(!this.isNull(f)){var d=this._depth[f][1];this._depth[f][2]<d&&(d=this._depth[f][2]),d<0&&(d=0);for(var v=1;v<3;v++){var w=0;this._depth[f][v]>d&&(w=1),this._depth[f][v]=w}}},Qs.prototype.getDelta=function(f){return this._depth[f][jt.RIGHT]-this._depth[f][jt.LEFT]},Qs.prototype.getLocation=function(f,d){return this._depth[f][d]<=0?Et.EXTERIOR:Et.INTERIOR},Qs.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},Qs.prototype.add=function(){if(1===arguments.length)for(var f=arguments[0],d=0;d<2;d++)for(var v=1;v<3;v++){var w=f.getLocation(d,v);w!==Et.EXTERIOR&&w!==Et.INTERIOR||(this.isNull(d,v)?this._depth[d][v]=Qs.depthAtLocation(w):this._depth[d][v]+=Qs.depthAtLocation(w))}else 3===arguments.length&&arguments[2]===Et.INTERIOR&&this._depth[arguments[0]][arguments[1]]++},Qs.prototype.interfaces_=function(){return[]},Qs.prototype.getClass=function(){return Qs},Qs.depthAtLocation=function(f){return f===Et.EXTERIOR?0:f===Et.INTERIOR?1:Qs.NULL_VALUE},Tu.NULL_VALUE.get=function(){return-1},Object.defineProperties(Qs,Tu);var Eh=function(f){function d(){if(f.call(this),this.pts=null,this._env=null,this.eiList=new cs(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Qs,this._depthDelta=0,1===arguments.length)d.call(this,arguments[0],null);else if(2===arguments.length){var T=arguments[1];this.pts=arguments[0],this._label=T}}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDepth=function(){return this._depth},d.prototype.getCollapsedEdge=function(){var v=new Array(2).fill(null);return v[0]=this.pts[0],v[1]=this.pts[1],new d(v,Se.toLineLabel(this._label))},d.prototype.isIsolated=function(){return this._isIsolated},d.prototype.getCoordinates=function(){return this.pts},d.prototype.setIsolated=function(v){this._isIsolated=v},d.prototype.setName=function(v){this._name=v},d.prototype.equals=function(v){if(!(v instanceof d))return!1;var w=v;if(this.pts.length!==w.pts.length)return!1;for(var T=!0,k=!0,q=this.pts.length,K=0;K<this.pts.length;K++)if(this.pts[K].equals2D(w.pts[K])||(T=!1),this.pts[K].equals2D(w.pts[--q])||(k=!1),!T&&!k)return!1;return!0},d.prototype.getCoordinate=function(){return 0===arguments.length?this.pts.length>0?this.pts[0]:null:1===arguments.length?this.pts[arguments[0]]:void 0},d.prototype.print=function(v){v.print("edge "+this._name+": "),v.print("LINESTRING (");for(var w=0;w<this.pts.length;w++)w>0&&v.print(","),v.print(this.pts[w].x+" "+this.pts[w].y);v.print(")  "+this._label+" "+this._depthDelta)},d.prototype.computeIM=function(v){d.updateIM(this._label,v)},d.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},d.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},d.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},d.prototype.getDepthDelta=function(){return this._depthDelta},d.prototype.getNumPoints=function(){return this.pts.length},d.prototype.printReverse=function(v){v.print("edge "+this._name+": ");for(var w=this.pts.length-1;w>=0;w--)v.print(this.pts[w]+" ");v.println("")},d.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new qs(this)),this._mce},d.prototype.getEnvelope=function(){if(null===this._env){this._env=new hn;for(var v=0;v<this.pts.length;v++)this._env.expandToInclude(this.pts[v])}return this._env},d.prototype.addIntersection=function(v,w,T,k){var q=new J(v.getIntersection(k)),K=w,Mt=v.getEdgeDistance(T,k),ae=K+1;ae<this.pts.length&&q.equals2D(this.pts[ae])&&(K=ae,Mt=0),this.eiList.add(q,K,Mt)},d.prototype.toString=function(){var v=new Vt;v.append("edge "+this._name+": "),v.append("LINESTRING (");for(var w=0;w<this.pts.length;w++)w>0&&v.append(","),v.append(this.pts[w].x+" "+this.pts[w].y);return v.append(")  "+this._label+" "+this._depthDelta),v.toString()},d.prototype.isPointwiseEqual=function(v){if(this.pts.length!==v.pts.length)return!1;for(var w=0;w<this.pts.length;w++)if(!this.pts[w].equals2D(v.pts[w]))return!1;return!0},d.prototype.setDepthDelta=function(v){this._depthDelta=v},d.prototype.getEdgeIntersectionList=function(){return this.eiList},d.prototype.addIntersections=function(v,w,T){for(var k=0;k<v.getIntersectionNum();k++)this.addIntersection(v,w,T,k)},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d.updateIM=function(){if(2!==arguments.length)return f.prototype.updateIM.apply(this,arguments);var v=arguments[0],w=arguments[1];w.setAtLeastIfValid(v.getLocation(0,jt.ON),v.getLocation(1,jt.ON),1),v.isArea()&&(w.setAtLeastIfValid(v.getLocation(0,jt.LEFT),v.getLocation(1,jt.LEFT),2),w.setAtLeastIfValid(v.getLocation(0,jt.RIGHT),v.getLocation(1,jt.RIGHT),2))},d}(Ne),Qo=function(f){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new xl,this._bufParams=f||null};Qo.prototype.setWorkingPrecisionModel=function(f){this._workingPrecisionModel=f},Qo.prototype.insertUniqueEdge=function(f){var d=this._edgeList.findEqualEdge(f);if(null!==d){var v=d.getLabel(),w=f.getLabel();d.isPointwiseEqual(f)||(w=new Se(f.getLabel())).flip(),v.merge(w);var T=Qo.depthDelta(w),k=d.getDepthDelta()+T;d.setDepthDelta(k)}else this._edgeList.add(f),f.setDepthDelta(Qo.depthDelta(f.getLabel()))},Qo.prototype.buildSubgraphs=function(f,d){for(var v=new lt,w=f.iterator();w.hasNext();){var T=w.next(),k=T.getRightmostCoordinate(),q=new tl(v).getDepth(k);T.computeDepth(q),T.findResultEdges(),v.add(T),d.add(T.getDirectedEdges(),T.getNodes())}},Qo.prototype.createSubgraphs=function(f){for(var d=new lt,v=f.getNodes().iterator();v.hasNext();){var w=v.next();if(!w.isVisited()){var T=new bn;T.create(w),d.add(T)}}return ur.sort(d,ur.reverseOrder()),d},Qo.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},Qo.prototype.getNoder=function(f){if(null!==this._workingNoder)return this._workingNoder;var d=new Zr,v=new Rn;return v.setPrecisionModel(f),d.setSegmentIntersector(new ya(v)),d},Qo.prototype.buffer=function(f,d){var v=this._workingPrecisionModel;null===v&&(v=f.getPrecisionModel()),this._geomFact=f.getFactory();var w=new oa(v,this._bufParams),T=new Js(f,d,w).getCurves();if(T.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(T,v),this._graph=new us(new bc),this._graph.addEdges(this._edgeList.getEdges());var k=this.createSubgraphs(this._graph),q=new Jo(this._geomFact);this.buildSubgraphs(k,q);var K=q.getPolygons();return K.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(K)},Qo.prototype.computeNodedEdges=function(f,d){var v=this.getNoder(d);v.computeNodes(f);for(var w=v.getNodedSubstrings().iterator();w.hasNext();){var T=w.next(),k=T.getCoordinates();if(2!==k.length||!k[0].equals2D(k[1])){var q=T.getData(),K=new Eh(T.getCoordinates(),new Se(q));this.insertUniqueEdge(K)}}},Qo.prototype.setNoder=function(f){this._workingNoder=f},Qo.prototype.interfaces_=function(){return[]},Qo.prototype.getClass=function(){return Qo},Qo.depthDelta=function(f){var d=f.getLocation(0,jt.LEFT),v=f.getLocation(0,jt.RIGHT);return d===Et.INTERIOR&&v===Et.EXTERIOR?1:d===Et.EXTERIOR&&v===Et.INTERIOR?-1:0},Qo.convertSegStrings=function(f){for(var d=new Hn,v=new lt;f.hasNext();){var w=f.next(),T=d.createLineString(w.getCoordinates());v.add(T)}return d.buildGeometry(v)};var Ta=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var d=arguments[1];this._noder=arguments[0],this._scaleFactor=d,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var w=arguments[1],T=arguments[2],k=arguments[3];this._noder=arguments[0],this._scaleFactor=w,this._offsetX=T,this._offsetY=k,this._isScaled=!this.isIntegerPrecision()}};Ta.prototype.rescale=function(){if(en(arguments[0],Ye))for(var f=arguments[0].iterator();f.hasNext();){var d=f.next();this.rescale(d.getCoordinates())}else if(arguments[0]instanceof Array){for(var v=arguments[0],w=0;w<v.length;w++)v[w].x=v[w].x/this._scaleFactor+this._offsetX,v[w].y=v[w].y/this._scaleFactor+this._offsetY;2===v.length&&v[0].equals2D(v[1])&&Yn.out.println(v)}},Ta.prototype.scale=function(){if(en(arguments[0],Ye)){for(var f=arguments[0],d=new lt,v=f.iterator();v.hasNext();){var w=v.next();d.add(new Ei(this.scale(w.getCoordinates()),w.getData()))}return d}if(arguments[0]instanceof Array){for(var T=arguments[0],k=new Array(T.length).fill(null),q=0;q<T.length;q++)k[q]=new J(Math.round((T[q].x-this._offsetX)*this._scaleFactor),Math.round((T[q].y-this._offsetY)*this._scaleFactor),T[q].z);return ye.removeRepeatedPoints(k)}},Ta.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},Ta.prototype.getNodedSubstrings=function(){var f=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(f),f},Ta.prototype.computeNodes=function(f){var d=f;this._isScaled&&(d=this.scale(f)),this._noder.computeNodes(d)},Ta.prototype.interfaces_=function(){return[Gl]},Ta.prototype.getClass=function(){return Ta};var gs=function(){this._li=new Rn,this._segStrings=null,this._segStrings=arguments[0]},bl={fact:{configurable:!0}};gs.prototype.checkEndPtVertexIntersections=function(){if(0===arguments.length)for(var f=this._segStrings.iterator();f.hasNext();){var d=f.next().getCoordinates();this.checkEndPtVertexIntersections(d[0],this._segStrings),this.checkEndPtVertexIntersections(d[d.length-1],this._segStrings)}else if(2===arguments.length)for(var v=arguments[0],w=arguments[1].iterator();w.hasNext();)for(var T=w.next().getCoordinates(),k=1;k<T.length-1;k++)if(T[k].equals(v))throw new Ve("found endpt/interior pt intersection at index "+k+" :pt "+v)},gs.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var f=this._segStrings.iterator();f.hasNext();)for(var d=f.next(),v=this._segStrings.iterator();v.hasNext();){var w=v.next();this.checkInteriorIntersections(d,w)}else if(2===arguments.length)for(var T=arguments[0],k=arguments[1],q=T.getCoordinates(),K=k.getCoordinates(),Mt=0;Mt<q.length-1;Mt++)for(var ae=0;ae<K.length-1;ae++)this.checkInteriorIntersections(T,Mt,k,ae);else if(4===arguments.length){var Ze=arguments[0],Qe=arguments[1],Pn=arguments[2],Bn=arguments[3];if(Ze===Pn&&Qe===Bn)return null;var tr=Ze.getCoordinates()[Qe],_r=Ze.getCoordinates()[Qe+1],Ki=Pn.getCoordinates()[Bn],Ps=Pn.getCoordinates()[Bn+1];if(this._li.computeIntersection(tr,_r,Ki,Ps),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,tr,_r)||this.hasInteriorIntersection(this._li,Ki,Ps)))throw new Ve("found non-noded intersection at "+tr+"-"+_r+" and "+Ki+"-"+Ps)}},gs.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},gs.prototype.checkCollapses=function(){if(0===arguments.length)for(var f=this._segStrings.iterator();f.hasNext();){var d=f.next();this.checkCollapses(d)}else if(1===arguments.length)for(var v=arguments[0].getCoordinates(),w=0;w<v.length-2;w++)this.checkCollapse(v[w],v[w+1],v[w+2])},gs.prototype.hasInteriorIntersection=function(f,d,v){for(var w=0;w<f.getIntersectionNum();w++){var T=f.getIntersection(w);if(!T.equals(d)&&!T.equals(v))return!0}return!1},gs.prototype.checkCollapse=function(f,d,v){if(f.equals(v))throw new Ve("found non-noded collapse at "+gs.fact.createLineString([f,d,v]))},gs.prototype.interfaces_=function(){return[]},gs.prototype.getClass=function(){return gs},bl.fact.get=function(){return new Hn},Object.defineProperties(gs,bl);var Vr=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var f=arguments[0],d=arguments[1],v=arguments[2];if(this._originalPt=f,this._pt=f,this._scaleFactor=d,this._li=v,d<=0)throw new gt("Scale factor must be non-zero");1!==d&&(this._pt=new J(this.scale(f.x),this.scale(f.y)),this._p0Scaled=new J,this._p1Scaled=new J),this.initCorners(this._pt)},au={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};Vr.prototype.intersectsScaled=function(f,d){var v=Math.min(f.x,d.x),w=Math.max(f.x,d.x),T=Math.min(f.y,d.y),k=Math.max(f.y,d.y),q=this._maxx<v||this._minx>w||this._maxy<T||this._miny>k;if(q)return!1;var K=this.intersectsToleranceSquare(f,d);return We.isTrue(!(q&&K),"Found bad envelope test"),K},Vr.prototype.initCorners=function(f){this._minx=f.x-.5,this._maxx=f.x+.5,this._miny=f.y-.5,this._maxy=f.y+.5,this._corner[0]=new J(this._maxx,this._maxy),this._corner[1]=new J(this._minx,this._maxy),this._corner[2]=new J(this._minx,this._miny),this._corner[3]=new J(this._maxx,this._miny)},Vr.prototype.intersects=function(f,d){return 1===this._scaleFactor?this.intersectsScaled(f,d):(this.copyScaled(f,this._p0Scaled),this.copyScaled(d,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},Vr.prototype.scale=function(f){return Math.round(f*this._scaleFactor)},Vr.prototype.getCoordinate=function(){return this._originalPt},Vr.prototype.copyScaled=function(f,d){d.x=this.scale(f.x),d.y=this.scale(f.y)},Vr.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var f=Vr.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new hn(this._originalPt.x-f,this._originalPt.x+f,this._originalPt.y-f,this._originalPt.y+f)}return this._safeEnv},Vr.prototype.intersectsPixelClosure=function(f,d){return this._li.computeIntersection(f,d,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(f,d,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(f,d,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(f,d,this._corner[3],this._corner[0]),this._li.hasIntersection()))))},Vr.prototype.intersectsToleranceSquare=function(f,d){var v=!1,w=!1;return this._li.computeIntersection(f,d,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(f,d,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(v=!0),this._li.computeIntersection(f,d,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(w=!0),this._li.computeIntersection(f,d,this._corner[3],this._corner[0]),this._li.isProper()||v&&w||f.equals(this._pt)||d.equals(this._pt)))))},Vr.prototype.addSnappedNode=function(f,d){var v=f.getCoordinate(d),w=f.getCoordinate(d+1);return!!this.intersects(v,w)&&(f.addIntersection(this.getCoordinate(),d),!0)},Vr.prototype.interfaces_=function(){return[]},Vr.prototype.getClass=function(){return Vr},au.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(Vr,au);var wl=function(){this.tempEnv1=new hn,this.selectedSegment=new pn};wl.prototype.select=function(){1!==arguments.length&&2===arguments.length&&(arguments[0].getLineSegment(arguments[1],this.selectedSegment),this.select(this.selectedSegment))},wl.prototype.interfaces_=function(){return[]},wl.prototype.getClass=function(){return wl};var lu=function(){this._index=null,this._index=arguments[0]},Ih={HotPixelSnapAction:{configurable:!0}};lu.prototype.snap=function(){if(1===arguments.length)return this.snap(arguments[0],null,-1);if(3===arguments.length){var d=arguments[0],v=arguments[1],w=arguments[2],T=d.getSafeEnvelope(),k=new Ee(d,v,w);return this._index.query(T,{interfaces_:function(){return[Vs]},visitItem:function(q){q.select(T,k)}}),k.isNodeAdded()}},lu.prototype.interfaces_=function(){return[]},lu.prototype.getClass=function(){return lu},Ih.HotPixelSnapAction.get=function(){return Ee},Object.defineProperties(lu,Ih);var Ee=function(f){function d(){f.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var w=arguments[1],T=arguments[2];this._hotPixel=arguments[0],this._parentEdge=w,this._hotPixelVertexIndex=T}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.isNodeAdded=function(){return this._isNodeAdded},d.prototype.select=function(){if(2!==arguments.length)return f.prototype.select.apply(this,arguments);var w=arguments[1],T=arguments[0].getContext();if(null!==this._parentEdge&&T===this._parentEdge&&w===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(T,w)},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d}(wl),Xe=function(){this._li=null,this._interiorIntersections=null,this._li=arguments[0],this._interiorIntersections=new lt};Xe.prototype.processIntersections=function(f,d,v,w){if(f===v&&d===w)return null;var T=f.getCoordinates()[d],k=f.getCoordinates()[d+1],q=v.getCoordinates()[w],K=v.getCoordinates()[w+1];if(this._li.computeIntersection(T,k,q,K),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var Mt=0;Mt<this._li.getIntersectionNum();Mt++)this._interiorIntersections.add(this._li.getIntersection(Mt));f.addIntersections(this._li,d,0),v.addIntersections(this._li,w,1)}},Xe.prototype.isDone=function(){return!1},Xe.prototype.getInteriorIntersections=function(){return this._interiorIntersections},Xe.prototype.interfaces_=function(){return[Kr]},Xe.prototype.getClass=function(){return Xe};var $t=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var f=arguments[0];this._pm=f,this._li=new Rn,this._li.setPrecisionModel(f),this._scaleFactor=f.getScale()};$t.prototype.checkCorrectness=function(f){var d=Ei.getNodedSubstrings(f),v=new gs(d);try{v.checkValid()}catch(w){if(!(w instanceof On))throw w;w.printStackTrace()}},$t.prototype.getNodedSubstrings=function(){return Ei.getNodedSubstrings(this._nodedSegStrings)},$t.prototype.snapRound=function(f,d){var v=this.findInteriorIntersections(f,d);this.computeIntersectionSnaps(v),this.computeVertexSnaps(f)},$t.prototype.findInteriorIntersections=function(f,d){var v=new Xe(d);return this._noder.setSegmentIntersector(v),this._noder.computeNodes(f),v.getInteriorIntersections()},$t.prototype.computeVertexSnaps=function(){if(en(arguments[0],Ye))for(var f=arguments[0].iterator();f.hasNext();){var d=f.next();this.computeVertexSnaps(d)}else if(arguments[0]instanceof Ei)for(var v=arguments[0],w=v.getCoordinates(),T=0;T<w.length;T++){var k=new Vr(w[T],this._scaleFactor,this._li);this._pointSnapper.snap(k,v,T)&&v.addIntersection(w[T],T)}},$t.prototype.computeNodes=function(f){this._nodedSegStrings=f,this._noder=new Zr,this._pointSnapper=new lu(this._noder.getIndex()),this.snapRound(f,this._li)},$t.prototype.computeIntersectionSnaps=function(f){for(var d=f.iterator();d.hasNext();){var v=d.next(),w=new Vr(v,this._scaleFactor,this._li);this._pointSnapper.snap(w)}},$t.prototype.interfaces_=function(){return[Gl]},$t.prototype.getClass=function(){return $t};var Zn=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new _i,this._resultGeometry=null,this._saveException=null,1===arguments.length)this._argGeom=arguments[0];else if(2===arguments.length){var v=arguments[1];this._argGeom=arguments[0],this._bufParams=v}},Xi={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};Zn.prototype.bufferFixedPrecision=function(f){var d=new Ta(new $t(new bi(1)),f.getScale()),v=new Qo(this._bufParams);v.setWorkingPrecisionModel(f),v.setNoder(d),this._resultGeometry=v.buffer(this._argGeom,this._distance)},Zn.prototype.bufferReducedPrecision=function(){var f=this;if(0===arguments.length){for(var d=Zn.MAX_PRECISION_DIGITS;d>=0;d--){try{f.bufferReducedPrecision(d)}catch(k){if(!(k instanceof Dn))throw k;f._saveException=k}if(null!==f._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var w=Zn.precisionScaleFactor(this._argGeom,this._distance,arguments[0]),T=new bi(w);this.bufferFixedPrecision(T)}},Zn.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var f=this._argGeom.getFactory().getPrecisionModel();f.getType()===bi.FIXED?this.bufferFixedPrecision(f):this.bufferReducedPrecision()},Zn.prototype.setQuadrantSegments=function(f){this._bufParams.setQuadrantSegments(f)},Zn.prototype.bufferOriginalPrecision=function(){try{var f=new Qo(this._bufParams);this._resultGeometry=f.buffer(this._argGeom,this._distance)}catch(d){if(!(d instanceof Ve))throw d;this._saveException=d}},Zn.prototype.getResultGeometry=function(f){return this._distance=f,this.computeGeometry(),this._resultGeometry},Zn.prototype.setEndCapStyle=function(f){this._bufParams.setEndCapStyle(f)},Zn.prototype.interfaces_=function(){return[]},Zn.prototype.getClass=function(){return Zn},Zn.bufferOp=function(){if(2===arguments.length){var d=arguments[1];return new Zn(arguments[0]).getResultGeometry(d)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Nn&&"number"==typeof arguments[1]){var w=arguments[1],T=arguments[2],k=new Zn(arguments[0]);return k.setQuadrantSegments(T),k.getResultGeometry(w)}if(arguments[2]instanceof _i&&arguments[0]instanceof Nn&&"number"==typeof arguments[1]){var K=arguments[1];return new Zn(arguments[0],arguments[2]).getResultGeometry(K)}}else if(4===arguments.length){var Ze=arguments[1],Qe=arguments[2],Pn=arguments[3],Bn=new Zn(arguments[0]);return Bn.setQuadrantSegments(Qe),Bn.setEndCapStyle(Pn),Bn.getResultGeometry(Ze)}},Zn.precisionScaleFactor=function(f,d,v){var w=f.getEnvelopeInternal(),T=Ft.max(Math.abs(w.getMaxX()),Math.abs(w.getMaxY()),Math.abs(w.getMinX()),Math.abs(w.getMinY()))+2*(d>0?d:0),k=v-Math.trunc(Math.log(T)/Math.log(10)+1);return Math.pow(10,k)},Xi.CAP_ROUND.get=function(){return _i.CAP_ROUND},Xi.CAP_BUTT.get=function(){return _i.CAP_FLAT},Xi.CAP_FLAT.get=function(){return _i.CAP_FLAT},Xi.CAP_SQUARE.get=function(){return _i.CAP_SQUARE},Xi.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(Zn,Xi);var Mr=function(){this._pt=[new J,new J],this._distance=ct.NaN,this._isNull=!0};Mr.prototype.getCoordinates=function(){return this._pt},Mr.prototype.getCoordinate=function(f){return this._pt[f]},Mr.prototype.setMinimum=function(){if(1===arguments.length){var f=arguments[0];this.setMinimum(f._pt[0],f._pt[1])}else if(2===arguments.length){var d=arguments[0],v=arguments[1];if(this._isNull)return this.initialize(d,v),null;var w=d.distance(v);w<this._distance&&this.initialize(d,v,w)}},Mr.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var f=arguments[0],d=arguments[1];this._pt[0].setCoordinate(f),this._pt[1].setCoordinate(d),this._distance=f.distance(d),this._isNull=!1}else if(3===arguments.length){var w=arguments[1],T=arguments[2];this._pt[0].setCoordinate(arguments[0]),this._pt[1].setCoordinate(w),this._distance=T,this._isNull=!1}},Mr.prototype.getDistance=function(){return this._distance},Mr.prototype.setMaximum=function(){if(1===arguments.length){var f=arguments[0];this.setMaximum(f._pt[0],f._pt[1])}else if(2===arguments.length){var d=arguments[0],v=arguments[1];if(this._isNull)return this.initialize(d,v),null;var w=d.distance(v);w>this._distance&&this.initialize(d,v,w)}},Mr.prototype.interfaces_=function(){return[]},Mr.prototype.getClass=function(){return Mr};var Yi=function(){};Yi.prototype.interfaces_=function(){return[]},Yi.prototype.getClass=function(){return Yi},Yi.computeDistance=function(){if(arguments[2]instanceof Mr&&arguments[0]instanceof ps&&arguments[1]instanceof J)for(var d=arguments[1],v=arguments[2],w=arguments[0].getCoordinates(),T=new pn,k=0;k<w.length-1;k++){T.setCoordinates(w[k],w[k+1]);var q=T.closestPoint(d);v.setMinimum(q,d)}else if(arguments[2]instanceof Mr&&arguments[0]instanceof wi&&arguments[1]instanceof J){var K=arguments[0],Mt=arguments[1],ae=arguments[2];Yi.computeDistance(K.getExteriorRing(),Mt,ae);for(var Ze=0;Ze<K.getNumInteriorRing();Ze++)Yi.computeDistance(K.getInteriorRingN(Ze),Mt,ae)}else if(arguments[2]instanceof Mr&&arguments[0]instanceof Nn&&arguments[1]instanceof J){var Qe=arguments[0],Pn=arguments[1],Bn=arguments[2];if(Qe instanceof ps)Yi.computeDistance(Qe,Pn,Bn);else if(Qe instanceof wi)Yi.computeDistance(Qe,Pn,Bn);else if(Qe instanceof Rr)for(var tr=Qe,_r=0;_r<tr.getNumGeometries();_r++){var Ki=tr.getGeometryN(_r);Yi.computeDistance(Ki,Pn,Bn)}else Bn.setMinimum(Qe.getCoordinate(),Pn)}else if(arguments[2]instanceof Mr&&arguments[0]instanceof pn&&arguments[1]instanceof J){var Aa=arguments[1],Nu=arguments[2],Ec=arguments[0].closestPoint(Aa);Nu.setMinimum(Ec,Aa)}};var Ji=function(f){this._maxPtDist=new Mr,this._inputGeom=f||null},Fs={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Ji.prototype.computeMaxMidpointDistance=function(f){var d=new to(this._inputGeom);f.apply(d),this._maxPtDist.setMaximum(d.getMaxPointDistance())},Ji.prototype.computeMaxVertexDistance=function(f){var d=new ts(this._inputGeom);f.apply(d),this._maxPtDist.setMaximum(d.getMaxPointDistance())},Ji.prototype.findDistance=function(f){return this.computeMaxVertexDistance(f),this.computeMaxMidpointDistance(f),this._maxPtDist.getDistance()},Ji.prototype.getDistancePoints=function(){return this._maxPtDist},Ji.prototype.interfaces_=function(){return[]},Ji.prototype.getClass=function(){return Ji},Fs.MaxPointDistanceFilter.get=function(){return ts},Fs.MaxMidpointDistanceFilter.get=function(){return to},Object.defineProperties(Ji,Fs);var ts=function(f){this._maxPtDist=new Mr,this._minPtDist=new Mr,this._geom=f||null};ts.prototype.filter=function(f){this._minPtDist.initialize(),Yi.computeDistance(this._geom,f,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},ts.prototype.getMaxPointDistance=function(){return this._maxPtDist},ts.prototype.interfaces_=function(){return[W]},ts.prototype.getClass=function(){return ts};var to=function(f){this._maxPtDist=new Mr,this._minPtDist=new Mr,this._geom=f||null};to.prototype.filter=function(f,d){if(0===d)return null;var v=f.getCoordinate(d-1),w=f.getCoordinate(d),T=new J((v.x+w.x)/2,(v.y+w.y)/2);this._minPtDist.initialize(),Yi.computeDistance(this._geom,T,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},to.prototype.isDone=function(){return!1},to.prototype.isGeometryChanged=function(){return!1},to.prototype.getMaxPointDistance=function(){return this._maxPtDist},to.prototype.interfaces_=function(){return[ui]},to.prototype.getClass=function(){return to};var As=function(f){this._comps=f||null};As.prototype.filter=function(f){f instanceof wi&&this._comps.add(f)},As.prototype.interfaces_=function(){return[Vi]},As.prototype.getClass=function(){return As},As.getPolygons=function(){if(1===arguments.length)return As.getPolygons(arguments[0],new lt);if(2===arguments.length){var d=arguments[0],v=arguments[1];return d instanceof wi?v.add(d):d instanceof Rr&&d.apply(new As(v)),v}};var eo=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length)this._lines=arguments[0];else if(2===arguments.length){var v=arguments[1];this._lines=arguments[0],this._isForcedToLineString=v}};eo.prototype.filter=function(f){if(this._isForcedToLineString&&f instanceof pl){var d=f.getFactory().createLineString(f.getCoordinateSequence());return this._lines.add(d),null}f instanceof ps&&this._lines.add(f)},eo.prototype.setForceToLineString=function(f){this._isForcedToLineString=f},eo.prototype.interfaces_=function(){return[Zi]},eo.prototype.getClass=function(){return eo},eo.getGeometry=function(){if(1===arguments.length){var f=arguments[0];return f.getFactory().buildGeometry(eo.getLines(f))}if(2===arguments.length){var d=arguments[0],v=arguments[1];return d.getFactory().buildGeometry(eo.getLines(d,v))}},eo.getLines=function(){if(1===arguments.length)return eo.getLines(arguments[0],!1);if(2===arguments.length){if(en(arguments[0],Ye)&&en(arguments[1],Ye)){for(var v=arguments[1],w=arguments[0].iterator();w.hasNext();){var T=w.next();eo.getLines(T,v)}return v}if(arguments[0]instanceof Nn&&"boolean"==typeof arguments[1]){var k=arguments[0],q=arguments[1],K=new lt;return k.apply(new eo(K,q)),K}if(arguments[0]instanceof Nn&&en(arguments[1],Ye)){var Mt=arguments[0],ae=arguments[1];return Mt instanceof ps?ae.add(Mt):Mt.apply(new eo(ae)),ae}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&en(arguments[0],Ye)&&en(arguments[1],Ye)){for(var Qe=arguments[1],Pn=arguments[2],Bn=arguments[0].iterator();Bn.hasNext();){var tr=Bn.next();eo.getLines(tr,Qe,Pn)}return Qe}if("boolean"==typeof arguments[2]&&arguments[0]instanceof Nn&&en(arguments[1],Ye)){var Ki=arguments[1];return arguments[0].apply(new eo(Ki,arguments[2])),Ki}}};var Go=function(){if(this._boundaryRule=nt.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0!==arguments.length&&1===arguments.length){var f=arguments[0];if(null===f)throw new gt("Rule must be non-null");this._boundaryRule=f}};Go.prototype.locateInternal=function(){if(arguments[0]instanceof J&&arguments[1]instanceof wi){var f=arguments[0],d=arguments[1];if(d.isEmpty())return Et.EXTERIOR;var v=d.getExteriorRing(),w=this.locateInPolygonRing(f,v);if(w===Et.EXTERIOR)return Et.EXTERIOR;if(w===Et.BOUNDARY)return Et.BOUNDARY;for(var T=0;T<d.getNumInteriorRing();T++){var k=d.getInteriorRingN(T),q=this.locateInPolygonRing(f,k);if(q===Et.INTERIOR)return Et.EXTERIOR;if(q===Et.BOUNDARY)return Et.BOUNDARY}return Et.INTERIOR}if(arguments[0]instanceof J&&arguments[1]instanceof ps){var K=arguments[0],Mt=arguments[1];if(!Mt.getEnvelopeInternal().intersects(K))return Et.EXTERIOR;var ae=Mt.getCoordinates();return Mt.isClosed()||!K.equals(ae[0])&&!K.equals(ae[ae.length-1])?mn.isOnLine(K,ae)?Et.INTERIOR:Et.EXTERIOR:Et.BOUNDARY}if(arguments[0]instanceof J&&arguments[1]instanceof ga){var Ze=arguments[0];return arguments[1].getCoordinate().equals2D(Ze)?Et.INTERIOR:Et.EXTERIOR}},Go.prototype.locateInPolygonRing=function(f,d){return d.getEnvelopeInternal().intersects(f)?mn.locatePointInRing(f,d.getCoordinates()):Et.EXTERIOR},Go.prototype.intersects=function(f,d){return this.locate(f,d)!==Et.EXTERIOR},Go.prototype.updateLocationInfo=function(f){f===Et.INTERIOR&&(this._isIn=!0),f===Et.BOUNDARY&&this._numBoundaries++},Go.prototype.computeLocation=function(f,d){if(d instanceof ga&&this.updateLocationInfo(this.locateInternal(f,d)),d instanceof ps)this.updateLocationInfo(this.locateInternal(f,d));else if(d instanceof wi)this.updateLocationInfo(this.locateInternal(f,d));else if(d instanceof ls)for(var v=d,w=0;w<v.getNumGeometries();w++){var T=v.getGeometryN(w);this.updateLocationInfo(this.locateInternal(f,T))}else if(d instanceof Os)for(var k=d,q=0;q<k.getNumGeometries();q++){var K=k.getGeometryN(q);this.updateLocationInfo(this.locateInternal(f,K))}else if(d instanceof Rr)for(var Mt=new el(d);Mt.hasNext();){var ae=Mt.next();ae!==d&&this.computeLocation(f,ae)}},Go.prototype.locate=function(f,d){return d.isEmpty()?Et.EXTERIOR:d instanceof ps||d instanceof wi?this.locateInternal(f,d):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(f,d),this._boundaryRule.isInBoundary(this._numBoundaries)?Et.BOUNDARY:this._numBoundaries>0||this._isIn?Et.INTERIOR:Et.EXTERIOR)},Go.prototype.interfaces_=function(){return[]},Go.prototype.getClass=function(){return Go};var Bi=function f(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length)f.call(this,arguments[0],f.INSIDE_AREA,arguments[1]);else if(3===arguments.length){var T=arguments[1],k=arguments[2];this._component=arguments[0],this._segIndex=T,this._pt=k}},tc={INSIDE_AREA:{configurable:!0}};Bi.prototype.isInsideArea=function(){return this._segIndex===Bi.INSIDE_AREA},Bi.prototype.getCoordinate=function(){return this._pt},Bi.prototype.getGeometryComponent=function(){return this._component},Bi.prototype.getSegmentIndex=function(){return this._segIndex},Bi.prototype.interfaces_=function(){return[]},Bi.prototype.getClass=function(){return Bi},tc.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Bi,tc);var nl=function(f){this._pts=f||null};nl.prototype.filter=function(f){f instanceof ga&&this._pts.add(f)},nl.prototype.interfaces_=function(){return[Vi]},nl.prototype.getClass=function(){return nl},nl.getPoints=function(){if(1===arguments.length){var f=arguments[0];return f instanceof ga?ur.singletonList(f):nl.getPoints(f,new lt)}if(2===arguments.length){var d=arguments[0],v=arguments[1];return d instanceof ga?v.add(d):d instanceof Rr&&d.apply(new nl(v)),v}};var rl=function(){this._locations=null,this._locations=arguments[0]};rl.prototype.filter=function(f){(f instanceof ga||f instanceof ps||f instanceof wi)&&this._locations.add(new Bi(f,0,f.getCoordinate()))},rl.prototype.interfaces_=function(){return[Vi]},rl.prototype.getClass=function(){return rl},rl.getLocations=function(f){var d=new lt;return f.apply(new rl(d)),d};var Ts=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Go,this._minDistanceLocation=null,this._minDistance=ct.MAX_VALUE,2===arguments.length)this._geom=[arguments[0],arguments[1]],this._terminateDistance=0;else if(3===arguments.length){var v=arguments[0],w=arguments[1],T=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=v,this._geom[1]=w,this._terminateDistance=T}};Ts.prototype.computeContainmentDistance=function(){if(0===arguments.length){var f=new Array(2).fill(null);if(this.computeContainmentDistance(0,f),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,f)}else if(2===arguments.length){var d=arguments[0],v=arguments[1],w=1-d,T=As.getPolygons(this._geom[d]);if(T.size()>0){var k=rl.getLocations(this._geom[w]);if(this.computeContainmentDistance(k,T,v),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[w]=v[0],this._minDistanceLocation[d]=v[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&en(arguments[0],Kt)&&en(arguments[1],Kt)){for(var q=arguments[0],K=arguments[1],Mt=arguments[2],ae=0;ae<q.size();ae++)for(var Ze=q.get(ae),Qe=0;Qe<K.size();Qe++)if(this.computeContainmentDistance(Ze,K.get(Qe),Mt),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Bi&&arguments[1]instanceof wi){var Pn=arguments[0],Bn=arguments[1],tr=arguments[2],_r=Pn.getCoordinate();if(Et.EXTERIOR!==this._ptLocator.locate(_r,Bn))return this._minDistance=0,tr[0]=Pn,tr[1]=new Bi(Bn,_r),null}},Ts.prototype.computeMinDistanceLinesPoints=function(f,d,v){for(var w=0;w<f.size();w++)for(var T=f.get(w),k=0;k<d.size();k++){var q=d.get(k);if(this.computeMinDistance(T,q,v),this._minDistance<=this._terminateDistance)return null}},Ts.prototype.computeFacetDistance=function(){var f=new Array(2).fill(null),d=eo.getLines(this._geom[0]),v=eo.getLines(this._geom[1]),w=nl.getPoints(this._geom[0]),T=nl.getPoints(this._geom[1]);return this.computeMinDistanceLines(d,v,f),this.updateMinDistance(f,!1),this._minDistance<=this._terminateDistance?null:(f[0]=null,f[1]=null,this.computeMinDistanceLinesPoints(d,T,f),this.updateMinDistance(f,!1),this._minDistance<=this._terminateDistance?null:(f[0]=null,f[1]=null,this.computeMinDistanceLinesPoints(v,w,f),this.updateMinDistance(f,!0),this._minDistance<=this._terminateDistance?null:(f[0]=null,f[1]=null,this.computeMinDistancePoints(w,T,f),void this.updateMinDistance(f,!1))))},Ts.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},Ts.prototype.updateMinDistance=function(f,d){if(null===f[0])return null;d?(this._minDistanceLocation[0]=f[1],this._minDistanceLocation[1]=f[0]):(this._minDistanceLocation[0]=f[0],this._minDistanceLocation[1]=f[1])},Ts.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},Ts.prototype.computeMinDistance=function(){if(0===arguments.length){if(null!==this._minDistanceLocation||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof ps&&arguments[1]instanceof ga){var f=arguments[0],d=arguments[1],v=arguments[2];if(f.getEnvelopeInternal().distance(d.getEnvelopeInternal())>this._minDistance)return null;for(var w=f.getCoordinates(),T=d.getCoordinate(),k=0;k<w.length-1;k++){var q=mn.distancePointLine(T,w[k],w[k+1]);if(q<this._minDistance){this._minDistance=q;var K=new pn(w[k],w[k+1]).closestPoint(T);v[0]=new Bi(f,k,K),v[1]=new Bi(d,0,T)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof ps&&arguments[1]instanceof ps){var Mt=arguments[0],ae=arguments[1],Ze=arguments[2];if(Mt.getEnvelopeInternal().distance(ae.getEnvelopeInternal())>this._minDistance)return null;for(var Qe=Mt.getCoordinates(),Pn=ae.getCoordinates(),Bn=0;Bn<Qe.length-1;Bn++)for(var tr=0;tr<Pn.length-1;tr++){var _r=mn.distanceLineLine(Qe[Bn],Qe[Bn+1],Pn[tr],Pn[tr+1]);if(_r<this._minDistance){this._minDistance=_r;var Ki=new pn(Qe[Bn],Qe[Bn+1]),Ps=new pn(Pn[tr],Pn[tr+1]),Aa=Ki.closestPoints(Ps);Ze[0]=new Bi(Mt,Bn,Aa[0]),Ze[1]=new Bi(ae,tr,Aa[1])}if(this._minDistance<=this._terminateDistance)return null}}},Ts.prototype.computeMinDistancePoints=function(f,d,v){for(var w=0;w<f.size();w++)for(var T=f.get(w),k=0;k<d.size();k++){var q=d.get(k),K=T.getCoordinate().distance(q.getCoordinate());if(K<this._minDistance&&(this._minDistance=K,v[0]=new Bi(T,0,T.getCoordinate()),v[1]=new Bi(q,0,q.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},Ts.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new gt("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},Ts.prototype.computeMinDistanceLines=function(f,d,v){for(var w=0;w<f.size();w++)for(var T=f.get(w),k=0;k<d.size();k++){var q=d.get(k);if(this.computeMinDistance(T,q,v),this._minDistance<=this._terminateDistance)return null}},Ts.prototype.interfaces_=function(){return[]},Ts.prototype.getClass=function(){return Ts},Ts.distance=function(f,d){return new Ts(f,d).distance()},Ts.isWithinDistance=function(f,d,v){return new Ts(f,d,v).distance()<=v},Ts.nearestPoints=function(f,d){return new Ts(f,d).nearestPoints()};var ta=function(){this._pt=[new J,new J],this._distance=ct.NaN,this._isNull=!0};ta.prototype.getCoordinates=function(){return this._pt},ta.prototype.getCoordinate=function(f){return this._pt[f]},ta.prototype.setMinimum=function(){if(1===arguments.length){var f=arguments[0];this.setMinimum(f._pt[0],f._pt[1])}else if(2===arguments.length){var d=arguments[0],v=arguments[1];if(this._isNull)return this.initialize(d,v),null;var w=d.distance(v);w<this._distance&&this.initialize(d,v,w)}},ta.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var f=arguments[0],d=arguments[1];this._pt[0].setCoordinate(f),this._pt[1].setCoordinate(d),this._distance=f.distance(d),this._isNull=!1}else if(3===arguments.length){var w=arguments[1],T=arguments[2];this._pt[0].setCoordinate(arguments[0]),this._pt[1].setCoordinate(w),this._distance=T,this._isNull=!1}},ta.prototype.toString=function(){return Gt.toLineString(this._pt[0],this._pt[1])},ta.prototype.getDistance=function(){return this._distance},ta.prototype.setMaximum=function(){if(1===arguments.length){var f=arguments[0];this.setMaximum(f._pt[0],f._pt[1])}else if(2===arguments.length){var d=arguments[0],v=arguments[1];if(this._isNull)return this.initialize(d,v),null;var w=d.distance(v);w>this._distance&&this.initialize(d,v,w)}},ta.prototype.interfaces_=function(){return[]},ta.prototype.getClass=function(){return ta};var Pl=function(){};Pl.prototype.interfaces_=function(){return[]},Pl.prototype.getClass=function(){return Pl},Pl.computeDistance=function(){if(arguments[2]instanceof ta&&arguments[0]instanceof ps&&arguments[1]instanceof J)for(var f=arguments[0],d=arguments[1],v=arguments[2],w=new pn,T=f.getCoordinates(),k=0;k<T.length-1;k++){w.setCoordinates(T[k],T[k+1]);var q=w.closestPoint(d);v.setMinimum(q,d)}else if(arguments[2]instanceof ta&&arguments[0]instanceof wi&&arguments[1]instanceof J){var K=arguments[0],Mt=arguments[1],ae=arguments[2];Pl.computeDistance(K.getExteriorRing(),Mt,ae);for(var Ze=0;Ze<K.getNumInteriorRing();Ze++)Pl.computeDistance(K.getInteriorRingN(Ze),Mt,ae)}else if(arguments[2]instanceof ta&&arguments[0]instanceof Nn&&arguments[1]instanceof J){var Qe=arguments[0],Pn=arguments[1],Bn=arguments[2];if(Qe instanceof ps)Pl.computeDistance(Qe,Pn,Bn);else if(Qe instanceof wi)Pl.computeDistance(Qe,Pn,Bn);else if(Qe instanceof Rr)for(var tr=Qe,_r=0;_r<tr.getNumGeometries();_r++){var Ki=tr.getGeometryN(_r);Pl.computeDistance(Ki,Pn,Bn)}else Bn.setMinimum(Qe.getCoordinate(),Pn)}else if(arguments[2]instanceof ta&&arguments[0]instanceof pn&&arguments[1]instanceof J){var Aa=arguments[1],Nu=arguments[2],Ec=arguments[0].closestPoint(Aa);Nu.setMinimum(Ec,Aa)}};var Ba=function(){this._g0=null,this._g1=null,this._ptDist=new ta,this._densifyFrac=0;var d=arguments[1];this._g0=arguments[0],this._g1=d},ko={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};Ba.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},Ba.prototype.setDensifyFraction=function(f){if(f>1||f<=0)throw new gt("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=f},Ba.prototype.compute=function(f,d){this.computeOrientedDistance(f,d,this._ptDist),this.computeOrientedDistance(d,f,this._ptDist)},Ba.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},Ba.prototype.computeOrientedDistance=function(f,d,v){var w=new qi(d);if(f.apply(w),v.setMaximum(w.getMaxPointDistance()),this._densifyFrac>0){var T=new Ua(d,this._densifyFrac);f.apply(T),v.setMaximum(T.getMaxPointDistance())}},Ba.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},Ba.prototype.interfaces_=function(){return[]},Ba.prototype.getClass=function(){return Ba},Ba.distance=function(){if(2===arguments.length)return new Ba(arguments[0],arguments[1]).distance();if(3===arguments.length){var T=arguments[2],k=new Ba(arguments[0],arguments[1]);return k.setDensifyFraction(T),k.distance()}},ko.MaxPointDistanceFilter.get=function(){return qi},ko.MaxDensifiedByFractionDistanceFilter.get=function(){return Ua},Object.defineProperties(Ba,ko);var qi=function(){this._maxPtDist=new ta,this._minPtDist=new ta,this._euclideanDist=new Pl,this._geom=null,this._geom=arguments[0]};qi.prototype.filter=function(f){this._minPtDist.initialize(),Pl.computeDistance(this._geom,f,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},qi.prototype.getMaxPointDistance=function(){return this._maxPtDist},qi.prototype.interfaces_=function(){return[W]},qi.prototype.getClass=function(){return qi};var Ua=function(){this._maxPtDist=new ta,this._minPtDist=new ta,this._geom=null,this._numSubSegs=0;var d=arguments[1];this._geom=arguments[0],this._numSubSegs=Math.trunc(Math.round(1/d))};Ua.prototype.filter=function(f,d){if(0===d)return null;for(var v=f.getCoordinate(d-1),w=f.getCoordinate(d),T=(w.x-v.x)/this._numSubSegs,k=(w.y-v.y)/this._numSubSegs,q=0;q<this._numSubSegs;q++){var ae=new J(v.x+q*T,v.y+q*k);this._minPtDist.initialize(),Pl.computeDistance(this._geom,ae,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},Ua.prototype.isDone=function(){return!1},Ua.prototype.isGeometryChanged=function(){return!1},Ua.prototype.getMaxPointDistance=function(){return this._maxPtDist},Ua.prototype.interfaces_=function(){return[ui]},Ua.prototype.getClass=function(){return Ua};var _s=function(f,d,v){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=f||null,this._bufDistance=d||null,this._result=v||null},Zc={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};_s.prototype.checkMaximumDistance=function(f,d,v){var w=new Ba(d,f);if(w.setDensifyFraction(.25),this._maxDistanceFound=w.orientedDistance(),this._maxDistanceFound>v){this._isValid=!1;var T=w.getCoordinates();this._errorLocation=T[1],this._errorIndicator=f.getFactory().createLineString(T),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Gt.toLineString(T[0],T[1])+")"}},_s.prototype.isValid=function(){var f=Math.abs(this._bufDistance),d=_s.MAX_DISTANCE_DIFF_FRAC*f;return this._minValidDistance=f-d,this._maxValidDistance=f+d,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),_s.VERBOSE&&Yn.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},_s.prototype.checkNegativeValid=function(){if(!(this._input instanceof wi||this._input instanceof Os||this._input instanceof Rr))return null;var f=this.getPolygonLines(this._input);if(this.checkMinimumDistance(f,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(f,this._result,this._maxValidDistance)},_s.prototype.getErrorIndicator=function(){return this._errorIndicator},_s.prototype.checkMinimumDistance=function(f,d,v){var w=new Ts(f,d,v);if(this._minDistanceFound=w.distance(),this._minDistanceFound<v){this._isValid=!1;var T=w.nearestPoints();this._errorLocation=w.nearestPoints()[1],this._errorIndicator=f.getFactory().createLineString(T),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Gt.toLineString(T[0],T[1])+" )"}},_s.prototype.checkPositiveValid=function(){var f=this._result.getBoundary();if(this.checkMinimumDistance(this._input,f,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,f,this._maxValidDistance)},_s.prototype.getErrorLocation=function(){return this._errorLocation},_s.prototype.getPolygonLines=function(f){for(var d=new lt,v=new eo(d),w=As.getPolygons(f).iterator();w.hasNext();)w.next().apply(v);return f.getFactory().buildGeometry(d)},_s.prototype.getErrorMessage=function(){return this._errMsg},_s.prototype.interfaces_=function(){return[]},_s.prototype.getClass=function(){return _s},Zc.VERBOSE.get=function(){return!1},Zc.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(_s,Zc);var no=function(f,d,v){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=f||null,this._distance=d||null,this._result=v||null},il={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};no.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},no.prototype.checkEnvelope=function(){if(this._distance<0)return null;var f=this._distance*no.MAX_ENV_DIFF_FRAC;0===f&&(f=.001);var d=new hn(this._input.getEnvelopeInternal());d.expandBy(this._distance);var v=new hn(this._result.getEnvelopeInternal());v.expandBy(f),v.contains(d)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(v)),this.report("Envelope")},no.prototype.checkDistance=function(){var f=new _s(this._input,this._distance,this._result);f.isValid()||(this._isValid=!1,this._errorMsg=f.getErrorMessage(),this._errorLocation=f.getErrorLocation(),this._errorIndicator=f.getErrorIndicator()),this.report("Distance")},no.prototype.checkArea=function(){var f=this._input.getArea(),d=this._result.getArea();this._distance>0&&f>d&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&f<d&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},no.prototype.checkPolygonal=function(){this._result instanceof wi||this._result instanceof Os||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},no.prototype.getErrorIndicator=function(){return this._errorIndicator},no.prototype.getErrorLocation=function(){return this._errorLocation},no.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},no.prototype.report=function(f){if(!no.VERBOSE)return null;Yn.out.println("Check "+f+": "+(this._isValid?"passed":"FAILED"))},no.prototype.getErrorMessage=function(){return this._errorMsg},no.prototype.interfaces_=function(){return[]},no.prototype.getClass=function(){return no},no.isValidMsg=function(f,d,v){var w=new no(f,d,v);return w.isValid()?null:w.getErrorMessage()},no.isValid=function(f,d,v){return!!new no(f,d,v).isValid()},il.VERBOSE.get=function(){return!1},il.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(no,il);var hs=function(){this._pts=null,this._data=null;var d=arguments[1];this._pts=arguments[0],this._data=d};hs.prototype.getCoordinates=function(){return this._pts},hs.prototype.size=function(){return this._pts.length},hs.prototype.getCoordinate=function(f){return this._pts[f]},hs.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},hs.prototype.getSegmentOctant=function(f){return f===this._pts.length-1?-1:yl.octant(this.getCoordinate(f),this.getCoordinate(f+1))},hs.prototype.setData=function(f){this._data=f},hs.prototype.getData=function(){return this._data},hs.prototype.toString=function(){return Gt.toLineString(new Yo(this._pts))},hs.prototype.interfaces_=function(){return[_a]},hs.prototype.getClass=function(){return hs};var qo=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new lt,this._intersectionCount=0,this._keepIntersections=!0,this._li=arguments[0],this._interiorIntersection=null};qo.prototype.getInteriorIntersection=function(){return this._interiorIntersection},qo.prototype.setCheckEndSegmentsOnly=function(f){this._isCheckEndSegmentsOnly=f},qo.prototype.getIntersectionSegments=function(){return this._intSegments},qo.prototype.count=function(){return this._intersectionCount},qo.prototype.getIntersections=function(){return this._intersections},qo.prototype.setFindAllIntersections=function(f){this._findAllIntersections=f},qo.prototype.setKeepIntersections=function(f){this._keepIntersections=f},qo.prototype.processIntersections=function(f,d,v,w){if(!this._findAllIntersections&&this.hasIntersection()||f===v&&d===w||this._isCheckEndSegmentsOnly&&!this.isEndSegment(f,d)&&!this.isEndSegment(v,w))return null;var T=f.getCoordinates()[d],k=f.getCoordinates()[d+1],q=v.getCoordinates()[w],K=v.getCoordinates()[w+1];this._li.computeIntersection(T,k,q,K),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=T,this._intSegments[1]=k,this._intSegments[2]=q,this._intSegments[3]=K,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},qo.prototype.isEndSegment=function(f,d){return 0===d||d>=f.size()-2},qo.prototype.hasIntersection=function(){return null!==this._interiorIntersection},qo.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},qo.prototype.interfaces_=function(){return[Kr]},qo.prototype.getClass=function(){return qo},qo.createAllIntersectionsFinder=function(f){var d=new qo(f);return d.setFindAllIntersections(!0),d},qo.createAnyIntersectionFinder=function(f){return new qo(f)},qo.createIntersectionCounter=function(f){var d=new qo(f);return d.setFindAllIntersections(!0),d.setKeepIntersections(!1),d};var aa=function(){this._li=new Rn,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0,this._segStrings=arguments[0]};aa.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},aa.prototype.getIntersections=function(){return this._segInt.getIntersections()},aa.prototype.isValid=function(){return this.execute(),this._isValid},aa.prototype.setFindAllIntersections=function(f){this._findAllIntersections=f},aa.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new qo(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var f=new Zr;if(f.setSegmentIntersector(this._segInt),f.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},aa.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Dn(this.getErrorMessage(),this._segInt.getInteriorIntersection())},aa.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var f=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Gt.toLineString(f[0],f[1])+" and "+Gt.toLineString(f[2],f[3])},aa.prototype.interfaces_=function(){return[]},aa.prototype.getClass=function(){return aa},aa.computeIntersections=function(f){var d=new aa(f);return d.setFindAllIntersections(!0),d.isValid(),d.getIntersections()};var $o=function f(){this._nv=null,this._nv=new aa(f.toSegmentStrings(arguments[0]))};$o.prototype.checkValid=function(){this._nv.checkValid()},$o.prototype.interfaces_=function(){return[]},$o.prototype.getClass=function(){return $o},$o.toSegmentStrings=function(f){for(var d=new lt,v=f.iterator();v.hasNext();){var w=v.next();d.add(new hs(w.getCoordinates(),w))}return d},$o.checkValid=function(f){new $o(f).checkValid()};var zo=function(f){this._mapOp=f};zo.prototype.map=function(f){for(var d=new lt,v=0;v<f.getNumGeometries();v++){var w=this._mapOp.map(f.getGeometryN(v));w.isEmpty()||d.add(w)}return f.getFactory().createGeometryCollection(Hn.toGeometryArray(d))},zo.prototype.interfaces_=function(){return[]},zo.prototype.getClass=function(){return zo},zo.map=function(f,d){return new zo(d).map(f)};var Wr=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new lt,this._resultLineList=new lt;var d=arguments[1],v=arguments[2];this._op=arguments[0],this._geometryFactory=d,this._ptLocator=v};Wr.prototype.collectLines=function(f){for(var d=this._op.getGraph().getEdgeEnds().iterator();d.hasNext();){var v=d.next();this.collectLineEdge(v,f,this._lineEdgesList),this.collectBoundaryTouchEdge(v,f,this._lineEdgesList)}},Wr.prototype.labelIsolatedLine=function(f,d){var v=this._ptLocator.locate(f.getCoordinate(),this._op.getArgGeometry(d));f.getLabel().setLocation(d,v)},Wr.prototype.build=function(f){return this.findCoveredLineEdges(),this.collectLines(f),this.buildLines(f),this._resultLineList},Wr.prototype.collectLineEdge=function(f,d,v){var w=f.getLabel(),T=f.getEdge();f.isLineEdge()&&(f.isVisited()||!Tr.isResultOfOp(w,d)||T.isCovered()||(v.add(T),f.setVisitedEdge(!0)))},Wr.prototype.findCoveredLineEdges=function(){for(var f=this._op.getGraph().getNodes().iterator();f.hasNext();)f.next().getEdges().findCoveredLineEdges();for(var d=this._op.getGraph().getEdgeEnds().iterator();d.hasNext();){var v=d.next(),w=v.getEdge();if(v.isLineEdge()&&!w.isCoveredSet()){var T=this._op.isCoveredByA(v.getCoordinate());w.setCovered(T)}}},Wr.prototype.labelIsolatedLines=function(f){for(var d=f.iterator();d.hasNext();){var v=d.next(),w=v.getLabel();v.isIsolated()&&(w.isNull(0)?this.labelIsolatedLine(v,0):this.labelIsolatedLine(v,1))}},Wr.prototype.buildLines=function(f){for(var d=this._lineEdgesList.iterator();d.hasNext();){var v=d.next(),w=this._geometryFactory.createLineString(v.getCoordinates());this._resultLineList.add(w),v.setInResult(!0)}},Wr.prototype.collectBoundaryTouchEdge=function(f,d,v){var w=f.getLabel();return f.isLineEdge()||f.isVisited()||f.isInteriorAreaEdge()||f.getEdge().isInResult()?null:(We.isTrue(!(f.isInResult()||f.getSym().isInResult())||!f.getEdge().isInResult()),void(Tr.isResultOfOp(w,d)&&d===Tr.INTERSECTION&&(v.add(f.getEdge()),f.setVisitedEdge(!0))))},Wr.prototype.interfaces_=function(){return[]},Wr.prototype.getClass=function(){return Wr};var Oo=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new lt;var d=arguments[1];this._op=arguments[0],this._geometryFactory=d};Oo.prototype.filterCoveredNodeToPoint=function(f){var d=f.getCoordinate();if(!this._op.isCoveredByLA(d)){var v=this._geometryFactory.createPoint(d);this._resultPointList.add(v)}},Oo.prototype.extractNonCoveredResultNodes=function(f){for(var d=this._op.getGraph().getNodes().iterator();d.hasNext();){var v=d.next();if(!(v.isInResult()||v.isIncidentEdgeInResult()||0!==v.getEdges().getDegree()&&f!==Tr.INTERSECTION)){var w=v.getLabel();Tr.isResultOfOp(w,f)&&this.filterCoveredNodeToPoint(v)}}},Oo.prototype.build=function(f){return this.extractNonCoveredResultNodes(f),this._resultPointList},Oo.prototype.interfaces_=function(){return[]},Oo.prototype.getClass=function(){return Oo};var $i=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};$i.prototype.transformPoint=function(f,d){return this._factory.createPoint(this.transformCoordinates(f.getCoordinateSequence(),f))},$i.prototype.transformPolygon=function(f,d){var v=!0,w=this.transformLinearRing(f.getExteriorRing(),f);null!==w&&w instanceof pl&&!w.isEmpty()||(v=!1);for(var T=new lt,k=0;k<f.getNumInteriorRing();k++){var q=this.transformLinearRing(f.getInteriorRingN(k),f);null===q||q.isEmpty()||(q instanceof pl||(v=!1),T.add(q))}if(v)return this._factory.createPolygon(w,T.toArray([]));var K=new lt;return null!==w&&K.add(w),K.addAll(T),this._factory.buildGeometry(K)},$i.prototype.createCoordinateSequence=function(f){return this._factory.getCoordinateSequenceFactory().create(f)},$i.prototype.getInputGeometry=function(){return this._inputGeom},$i.prototype.transformMultiLineString=function(f,d){for(var v=new lt,w=0;w<f.getNumGeometries();w++){var T=this.transformLineString(f.getGeometryN(w),f);null!==T&&(T.isEmpty()||v.add(T))}return this._factory.buildGeometry(v)},$i.prototype.transformCoordinates=function(f,d){return this.copy(f)},$i.prototype.transformLineString=function(f,d){return this._factory.createLineString(this.transformCoordinates(f.getCoordinateSequence(),f))},$i.prototype.transformMultiPoint=function(f,d){for(var v=new lt,w=0;w<f.getNumGeometries();w++){var T=this.transformPoint(f.getGeometryN(w),f);null!==T&&(T.isEmpty()||v.add(T))}return this._factory.buildGeometry(v)},$i.prototype.transformMultiPolygon=function(f,d){for(var v=new lt,w=0;w<f.getNumGeometries();w++){var T=this.transformPolygon(f.getGeometryN(w),f);null!==T&&(T.isEmpty()||v.add(T))}return this._factory.buildGeometry(v)},$i.prototype.copy=function(f){return f.copy()},$i.prototype.transformGeometryCollection=function(f,d){for(var v=new lt,w=0;w<f.getNumGeometries();w++){var T=this.transform(f.getGeometryN(w));null!==T&&(this._pruneEmptyGeometry&&T.isEmpty()||v.add(T))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(Hn.toGeometryArray(v)):this._factory.buildGeometry(v)},$i.prototype.transform=function(f){if(this._inputGeom=f,this._factory=f.getFactory(),f instanceof ga)return this.transformPoint(f,null);if(f instanceof jl)return this.transformMultiPoint(f,null);if(f instanceof pl)return this.transformLinearRing(f,null);if(f instanceof ps)return this.transformLineString(f,null);if(f instanceof ls)return this.transformMultiLineString(f,null);if(f instanceof wi)return this.transformPolygon(f,null);if(f instanceof Os)return this.transformMultiPolygon(f,null);if(f instanceof Rr)return this.transformGeometryCollection(f,null);throw new gt("Unknown Geometry subtype: "+f.getClass().getName())},$i.prototype.transformLinearRing=function(f,d){var v=this.transformCoordinates(f.getCoordinateSequence(),f);if(null===v)return this._factory.createLinearRing(null);var w=v.size();return w>0&&w<4&&!this._preserveType?this._factory.createLineString(v):this._factory.createLinearRing(v)},$i.prototype.interfaces_=function(){return[]},$i.prototype.getClass=function(){return $i};var la=function f(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new pn,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof ps&&"number"==typeof arguments[1]){var v=arguments[1];f.call(this,arguments[0].getCoordinates(),v)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var w=arguments[0],T=arguments[1];this._srcPts=w,this._isClosed=f.isClosed(w),this._snapTolerance=T}};la.prototype.snapVertices=function(f,d){for(var v=this._isClosed?f.size()-1:f.size(),w=0;w<v;w++){var T=f.get(w),k=this.findSnapForVertex(T,d);null!==k&&(f.set(w,new J(k)),0===w&&this._isClosed&&f.set(f.size()-1,new J(k)))}},la.prototype.findSnapForVertex=function(f,d){for(var v=0;v<d.length;v++){if(f.equals2D(d[v]))return null;if(f.distance(d[v])<this._snapTolerance)return d[v]}return null},la.prototype.snapTo=function(f){var d=new ve(this._srcPts);return this.snapVertices(d,f),this.snapSegments(d,f),d.toCoordinateArray()},la.prototype.snapSegments=function(f,d){if(0===d.length)return null;var v=d.length;d[0].equals2D(d[d.length-1])&&(v=d.length-1);for(var w=0;w<v;w++){var T=d[w],k=this.findSegmentIndexToSnap(T,f);k>=0&&f.add(k+1,new J(T),!1)}},la.prototype.findSegmentIndexToSnap=function(f,d){for(var v=ct.MAX_VALUE,w=-1,T=0;T<d.size()-1;T++){if(this._seg.p0=d.get(T),this._seg.p1=d.get(T+1),this._seg.p0.equals2D(f)||this._seg.p1.equals2D(f)){if(this._allowSnappingToSourceVertices)continue;return-1}var k=this._seg.distance(f);k<this._snapTolerance&&k<v&&(v=k,w=T)}return w},la.prototype.setAllowSnappingToSourceVertices=function(f){this._allowSnappingToSourceVertices=f},la.prototype.interfaces_=function(){return[]},la.prototype.getClass=function(){return la},la.isClosed=function(f){return!(f.length<=1)&&f[0].equals2D(f[f.length-1])};var yi=function(f){this._srcGeom=f||null},Ch={SNAP_PRECISION_FACTOR:{configurable:!0}};yi.prototype.snapTo=function(f,d){var v=this.extractTargetCoordinates(f);return new ec(d,v).transform(this._srcGeom)},yi.prototype.snapToSelf=function(f,d){var v=this.extractTargetCoordinates(this._srcGeom),w=new ec(f,v,!0).transform(this._srcGeom),T=w;return d&&en(T,Ja)&&(T=w.buffer(0)),T},yi.prototype.computeSnapTolerance=function(f){return this.computeMinimumSegmentLength(f)/10},yi.prototype.extractTargetCoordinates=function(f){for(var d=new _e,v=f.getCoordinates(),w=0;w<v.length;w++)d.add(v[w]);return d.toArray(new Array(0).fill(null))},yi.prototype.computeMinimumSegmentLength=function(f){for(var d=ct.MAX_VALUE,v=0;v<f.length-1;v++){var w=f[v].distance(f[v+1]);w<d&&(d=w)}return d},yi.prototype.interfaces_=function(){return[]},yi.prototype.getClass=function(){return yi},yi.snap=function(f,d,v){var w=new Array(2).fill(null),T=new yi(f);w[0]=T.snapTo(d,v);var k=new yi(d);return w[1]=k.snapTo(w[0],v),w},yi.computeOverlaySnapTolerance=function(){if(1===arguments.length){var f=arguments[0],d=yi.computeSizeBasedSnapTolerance(f),v=f.getPrecisionModel();if(v.getType()===bi.FIXED){var w=1/v.getScale()*2/1.415;w>d&&(d=w)}return d}if(2===arguments.length){var k=arguments[1];return Math.min(yi.computeOverlaySnapTolerance(arguments[0]),yi.computeOverlaySnapTolerance(k))}},yi.computeSizeBasedSnapTolerance=function(f){var d=f.getEnvelopeInternal();return Math.min(d.getHeight(),d.getWidth())*yi.SNAP_PRECISION_FACTOR},yi.snapToSelf=function(f,d,v){return new yi(f).snapToSelf(d,v)},Ch.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(yi,Ch);var ec=function(f){function d(v,w,T){f.call(this),this._snapTolerance=v||null,this._snapPts=w||null,this._isSelfSnap=void 0!==T&&T}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.snapLine=function(v,w){var T=new la(v,this._snapTolerance);return T.setAllowSnappingToSourceVertices(this._isSelfSnap),T.snapTo(w)},d.prototype.transformCoordinates=function(v,w){var T=v.toCoordinateArray(),k=this.snapLine(T,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(k)},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d}($i),is=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};is.prototype.getCommon=function(){return ct.longBitsToDouble(this._commonBits)},is.prototype.add=function(f){var d=ct.doubleToLongBits(f);return this._isFirst?(this._commonBits=d,this._commonSignExp=is.signExpBits(this._commonBits),this._isFirst=!1,null):is.signExpBits(d)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=is.numCommonMostSigMantissaBits(this._commonBits,d),void(this._commonBits=is.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},is.prototype.toString=function(){if(1===arguments.length){var f=arguments[0],d=ct.longBitsToDouble(f),v="0000000000000000000000000000000000000000000000000000000000000000"+ct.toBinaryString(f),w=v.substring(v.length-64);return w.substring(0,1)+"  "+w.substring(1,12)+"(exp) "+w.substring(12)+" [ "+d+" ]"}},is.prototype.interfaces_=function(){return[]},is.prototype.getClass=function(){return is},is.getBit=function(f,d){return f&1<<d?1:0},is.signExpBits=function(f){return f>>52},is.zeroLowerBits=function(f,d){return f&~((1<<d)-1)},is.numCommonMostSigMantissaBits=function(f,d){for(var v=0,w=52;w>=0;w--){if(is.getBit(f,w)!==is.getBit(d,w))return v;v++}return 52};var Du=function(){this._commonCoord=null,this._ccFilter=new An},zf={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Du.prototype.addCommonBits=function(f){var d=new $n(this._commonCoord);f.apply(d),f.geometryChanged()},Du.prototype.removeCommonBits=function(f){if(0===this._commonCoord.x&&0===this._commonCoord.y)return f;var d=new J(this._commonCoord);d.x=-d.x,d.y=-d.y;var v=new $n(d);return f.apply(v),f.geometryChanged(),f},Du.prototype.getCommonCoordinate=function(){return this._commonCoord},Du.prototype.add=function(f){f.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},Du.prototype.interfaces_=function(){return[]},Du.prototype.getClass=function(){return Du},zf.CommonCoordinateFilter.get=function(){return An},zf.Translater.get=function(){return $n},Object.defineProperties(Du,zf);var An=function(){this._commonBitsX=new is,this._commonBitsY=new is};An.prototype.filter=function(f){this._commonBitsX.add(f.x),this._commonBitsY.add(f.y)},An.prototype.getCommonCoordinate=function(){return new J(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},An.prototype.interfaces_=function(){return[W]},An.prototype.getClass=function(){return An};var $n=function(){this.trans=null,this.trans=arguments[0]};$n.prototype.filter=function(f,d){var v=f.getOrdinate(d,0)+this.trans.x,w=f.getOrdinate(d,1)+this.trans.y;f.setOrdinate(d,0,v),f.setOrdinate(d,1,w)},$n.prototype.isDone=function(){return!1},$n.prototype.isGeometryChanged=function(){return!0},$n.prototype.interfaces_=function(){return[ui]},$n.prototype.getClass=function(){return $n};var cr=function(f,d){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=f,this._geom[1]=d,this.computeSnapTolerance()};cr.prototype.selfSnap=function(f){return new yi(f).snapTo(f,this._snapTolerance)},cr.prototype.removeCommonBits=function(f){this._cbr=new Du,this._cbr.add(f[0]),this._cbr.add(f[1]);var d=new Array(2).fill(null);return d[0]=this._cbr.removeCommonBits(f[0].copy()),d[1]=this._cbr.removeCommonBits(f[1].copy()),d},cr.prototype.prepareResult=function(f){return this._cbr.addCommonBits(f),f},cr.prototype.getResultGeometry=function(f){var d=this.snap(this._geom),v=Tr.overlayOp(d[0],d[1],f);return this.prepareResult(v)},cr.prototype.checkValid=function(f){f.isValid()||Yn.out.println("Snapped geometry is invalid")},cr.prototype.computeSnapTolerance=function(){this._snapTolerance=yi.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},cr.prototype.snap=function(f){var d=this.removeCommonBits(f);return yi.snap(d[0],d[1],this._snapTolerance)},cr.prototype.interfaces_=function(){return[]},cr.prototype.getClass=function(){return cr},cr.overlayOp=function(f,d,v){return new cr(f,d).getResultGeometry(v)},cr.union=function(f,d){return cr.overlayOp(f,d,Tr.UNION)},cr.intersection=function(f,d){return cr.overlayOp(f,d,Tr.INTERSECTION)},cr.symDifference=function(f,d){return cr.overlayOp(f,d,Tr.SYMDIFFERENCE)},cr.difference=function(f,d){return cr.overlayOp(f,d,Tr.DIFFERENCE)};var Ii=function(f,d){this._geom=new Array(2).fill(null),this._geom[0]=f,this._geom[1]=d};Ii.prototype.getResultGeometry=function(f){var d=null,v=!1,w=null;try{d=Tr.overlayOp(this._geom[0],this._geom[1],f),v=!0}catch(T){if(!(T instanceof Ve))throw T;w=T}if(!v)try{d=cr.overlayOp(this._geom[0],this._geom[1],f)}catch(T){throw T instanceof Ve?w:T}return d},Ii.prototype.interfaces_=function(){return[]},Ii.prototype.getClass=function(){return Ii},Ii.overlayOp=function(f,d,v){return new Ii(f,d).getResultGeometry(v)},Ii.union=function(f,d){return Ii.overlayOp(f,d,Tr.UNION)},Ii.intersection=function(f,d){return Ii.overlayOp(f,d,Tr.INTERSECTION)},Ii.symDifference=function(f,d){return Ii.overlayOp(f,d,Tr.SYMDIFFERENCE)},Ii.difference=function(f,d){return Ii.overlayOp(f,d,Tr.DIFFERENCE)};var ol=function(){this.mce=null,this.chainIndex=null;var d=arguments[1];this.mce=arguments[0],this.chainIndex=d};ol.prototype.computeIntersections=function(f,d){this.mce.computeIntersectsForChain(this.chainIndex,f.mce,f.chainIndex,d)},ol.prototype.interfaces_=function(){return[]},ol.prototype.getClass=function(){return ol};var ua=function f(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var d=arguments[0],v=arguments[1];this._eventType=f.DELETE,this._xValue=d,this._insertEvent=v}else if(3===arguments.length){var w=arguments[0],T=arguments[1],k=arguments[2];this._eventType=f.INSERT,this._label=w,this._xValue=T,this._obj=k}},$s={INSERT:{configurable:!0},DELETE:{configurable:!0}};ua.prototype.isDelete=function(){return this._eventType===ua.DELETE},ua.prototype.setDeleteEventIndex=function(f){this._deleteEventIndex=f},ua.prototype.getObject=function(){return this._obj},ua.prototype.compareTo=function(f){return this._xValue<f._xValue?-1:this._xValue>f._xValue?1:this._eventType<f._eventType?-1:this._eventType>f._eventType?1:0},ua.prototype.getInsertEvent=function(){return this._insertEvent},ua.prototype.isInsert=function(){return this._eventType===ua.INSERT},ua.prototype.isSameLabel=function(f){return null!==this._label&&this._label===f._label},ua.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},ua.prototype.interfaces_=function(){return[ut]},ua.prototype.getClass=function(){return ua},$s.INSERT.get=function(){return 1},$s.DELETE.get=function(){return 2},Object.defineProperties(ua,$s);var nc=function(){};nc.prototype.interfaces_=function(){return[]},nc.prototype.getClass=function(){return nc};var Li=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var d=arguments[1],v=arguments[2];this._li=arguments[0],this._includeProper=d,this._recordIsolated=v};Li.prototype.isTrivialIntersection=function(f,d,v,w){if(f===v&&1===this._li.getIntersectionNum()){if(Li.isAdjacentSegments(d,w))return!0;if(f.isClosed()){var T=f.getNumPoints()-1;if(0===d&&w===T||0===w&&d===T)return!0}}return!1},Li.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Li.prototype.setIsDoneIfProperInt=function(f){this._isDoneWhenProperInt=f},Li.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Li.prototype.isBoundaryPointInternal=function(f,d){for(var v=d.iterator();v.hasNext();){var w=v.next().getCoordinate();if(f.isIntersection(w))return!0}return!1},Li.prototype.hasProperIntersection=function(){return this._hasProper},Li.prototype.hasIntersection=function(){return this._hasIntersection},Li.prototype.isDone=function(){return this._isDone},Li.prototype.isBoundaryPoint=function(f,d){return!(null===d||!this.isBoundaryPointInternal(f,d[0])&&!this.isBoundaryPointInternal(f,d[1]))},Li.prototype.setBoundaryNodes=function(f,d){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=f,this._bdyNodes[1]=d},Li.prototype.addIntersections=function(f,d,v,w){if(f===v&&d===w)return null;this.numTests++;var T=f.getCoordinates()[d],k=f.getCoordinates()[d+1],q=v.getCoordinates()[w],K=v.getCoordinates()[w+1];this._li.computeIntersection(T,k,q,K),this._li.hasIntersection()&&(this._recordIsolated&&(f.setIsolated(!1),v.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(f,d,v,w)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(f.addIntersections(this._li,d,0),v.addIntersections(this._li,w,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},Li.prototype.interfaces_=function(){return[]},Li.prototype.getClass=function(){return Li},Li.isAdjacentSegments=function(f,d){return 1===Math.abs(f-d)};var Wc=function(f){function d(){f.call(this),this.events=new lt,this.nOverlaps=null}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.prepareEvents=function(){ur.sort(this.events);for(var v=0;v<this.events.size();v++){var w=this.events.get(v);w.isDelete()&&w.getInsertEvent().setDeleteEventIndex(v)}},d.prototype.computeIntersections=function(){if(1===arguments.length){var v=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var w=0;w<this.events.size();w++){var T=this.events.get(w);if(T.isInsert()&&this.processOverlaps(w,T.getDeleteEventIndex(),T,v),v.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof Li&&en(arguments[0],Kt)&&en(arguments[1],Kt)){var k=arguments[0],q=arguments[1],K=arguments[2];this.addEdges(k,k),this.addEdges(q,q),this.computeIntersections(K)}else if("boolean"==typeof arguments[2]&&en(arguments[0],Kt)&&arguments[1]instanceof Li){var Mt=arguments[0],ae=arguments[1];arguments[2]?this.addEdges(Mt,null):this.addEdges(Mt),this.computeIntersections(ae)}},d.prototype.addEdge=function(v,w){for(var T=v.getMonotoneChainEdge(),k=T.getStartIndexes(),q=0;q<k.length-1;q++){var K=new ol(T,q),Mt=new ua(w,T.getMinX(q),K);this.events.add(Mt),this.events.add(new ua(T.getMaxX(q),Mt))}},d.prototype.processOverlaps=function(v,w,T,k){for(var q=T.getObject(),K=v;K<w;K++){var Mt=this.events.get(K);if(Mt.isInsert()){var ae=Mt.getObject();T.isSameLabel(Mt)||(q.computeIntersections(ae,k),this.nOverlaps++)}}},d.prototype.addEdges=function(){if(1===arguments.length)for(var v=arguments[0].iterator();v.hasNext();){var w=v.next();this.addEdge(w,w)}else if(2===arguments.length)for(var k=arguments[1],q=arguments[0].iterator();q.hasNext();){var K=q.next();this.addEdge(K,k)}},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d}(nc),sl=function(){this._min=ct.POSITIVE_INFINITY,this._max=ct.NEGATIVE_INFINITY},ni={NodeComparator:{configurable:!0}};sl.prototype.getMin=function(){return this._min},sl.prototype.intersects=function(f,d){return!(this._min>d||this._max<f)},sl.prototype.getMax=function(){return this._max},sl.prototype.toString=function(){return Gt.toLineString(new J(this._min,0),new J(this._max,0))},sl.prototype.interfaces_=function(){return[]},sl.prototype.getClass=function(){return sl},ni.NodeComparator.get=function(){return Au},Object.defineProperties(sl,ni);var Au=function(){};Au.prototype.compare=function(f,d){var T=(f._min+f._max)/2,k=(d._min+d._max)/2;return T<k?-1:T>k?1:0},Au.prototype.interfaces_=function(){return[ht]},Au.prototype.getClass=function(){return Au};var Yd=function(f){function d(){f.call(this),this._item=null;var w=arguments[1],T=arguments[2];this._min=arguments[0],this._max=w,this._item=T}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.query=function(v,w,T){if(!this.intersects(v,w))return null;T.visitItem(this._item)},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d}(sl),Xc=function(f){function d(){f.call(this),this._node1=null,this._node2=null;var w=arguments[1];this._node1=arguments[0],this._node2=w,this.buildExtent(this._node1,this._node2)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.buildExtent=function(v,w){this._min=Math.min(v._min,w._min),this._max=Math.max(v._max,w._max)},d.prototype.query=function(v,w,T){if(!this.intersects(v,w))return null;null!==this._node1&&this._node1.query(v,w,T),null!==this._node2&&this._node2.query(v,w,T)},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d}(sl),Bo=function(){this._leaves=new lt,this._root=null,this._level=0};Bo.prototype.buildTree=function(){ur.sort(this._leaves,new sl.NodeComparator);for(var f=this._leaves,d=null,v=new lt;;){if(this.buildLevel(f,v),1===v.size())return v.get(0);d=f,f=v,v=d}},Bo.prototype.insert=function(f,d,v){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new Yd(f,d,v))},Bo.prototype.query=function(f,d,v){this.init(),this._root.query(f,d,v)},Bo.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},Bo.prototype.printNode=function(f){Yn.out.println(Gt.toLineString(new J(f._min,this._level),new J(f._max,this._level)))},Bo.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},Bo.prototype.buildLevel=function(f,d){this._level++,d.clear();for(var v=0;v<f.size();v+=2){var w=f.get(v);if(null===(v+1<f.size()?f.get(v):null))d.add(w);else{var T=new Xc(f.get(v),f.get(v+1));d.add(T)}}},Bo.prototype.interfaces_=function(){return[]},Bo.prototype.getClass=function(){return Bo};var Pu=function(){this._items=new lt};Pu.prototype.visitItem=function(f){this._items.add(f)},Pu.prototype.getItems=function(){return this._items},Pu.prototype.interfaces_=function(){return[Vs]},Pu.prototype.getClass=function(){return Pu};var Lu=function(){this._index=null;var f=arguments[0];if(!en(f,Ja))throw new gt("Argument must be Polygonal");this._index=new rc(f)},al={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Lu.prototype.locate=function(f){var d=new Sn(f),v=new Ll(d);return this._index.query(f.y,f.y,v),d.getLocation()},Lu.prototype.interfaces_=function(){return[Ns]},Lu.prototype.getClass=function(){return Lu},al.SegmentVisitor.get=function(){return Ll},al.IntervalIndexedGeometry.get=function(){return rc},Object.defineProperties(Lu,al);var Ll=function(){this._counter=null,this._counter=arguments[0]};Ll.prototype.visitItem=function(f){var d=f;this._counter.countSegment(d.getCoordinate(0),d.getCoordinate(1))},Ll.prototype.interfaces_=function(){return[Vs]},Ll.prototype.getClass=function(){return Ll};var rc=function(){this._index=new Bo,this.init(arguments[0])};rc.prototype.init=function(f){for(var d=eo.getLines(f).iterator();d.hasNext();){var v=d.next().getCoordinates();this.addLine(v)}},rc.prototype.addLine=function(f){for(var d=1;d<f.length;d++){var v=new pn(f[d-1],f[d]),w=Math.min(v.p0.y,v.p1.y),T=Math.max(v.p0.y,v.p1.y);this._index.insert(w,T,v)}},rc.prototype.query=function(){if(2===arguments.length){var f=arguments[0],d=arguments[1],v=new Pu;return this._index.query(f,d,v),v.getItems()}3===arguments.length&&this._index.query(arguments[0],arguments[1],arguments[2])},rc.prototype.interfaces_=function(){return[]},rc.prototype.getClass=function(){return rc};var El=function(f){function d(){if(f.call(this),this._parentGeom=null,this._lineEdgeMap=new Hc,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Go,2===arguments.length){var w=arguments[1],T=nt.OGC_SFS_BOUNDARY_RULE;this._argIndex=arguments[0],this._parentGeom=w,this._boundaryNodeRule=T,null!==w&&this.add(w)}else if(3===arguments.length){var q=arguments[1],K=arguments[2];this._argIndex=arguments[0],this._parentGeom=q,this._boundaryNodeRule=K,null!==q&&this.add(q)}}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.insertBoundaryPoint=function(v,w){var T=this._nodes.addNode(w).getLabel(),k=1;T.getLocation(v,jt.ON)===Et.BOUNDARY&&k++;var q=d.determineBoundary(this._boundaryNodeRule,k);T.setLocation(v,q)},d.prototype.computeSelfNodes=function(){if(2===arguments.length)return this.computeSelfNodes(arguments[0],arguments[1],!1);if(3===arguments.length){var k=arguments[1],q=arguments[2],K=new Li(arguments[0],!0,!1);return K.setIsDoneIfProperInt(q),this.createEdgeSetIntersector().computeIntersections(this._edges,K,k||!(this._parentGeom instanceof pl||this._parentGeom instanceof wi||this._parentGeom instanceof Os)),this.addSelfIntersectionNodes(this._argIndex),K}},d.prototype.computeSplitEdges=function(v){for(var w=this._edges.iterator();w.hasNext();)w.next().eiList.addSplitEdges(v)},d.prototype.computeEdgeIntersections=function(v,w,T){var k=new Li(w,T,!0);return k.setBoundaryNodes(this.getBoundaryNodes(),v.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,v._edges,k),k},d.prototype.getGeometry=function(){return this._parentGeom},d.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},d.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},d.prototype.addPoint=function(){if(arguments[0]instanceof ga){var v=arguments[0].getCoordinate();this.insertPoint(this._argIndex,v,Et.INTERIOR)}else arguments[0]instanceof J&&this.insertPoint(this._argIndex,arguments[0],Et.INTERIOR)},d.prototype.addPolygon=function(v){this.addPolygonRing(v.getExteriorRing(),Et.EXTERIOR,Et.INTERIOR);for(var w=0;w<v.getNumInteriorRing();w++){var T=v.getInteriorRingN(w);this.addPolygonRing(T,Et.INTERIOR,Et.EXTERIOR)}},d.prototype.addEdge=function(v){this.insertEdge(v);var w=v.getCoordinates();this.insertPoint(this._argIndex,w[0],Et.BOUNDARY),this.insertPoint(this._argIndex,w[w.length-1],Et.BOUNDARY)},d.prototype.addLineString=function(v){var w=ye.removeRepeatedPoints(v.getCoordinates());if(w.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=w[0],null;var T=new Eh(w,new Se(this._argIndex,Et.INTERIOR));this._lineEdgeMap.put(v,T),this.insertEdge(T),We.isTrue(w.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,w[0]),this.insertBoundaryPoint(this._argIndex,w[w.length-1])},d.prototype.getInvalidPoint=function(){return this._invalidPoint},d.prototype.getBoundaryPoints=function(){for(var v=this.getBoundaryNodes(),w=new Array(v.size()).fill(null),T=0,k=v.iterator();k.hasNext();){var q=k.next();w[T++]=q.getCoordinate().copy()}return w},d.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},d.prototype.addSelfIntersectionNode=function(v,w,T){if(this.isBoundaryNode(v,w))return null;T===Et.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(v,w):this.insertPoint(v,w,T)},d.prototype.addPolygonRing=function(v,w,T){if(v.isEmpty())return null;var k=ye.removeRepeatedPoints(v.getCoordinates());if(k.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=k[0],null;var q=w,K=T;mn.isCCW(k)&&(q=T,K=w);var Mt=new Eh(k,new Se(this._argIndex,Et.BOUNDARY,q,K));this._lineEdgeMap.put(v,Mt),this.insertEdge(Mt),this.insertPoint(this._argIndex,k[0],Et.BOUNDARY)},d.prototype.insertPoint=function(v,w,T){var k=this._nodes.addNode(w),q=k.getLabel();null===q?k._label=new Se(v,T):q.setLocation(v,T)},d.prototype.createEdgeSetIntersector=function(){return new Wc},d.prototype.addSelfIntersectionNodes=function(v){for(var w=this._edges.iterator();w.hasNext();)for(var T=w.next(),k=T.getLabel().getLocation(v),q=T.eiList.iterator();q.hasNext();){var K=q.next();this.addSelfIntersectionNode(v,K.coord,k)}},d.prototype.add=function(){if(1!==arguments.length)return f.prototype.add.apply(this,arguments);var v=arguments[0];if(v.isEmpty())return null;if(v instanceof Os&&(this._useBoundaryDeterminationRule=!1),v instanceof wi)this.addPolygon(v);else if(v instanceof ps)this.addLineString(v);else if(v instanceof ga)this.addPoint(v);else if(v instanceof jl)this.addCollection(v);else if(v instanceof ls)this.addCollection(v);else if(v instanceof Os)this.addCollection(v);else{if(!(v instanceof Rr))throw new Error(v.getClass().getName());this.addCollection(v)}},d.prototype.addCollection=function(v){for(var w=0;w<v.getNumGeometries();w++){var T=v.getGeometryN(w);this.add(T)}},d.prototype.locate=function(v){return en(this._parentGeom,Ja)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new Lu(this._parentGeom)),this._areaPtLocator.locate(v)):this._ptLocator.locate(v,this._parentGeom)},d.prototype.findEdge=function(){return 1===arguments.length?this._lineEdgeMap.get(arguments[0]):f.prototype.findEdge.apply(this,arguments)},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d.determineBoundary=function(v,w){return v.isInBoundary(w)?Et.BOUNDARY:Et.INTERIOR},d}(us),ll=function(){if(this._li=new Rn,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var f=arguments[0];this.setComputationPrecision(f.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new El(0,f)}else if(2===arguments.length){var d=arguments[0],v=arguments[1],w=nt.OGC_SFS_BOUNDARY_RULE;d.getPrecisionModel().compareTo(v.getPrecisionModel())>=0?this.setComputationPrecision(d.getPrecisionModel()):this.setComputationPrecision(v.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new El(0,d,w),this._arg[1]=new El(1,v,w)}else if(3===arguments.length){var T=arguments[0],k=arguments[1],q=arguments[2];T.getPrecisionModel().compareTo(k.getPrecisionModel())>=0?this.setComputationPrecision(T.getPrecisionModel()):this.setComputationPrecision(k.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new El(0,T,q),this._arg[1]=new El(1,k,q)}};ll.prototype.getArgGeometry=function(f){return this._arg[f].getGeometry()},ll.prototype.setComputationPrecision=function(f){this._resultPrecisionModel=f,this._li.setPrecisionModel(this._resultPrecisionModel)},ll.prototype.interfaces_=function(){return[]},ll.prototype.getClass=function(){return ll};var ca=function(){};ca.prototype.interfaces_=function(){return[]},ca.prototype.getClass=function(){return ca},ca.map=function(){if(arguments[0]instanceof Nn&&en(arguments[1],ca.MapOp)){for(var f=arguments[0],d=arguments[1],v=new lt,w=0;w<f.getNumGeometries();w++){var T=d.map(f.getGeometryN(w));null!==T&&v.add(T)}return f.getFactory().buildGeometry(v)}if(en(arguments[0],Ye)&&en(arguments[1],ca.MapOp)){for(var k=arguments[0],q=arguments[1],K=new lt,Mt=k.iterator();Mt.hasNext();){var ae=Mt.next(),Ze=q.map(ae);null!==Ze&&K.add(Ze)}return K}},ca.MapOp=function(){};var Tr=function(f){function d(){var v=arguments[0];f.call(this,v,arguments[1]),this._ptLocator=new Go,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new xl,this._resultPolyList=new lt,this._resultLineList=new lt,this._resultPointList=new lt,this._graph=new us(new bc),this._geomFact=v.getFactory()}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.insertUniqueEdge=function(v){var w=this._edgeList.findEqualEdge(v);if(null!==w){var T=w.getLabel(),k=v.getLabel();w.isPointwiseEqual(v)||(k=new Se(v.getLabel())).flip();var q=w.getDepth();q.isNull()&&q.add(T),q.add(k),T.merge(k)}else this._edgeList.add(v)},d.prototype.getGraph=function(){return this._graph},d.prototype.cancelDuplicateResultEdges=function(){for(var v=this._graph.getEdgeEnds().iterator();v.hasNext();){var w=v.next(),T=w.getSym();w.isInResult()&&T.isInResult()&&(w.setInResult(!1),T.setInResult(!1))}},d.prototype.isCoveredByLA=function(v){return!!this.isCovered(v,this._resultLineList)||!!this.isCovered(v,this._resultPolyList)},d.prototype.computeGeometry=function(v,w,T,k){var q=new lt;return q.addAll(v),q.addAll(w),q.addAll(T),q.isEmpty()?d.createEmptyResult(k,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(q)},d.prototype.mergeSymLabels=function(){for(var v=this._graph.getNodes().iterator();v.hasNext();)v.next().getEdges().mergeSymLabels()},d.prototype.isCovered=function(v,w){for(var T=w.iterator();T.hasNext();){var k=T.next();if(this._ptLocator.locate(v,k)!==Et.EXTERIOR)return!0}return!1},d.prototype.replaceCollapsedEdges=function(){for(var v=new lt,w=this._edgeList.iterator();w.hasNext();){var T=w.next();T.isCollapsed()&&(w.remove(),v.add(T.getCollapsedEdge()))}this._edgeList.addAll(v)},d.prototype.updateNodeLabelling=function(){for(var v=this._graph.getNodes().iterator();v.hasNext();){var w=v.next(),T=w.getEdges().getLabel();w.getLabel().merge(T)}},d.prototype.getResultGeometry=function(v){return this.computeOverlay(v),this._resultGeom},d.prototype.insertUniqueEdges=function(v){for(var w=v.iterator();w.hasNext();){var T=w.next();this.insertUniqueEdge(T)}},d.prototype.computeOverlay=function(v){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var w=new lt;this._arg[0].computeSplitEdges(w),this._arg[1].computeSplitEdges(w),this.insertUniqueEdges(w),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),$o.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(v),this.cancelDuplicateResultEdges();var T=new Jo(this._geomFact);T.add(this._graph),this._resultPolyList=T.getPolygons();var k=new Wr(this,this._geomFact,this._ptLocator);this._resultLineList=k.build(v);var q=new Oo(this,this._geomFact,this._ptLocator);this._resultPointList=q.build(v),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,v)},d.prototype.labelIncompleteNode=function(v,w){var T=this._ptLocator.locate(v.getCoordinate(),this._arg[w].getGeometry());v.getLabel().setLocation(w,T)},d.prototype.copyPoints=function(v){for(var w=this._arg[v].getNodeIterator();w.hasNext();){var T=w.next();this._graph.addNode(T.getCoordinate()).setLabel(v,T.getLabel().getLocation(v))}},d.prototype.findResultAreaEdges=function(v){for(var w=this._graph.getEdgeEnds().iterator();w.hasNext();){var T=w.next(),k=T.getLabel();k.isArea()&&!T.isInteriorAreaEdge()&&d.isResultOfOp(k.getLocation(0,jt.RIGHT),k.getLocation(1,jt.RIGHT),v)&&T.setInResult(!0)}},d.prototype.computeLabelsFromDepths=function(){for(var v=this._edgeList.iterator();v.hasNext();){var w=v.next(),T=w.getLabel(),k=w.getDepth();if(!k.isNull()){k.normalize();for(var q=0;q<2;q++)T.isNull(q)||!T.isArea()||k.isNull(q)||(0===k.getDelta(q)?T.toLine(q):(We.isTrue(!k.isNull(q,jt.LEFT),"depth of LEFT side has not been initialized"),T.setLocation(q,jt.LEFT,k.getLocation(q,jt.LEFT)),We.isTrue(!k.isNull(q,jt.RIGHT),"depth of RIGHT side has not been initialized"),T.setLocation(q,jt.RIGHT,k.getLocation(q,jt.RIGHT))))}}},d.prototype.computeLabelling=function(){for(var v=this._graph.getNodes().iterator();v.hasNext();)v.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},d.prototype.labelIncompleteNodes=function(){for(var v=this._graph.getNodes().iterator();v.hasNext();){var w=v.next(),T=w.getLabel();w.isIsolated()&&(T.isNull(0)?this.labelIncompleteNode(w,0):this.labelIncompleteNode(w,1)),w.getEdges().updateLabelling(T)}},d.prototype.isCoveredByA=function(v){return!!this.isCovered(v,this._resultPolyList)},d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d}(ll);Tr.overlayOp=function(f,d,v){return new Tr(f,d).getResultGeometry(v)},Tr.intersection=function(f,d){if(f.isEmpty()||d.isEmpty())return Tr.createEmptyResult(Tr.INTERSECTION,f,d,f.getFactory());if(f.isGeometryCollection()){var v=d;return zo.map(f,{interfaces_:function(){return[ca.MapOp]},map:function(w){return w.intersection(v)}})}return f.checkNotGeometryCollection(f),f.checkNotGeometryCollection(d),Ii.overlayOp(f,d,Tr.INTERSECTION)},Tr.symDifference=function(f,d){if(f.isEmpty()||d.isEmpty()){if(f.isEmpty()&&d.isEmpty())return Tr.createEmptyResult(Tr.SYMDIFFERENCE,f,d,f.getFactory());if(f.isEmpty())return d.copy();if(d.isEmpty())return f.copy()}return f.checkNotGeometryCollection(f),f.checkNotGeometryCollection(d),Ii.overlayOp(f,d,Tr.SYMDIFFERENCE)},Tr.resultDimension=function(f,d,v){var w=d.getDimension(),T=v.getDimension(),k=-1;switch(f){case Tr.INTERSECTION:k=Math.min(w,T);break;case Tr.UNION:k=Math.max(w,T);break;case Tr.DIFFERENCE:k=w;break;case Tr.SYMDIFFERENCE:k=Math.max(w,T)}return k},Tr.createEmptyResult=function(f,d,v,w){var T=null;switch(Tr.resultDimension(f,d,v)){case-1:T=w.createGeometryCollection(new Array(0).fill(null));break;case 0:T=w.createPoint();break;case 1:T=w.createLineString();break;case 2:T=w.createPolygon()}return T},Tr.difference=function(f,d){return f.isEmpty()?Tr.createEmptyResult(Tr.DIFFERENCE,f,d,f.getFactory()):d.isEmpty()?f.copy():(f.checkNotGeometryCollection(f),f.checkNotGeometryCollection(d),Ii.overlayOp(f,d,Tr.DIFFERENCE))},Tr.isResultOfOp=function(){if(2===arguments.length){var f=arguments[0],d=arguments[1],v=f.getLocation(0),w=f.getLocation(1);return Tr.isResultOfOp(v,w,d)}if(3===arguments.length){var T=arguments[0],k=arguments[1];switch(T===Et.BOUNDARY&&(T=Et.INTERIOR),k===Et.BOUNDARY&&(k=Et.INTERIOR),arguments[2]){case Tr.INTERSECTION:return T===Et.INTERIOR&&k===Et.INTERIOR;case Tr.UNION:return T===Et.INTERIOR||k===Et.INTERIOR;case Tr.DIFFERENCE:return T===Et.INTERIOR&&k!==Et.INTERIOR;case Tr.SYMDIFFERENCE:return T===Et.INTERIOR&&k!==Et.INTERIOR||T!==Et.INTERIOR&&k===Et.INTERIOR}return!1}},Tr.INTERSECTION=1,Tr.UNION=2,Tr.DIFFERENCE=3,Tr.SYMDIFFERENCE=4;var ci=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Go,this._seg=new pn;var f=arguments[0],d=arguments[1];this._g=f,this._boundaryDistanceTolerance=d,this._linework=this.extractLinework(f)};ci.prototype.isWithinToleranceOfBoundary=function(f){for(var d=0;d<this._linework.getNumGeometries();d++)for(var v=this._linework.getGeometryN(d).getCoordinateSequence(),w=0;w<v.size()-1;w++)if(v.getCoordinate(w,this._seg.p0),v.getCoordinate(w+1,this._seg.p1),this._seg.distance(f)<=this._boundaryDistanceTolerance)return!0;return!1},ci.prototype.getLocation=function(f){return this.isWithinToleranceOfBoundary(f)?Et.BOUNDARY:this._ptLocator.locate(f,this._g)},ci.prototype.extractLinework=function(f){var d=new Sh;f.apply(d);var v=d.getLinework(),w=Hn.toLineStringArray(v);return f.getFactory().createMultiLineString(w)},ci.prototype.interfaces_=function(){return[]},ci.prototype.getClass=function(){return ci};var Sh=function(){this._linework=null,this._linework=new lt};Sh.prototype.getLinework=function(){return this._linework},Sh.prototype.filter=function(f){if(f instanceof wi){var d=f;this._linework.add(d.getExteriorRing());for(var v=0;v<d.getNumInteriorRing();v++)this._linework.add(d.getInteriorRingN(v))}},Sh.prototype.interfaces_=function(){return[Vi]},Sh.prototype.getClass=function(){return Sh};var Ou=function(){this._g=null,this._doLeft=!0,this._doRight=!0,this._g=arguments[0]};Ou.prototype.extractPoints=function(f,d,v){for(var w=f.getCoordinates(),T=0;T<w.length-1;T++)this.computeOffsetPoints(w[T],w[T+1],d,v)},Ou.prototype.setSidesToGenerate=function(f,d){this._doLeft=f,this._doRight=d},Ou.prototype.getPoints=function(f){for(var d=new lt,v=eo.getLines(this._g).iterator();v.hasNext();){var w=v.next();this.extractPoints(w,f,d)}return d},Ou.prototype.computeOffsetPoints=function(f,d,v,w){var T=d.x-f.x,k=d.y-f.y,q=Math.sqrt(T*T+k*k),K=v*T/q,Mt=v*k/q,ae=(d.x+f.x)/2,Ze=(d.y+f.y)/2;if(this._doLeft){var Qe=new J(ae-Mt,Ze+K);w.add(Qe)}if(this._doRight){var Pn=new J(ae+Mt,Ze-K);w.add(Pn)}},Ou.prototype.interfaces_=function(){return[]},Ou.prototype.getClass=function(){return Ou};var Da=function f(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=f.TOLERANCE,this._testCoords=new lt;var d=arguments[0],v=arguments[1],w=arguments[2];this._boundaryDistanceTolerance=f.computeBoundaryDistanceTolerance(d,v),this._geom=[d,v,w],this._locFinder=[new ci(this._geom[0],this._boundaryDistanceTolerance),new ci(this._geom[1],this._boundaryDistanceTolerance),new ci(this._geom[2],this._boundaryDistanceTolerance)]},Ru={TOLERANCE:{configurable:!0}};Da.prototype.reportResult=function(f,d,v){Yn.out.println("Overlay result invalid - A:"+Et.toLocationSymbol(d[0])+" B:"+Et.toLocationSymbol(d[1])+" expected:"+(v?"i":"e")+" actual:"+Et.toLocationSymbol(d[2]))},Da.prototype.isValid=function(f){return this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]),this.checkValid(f)},Da.prototype.checkValid=function(){if(1===arguments.length){for(var f=arguments[0],d=0;d<this._testCoords.size();d++){var v=this._testCoords.get(d);if(!this.checkValid(f,v))return this._invalidLocation=v,!1}return!0}if(2===arguments.length){var w=arguments[0],T=arguments[1];return this._location[0]=this._locFinder[0].getLocation(T),this._location[1]=this._locFinder[1].getLocation(T),this._location[2]=this._locFinder[2].getLocation(T),!!Da.hasLocation(this._location,Et.BOUNDARY)||this.isValidResult(w,this._location)}},Da.prototype.addTestPts=function(f){var d=new Ou(f);this._testCoords.addAll(d.getPoints(5*this._boundaryDistanceTolerance))},Da.prototype.isValidResult=function(f,d){var v=Tr.isResultOfOp(d[0],d[1],f),w=!(v^d[2]===Et.INTERIOR);return w||this.reportResult(f,d,v),w},Da.prototype.getInvalidLocation=function(){return this._invalidLocation},Da.prototype.interfaces_=function(){return[]},Da.prototype.getClass=function(){return Da},Da.hasLocation=function(f,d){for(var v=0;v<3;v++)if(f[v]===d)return!0;return!1},Da.computeBoundaryDistanceTolerance=function(f,d){return Math.min(yi.computeSizeBasedSnapTolerance(f),yi.computeSizeBasedSnapTolerance(d))},Da.isValid=function(f,d,v,w){return new Da(f,d,w).isValid(v)},Ru.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Da,Ru);var va=function f(d){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=f.extractFactory(d),this._inputGeoms=d};va.prototype.extractElements=function(f,d){if(null===f)return null;for(var v=0;v<f.getNumGeometries();v++){var w=f.getGeometryN(v);this._skipEmpty&&w.isEmpty()||d.add(w)}},va.prototype.combine=function(){for(var f=new lt,d=this._inputGeoms.iterator();d.hasNext();){var v=d.next();this.extractElements(v,f)}return 0===f.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(f)},va.prototype.interfaces_=function(){return[]},va.prototype.getClass=function(){return va},va.combine=function(){return 1===arguments.length?new va(arguments[0]).combine():2===arguments.length?new va(va.createList(arguments[0],arguments[1])).combine():3===arguments.length?new va(va.createList(arguments[0],arguments[1],arguments[2])).combine():void 0},va.extractFactory=function(f){return f.isEmpty()?null:f.iterator().next().getFactory()},va.createList=function(){if(2===arguments.length){var f=arguments[0],d=arguments[1],v=new lt;return v.add(f),v.add(d),v}if(3===arguments.length){var w=arguments[0],T=arguments[1],k=arguments[2],q=new lt;return q.add(w),q.add(T),q.add(k),q}};var os=function(){this._inputPolys=null,this._geomFactory=null,this._inputPolys=arguments[0],null===this._inputPolys&&(this._inputPolys=new lt)},wc={STRTREE_NODE_CAPACITY:{configurable:!0}};os.prototype.reduceToGeometries=function(f){for(var d=new lt,v=f.iterator();v.hasNext();){var w=v.next(),T=null;en(w,Kt)?T=this.unionTree(w):w instanceof Nn&&(T=w),d.add(T)}return d},os.prototype.extractByEnvelope=function(f,d,v){for(var w=new lt,T=0;T<d.getNumGeometries();T++){var k=d.getGeometryN(T);k.getEnvelopeInternal().intersects(f)?w.add(k):v.add(k)}return this._geomFactory.buildGeometry(w)},os.prototype.unionOptimized=function(f,d){var v=f.getEnvelopeInternal(),w=d.getEnvelopeInternal();if(!v.intersects(w))return va.combine(f,d);if(f.getNumGeometries()<=1&&d.getNumGeometries()<=1)return this.unionActual(f,d);var T=v.intersection(w);return this.unionUsingEnvelopeIntersection(f,d,T)},os.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var f=new iu(os.STRTREE_NODE_CAPACITY),d=this._inputPolys.iterator();d.hasNext();){var v=d.next();f.insert(v.getEnvelopeInternal(),v)}this._inputPolys=null;var w=f.itemsTree();return this.unionTree(w)},os.prototype.binaryUnion=function(){if(1===arguments.length){var f=arguments[0];return this.binaryUnion(f,0,f.size())}if(3===arguments.length){var d=arguments[0],v=arguments[1],w=arguments[2];if(w-v<=1){var T=os.getGeometry(d,v);return this.unionSafe(T,null)}if(w-v==2)return this.unionSafe(os.getGeometry(d,v),os.getGeometry(d,v+1));var k=Math.trunc((w+v)/2),q=this.binaryUnion(d,v,k),K=this.binaryUnion(d,k,w);return this.unionSafe(q,K)}},os.prototype.repeatedUnion=function(f){for(var d=null,v=f.iterator();v.hasNext();){var w=v.next();d=null===d?w.copy():d.union(w)}return d},os.prototype.unionSafe=function(f,d){return null===f&&null===d?null:null===f?d.copy():null===d?f.copy():this.unionOptimized(f,d)},os.prototype.unionActual=function(f,d){return os.restrictToPolygons(f.union(d))},os.prototype.unionTree=function(f){var d=this.reduceToGeometries(f);return this.binaryUnion(d)},os.prototype.unionUsingEnvelopeIntersection=function(f,d,v){var w=new lt,T=this.extractByEnvelope(v,f,w),k=this.extractByEnvelope(v,d,w),q=this.unionActual(T,k);return w.add(q),va.combine(w)},os.prototype.bufferUnion=function(){if(1===arguments.length){var f=arguments[0];return f.get(0).getFactory().buildGeometry(f).buffer(0)}if(2===arguments.length){var d=arguments[0],v=arguments[1];return d.getFactory().createGeometryCollection([d,v]).buffer(0)}},os.prototype.interfaces_=function(){return[]},os.prototype.getClass=function(){return os},os.restrictToPolygons=function(f){if(en(f,Ja))return f;var d=As.getPolygons(f);return 1===d.size()?d.get(0):f.getFactory().createMultiPolygon(Hn.toPolygonArray(d))},os.getGeometry=function(f,d){return d>=f.size()?null:f.get(d)},os.union=function(f){return new os(f).union()},wc.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(os,wc);var ha=function(){};ha.prototype.interfaces_=function(){return[]},ha.prototype.getClass=function(){return ha},ha.union=function(f,d){if(f.isEmpty()||d.isEmpty()){if(f.isEmpty()&&d.isEmpty())return Tr.createEmptyResult(Tr.UNION,f,d,f.getFactory());if(f.isEmpty())return d.copy();if(d.isEmpty())return f.copy()}return f.checkNotGeometryCollection(f),f.checkNotGeometryCollection(d),Ii.overlayOp(f,d,Tr.UNION)},Tt.GeoJSONReader=he,Tt.GeoJSONWriter=me,Tt.OverlayOp=Tr,Tt.UnionOp=ha,Tt.BufferOp=Zn,Object.defineProperty(Tt,"__esModule",{value:!0})}(we)}},nn=>{nn(nn.s=7391)}]);